(()=>{"use strict";var e,a,t={717:(e,a,t)=>{class n{move;parent;children;isLeaf=!1;plays=0;value=0;constructor(e,a){this.parent=e,this.move=a}get moveHistory(){return this.parent?this.parent.moveHistory.concat([this.move]):[]}reportIsLeaf(){this.isLeaf=!0,this.parent?.checkIfLeaf()}reportPossibleMoves(e){this.children=e.map((e=>new n(this,e)))}selectNextNode(e){if(!this.children||0===this.children.length)return this;let a=null,t=null;for(const n of this.children)if(!n.isLeaf){const r=n.upperConfidenceBounds(e);(null===t||r>t)&&(t=r,a=n)}return null===a?(this.reportIsLeaf(),null):a.selectNextNode(!1)}updateValue(e,a){const t=this.plays>0?Math.max(e,this.value):e;this.value=t,this.plays+=1,this.move&&(void 0!==a[this.move]?a[this.move]=Math.max(a[this.move],this.value):a[this.move]=this.value),this.parent?.updateValue(e,a)}checkIfLeaf(){this.children.some((e=>e.isLeaf))||(this.isLeaf=!0,this.parent?.checkIfLeaf())}upperConfidenceBounds(e){return e?-this.plays:0===this.plays?Number.MAX_VALUE:this.value}}var r,i,s,o,d,c,l;!function(e){e.ActionEnds="ActionEnds",e.AddTwoExtraBroken="AddTwoExtraBroken",e.AdjustBuildPlans="AdjustBuildPlans",e.AdjustCardPlays="AdjustCardPlays",e.AdjustCollectiveDahanRavageDamage="AdjustCollectiveDahanRavageDamage",e.AdjustCollectiveInvaderRavageDamage="AdjustCollectiveInvaderRavageDamage",e.AdjustDamageDuringRavage="AdjustDamageDuringRavage",e.AdjustDamage="AdjustDamage",e.AdjustGainingPowers="AdjustGainingPowers",e.AdjustHealth="AdjustHealth",e.AdjustIndividualInvaderRavageDamage="AdjustIndividualInvaderRavageDamage",e.AdjustLandHealth="AdjustLandHealth",e.AdjustNumberOfActions="AdjustNumberOfActions",e.AdjustNumberOfExploreCards="AdjustNumberOfExploreCards",e.AdjustPlayPower="AdjustPlayPower",e.AdjustPowerSpeedOnPlay="AdjustPowerSpeedOnPlay",e.AdjustRemovePiece="AdjustRemovePiece",e.AdjustSetupPresence="AdjustSetupPresence",e.AfterAddingPiece="AfterAddingPiece",e.AfterAddingSlowHealingBlight="AfterAddingSlowHealingBlight",e.AfterAddingStrife="AfterAddingStrife",e.AfterAdvancingCards="AfterAdvancingCards",e.AfterAdversaryActionsOnEachBoard="AfterAdversaryActionsOnEachBoard",e.AfterChangingInvaderDeck="AfterChangingInvaderDeck",e.AfterChangingSpeed="AfterChangingSpeed",e.AfterDahanDestroyedInRavage="AfterDahanDestroyedInRavage",e.AfterDrawingBlightCard="AfterDrawingBlightCard",e.AfterEventPhase="AfterEventPhase",e.AfterFastPhase="AfterFastPhase",e.AfterFearDeckIsDecreasing="AfterFearDeckIsDecreasing",e.AfterGainingEnergyFromTracks="AfterGainingEnergyFromTracks",e.AfterGainingPowers="AfterGainingPowers",e.AfterGameEnds="AfterGameEnds",e.AfterGrowth="AfterGrowth",e.AfterInitialExplore="AfterInitialExplore",e.AfterInvaderPhase="AfterInvaderPhase",e.AfterLandChangesAmountOfPresence="AfterLandChangesAmountOfPresence",e.AfterMoving="AfterMoving",e.AfterPlayPowers="AfterPlayPowers",e.AfterPowerAddsDefense="AfterPowerAddsDefense",e.AfterPowerGenerateFearInLand="AfterPowerGenerateFearInLand",e.AfterPowerLeavesPlay="AfterPowerLeavesPlay",e.AfterRavagingDamageLand="AfterRavagingDamageLand",e.AfterRavaging="AfterRavaging",e.AfterReachingTerrorLevel="AfterReachingTerrorLevel",e.AfterRemovePiece="AfterRemovePiece",e.AfterReplacePieces="AfterReplacePieces",e.AfterResolvingBuildCard="AfterResolvingBuildCard",e.AfterResolvingEventCard="AfterResolvingEventCard",e.AfterResolvingExploreCard="AfterResolvingExploreCard",e.AfterResolvingLandTargetingPower="AfterResolvingLandTargetingPower",e.AfterResolvingRavageCard="AfterResolvingRavageCard",e.AfterSetupPresence="AfterSetupPresence",e.AfterSlowPhase="AfterSlowPhase",e.AfterSuccessfulBuild="AfterSuccessfulBuild",e.AfterSuccessfulExplore="AfterSuccessfulExplore",e.AfterTargetingLand="AfterTargetingLand",e.AfterTargetingLands="AfterTargetingLands",e.AfterTargetingSource="AfterTargetingSource",e.AfterTheNormalBuildStep="AfterTheNormalBuildStep",e.AfterTheNormalExploreStep="AfterTheNormalExploreStep",e.AfterTheNormalRavageStep="AfterTheNormalRavageStep",e.AfterUncoveringTrack="AfterUncoveringTrack",e.AlterInvaderActionInLand="AlterInvaderActionInLand",e.AnyActionEnds="AnyActionEnds",e.AnyActionStarts="AnyActionStarts",e.AtTimePassesBegin="AtTimePassesBegin",e.AtTimePassesEnds="AtTimePassesEnds",e.BeastsCountAsBadlands="BeastsCountAsBadlands",e.BeforeAdvancingCards="BeforeAdvancingCards",e.BeforeAdversaryActionsOnEachBoard="BeforeAdversaryActionsOnEachBoard",e.BeforeInitialExplore="BeforeInitialExplore",e.BeforeMoving="BeforeMoving",e.BeforePayEnergy="BeforePayEnergy",e.BeforePlayPowers="BeforePlayPowers",e.BeforeRavageStep="BeforeRavageStep",e.BeforeResolvingInnate="BeforeResolvingInnate",e.BeforeResolvingInvaderCard="BeforeResolvingInvaderCard",e.BeforeRevealingBlightCard="BeforeRevealingBlightCard",e.BeforeSetupPresence="BeforeSetupPresence",e.BeforeSuccessfulBuild="BeforeSuccessfulBuild",e.BeforeSuccessfulExplore="BeforeSuccessfulExplore",e.BlightAlwaysCascadesInLand="BlightAlwaysCascadesInLand",e.BlightedIslandPhase="BlightedIslandPhase",e.BoardHasExtraLocation="BoardHasExtraLocation",e.BuildCardsAffectLandsWithoutInvaders="BuildCardsAffectLandsWithoutInvaders",e.BuildOrderMatters="BuildOrderMatters",e.CanPlayCardsWithoutCost="CanPlayCardsWithoutCost",e.ChangeSpeedOfPower="ChangeSpeedOfPower",e.DahanFightBeforeInvaders="DahanFightBeforeInvaders",e.DahanFightSimultaneously="DahanFightSimultaneously",e.DamageBoost="DamageBoost",e.DamageIgnoreHealthBonuses="DamageIgnoreHealthBonuses",e.DefendFromGame="DefendFromGame",e.DefendFromSpirits="DefendFromSpirits",e.DoesNotParticipateInRavage="DoesNotParticipateInRavage",e.Elements="Elements",e.EnergyDebt="EnergyDebt",e.Escalation="Escalation",e.ExploreOrderMatters="ExploreOrderMatters",e.ExplorersFightWithDahan="ExplorersFightWithDahan",e.ExtraAction="ExtraAction",e.ExtraAdjacency="ExtraAdjacency",e.ExtraBeastAdjacency="ExtraBeastAdjacency",e.ExtraBlightFromDamage="ExtraBlightFromDamage",e.ExtraBoard="ExtraBoard",e.ExtraCardDrawAmount="ExtraCardDrawAmount",e.ExtraCardKeepAmount="ExtraCardKeepAmount",e.ExtraCardPlaysCost="ExtraCardPlaysCost",e.ExtraCardPlaysForDamageAndDestroy="ExtraCardPlaysForDamageAndDestroy",e.ExtraCardPlays="ExtraCardPlays",e.ExtraDefense="ExtraDefense",e.ExtraExploreDistance="ExtraExploreDistance",e.ExtraLandNumber="ExtraLandNumber",e.ExtraMove="ExtraMove",e.ExtraRangeToLand="ExtraRangeToLand",e.ExtraRange="ExtraRange",e.ExtraRemove="ExtraRemove",e.ExtraScore="ExtraScore",e.Flooded="Flooded",e.GlobalReminder="GlobalReminder",e.HasSacredSiteOf="HasSacredSiteOf",e.HighImmigration="HighImmigration",e.IgnoreOneStrife="IgnoreOneStrife",e.IgnoreWildsDuringExplore="IgnoreWildsDuringExplore",e.InTargetLand="InTargetLand",e.Isolated="Isolated",e.LandIsExploringSource="LandIsExploringSource",e.LocationIsOcean="LocationIsOcean",e.LocationIsTerrain="LocationIsTerrain",e.LossCondition="LossCondition",e.MayChangeSpeedOfPower="MayChangeSpeedOfPower",e.MayGrowWithDestroyedPresence="MayGrowWithDestroyedPresence",e.MayIgnoreRangeWhenTargetingLand="MayIgnoreRangeWhenTargetingLand",e.MayIgnoreTargetFilterWhenTargetingLand="MayIgnoreTargetFilterWhenTargetingLand",e.MayRepeatPowercard="MayRepeatPowercard",e.MayShift="MayShift",e.MayTargetTheEndlessDark="MayTargetTheEndlessDark",e.MayUseOtherSpiritPresenceForTargeting="MayUseOtherSpiritPresenceForTargeting",e.MiningLandsCauseRavageActions="MiningLandsCauseRavageActions",e.MoveWithoutWaiting="MoveWithoutWaiting",e.Now="Now",e.OceanIsLandForBlight="OceanIsLandForBlight",e.OceanIsLand="OceanIsLand",e.OnSetupAfterAddingInvaders="OnSetupAfterAddingInvaders",e.OrderOfRemoveAllMightMatter="OrderOfRemoveAllMightMatter",e.OverrideMatchesInvaderCard="OverrideMatchesInvaderCard",e.PermanentHighImmigration="PermanentHighImmigration",e.PowerCostExtraTime="PowerCostExtraTime",e.PowerHasAllThresholds="PowerHasAllThresholds",e.PresenceCountsAsBadlandsOrBeasts="PresenceCountsAsBadlandsOrBeasts",e.PreventAddAnyPresence="PreventAddAnyPresence",e.PreventAddBlightInSetup="PreventAddBlightInSetup",e.PreventAddBlight="PreventAddBlight",e.PreventAddPiece="PreventAddPiece",e.PreventAddPresence="PreventAddPresence",e.PreventAddRemovedBlightToBlightCard="PreventAddRemovedBlightToBlightCard",e.PreventAdversaryActionOnBoard="PreventAdversaryActionOnBoard",e.PreventBlightDestroyingPresence="PreventBlightDestroyingPresence",e.PreventCascade="PreventCascade",e.PreventChangeSpeedOfPower="PreventChangeSpeedOfPower",e.PreventClearDamage="PreventClearDamage",e.PreventDamagingPiece="PreventDamagingPiece",e.PreventDiseasePreventingBuilds="PreventDiseasePreventingBuilds",e.PreventEscalation="PreventEscalation",e.PreventExploreSourceInLand="PreventExploreSourceInLand",e.PreventFearGeneration="PreventFearGeneration",e.PreventForgetPowercard="PreventForgetPowercard",e.PreventGainEnergy="PreventGainEnergy",e.PreventInvaderActionInLand="PreventInvaderActionInLand",e.PreventMovePiece="PreventMovePiece",e.PreventRemovalEffects="PreventRemovalEffects",e.PreventRemoveBlightFromBlightCard="PreventRemoveBlightFromBlightCard",e.PreventRemoveBoard="PreventRemoveBoard",e.PreventRemovePiece="PreventRemovePiece",e.PreventReplacePiece="PreventReplacePiece",e.PreventSlowPowers="PreventSlowPowers",e.PreventTargetLand="PreventTargetLand",e.Reminder="Reminder",e.PreventTargetPiece="PreventTargetPiece",e.PreventTerrorLevelAndResolveFearCards="PreventTerrorLevelAndResolveFearCards",e.RemoveFearBasedVictory="RemoveFearBasedVictory",e.RepeatPowerCard="RepeatPowerCard",e.ShowLossCondition="ShowLossCondition",e.SkipNextBuildCard="SkipNextBuildCard",e.SkipNextExploreCard="SkipNextExploreCard",e.SkipNextRavageCard="SkipNextRavageCard",e.SpiritHasExtraGrowthOptions="SpiritHasExtraGrowthOptions",e.StartOfRavageStep="StartOfRavageStep",e.StartOfSlowPhase="StartOfSlowPhase",e.StartOfSpiritPhase="StartOfSpiritPhase",e.TargetSpirit="TargetSpirit",e.TimePasses="TimePasses",e.TreatAllORsAsANDs="TreatAllORsAsANDs",e.TreatElementAsElement="TreatElementAsElement",e.TreatElementsAsElements="TreatElementsAsElements",e.UpToMustBeUsedAtMaximum="UpToMustBeUsedAtMaximum",e.WhenAddingBlight="WhenAddingBlight",e.WinCondition="WinCondition"}(r||(r={})),function(e){e.Sun="Sun",e.Moon="Moon",e.Fire="Fire",e.Air="Air",e.Water="Water",e.Earth="Earth",e.Plant="Plant",e.Animal="Animal",e.Any="Any",e.SunOrMoon="SunOrMoon",e.WaterOrAnimal="WaterOrAnimal",e.FireOrPlant="FireOrPlant",e.DarkFire="DarkFire"}(i||(i={})),function(e){e.Base="Base",e.BranchAndClaw="BranchAndClaw",e.JaggedEarth="JaggedEarth",e.FeatherAndFlame="FeatherAndFlame",e.HorizonsOfSpiritIsland="HorizonsOfSpiritIsland",e.NatureIncarnate="NatureIncarnate"}(s||(s={})),function(e){e.Unique="Unique",e.Minor="Minor",e.Major="Major",e.Innate="Innate",e.Scenario="Scenario"}(o||(o={})),function(e){e.Fast="Fast",e.Slow="Slow"}(d||(d={})),function(e){e.Land="Land",e.Spirit="Spirit"}(c||(c={})),function(e){e.Beasts="Beasts",e.Blight="Blight",e.BlightAndInvaders="BlightAndInvaders",e.City="City",e.Coastal="Coastal",e.CoastalCity="CoastalCity",e.Dahan="Dahan",e.Deeps="Deeps",e.Disease="Disease",e.Incarna="Incarna",e.IncarnaAndDahan="IncarnaAndDahan",e.IncarnaBehemoth="IncarnaBehemoth",e.IncarnaLair="IncarnaLair",e.IncarnaRoots="IncarnaRoots",e.IncarnaVoice="IncarnaVoice",e.Inland="Inland",e.Invaders="Invaders",e.InvadersAndIncarnaRoots="InvadersAndIncarnaRoots",e.Jungle="Jungle",e.JunglesOrWetlands="JunglesOrWetlands",e.Mountain="Mountain",e.MountainOrJungles="MountainOrJungles",e.NoInvaders="NoInvaders",e.NonBlight="NonBlight",e.NonOceanLand="NonOceanLand",e.NotWetlands="NotWetlands",e.Quake="Quake",e.SacredSite="SacredSite",e.SacredSiteAndDahan="SacredSiteAndDahan",e.Sands="Sands",e.Strife="Strife",e.TheEndlessDark="TheEndlessDark",e.Town="Town",e.TownOrCity="TownOrCity",e.TwoBeasts="TwoBeasts",e.TwoBeastsAndInvaders="TwoBeastsAndInvaders",e.TwoDahan="TwoDahan",e.WardTheShores="WardTheShores",e.Wetlands="Wetlands"}(l||(l={}));const h={name:"Accelerated Rot",type:o.Major,speed:d.Slow,energy:4,elements:[i.Sun,i.Water,i.Plant],set:s.Base,target:c.Land,targetFilter:[l.Jungle,l.Wetlands],range:2,blightWhiteListedPower:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.636,.676],text:"2 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.679,.719],text:"4 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(4)}},{textArea:[.897,.937],text:"If you have 3 <sun> 2 <water> 3 <plant>:<br>+5 Damage.<br>Remove 1 <blight>.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[i.Sun]:3,[i.Water]:2,[i.Plant]:3})&&await e.addSubEffect({effects:[{text:"+5 Damage.",[r.Now]:async()=>{await t.damage(5)}},{text:"Remove 1 <blight>.",[r.Now]:async()=>{await t.removeBlight()}}]})}}]};var g;!function(e){e.Adjacent="Adjacent",e.AnyLands="Any",e.AnyLocations="AnyLocations",e.OnThisBoard="OnThisBoard",e.Remove="Remove",e.RemoveFromGame="RemoveFromGame",e.Time="Time",e.ToAnyOcean="ToAnyOcean",e.ToOneOfYourLands="ToOneOfYourLands",e.ToClosestLegalLand="ToClosestLegalLand",e.ToThisLocation="InThisLocation",e.WithinRange="WithinRange"}(g||(g={}));const f={name:"Blazing Renewal",type:o.Major,speed:d.Fast,energy:5,elements:[i.Fire,i.Earth,i.Plant],set:s.Base,target:c.Spirit,hasDamageInstructions:!0,fullText:["Target Spirit adds 2 of their destroyed <presence> into a single land, up to <range-2> from your <presence>.","If any <presence> was added, 2 Damage to each <town>/<city> in that land.","If you have 3 <fire> 3 <earth> 2 <plant>:<br>4 Damage in that land."],effects:[{textArea:[.598,.717],text:"Target Spirit adds 2 of their destroyed <presence> into a single land, up to <range-2> from your <presence>.",[r.TargetSpirit]:async({$:e,you:a,spirit:t})=>{await e.inLocationsWhere((e=>e.inLandsWithin(2,a).hasOneWhere((e=>e.hasPresenceOf(a))))).pickOne((async n=>{if(t.destroyedPresence>0){const a=await t.addPresence({amount:Math.min(t.destroyedPresence,2),together:!0,locations:g.AnyLands,filter:e=>e===n,range:2,destroyed:!0,autoPlayOneOption:!0});a.length>0&&await e.addSubEffect({textArea:[.676,.802],text:"If any <presence> was added, 2 Damage to each <town>/<city> in that land.",[r.Now]:async()=>{await a[0].location.damageEach(2,e.TownOrCity)}})}await e.addSubEffect({textArea:[.899,.939],text:"If you have 3 <fire> 3 <earth> 2 <plant>:<br>4 Damage in that land.",[r.Now]:async()=>{await a.askToConvertElements({[i.Fire]:3,[i.Earth]:2,[i.Plant]:2})&&await n.damage(4)}})}))}}]},u={name:"Cleansing Floods",type:o.Major,speed:d.Slow,energy:5,elements:[i.Sun,i.Water],set:s.Base,target:c.Land,sourceFilter:[l.Wetlands],range:1,blightWhiteListedPower:!0,hasDamageInstructions:!0,effects:[{textArea:[.636,.676],text:"4 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(4)}},{textArea:[.68,.72],text:"Remove 1 <blight>.",[r.InTargetLand]:async({land:e})=>{await e.removeBlight()}},{textArea:[.899,.939],text:"If you have 4 <water>:<br>+10 Damage.",[r.InTargetLand]:async({you:e,land:a})=>{await e.askToConvertElements({[i.Water]:4})&&await a.damage(10)}}]};var p,w;!function(e){e.Badlands="Badlands",e.Beasts="Beasts",e.Blight="Blight",e.City="City",e.Dahan="Dahan",e.Deeps="Deeps",e.Disease="Disease",e.Explorer="Explorer",e.FlameMarker="FlameMarker",e.HiddenLocation="HiddenLocation",e.IncarnaBehemoth="IncarnaBehemoth",e.IncarnaDarkness="IncarnaDarkness",e.IncarnaLair="IncarnaLair",e.IncarnaLocus="IncarnaLocus",e.IncarnaRoots="IncarnaRoots",e.IncarnaVoice="IncarnaVoice",e.IncarnaWarrior="IncarnaWarrior",e.Omen="Omen",e.Presence="Presence",e.Quake="Quake",e.Strife="Strife",e.Thief="Thief",e.Town="Town",e.Vitality="Vitality",e.WardingPattern="WardingPattern",e.Wilds="Wilds"}(p||(p={})),function(e){e.Exactly="Exactly",e.UpTo="UpTo",e.AtLeast="AtLeast",e.All="All",e.Any="Any",e.UpToMinimumOne="UpToMinimumOne",e.May="May"}(w||(w={}));const y={name:"Dissolve The Bonds Of Kinship",type:o.Major,speed:d.Slow,energy:4,elements:[i.Fire,i.Water,i.Animal],set:s.Base,target:c.Land,range:1,hasPushOrGather:!0,hasDamageInstructions:!0,fullText:["Replace 1 <city> with 2 <explorer>. Replace 1 <town> with 1 <explorer>. Replace 1 <dahan> with 1 <explorer>. Push all <explorer> from target land to as many different lands as possible.","If you have 2 <fire> 2 <water> 3 <animal>:<br>Before Pushing, <explorer> and <town>/<city> do Damage to each other."],effects:[{textArea:[.611,.651],text:"Replace 1 <city> with 2 <explorer>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.replaceOne({pieces:e.City,withAmount:2,withPiece:p.Explorer})}},{textArea:[.611,.683],text:"Replace 1 <town> with 1 <explorer>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.replaceOne({pieces:e.Town,withPiece:p.Explorer})}},{textArea:[.646,.686],text:"Replace 1 <dahan> with 1 <explorer>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.replaceOne({pieces:e.Dahan,withPiece:p.Explorer})}},{textArea:[.858,.937],text:"If you have 2 <fire> 2 <water> 3 <animal>:<br><explorer> and <town>/<city> do Damage to each other.<br>",[r.InTargetLand]:async({$:e,you:a,land:t})=>{if(await a.askToConvertElements({[i.Fire]:2,[i.Water]:2,[i.Animal]:3})){const a=t.piecesThatAre(e.Explorer).sum((e=>e.strengthOutOfRavage)),n=t.piecesThatAre(e.TownOrCity).sum((e=>e.strengthOutOfRavage));await t.damage(a,e.TownOrCity),await t.damage(n,e.Explorer)}}},{textArea:[.646,.752],text:"Push all <explorer> from target land to as many different lands as possible.",[r.InTargetLand]:async({$:e,land:a})=>{await a.push({quantifier:w.All,pieces:e.Explorer,differentLands:!0})}}]};var m;!function(e){e.Another="Another",e.Yourself="Yourself"}(m||(m={}));const v={name:"Entwined Power",type:o.Major,speed:d.Fast,energy:2,elements:[i.Moon,i.Water,i.Plant],set:s.Base,target:c.Spirit,targetFilter:[m.Another],effects:[{textArea:[.607,.682],text:"You and target Spirit may use each other's <presence> to target Powers.",[r.TargetSpirit]:async({$:e,you:a,power:t,spirit:n})=>{n!==a&&await e.addSubEffectUntilEndOfTurn({[r.GlobalReminder]:()=>({power:t.power,players:[a,n]}),[r.MayUseOtherSpiritPresenceForTargeting]:e=>e.spirit===n?a.presence().items:e.spirit===a?n.presence().items:[]})}},{textArea:[.644,.746],text:"Target Spirit gains a Power Card. You gain one of the Power Cards they did not keep.",[r.TargetSpirit]:async({you:e,spirit:a})=>{const{notChosen:t}=await a.gainPowerCard();await e.gainPowerCard({fromSelection:t})}},{textArea:[.861,.936],text:"If you have 4 <water> 2 <plant>:<br>You and target Spirit each gain 3 Energy and may gift the other 1 Power from hand.",[r.TargetSpirit]:async({you:e,spirit:a})=>{await e.askToConvertElements({[i.Water]:2,[i.Plant]:4})&&(await e.gainEnergy(3),await a.gainEnergy(3),a!==e&&(await e.powersWhere((e=>e.isInHand)).optionallyPickOne((async e=>{await a.givePower(e)}),{noOptions:`${e.nameLink} has no Powers in hand to gift.`,prompt:`Gift ${a.nameLink} 1 Power from hand?`,players:[e]}),await a.powersWhere((e=>e.isInHand)).optionallyPickOne((async a=>{await e.givePower(a)}),{noOptions:`${a.nameLink} has no Powers in hand to gift.`,prompt:`Gift ${e.nameLink} 1 Power from hand?`,players:[a]})))}}]},I={name:"Indomitable Claim",type:o.Major,speed:d.Fast,energy:4,elements:[i.Sun,i.Earth],set:s.Base,target:c.Land,range:1,generatesFear:!0,effects:[{textArea:[.594,.722],text:"Add 1 <presence> in target land even if you normally could not due to land type.",[r.InTargetLand]:async({you:e,land:a})=>{await a.addPresence(e,{ignoreLandType:!0})}},{textArea:[.68,.72],text:"Defend 20.",[r.InTargetLand]:async({land:e})=>{await e.defend(20)}},{textArea:[.802,.939],text:"If you have 2 <sun> 3 <earth>:<br>3 <fear> if Invaders are present.<br>Invaders skip all Actions in target land this turn.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[i.Sun]:2,[i.Earth]:3})&&await e.addSubEffect({effects:[{textArea:[.812,.852],text:"3 <fear> if Invaders are present.",[r.Now]:async()=>{t.hasInvaders&&await t.fear(3)}},{textArea:[.855,.937],text:"Invaders skip all Actions in target land this turn.",[r.Now]:async()=>{await t.skipInvaderAction({all:!0})}}]})}}]};var A;!function(e){e.DirectDestroy="DirectDestroy",e.DestroyByDamageOrBlight="DestroyByDamageOrBlight",e.DestroyByHealthChange="DestroyByHealthChange",e.Drown="Drown",e.Remove="Remove",e.Replace="Replace",e.RemoveFromGame="RemoveFromGame",e.Relocate="Relocate",e.Silent="Silent"}(A||(A={}));const x={[A.DirectDestroy]:{verb:"Destroy",textPast:"destroyed",isDestroyLike:!0},[A.DestroyByDamageOrBlight]:{verb:"Destroy",textPast:"destroyed",isDestroyLike:!0},[A.DestroyByHealthChange]:{verb:"Destroy",textPast:"destroyed",isDestroyLike:!0},[A.Drown]:{verb:"Drown",textPast:"drowned",isDestroyLike:!0},[A.Relocate]:{verb:"Relocate",textPast:"relocated",isDestroyLike:!1},[A.Remove]:{verb:"Remove",textPast:"removed",isDestroyLike:!1},[A.RemoveFromGame]:{verb:"Remove from game",textPast:"removed from the game",isDestroyLike:!1},[A.Replace]:{verb:"Replace",textPast:"replaced",isDestroyLike:!1},[A.Silent]:{verb:"Silent",textPast:"replaced",isDestroyLike:!1,skipEvent:!0}},b={name:"Infinite Vitality",type:o.Major,speed:d.Fast,energy:3,elements:[i.Earth,i.Plant,i.Animal],set:s.Base,target:c.Land,sourceFilter:[l.SacredSite],range:1,blightWhiteListedPower:!0,effects:[{textArea:[.611,.651],text:"<dahan> have +4 Health while in target land.",[r.InTargetLand]:async({$:e,land:a,effect:t})=>{a.isLand&&await e.addSubEffectUntilEndOfTurn({[r.AdjustHealth]:({piece:t})=>t.location===a&&t.isA(e.Dahan)?4:0,[r.Reminder]:e=>e===a?t.text:void 0})}},{textArea:[.647,.719],text:"Whenever <blight> would be added to target land, instead leave it on the card.",[r.InTargetLand]:async({$:e,land:a,effect:t})=>{await e.addSubEffectUntilEndOfTurn({[r.Reminder]:e=>e===a?t.text:void 0,[r.PreventAddBlight]:({location:e})=>Promise.resolve(e===a)})}},{textArea:[.827,.934],text:"If you have 4 <earth>:<br><dahan> ignore Damage and Destruction effects. Remove 1 <blight> from target or adjacent land.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[i.Earth]:4})&&await e.addSubEffect({effects:[{textArea:[.828,.899],text:"<dahan> ignore Damage and Destruction effects.",[r.Now]:async({effect:a})=>{t.isLand&&await e.addSubEffectUntilEndOfTurn({[r.PreventDamagingPiece]:({piece:a})=>Promise.resolve(a.location===t&&a.isA(e.Dahan)),[r.PreventRemovePiece]:({piece:a,location:n,removement:r})=>Promise.resolve(a.isA(e.Dahan)&&n===t&&x[r].isDestroyLike),[r.Reminder]:e=>e===t?a.text:void 0})}},{textArea:[.864,.933],text:"Remove 1 <blight> from target or adjacent land.",[r.Now]:async()=>{await t.piecesInThisAndAdjacentLocations().where((a=>a.isA(e.Blight)&&a.location.isLandForBlight)).pickOne((async e=>{await e.location.removeBlight()}),{noOptions:"No <blight> to remove in target or adjacent lands."})}}]})}}]};var T;!function(e){e.AbsorbedPresence="AbsorbedPresence",e.BlightAdded="BlightAdded",e.BlightCardFlipped="BlightCardFlipped",e.BlightRemoved="BlightRemoved",e.BoardRemoved="BoardRemoved",e.Cascade="Cascade",e.DamageCleared="DamageCleared",e.DefendAdded="DefendAdded",e.DoNotParticipateInRavage="DoNotParticipateInRavage",e.DrawEventCard="DrawEventCard",e.EnergyGained="EnergyGained",e.EnergyLost="EnergyLost",e.Error="Error",e.FearAddedToPool="FearAddedToPool",e.FearCardAdded="FearCardAdded",e.FearCardDiscarded="FearCardDiscarded",e.FearCardEarned="FearCardEarned",e.FearCardResolved="FearCardResolved",e.FearEarned="FearEarned",e.FearLost="FearLost",e.GameEnd="GameEnd",e.GenericMain="GenericMain",e.GenericSub="GenericSub",e.Grow="Grow",e.InvaderCardAdded="InvaderCardAdded",e.InvaderCardRemoved="InvaderCardRemoved",e.InvadersBuild="InvadersBuild",e.InvadersExplore="InvadersExplore",e.InvadersRavage="InvadersRavage",e.InvadersRavageInLand="InvadersRavageInLand",e.InvadersRavageInTerrain="InvadersRavageInTerrain",e.InvadersBuildInTerrain="InvadersBuildInTerrain",e.NewTerrorLevel="NewTerrorLevel",e.LandIsolated="LandIsolated",e.Phase="Phase",e.PieceAdded="PieceAdded",e.PieceDamaged="PieceDamaged",e.PieceMoved="PieceMoved",e.PieceRemoved="PieceRemoved",e.PieceReplaced="PieceReplaced",e.PowerCardDiscarded="PowerCardDiscarded",e.PowerCardDrawn="PowerCardDrawn",e.PowerCardForgotten="PowerCardForgotten",e.PowerCardGained="PowerCardGained",e.PowerCardGiven="PowerCardGiven",e.PowerCardImpended="PowerCardImpended",e.PowerCardPlayed="PowerCardPlayed",e.PowerCardReclaimed="PowerCardReclaimed",e.PowerResolvedInLands="PowerResolvedInLand",e.PowerResolvedOnSpirit="PowerResolvedOnSpirit",e.ResolveEventCard="ResolveEventCard",e.RestoringLandToSetupSymbols="RestoringLandToSetupSymbols",e.ScoreFromInnate="ScoreFromInnate",e.ScoreFromPower="ScoreFromPower",e.SetupAdversary="SetupAdversary",e.SetupScenario="SetupScenario",e.SetupSpirit="SetupSpirit",e.SlowHealingBlightAdded="SlowHealingBlightAdded",e.StrifeAdded="StrifeAdded",e.StrifeRemoved="StrifeRemoved",e.TargetedAcrossIslets="TargetedAcrossIslets",e.TimeLost="TimeLost",e.TrackUncovered="TrackUncovered",e.WaveOfImmigration="WaveOfImmigration"}(T||(T={}));const E={name:"Mists Of Oblivion",type:o.Major,speed:d.Slow,energy:4,elements:[i.Moon,i.Air,i.Water],set:s.Base,target:c.Land,range:3,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.61,.703],text:"1 <fear> per <town>/<city> this Power destroys (to a maximum of 4).",[r.InTargetLand]:async({$:e,action:a,land:t})=>{a.data.buildingsDestroyed=0,await e.addEffectUntilEndOfAction({[r.ActionEnds]:async()=>{await e.sendEvent({type:T.GenericMain,text:`<p>MistsOfOblivion</p> destroyed ${a.data.buildingsDestroyed} <town>/<city>.`}),await t.fear(Math.min(a.data.buildingsDestroyed,4))}})}},{textArea:[.705,.745],text:"1 Damage to each Invader.",[r.InTargetLand]:async({$:e,action:a,land:t})=>{const n=await t.damageEach(1);a.data.buildingsDestroyed+=n.filter((a=>x[a.removement].isDestroyLike&&a.piece.isA(e.TownOrCity))).length}},{textArea:[.884,.924],text:"If you have 2 <moon> 3 <air> 2 <water>:<br>3 Damage.",[r.InTargetLand]:async({$:e,you:a,land:t,action:n})=>{if(await a.askToConvertElements({[i.Moon]:2,[i.Air]:3,[i.Water]:2})){const a=await t.damage(3);n.data.buildingsDestroyed+=a.filter((a=>x[a.removement].isDestroyLike&&a.piece.isA(e.TownOrCity))).length}}}]},P={name:"Paralyzing Fright",type:o.Major,speed:d.Fast,energy:4,elements:[i.Air,i.Earth],set:s.Base,target:c.Land,sourceFilter:[l.SacredSite],range:1,generatesFear:!0,effects:[{textArea:[.617,.657],text:"4 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(4)}},{textArea:[.664,.748],text:"Invaders skip all Actions in target land this turn.",[r.InTargetLand]:async({land:e})=>{await e.skipInvaderAction({all:!0})}},{textArea:[.878,.918],text:"If you have 2 <air> 3 <earth>:<br>+4 <fear>.",[r.InTargetLand]:async({you:e,land:a})=>{await e.askToConvertElements({[i.Air]:2,[i.Earth]:3})&&await a.fear(4)}}]},S={name:"Pillar of Living Flame",type:o.Major,speed:d.Slow,energy:5,elements:[i.Fire],set:s.Base,target:c.Land,sourceFilter:[l.SacredSite],range:2,blightWhiteListedPower:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.592,.632],text:"3 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(3)}},{textArea:[.637,.677],text:"5 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(5)}},{textArea:[.709,.815],text:"If target land is <jungles>/<wetlands>, add 1 <blight>.",[r.InTargetLand]:async({land:e})=>{e.isJungleOrWetlands&&await e.addBlight(1)}},{textArea:[.897,.937],text:"If you have 4 <fire>:<br>+2 <fear> and +5 damage.",[r.InTargetLand]:async({land:e,you:a})=>{await a.askToConvertElements({[i.Fire]:4})&&(await e.fear(2),await e.damage(5))}}]},O={name:"Poisoned Land",type:o.Major,speed:d.Slow,energy:3,elements:[i.Earth,i.Plant,i.Animal],set:s.Base,target:c.Land,range:1,blightWhiteListedPower:!0,generatesFear:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{textArea:[.617,.657],text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.661,.701],text:"7 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(7)}},{textArea:[.705,.745],text:"Add 1 <blight> and destroy all <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.addBlight(1),await a.destroyAll(e.Dahan)}},{textArea:[.847,.934],text:"If you have 3 <earth> 2 <plant> 2 <animal>:<br>For each <blight> then present, +1 <fear> and +4 Damage.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[i.Earth]:3,[i.Plant]:2,[i.Animal]:2})&&(await t.fear(t.numberOf(e.Blight)),await t.damage(4*t.numberOf(e.Blight)))}}]};var C=t(813);const D={name:"Powerstorm",type:o.Major,speed:d.Fast,energy:3,elements:[i.Sun,i.Fire,i.Air],set:s.Base,target:c.Spirit,fullText:["Target Spirit gains 3 Energy.","Once this turn, target may Repeat a Power Card by paying its cost again.","If you have 2 <sun> 2 <fire> 3 <air>:<br>Target may Repeat up to 2 more Power Cards by paying their costs."],effects:[{textArea:[.587,.627],text:"Target Spirit gains 3 Energy.",[r.TargetSpirit]:async({spirit:e})=>{await e.gainEnergy(3)}},{textArea:[.636,.762],text:"Once this turn, target may Repeat a Power Card by paying its cost again.",[r.TargetSpirit]:async({$:e,...a})=>{if(a.isRepeat)return;const t=await a.spirit.askToConvertElements({[i.Sun]:2,[i.Fire]:2,[i.Air]:3})?3:1,n=C.sH.box([]);await e.addSubEffectUntilEndOfTurn({textArea:0===n.get().length||1===t?[.636,.762]:[.848,.934],[r.GlobalReminder]:()=>({icon:`Repeat<br>${n.get().length} / ${t}`,players:[a.spirit]}),[r.MayRepeatPowercard]:({power:e,speed:r})=>n.get().length<t&&e.owner===a.spirit&&e.costToPlay<=a.spirit.energy&&e.data.type!==o.Innate&&!n.get().includes(e)&&e.possibleToRepeatAtSpeed(r),[r.RepeatPowerCard]:async({power:a,speed:r})=>{n.get().push(a),n.get().length===t&&e.removeThisEffect(),await a.payForPlay(),await a.replay(r)}})}}]},B={name:"Talons Of Lightning",type:o.Major,speed:d.Fast,energy:6,elements:[i.Fire,i.Air],set:s.Base,target:c.Land,targetFilter:[l.Mountain,l.Wetlands],range:1,generatesFear:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,modifiesRange:({spirit:e,withConvert:a})=>e.hasElements({[i.Fire]:3,[i.Air]:3},a)?2:0,payForRange:async({spirit:e})=>{await e.convertElements({[i.Fire]:3,[i.Air]:3})},effects:[{textArea:[.636,.676],text:"3 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(3)}},{textArea:[.68,.72],text:"5 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(5)}},{textArea:[.848,.888],text:"If you have 3 <fire> 3 <air>:<br>Destroy 1 <town> in each adjacent land. Increase this Power's Range to <range-3>.",[r.InTargetLand]:async({you:e,$:a,land:t,power:n})=>{n.validOriginsGivenTargetLand(t).hasAtLeast(1,(a=>a.landsWithin(1,e,{targetingLands:!0}).includes(t)))&&!await e.askToConvertElements({[i.Fire]:3,[i.Air]:3})||await t.inAdjacentLands().where((e=>e.has(a.Town))).selectOrder().forEach((async e=>{await e.destroyOne(a.Town)}),{noOptions:"No adjacent lands with at <town>."})}}]},k={name:"Terrifying Nightmares",type:o.Major,speed:d.Fast,energy:4,elements:[i.Moon,i.Air],set:s.Base,target:c.Land,range:2,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.636,.676],text:"2 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.68,.72],text:"Push up to 4 <explorer>/<town>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(4,e.ExplorerOrTown)}},{textArea:[.888,.928],text:"If you have 4 <moon>:<br>+4 <fear>.",[r.InTargetLand]:async({you:e,land:a})=>{await e.askToConvertElements({[i.Moon]:4})&&await a.fear(4)}}]},L={name:"The Jungle Hungers",type:o.Major,speed:d.Slow,energy:3,elements:[i.Moon,i.Plant],set:s.Base,target:c.Land,sourceFilter:[l.Jungle],range:1,hasDestroyInstructions:!0,effects:[{textArea:[.636,.676],text:"Destroy all <explorer> and all <town>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.destroyAll(e.ExplorerOrTown)}},{textArea:[.679,.719],text:"Destroy all <dahan>.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[i.Moon]:2,[i.Plant]:3})||await t.destroyAll(e.Dahan)}},{textArea:[.858,.898],text:"If you have 2 <moon> 3 <plant>:<br>Destroy 1 <city>. Do not destroy any <dahan>.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{a.hasElements({[i.Moon]:2,[i.Plant]:3})&&await t.destroyOne(e.City)}}]},F={name:"The Land Thrashes In Furious Pain",type:o.Major,speed:d.Slow,energy:4,elements:[i.Moon,i.Fire,i.Earth],set:s.Base,target:c.Land,targetFilter:[l.Blight],range:2,hasDamageInstructions:!0,effects:[{textArea:[.643,.683],text:"2 Damage per <blight> in target land.",[r.InTargetLand]:async({$:e,land:a})=>{await a.damage(2*a.numberOf(e.Blight))}},{textArea:[.686,.726],text:"+1 Damage per adjacent <blight>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.damage(a.adjacentPiecesInLocationsWhere((a=>a.location.isLandForBlight&&a.isA(e.Blight))).count)}},{textArea:[.877,.917],text:"If you have 3 <moon> 3 <earth>:<br>Repeat on an adjacent land.",[r.InTargetLand]:async({you:e,power:a,isRepeat:t,land:n})=>{!t&&await e.askToConvertElements({[i.Moon]:3,[i.Earth]:3})&&await n.inAdjacentLands().pickOne((async e=>{await a.repeatInLocations([e])}))}}]},R={name:"The Trees And Stones Speak Of War",type:o.Major,speed:d.Fast,energy:2,elements:[i.Sun,i.Earth,i.Plant],set:s.Base,target:c.Land,targetFilter:[l.Dahan],range:1,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{textArea:[.624,.722],text:"For each <dahan> in target land, 1 Damage and Defend 2.",[r.InTargetLand]:async({$:e,land:a})=>{const t=a.numberOf(e.Dahan);await a.damage(t),await a.defend(2*t)}},{textArea:[.851,.94],text:"If you have 2 <sun> 2 <earth> 2 <plant>:<br>You may Push up to 2 <dahan>, moving each one's Defend with them.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{if(await a.askToConvertElements({[i.Sun]:2,[i.Earth]:2,[i.Plant]:2})){const a=await t.pushUpTo(2,e.Dahan);for(const{source:e,destination:t}of a)await e.defend(-2,{singleLand:!1}),await t.defend(2,{singleLand:!1})}}}]},N={name:"Tsunami",type:o.Major,speed:d.Slow,energy:6,elements:[i.Water,i.Earth],set:s.Base,target:c.Land,sourceFilter:[l.SacredSite],targetFilter:[l.Coastal],range:2,generatesFear:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{textArea:[.592,.632],text:"2 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.636,.676],text:"8 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(8)}},{textArea:[.68,.72],text:"Destroy 2 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.destroy({amount:2,pieces:e.Dahan})}},{textArea:[.809,.942],text:"If you have 3 <water> 2 <earth>:<br>In each other Coastal land on the same board: 1 <fear>, 4 Damage, and Destroy 1 <dahan>.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[i.Water]:3,[i.Earth]:2})&&await t.boards().pickOne((a=>a.inCoastalLands().where((e=>e!==t)).selectOrder().forEach((async a=>{await e.addSubEffect({effects:[{textArea:[.854,.894],text:"1 <fear>.",[r.Now]:async()=>{await a.fear(1)}},{textArea:[.854,.894],text:"4 Damage.",[r.Now]:async()=>{await a.damage(4)}},{textArea:[.897,.937],text:"Destroy 1 <dahan>.",[r.Now]:async()=>{await a.destroyOne(e.Dahan)}}]})}))))}}]},$={name:"Vengeance Of The Dead",type:o.Major,speed:d.Fast,energy:3,elements:[i.Moon,i.Fire,i.Animal],set:s.Base,target:c.Land,range:3,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.587,.627],text:"3 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(3)}},{textArea:[.63,.94],text:"After each effect that destroys <town>/<city>/<dahan> in target land, 1 Damage per <town>/<city>/<dahan> destroyed.<br><br>If you have 3 <animal>:<br>Damage from this Power may be dealt into adjacent lands.",[r.InTargetLand]:async({$:e,you:a,land:t,effect:n,...s})=>{const o=await a.askToConvertElements({[i.Animal]:3}),d=e.nextTriggerId(),c={triggerId:d,text:o?"1 Damage per <town>/<city>/<dahan> destroyed.<br><br>If you have 3 <animal>:<br>Damage from this Power may be dealt into adjacent lands.":"1 Damage per <town>/<city>/<dahan> destroyed.",textArea:o?[.706,.94]:[.717,.757],[r.Now]:async({action:e})=>{const a=e.parentData.destroyedCount[d];o?await t.damageInThisAndAdjacentLands(a):await t.damage(a)}};await e.addSubEffectUntilEndOfTurn({[r.Reminder]:e=>e===t?"After each effect that destroys <town>/<city>/<dahan> in target land, 1 Damage per <town>/<city>/<dahan> destroyed."+(o?"<br><br>Damage from this Power may be dealt into adjacent lands.":""):void 0,[r.AfterRemovePiece]:async({location:a,piece:r,removement:i})=>{a===t&&(r.isA(e.TownOrCity)||r.isA(e.Dahan))&&x[i].isDestroyLike&&(void 0===e.action.data.destroyedCount&&(e.action.data.destroyedCount={}),e.action.data.destroyedCount[d]=(e.action.data.destroyedCount[d]??0)+1,await e.addTrigger(c,n,s.action))}})}}]},W=e=>e.filter(((a,t)=>e.indexOf(a)===t)),M={name:"Vigor Of The Breaking Dawn",type:o.Major,speed:d.Fast,energy:3,elements:[i.Sun,i.Animal],set:s.Base,target:c.Land,targetFilter:[l.Dahan],range:2,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{textArea:[.638,.678],text:"2 Damage per <dahan> in target land.",[r.InTargetLand]:async({$:e,land:a})=>{await a.damage(2*a.numberOf(e.Dahan))}},{textArea:[.807,.939],text:"If you have 3 <sun> 2 <animal>:<br>You may Push up to 2 <dahan>. In lands you Pushed <dahan> to, 2 Damage per <dahan>.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{if(await a.askToConvertElements({[i.Sun]:3,[i.Animal]:2})){let a=[];await e.addSubEffect({effects:[{textArea:[.811,.851],text:"You may Push up to 2 <dahan>.",[r.Now]:async()=>{const n=await t.pushUpTo(2,e.Dahan);a=W(n.filter((({piece:a})=>a.isA(e.Dahan))).map((({destination:e})=>e)))}}]}),await e.addSubEffect({effects:[{textArea:[.853,.937],text:"In lands you Pushed <dahan> to, 2 Damage per <dahan>.",[r.Now]:async()=>{for(t of a)await t.damage(2*t.numberOf(e.Dahan))}}]})}}}]},G={name:"Winds Of Rust And Atrophy",type:o.Major,speed:d.Fast,energy:3,elements:[i.Air,i.Water,i.Animal],set:s.Base,target:c.Land,sourceFilter:[l.SacredSite],range:3,generatesFear:!0,effects:[{textArea:[.611,.651],text:"1 <fear> and Defend 6. ",[r.InTargetLand]:async({land:e})=>{await e.fear(1),await e.defend(6)}},{textArea:[.651,.749],text:"Replace 1 <city> with 1 <town> or 1 <town> with 1 <explorer>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.piecesWhere((a=>a.isA(e.TownOrCity))).pickOne((async e=>{await e.downgrade()}))}},{textArea:[.876,.916],text:"If you have 3 <air> 3 <water> 2 <animal>:<br>Repeat this Power.",[r.InTargetLand]:async({you:e,power:a,isRepeat:t})=>{!t&&await e.askToConvertElements({[i.Air]:3,[i.Water]:3,[i.Animal]:2})&&await a.repeat()}}]},H={name:"Wrap In Wings Of Sunlight",type:o.Major,speed:d.Fast,energy:3,elements:[i.Sun,i.Air,i.Animal],set:s.Base,target:c.Land,range:0,hasPushOrGather:!0,fullText:["Move up to 5 <dahan> from target land to any land. Defend 5 in that land.","If you have 2 <sun> 2 <air> 2 <animal>: First, Gather up to 3 <dahan>."],effects:[{textArea:[.88,.92],text:"If you have 2 <sun> 2 <air> 2 <animal>: First, Gather up to 3 <dahan>.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[i.Sun]:2,[i.Air]:2,[i.Animal]:2})&&await t.gatherUpTo(3,e.Dahan)}},{textArea:[.61,.743],text:"Move up to 5 <dahan> from target land to any land. Defend 5 in that land.",[r.InTargetLand]:async({$:e,land:a})=>{const t=await a.move({quantifier:w.UpTo,amount:5,pieces:e.Dahan,locations:{target:g.AnyLands},together:!0});t.length>0&&await t[0].destination.defend(5)}}]},U={name:"Bloodwrack Plague",type:o.Major,speed:d.Fast,energy:4,elements:[i.Water,i.Earth,i.Animal],set:s.BranchAndClaw,target:c.Land,sourceFilter:[l.SacredSite],range:1,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.607,.647],text:"Add 2 <disease>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.add(2,e.Disease)}},{textArea:[.641,.715],text:"For each <disease> in target land, Defend 1 in target and all adjacent lands.",[r.InTargetLand]:async({$:e,land:a})=>{await a.inThisAndAdjacentLands().forEach((async t=>{await t.defend(a.numberOf(e.Disease),{singleLand:!1})}))}},{textArea:[.824,.932],text:"If you have 2 <earth> 4 <animal>:<br>2 <fear>. For each <disease> in target land, do 1 Damage in target or an adjacent land.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[i.Earth]:2,[i.Animal]:4})&&(await t.fear(2),await t.damageInThisAndAdjacentLands(t.numberOf(e.Disease)))}}]};var q;!function(e){e.Bring="Bring",e.Gather="Gather",e.Move="Move",e.Push="Push",e.Relocate="Relocate"}(q||(q={}));const j={name:"Cast Down Into The Briny Deep",type:o.Major,speed:d.Slow,energy:9,elements:[i.Sun,i.Moon,i.Water,i.Earth],set:s.BranchAndClaw,target:c.Land,sourceFilter:[l.SacredSite],targetFilter:[l.Coastal],range:1,blightWhiteListedPower:!0,generatesFear:!0,hasDestroyInstructions:!0,effects:[{textArea:[.607,.647],text:"6 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(6)}},{textArea:[.641,.681],text:"Destroy all Invaders.",[r.InTargetLand]:async({$:e,land:a})=>{a.isLand&&await a.destroyAll(e.Invader)}},{textArea:[.792,.933],text:"If you have 2 <sun> 2 <moon> 4 <water> 4 <earth>:<br>Destroy the board containing target land and everything on that board. All destroyed <blight> is removed from the game instead of being returned to the Blight Card.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[i.Sun]:2,[i.Moon]:2,[i.Water]:4,[i.Earth]:4})&&await t.boards().pickOne((async a=>{for(const t of a.existingLocations){await t.destroyAll(e.AllPieces,{autoPlay:!0});for(const a of e.reminderEffects)void 0!==a[r.Reminder]&&void 0!==a[r.Reminder](t)&&e.removeEffect(a)}await e.oneEffectActivates(r.PreventRemoveBoard),A.DirectDestroy,await a.destroy()}))}}]},J={name:"Death Falls Gently From Open Blossoms",type:o.Major,speed:d.Slow,energy:4,elements:[i.Moon,i.Air,i.Plant],set:s.BranchAndClaw,target:c.Land,targetFilter:[l.Jungle,l.Sands],range:3,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.607,.647],text:"4 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(4)}},{textArea:[.653,.693],text:"If any Invaders remain, add 1 <disease>.",[r.InTargetLand]:async({$:e,land:a})=>{a.hasInvaders&&await a.add(1,e.Disease)}},{textArea:[.811,.939],text:"If you have 3 <air> 3 <plant>:<br>3 <fear>.<br>Add 1 <disease> to 2 adjacent lands with Invaders.",[r.InTargetLand]:async({$:e,land:a,you:t})=>{await t.askToConvertElements({[i.Air]:3,[i.Plant]:3})&&(await a.fear(3),await a.inAdjacentLandsWhere((e=>e.hasInvaders)).pickMultiple({amount:2,forPickedItem:async a=>{await a.add(1,e.Disease)}}))}}]},V={name:"Fire And Flood",type:o.Major,speed:d.Slow,energy:7,elements:[i.Sun,i.Fire,i.Water],set:s.BranchAndClaw,specifyOrigin:!0,target:c.Land,ranges:[1,2],sourceFilter:[l.SacredSite],hasDamageInstructions:!0,fullText:["4 Damage in each target land. (Range must be measured from the same <sacred>.)","If you have 3 <fire>:<br>+4 Damage in either target land.","If you have 3 <water>:<br>+4 Damage in either target land."],effects:[{textArea:[.592,.72],text:"4 Damage in each target land. (Range must be measured from the same <sacred>.)",[r.InTargetLand]:async({$:e,you:a,lands:t})=>{const n=t[0],s=t.length>1?t[1]:null;await e.addSubEffectUntilEndOfTurn({effects:[{text:"4 Damage in each target land.",[r.Now]:async()=>{await n.damage(4),await(s?.damage(4))}},{textArea:[.812,.852],text:"If you have 3 <fire>:<br>+4 Damage in either target land.",[r.Now]:async()=>{await a.askToConvertElements({[i.Fire]:3})&&await e.ofTheseLocations(t).pickOne((async e=>{await e.damage(4)}))}},{textArea:[.897,.937],text:"If you have 3 <water>:<br>+4 Damage in either target land.",[r.Now]:async()=>{await a.askToConvertElements({[i.Water]:3})&&await e.ofTheseLocations(t).pickOne((async e=>{await e.damage(4)}))}}]})}}]},Y={name:"Flow Like Water Reach Like Air",type:o.Major,speed:d.Fast,energy:2,elements:[i.Air,i.Water],set:s.BranchAndClaw,target:c.Spirit,hasPushOrGather:!0,effects:[{textArea:[.6,.64],text:"Target Spirit gets <range+2> with all Powers.",[r.TargetSpirit]:async({$:e,power:a,spirit:t})=>{await e.addSubEffectUntilEndOfTurn({[r.GlobalReminder]:()=>({power:a.power,players:[t]}),[r.ExtraRange]:e=>e.spirit===t?2:0})}},{textArea:[.638,.933],text:"Target Spirit may Push 1 of their <presence> to an adjacent land, bringing up to 2 <explorer>, 2 <town>, and 2 <dahan> along with it.<br><br>If you have 2 <air> 2 <water>:<br>The moved <presence> may also bring along up to 2 <city> and up to 2 <blight>.",[r.TargetSpirit]:async({$:e,you:a,spirit:t})=>{const n=await a.askToConvertElements({[i.Air]:2,[i.Water]:2});await t.inLands().optionallyPickOne((async a=>{const r=await a.push({pieces:e.Presence,owner:t});if(r.length>0){const t=[e.Explorer,e.Town,e.Dahan];n&&t.push(e.City,e.Blight);for(const e of t)await a.move({quantifier:w.UpTo,amount:2,pieces:e,movement:q.Bring,locations:{target:g.ToThisLocation,location:r[0].destination}})}}))}}]},z={name:"Grant Hatred A Ravenous Form",type:o.Major,speed:d.Slow,energy:4,elements:[i.Moon,i.Fire],set:s.BranchAndClaw,target:c.Land,range:1,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.595,.773],text:"For each <strife>/<blight> in target land, 1 <fear> and 2 Damage.<br><br>If this destroys all Invaders in target land, add 1 <beasts>.",[r.InTargetLand]:async({$:e,land:a})=>{const t=a.invaders(),n=t.count>0,r=a.numberOfStrife+a.numberOf(e.Blight);await a.fear(r);const i=await a.damage(2*r);for(const e of i)x[e.removement].isDestroyLike&&t.remove(e.piece);n&&0===t.count&&await a.add(1,e.Beasts)}},{textArea:[.891,.931],text:"If you have 4 <moon> 2 <fire>:<br>Add 1 <strife> in up to 3 adjacent lands.",[r.InTargetLand]:async({you:e,land:a})=>{await e.askToConvertElements({[i.Moon]:4,[i.Fire]:2})&&await a.inAdjacentLands().pickMultiple({amount:3,forPickedItem:async e=>{await e.addStrife(1)},optional:!0,effect:{prompt:"Pick an adjacent land to add <strife>."}})}}]},Q={name:"Insatiable Hunger Of The Swarm",type:o.Major,speed:d.Fast,energy:4,elements:[i.Air,i.Plant,i.Animal],set:s.BranchAndClaw,target:c.Land,sourceFilter:[l.SacredSite],range:2,hasPushOrGather:!0,generatesFear:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{textArea:[.636,.676],text:"Add 1 <blight>.",[r.InTargetLand]:async({land:e})=>{await e.addBlight(1)}},{textArea:[.636,.676],text:"Add 2 <beasts>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.add(2,e.Beasts)}},{textArea:[.636,.676],text:"Gather up to 2 <beasts>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(2,e.Beasts)}},{textArea:[.673,.748],text:"Each <beasts> deal 1 <fear>, 2 Damage to Invaders and 2 Damage to <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{const t=a.numberOf(e.Beasts);await a.fear(t),await a.damage(2*t,e.Invader),await a.damage(2*t,e.Dahan)}},{textArea:[.706,.746],text:"Destroy 1 <beasts>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.destroyOne(e.Beasts)}},{textArea:[.893,.933],text:"If you have 2 <air> 4 <animal>:<br>Repeat this Power on an adjacent land.",[r.InTargetLand]:async({you:e,power:a,land:t,isRepeat:n})=>{!n&&await e.askToConvertElements({[i.Air]:2,[i.Animal]:4})&&await t.inAdjacentLands().pickOne((async e=>{await a.repeatInLocations([e])}))}}]};var K;!function(e){e.Explore="Explore",e.Build="Build",e.Ravage="Ravage"}(K||(K={}));const X={name:"Instruments Of Their Own Ruin",type:o.Major,speed:d.Fast,energy:4,elements:[i.Sun,i.Fire,i.Air,i.Animal],set:s.BranchAndClaw,target:c.Land,sourceFilter:[l.SacredSite],range:1,blightWhiteListedPower:!0,hasDamageInstructions:!0,effects:[{textArea:[.592,.632],text:"Add 1 <strife>.",[r.InTargetLand]:async({land:e})=>{await e.addStrife(1)}},{textArea:[.63,.937],text:"Each Invader with <strife> deals Damage to other Invaders in target land.<br><br>If you have 4 <sun> 2 <fire> 2 <animal>:<br><br>Instead, if Invaders Ravage in target land, they Damage Invaders in adjacent lands instead of <dahan> and the land. <dahan> in target land do not fight back.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{t.isLand&&(await a.askToConvertElements({[i.Sun]:4,[i.Fire]:2,[i.Animal]:2})?(await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({[r.Reminder]:e=>e===t?"If Invaders Ravage in target land, they Damage Invaders in adjacent lands instead of <dahan> and the land. <dahan> in target land do not fight back.":void 0,[r.AlterInvaderActionInLand]:async e=>{if(e.land===t&&e.invaderAction===K.Ravage){let a=t.participatingInvaders().sum((a=>a.strengthDuringRavage+a.adjustedIndividualInvaderRavageDamage({towardsLand:!1,normal:e.normal})));return a>0&&(a+=e.land.sumAdjustedCollectiveInvaderRavageDamage({normal:e.normal,towardsLand:!1}),await t.damageInAdjacentLands(a)),!0}return!1}})):await t.piecesWithStrifeDealsDamageToOtherInvaders())}}]},_={name:"Manifest Incarnation",type:o.Major,speed:d.Slow,energy:6,elements:[i.Sun,i.Moon,i.Earth,i.Animal],set:s.BranchAndClaw,target:c.Land,targetFilter:[l.City],range:0,generatesFear:!0,effects:[{textArea:[.601,.641],text:"6 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(6)}},{textArea:[.643,.713],text:"+1 <fear> for each <town>/<city> and for each of your <presence> in target land.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await t.fear(t.numberOf(e.TownOrCity)+t.numberOfPresenceOf(a))}},{textArea:[.677,.75],text:"Remove 1 <city>, 1 <town> and 1 <explorer>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.remove({amount:1,pieces:e.City}),await a.remove({amount:1,pieces:e.Town}),await a.remove({amount:1,pieces:e.Explorer})}},{textArea:[.71,.75],text:"Then, Invaders in target land Ravage.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[i.Sun]:3,[i.Moon]:3})&&await e.addEffectUntilEndOfAction({text:"Invaders do -6 Damage on their Ravage.",[r.AdjustCollectiveInvaderRavageDamage]:e=>e.land===t?-6:0}),await t.doExtraRavage()}},{textArea:[.853,.893],text:"If you have 3 <sun> 3 <moon>:<br>3 <fear>.<br>Invaders do -6 Damage on their Ravage.",[r.InTargetLand]:async({$:e,you:a})=>{a.hasElements({[i.Sun]:3,[i.Moon]:3})&&await e.fear(3)}}]};var Z;!function(e){e.AllPieces="AllPieces",e.AllPiecesButDahanPresenceAndSpiritTokens="AllPiecesButDahanPresenceAndSpiritTokens",e.Badlands="Badlands",e.BadlandsOrBeasts="BadlandsOrBeasts",e.BadlandsOrDisease="BadlandsOrDisease",e.BadlandsOrStrife="BadlandsOrStrife",e.Beasts="Beasts",e.BeastsDiseaseOrWilds="BeastsDiseaseOrWilds",e.BadlandsBeastsDiseaseOrWilds="BadlandsBeastsDiseaseOrWilds",e.BlightExplorerOrTown="BlightExplorerOrTown",e.Blight="Blight",e.City="City",e.Dahan="Dahan",e.Deeps="Deeps",e.Disease="Disease",e.Explorer="Explorer",e.ExplorerDahanOrBlight="ExplorerDahanOrBlight",e.ExplorerOrDahan="ExplorerOrDahan",e.ExplorerOrTown="ExplorerOrTown",e.ExplorerTownOrDahan="ExplorerTownOrDahan",e.ExplorerTownDahanOrBeasts="ExplorerTownDahanOrBeast",e.FlameMarker="FlameMarker",e.HiddenLocation="HiddenLocation",e.Incarna="Incarna",e.IncarnaBehemoth="IncarnaBehemoth",e.IncarnaDarkness="IncarnaDarkness",e.IncarnaLair="IncarnaLair",e.IncarnaLocus="IncarnaLocus",e.IncarnaRoots="IncarnaRoots",e.IncarnaVoice="IncarnaVoice",e.IncarnaWarrior="IncarnaWarrior",e.Invader="Invader",e.InvaderDahanPresenceOrBeast="InvaderDahanPresenceOrBeast",e.InvaderDahanOrBeast="InvaderDahanOrBeast",e.InvaderOrDahan="InvaderOrDahan",e.Omen="Omen",e.Presence="Presence",e.Quake="Quake",e.Strife="Strife",e.Thief="Thief",e.Town="Town",e.TownCityOrDahan="TownCityOrDahan",e.TownOrCity="TownOrCity",e.TownOrDahan="TownOrDahan",e.TownPresenceOrBeasts="TownPresenceOrBeasts",e.Vitality="Vitality",e.WardingPattern="WardingPattern",e.Wilds="Wilds"}(Z||(Z={}));const ee={[Z.AllPieces]:{name:"Piece",text:"piece",pieces:[p.Badlands,p.Beasts,p.Blight,p.City,p.Dahan,p.Deeps,p.Disease,p.Explorer,p.FlameMarker,p.HiddenLocation,p.IncarnaBehemoth,p.IncarnaDarkness,p.IncarnaLair,p.IncarnaLocus,p.IncarnaRoots,p.IncarnaVoice,p.IncarnaWarrior,p.Omen,p.Presence,p.Quake,p.Strife,p.Thief,p.Town,p.Vitality,p.WardingPattern,p.Wilds],includesInvaders:!0,ignoreCountAs:!0},[Z.AllPiecesButDahanPresenceAndSpiritTokens]:{name:"Piece",text:"piece",pieces:[p.Blight,p.City,p.Explorer,p.FlameMarker,p.HiddenLocation,p.IncarnaBehemoth,p.IncarnaDarkness,p.IncarnaLair,p.IncarnaLocus,p.IncarnaRoots,p.IncarnaVoice,p.IncarnaWarrior,p.Omen,p.Thief,p.Town,p.WardingPattern],includesInvaders:!0,ignoreCountAs:!0},[Z.Incarna]:{name:"Incarna",text:"incarna",pieces:[p.IncarnaBehemoth,p.IncarnaDarkness,p.IncarnaLair,p.IncarnaLocus,p.IncarnaRoots,p.IncarnaVoice,p.IncarnaWarrior],includesInvaders:!1,ignoreCountAs:!0},[Z.BeastsDiseaseOrWilds]:{name:"Beasts, Disease or Wilds",text:"<beasts>/<disease>/<wilds>",pieces:[p.Beasts,p.Disease,p.Wilds],includesInvaders:!1,ignoreCountAs:!1},[Z.BadlandsBeastsDiseaseOrWilds]:{name:"Badlands, Beasts, Disease or Wilds",text:"<badlands>/<beasts>/<disease>/<wilds>/<strife>",pieces:[p.Badlands,p.Beasts,p.Disease,p.Wilds,p.Strife],includesInvaders:!1,ignoreCountAs:!1},[Z.Badlands]:{name:"Badlands",text:"<badlands>",pieces:[p.Badlands],includesInvaders:!1,ignoreCountAs:!1},[Z.BadlandsOrBeasts]:{name:"Badlands or Beasts",text:"<badlands>/<beasts>",pieces:[p.Badlands,p.Beasts],includesInvaders:!1,ignoreCountAs:!1},[Z.BadlandsOrDisease]:{name:"Badlands or Disease",text:"<badlands>/<disease>",pieces:[p.Badlands,p.Disease],includesInvaders:!1,ignoreCountAs:!1},[Z.BadlandsOrStrife]:{name:"Badlands or Strife",text:"<badlands>/<strife>",pieces:[p.Badlands,p.Strife],includesInvaders:!1,ignoreCountAs:!1},[Z.Beasts]:{name:"Beasts",text:"<beasts>",pieces:[p.Beasts],includesInvaders:!1,ignoreCountAs:!1},[Z.Blight]:{name:"Blight",text:"<blight>",pieces:[p.Blight],includesInvaders:!1,ignoreCountAs:!0},[Z.BlightExplorerOrTown]:{name:"Blight, Explorer or Town",text:"<blight>/<explorer>/<town>",pieces:[p.Blight,p.Explorer,p.Town],includesInvaders:!0,ignoreCountAs:!1},[Z.City]:{name:"City",text:"<city>",pieces:[p.City],includesInvaders:!0,ignoreCountAs:!0},[Z.Dahan]:{name:"Dahan",text:"<dahan>",pieces:[p.Dahan],includesInvaders:!1,ignoreCountAs:!0},[Z.Deeps]:{name:"Deeps",text:"<deeps>",pieces:[p.Deeps],includesInvaders:!1,ignoreCountAs:!0},[Z.Disease]:{name:"Disease",text:"<disease>",pieces:[p.Disease],includesInvaders:!1,ignoreCountAs:!0},[Z.Explorer]:{name:"Explorer",text:"<explorer>",pieces:[p.Explorer],includesInvaders:!0,ignoreCountAs:!1},[Z.ExplorerDahanOrBlight]:{name:"Explorer / Dahan / Blight",text:"<explorer>/<dahan>/<blight>",pieces:[p.Explorer,p.Dahan,p.Blight],includesInvaders:!0,ignoreCountAs:!1},[Z.ExplorerOrDahan]:{name:"Explorer / Dahan",text:"<explorer>/<dahan>",pieces:[p.Explorer,p.Dahan],includesInvaders:!0,ignoreCountAs:!1},[Z.ExplorerOrTown]:{name:"Explorer / Town",text:"<explorer>/<town>",pieces:[p.Explorer,p.Town],includesInvaders:!0,ignoreCountAs:!1},[Z.ExplorerTownOrDahan]:{name:"Explorer / Town / Dahan",text:"<explorer>/<town>/<dahan>",pieces:[p.Explorer,p.Town,p.Dahan],includesInvaders:!0,ignoreCountAs:!1},[Z.ExplorerTownDahanOrBeasts]:{name:"Explorer / Town / Dahan / Beasts",text:"<explorer>/<town>/<dahan>/<beasts>",pieces:[p.Explorer,p.Town,p.Dahan,p.Beasts],includesInvaders:!0,ignoreCountAs:!1},[Z.FlameMarker]:{name:"FlameMarker",text:"Flame Marker",pieces:[p.FlameMarker],includesInvaders:!1,ignoreCountAs:!0},[Z.HiddenLocation]:{name:"Hidden Location",text:"Hidden Location",pieces:[p.HiddenLocation],includesInvaders:!1,ignoreCountAs:!0},[Z.IncarnaBehemoth]:{name:"Incarna",text:"<incarna-behemoth>",pieces:[p.IncarnaBehemoth],includesInvaders:!1,ignoreCountAs:!0},[Z.IncarnaDarkness]:{name:"Incarna",text:"<incarna-darkness>",pieces:[p.IncarnaDarkness],includesInvaders:!1,ignoreCountAs:!0},[Z.IncarnaLair]:{name:"Incarna",text:"<incarna-lair>",pieces:[p.IncarnaLair],includesInvaders:!1,ignoreCountAs:!0},[Z.IncarnaLocus]:{name:"Incarna",text:"<incarna-locus>",pieces:[p.IncarnaLocus],includesInvaders:!1,ignoreCountAs:!0},[Z.IncarnaRoots]:{name:"Incarna",text:"<incarna-roots>",pieces:[p.IncarnaRoots],includesInvaders:!1,ignoreCountAs:!0},[Z.IncarnaVoice]:{name:"Incarna",text:"<incarna-voice>",pieces:[p.IncarnaVoice],includesInvaders:!1,ignoreCountAs:!0},[Z.IncarnaWarrior]:{name:"Incarna",text:"<incarna-warrior>",pieces:[p.IncarnaWarrior],includesInvaders:!1,ignoreCountAs:!0},[Z.Invader]:{name:"Invader",text:"Invader",pieces:[p.Explorer,p.Town,p.City],includesInvaders:!0,ignoreCountAs:!1},[Z.InvaderDahanPresenceOrBeast]:{name:"Invader / Dahan / Presence / Beasts",text:"Invader or <dahan>/<presence>/<beasts>",pieces:[p.Explorer,p.Town,p.City,p.Dahan,p.Presence,p.Beasts],includesInvaders:!0,ignoreCountAs:!1},[Z.InvaderDahanOrBeast]:{name:"Invader / Dahan / Beasts",text:"Invader or <dahan>/<beasts>",pieces:[p.Explorer,p.Town,p.City,p.Dahan,p.Beasts],includesInvaders:!0,ignoreCountAs:!1},[Z.InvaderOrDahan]:{name:"Invader / Dahan",text:"Invader or <dahan>",pieces:[p.Explorer,p.Town,p.City,p.Dahan],includesInvaders:!0,ignoreCountAs:!1},[Z.Omen]:{name:"Omen",text:"Omen",pieces:[p.Omen],includesInvaders:!1,ignoreCountAs:!0},[Z.Presence]:{name:"Presence",text:"<presence>",pieces:[p.Presence],includesInvaders:!1,ignoreCountAs:!1},[Z.Quake]:{name:"Quake",text:"<quake>",pieces:[p.Quake],includesInvaders:!1,ignoreCountAs:!0},[Z.Strife]:{name:"Strife",text:"<strife>",pieces:[p.Strife],includesInvaders:!1,ignoreCountAs:!0},[Z.Thief]:{name:"Thief",text:"thief",pieces:[p.Thief],includesInvaders:!1,ignoreCountAs:!0},[Z.Town]:{name:"Town",text:"<town>",pieces:[p.Town],includesInvaders:!0,ignoreCountAs:!0},[Z.TownCityOrDahan]:{name:"Town / City / Dahan",text:"<town>/<city>/<dahan>",pieces:[p.Town,p.City,p.Dahan],includesInvaders:!0,ignoreCountAs:!0},[Z.TownPresenceOrBeasts]:{name:"Town / Presence / Beasts",text:"<town>/<presence>/<beasts>",pieces:[p.Town,p.Presence,p.Beasts],includesInvaders:!0,ignoreCountAs:!1},[Z.TownOrCity]:{name:"Town / City",text:"<town>/<city>",pieces:[p.Town,p.City],includesInvaders:!0,ignoreCountAs:!0},[Z.TownOrDahan]:{name:"Town / Dahan",text:"<town>/<dahan>",pieces:[p.Town,p.Dahan],includesInvaders:!0,ignoreCountAs:!0},[Z.Vitality]:{name:"Vitality",text:"<vitality>",pieces:[p.Vitality],includesInvaders:!1,ignoreCountAs:!0},[Z.WardingPattern]:{name:"Warding Pattern",text:"Warding Pattern",pieces:[p.WardingPattern],includesInvaders:!1,ignoreCountAs:!0},[Z.Wilds]:{name:"Wilds",text:"<wilds>",pieces:[p.Wilds],includesInvaders:!1,ignoreCountAs:!0}},ae=(e,a)=>{const t=a instanceof Function?e.findIndex(a):e.indexOf(a);if(t>-1){const[a]=e.splice(t,1);return a}return null},te=async(e,a)=>{for(let t=0;t<e;t+=1)await a(t)},ne={name:"Pentup Calamity",type:o.Major,speed:d.Fast,energy:3,elements:[i.Moon,i.Fire,i.Earth,i.Plant,i.Animal],set:s.BranchAndClaw,target:c.Land,range:2,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.611,.943],text:"Add 1 <disease> and 1 <strife>.<or>Remove any number of <beasts>/<disease>/<strife>/<wilds>. For each token removed, 1 <fear> and 3 Damage.<br><br>If you have 2 <moon> 3 <fire>:<br>If you have removed tokens, return up to 2 of them. Otherwise, add 2 <strife>.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await e.chooseBetween({effects:[{actionId:"AddDiseaseAndStrife",textArea:[.613,.653],text:"Add 1 <disease> and 1 <strife>.",[r.Now]:async()=>{await t.add(1,e.Disease),await t.addStrife(1),await a.askToConvertElements({[i.Moon]:2,[i.Fire]:3})&&await e.addSubEffect({textArea:[.9,.94],text:"If you have 2 <moon> 3 <fire>:<br>If you have removed tokens, return up to 2 of them. Otherwise, add 2 <strife>.",[r.Now]:async()=>{await t.addStrife(2)}})}},{actionId:"RemoveTokens",textArea:[.68,.762],text:"Remove any number of <beasts>/<disease>/<strife>/<wilds>. For each token removed, 1 <fear> and 3 Damage.",[r.Now]:async()=>{const n=[];for(;;){const a=n.length;if(await t.piecesWhere((a=>a.isA(e.BeastsDiseaseOrWilds)||a.strife>0)).optionallyPickOne((async e=>{if(e.isInvader)await e.removeStrife(),n.push(p.Strife);else{const a=await e.remove();a.length>0&&n.push(a[0].piece.piece)}}),{prompt:`Pick any number of <beasts>/<disease>/<strife>/<wilds>. ${n.length} removed.`}),n.length===a)break}n.length>0&&(await t.fear(n.length),await t.damage(3*n.length),await a.askToConvertElements({[i.Moon]:2,[i.Fire]:3})&&await e.addSubEffect({textArea:[.867,.94],text:"If you have 2 <moon> 3 <fire>:<br>If you have removed tokens, return up to 2 of them. Otherwise, add 2 <strife>.",[r.Now]:async()=>{await te(2,(async a=>{await e.chooseBetween({prompt:`Pick token to return. ${2-a} left.`,effects:n.map((e=>({actionId:e,label:ee[Z[e]].text,[r.Now]:async()=>{ae(n,e),e===p.Strife?await t.addStrife(1):await t.add(1,Z[e])}})))})}))}}))}}]})}}]},re={name:"Pyroclastic Flow",type:o.Major,speed:d.Fast,energy:3,elements:[i.Fire,i.Air,i.Earth],set:s.BranchAndClaw,target:c.Land,sourceFilter:[l.Mountain],range:1,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{textArea:[.602,.642],text:"2 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(2)}},{textArea:[.602,.642],text:"Destroy all <explorer>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.destroyAll(e.Explorer)}},{textArea:[.683,.786],text:"If target land is <jungles-wetlands>, add 1 <blight>.",[r.InTargetLand]:async({land:e})=>{e.isJungleOrWetlands&&await e.addBlight(1)}},{textArea:[.89,.93],text:"If you have 2 <fire> 3 <air> 2 <earth>:<br>+4 Damage. Add 1 <wilds>.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[i.Fire]:2,[i.Air]:3,[i.Earth]:2})&&(await t.damage(4),await t.add(1,e.Wilds))}}]},ie={name:"Savage Transformation",type:o.Major,speed:d.Slow,energy:2,elements:[i.Moon,i.Animal],set:s.BranchAndClaw,target:c.Land,range:1,generatesFear:!0,effects:[{textArea:[.623,.663],text:"2 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.666,.706],text:"Replace 1 <explorer> with 1 <beasts>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.replaceOne({pieces:e.Explorer,withPiece:p.Beasts})}},{textArea:[.841,.936],text:"If you have 2 <moon> 3 <animal>:<br>Replace 1 additional <explorer> with 1 <beasts> in either target or adjacent land.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[i.Moon]:2,[i.Animal]:3})&&await t.inThisAndAdjacentLands().where((a=>a.has(e.Explorer))).pickOne((async a=>{await a.replaceOne({pieces:e.Explorer,withPiece:p.Beasts})}),{noOptions:"No more <explorer> in target or adjacent land."})}}]},se={name:"Smothering Infestation",type:o.Major,speed:d.Slow,energy:3,elements:[i.Water,i.Plant],set:s.BranchAndClaw,target:c.Land,range:0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.602,.642],text:"Add 1 <disease>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Disease)}},{textArea:[.687,.785],text:"If target land is <jungles-wetlands>, 2 <fear> and 3 Damage.",[r.InTargetLand]:async({land:e})=>{e.isJungleOrWetlands&&(await e.fear(2),await e.damage(3))}},{textArea:[.894,.934],text:"If you have 2 <water> 2 <plant>: 1 Damage to each Invader.",[r.InTargetLand]:async({you:e,land:a})=>{await e.askToConvertElements({[i.Water]:2,[i.Plant]:2})&&await a.damageEach(1)}}]},oe={name:"Strangling Firevine",type:o.Major,speed:d.Slow,energy:4,elements:[i.Fire,i.Plant],set:s.BranchAndClaw,target:c.Land,sourceFilter:[l.Sands],range:1,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{textArea:[.607,.647],text:"Destroy all <explorer>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.destroyAll(e.Explorer)}},{textArea:[.64,.68],text:"Add 1 <wilds>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Wilds)}},{textArea:[.676,.716],text:"Add 1 <wilds> in the originating Sands.",[r.InTargetLand]:async({$:e,power:a})=>{await a.validOriginSites.pickOne((async a=>{await a.add(1,e.Wilds)}))}},{textArea:[.71,.75],text:"1 Damage per <wilds> in/adjacent to target land.",[r.InTargetLand]:async({$:e,land:a})=>{await a.damage(a.numberOfPiecesInThisOrAdjacentLands(e.Wilds))}},{textArea:[.86,.934],text:"If you have 2 <fire> 3 <plant>:<br>+1 Damage per <wilds> in/adjacent to target land.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[i.Fire]:2,[i.Plant]:3})&&await t.damage(t.numberOfPiecesInThisOrAdjacentLands(e.Wilds))}}]},de={name:"Sweep Into The Sea",type:o.Major,speed:d.Slow,energy:4,elements:[i.Sun,i.Air,i.Water],set:s.BranchAndClaw,target:c.Land,range:2,hasPushOrGather:!0,hasDestroyInstructions:!0,effects:[{textArea:[.604,.791],text:"Push all <explorer> and <town> one land towards the nearest Ocean.<or>If target land is Coastal, destroy all <explorer> and <town>.",[r.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"Push",textArea:[.607,.679],text:"Push all <explorer> and <town> one land towards the nearest Ocean.",[r.Now]:async()=>{await a.inAdjacentLands().where((e=>e.distanceToNearestOcean<a.distanceToNearestOcean)).pickOne((async t=>{await a.push({quantifier:w.All,pieces:e.ExplorerOrTown,locations:{target:g.ToThisLocation,location:t}})}),{noOptions:"No land is closer to the Ocean than target land."})}},{actionId:"DestroyAll",label:"Destroy all <explorer> and <town>.",textArea:[.707,.784],text:"If target land is Coastal, destroy all <explorer> and <town>.",[r.Now]:async()=>{await a.destroyAll(e.ExplorerOrTown)},condition:()=>a.isCoastal}]})}},{textArea:[.894,.934],text:"If you have 3 <sun> 2 <water>:<br>Repeat on an adjacent land.",[r.InTargetLand]:async({isRepeat:e,you:a,power:t,land:n})=>{!e&&await a.askToConvertElements({[i.Sun]:3,[i.Water]:2})&&await n.inAdjacentLands().pickOne((async e=>{await t.repeatInLocations([e])}))}}]},ce={name:"Tigers Hunting",type:o.Major,speed:d.Fast,energy:2,elements:[i.Sun,i.Moon,i.Animal],set:s.BranchAndClaw,target:c.Land,sourceFilter:[l.Jungle],targetFilter:[l.NonBlight],range:1,hasPushOrGather:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.613,.653],text:"2 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.648,.688],text:"Add 1 <beasts>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Beasts)}},{textArea:[.648,.688],text:"Gather up to 1 <beasts>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(1,e.Beasts)}},{textArea:[.686,.726],text:"1 Damage per <beasts>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.damage(a.numberOf(e.Beasts))}},{textArea:[.686,.726],text:"Push up to 2 <beasts>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(2,e.Beasts)}},{textArea:[.85,.93],text:"If you have 2 <sun> 2 <moon> 3 <animal>:<br>1 Damage in a adjacent land without <blight>, and +1 Damage per <beasts> there.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[i.Sun]:2,[i.Moon]:2,[i.Animal]:3})&&await t.inAdjacentLandsWhere((a=>!a.has(e.Blight))).pickOne((async a=>{await a.damage(1+a.numberOf(e.Beasts))}),{noOptions:"No adjacent land is without <blight>."})}}]},le={name:"Twisted Flowers Murmur Ultimatums",type:o.Major,speed:d.Slow,energy:5,elements:[i.Sun,i.Moon,i.Air,i.Earth,i.Plant],set:s.BranchAndClaw,target:c.Land,sourceFilter:[l.SacredSite],targetFilter:[l.Invaders],range:1,generatesFear:!0,hasDamageInstructions:!0,fullText:["4 <fear>.","Add 1 <strife>.","If the Terror Level is 2 or higher, remove 2 Invaders.","If you have 3 <moon> 2 <air> 3 <plant>:<br>+3 <fear>, before the Terror Level check. 3 Damage."],effects:[{textArea:[.607,.647],text:"4 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(4)}},{textArea:[.643,.683],text:"Add 1 <strife>.",[r.InTargetLand]:async({land:e})=>{await e.addStrife(1)}},{textArea:[.86,.9],text:"If you have 3 <moon> 2 <air> 3 <plant>:<br>+3 <fear>, before the Terror Level check.",[r.InTargetLand]:async({you:e,land:a})=>{await e.askToConvertElements({[i.Moon]:3,[i.Air]:2,[i.Plant]:3})&&await a.fear(3)}},{textArea:[.68,.753],text:"If the Terror Level is 2 or higher, remove 2 Invaders.",[r.InTargetLand]:async({$:e,land:a})=>{e.terrorLevel>=2&&await a.remove({amount:2,pieces:e.Invader})}},{textArea:[.896,.936],text:"If you have 3 <moon> 2 <air> 3 <plant>:<br>3 Damage.",[r.InTargetLand]:async({you:e,land:a})=>{e.hasElements({[i.Moon]:3,[i.Air]:2,[i.Plant]:3})&&await a.damage(3)}}]},he={name:"Unlock The Gates Of Deepest Power",type:o.Major,speed:d.Fast,energy:4,elements:[i.Sun,i.Moon,i.Fire,i.Air,i.Water,i.Earth,i.Plant,i.Animal],set:s.BranchAndClaw,target:c.Spirit,effects:[{textArea:[.595,.705],text:"Target Spirit gains a Major Power by drawing 2 and keeping 1, without having to Forget another Power Card.",[r.TargetSpirit]:async({spirit:e,action:a})=>{a.data.powerGain=await e.gainPowerCard({powerType:o.Major,drawAmount:2,withoutForgetting:!0,forgetOptional:!0})}},{textArea:[.799,.94],text:"If you have 2 <sun> 2 <moon> 2 <fire> 2 <air> 2 <water> 2 <earth> 2 <plant> 2 <animal>:<br>Target Spirit may now play the Major Power they keep by paying half its cost (round up) OR by Forgetting it at the end of turn. It gains all elemental thresholds.",[r.TargetSpirit]:async({$:e,spirit:a,you:t,action:n,power:s})=>{await t.askToConvertElements({[i.Sun]:2,[i.Moon]:2,[i.Fire]:2,[i.Air]:2,[i.Water]:2,[i.Earth]:2,[i.Plant]:2,[i.Animal]:2},{optionalThreshold:!1})&&await a.powersWhere((e=>n.data.powerGain.chosen.includes(e))).autoPickOne((async n=>{let i=!1;await e.chooseBetween({effects:[{actionId:"PayEnergy",textArea:[.832,.872],label:`Pay ${Math.ceil(n.costToPlay/2)} energy.`,[r.Now]:async()=>{await n.play({payHalfRoundUp:!0,withoutUsingCardPlays:!0}),i=!0},condition:()=>a.energy>=Math.ceil(n.costToPlay/2)},{actionId:"ForgetPower",textArea:[.865,.905],text:`Forget ${bd[n.power].name} at the end of turn.`,[r.Now]:async()=>{await n.play({withoutPaying:!0}),await e.addSubEffectUntilEndOfTurn({[r.GlobalReminder]:()=>({power:s.power,players:[t]}),[r.AtTimePassesBegin]:async()=>{await n.forget()}}),i=!0}},{actionId:"Neither",text:"Neither."}]}),i&&await e.addSubEffectUntilEndOfTurn({text:"It gains all elemental thresholds.",[r.GlobalReminder]:()=>({power:n.power,players:[t]}),[r.PowerHasAllThresholds]:e=>e.power===n})}),{prompt:"Pick which Major Power to apply threshold with."})}}]},ge={name:"Unrelenting Growth",type:o.Major,speed:d.Slow,energy:4,elements:[i.Sun,i.Fire,i.Water,i.Plant],set:s.BranchAndClaw,target:c.Spirit,effects:[{textArea:[.604,.7],text:"Target Spirit adds 2 <presence> and 1 <wilds> to a land at <range-1>.",[r.TargetSpirit]:async({$:e,spirit:a,action:t})=>{t.data.addition=await a.addPresenceInRange(1,{together:!0,amount:2}),t.data.addition.length>0&&await t.data.addition[0].location.add(1,e.Wilds)}},{textArea:[.811,.94],text:"If you have 3 <sun> 3 <plant>:<br>In that land, add 1 additional <wilds> and remove 1 <blight>. Target Spirit gains a Power Card.",[r.TargetSpirit]:async({$:e,you:a,action:t,spirit:n})=>{if(await a.askToConvertElements({[i.Sun]:3,[i.Plant]:3})){const a=t.data.addition[0].location;await a.add(1,e.Wilds),await a.removeBlight(),await n.gainPowerCard()}}}]},fe={name:"Volcanic Eruption",type:o.Major,speed:d.Slow,energy:8,elements:[i.Fire,i.Earth],set:s.BranchAndClaw,target:c.Land,sourceFilter:[l.Mountain],range:1,blightWhiteListedPower:!0,generatesFear:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{textArea:[.605,.645],text:"6 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(6)}},{textArea:[.643,.683],text:"20 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(20)}},{textArea:[.64,.717],text:"Destroy all <dahan> and <beasts>.",[r.InTargetLand]:async({$:e,land:a})=>{a.isLand&&(e.dontCountAs(p.Beasts),await a.destroyAll(e.Dahan),await a.destroyAll(e.Beasts))}},{textArea:[.676,.716],text:"Add 1 <blight>.",[r.InTargetLand]:async({land:e})=>{await e.addBlight(1)}},{text:"If you have 4 <fire> 3 <earth>:<br>Destroy all Invaders. Add 1 <wilds>. In each adjacent land: 10 Damage. Destroy all <dahan> and <beasts>. If there are no <blight>, add 1 <blight>.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[i.Fire]:4,[i.Earth]:3})&&await e.addSubEffect({effects:[{textArea:[.827,.867],text:"Destroy all Invaders.",[r.Now]:async()=>{await t.destroyAll(e.Invader)}},{textArea:[.827,.867],text:"Add 1 <wilds>.",[r.Now]:async()=>{await t.add(1,e.Wilds)}},{textArea:[.865,.934],text:"In each adjacent land: 10 Damage. Destroy all <dahan> and <beasts>. If there are no <blight>, add 1 <blight>.",[r.Now]:async()=>{await t.inAdjacentLands().selectOrder().forEach((async a=>{await e.addSubEffect({effects:[{textArea:[.861,.901],text:"10 Damage.",[r.Now]:async()=>{await a.damage(10)}},{textArea:[.861,.934],text:"Destroy all <dahan> and <beasts>.",[r.Now]:async()=>{await a.destroyAll(e.Dahan),await a.destroyAll(e.Beasts)}},{textArea:[.899,.939],text:"If there are no <blight>, add 1 <blight>.",[r.Now]:async()=>{a.has(e.Blight)||await a.addBlight(1)}}]})}))}}]})}}]},ue={name:"Angry Bears",type:o.Major,speed:d.Slow,energy:3,elements:[i.Sun,i.Fire,i.Animal],set:s.JaggedEarth,target:c.Land,range:0,hasPushOrGather:!0,generatesFear:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{textArea:[.597,.637],text:"2 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.597,.637],text:"2 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(2)}},{textArea:[.65,.776],text:"If no <beasts> are present, add 1 <beasts>. Otherwise, +2 Damage, and Push up to 1 <beasts>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.possiblyDontCountPiecesAs(p.Beasts),a.doesntHave(e.Beasts)?await e.addSubEffect({textArea:[.65,.69],text:"Add 1 <beasts>.",[r.Now]:async()=>{await a.add(1,e.Beasts)}}):await e.addSubEffect({textArea:[.69,.775],text:"Otherwise, +2 Damage, and Push up to 1 <beasts>.",[r.Now]:async()=>{await a.damage(2),await a.pushUpTo(1,e.Beasts)}})}},{textArea:[.86,.946],text:"If you have 2 <fire> 3 <animal>:<br>1 <fear> and Destroy 1 <explorer>/<town> in an adjacent land with <beasts>.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[i.Fire]:2,[i.Animal]:3})&&(await t.fear(1),await t.adjacentPiecesInLandsWhere((a=>a.isA(e.ExplorerOrTown)&&a.location.has(e.Beasts))).pickOne((async e=>{await e.destroy()}),{noOptions:"No adjacent land with <explorer>/<town> and <beasts>"}))}}]};var pe;!function(e){e.ProudAndMightCapital="ProudAndMightCapital",e.BuildingBoom="BuildingBoom",e.IndenturedServantsEarnLand="IndenturedServantsEarnLand",e.HighImmigrationI="HighImmigrationI",e.HighImmigrationFull="HighImmigrationFull",e.LocalAutonomy="LocalAutonomy",e.IndependentResolve="IndependentResolve",e.SprawlingPlantation="SprawlingPlantation",e.DemandForNewCashCrops="DemandForNewCashCrops",e.FrontierExplorers="FrontierExplorers",e.SlaveLabor="SlaveLabor",e.TriangleTrade="TriangleTrade",e.SlowHealingEcosystem="SlowHealingEcosystem",e.PersistentExplorers="PersistentExplorers",e.IrreparableDamage="IrreparableDamage",e.SeekPrimeTerritory="SeekPrimeTerritory",e.MigratoryHerders="MigratoryHerders",e.MoreRuralThanUrban="MoreRuralThanUrban",e.HerdsThriveInVerdantLands="HerdsThriveInVerdantLands",e.WaveOfImmigration="WaveOfImmigration",e.FarFlungHerds="FarFlungHerds",e.LandRush="LandRush",e.HuntersSwarmTheIsland="HuntersSwarmTheIsland",e.StalkThePredators="StalkThePredators",e.HuntersSeekShellAndHide="HuntersSeekShellAndHide",e.ASenseForImpendingDisaster="ASenseForImpendingDisaster",e.CompetitionAmongHunters="CompetitionAmongHunters",e.PressureForFastProfit="PressureForFastProfit",e.LandStrippedBare="LandStrippedBare",e.MiningTunnels="MiningTunnels",e.AvariceRewarded="AvariceRewarded",e.CeaselessMining="CeaselessMining",e.MiningBoomI="MiningBoom",e.UntappedSaltDeposits="UntappedSaltDeposits",e.MiningBoomII="MiningBoomII",e.TheEmpireAscendant="TheEmpireAscendant",e.TradeHub="TradeHub",e.PortsSprawlOutward="PortsSprawlOutward",e.TradingPort="TradingPort",e.ChartTheCoastline="ChartTheCoastline",e.RunoffAndBilgewater="RunoffAndBilgewater",e.ExportsFuelInwardGrowth="ExportsFuelInwardGrowth",e.SwayedByTheInvaders="SwayedByTheInvaders",e.HeavyMining="HeavyMining",e.FineSteelForToolsAndGuns="FineSteelForToolsAndGuns",e.RoyalBacking="RoyalBacking",e.MiningRush="MiningRush",e.ShadowsPartake="ShadowsPartake",e.Immense="Immense",e.Travel="Travel",e.Madness="Madness",e.Reach="Reach",e.Resilience="Resilience",e.DarkFire="DarkFire",e.Encircle="Encircle",e.Intensify="Intensify",e.Lair="Lair",e.Locus="Locus",e.Mentor="Mentor",e.Nourishing="Nourishing",e.Regrowth="Regrowth",e.SpreadingHostility="SpreadingHostility",e.Stranded="Stranded",e.Tactician="Tactician",e.Transforming="Transforming",e.Unconstrained="Unconstrained",e.Violence="Violence",e.Warrior="Warrior",e.DownwardSpiral="DownwardSpiral",e.MemoryFadesToDust="MemoryFadesToDust",e.BackAgainstTheWall="BackAgainstTheWall",e.AllThingsWeaken="AllThingsWeaken",e.PowerCorrodesTheSpirit="PowerCorrodesTheSpirit",e.UntendedLandCrumbles="UntendedLandCrumbles",e.AttenuatedEssence="AttenuatedEssence",e.BlightCorrodesTheSpirit="BlightCorrodesTheSpirit",e.IntensifyingExploitation="IntensifyingExploitation",e.TheBorderOfLifeAndDeath="TheBorderOfLifeAndDeath",e.DistantExploration="DistantExploration",e.FearfulMobs="FearfulMobs",e.SpurnTheInvaders="SpurnTheInvaders",e.TeachTheInvaders="TeachTheInvaders",e.HeavyFarming="HeavyFarming",e.IncreasingAggression="IncreasingAggression",e.DestroyTheUnnatural="DestroyTheUnnatural",e.CurseTheTongues="CurseTheTongues",e.PromisingFarmland="PromisingFarmland",e.WeaveLies="WeaveLies",e.StrangeTalesAttractExplorers="StrangeTalesAttractExplorers",e.Fortification="Fortification",e.TightknitCommunities="TightknitCommunities",e.UrbanDevelopment="UrbanDevelopment",e.WaveOfReconnaissance="WaveOfReconnaissance",e.WellpreparedExplorers="WellpreparedExplorers",e.YearsOfLittleRain="YearsOfLittleRain",e.BureaucratsAdjustFunding="BureaucratsAdjustFunding",e.RansackAndRun="RansackAndRun",e.DepletedSoil="DepletedSoil",e.CivicEngagement="CivicEngagement",e.CooperationAmongTowns="CooperationAmongTowns",e.IgnoreTheirInterest="IgnoreTheirInterest",e.ChangeAndHelp="ChangeAndHelp",e.EagerExplorers="EagerExplorers",e.Xenophobia="Xenophobia",e.Fortuneseekers="Fortuneseekers",e.TheLandsBountyExhausted="TheLandsBountyExhausted",e.CreateUnnervingDistractions="CreateUnnervingDistractions",e.BeastsPreyOnTheInjured="BeastsPreyOnTheInjured",e.CoordinatedStrikes="CoordinatedStrikes",e.InvestedAristocracy="InvestedAristocracy",e.ForeignDignitariesVisit="ForeignDignitariesVisit",e.LetDestructionHaveItsDay="LetDestructionHaveItsDay",e.FortifyTheResilienceOfLife="FortifyTheResilienceOfLife",e.MapmakersChartTheWild="MapmakersChartTheWild",e.NoBraveryWithoutNumbers="NoBraveryWithoutNumbers",e.CourageOfTheCrowd="CourageOfTheCrowd",e.TerrorBreedsAggression="TerrorBreedsAggression",e.PullTogetherInAdversity="PullTogetherInAdversity",e.RelentlessOptimism="RelentlessOptimism",e.LeaveItsStrength="LeaveItsStrength",e.CraftAGreatWardingUntilEndOfTurn="CraftAGreatWardingUntilEndOfTurn",e.CraftAGreatWardingOngoing="CraftAGreatWardingOngoing",e.ResourcefulPopulace="ResourcefulPopulace",e.StripTheLandBare="StripTheLandBare",e.VoraciousConsumption="VoraciousConsumption",e.EngageOnTheirOwnTerms="EngageOnTheirOwnTerms",e.FocusYourWill="FocusYourWill",e.LayAmbushes="LayAmbushes",e.TemporaryTruce="TemporaryTruce",e.TemporaryCaution="TemporaryCaution",e.TheFrontierCalls="TheFrontierCalls",e.SelfSacrificeBuysTime="SelfSacrificeBuysTime",e.AccumulatedDevastation="AccumulatedDevastation",e.InfluxOfSettlers="InfluxOfSettlers",e.NetworkOfSupportAndTrade="NetworkOfSupportAndTrade",e.WidespreadHunting="WidespreadHunting",e.FinalHarvest="FinalHarvest",e.HeadOffTheProblems="HeadOffTheProblems",e.StrengthFromTrade="StrengthFromTrade",e.CannyDefense="CannyDefense",e.CarefulDefense="CarefulDefense",e.CoordinatedDefense="CoordinatedDefense",e.IrregularOutbreaks="IrregularOutbreaks",e.LingeringPlagues="LingeringPlagues",e.Stricken="Stricken",e.AvoidTheDahanI="AvoidTheDahanI",e.AvoidTheDahanII="AvoidTheDahanII",e.AvoidTheDahanIII="AvoidTheDahanIII",e.BeliefTakesRootI="BeliefTakesRootI",e.BeliefTakesRootII="BeliefTakesRootII",e.DahanOnTheirGuardI="DahanOnTheirGuardI",e.DahanOnTheirGuardII="DahanOnTheirGuardII",e.DahanOnTheirGuardIII="DahanOnTheirGuardIII",e.OverseasTradeSeemSaferI="OverseasTradeSeemSaferI",e.OverseasTradeSeemSaferII="OverseasTradeSeemSaferII",e.OverseasTradeSeemSaferIII="OverseasTradeSeemSaferIII",e.TradeSuffersI="TradeSuffersI",e.DemoralizedI="DemoralizedI",e.DemoralizedII="DemoralizedII",e.DemoralizedIII="DemoralizedIII",e.ExplorersAreReluctantI="ExplorersAreReluctantI",e.ExplorersAreReluctantII="ExplorersAreReluctantII",e.ExplorersAreReluctantIII="ExplorersAreReluctantIII",e.ImmigrationSlowsI="ImmigrationSlowsI",e.ImmigrationSlowsII="ImmigrationSlowsII",e.ImmigrationSlowsIII="ImmigrationSlowsIII",e.PanickedByWildBeastsII="PanickedByWildBeastsII",e.PanickedByWildBeastsIII="PanickedByWildBeastsIII",e.PlanForDepartureII="PlanForDepartureII",e.PlanForDepartureIII="PlanForDepartureIII",e.QuarantineI="QuarantineI",e.QuarantineII="QuarantineII",e.QuarantineIII="QuarantineIII",e.CommunitiesInDisarrayI="CommunitiesInDisarrayI",e.CommunitiesInDisarrayII="CommunitiesInDisarrayII",e.CommunitiesInDisarrayIII="CommunitiesInDisarrayIII",e.BesetByManyTroublesI="BesetByManyTroublesI",e.BesetByManyTroublesII="BesetByManyTroublesII",e.BesetByManyTroublesIII="BesetByManyTroublesIII",e.DauntedByTheDahan="DauntedByTheDahan",e.DistractedByLocalTroublesII="DistractedByLocalTroublesII",e.DistractedByLocalTroublesIII="DistractedByLocalTroublesIII",e.RoilingWaters="RoilingWaters",e.SereneWaters="SereneWaters",e.DreamOfTheUntouchedLand="DreamOfTheUntouchedLand",e.DreamOfTheUntouchedLandSkipBoard="DreamOfTheUntouchedLandSkipBoard",e.BargainsOfPowerAndProtection="BargainsOfPowerAndProtection",e.BargainsOfCoursingPath="BargainsOfCoursingPath",e.Blitz="Blitz",e.DahanInsurrection="DahanInsurrection",e.GuardTheIslesHeart="GuardTheIslesHeart",e.RitualsOfTerror="RitualsOfTerror",e.BronzeLoopSpirit="BronzeLoopSpirit",e.BronzeLoopInvader="BronzeLoopInvader",e.GlowingEmberInvader="GlowingEmberInvader",e.GlowingEmberSpirit="GlowingEmberSpirit",e.JaggedTooth="JaggedTooth",e.LizardsScale="LizardsScale",e.RibBone="RibBone",e.WindWovenRope="WindWovenRope",e.JaggedToothInvader="JaggedToothInvader",e.JaggedToothSpirit="JaggedToothSpirit",e.LizardsScaleInvader="LizardsScaleInvader",e.LizardScaleSpirit="LizardScaleSpirit",e.RibBoneInvader="RibBoneInvader",e.RibBoneSpirit="RibBoneSpirit",e.WindWovenRopeInvader="WindWovenRopeInvader",e.WindWovenRopeSpirit="WindWovenRopeSpirit",e.PowersLongForgotten="PowersLongForgotten",e.RitualsOfTheDestroyingFlame="RitualsOfTheDestroyingFlame",e.SecondWave="SecondWave",e.WardTheShores="WardTheShores",e.ADiversityOfSpirits="ADiversityOfSpirits",e.VariedTerrain="VariedTerrain",e.DespicableTheft="DespicableTheft",e.ElementalInvocation="ElementalInvocation",e.TheGreatRiver="TheGreatRiver",e.DestinyUnfold="DestinyUnfold",e.SurgesOfColonization="SurgesOfColonization",e.Bringer="Bringer",e.Earth="Earth",e.GreenChokeTheLandWithGreen="GreenChokeTheLandWithGreen",e.GreenSteadyRegeneration="GreenSteadyRegeneration",e.Lightning="Lightning",e.Ocean="Ocean",e.River="River",e.Shadows="Shadows",e.Thunderspeaker="Thunderspeaker",e.FangsAllyOfTheBeasts="Fangs",e.FangsCallForthPredators="FangsCallForthPredators",e.Keeper="Keeper",e.Downpour="Downpour",e.Finder="Finder",e.Serpent="Serpent",e.Wildfire="Wildfire",e.Eyes="Eyes",e.Heat="Heat",e.Mud="Mud",e.Teeth="Teeth",e.Whirlwind="Whirlwind",e.Fractured="Fractured",e.LureHomeOfTheIslandsHeart="LureHomeOfTheIslandsHeart",e.LureEnthrallTheForeignExplorers="LureEnthrallTheForeignExplorers",e.ManyMinds="ManyMinds",e.MemoryKnowledge="Memory",e.MemoryInsight="MemoryInsight",e.ShroudGatherPowerFromTheCoolAndDark="ShroudGatherPowerFromTheCoolAndDark",e.ShroudMistsShiftAndFlow="ShroudMistsShiftAndFlow",e.SlowAndSilentDeath="SlowAndSilentDeath",e.Starlight="Starlight",e.Stone="Stone",e.Trickster="Trickster",e.Vengeance="Vengeance",e.Volcano="Volcano",e.Behemoth="Behemoth",e.Darkness="Darkness",e.Earthquakes="Earthquakes",e.Gaze="Gaze",e.HearthVigil="HearthVigil",e.Roots="Roots",e.Voice="Voice",e.WoundedSeekingAPathTowardsHealing="WoundedSeekingAPathTowardsHealing",e.Downgrade="Downgrade"}(pe||(pe={}));const we={name:"Bargains Of Power And Protection",type:o.Major,speed:d.Fast,energy:2,elements:[i.Sun,i.Water,i.Earth,i.Animal],set:s.JaggedEarth,target:c.Land,targetFilter:[l.Dahan],range:0,fullText:["Remove 1 of your <presence> on the island from the game, setting it on the Reminder Card.","From now on: Each <dahan> within <range-1> of your <presence> provides Defend 1 in its land, and you gain 1 less Energy each turn. (This effect stacks if used multiple times.)","If you have 3 <sun> 2 <water> 2 <earth>:<br>The <presence> instead comes from your <presence> track."],effects:[{text:"Remove 1 of your <presence> on the island from the game.",[r.InTargetLand]:async({$:e,you:a})=>{a.unlockedTrackPresence.length>0&&await a.askToConvertElements({[i.Sun]:3,[i.Water]:2,[i.Earth]:2})?await e.addSubEffect({textArea:[.911,.951],text:"If you have 3 <sun> 2 <water> 2 <earth>:<br>The <presence> instead comes from your <presence> track.",[r.Now]:async()=>{await a.addPresence({locations:g.RemoveFromGame})}}):await e.addSubEffect({textArea:[.592,.664],text:"Remove 1 of your <presence> on the island from the game.",[r.Now]:async()=>{await a.destroyPresence(1,A.RemoveFromGame)}})}},{textArea:[.667,.815],text:"From now on: Each <dahan> within <range-1> of your <presence> provides Defend 1 in its land, and you gain 1 less Energy each turn. (This effect stacks if used multiple times.)",[r.InTargetLand]:async({$:e,power:a,you:t})=>{let n=!1;await e.addSubEffect({effectId:pe.BargainsOfPowerAndProtection,[r.GlobalReminder]:()=>({power:a.power,players:[t]}),[r.DefendFromSpirits]:({land:e})=>e.numberOfParticipatingDahan>0&&e.inLandsWithin(1,t).hasOneWhere((e=>e.hasPresenceOf(t)))?e.numberOfParticipatingDahan:0,[r.EnergyDebt]:({spirit:e})=>e!==t||n?0:1,[r.PreventGainEnergy]:async({spirit:a})=>!n&&a===t&&(n=!0,await e.sendEvent({type:T.GenericMain,text:`${t.nameLink} gained 1 less Energy from <p>BargainsOfPowerAndProtection</p>.`}),!0),[r.TimePasses]:()=>(n=!1,Promise.resolve())})}}]};var ye;!function(e){e.Minor="Minor",e.Major="Major",e.Unique="Unique",e.Innate="Innate",e.NonMinorCard="NonMinorCard",e.NonMajorCard="NonMajorCard",e.NonUniqueCard="NonUniqueCard",e.AnyCard="AnyCard",e.Any="Any"}(ye||(ye={}));const me={name:"Draw Towards A Consuming Void",type:o.Major,speed:d.Slow,energy:8,elements:[],set:s.JaggedEarth,target:c.Land,range:0,hasPushOrGather:!0,generatesFear:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{textArea:[.607,.682],text:"Gather 1 <explorer>, <town>, <city>, <dahan>, <beasts>, and 1 <presence> (from any Spirit) from each adjacent land.",[r.InTargetLand]:({$:e,land:a})=>a.inAdjacentLands().forEach((async t=>{for(const n of[e.Explorer,e.Town,e.City,e.Dahan,e.Beasts,e.Presence])await a.gather({amount:1,pieces:n,filter:e=>e===t,pickPiecesEffect:{autoPlayOneOption:!0}})}))},{textArea:[.687,.727],text:"4 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(4)}},{textArea:[.687,.727],text:"15 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(15)}},{textArea:[.687,.727],text:"5 Damage to <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.damage(5,e.Dahan)}},{textArea:[.722,.762],text:"Destroy 1 <presence> from each Spirit.",[r.InTargetLand]:async({$:e,land:a})=>{await e.eachSpirit((async t=>{await a.destroy({amount:1,pieces:e.Presence,owner:t})}))}},{textArea:[.722,.762],text:"Remove 2 <beasts>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.destroy({amount:2,pieces:e.Beasts})}},{textArea:[.831,.94],text:"If you have no other power cards in play: Any number of times: Forget a Minor Power, a Major Power, and a Unique Power to perform the above effects again.",[r.InTargetLand]:async({$:e,power:a,you:t,land:n})=>{1===t.powerCardsInPlayNotBlessed.length&&t.hasAtLeastNonBlessed(1,ye.Minor)&&t.hasAtLeastNonBlessed(1,ye.Major)&&t.hasAtLeastNonBlessed(1,ye.Unique)&&await e.may({prompt:"Forget a Minor Power, a Major Power, and a Unique Power to perform the above effects again?"})&&(await t.forgetPowers({powerFilter:ye.Minor}),await t.forgetPowers({powerFilter:ye.Major}),await t.forgetPowers({powerFilter:ye.Unique}),await t.resolvePowerInLocations(a,[n],!1,!0))}}]},ve={name:"Dream Of The Untouched Land",type:o.Major,speed:d.Fast,energy:6,elements:[i.Moon,i.Water,i.Earth,i.Plant,i.Animal],set:s.JaggedEarth,target:c.Land,sourceFilter:[l.SacredSite],range:1,blightWhiteListedPower:!0,effects:[{textArea:[.584,.663],text:"Remove up to 3 <blight> and up to 3 Health worth of Invaders.",[r.InTargetLand]:async({land:e})=>{await e.removeBlight({amount:3,quantifier:w.UpTo}),await e.removeInvadersWorthOfHealthUpTo(3)}},{textArea:[.736,.94],text:'If you have 3 <moon> 2 <water> 3 <earth> 2 <plant>:<br>(Max. 1x/game) Add a random new Island Board next to target board. Ignore its Setup icons; add 2 <beasts>, 2 <wilds>, 2 <badlands> and up to 2 <presence> (from any Spirits) anywhere on it. From now on, Build Cards and "Each board/Each land" Adversary Actions skip 1 board.',[r.InTargetLand]:async({$:e,you:a,power:t,land:n})=>{e.hasEffectNamed("Dream Of The Untouched Land")||await a.askToConvertElements({[i.Moon]:3,[i.Water]:2,[i.Earth]:3,[i.Plant]:2})&&await n.boards().pickOne((async a=>{const n=await a.addRandomBoard();null!==n&&await e.addSubEffect({effects:[{[r.Now]:async()=>{for(const a of[e.Beasts,e.Wilds,e.Badlands])await n.inLands().pickMultiple({amount:2,effect:{textArea:[.802,.876],text:`Add 2 ${ee[a].text} anywhere on it.`},forPickedItem:async e=>{await e.add(1,a)},repeatSame:!0})}},{textArea:[.802,.876],text:"Add up to 2 <presence> anywhere on it.",[r.Now]:async()=>{await e.fromAllSpirits().pickMultiple({amount:2,forPickedItem:async e=>{await n.addPresence(e)},effect:{autoPlayOneOption:!0},repeatSame:!0})}},{textArea:[.87,.942],text:'From now on, Build Cards and "Each board/Each land" Adversary Actions skip 1 board.',[r.Now]:async()=>{await e.clickToContinue(),await e.addSubEffect({effectId:pe.DreamOfTheUntouchedLand,[r.GlobalReminder]:()=>({power:t.power}),[r.BeforeResolvingInvaderCard]:async({invaderAction:a})=>{a===K.Build&&await e.inBoards().pickOne((async a=>(await e.addSubEffectUntilEndOfTurn({name:"Skip Board",effectId:pe.DreamOfTheUntouchedLandSkipBoard,[r.OverrideMatchesInvaderCard]:e=>!e.land.boards().has(a)&&void 0}),Promise.resolve())),{text:`From now on, Build Cards and "Each board/Each land" Adversary Actions skip 1 board.<br><br>Choose a Board to skip the following effect:<br><br>${e.parentEffect?.text}`})},[r.AfterResolvingBuildCard]:()=>(e.removeEffectsWithId(pe.DreamOfTheUntouchedLandSkipBoard),Promise.resolve()),[r.BeforeAdversaryActionsOnEachBoard]:async()=>{await e.inBoards().pickOne((async a=>(await e.addSubEffectUntilEndOfTurn({effectId:pe.DreamOfTheUntouchedLandSkipBoard,name:"Skip Board",[r.PreventAdversaryActionOnBoard]:e=>e.board===a}),Promise.resolve())),{text:`From now on, Build Cards and "Each board/Each land" Adversary Actions skip 1 board.<br><br>Choose a Board to skip the following effect:<br><br>${e.parentEffect?.text}`})},[r.AfterAdversaryActionsOnEachBoard]:()=>(e.removeEffectsWithId(pe.DreamOfTheUntouchedLandSkipBoard),Promise.resolve())})}}]})}))}}]},Ie={name:"Focus The Land's Anguish",type:o.Major,speed:d.Slow,energy:5,elements:[i.Sun],set:s.JaggedEarth,target:c.Land,range:1,hasPushOrGather:!0,blightWhiteListedPower:!0,generatesFear:!0,hasDamageInstructions:!0,fullText:["If this Power Destroys any <town>/<city>, 5 <fear>.","Gather up to 5 <blight>. 1 Damage per <blight>.","If you have 3 <sun>:<br>+1 Damage per <blight>."],effects:[{textArea:[.697,.779],text:"Gather up to 5 <blight>. 1 Damage per <blight>.",[r.InTargetLand]:async({$:e,land:a,action:t})=>{await a.gatherUpTo(5,e.Blight);const n=await a.damage(a.numberOf(e.Blight));t.data.destroyedBuilding=n.some((a=>x[a.removement].isDestroyLike&&a.piece.isA(e.TownOrCity)))}},{textArea:[.894,.934],text:"If you have 3 <sun>:<br>+1 Damage per <blight>.",[r.InTargetLand]:async({$:e,you:a,land:t,action:n})=>{if(await a.askToConvertElements({[i.Sun]:3})){const a=await t.damage(t.numberOf(e.Blight));n.data.destroyedBuilding=n.data.destroyedBuilding||a.some((a=>x[a.removement].isDestroyLike&&a.piece.isA(e.TownOrCity)))}}},{textArea:[.613,.699],text:"If this Power Destroyed any <town>/<city>, 5 <fear>.",[r.InTargetLand]:async({land:e,action:a})=>{a.data.destroyedBuilding&&await e.fear(5)}}]},Ae={name:"Forests Of Living Obsidian",type:o.Major,speed:d.Slow,energy:4,elements:[i.Sun,i.Fire,i.Earth,i.Plant],set:s.JaggedEarth,target:c.Land,range:0,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{textArea:[.598,.638],text:"Add 1 <badlands>.",[r.InTargetLand]:async({$:e,land:a,action:t,power:n})=>{t.data.validOrigins=n.validOriginsGivenTargetLand(a),await a.add(1,e.Badlands)}},{textArea:[.598,.638],text:"Push all <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushAll(e.Dahan)}},{textArea:[.657,.697],text:"1 Damage to each Invader.",[r.InTargetLand]:async({land:e})=>{await e.damageEach(1)}},{textArea:[.702,.782],text:"If the origin land is your <sacred>, +1 Damage to each Invader.",[r.InTargetLand]:async({you:e,land:a,action:t})=>{t.data.validOrigins.hasOneWhere((a=>a.hasSacredSiteOf(e)))&&await a.damageEach(1)}},{textArea:[.89,.93],text:"If you have 2 <sun> 3 <fire> 3 <earth>:<br>Repeat this Power.",[r.InTargetLand]:async({isRepeat:e,you:a,power:t})=>{!e&&await a.askToConvertElements({[i.Sun]:2,[i.Fire]:3,[i.Earth]:3})&&await t.repeat()}}]},xe={name:"Infestation Of Venomous Spiders",type:o.Major,speed:d.Fast,energy:4,elements:[i.Air,i.Earth,i.Plant,i.Animal],set:s.JaggedEarth,target:c.Land,sourceFilter:[l.SacredSite],targetFilter:[l.Invaders],range:2,hasPushOrGather:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.607,.647],text:"Add 1 <beasts>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Beasts)}},{textArea:[.607,.647],text:"Gather up to 1 <beasts>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(1,e.Beasts)}},{textArea:[.666,.939],text:"For each <beasts>, 1 <fear> (max. 4) and Invaders skip one Action in target land.<br><br>If you have 2 <air> 2 <earth> 3 <animal>:<br>After this Power causes Invaders to skip an Action, 4 Damage.",[r.InTargetLand]:async({$:e,you:a,land:t,effect:n,action:s})=>{const o=Math.min(t.numberOf(e.Beasts),4);await t.fear(o);const d={textArea:[.86,.939],text:"If you have 2 <air> 2 <earth> 3 <animal>:<br>After this Power causes Invaders to skip an Action, 4 Damage.",triggerId:e.nextTriggerId(),[r.Now]:async()=>{await t.damage(4)}},c=await a.askToConvertElements({[i.Air]:2,[i.Earth]:2,[i.Animal]:3});await t.skipInvaderAction({text:"For each <beasts>, Invaders skip one Action in target land."+(c?"<br><br>After this Power causes Invaders to skip an Action, 4 Damage.":""),amount:o,afterSkip:async()=>{c&&await e.addTrigger(d,n,s)}})}}]},be={name:"Irresistible Call",type:o.Major,speed:d.Fast,energy:6,elements:[i.Sun,i.Air,i.Plant],set:s.JaggedEarth,target:c.Land,sourceFilter:[l.SacredSite],targetFilter:[l.Inland],range:2,hasPushOrGather:!0,effects:[{textArea:[.624,.715],text:"Gather 5 <town>, 5 <dahan>, 5 <beasts>, and 15 <explorer>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.possiblyDontCountPiecesAs(p.Beasts),await a.gather({amount:5,pieces:e.Town}),await a.gather({amount:5,pieces:e.Dahan}),await a.gather({amount:5,pieces:e.Beasts}),await a.gather({amount:15,pieces:e.Explorer})}},{textArea:[.848,.939],text:"If you have 2 <sun> 3 <air> 2 <plant>:<br>Invaders skip all Actions in target land. Isolate target land.",[r.InTargetLand]:async({you:e,land:a})=>{await e.askToConvertElements({[i.Sun]:2,[i.Air]:3,[i.Plant]:2})&&(await a.skipInvaderAction({text:"Invaders skip all Actions in target land.",all:!0}),await a.isolate())}}]},Te={name:"Melt Earth Into Quicksand",type:o.Major,speed:d.Fast,energy:4,elements:[i.Moon,i.Water,i.Earth],set:s.JaggedEarth,target:c.Land,targetFilter:[l.Sands,l.Wetlands],range:1,generatesFear:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{textArea:[.607,.647],text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.607,.647],text:"2 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(2)}},{textArea:[.607,.647],text:"Isolate target land.",[r.InTargetLand]:async({land:e})=>{await e.isolate()}},{textArea:[.663,.75],text:"After Invaders/<dahan> are Moved into target land, Destroy them.",[r.InTargetLand]:async({$:e,land:a,effect:t,...n})=>{const i={triggerId:e.nextTriggerId(),[r.Now]:async({action:t})=>{for(const n of t.parentData.piecesToDestroy)n.isAlive&&n.location===a&&(await e.sendEvent({type:T.GenericMain,text:`<p>MeltEarthIntoQuicksand</p> triggered from ${ee[n.piece].text} moving into ${a.coordinateLink}.`}),await n.destroy())}};await e.addSubEffectUntilEndOfTurn({[r.Reminder]:e=>e===a?t.text:void 0,[r.AfterMoving]:async({piece:r,source:s,destination:o,movement:d})=>{r.isA(e.InvaderOrDahan)&&s!==a&&o===a&&d!==q.Relocate&&(void 0===e.action.data.piecesToDestroy&&(e.action.data.piecesToDestroy=[]),e.action.data.piecesToDestroy.push(r),await e.addTrigger(i,t,n.action,{movingAction:e.action}))}})}},{textArea:[.874,.914],text:"If you have 2 <moon> 4 <water> 2 <earth>:<br>+4 Damage. Add 1 <badlands>. Add 1 <wilds>.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[i.Fire]:2,[i.Water]:4,[i.Earth]:2})&&(await t.damage(4),await t.add(1,e.Badlands),await t.add(1,e.Wilds))}}]},Ee={name:"Sea Monsters",type:o.Major,speed:d.Slow,energy:5,elements:[i.Water,i.Animal],set:s.JaggedEarth,target:c.Land,targetFilter:[l.Coastal,l.Wetlands],range:1,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.594,.634],text:"Add 1 <beasts>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Beasts)}},{textArea:[.641,.681],text:"If Invaders are present, 2 <fear> per <beasts> (max. 8 <fear>).",[r.InTargetLand]:async({$:e,land:a})=>{a.hasInvaders&&await a.fear(Math.min(2*a.numberOf(e.Beasts),8))}},{textArea:[.683,.723],text:"3 Damage per <beasts>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.damage(3*a.numberOf(e.Beasts))}},{textArea:[.729,.769],text:"1 Damage per <blight>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.damage(a.numberOf(e.Blight))}},{textArea:[.878,.918],text:"If you have 3 <water> 3 <animal>:<br>Repeat this Power.",[r.InTargetLand]:async({you:e,isRepeat:a,power:t})=>{!a&&await e.askToConvertElements({[i.Water]:3,[i.Animal]:3})&&await t.repeat()}}]},Pe={name:"Settle Into Hunting-Grounds",type:o.Major,speed:d.Fast,energy:3,elements:[i.Moon,i.Fire,i.Plant,i.Animal],set:s.JaggedEarth,target:c.Spirit,targetFilter:[m.Yourself],generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.595,.687],text:"Your <presence> may count as <badlands> and <beasts>. (Decide per <presence>, per Action.)",[r.TargetSpirit]:async({$:e,power:a,you:t})=>{await e.addSubEffectUntilEndOfTurn({[r.GlobalReminder]:()=>({text:"Your <presence> may count as <badlands> and <beasts>. (Decide per <presence>, per Action.)<br><br>Your <presence> cannot move.",power:a.power,players:[t]}),[r.PresenceCountsAsBadlandsOrBeasts]:({spirit:e})=>e===t})}},{textArea:[.696,.736],text:"Your <presence> cannot move.",[r.TargetSpirit]:async({$:e,you:a})=>{await e.addSubEffectUntilEndOfTurn({[r.PreventMovePiece]:({piece:e,movement:t})=>e.isAPresenceOf(a)&&t!==q.Relocate})}},{textArea:[.845,.937],text:"If you have 2 <plant> 3 <animal>:<br>2 <fear> and 2 Damage in on of your lands.",[r.TargetSpirit]:async({you:e})=>{await e.askToConvertElements({[i.Plant]:2,[i.Animal]:3})&&await e.inLands().pickOne((async e=>{await e.fear(2),await e.damage(2)}))}}]},Se={name:"Sleep And Never Waken",type:o.Major,speed:d.Fast,energy:3,elements:[i.Moon,i.Air,i.Earth,i.Animal],set:s.JaggedEarth,target:c.Land,sourceFilter:[l.Sands],range:2,generatesFear:!0,effects:[{textArea:[.594,.634],text:"Invaders skip all Actions in target land.",[r.InTargetLand]:async({land:e})=>{await e.skipInvaderAction({all:!0})}},{textArea:[.648,.923],text:"1 <fear> per 2 <explorer> this Power Removes. Remove up to 2 <explorer>.<br><br>If you have 3 <moon> 2 <air> 2 <animal>:<br>Remove up to 6 <explorer> from among your lands.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{const n=[];n.push(...await t.remove({quantifier:w.UpTo,amount:2,pieces:e.Explorer})),await a.askToConvertElements({[i.Moon]:3,[i.Air]:2,[i.Animal]:2})&&await a.forPieces().pickMultiple({amount:6,where:a=>a.isA(e.Explorer),forPickedItem:async e=>{n.push(...await e.remove())},optional:!0});const r=n.filter((a=>a.piece.isA(e.Explorer)&&a.removement===A.Remove)).length;await t.fear(Math.floor(r/2))}}]},Oe={name:"Spill Bitterness Into The Earth",type:o.Major,speed:d.Fast,energy:5,elements:[i.Fire,i.Water,i.Earth],set:s.JaggedEarth,target:c.Land,range:0,blightWhiteListedPower:!0,hasDamageInstructions:!0,effects:[{textArea:[.601,.641],text:"6 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(6)}},{textArea:[.601,.641],text:"Add 2 <badlands>/<strife> and 1 <blight>.",[r.InTargetLand]:async({$:e,land:a})=>{a.isLand&&await a.add(2,e.BadlandsOrStrife),await a.addBlight(1)}},{textArea:[.648,.733],text:"In up to 3 adjacent lands with <blight>, add 1 <badlands>/<strife>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.inAdjacentLands().pickMultiple({amount:3,where:a=>a.has(e.Blight),forPickedItem:async a=>{await a.add(1,e.BadlandsOrStrife)}})}},{textArea:[.848,.927],text:"If you have 3 <fire> 3 <water>:<br>In up to 3 adjacent lands, 1 Damage to each Invader.",[r.InTargetLand]:async({you:e,land:a})=>{await e.askToConvertElements({[i.Fire]:3,[i.Water]:3})&&await a.inAdjacentLands().pickMultiple({amount:3,forPickedItem:async e=>{await e.damageEach(1)}})}}]},Ce={name:"Storm-Swath",type:o.Major,speed:d.Slow,energy:3,elements:[i.Fire,i.Air,i.Water],set:s.JaggedEarth,target:c.Land,sourceFilter:[l.SacredSite],range:1,generatesFear:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,modifiesRange:({spirit:e,withConvert:a})=>e.hasElements({[i.Fire]:2,[i.Air]:3,[i.Water]:2},a)?1:0,payForRange:async({spirit:e})=>{await e.convertElements({[i.Fire]:2,[i.Air]:3,[i.Water]:2})},effects:[{textArea:[.6,.64],text:"2 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.601,.676],text:"In both origin land and target land: 1 Damage to each Invader.",[r.InTargetLand]:async({land:e,power:a,action:t})=>{await a.validOriginsGivenTargetLand(e).pickOne((async a=>{await a.damageEach(1),await e.damageEach(1),t.data.originLand=a}),{prompt:"Select origin land."})}},{textArea:[.773,.94],text:"If you have 2 <fire> 3 <air> 2 <water>:<br>+1 <fear>. This Power has <range+1>.<br>In a land adjacent to both origin and target, 1 Damage to each Invader.<br>In lands where you did Damage, Destroy 1 <town>.",[r.InTargetLand]:async({$:e,you:a,land:t,action:n})=>{if(await a.askToConvertElements({[i.Fire]:2,[i.Air]:3,[i.Water]:2})){let a=null;await e.addSubEffect({effects:[{textArea:[.773,.813],text:"If you have 2 <fire> 3 <air> 2 <water>:<br>+1 <fear>.",[r.Now]:async()=>{await t.fear(1)}},{textArea:[.819,.893],text:"In a land adjacent to both origin and target, 1 Damage to each Invader.",[r.Now]:async()=>{await e.inLandsWhere((e=>e.isAdjacentTo(t)&&e.isAdjacentTo(n.data.originLand))).pickOne((async e=>{await e.damageEach(1),a=e}),{noOptions:"No land adjacent to both origin and target."})}},{textArea:[.903,.943],text:"In lands where you did Damage, Destroy 1 <town>.",[r.Now]:async()=>{await e.addSubEffect({effects:[{highlightLocations:[t],[r.Now]:async()=>{await t.destroyOne(e.Town)}},{highlightLocations:[n.data.originLand],[r.Now]:async()=>{n.data.originLand!==t&&await n.data.originLand.destroyOne(e.Town)}},{highlightLocations:[a],[r.Now]:async()=>{await(a?.destroyOne(e.Town))}}]})}}]})}}}]},De={name:"The Wounded Wild Turns On Its Assailants",type:o.Major,speed:d.Slow,energy:4,elements:[i.Fire,i.Plant,i.Animal],set:s.JaggedEarth,target:c.Land,targetFilter:[l.Blight],range:1,hasPushOrGather:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.613,.653],text:"Add 2 <badlands>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.add(2,e.Badlands)}},{textArea:[.613,.653],text:"Gather up to 2 <beasts>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(2,e.Beasts)}},{textArea:[.67,.71],text:"1 Damage per <blight>/<beasts>/<wilds>.",[r.InTargetLand]:async({$:e,land:a,action:t})=>{t.data.removed=await a.damage(a.numberOf(e.Blight)+a.numberOf(e.Beasts)+a.numberOf(e.Wilds))}},{textArea:[.837,.924],text:"If you have 2 <fire> 3 <plant> 2 <animal>:<br>2 <fear> per Invader Destroyed by this Power (max. 8 <fear>).",[r.InTargetLand]:async({you:e,land:a,action:t})=>{if(await e.askToConvertElements({[i.Fire]:2,[i.Plant]:3,[i.Animal]:2})){const e=t.data.removed.filter((({piece:e,removement:a})=>e.isInvader&&x[a].isDestroyLike)).length;await a.fear(Math.min(2*e,8))}}}]},Be={name:"Thickets Erupt With Every Touch Of Breeze",type:o.Major,speed:d.Fast,energy:3,elements:[i.Air,i.Plant],set:s.JaggedEarth,target:c.Land,sourceFilter:[l.SacredSite],targetFilter:[l.Inland],range:2,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.607,.647],text:"2 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(2)}},{textArea:[.659,.792],text:"Then either: Add 3 <wilds><or>Remove 1 <blight>.",[r.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"AddWilds",textArea:[.663,.703],text:"Add 3 <wilds>.",[r.Now]:async()=>{await a.add(3,e.Wilds)}},{actionId:"RemoveBlight",textArea:[.748,.788],text:"Remove 1 <blight>.",[r.Now]:async()=>{await a.removeBlight()}}]})}},{textArea:[.887,.927],text:"If you have 3 <plant>:<br>1 <fear>. +2 Damage.",[r.InTargetLand]:async({you:e,land:a})=>{await e.askToConvertElements({[i.Plant]:3})&&(await a.fear(1),await a.damage(2))}}]},ke={name:"Transform To A Murderous Darkness",type:o.Major,speed:d.Slow,energy:6,elements:[i.Moon,i.Fire,i.Air,i.Water,i.Plant],set:s.JaggedEarth,target:c.Spirit,hasPushOrGather:!0,generatesFear:!0,hasDamageInstructions:!0,fullText:["Target Spirit may choose one of their <sacred>.","In that land: Replace each of their <presence> with <badlands>; the Replaced <presence> leaves the game.","Push any number of those <badlands>. 3 <fear>.","3 Damage per <presence> Replaced.","If you have 3 <moon> 2 <fire> 2 <air>:<br>1 Damage in an adjacent land.<br>1 Damage in an adjacent land."],effects:[{textArea:[.59,.63],text:"Target Spirit may choose one of their <sacred>.",[r.TargetSpirit]:async({$:e,spirit:a,action:t})=>{await a.inSacredSites().optionallyPickOne((async n=>{let i;t.data.targetLand=n,await e.addSubEffect({effects:[{textArea:[.64,.709],text:"In that land: Replace each of their <presence> with <badlands>; the Replaced <presence> leaves the game.",[r.Now]:async()=>{await n.possiblyDontCountPiecesAs(p.Presence),i=await n.replaceIndividually({amount:n.numberOfPresenceOf(a),pieces:e.Presence,withPiece:p.Badlands,owner:a,removement:A.RemoveFromGame})}},{textArea:[.705,.745],text:"Push any number of those <badlands>.",[r.Now]:async()=>{e.action.data.dontCountAnythingAsBadlands=!0,await n.pushUpTo(i.added.length,e.Badlands)}},{textArea:[.705,.745],text:"3 <fear>.",[r.Now]:async()=>{await n.fear(3)}},{textArea:[.742,.782],text:"3 Damage per <presence> Replaced.",[r.Now]:async()=>{e.action.data.dontCountAnythingAsBadlands=!1,await n.damage(3*i.removed.length)}}]})}))}},{text:"If you have 3 <moon> 2 <fire> 2 <air>:<br>1 Damage in an adjacent land.<br>1 Damage in an adjacent land.",[r.TargetSpirit]:async({$:e,you:a,action:t})=>{if(await a.askToConvertElements({[i.Moon]:3,[i.Fire]:2,[i.Air]:2})){const a=t.data.targetLand;a&&(await e.addSubEffect({text:"1 Damage in an adjacent land.",textArea:[.867,.907],[r.Now]:async()=>{await a.damageInAdjacentLands(1)}}),await e.addSubEffect({text:"1 Damage in an adjacent land.",textArea:[.9,.94],[r.Now]:async()=>{await a.damageInAdjacentLands(1)}}))}}}]},Le={name:"Trees Radiate Celestial Brilliance",type:o.Major,speed:d.Fast,energy:3,elements:[i.Sun,i.Moon,i.Plant],set:s.JaggedEarth,target:c.Land,targetFilter:[l.Jungle,l.NonBlight],range:1,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.62,.66],text:"3 <fear>",[r.InTargetLand]:async({land:e})=>{await e.fear(3)}},{textArea:[.62,.66],text:"Defend 6",[r.InTargetLand]:async({land:e})=>{await e.defend(6)}},{textArea:[.68,.766],text:"This turn, Invaders in target land skip the next Build Action.",[r.InTargetLand]:async({land:e})=>{await e.skipInvaderAction({filter:e=>e.invaderAction===K.Build,next:!0})}},{textArea:[.888,.928],text:"If you have 3 <sun> 2 <moon> 2 <plant>:<br>1 Damage per <sun> you have.",[r.InTargetLand]:async({you:e,land:a})=>{await e.askToConvertElements({[i.Sun]:3,[i.Moon]:2,[i.Plant]:2})&&(await e.askToConvertElementsToCombo({[i.Sun]:1}),await a.damage(e.elements[i.Sun]))}}]},Fe={name:"Unleash A Torrent Of The Selfs Own Essence",type:o.Major,speed:d.Fast,energy:2,elements:[i.Sun,i.Moon,i.Fire,i.Water],set:s.JaggedEarth,target:c.Spirit,targetFilter:[m.Yourself],hasDamageInstructions:!0,fullText:["Gain 4 Energy. You may Forget a Power Card to gain 4 more Energy.<or>Pay X Energy (min.1) to deal X Damage in a land at <range-0>.","If you have 2 <sun> 3 <fire>:<br>You may do both."],effects:[{textArea:[.601,.786],text:"Gain 4 Energy. You may Forget a Power Card to gain 4 more Energy.<or>Pay X Energy (min.1) to deal X Damage in a land at <range-0>.",[r.TargetSpirit]:async({$:e,spirit:a})=>{const t={actionId:"GainEnergy",textArea:[.598,.676],text:"Gain 4 Energy. You may Forget a Power Card to gain 4 more Energy.",[r.Now]:async()=>{await a.gainEnergy(4),await e.may({prompt:"Forget a Power Card to gain 4 more Energy?"})&&(await a.forgetPowers(),await a.gainEnergy(4))}},n={actionId:"DealDamage",textArea:[.702,.786],text:"Pay X Energy (min.1) to deal X Damage in a land at <range-0>.",condition:()=>a.energy>=1,[r.Now]:async()=>{const t=await e.selectX(1,a.energy);await a.payEnergy(t),await a.inLandsWithinRange(0).pickOne((async e=>{await e.damage(t)}))}};await e.chooseBetween({effects:[t,n,{actionId:"DoBoth",textArea:[.888,.928],text:"Do both.",condition:()=>!e.treatingAllOrsAsAnds&&a.hasElementsWithConvert({[i.Sun]:2,[i.Fire]:3}),effects:[{[r.Now]:async()=>{await a.convertElements({[i.Sun]:2,[i.Fire]:3})}},t,n]}]})}}]},Re={name:"Utter A Curse Of Dread And Bone",type:o.Major,speed:d.Slow,energy:4,elements:[i.Moon,i.Animal],set:s.JaggedEarth,target:c.Land,sourceFilter:[l.SacredSite],range:1,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.604,.687],text:"For each <blight> in or adjacent to target land, add 1 <badlands>, 1 <disease> or 1 <strife>. (Max +3 of each.)",[r.InTargetLand]:async({$:e,land:a,action:t})=>{const n=a.numberOf(e.Blight)+a.inAdjacentLocations().sum((a=>a.isLandForBlight?a.numberOf(e.Blight):0));t.data.addedPieces={},await te(n,(async i=>{await e.chooseBetween({text:`Select piece. ${n-i} left.`,effects:[e.Badlands,e.Disease,e.Strife].map((e=>({actionId:e,label:ee[e].text,condition:()=>(t.data.addedPieces[e]??0)<3,[r.Now]:async()=>{t.data.addedPieces[e]=(t.data.addedPieces[e]??0)+1,await a.add(1,e)}})))})}))}},{textArea:[.692,.732],text:"Then: 2 <fear>. 1 Damage.",[r.InTargetLand]:async({land:e})=>{await e.fear(2),await e.damage(1)}},{textArea:[.831,.934],text:"If you have 3 <moon> 2 <animal>:<br>For each type of token you added, add 1 more within <range-1>. 1 Damage in an adjacent land.",[r.InTargetLand]:async({$:e,you:a,land:t,action:n})=>{await a.askToConvertElements({[i.Moon]:3,[i.Animal]:2})&&await e.addSubEffect({effects:[{textArea:[.831,.906],text:"If you have 3 <moon> 2 <animal>:<br>For each type of token you added, add 1 more within <range-1>.",[r.Now]:async()=>{for(const r of Object.keys(n.data.addedPieces))r===e.Strife?await t.forPiecesWithin(1,a).where((e=>e.isInvader)).pickOne((async e=>{await e.addStrife()}),{prompt:"Add 1 <strife> to an Invader within <range-1>."}):await t.inLandsWithin(1,a).pickOne((async e=>{await e.add(1,r)}),{prompt:`Pick a land to add ${ee[r].text}.`})}},{textArea:[.899,.939],text:"1 Damage in an adjacent land.",[r.Now]:async()=>{await t.damageInAdjacentLands(1)}}]})}}]},Ne={name:"Vanish Softly Away Forgotten By All",type:o.Major,speed:d.Slow,energy:3,elements:[i.Moon,i.Air],set:s.JaggedEarth,target:c.Land,range:2,effects:[{textArea:[.587,.788],text:"Remove 1 Invader and 1 <explorer>/<town>.<or>Remove all Damaged Invaders.<br><br>Adversary or Scenario rules that prevent or alter Removal do not affect this Power.",[r.InTargetLand]:async({$:e,land:a})=>{await e.addEffectUntilEndOfActionTree({[r.PreventRemovalEffects]:()=>!0}),await e.chooseBetween({effects:[{actionId:"RemoveInvader",textArea:[.588,.628],text:"Remove 1 Invader and 1 <explorer>/<town>.",[r.Now]:async()=>{await a.remove({amount:1,pieces:e.Invader}),await a.remove({amount:1,pieces:e.ExplorerOrTown})}},{actionId:"RemoveDamaged",textArea:[.657,.697],text:"Remove all Damaged Invaders.",[r.Now]:async()=>{await a.remove({quantifier:w.All,pieces:e.Invader,filter:e=>e.damage>0})}}]})}},{textArea:[.88,.95],text:"If you have 3 <moon> 3 <air>:<br>In any 2 lands with 4 or more Invaders: Remove 1 Invader.",[r.InTargetLand]:async({$:e,you:a})=>{await a.askToConvertElements({[i.Moon]:3,[i.Air]:3})&&await e.inLandsWhere((a=>a.numberOf(e.Invader)>=4)).pickMultiple({amount:2,forPickedItem:async a=>{await a.remove({amount:1,pieces:e.Invader})}})}}]},$e={name:"Voice Of Command",type:o.Major,speed:d.Fast,energy:3,elements:[i.Sun,i.Air],set:s.JaggedEarth,target:c.Land,sourceFilter:[l.SacredSite],targetFilter:[l.Dahan],range:1,hasPushOrGather:!0,hasDamageInstructions:!0,fullText:["1 Damage per <dahan>/<explorer>, to <town>/<city> only.","Defend 2.","During Ravage Actions, <explorer> fight alongside <dahan>. (Deal/take Damage at the same time, and to/from the same sources.)","If you have 3 <sun> 2 <air>:<br>First, Gather up to 2 <explorer>/<town>/<dahan>."],effects:[{textArea:[.878,.918],text:"If you have 3 <sun> 2 <air>:<br>First, Gather up to 2 <explorer>/<town>/<dahan>.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[i.Sun]:3,[i.Air]:2})&&await t.gatherUpTo(2,e.ExplorerTownOrDahan)}},{textArea:[.597,.637],text:"1 Damage per <dahan>/<explorer>, to <town>/<city> only.",[r.InTargetLand]:async({$:e,land:a})=>{await a.damage(a.numberOf(e.Dahan)+a.numberOf(e.Explorer),e.TownOrCity)}},{textArea:[.653,.693],text:"Defend 2.",[r.InTargetLand]:async({land:e})=>{await e.defend(2)}},{textArea:[.653,.766],text:"During Ravage Actions, <explorer> fight alongside <dahan>. (Deal/take Damage at the same time, and to/from the same sources.)",[r.InTargetLand]:async({$:e,land:a,effect:t})=>{await e.addSubEffectUntilEndOfTurn({[r.Reminder]:e=>e===a?t.text:void 0,[r.ExplorersFightWithDahan]:e=>e.land===a})}}]},We={name:"Walls Of Rock And Thorn",type:o.Major,speed:d.Fast,energy:4,elements:[i.Sun,i.Earth,i.Plant],set:s.JaggedEarth,target:c.Land,sourceFilter:[l.SacredSite],targetFilter:[l.Mountain,l.Jungle],range:2,hasDamageInstructions:!0,effects:[{textArea:[.597,.637],text:"2 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(2)}},{textArea:[.597,.637],text:"Defend 8.",[r.InTargetLand]:async({land:e})=>{await e.defend(8)}},{textArea:[.653,.693],text:"Add 1 <wilds>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Wilds)}},{textArea:[.653,.693],text:"Isolate target land.",[r.InTargetLand]:async({land:e})=>{await e.isolate()}},{text:"If you have 2 <earth> 2 <plant>:<br>+2 Damage. +2 Defend. Add 1 <badlands>.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[i.Earth]:2,[i.Plant]:2})&&(await e.addSubEffect({effects:[{textArea:[.822,.862],text:"+2 Damage.",[r.Now]:async()=>{await t.damage(2)}}]}),await e.addSubEffect({effects:[{textArea:[.822,.862],text:"+2 Defend.",[r.Now]:async()=>{await t.defend(2)}}]}),await e.addSubEffect({effects:[{textArea:[.865,.905],text:"Add 1 <badlands>.",[r.Now]:async()=>{await t.add(1,e.Badlands)}}]}))}}]},Me={name:"Weave Together The Fabric Of Place",type:o.Major,speed:d.Fast,energy:4,elements:[i.Sun,i.Moon,i.Air,i.Water,i.Earth],set:s.JaggedEarth,target:c.Land,sourceFilter:[l.SacredSite],range:1,generatesFear:!0,effects:[{textArea:[.591,.776],text:"Target land and a land adjacent to it become a single land for this turn. (It has the terrain and land # of both lands. When this effect expires, divide pieces as you wish; all of them are considered moved.)",[r.InTargetLand]:async({$:e,land:a,...t})=>{await a.inAdjacentLands().pickOne((async n=>{const i=n.adjacentLocations.filter((e=>!a.isAdjacentTo(e)&&a!==e)).map((e=>({land1:a,land2:e})));await n.move({quantifier:w.All,pieces:Z.AllPieces,movement:q.Relocate,locations:{target:g.ToThisLocation,location:a}}),n.exists=!1,await e.addSubEffectUntilEndOfTimePasses({[r.LocationIsOcean]:({location:e})=>e===a&&n.isOcean,[r.LocationIsTerrain]:({location:e,terrain:t})=>e===a&&n.terrain===t,[r.ExtraLandNumber]:({location:e})=>e===a&&a.landNumber!==n.landNumber?n.landNumber:null,[r.ExtraBoard]:({location:e})=>e===a&&a.board!==n.board?n.board:null,[r.Reminder]:e=>e===a||e===n?t.effect.text:void 0,[r.BoardHasExtraLocation]:({board:e})=>n.board===e&&a.board!==e?a:null,[r.AtTimePassesEnds]:async()=>{a.exists&&(n.exists=!0),e.removeThisEffect(),e.setupAdjacencies(),await e.doSpiritAction((async()=>{await a.forPieces().forEach((async e=>{await e.move({locations:{target:g.AnyLocations},destinationFilter:e=>e===a||e===n,oceanIsAllowed:!0,pickPiecesEffect:{textArea:[.707,.779],highlightLocations:[a,n],text:"When this effect expires, divide pieces as you wish; all of them are considered moved."}})}))}),{spirit:t.action.spirit})},[r.ExtraAdjacency]:()=>i}),e.setupAdjacencies()}))}},{textArea:[.864,.934],text:"If you have 4 <air>:<br>Isolate the joined land. If it has Invaders, 2 <fear>, and Remove up to 2 Invaders.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[i.Air]:4})&&(await t.isolate(),t.hasInvaders&&(await t.fear(2),await t.remove({quantifier:w.UpTo,amount:2,pieces:e.Invader})))}}]},Ge={name:"Bargain Of Coursing Paths",type:o.Major,speed:d.Fast,energy:2,elements:[i.Moon,i.Air,i.Water,i.Earth],set:s.NatureIncarnate,target:c.Land,targetFilter:[l.TwoDahan],range:0,effects:[{textArea:[.907,.947],text:"Bargain: 1 <presence> now and -1 Energy/turn.<br><br>If you have 3 <air> 2 <water> 2 <earth>:<br>The <presence> cost comes from your <presence> tracks.",[r.InTargetLand]:async({$:e,power:a,you:t})=>{t.unlockedTrackPresence.length>0&&await t.askToConvertElements({[i.Air]:3,[i.Water]:2,[i.Earth]:2})?await e.addSubEffect({[r.Now]:async()=>{await t.addPresence({locations:g.RemoveFromGame})}}):await e.addSubEffect({textArea:[.588,.628],text:"Bargain: 1 <presence> now and -1 Energy/turn.",[r.Now]:async()=>{await t.destroyPresence(1,A.RemoveFromGame)}});let n=!1;await e.addSubEffect({effectId:pe.BargainsOfCoursingPath,[r.GlobalReminder]:()=>({textArea:[.588,.628],text:"-1 Energy/turn.<br><br>"+(n?"Have paid cost this turn.":"Have not paid cost this turn."),ongoing:!0,power:a.power,players:[t]}),[r.EnergyDebt]:({spirit:e})=>e!==t||n?0:1,[r.PreventGainEnergy]:async({spirit:a})=>!n&&a===t&&(n=!0,await e.sendEvent({type:T.GenericMain,text:`${t.nameLink} gained 1 less Energy from <p>BargainOfCoursingPaths</p>.`}),!0),[r.TimePasses]:()=>(n=!1,Promise.resolve())})}},{textArea:[.63,.706],text:"Now: Mark both target land and another land with 2 or more <dahan>.",[r.InTargetLand]:async({$:e,land:a,action:t})=>{t.data.markedLands=[a],await e.addSubEffect({[r.Reminder]:e=>t.data.markedLands.includes(e)?"Ongoing: After pieces are added or moved into the marked lands: choose any land, then Move those pieces directly to that land.":void 0}),await e.inLandsWhere((t=>t!==a&&t.hasAtLeast(2,e.Dahan))).pickOne((e=>(t.data.markedLands.push(e),Promise.resolve())),{noOptions:"No other land with 2 or more <dahan>."})}},{textArea:[.71,.818],text:"Ongoing: After pieces are added or moved into the marked lands: choose any land, then Move those pieces directly to that land.",[r.InTargetLand]:async({$:e,...a})=>{const t=a.action.data.markedLands;await e.afterPiecesAreAddedOrMovedAddTrigger({reminder:!1,permanent:!0,pieces:Z.AllPieces,locationFilter:e=>t.includes(e),trigger:{triggerId:e.nextTriggerId(),[r.Now]:async({action:a})=>{for(const n of[...a.parentData.piecesAddedOrMoved])n.isA(e.InvaderOrDahan)&&!n.isAlive||!t.includes(n.location)||await n.move({locations:{target:g.AnyLands}})}},effect:a.effect,action:a.action})}}]},He={name:"Bombard With Boulders And Stinging Seeds",type:o.Major,speed:d.Slow,energy:2,elements:[i.Air,i.Earth,i.Plant],set:s.NatureIncarnate,target:c.Land,sourceFilter:[l.MountainOrJungles],range:2,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.629,.67],text:"1 <fear>",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.629,.67],text:"2 Damage",[r.InTargetLand]:async({land:e})=>{await e.damage(2)}},{textArea:[.696,.737],text:"Add 1 <badlands>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Badlands)}},{textArea:[.854,.938],text:"If you have 2 <air>, 2 <earth>, 3 <plant>:<br><br>1 <fear>. 2 Damage. Add 1 <wilds>.",[r.InTargetLand]:async({you:e,land:a,$:t})=>{await e.askToConvertElements({[i.Air]:2,[i.Earth]:2})&&await t.addSubEffect({effects:[{text:"1 <fear>.",[r.Now]:async()=>{await a.fear(1)}},{text:"2 Damage.",[r.Now]:async()=>{await a.damage(2)}},{text:"Add 1 <wilds>.",[r.Now]:async()=>{await a.add(1,t.Wilds)}}]})}}]},Ue={name:"Exaltation Of The Incandescent Sky",type:o.Major,speed:d.Fast,energy:7,elements:[i.Sun,i.Fire,i.Air,i.Water],set:s.NatureIncarnate,target:c.Spirit,targetFilter:[m.Another],generatesFear:!0,hasDamageInstructions:!0,fullText:["Target Spirit may play 1 Power Card by paying its cost, make up to 2 of their Powers <fast> this turn, and do 3 Damage in one of their lands.","You may do likewise.","If you have<br>3 <sun> 3 <fire> 4 <air> 2 <water>:<br><br>In any 4 lands on the island, Skip 1 Invader Action. 5 <fear> (total)."],effects:[{textArea:[.596,.738],text:"Target Spirit may play 1 Power Card by paying its cost, make up to 2 of their Powers <fast> this turn, and do 3 Damage in one of their lands.",[r.TargetSpirit]:async({$:e,you:a,spirit:t})=>{await t.andAnotherSpirit(a,{now:async(a,t)=>{await e.addSubEffect({effects:[{textArea:t?[.593,.671]:[.729,.77],text:(t?"Target Spirit":"You")+" may play 1 Power Card by paying its cost.",[r.Now]:async()=>{await a.playAPowerCardByPayingItsCost()}},{textArea:t?[.629,.701]:[.729,.77],text:`${t?"Target Spirit":"You"} may make up to 2 of ${t?"their":"your"} Powers <fast> this turn.`,[r.Now]:async()=>{await e.clickToContinue(),await a.gainMakeFastBuff({amount:2})}},{textArea:t?[.693,.734]:[.729,.77],text:`${t?"Target Spirit deals":"You deal"} 3 Damage in one of ${t?"their":"your"} lands.`,[r.Now]:async()=>{await a.inLands().pickOne((async e=>{await e.damage(3)}))}}]})}})}},{textArea:[.771,.935],text:"If you have<br>3 <sun> 3 <fire> 4 <air> 2 <water>:<br><br>In any 4 lands on the island, Skip 1 Invader Action. 5 <fear> (total).",[r.TargetSpirit]:async({you:e,$:a})=>{await e.askToConvertElements({[i.Sun]:3,[i.Fire]:3,[i.Air]:4,[i.Water]:2})&&(await a.inLands().pickMultiple({amount:4,forPickedItem:async e=>{await e.skipInvaderAction()}}),await a.fear(5))}}]},qe={name:"Flocking Red Talons",type:o.Major,speed:d.Fast,energy:3,elements:[i.Air,i.Water,i.Plant,i.Animal],set:s.NatureIncarnate,target:c.Land,sourceFilter:[l.Wetlands],range:3,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{textArea:[.612,.653],text:"Add 1 <beasts>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Beasts)}},{textArea:[.61,.683],text:"Move up to 2 <beasts> within <range-3> to target land.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await t.forPiecesWithin(3,a).where((a=>a.isA(e.Beasts))).pickMultiple({amount:2,forPickedItem:async e=>{await e.move({locations:{target:g.ToThisLocation,location:t}})},repeatSame:!0,optional:!0})}},{textArea:[.65,.762],text:"For each <beasts> present, choose a different Invader. 1 Damage to each of those Invaders.",[r.InTargetLand]:async({$:e,land:a})=>{await a.piecesThatAre(e.Invader).pickMultiple({amount:a.numberOf(e.Beasts),forPickedItem:async e=>{await e.damageOnlyThis(1)}})}},{textArea:[.718,.759],text:"Push 1 <explorer>/<town> per <beasts>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.push({amount:a.numberOf(e.Beasts),pieces:e.ExplorerOrTown})}},{textArea:[.774,.935],text:"If you have 2 <air> 2 <plant> 3 <animal>:<br>Repeat this Power on a different land within <range-3> of target land.",[r.InTargetLand]:async({you:e,land:a,power:t,isRepeat:n})=>{!n&&await e.askToConvertElements({[i.Air]:2,[i.Plant]:2,[i.Animal]:3})&&await a.inLandsWithin(3).where((e=>e!==a)).pickOne((async e=>{await t.repeatInLocations([e])}))}}]},je={name:"Fragments Of Yesteryear",type:o.Major,speed:d.Slow,energy:7,elements:[i.Sun,i.Moon],set:s.NatureIncarnate,target:c.Land,range:0,mayBeSpeed:{effect:{textArea:[.726,.82],text:"If you have 3 <sun>:<br>This power may be <fast>.",[r.Now]:async({action:e})=>{await e.spirit.convertElements({[i.Sun]:3}),await e.power.makeFast()}},condition:({speed:e,spirit:a})=>e===d.Fast&&a.hasElementsWithConvert({[i.Sun]:3})},fullText:["Remove all pieces, then Add the pieces matching the target land's Setup Symbols.","If you have 3 <sun>:<br>This power may be <fast>.","If you have 3 <moon>:<br>Don't Remove <dahan>, any Spirit's <presence>, or Spirit Tokens. Don't Add Invaders/<blight>."],effects:[{textArea:[.607,.946],text:"Remove all pieces, then Add the pieces matching the target land's Setup Symbols.<br><br>If you have 3 <moon>:<br>Don't Remove <dahan>, any Spirit's <presence>, or Spirit Tokens. Don't Add Invaders/<blight>.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[i.Moon]:3})?(await t.remove({quantifier:w.All,pieces:e.AllPiecesButDahanPresenceAndSpiritTokens,autoPlay:!0}),await t.restoreToSetupSymbols({removeFirst:!1,exceptPieces:[e.Invader,e.Blight]})):await t.restoreToSetupSymbols()}}]},Je={name:"Inspire The Release Of StolenLands",type:o.Major,speed:d.Slow,energy:4,elements:[i.Sun,i.Water,i.Plant,i.Animal],set:s.NatureIncarnate,target:c.Land,targetFilter:[l.NonBlight],hasPushOrGather:!0,range:2,fullText:["Gather up to 3 <dahan>. Remove up to 3 Health worth of Invaders per <dahan>.","If you have 3 <sun> 3 <water> 2 <animal>:<br><br>This Power can target lands with <blight>.","If <dahan> are present, Remove 1 <blight> from target land, then Remove 1 <explorer>, 1 <town>, and 1 <city> from a land with <range-1> (of target land)."],effects:[{textArea:[.713,.843],text:"If you have 3 <sun> 3 <water> 2 <animal>:<br><br>This Power can target lands with <blight>.",[r.InTargetLand]:async({$:e,land:a,you:t})=>{a.has(e.Blight)&&!await t.askToConvertElements({[i.Sun]:3,[i.Water]:3,[i.Animal]:2})||await e.addSubEffect({effects:[{textArea:[.618,.659],text:"Gather up to 3 <dahan>.",[r.Now]:async()=>{await a.gatherUpTo(3,e.Dahan)}},{textArea:[.621,.694],text:"Remove up to 3 Health worth of Invaders per <dahan>.",[r.Now]:async()=>{await a.removeInvadersWorthOfHealthUpTo(3*a.numberOf(e.Dahan))}},{textArea:[.834,.941],text:"If <dahan> are present, Remove 1 <blight> from target land, then Remove 1 <explorer>, 1 <town>, and 1 <city> from a land with <range-1> (of target land).",[r.Now]:async()=>{(a.has(e.Blight)||await t.askToConvertElements({[i.Sun]:3,[i.Water]:3,[i.Animal]:2}))&&a.has(e.Dahan)&&(await a.removeBlight(),await a.inLandsWithin(1,t).pickOne((async a=>{await a.removeOne(e.Explorer),await a.removeOne(e.Town),await a.removeOne(e.City)})))}}]})}}]},Ve={name:"Plague Ships Sail To Distant Ports",type:o.Major,speed:d.Fast,energy:4,elements:[i.Fire,i.Air,i.Water,i.Animal],set:s.NatureIncarnate,target:c.Land,targetFilter:[l.CoastalCity],range:1,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.598,.941],text:"1 <fear>. Add 4 <disease> among Coastal lands (on any boards) other than target land.<br><br>If you have 2 <fire> 2 <water> 2 <animal>:<br><br>Instead: 1 <fear>. 3 Damage. Spirits may jointly spend 3 Energy per player (aided by Removing <disease> from the island for 3 Energy each) to remove the top card of the Fear Deck from the game. Add 1 <disease>.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[i.Fire]:2,[i.Water]:2,[i.Animal]:2})?await e.addSubEffect({effects:[{textArea:[.768,.809],text:"Instead: 1 <fear>.",[r.Now]:async()=>{await t.fear(1)}},{textArea:[.768,.809],text:"3 Damage.",[r.Now]:async()=>{await t.damage(3)}},{textArea:[.801,.938],text:"Spirits may jointly spend 3 Energy per player (aided by Removing <disease> from the island for 3 Energy each) to remove the top card of the Fear Deck from the game. Add 1 <disease>.",[r.Now]:async()=>{e.playersCanJointlyPayEnergyAidedBy({energy:3*e.spiritCount,aidedByRemovingDisease:!0})&&await e.may({prompt:"Pay jointly 3 Energy per player (aided by Removing <disease> from the island for 3 Energy each) to remove the top card of the Fear Deck from the game?"})&&(await e.payEnergyJointlyAidedBy({energy:3*e.spiritCount,aidedByRemovingDisease:!0}),await e.removeTopFearCard())}},{textArea:[.899,.94],text:"Add 1 <disease>.",[r.Now]:async()=>{await t.add(1,e.Disease)}}]}):await e.addSubEffect({effects:[{textArea:[.764,.805],text:"1 <fear>",[r.Now]:async()=>{await t.fear(1)}},{textArea:[.601,.674],text:"Add 4 <disease> among Coastal lands (on any boards) other than target land.",[r.Now]:async()=>{await e.inCoastalLands().where((e=>e!==t)).pickMultiple({amount:4,forPickedItem:async a=>{await a.add(1,e.Disease)},repeatSame:!0})}}]})}}]},Ye={name:"Ravaged Undergrowth Slithers Back To Life",type:o.Major,speed:d.Slow,energy:3,elements:[i.Water,i.Plant,i.Animal],set:s.NatureIncarnate,target:c.Land,sourceFilter:[l.SacredSite],targetFilter:[l.Blight],range:1,hasPushOrGather:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.607,.648],text:"Replace 1 <blight> with 1 <wilds>.",[r.InTargetLand]:async({$:e,land:a,action:t})=>{t.data.replacement=await a.replaceOne({pieces:e.Blight,withAmount:1,withPiece:p.Wilds})}},{textArea:[.652,.693],text:"1 <fear>",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.652,.693],text:"3 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(3)}},{textArea:[.699,.74],text:"Push that <wilds>.",[r.InTargetLand]:async({action:e,land:a})=>{const t=e.data.replacement.added;t.length>0&&t[0].location===a&&await t[0].piece.push()}},{textArea:[.747,.941],text:"If you have 3 <water> 2 <plant>:<br><br>Add 1 <wilds>. You may Push it. In each land with <wilds> within <range-1> (of target land):<br>Push 1 <explorer> and 1 <town> to lands without <wilds>.",[r.InTargetLand]:async({land:e,you:a,$:t})=>{if(await a.askToConvertElements({[i.Water]:3,[i.Plant]:2})){const n=await e.add(1,t.Wilds);n.length>0&&n[0].location===e&&await t.addSubEffect({textArea:[.831,.872],text:"You may Push it.",[r.Now]:async()=>{await n[0].piece.push({quantifier:w.May})}}),await e.inLandsWithin(1,a).where((e=>e.has(t.Wilds))).selectOrder().forEach((async e=>{await t.addSubEffect({textArea:[.899,.94],text:"Push 1 <explorer> and 1 <town> to lands without <wilds>.",[r.Now]:async()=>{await e.push({pieces:t.Explorer,destinationFilter:e=>e.doesntHave(t.Wilds)}),await e.push({pieces:t.Town,destinationFilter:e=>e.doesntHave(t.Wilds)})}})}),{textArea:[.834,.941],text:"In each land with <wilds> within <range-1> (of target land):<br>Push 1 <explorer> and 1 <town> to lands without <wilds>."})}}}]},ze={name:"Rumbling Earthquakes",type:o.Major,speed:d.Slow,energy:6,elements:[i.Fire,i.Earth],set:s.NatureIncarnate,target:c.Land,sourceFilter:[l.SacredSite],range:1,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.607,.648],text:"This Power ignores Health bonuses.",[r.InTargetLand]:async({$:e})=>{await e.addEffectUntilEndOfAction({[r.DamageIgnoreHealthBonuses]:()=>!0})}},{textArea:[.651,.692],text:"3 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(3)}},{textArea:[.651,.692],text:"6 Damage, to <town>/<city> only.",[r.InTargetLand]:async({$:e,land:a})=>{await a.damage(6,e.TownOrCity)}},{textArea:[.688,.768],text:"6 Damage among adjacent lands, to <town>/<city> only.",[r.InTargetLand]:async({$:e,land:a})=>{await a.damageInAdjacentLands(6,e.TownOrCity)}},{textArea:[.779,.941],text:"If you have 4 <earth>:<br>6 Damage among target/adjacent lands, to <town>/<city> only.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[i.Earth]:4})&&await t.damageInThisAndAdjacentLands(6,e.TownOrCity)}}]},Qe={name:"Solidify Echoes Of Majesty Past",type:o.Major,speed:d.Fast,energy:4,elements:[i.Sun,i.Moon,i.Air,i.Earth],set:s.NatureIncarnate,target:c.Spirit,effects:[{textArea:[.581,.758],text:"Choose one of target Spirit's lands. In that land and each adjacent land, Defend 3. They Add 1 <broken> to each adjacent land. Skip up to 1 Invader Action at each added <broken>.",[r.TargetSpirit]:async({spirit:e})=>{await e.inLands().pickOne((async a=>{await a.inThisAndAdjacentLands().forEach((async e=>{await e.defend(3)})),await a.inAdjacentLands().selectOrder(e.destroyedPresence>0).forEach((async t=>{if(t!==a&&e.destroyedPresence>0){(await t.addPresence(e,{destroyed:!0})).length>0&&await t.skipInvaderAction({textArea:[.685,.757],text:"Skip up to 1 Invader Action at each added <broken>."})}}),{highlightLocations:[a]})}))}},{textArea:[.756,.947],text:"If you have 2 <sun>, 2 <moon>, 2 <earth>:<br><br>Target Spirit either Reclaims 1 Power Card or re-gains a Unique Power they previously forgot. They may play it by paying its cost.",[r.TargetSpirit]:async({you:e,spirit:a,$:t})=>{await e.askToConvertElements({[i.Sun]:2,[i.Moon]:2,[i.Earth]:2})&&await t.chooseBetween({players:[a],effects:[{actionId:"Reclaim",textArea:[.834,.875],text:"Reclaim 1 Power Card.",[r.Now]:async()=>{const e=await a.reclaim(1);e.length>0&&e[0].isPlayable&&await t.may({textArea:[.907,.948],text:"They may play it by paying its cost.",prompt:`Play ${e[0].powerLink} by paying its cost?`})&&await e[0].play({withoutUsingCardPlays:!0})},condition:()=>a.hasReclaimableCards},{actionId:"Regain",textArea:[.871,.944],text:"Regain a Unique Power you previously forgot.",condition:()=>a.availableRememberedUniques.length>0,[r.Now]:async()=>{const e=await a.gainPowerCard({fromSelection:a.availableRememberedUniques,taken:!0});e.chosen.length>0&&e.chosen[0].isPlayable&&await t.may({textArea:[.907,.948],text:"They may play it by paying its cost.",prompt:`Play ${e.chosen[0].powerLink} by paying its cost?`})&&await e.chosen[0].play({withoutUsingCardPlays:!0})}}]})}}]},Ke={name:"Transformative Sacrifice",type:o.Major,speed:d.Fast,energy:3,elements:[i.Moon,i.Fire,i.Water,i.Plant],set:s.NatureIncarnate,target:c.Spirit,fullText:["Target Spirit may Remove up to 3 <presence> (from anywhere on the island). Then for each Removed <presence>, they Take a Minor Power and  play it (for free).","If you have 2 <moon> 3 <fire> 2 <plant>:<br>Before taking cards, they may also Remove 1 <presence> from their <presence> track to Take a Minor Power and play it."],effects:[{textArea:[.749,.938],text:"If you have 2 <moon> 3 <fire> 2 <plant>:<br>Before taking cards, they may also Remove 1 <presence> from their <presence> track to Take a Minor Power and play it.",[r.TargetSpirit]:async({you:e,spirit:a})=>{if(a.unlockedTrackPresence.length>0&&await e.askToConvertElements({[i.Moon]:2,[i.Fire]:3,[i.Plant]:2})){await a.addPresence({locations:g.Remove,forcedFromTrack:!0});const e=await a.gainPowerCard({powerType:o.Minor,drawAmount:1,taken:!0});e.chosen.length>0&&await e.chosen[0].play({withoutPaying:!0,withoutUsingCardPlays:!0})}}},{textArea:[.604,.752],text:"Target Spirit may Remove up to 3 <presence> (from anywhere on the island). Then for each Removed <presence>, they Take a Minor Power and  play it (for free).",[r.TargetSpirit]:async({spirit:e,action:a})=>{const t=await e.destroyPresence(3,A.Remove,!0),n=a.data.extraGainAndPlay??0;await te(t.length+n,(async()=>{const a=await e.gainPowerCard({powerType:o.Minor,drawAmount:1,taken:!0});a.chosen.length>0&&await a.chosen[0].play({withoutPaying:!0,withoutUsingCardPlays:!0})}))}}]};var Xe,_e;!function(e){e.AdvanceCards="AdvanceCards",e.BlightedIsland="BlightedIsland",e.Build="Build",e.Event="Event",e.Explore="Explore",e.FastPowers="FastPowers",e.Fear="Fear",e.GainEnergy="GainEnergy",e.Grow="Grow",e.HighImmigration="HighImmigration",e.InitialExplore="InitialExplore",e.PlayPowers="PlayPowers",e.Ravage="Ravage",e.RoyalBacking="RoyalBacking",e.Setup="Setup",e.SetupPresence="SetupPresence",e.SlowPowers="SlowPowers",e.TimePasses="TimePasses"}(Xe||(Xe={})),function(e){e.ACircuitousAndWendingJourney="ACircuitousAndWendingJourney",e.ADreadfulTideOfScurryingFlesh="ADreadfulTideOfScurryingFlesh",e.AYearOfPerfectStillness="AYearOfPerfectStillness",e.AbsoluteStasis="AbsoluteStasis",e.AbsorbCorruption="AbsorbCorruption",e.AbsorbEssence="AbsorbEssence",e.AcceleratedRot="AcceleratedRot",e.AfflictWithBloodthirst="AfflictWithBloodthirst",e.AidFromTheSpiritspeakers="AidFromTheSpiritspeakers",e.AirMovesEarthEndures="AirMovesEarthEndures",e.AllEnvelopingGreen="AllEnvelopingGreen",e.AngryBears="AngryBears",e.AnimatedWrackroot="AnimatedWrackroot",e.AsphyxiatingSmoke="AsphyxiatingSmoke",e.BargainOfCoursingPaths="BargainOfCoursingPaths",e.BargainsOfPowerAndProtection="BargainsOfPowerAndProtection",e.BatsScoutForRaidsByDarkness="BatsScoutForRaidsByDarkness",e.BelligerentAndAggressiveCrops="BelligerentAndAggressiveCrops",e.BesetAndConfoundTheInvaders="BesetAndConfoundTheInvaders",e.BirdsCryWarning="BirdsCryWarning",e.BlazingIntimidation="BlazingIntimidation",e.BlazingRenewal="BlazingRenewal",e.BlindingGlare="BlindingGlare",e.BloodDrawsPredators="BloodDrawsPredators",e.BloodWaterAndBloodlust="BloodWaterAndBloodlust",e.BloodwrackPlague="BloodwrackPlague",e.BloomingOfTheRocksAndTrees="BloomingOfTheRocksAndTrees",e.BlurTheArcOfYears="BlurTheArcOfYears",e.BombardWithBouldersAndStingingSeeds="BombardWithBouldersAndStingingSeeds",e.BoonOfAncientMemories="BoonOfAncientMemories",e.BoonOfCorruptedBlood="BoonOfCorruptedBlood",e.BoonOfGrowingPower="BoonOfGrowingPower",e.BoonOfReimagining="BoonOfReimagining",e.BoonOfResilientPower="BoonOfResilientPower",e.BoonOfSunshinesPromise="BoonOfSunshinesPromise",e.BoonOfSwarmingBedevilment="BoonOfSwarmingBedevilment",e.BoonOfVigor="BoonOfVigor",e.BoonOfWatchfulGuarding="BoonOfWatchfulGuarding",e.CallOfTheDahanWays="CallOfTheDahanWays",e.CallOfTheDeeps="CallOfTheDeeps",e.CallOnHerdersForAid="CallOnHerdersForAid",e.CallOnMidnightsDream="CallOnMidnightsDream",e.CallToAFastnessOfRenewal="CallToAFastnessOfRenewal",e.CallToASunlitHaven="CallToASunlitHaven",e.CallToBloodshed="CallToBloodshed",e.CallToFerocity="CallToFerocity",e.CallToGuard="CallToGuard",e.CallToIsolation="CallToIsolation",e.CallToMigrate="CallToMigrate",e.CallToTend="CallToTend",e.CallToTrade="CallToTrade",e.CallToVigilance="CallToVigilance",e.CarapacedLand="CarapacedLand",e.CastDownIntoTheBrinyDeep="CastDownIntoTheBrinyDeep",e.CleansingFloods="CleansingFloods",e.CloseTheWays="CloseTheWays",e.ConcealingShadows="ConcealingShadows",e.ConfoundingMists="ConfoundingMists",e.ConsiderAHarmoniousNature="ConsiderAHarmoniousNature",e.CoordinatedRaid="CoordinatedRaid",e.CreepersTearIntoMortar="CreepersTearIntoMortar",e.CropsWitherAndFade="CropsWitherAndFade",e.CyclesOfTimeAndTide="CyclesOfTimeAndTide",e.DarkAndTangledWoods="DarkAndTangledWoods",e.DarkSkiesLooseAStingingRain="DarkSkiesLooseAStingingRain",e.DarknessSwallowsTheUnwary="DarknessSwallowsTheUnwary",e.DeathApproachesFromBeneathTheSurface="DeathApproachesFromBeneathTheSurface",e.DeathFallsGentlyFromOpenBlossoms="DeathFallsGentlyFromOpenBlossoms",e.DelusionsOfDanger="DelusionsOfDanger",e.DesiccatingWinds="DesiccatingWinds",e.DevouringAnts="DevouringAnts",e.DireMetamorphosis="DireMetamorphosis",e.DisorientingLandscape="DisorientingLandscape",e.DissolveTheBondsOfKinship="DissolveTheBondsOfKinship",e.DissolvingVapors="DissolvingVapors",e.DomesticatedAnimalsGoBerserk="DomesticatedAnimalsGoBerserk",e.DrawOfTheFruitfulEarth="DrawOfTheFruitfulEarth",e.DrawToTheWatersEdge="DrawToTheWatersEdge",e.DrawTowardsAConsumingVoid="DrawTowardsAConsumingVoid",e.DreadApparitions="DreadApparitions",e.DreamOfTheUntouchedLand="DreamOfTheUntouchedLand",e.DreamsOfTheDahan="DreamsOfTheDahan",e.DriftDownIntoSlumber="DriftDownIntoSlumber",e.Drought="Drought",e.DryWoodExplodesInSmolderingSplinters="DryWoodExplodesInSmolderingSplinters",e.EarthMovesWithVigorAndMight="EarthMovesWithVigorAndMight",e.EarthShuddersBuildingsFall="EarthShuddersBuildingsFall",e.EerieNoisesAndMovingTrees="EerieNoisesAndMovingTrees",e.ElementalAegis="ElementalAegis",e.ElementalBoon="ElementalBoon",e.ElementalTeachings="ElementalTeachings",e.ElusiveAmbushes="ElusiveAmbushes",e.EmergeFromTheDreadNightWind="EmergeFromTheDreadNightWind",e.EncircleTheUnsuspectingPrey="EncircleTheUnsuspectingPrey",e.EncompassingWard="EncompassingWard",e.EnticingAndLullingDreams="EnticingAndLullingDreams",e.EnticingSplendor="EnticingSplendor",e.EntrancingApparitions="EntrancingApparitions",e.EntrapTheForcesOfCorruption="EntrapTheForcesOfCorruption",e.EntwineTheFatesOfAll="EntwineTheFatesOfAll",e.EntwinedPower="EntwinedPower",e.EpidemicsRunRampant="EpidemicsRunRampant",e.EvermultiplyingSwarm="EvermultiplyingSwarm",e.ExaltationOfEchoedSteps="ExaltationOfEchoedSteps",e.ExaltationOfGraspingRoots="ExaltationOfGraspingRoots",e.ExaltationOfMoltenStone="ExaltationOfMoltenStone",e.ExaltationOfTangledGrowth="ExaltationOfTangledGrowth",e.ExaltationOfTheIncandescentSky="ExaltationOfTheIncandescentSky",e.ExaltationOfTheStormWind="ExaltationOfTheStormWind",e.ExaltationOfTheTransformingFlame="ExaltationOfTheTransformingFlame",e.ExhaleConfusionAndDelirium="ExhaleConfusionAndDelirium",e.ExplosiveEruption="ExplosiveEruption",e.FavorOfTheSunAndStarlitDark="FavorOfTheSunAndStarlitDark",e.FavorsCalledDue="FavorsCalledDue",e.FavorsOfStoryAndSeason="FavorsOfStoryAndSeason",e.FerociousRampage="FerociousRampage",e.FetidBreathSpreadsInfection="FetidBreathSpreadsInfection",e.FieldsChokedWithGrowth="FieldsChokedWithGrowth",e.FieryVengeance="FieryVengeance",e.FireAndFlood="FireAndFlood",e.FireBurnsWaterSoothes="FireBurnsWaterSoothes",e.FireInTheSky="FireInTheSky",e.Firestorm="Firestorm",e.FlamesFury="FlamesFury",e.FlashFloods="FlashFloods",e.Flashfires="Flashfires",e.FleshrotFever="FleshrotFever",e.FlockingRedTalons="FlockingRedTalons",e.FlowDownriverBlowDownwind="FlowDownriverBlowDownwind",e.FlowLikeWaterReachLikeAir="FlowLikeWaterReachLikeAir",e.FlowingAndSilentFormsDartBy="FlowingAndSilentFormsDartBy",e.FocusTheLandsAnguish="FocusTheLandsAnguish",e.FocusTheSunsRays="FocusTheSunsRays",e.ForestsOfLivingObsidian="ForestsOfLivingObsidian",e.ForsakeSocietyToChaseAfterDreams="ForsakeSocietyToChaseAfterDreams",e.FoulVaporsAndFetidMuck="FoulVaporsAndFetidMuck",e.FoundationsSinkIntoMud="FoundationsSinkIntoMud",e.FragmentsOfYesteryear="FragmentsOfYesteryear",e.FrenziedAssault="FrenziedAssault",e.FrightfulKeening="FrightfulKeening",e.GatherTheScatteredLightOfStars="GatherTheScatteredLightOfStars",e.GatherTheWarriors="GatherTheWarriors",e.GiftOfAbundance="GiftOfAbundance",e.GiftOfConstancy="GiftOfConstancy",e.GiftOfFlowingPower="GiftOfFlowingPower",e.GiftOfFuriousMight="GiftOfFuriousMight",e.GiftOfLivingEnergy="GiftOfLivingEnergy",e.GiftOfNaturesConnection="GiftOfNaturesConnection",e.GiftOfPower="GiftOfPower",e.GiftOfProliferation="GiftOfProliferation",e.GiftOfSearingHeat="GiftOfSearingHeat",e.GiftOfSeismicEnergy="GiftOfSeismicEnergy",e.GiftOfStrength="GiftOfStrength",e.GiftOfThePrimordialDeeps="GiftOfThePrimordialDeeps",e.GiftOfTheSparkingSky="GiftOfTheSparkingSky",e.GiftOfTheSunlitAir="GiftOfTheSunlitAir",e.GiftOfTheUntamedWild="GiftOfTheUntamedWild",e.GiftOfTwinnedDays="GiftOfTwinnedDays",e.GiftOfWindspedSteps="GiftOfWindspedSteps",e.GnawingRootbiters="GnawingRootbiters",e.GoldsAllure="GoldsAllure",e.GrantHatredARavenousForm="GrantHatredARavenousForm",e.GraspingTide="GraspingTide",e.GrowthThroughSacrifice="GrowthThroughSacrifice",e.GuardTheHealingLand="GuardTheHealingLand",e.GuardianSerpents="GuardianSerpents",e.GuideTheWayOnFeatheredWings="GuideTheWayOnFeatheredWings",e.HarbingersOfTheLightning="HarbingersOfTheLightning",e.HauntedByPrimalMemories="HauntedByPrimalMemories",e.HazardsSpreadAcrossTheIsland="HazardsSpreadAcrossTheIsland",e.HerdTowardsTheLurkingMaw="HerdTowardsTheLurkingMaw",e.HereThereBeMonsters="HereThereBeMonsters",e.HoldTheIslandFastWithABulwarkOfWill="HoldTheIslandFastWithABulwarkOfWill",e.ImbueWithNourishingVitality="ImbueWithNourishingVitality",e.ImpenetrableTanglesOfGreenery="ImpenetrableTanglesOfGreenery",e.ImpersonateAuthority="ImpersonateAuthority",e.InciteTheMob="InciteTheMob",e.IndomitableClaim="IndomitableClaim",e.InfestationOfVenomousSpiders="InfestationOfVenomousSpiders",e.InfestedAquifers="InfestedAquifers",e.InfiniteVitality="InfiniteVitality",e.InflameTheFiresOfLife="InflameTheFiresOfLife",e.InsatiableHungerOfTheSwarm="InsatiableHungerOfTheSwarm",e.InscrutableJourneying="InscrutableJourneying",e.InspireAWindingDance="InspireAWindingDance",e.InspireTheReleaseOfStolenLands="InspireTheReleaseOfStolenLands",e.InstrumentsOfTheirOwnRuin="InstrumentsOfTheirOwnRuin",e.IntractableThicketsAndThorns="IntractableThicketsAndThorns",e.IrresistibleCall="IrresistibleCall",e.JaggedShardsPushFromTheEarth="JaggedShardsPushFromTheEarth",e.KeepWatchForNewIncursions="KeepWatchForNewIncursions",e.LandCreaksWithTension="LandCreaksWithTension",e.LandOfHauntsAndEmbers="LandOfHauntsAndEmbers",e.LavaFlows="LavaFlows",e.LayPathsTheyCannotHelpButWalk="LayPathsTheyCannotHelpButWalk",e.LeadTheFuriousAssault="LeadTheFuriousAssault",e.LeadTheWarriorsToBattle="LeadTheWarriorsToBattle",e.LearnTheInvadersTactics="LearnTheInvadersTactics",e.LeaveATrailOfDeathlySilence="LeaveATrailOfDeathlySilence",e.LetThemBreakThemselvesAgainstTheStone="LetThemBreakThemselvesAgainstTheStone",e.LetsSeeWhatHappens="LetsSeeWhatHappens",e.LightningTornSkiesIncitePandemonium="LightningTornSkiesIncitePandemonium",e.LightningsBoon="LightningsBoon",e.LikeCallsToLike="LikeCallsToLike",e.LostInTheEndlessDark="LostInTheEndlessDark",e.LostInTheSwirlingHaze="LostInTheSwirlingHaze",e.LureOfTheUnknown="LureOfTheUnknown",e.ManifestIncarnation="ManifestIncarnation",e.ManifestationOfPowerAndGlory="ManifestationOfPowerAndGlory",e.MantleOfDread="MantleOfDread",e.MarkTerritoryWithScarsAndTeeth="MarkTerritoryWithScarsAndTeeth",e.MassiveFlooding="MassiveFlooding",e.MeltEarthIntoQuicksand="MeltEarthIntoQuicksand",e.MesmerizedTranquility="MesmerizedTranquility",e.MindShatteringSong="MindShatteringSong",e.MischiefAndSabotage="MischiefAndSabotage",e.MistsOfOblivion="MistsOfOblivion",e.MysteriousAbductions="MysteriousAbductions",e.NaturesResilience="NaturesResilience",e.NeverHeardFromAgain="NeverHeardFromAgain",e.NightTerrors="NightTerrors",e.ObserveTheEverChangingWorld="ObserveTheEverChangingWorld",e.OceanBreaksTheShore="OceanBreaksTheShore",e.OfferPassageBetweenWorlds="OfferPassageBetweenWorlds",e.OpenShiftingWaterways="OpenShiftingWaterways",e.OverenthusiasticArson="OverenthusiasticArson",e.OvergrowInANight="OvergrowInANight",e.PactOfTheJoinedHunt="PactOfTheJoinedHunt",e.ParalyzingFright="ParalyzingFright",e.PathsTiedByNature="PathsTiedByNature",e.PeaceOfTheNighttimeSky="PeaceOfTheNighttimeSky",e.PentupCalamity="PentupCalamity",e.PerilsOfTheDeepestIsland="PerilsOfTheDeepestIsland",e.PillarOfLivingFlame="PillarOfLivingFlame",e.PlagueShipsSailToDistantPorts="PlagueShipsSailToDistantPorts",e.Plaguebearers="Plaguebearers",e.PlowsShatterOnRockyGround="PlowsShatterOnRockyGround",e.PoisonedDew="PoisonedDew",e.PoisonedLand="PoisonedLand",e.PortentsOfDisaster="PortentsOfDisaster",e.PoundShipsToSplinters="PoundShipsToSplinters",e.PourTimeSideways="PourTimeSideways",e.PoweredByTheFurnaceOfTheEarth="PoweredByTheFurnaceOfTheEarth",e.Powerstorm="Powerstorm",e.PredatoryNightmares="PredatoryNightmares",e.PreyOnTheBuilders="PreyOnTheBuilders",e.PromisesOfProtection="PromisesOfProtection",e.ProwlingPanthers="ProwlingPanthers",e.PullBeneathTheHungryEarth="PullBeneathTheHungryEarth",e.PunishThoseWhoTrespass="PunishThoseWhoTrespass",e.PurifyingFlame="PurifyingFlame",e.PursueWithScratchesPecksAndStings="PursueWithScratchesPecksAndStings",e.PyroclasticBombardment="PyroclasticBombardment",e.PyroclasticFlow="PyroclasticFlow",e.QuickenTheEarthsStruggles="QuickenTheEarthsStruggles",e.RadiantAndHallowedGrove="RadiantAndHallowedGrove",e.RadiatingTremors="RadiatingTremors",e.RagingStorm="RagingStorm",e.RainAndMudSuppressConflict="RainAndMudSuppressConflict",e.RainOfAsh="RainOfAsh",e.RainOfBlood="RainOfBlood",e.RangingHunt="RangingHunt",e.RavagedUndergrowthSlithersBackToLife="RavagedUndergrowthSlithersBackToLife",e.RazorsharpUndergrowth="RazorsharpUndergrowth",e.ReachFromTheInfiniteDarkness="ReachFromTheInfiniteDarkness",e.ReachingGrasp="ReachingGrasp",e.ReclaimedByTheDeeps="ReclaimedByTheDeeps",e.RegrowFromRoots="RegrowFromRoots",e.RenewingBoon="RenewingBoon",e.RenewingRain="RenewingRain",e.ResoundingFootfallsSowDismay="ResoundingFootfallsSowDismay",e.RevokeSanctuaryAndCastOut="RevokeSanctuaryAndCastOut",e.RitesOfTheLandsRejection="RitesOfTheLandsRejection",e.RitualsOfDestruction="RitualsOfDestruction",e.RiversBounty="RiversBounty",e.RoilingBogAndSnaggingThorn="RoilingBogAndSnaggingThorn",e.RouseTheTreesAndStones="RouseTheTreesAndStones",e.RumblingEarthquakes="RumblingEarthquakes",e.RumblingsPortendAGreaterQuake="RumblingsPortendAGreaterQuake",e.SacrosanctWilderness="SacrosanctWilderness",e.SanguinaryTaint="SanguinaryTaint",e.SapTheStrengthOfMultitudes="SapTheStrengthOfMultitudes",e.SavageMawbeasts="SavageMawbeasts",e.SavageRevenge="SavageRevenge",e.SavageTransformation="SavageTransformation",e.ScarredAndStonyLand="ScarredAndStonyLand",e.ScatterToTheWinds="ScatterToTheWinds",e.ScorchWithWavesOfHeat="ScorchWithWavesOfHeat",e.ScorchingConvergence="ScorchingConvergence",e.ScourTheLand="ScourTheLand",e.ScreamDiseaseIntoTheWind="ScreamDiseaseIntoTheWind",e.SeaMonsters="SeaMonsters",e.SearAngerIntoTheWildLands="SearAngerIntoTheWildLands",e.SerpentRousesInAnger="SerpentRousesInAnger",e.SerpentWakesInPower="SerpentWakesInPower",e.SetThemOnAnEvertwistingTrail="SetThemOnAnEvertwistingTrail",e.SettleIntoHuntinggrounds="SettleIntoHuntinggrounds",e.ShadowsOfTheBurningForest="ShadowsOfTheBurningForest",e.ShapeTheSelfAnew="ShapeTheSelfAnew",e.ShareMentorshipAndExpertise="ShareMentorshipAndExpertise",e.ShareSecretsOfSurvival="ShareSecretsOfSurvival",e.ShatterHomesteads="ShatterHomesteads",e.ShelterUnderToweringBranches="ShelterUnderToweringBranches",e.SiderealGuidance="SiderealGuidance",e.SkiesHeraldTheSeasonOfReturn="SkiesHeraldTheSeasonOfReturn",e.SkyStretchesToShore="SkyStretchesToShore",e.SleepAndNeverWaken="SleepAndNeverWaken",e.SlipTheFlowOfTime="SlipTheFlowOfTime",e.SmashStompAndFlatten="SmashStompAndFlatten",e.SmiteTheLandWithFulmination="SmiteTheLandWithFulmination",e.SmotheringInfestation="SmotheringInfestation",e.SocietyDissolvesAtTheBeckoningHeart="SocietyDissolvesAtTheBeckoningHeart",e.SoftlyBeckonEverInward="SoftlyBeckonEverInward",e.SolidifyEchoesOfMajestyPast="SolidifyEchoesOfMajestyPast",e.SongOfSanctity="SongOfSanctity",e.SpillBitternessIntoTheEarth="SpillBitternessIntoTheEarth",e.SpiritsMayYetDream="SpiritsMayYetDream",e.SpreadingAndDreadfulMire="SpreadingAndDreadfulMire",e.SpreadingWilds="SpreadingWilds",e.SpurOnWithWordsOfFire="SpurOnWithWordsOfFire",e.StarsBlazeInTheDaytimeSky="StarsBlazeInTheDaytimeSky",e.SteamVents="SteamVents",e.StemTheFlowOfFreshWater="StemTheFlowOfFreshWater",e.StingingSandstorm="StingingSandstorm",e.Stormswath="Stormswath",e.StranglingFirevine="StranglingFirevine",e.StrengthOfTheWakingIsland="StrengthOfTheWakingIsland",e.StretchOutCoilsOfForebodingDread="StretchOutCoilsOfForebodingDread",e.StrikeLowWithSuddenFevers="StrikeLowWithSuddenFevers",e.StrongAndConstantCurrents="StrongAndConstantCurrents",e.StubbornSolidity="StubbornSolidity",e.StudyTheInvadersFears="StudyTheInvadersFears",e.SuckingOoze="SuckingOoze",e.SuddenAmbush="SuddenAmbush",e.SuffocatingShroud="SuffocatingShroud",e.SunsetsFireFlowsAcrossTheLand="SunsetsFireFlowsAcrossTheLand",e.SurgingLahar="SurgingLahar",e.SurroundedByTheDahan="SurroundedByTheDahan",e.SwallowTheLanddwellers="SwallowTheLanddwellers",e.SwallowedByTheEndlessDark="SwallowedByTheEndlessDark",e.SwallowedByTheWilderness="SwallowedByTheWilderness",e.SwarmingWasps="SwarmingWasps",e.SweepIntoTheSea="SweepIntoTheSea",e.SwelteringExhaustion="SwelteringExhaustion",e.SwirlAndSpill="SwirlAndSpill",e.TalonsOfLightning="TalonsOfLightning",e.TeemingRivers="TeemingRivers",e.TeethGleamFromDarkness="TeethGleamFromDarkness",e.TempestOfLeavesAndBranches="TempestOfLeavesAndBranches",e.TerrifyingChase="TerrifyingChase",e.TerrifyingNightmares="TerrifyingNightmares",e.TerrifyingRampage="TerrifyingRampage",e.TerritorialStrife="TerritorialStrife",e.TerrorOfTheHunted="TerrorOfTheHunted",e.TerrorTurnsToMadness="TerrorTurnsToMadness",e.TheBurnedLandRegrows="TheBurnedLandRegrows",e.TheFogClosesIn="TheFogClosesIn",e.TheJungleHungers="TheJungleHungers",e.TheLandThrashesInFuriousPain="TheLandThrashesInFuriousPain",e.ThePastReturnsAgain="ThePastReturnsAgain",e.TheShoreSeethesWithHatred="TheShoreSeethesWithHatred",e.TheTeemingHostArrives="TheTeemingHostArrives",e.TheTreesAndStonesSpeakOfWar="TheTreesAndStonesSpeakOfWar",e.TheWoundedWildTurnsOnItsAssailants="TheWoundedWildTurnsOnItsAssailants",e.ThicketsEruptWithEveryTouchOfBreeze="ThicketsEruptWithEveryTouchOfBreeze",e.ThreateningFlames="ThreateningFlames",e.ThrivingChokefungus="ThrivingChokefungus",e.ThunderingDestruction="ThunderingDestruction",e.TidalBoon="TidalBoon",e.TigersHunting="TigersHunting",e.TooNearTheJungle="TooNearTheJungle",e.TormentingRotflies="TormentingRotflies",e.ToweringWrath="ToweringWrath",e.TransformToAMurderousDarkness="TransformToAMurderousDarkness",e.TransformativeSacrifice="TransformativeSacrifice",e.TravelersBoon="TravelersBoon",e.TreacherousWaterways="TreacherousWaterways",e.TreesRadiateCelestialBrilliance="TreesRadiateCelestialBrilliance",e.Tsunami="Tsunami",e.TurmoilsTouch="TurmoilsTouch",e.TwilightFogBringsMadness="TwilightFogBringsMadness",e.TwistPerceptions="TwistPerceptions",e.TwistedFlowersMurmurUltimatums="TwistedFlowersMurmurUltimatums",e.UnbearableDeluge="UnbearableDeluge",e.UnbearableGaze="UnbearableGaze",e.UnbelievableRegrowth="UnbelievableRegrowth",e.UncannyMelting="UncannyMelting",e.UnearthABeastOfWrathfulStone="UnearthABeastOfWrathfulStone",e.UnexpectedTigers="UnexpectedTigers",e.UnleashATorrentOfTheSelfsOwnEssence="UnleashATorrentOfTheSelfsOwnEssence",e.UnlockTheGatesOfDeepestPower="UnlockTheGatesOfDeepestPower",e.UnnervingPall="UnnervingPall",e.UnquenchableFlames="UnquenchableFlames",e.UnrelentingGrowth="UnrelentingGrowth",e.UtterACurseOfDreadAndBone="UtterACurseOfDreadAndBone",e.VanishSoftlyAwayForgottenByAll="VanishSoftlyAwayForgottenByAll",e.VeilTheNightsHunt="VeilTheNightsHunt",e.VengeanceOfTheDead="VengeanceOfTheDead",e.VigorOfTheBreakingDawn="VigorOfTheBreakingDawn",e.ViolentWindstorms="ViolentWindstorms",e.VisionsOfAShiftingFuture="VisionsOfAShiftingFuture",e.VisionsOfFieryDoom="VisionsOfFieryDoom",e.VoiceOfCommand="VoiceOfCommand",e.VoiceOfThunder="VoiceOfThunder",e.VolcanicEruption="VolcanicEruption",e.VoraciousGrowth="VoraciousGrowth",e.WallsOfRockAndThorn="WallsOfRockAndThorn",e.WardTheShores="WardTheShores",e.WarnOfImpendingConflict="WarnOfImpendingConflict",e.WashAway="WashAway",e.WaterEatsAwayTheDeepRootsOfEarth="WaterEatsAwayTheDeepRootsOfEarth",e.WaterNourishesLifesGrowth="WaterNourishesLifesGrowth",e.WaysOfShoreAndHeartland="WaysOfShoreAndHeartland",e.WeaveTogetherTheFabricOfPlace="WeaveTogetherTheFabricOfPlace",e.WeepForWhatIsLost="WeepForWhatIsLost",e.WhisperedGuidanceThroughTheNight="WhisperedGuidanceThroughTheNight",e.WhyDontYouAndThemFight="WhyDontYouAndThemFight",e.WindsOfRustAndAtrophy="WindsOfRustAndAtrophy",e.WitherBodiesScarStones="WitherBodiesScarStones",e.WoodSeeksGrowthHumansSeekFreedom="WoodSeeksGrowthHumansSeekFreedom",e.WordsOfWarning="WordsOfWarning",e.WrackWithPainAndGrief="WrackWithPainAndGrief",e.WrapInWingsOfSunlight="WrapInWingsOfSunlight"}(_e||(_e={}));const Ze="After the next Invader Phase (on any turn) with no Ravage/Build Actions in target land: 3 <fear>. 12 Damage. Add 1 <beasts>. You may Push that <beasts>. 1 <fear> and 2 Damage in its land.",ea=`${Ze}<br><br>If you have 2 <moon> 3 <earth> 3 <animal>:<br>Mark it (<marked-beast>), <marked-beast> can't leave the island. Each <slow> phase: You may Push <marked-beast>. 1 <fear> and 2 Damage at <marked-beast>.`,aa={name:"Unearth A Beast Of Wrathful Stone",type:o.Major,speed:d.Fast,energy:5,elements:[i.Moon,i.Fire,i.Earth,i.Animal],set:s.NatureIncarnate,target:c.Land,sourceFilter:[l.SacredSite],targetFilter:[l.Invaders],range:1,hasPushOrGather:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.579,.943],text:ea,[r.InTargetLand]:async({$:e,you:a,land:t,power:n})=>{const s=e.phase===Xe.FastPowers?e.turn:e.turn+1;let o=!1;const d=await a.askToConvertElements({[i.Moon]:2,[i.Earth]:3,[i.Animal]:3}),c=d?ea:Ze;await e.addSubEffect({[r.Reminder]:e=>e===t?c:void 0,[r.AfterRavaging]:e=>(e.land===t&&(o=!0),Promise.resolve()),[r.AfterSuccessfulBuild]:e=>(e.land===t&&(o=!0),Promise.resolve()),[r.AfterFastPhase]:()=>(o=!1,Promise.resolve()),[r.AfterInvaderPhase]:async()=>{!o&&e.turn>=s&&await e.doPowerAction(a,(async()=>{await e.addSubEffect({effects:[{textArea:[.654,.695],text:"3 <fear>.",[r.Now]:async()=>{await t.fear(3)}},{textArea:[.654,.695],text:"12 Damage.",[r.Now]:async()=>{await t.damage(12)}},{textArea:[.654,.695],text:"Add 1 <beasts>.",[r.Now]:async({action:a})=>{const n=await t.add(1,e.Beasts);n.length>0&&(a.data.beast=n[0].piece)}},{textArea:[.654,.729],text:"You may Push that <beasts>.",[r.Now]:async({action:e})=>{const a=e.data.beast;await a.push({quantifier:w.May})}},{textArea:[.688,.729],text:"1 <fear> and 2 Damage in its land.",[r.Now]:async({action:e})=>{const a=e.data.beast;null!=a.location&&(await a.location.fear(1),await a.location.damage(2))}},{textArea:[.721,.946],text:"If you have 2 <moon> 3 <earth> 3 <animal>:<br>Mark it (<marked-beast>), <marked-beast> can't leave the island. Each <slow> phase: You may Push <marked-beast>. 1 <fear> and 2 Damage at <marked-beast>.",[r.Now]:async({action:t})=>{if(await a.askToConvertElements({[i.Moon]:2,[i.Earth]:3,[i.Animal]:3})){const i=t.data.beast;d&&await i.mark(),await e.addSubEffect({[r.PreventRemovePiece]:({piece:e,removement:a})=>Promise.resolve(e===i&&a!==A.Relocate&&a!==A.Silent)}),await a.addExtraAction({actionId:`MarkBeast-${i.id}`,icon:"<marked-beast>",text:"You may Push <marked-beast>. 1 <fear> and 2 Damage at <marked-beast>.",enabled:()=>e.phase===Xe.SlowPowers,onActivate:async()=>{void 0!==i.location&&await e.doPowerAction(a,(async()=>{await e.addSubEffect({card:_e.UnearthABeastOfWrathfulStone,effects:[{textArea:[.86,.901],text:"You may Push <marked-beast>.",[r.Now]:async()=>{await i.push({quantifier:w.May})}},{textArea:[.899,.94],text:"1 <fear> and 2 Damage at <marked-beast>.",[r.Now]:async()=>{await(i.location?.fear(1)),await(i.location?.damage(2))}}]})}),n)}})}}}]}),e.removeThisEffect()}),n)}})}}]},ta={name:"Call Of The Dahan Ways",type:o.Minor,speed:d.Slow,energy:1,elements:[i.Moon,i.Water,i.Animal],set:s.Base,target:c.Land,targetFilter:[l.Dahan],range:1,effects:[{textArea:[.657,.94],text:"Replace 1 <explorer> with 1 <dahan>.<br><br>If you have 2 <moon>:<br>You may instead replace 1 <town> with 1 <dahan>.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await t.replaceOne({pieces:await a.askToConvertElements({[i.Moon]:2})?e.ExplorerOrTown:e.Explorer,withPiece:p.Dahan})}}]},na={name:"Call to Bloodshed",type:o.Minor,speed:d.Slow,energy:1,elements:[i.Sun,i.Fire,i.Animal],set:s.Base,target:c.Land,targetFilter:[l.Dahan],range:1,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{textArea:[.696,.837],text:"1 Damage per <dahan>.<or>Gather up to 3 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"DamagePerDahan",textArea:[.703,.743],text:"1 Damage per <dahan>.",[r.Now]:async()=>{await a.damage(a.numberOf(e.Dahan))}},{actionId:"GatherDahan",textArea:[.791,.831],text:"Gather up to 3 <dahan>.",[r.Now]:async()=>{await a.gatherUpTo(3,e.Dahan)}}]})}}]},ra={name:"Call to Isolation",type:o.Minor,speed:d.Fast,energy:0,elements:[i.Sun,i.Air,i.Animal],set:s.Base,target:c.Land,targetFilter:[l.Dahan],range:1,hasPushOrGather:!0,effects:[{textArea:[.696,.837],text:"Push 1 <explorer>/<town> per <dahan>.<or>Push 1 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"PushExplorerOrTown",textArea:[.707,.747],text:"Push 1 <explorer>/<town> per <dahan>.",[r.Now]:async()=>{await a.push({amount:a.numberOf(e.Dahan),pieces:e.ExplorerOrTown})}},{actionId:"PushDahan",textArea:[.792,.832],text:"Push 1 <dahan>.",[r.Now]:async()=>{await a.push({amount:1,pieces:e.Dahan})}}]})}}]},ia={name:"Call To Migrate",type:o.Minor,speed:d.Slow,energy:1,elements:[i.Fire,i.Air,i.Animal],set:s.Base,target:c.Land,range:1,hasPushOrGather:!0,effects:[{textArea:[.705,.745],text:"Gather up to 3 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(3,e.Dahan)}},{textArea:[.75,.79],text:"Push up to 3 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(3,e.Dahan)}}]},sa={name:"Call To Tend",type:o.Minor,speed:d.Slow,energy:1,elements:[i.Water,i.Plant,i.Animal],set:s.Base,target:c.Land,targetFilter:[l.Dahan],range:1,hasPushOrGather:!0,effects:[{textArea:[.699,.835],text:"Remove 1 <blight>.<or>Push up to 3 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"RemoveBlight",textArea:[.703,.743],text:"Remove 1 <blight>.",[r.Now]:async()=>{await a.removeBlight()}},{actionId:"PushDahan",textArea:[.788,.828],text:"Push up to 3 <dahan>.",[r.Now]:async()=>{await a.pushUpTo(3,e.Dahan)},condition:()=>a.isLand}]})}}]},oa={name:"Dark And Tangled Woods",type:o.Minor,speed:d.Fast,energy:1,elements:[i.Moon,i.Earth,i.Plant],set:s.Base,target:c.Land,range:1,generatesFear:!0,effects:[{textArea:[.68,.72],text:"2 <fear>",[r.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.762,.854],text:"If target land is <mountains-jungles>, Defend 3.",[r.InTargetLand]:async({land:e})=>{e.isMountainsOrJungles&&await e.defend(3)}}]},da={name:"Delusions of Danger",type:o.Minor,speed:d.Fast,energy:1,elements:[i.Sun,i.Moon,i.Air],set:s.Base,target:c.Land,range:1,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.705,.837],text:"Push 1 <explorer>.<or>2 <fear>.",[r.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"PushExplorer",textArea:[.705,.745],text:"Push 1 <explorer>.",[r.Now]:async()=>{await a.pushOne(e.Explorer)}},{actionId:"Fear",textArea:[.786,.837],text:"2 <fear>.",[r.Now]:async()=>{await a.fear(2)}}]})}}]},ca={name:"Devouring Ants",type:o.Minor,speed:d.Slow,energy:1,elements:[i.Sun,i.Earth,i.Animal],set:s.Base,target:c.Land,sourceFilter:[l.SacredSite],range:1,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{textArea:[.636,.676],text:"1 fear.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.68,.72],text:"1 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(1)}},{textArea:[.722,.762],text:"Destroy 1 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.destroyOne(e.Dahan)}},{textArea:[.807,.894],text:"If target land is <jungles-sands>, +1 Damage.",[r.InTargetLand]:async({land:e})=>{e.isJungleOrSands&&await e.damage(1)}}]},la={name:"Drift Down Into Slumber",type:o.Minor,speed:d.Fast,energy:0,elements:[i.Air,i.Earth,i.Plant],set:s.Base,target:c.Land,range:2,fullText:["Defend 1.","If target land is <jungles-sands> instead, Defend 4."],effects:[{[r.InTargetLand]:async({$:e,land:a})=>{a.isJungleOrSands?await e.addSubEffect({textArea:[.762,.854],text:"If target land is <jungles-sands> instead, Defend 4.",[r.Now]:async()=>{await a.defend(4)}}):await e.addSubEffect({textArea:[.68,.72],text:"Defend 1.",[r.Now]:async()=>{await a.defend(1)}})}}]},ha={name:"Drought",type:o.Minor,speed:d.Slow,energy:1,elements:[i.Sun,i.Fire,i.Earth],set:s.Base,target:c.Land,range:1,blightWhiteListedPower:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{textArea:[.62,.66],text:"Destroy 3 <town>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.destroy({amount:3,pieces:e.Town})}},{textArea:[.664,.704],text:"1 Damage to each <town>/<city>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.damageEach(1,e.TownOrCity)}},{textArea:[.707,.747],text:"Add 1 <blight>.",[r.InTargetLand]:async({land:e})=>{await e.addBlight(1)}},{textArea:[.877,.93],text:"If you have 3 <sun>: Destroy 1 <city>.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[i.Sun]:3})&&await t.destroyOne(e.City)}}]},ga={name:"Elemental Boon",type:o.Minor,speed:d.Fast,energy:1,elements:[],set:s.Base,target:c.Spirit,effects:[{textArea:[.656,.883],text:"Target Spirit gains 3 different Elements of their choice.<br><br>If you target another Spirit, you also gain the chosen Elements.",[r.TargetSpirit]:async({you:e,spirit:a})=>{const t=await a.gainElements({amount:3,different:!0});a!==e&&await e.gainElementsUntilEndOfTurn(t)}}]},fa={name:"Encompassing Ward",type:o.Minor,speed:d.Fast,energy:1,elements:[i.Sun,i.Water,i.Earth],set:s.Base,target:c.Spirit,effects:[{textArea:[.717,.809],text:"Target Spirit provides Defend 2 in each of its lands.",[r.TargetSpirit]:async({$:e,spirit:a})=>{await e.addSubEffectUntilEndOfTurn({[r.DefendFromSpirits]:({land:e})=>e.hasPresenceOf(a)?2:0})}}]},ua={name:"Enticing Splendor",type:o.Minor,speed:d.Fast,energy:0,elements:[i.Sun,i.Air,i.Plant],set:s.Base,target:c.Land,targetFilter:[l.NonBlight],range:0,hasPushOrGather:!0,effects:[{textArea:[.699,.837],text:"Gather 1 <explorer>/<town>.<or>Gather up to 2 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"GatherExplorerOrTown",textArea:[.705,.745],text:"Gather 1 <explorer>/<town>.",[r.Now]:async()=>{await a.gatherOne(e.ExplorerOrTown)}},{actionId:"GatherDahan",textArea:[.792,.832],text:"Gather up to 2 <dahan>.",[r.Now]:async()=>{await a.gatherUpTo(2,e.Dahan)}}]})}}]},pa={name:"Entrancing Apparitions",type:o.Minor,speed:d.Fast,energy:1,elements:[i.Moon,i.Air,i.Water],set:s.Base,target:c.Land,range:1,hasPushOrGather:!0,effects:[{textArea:[.663,.703],text:"Defend 2.",[r.InTargetLand]:async({land:e})=>{await e.defend(2)}},{textArea:[.749,.84],text:"If no Invaders are present, Gather up to 2 <explorer>.",[r.InTargetLand]:async({$:e,land:a})=>{a.doesntHave(e.Invader)&&await a.gatherUpTo(2,e.Explorer)}}]},wa={name:"Gift Of Constancy",type:o.Minor,speed:d.Fast,energy:0,elements:[i.Sun,i.Earth],set:s.Base,target:c.Spirit,effects:[{textArea:[.598,.638],text:"Target Spirit gains 2 Energy.",[r.TargetSpirit]:async({spirit:e})=>{await e.gainEnergy(2)}},{textArea:[.641,.769],text:"At end of turn, target Spirit may Reclaim 1 Power Card instead of discarding it.",[r.TargetSpirit]:async({power:e,spirit:a})=>{await a.mayReclaimPowerCardInsteadOfDiscarding(e)}},{textArea:[.812,.943],text:"If you target another Spirit, you may also Reclaim 1 Power Card instead of discarding it.",[r.TargetSpirit]:async({you:e,power:a,spirit:t})=>{t!==e&&await e.mayReclaimPowerCardInsteadOfDiscarding(a)}}]},ya={name:"Gift Of Living Energy",type:o.Minor,speed:d.Fast,energy:0,elements:[i.Sun,i.Fire,i.Plant],set:s.Base,target:c.Spirit,effects:[{textArea:[.631,.671],text:"Target Spirit gains 1 Energy.",[r.TargetSpirit]:async({spirit:e})=>{await e.gainEnergy(1)}},{textArea:[.674,.761],text:"+1 Energy if target Spirit is not yourself.",[r.TargetSpirit]:async({you:e,spirit:a})=>{a!==e&&await a.gainEnergy(1)}},{textArea:[.804,.893],text:"If you have at least 2 <sacred>, target Spirit gains +1 Energy.",[r.TargetSpirit]:async({you:e,spirit:a})=>{e.inSacredSites().count>=2&&await a.gainEnergy(1)}}]},ma={name:"Gift Of Power",type:o.Minor,speed:d.Slow,energy:0,elements:[i.Moon,i.Water,i.Earth,i.Plant],set:s.Base,target:c.Spirit,effects:[{textArea:[.713,.808],text:"Target Spirit gains a Minor Power Card.",[r.TargetSpirit]:async({spirit:e})=>{await e.gainPowerCard({powerType:o.Minor})}}]},va={name:"Gnawing Rootbiters",type:o.Minor,speed:d.Slow,energy:0,elements:[i.Earth,i.Animal],set:s.Base,target:c.Land,range:1,hasPushOrGather:!0,effects:[{textArea:[.748,.788],text:"Push up to 2 <town>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(2,e.Town)}}]},Ia={name:"Land Of Haunts And Embers",type:o.Minor,speed:d.Fast,energy:0,elements:[i.Moon,i.Fire,i.Air],set:s.Base,target:c.Land,range:2,hasPushOrGather:!0,blightWhiteListedPower:!0,generatesFear:!0,effects:[{textArea:[.636,.676],text:"2 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.636,.676],text:"Push up to 2 <explorer>/<town>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(2,e.ExplorerOrTown)}},{textArea:[.723,.763],text:"If target land has <blight>, +2 <fear>.",[r.InTargetLand]:async({$:e,land:a})=>{a.has(e.Blight)&&await a.fear(2)}},{textArea:[.769,.809],text:"Push up to 2 more <explorer>/<town>.",[r.InTargetLand]:async({$:e,land:a})=>{a.has(e.Blight)&&await a.pushUpTo(2,e.ExplorerOrTown)}},{textArea:[.858,.898],text:"Add 1 <blight>",[r.InTargetLand]:async({land:e})=>{await e.addBlight(1)}}]},Aa={name:"Lure Of The Unknown",type:o.Minor,speed:d.Fast,energy:0,elements:[i.Moon,i.Fire,i.Air,i.Plant],set:s.Base,target:c.Land,targetFilter:[l.NoInvaders],range:2,hasPushOrGather:!0,effects:[{textArea:[.75,.79],text:"Gather 1 <explorer>/<town>",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherOne(e.ExplorerOrTown)}}]},xa={name:"Natures Resilience",type:o.Minor,speed:d.Fast,energy:1,elements:[i.Earth,i.Plant,i.Animal],set:s.Base,target:c.Land,sourceFilter:[l.SacredSite],range:1,blightWhiteListedPower:!0,effects:[{textArea:[.653,.926],text:"Defend 6.<br><br>If you have 2 <water>: You may instead remove 1 <blight>.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await e.chooseBetween({effects:[{actionId:"Defend",textArea:[.663,.703],text:"Defend 6.",[r.Now]:async()=>{await t.defend(6)},condition:()=>t.isLand},{actionId:"RemoveBlight",textArea:[.881,.921],text:"Remove 1 <blight>.",[r.Now]:async()=>{await a.convertElements({[i.Water]:2}),await t.removeBlight()},condition:()=>a.hasElementsWithConvert({[i.Water]:2})}]},{orChoice:!1})}}]},ba={name:"Pull Beneath The Hungry Earth",type:o.Minor,speed:d.Slow,energy:1,elements:[i.Moon,i.Water,i.Earth],set:s.Base,target:c.Land,range:1,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.661,.75],text:"If target land has your <presence>, 1 <fear> and 1 Damage.",[r.InTargetLand]:async({land:e,you:a})=>{e.hasPresenceOf(a)&&(await e.fear(1),await e.damage(1))}},{textArea:[.785,.878],text:"If target land is <sands-wetlands>, 1 Damage.",[r.InTargetLand]:async({land:e})=>{e.isSandsOrWetlands&&await e.damage(1)}}]},Ta={name:"Purifying Flame",type:o.Minor,speed:d.Slow,energy:1,elements:[i.Sun,i.Fire,i.Air,i.Plant],set:s.Base,target:c.Land,sourceFilter:[l.SacredSite],range:1,hasDamageInstructions:!0,effects:[{textArea:[.67,.864],text:"1 Damage per <blight>. If target land is <mountains>/<sands>, you may instead remove 1 <blight>.",[r.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"DamagePerBlight",textArea:[.679,.719],text:"1 Damage per <blight>.",[r.Now]:async()=>{await a.damage(a.numberOf(e.Blight))}},{actionId:"RemoveBlight",textArea:[.759,.864],text:"Remove 1 <blight>.",[r.Now]:async()=>{await a.removeBlight()},condition:()=>a.isMountainsOrSands}]},{orChoice:!1})}}]},Ea={name:"Quicken The Earths Struggles",type:o.Minor,speed:d.Fast,energy:1,elements:[i.Moon,i.Fire,i.Earth,i.Animal],set:s.Base,target:c.Land,sourceFilter:[l.SacredSite],range:0,hasDamageInstructions:!0,effects:[{textArea:[.693,.842],text:"1 Damage to each <town>/<city>.<or>Defend 10",[r.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"DamageToEach",textArea:[.707,.747],text:"1 Damage to each <town>/<city>.",[r.Now]:async()=>{await a.damageEach(1,e.TownOrCity)}},{actionId:"Defend",textArea:[.792,.832],text:"Defend 10.",[r.Now]:async()=>{await a.defend(10)}}]})}}]},Pa={name:"Rain Of Blood",type:o.Minor,speed:d.Slow,energy:0,elements:[i.Air,i.Water,i.Animal],set:s.Base,target:c.Land,sourceFilter:[l.SacredSite],targetFilter:[l.Invaders],range:1,generatesFear:!0,effects:[{textArea:[.659,.699],text:"2 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.748,.883],text:"If target land has at least 2 <town>/<city>, +1 <fear>.",[r.InTargetLand]:async({$:e,land:a})=>{a.hasAtLeast(2,e.TownOrCity)&&await a.fear(1)}}]},Sa={name:"Reaching Grasp",type:o.Minor,speed:d.Fast,energy:0,elements:[i.Sun,i.Air,i.Water],set:s.Base,target:c.Spirit,effects:[{textArea:[.716,.814],text:"Target Spirit gets +2 range with all their Powers.",[r.TargetSpirit]:async({$:e,power:a,spirit:t})=>{await e.addSubEffectUntilEndOfTurn({[r.GlobalReminder]:()=>({power:a.power,players:[t]}),[r.ExtraRange]:e=>e.spirit===t?2:0})}}]},Oa={name:"Rouse The Trees And Stones",type:o.Minor,speed:d.Slow,energy:1,elements:[i.Fire,i.Earth,i.Plant],set:s.Base,target:c.Land,sourceFilter:[l.SacredSite],targetFilter:[l.NonBlight],range:1,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{textArea:[.722,.762],text:"2 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(2)}},{textArea:[.766,.806],text:"Push 1 <explorer>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushOne(e.Explorer)}}]},Ca={name:"Sap The Strength Of Multitudes",type:o.Minor,speed:d.Fast,energy:0,elements:[i.Water,i.Animal],set:s.Base,target:c.Land,range:0,modifiesRange:({spirit:e,withConvert:a})=>e.hasElements({[i.Air]:1},a)?1:0,payForRange:async({spirit:e})=>{await e.convertElements({[i.Air]:1})},fullText:["Defend 5.","If you have 1 <air>:<br>Increase this Power's Range by 1"],effects:[{textArea:[.664,.704],text:"Defend 5.",[r.InTargetLand]:async({land:e})=>{await e.defend(5)}}]},Da={name:"Savage Mawbeasts",type:o.Minor,speed:d.Slow,energy:0,elements:[i.Fire,i.Animal],set:s.Base,target:c.Land,sourceFilter:[l.SacredSite],range:1,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.636,.739],text:"If target land is <jungles-wetlands>, 1 <fear> and 1 Damage.",[r.InTargetLand]:async({land:e})=>{e.isJungleOrWetlands&&(await e.fear(1),await e.damage(1))}},{textArea:[.894,.934],text:"If you have 3 <animal>: 1 Damage.",[r.InTargetLand]:async({you:e,land:a})=>{await e.askToConvertElements({[i.Animal]:3})&&await a.damage(1)}}]},Ba={name:"Shadows Of The Burning Forest",type:o.Minor,speed:d.Slow,energy:0,elements:[i.Moon,i.Fire,i.Plant],set:s.Base,target:c.Land,targetFilter:[l.Invaders],range:0,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.66,.7],text:"2 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.745,.853],text:"If target land is <mountains-jungles>, Push 1 <explorer> and 1 <town>.",[r.InTargetLand]:async({$:e,land:a})=>{a.isMountainsOrJungles&&(await a.pushOne(e.Explorer),await a.pushOne(e.Town))}}]},ka={name:"Song Of Sanctity",type:o.Minor,speed:d.Slow,energy:1,elements:[i.Sun,i.Water,i.Plant],set:s.Base,target:c.Land,targetFilter:[l.Mountain,l.Jungle],range:1,hasPushOrGather:!0,effects:[{textArea:[.673,.863],text:"If target land has <explorer>, Push all <explorer>. Otherwise, remove 1 <blight>.",[r.InTargetLand]:async({$:e,land:a})=>{a.isLand&&a.has(e.Explorer)?await e.addSubEffect({textArea:[.673,.773],text:"If target land has <explorer>, Push all <explorer>.",[r.Now]:async()=>{await a.pushAll(e.Explorer)}}):await e.addSubEffect({textArea:[.815,.855],text:"Otherwise, remove 1 <blight>.",[r.Now]:async()=>{await a.removeBlight()}})}}]},La={name:"Steam Vents",type:o.Minor,speed:d.Fast,energy:1,elements:[i.Fire,i.Air,i.Water,i.Earth],set:s.Base,target:c.Land,range:0,hasDestroyInstructions:!0,effects:[{textArea:[.647,.936],text:"Destroy 1 <explorer>.<br><br>If you have 3 <earth>: You may instead destroy 1 <town>.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await t.destroy({amount:1,pieces:await a.askToConvertElements({[i.Earth]:3})?e.ExplorerOrTown:e.Explorer})}}]},Fa={name:"Uncanny Melting",type:o.Minor,speed:d.Slow,energy:1,elements:[i.Sun,i.Moon,i.Water],set:s.Base,target:c.Land,sourceFilter:[l.SacredSite],range:1,blightWhiteListedPower:!0,generatesFear:!0,effects:[{textArea:[.671,.711],text:"If Invaders are present, 1 <fear>.",[r.InTargetLand]:async({land:e})=>{e.hasInvaders&&await e.fear(1)}},{textArea:[.752,.854],text:"If target land is <sands-wetlands>, remove 1 <blight>.",[r.InTargetLand]:async({land:e})=>{e.isSandsOrWetlands&&await e.removeBlight()}}]},Ra={name:"Veil The Nights Hunt",type:o.Minor,speed:d.Fast,energy:1,elements:[i.Moon,i.Air,i.Animal],set:s.Base,target:c.Land,targetFilter:[l.Dahan],range:2,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{textArea:[.669,.854],text:"Each <dahan> deals 1 Damage to a different Invader.<or>Push up to 3 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"DealDamage",textArea:[.669,.766],text:"Each <dahan> deals 1 Damage to a different Invader.",[r.Now]:async()=>{await a.damageDifferent(a.numberOf(e.Dahan),e.Invader)}},{actionId:"PushDahan",textArea:[.808,.848],text:"Push up to 3 <dahan>.",[r.Now]:async()=>{await a.pushUpTo(3,e.Dahan)}}]})}}]},Na={name:"Visions Of Fiery Doom",type:o.Minor,speed:d.Fast,energy:1,elements:[i.Moon,i.Fire],set:s.Base,target:c.Land,range:0,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.636,.676],text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.68,.72],text:"Push 1 <explorer>/<town>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushOne(e.ExplorerOrTown)}},{textArea:[.888,.928],text:"If you have 2 <fire>: +1 <fear>.",[r.InTargetLand]:async({you:e,land:a})=>{await e.askToConvertElements({[i.Fire]:2})&&await a.fear(1)}}]},$a={name:"Voracious Growth",type:o.Minor,speed:d.Slow,energy:1,elements:[i.Water,i.Plant],set:s.Base,target:c.Land,sourceFilter:[l.SacredSite],targetFilter:[l.Jungle,l.Wetlands],range:1,blightWhiteListedPower:!0,hasDamageInstructions:!0,effects:[{textArea:[.703,.837],text:"2 Damage.<or>Remove 1 <blight>.",[r.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"Damage",textArea:[.705,.745],text:"2 Damage.",[r.Now]:async()=>{await a.damage(2)}},{actionId:"RemoveBlight",textArea:[.792,.832],text:"Remove 1 <blight>.",[r.Now]:async()=>{await a.removeBlight()}}]})}}]},Wa={name:"Absorb Corruption",type:o.Minor,speed:d.Slow,energy:1,elements:[i.Sun,i.Earth,i.Plant],set:s.BranchAndClaw,target:c.Land,range:0,hasPushOrGather:!0,blightWhiteListedPower:!0,effects:[{textArea:[.61,.934],text:"Gather 1 <blight>.<or>Pay 1 Energy to remove 1 <blight>.<br><br>If you have 2 <plant>:<br>You may do both.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await e.chooseBetween({effects:[{actionId:"GatherBlight",textArea:[.615,.655],text:"Gather 1 <blight>",[r.Now]:async()=>{await t.gatherOne(e.Blight)},condition:()=>t.hasAdjacentLandWithPiece(e.Blight)},{actionId:"RemoveBlight",textArea:[.702,.742],text:"Pay 1 Energy to remove 1 <blight>.",[r.Now]:async()=>{await a.payEnergy(1),await t.removeBlight()},condition:()=>t.has(e.Blight)&&a.energy>=1},{actionId:"DoBoth",textArea:[.605,.752],text:"Do both.",[r.Now]:async()=>{await a.convertElements({[i.Plant]:2}),await e.addSubEffect({textArea:[.615,.655],text:"Gather 1 <blight>",[r.Now]:async()=>{await t.gatherOne(e.Blight)}}),await e.addSubEffect({textArea:[.702,.742],text:"Pay 1 Energy to remove 1 <blight>.",[r.Now]:async()=>{await a.payEnergy(1),await t.removeBlight()}})},condition:()=>a.hasElementsWithConvert({[i.Plant]:2})&&t.hasOrIsAdjacentToLandsWith(e.Blight)&&!e.treatingAllOrsAsAnds&&a.energy>=1}]})}}]},Ma={name:"Animated Wrackroot",type:o.Minor,speed:d.Slow,energy:0,elements:[i.Moon,i.Fire,i.Plant],set:s.BranchAndClaw,target:c.Land,range:0,generatesFear:!0,hasDestroyInstructions:!0,effects:[{textArea:[.696,.84],text:"1 <fear>. Destroy 1 <explorer>.<or>Add 1 <wilds>.",[r.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"Fear",textArea:[.705,.745],text:"1 <fear>. Destroy 1 <explorer>.",[r.Now]:async()=>{await a.fear(1),await a.destroyOne(e.Explorer)}},{actionId:"AddWilds",textArea:[.791,.831],text:"Add 1 <wilds>.",[r.Now]:async()=>{await a.add(1,e.Wilds)}}]})}}]},Ga={name:"Call to Ferocity",type:o.Minor,speed:d.Slow,energy:0,elements:[i.Sun,i.Fire,i.Earth],set:s.BranchAndClaw,targetFilter:[l.Invaders],target:c.Land,range:1,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.67,.863],text:"Gather up to 3 <dahan>.<or>If target land has <dahan>, 1 <fear> and Push 1 <explorer> and 1 <town>.",[r.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"GatherDahan",textArea:[.68,.72],text:"Gather up to 3 <dahan>.",[r.Now]:async()=>{await a.gatherUpTo(3,e.Dahan)}},{actionId:"FearAndPush",textArea:[.768,.863],text:"If target land has <dahan>, 1 <fear> and Push 1 <explorer> and 1 <town>.",[r.Now]:async()=>{a.has(e.Dahan)&&(await a.fear(1),await a.pushOne(e.Explorer),await a.pushOne(e.Town))}}]})}}]},Ha={name:"Call To Trade",type:o.Minor,speed:d.Fast,energy:1,elements:[i.Air,i.Water,i.Earth,i.Plant],set:s.BranchAndClaw,target:c.Land,targetFilter:[l.Dahan],range:2,hasPushOrGather:!0,effects:[{textArea:[.637,.677],text:"You may Gather 1 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.mayGather(e.Dahan)}},{text:"If the Terror Level is 2 or lower, Gather 1 <town> and the first Ravage in target land this turn becomes a Build there instead.",effects:[{textArea:[.72,.812],text:"Gather 1 <town>",[r.InTargetLand]:async({$:e,land:a})=>{e.terrorLevel<=2&&await a.gatherOne(e.Town)}},{textArea:[.768,.9],text:"The first Ravage in target land this turn becomes a Build there instead",[r.InTargetLand]:async({$:e,land:a})=>{e.terrorLevel<=2&&await a.skipInvaderAction({next:!0,filter:({invaderAction:e})=>e===K.Ravage,afterSkip:async({card:e})=>{await a.doExtraBuild(e)}})}}]}]},Ua={name:"Confounding Mists",type:o.Minor,speed:d.Fast,energy:1,elements:[i.Air,i.Water],set:s.BranchAndClaw,target:c.Land,range:1,hasPushOrGather:!0,effects:[{textArea:[.654,.878],text:"Defend 4.<or>Each Invader added to target land this turn may be immediately Pushed to any adjacent land.",[r.InTargetLand]:async({$:e,you:a,land:t,power:n})=>{await e.chooseBetween({effects:[{actionId:"Defend",textArea:[.66,.7],text:"Defend 4.",[r.Now]:async()=>{await t.defend(4)}},{actionId:"AddTrigger",textArea:[.745,.877],text:"Each Invader added to target land this turn may be immediately Pushed to any adjacent land.",[r.Now]:async({effect:i})=>{await e.addSubEffectUntilEndOfTurn({[r.Reminder]:e=>e===t?i.text:void 0,[r.AfterAddingPiece]:async r=>{if(r.land===t)for(const i of r.additions)i.location===t&&i.piece.isInvader&&await e.doPowerAction(a,(async()=>{await i.piece.push({quantifier:w.May})}),n)}})}}]})}}]},qa={name:"Cycles Of Time And Tide",type:o.Minor,speed:d.Fast,energy:1,elements:[i.Sun,i.Moon,i.Water],set:s.BranchAndClaw,target:c.Land,targetFilter:[l.Coastal],range:1,blightWhiteListedPower:!0,effects:[{textArea:[.69,.73],text:"If there are <dahan>, add 1 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{a.has(e.Dahan)&&await a.add(1,e.Dahan)}},{textArea:[.779,.819],text:"If there are no <dahan>, remove 1 <blight>.",[r.InTargetLand]:async({$:e,land:a})=>{a.has(e.Dahan)||await a.removeBlight()}}]},ja={name:"Disorienting Landscape",type:o.Minor,speed:d.Fast,energy:1,elements:[i.Moon,i.Air,i.Plant],set:s.BranchAndClaw,target:c.Land,sourceFilter:[l.SacredSite],range:2,hasPushOrGather:!0,effects:[{textArea:[.673,.713],text:"Push 1 <explorer>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushOne(e.Explorer)}},{textArea:[.755,.857],text:"If target land is <mountains-jungles>, add 1 <wilds>.",[r.InTargetLand]:async({$:e,land:a})=>{a.isMountainsOrJungles&&await a.add(1,e.Wilds)}}]},Ja={name:"Elusive Ambushes",type:o.Minor,speed:d.Fast,energy:1,elements:[i.Sun,i.Fire,i.Water],set:s.BranchAndClaw,target:c.Land,targetFilter:[l.Dahan],range:1,hasDamageInstructions:!0,effects:[{textArea:[.696,.827],text:"1 Damage.<or>Defend 4.",[r.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"Damage",textArea:[.696,.736],text:"1 Damage.",[r.Now]:async()=>{await a.damage(1)}},{actionId:"Defend",textArea:[.784,.824],text:"Defend 4.",[r.Now]:async()=>{await a.defend(4)}}]})}}]},Va={name:"Fire In The Sky",type:o.Minor,speed:d.Fast,energy:1,elements:[i.Sun,i.Fire,i.Air],set:s.BranchAndClaw,target:c.Land,sourceFilter:[l.SacredSite],range:1,generatesFear:!0,effects:[{textArea:[.722,.762],text:"2 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.773,.813],text:"Add 1 <strife>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Strife)}}]},Ya={name:"Fleshrot Fever",type:o.Minor,speed:d.Slow,energy:1,elements:[i.Fire,i.Air,i.Water,i.Animal],set:s.BranchAndClaw,target:c.Land,targetFilter:[l.Jungle,l.Sands],range:1,generatesFear:!0,effects:[{textArea:[.722,.762],text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.766,.806],text:"Add 1 <disease>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Disease)}}]},za={name:"Gold's Allure",type:o.Minor,speed:d.Slow,energy:0,elements:[i.Fire,i.Earth,i.Animal],set:s.BranchAndClaw,target:c.Land,targetFilter:[l.Mountain],range:1,hasPushOrGather:!0,effects:[{textArea:[.722,.762],text:"Gather 1 <explorer> and 1 <town>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherOne(e.Explorer),await a.gatherOne(e.Town)}},{textArea:[.773,.813],text:"Add 1 <strife>.",[r.InTargetLand]:async({land:e})=>{await e.addStrife(1)}}]},Qa={name:"Growth Through Sacrifice",type:o.Minor,speed:d.Fast,energy:0,elements:[i.Moon,i.Fire,i.Water,i.Plant],set:s.BranchAndClaw,target:c.Spirit,hasDestroyInstructions:!0,effects:[{textArea:[.59,.63],text:"Destroy 1 of your <presence>.",[r.TargetSpirit]:async({you:e})=>{await e.destroyPresence(1)}},{textArea:[.66,.799],text:"Target Spirit chooses to either:<br><br>Remove 1 <blight> from one of their lands.<or>Add 1 <presence> to one of their lands.<br><br>If you have 2 <sun>: They may do both, in the same land.",[r.TargetSpirit]:async({$:e,you:a,spirit:t})=>{await e.chooseBetween({effects:[{actionId:"RemoveBlight",textArea:[.69,.73],text:"Remove 1 <blight> from one of their lands.",label:"Remove <blight>.",[r.Now]:async()=>{await t.inLands().pickOne((async e=>{await e.removeBlight()}))}},{actionId:"AddPresence",textArea:[.758,.798],text:"Add 1 <presence> to one of their lands.",label:"Add <presence>.",[r.Now]:async()=>{await t.addPresence()}},{actionId:"DoBoth",textArea:[.693,.799],text:"Do both, in the same land.",label:"Do both.",[r.Now]:async()=>{await a.convertElements({[i.Sun]:2}),await t.inLands().pickOne((async a=>{await e.addSubEffect({textArea:[.69,.73],text:"Remove 1 <blight>.",[r.Now]:async()=>{await a.removeBlight()}}),await e.addSubEffect({textArea:[.758,.798],text:"Add <presence>.",[r.Now]:async()=>{await a.addPresence(t)}})}))},condition:()=>a.hasElementsWithConvert({[i.Sun]:2})&&!e.treatingAllOrsAsAnds}]})}}]},Ka={name:"Guardian Serpents",type:o.Minor,speed:d.Fast,energy:1,elements:[i.Sun,i.Moon,i.Earth,i.Animal],set:s.BranchAndClaw,target:c.Spirit,effects:[{textArea:[.64,.867],text:"Add 1 <beasts> in one of target Spirit's lands.<br><br>If target Spirit has a <sacred> in that land, Defend 4 there.",[r.TargetSpirit]:async({$:e,spirit:a})=>{await a.inLands().pickOne((async t=>{await t.add(1,e.Beasts),t.hasSacredSiteOf(a)&&await t.defend(4)}))}}]},Xa={name:"Here There Be Monsters",type:o.Minor,speed:d.Slow,energy:0,elements:[i.Moon,i.Air,i.Animal],set:s.BranchAndClaw,target:c.Land,targetFilter:[l.Inland],range:0,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.664,.704],text:"You may Push 1 <explorer>/<town>/<dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.mayPush(e.ExplorerTownOrDahan)}},{textArea:[.706,.746],text:"2 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.795,.883],text:"If target land has any <beasts>, 1 <fear>.",[r.InTargetLand]:async({$:e,land:a})=>{a.has(e.Beasts)&&await a.fear(1)}}]},_a={name:"Infested Aquifers",type:o.Minor,speed:d.Slow,energy:1,elements:[i.Moon,i.Water,i.Earth,i.Animal],set:s.BranchAndClaw,target:c.Land,range:0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.654,.89],text:"If target land has any <disease>, 1 Damage to each Invader.<or>If target land is <mountains-wetlands>, 1 <fear> and add 1 <disease>.",[r.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"DamageToEach",textArea:[.66,.749],text:"If target land has any <disease>, 1 Damage to each Invader.",[r.Now]:async()=>{a.has(e.Disease)&&await a.damageEach(1)}},{actionId:"FearAndAddDisease",textArea:[.785,.888],text:"If target land is <mountains-wetlands>, 1 <fear> and add 1 <disease>.",[r.Now]:async()=>{a.isMountainsOrWetlands&&(await a.fear(1),await a.add(1,e.Disease))}}]})}}]},Za={name:"Inflame The Fires Of Life",type:o.Minor,speed:d.Slow,energy:1,elements:[i.Moon,i.Fire,i.Plant,i.Animal],set:s.BranchAndClaw,target:c.Land,sourceFilter:[l.SacredSite],range:1,generatesFear:!0,effects:[{textArea:[.605,.934],text:"Add 1 <disease>.<or>1 <fear>. Add 1 <strife>.<br><br>If you have 3 <animal>: You may do both.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await e.chooseBetween({effects:[{actionId:"AddDisease",textArea:[.62,.66],text:"Add 1 <disease>.",[r.Now]:async()=>{await t.add(1,e.Disease)}},{actionId:"FearAndStrife",textArea:[.706,.746],text:"1 <fear>. Add 1 <strife>.",[r.Now]:async()=>{await t.fear(1),await t.addStrife(1)}},{actionId:"DoBoth",textArea:[.605,.756],text:"Do both.",[r.Now]:async()=>{await a.convertElements({[i.Animal]:3}),await e.addSubEffect({textArea:[.62,.66],text:"Add 1 <disease>.",[r.Now]:async()=>{await t.add(1,e.Disease)}}),await e.addSubEffect({textArea:[.706,.746],text:"1 <fear>. Add 1 <strife>.",[r.Now]:async()=>{await t.fear(1),await t.addStrife(1)}})},condition:()=>!e.treatingAllOrsAsAnds&&a.hasElementsWithConvert({[i.Animal]:3})}]})}}]},et={name:"Pact Of The Joined Hunt",type:o.Minor,speed:d.Slow,energy:1,elements:[i.Sun,i.Plant,i.Animal],set:s.BranchAndClaw,target:c.Spirit,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{textArea:[.67,.855],text:"Target Spirit Gathers 1 <dahan> into one of their lands. 1 Damage in that land per <dahan> present.",[r.TargetSpirit]:async({$:e,spirit:a})=>{await a.inLands().pickOne((async a=>{await a.gatherOne(e.Dahan),await a.damage(a.numberOf(e.Dahan))}))}}]},at={name:"Poisoned Dew",type:o.Minor,speed:d.Slow,energy:1,elements:[i.Fire,i.Water,i.Plant],set:s.BranchAndClaw,target:c.Land,range:1,hasDestroyInstructions:!0,effects:[{textArea:[.657,.848],text:"Destroy 1 <explorer>.<br><br>If target land is <jungles-wetlands>, destroy all <explorer>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.destroyOne(e.Explorer),a.isJungleOrWetlands&&await a.destroyAll(e.Explorer)}}]},tt={name:"Portents Of Disaster",type:o.Minor,speed:d.Fast,energy:0,elements:[i.Sun,i.Moon,i.Air],set:s.BranchAndClaw,target:c.Land,sourceFilter:[l.SacredSite],targetFilter:[l.Invaders],range:1,generatesFear:!0,effects:[{textArea:[.661,.701],text:"2 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.75,.881],text:"The next time an Invader is destroyed in target land this turn, 1 <fear>.",[r.InTargetLand]:async({$:e,land:a,...t})=>{const n={triggerId:e.nextTriggerId(),[r.Now]:async()=>{await e.sendEvent({type:T.GenericMain,text:"<p>PortentsOfDisaster</p> triggered from destroying an Invader."}),await a.fear(1)}};await e.addSubEffectUntilEndOfTurn({[r.Reminder]:e=>e===a?t.effect.text:void 0,[r.AfterRemovePiece]:async({piece:r,location:i,removement:s})=>{r.isInvader&&i===a&&x[s].isDestroyLike&&(await e.addTrigger(n,t.effect,t.action),e.removeThisEffect())}})}}]},nt={name:"Promises Of Protection",type:o.Minor,speed:d.Fast,energy:0,elements:[i.Sun,i.Earth,i.Animal],set:s.BranchAndClaw,target:c.Land,sourceFilter:[l.SacredSite],range:2,hasPushOrGather:!0,effects:[{textArea:[.703,.743],text:"Gather up to 2 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(2,e.Dahan)}},{textArea:[.746,.834],text:"<dahan> have +2 Health while in target land.",[r.InTargetLand]:async({$:e,land:a,effect:t})=>{await e.addSubEffectUntilEndOfTurn({[r.AdjustHealth]:({piece:t})=>t.isA(e.Dahan)&&t.location===a?2:0,[r.Reminder]:e=>e===a?t.text:void 0})}}]},rt={name:"Prowling Panthers",type:o.Minor,speed:d.Slow,energy:1,elements:[i.Moon,i.Fire,i.Animal],set:s.BranchAndClaw,target:c.Land,targetFilter:[l.Mountain,l.Jungle],range:1,generatesFear:!0,hasDestroyInstructions:!0,effects:[{textArea:[.67,.864],text:"1 <fear>. Add 1 <beasts>.<or>If target land has <beasts>, destroy 1 <explorer>/<town>.",[r.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"FearAndBeasts",textArea:[.684,.724],text:"1 <fear>. Add 1 <beasts>.",[r.Now]:async()=>{await a.fear(1),await a.add(1,e.Beasts)}},{actionId:"Destroy",textArea:[.766,.86],text:"If target land has <beasts>, destroy 1 <explorer>/<town>.",[r.Now]:async()=>{a.has(e.Beasts)&&await a.destroyOne(e.ExplorerOrTown)}}]})}}]},it={name:"Razorsharp Undergrowth",type:o.Minor,speed:d.Fast,energy:1,elements:[i.Moon,i.Plant],set:s.BranchAndClaw,target:c.Land,targetFilter:[l.NonBlight],range:0,hasDestroyInstructions:!0,effects:[{textArea:[.699,.739],text:"Destroy 1 <explorer> and 1 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.destroyOne(e.Explorer),await a.destroyOne(e.Dahan)}},{textArea:[.739,.779],text:"Add 1 <wilds>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Wilds)}},{textArea:[.785,.825],text:"Defend 2.",[r.InTargetLand]:async({land:e})=>{await e.defend(2)}}]},st={name:"Renewing Rain",type:o.Minor,speed:d.Slow,energy:1,elements:[i.Water,i.Earth,i.Plant],set:s.BranchAndClaw,target:c.Land,sourceFilter:[l.SacredSite],range:1,effects:[{textArea:[.625,.732],text:"If target land is <jungles-sands>, remove 1 <blight>.",[r.InTargetLand]:async({land:e})=>{e.isJungleOrSands&&await e.removeBlight()}},{textArea:[.884,.924],text:"If you ave 3 <plant>: Add 1 <wilds>.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[i.Plant]:3})&&await t.add(1,e.Wilds)}}]},ot={name:"Rites Of The Lands Rejection",type:o.Minor,speed:d.Fast,energy:1,elements:[i.Moon,i.Fire,i.Earth],set:s.BranchAndClaw,target:c.Land,sourceFilter:[l.SacredSite],targetFilter:[l.Dahan],range:2,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.638,.867],text:"Invaders do not Build in target land this turn. 1 <fear> per <town>/<city> or 1 <fear> per <dahan>, whichever is less.<or>Push up to 3 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"NoBuild",textArea:[.638,.784],text:"Invaders do not Build in target land this turn. 1 <fear> per <town>/<city> or 1 <fear> per <dahan>, whichever is less.",label:"Invaders do not Build...",[r.Now]:async()=>{await a.skipInvaderAction({all:!0,filter:({invaderAction:e})=>e===K.Build}),await a.fear(Math.min(a.numberOf(e.TownOrCity),a.numberOf(e.Dahan)))}},{actionId:"Push",textArea:[.822,.862],text:"Push up to 3 <dahan>.",[r.Now]:async()=>{await a.pushUpTo(3,e.Dahan)}}]})}}]},dt={name:"Scour The Land",type:o.Minor,speed:d.Slow,energy:1,elements:[i.Air,i.Earth],set:s.BranchAndClaw,target:c.Land,sourceFilter:[l.SacredSite],range:2,hasDestroyInstructions:!0,mayBeSpeed:{effect:{textArea:[.817,.927],text:"If you have 3 <air>: This power may be <fast>.",[r.Now]:async({action:e})=>{await e.spirit.convertElements({[i.Air]:3}),await e.power.makeFast()}},condition:({spirit:e,speed:a})=>a===d.Fast&&e.hasElementsWithConvert({[i.Air]:3})},blightWhiteListedPower:!0,fullText:["Destroy 3 <town> and all <explorer>.","Add 1 <blight>.","If you have 3 <air>: This power may be <fast>."],effects:[{textArea:[.631,.671],text:"Destroy 3 <town> and all <explorer>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.destroy({amount:3,pieces:e.Town}),await a.destroyAll(e.Explorer)}},{textArea:[.676,.716],text:"Add 1 <blight>.",[r.InTargetLand]:async({land:e})=>{await e.addBlight(1)}}]},ct={name:"Sky Stretches To Shore",type:o.Minor,speed:d.Fast,energy:1,elements:[i.Sun,i.Air,i.Water,i.Earth],set:s.BranchAndClaw,target:c.Spirit,effects:[{textArea:[.656,.792],text:"This turn, Target Spirit may use 1 <slow> Power as if it were <fast>, or vice versa.",[r.TargetSpirit]:async({spirit:e})=>{await e.gainMakeFastBuff({alsoMakeSlow:!0})}},{textArea:[.786,.886],text:"Target Spirit gains <range+3> for measuring Range to Coastal lands.",[r.TargetSpirit]:async({$:e,spirit:a})=>{await e.addSubEffectUntilEndOfTurn({[r.GlobalReminder]:()=>({icon:"Coastal<br><range+3>",players:[a]}),[r.ExtraRangeToLand]:e=>({extraRangeToLand:e.spirit===a?3:0,landFilter:e=>e.isCoastal})})}}]},lt={name:"Spur On With Words Of Fire",type:o.Minor,speed:d.Fast,energy:1,elements:[i.Sun,i.Fire,i.Air],set:s.BranchAndClaw,target:c.Spirit,effects:[{textArea:[.617,.706],text:"If you target a Spirit other than yourself, they gain +1 Energy.",[r.TargetSpirit]:async({you:e,spirit:a})=>{a!==e&&await a.gainEnergy(1)}},{textArea:[.705,.927],text:"Target Spirit may immediately play another Power Card by paying its cost. (If it is <slow>, it does not resolve until later.)",[r.TargetSpirit]:async({spirit:e})=>{await e.playAPowerCardByPayingItsCost()}}]},ht={name:"Swarming Wasps",type:o.Minor,speed:d.Fast,energy:0,elements:[i.Fire,i.Air,i.Animal],set:s.BranchAndClaw,target:c.Land,targetFilter:[l.NonBlight],range:1,hasPushOrGather:!0,effects:[{textArea:[.663,.851],text:"Add 1 <beasts>.<or>If target land has <beasts>, Push up to 2 <explorer>.",[r.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"AddBeasts",textArea:[.67,.71],text:"Add 1 <beasts>.",[r.Now]:async()=>{await a.add(1,e.Beasts)}},{actionId:"PushExplorer",textArea:[.804,.844],text:"Push up to 2 <explorer>.",[r.Now]:async()=>{await a.pushUpTo(2,e.Explorer)},condition:()=>a.has(e.Beasts)&&a.has(e.Explorer)}]})}}]},gt={name:"Teeming Rivers",type:o.Minor,speed:d.Slow,energy:1,elements:[i.Sun,i.Water,i.Plant,i.Animal],set:s.BranchAndClaw,target:c.Land,sourceFilter:[l.SacredSite],targetFilter:[l.Mountain,l.Wetlands],range:2,blightWhiteListedPower:!0,effects:[{textArea:[.654,.749],text:"If target land has no <blight>, add 1 <beasts>.",[r.InTargetLand]:async({$:e,land:a})=>{a.isLand&&!a.has(e.Blight)&&await a.add(1,e.Beasts)}},{textArea:[.788,.877],text:"If target land has exactly 1 <blight>, remove it.",[r.InTargetLand]:async({$:e,land:a})=>{a.hasExactly(1,e.Blight)&&await a.removeBlight()}}]},ft={name:"Tormenting Rotflies",type:o.Minor,speed:d.Slow,energy:1,elements:[i.Air,i.Plant,i.Animal],set:s.BranchAndClaw,target:c.Land,targetFilter:[l.Sands,l.Wetlands],range:2,generatesFear:!0,effects:[{textArea:[.647,.883],text:"Add 1 <disease>.<or>If target land has Invaders, 2 <fear>.<br>If <disease> is present, +1 <fear>.<br>If <blight> is present, +1 <fear>.",[r.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"Disease",textArea:[.657,.697],text:"Add 1 <disease>.",[r.Now]:async()=>{await a.add(1,e.Disease)}},{actionId:"Fear",label:"Gain <fear>.",effects:[{textArea:[.746,.786],text:"If target land has Invaders, 2 <fear>.",[r.Now]:async()=>{a.hasInvaders&&await a.fear(2)}},{textArea:[.789,.829],text:"If <disease> is present, +1 <fear>.",[r.Now]:async()=>{a.has(e.Disease)&&await a.fear(1)}},{textArea:[.831,.871],text:"If <blight> is present, +1 <fear>.",[r.Now]:async()=>{a.has(e.Blight)&&await a.fear(1)}}]}]})}}]},ut={name:"Twilight Fog Brings Madness",type:o.Minor,speed:d.Slow,energy:0,elements:[i.Sun,i.Moon,i.Air,i.Water],set:s.BranchAndClaw,target:c.Land,range:1,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{textArea:[.71,.75],text:"Add 1 <strife>. Push 1 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.addStrife(1),await a.pushOne(e.Dahan)}},{textArea:[.752,.841],text:"Each remaining <dahan> takes 1 Damage.",[r.InTargetLand]:async({$:e,land:a})=>{await a.damageEach(1,e.Dahan)}}]},pt={name:"Bats Scout For Raids By Darkness",type:o.Minor,speed:d.Slow,energy:1,elements:[i.Moon,i.Air,i.Animal],set:s.JaggedEarth,target:c.Land,range:2,hasPushOrGather:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.641,.88],text:"For each <dahan>, 1 Damage to <town>/<city>.<or>1 <fear>. Gather up to 2 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"Damage",textArea:[.641,.749],text:"For each <dahan>, 1 Damage to <town>/<city>.",[r.Now]:async()=>{await a.damage(a.numberOf(e.Dahan),e.TownOrCity)}},{actionId:"Fear",textArea:[.83,.87],text:"1 <fear>. Gather up to 2 <dahan>.",[r.Now]:async()=>{await a.fear(1),await a.gatherUpTo(2,e.Dahan)}}]})}}]},wt={name:"Birds Cry Warning",type:o.Minor,speed:d.Fast,energy:1,elements:[i.Sun,i.Air,i.Animal],set:s.JaggedEarth,target:c.Land,targetFilter:[l.Dahan],range:3,hasPushOrGather:!0,effects:[{textArea:[.634,.903],text:"The next time <dahan> would be Destroyed in target land, Destroy 2 fewer <dahan>.<or>Push up to 3 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{let t=0;await e.chooseBetween({effects:[{actionId:"ProtectDahan",textArea:[.634,.768],text:"The next time <dahan> would be Destroyed in target land, Destroy 2 fewer <dahan>.",[r.Now]:async n=>{await e.addSubEffectUntilEndOfTurn({[r.OrderOfRemoveAllMightMatter]:()=>!0,[r.Reminder]:e=>e===a?n.effect.text:void 0,[r.PreventRemovePiece]:async({piece:n,removement:r})=>!!(n.isA(e.Dahan)&&n.location===a&&x[r].isDestroyLike&&t<2)&&(t+=1,await e.sendEvent({type:T.GenericSub,text:"The <dahan> is saved from destruction by <p>BirdsCryWarning</p>."}),2===t&&e.removeThisEffect(),!0)})}},{actionId:"PushDahan",textArea:[.855,.895],text:"Push up to 3 <dahan>.",[r.Now]:async()=>{await a.pushUpTo(3,e.Dahan)}}]})}}]},yt={name:"Blood Draws Predators",type:o.Minor,speed:d.Fast,energy:1,elements:[i.Sun,i.Fire,i.Water,i.Animal],set:s.JaggedEarth,target:c.Land,range:1,hasDamageInstructions:!0,effects:[{textArea:[.676,.854],text:"After the next time Invaders are Destroyed in target land: Add 1 <beasts>, then 1 Damage per <beasts> (max. 3 Damage).",[r.InTargetLand]:async({$:e,land:a,...t})=>{const n={triggerId:e.nextTriggerId(),[r.Now]:async()=>{await a.add(1,e.Beasts),await a.damage(Math.min(a.numberOf(e.Beasts),3))}};await e.addSubEffectUntilEndOfTurn({[r.Reminder]:e=>e===a?t.effect.text:void 0,[r.AfterRemovePiece]:async({piece:r,location:i,removement:s})=>{r.isInvader&&i===a&&x[s].isDestroyLike&&(await e.addTrigger(n,t.effect,t.action),e.removeThisEffect())}})}}]},mt={name:"Call To Guard",type:o.Minor,speed:d.Fast,energy:0,elements:[i.Sun,i.Air,i.Earth],set:s.JaggedEarth,target:c.Land,range:1,hasPushOrGather:!0,effects:[{textArea:[.6,.64],text:"Gather up to 1 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(1,e.Dahan)}},{textArea:[.636,.939],text:"Then, if <dahan> are present, either:<br>Defend 1 per <dahan>.<or>After Invaders are added or moved to target land, 1 Damage to each added or moved Invader.",[r.InTargetLand]:async({$:e,land:a})=>{a.has(e.Dahan)&&await e.chooseBetween({effects:[{actionId:"DefendPerDahan",textArea:[.71,.75],text:"Defend 1 per <dahan>",[r.Now]:async()=>{await a.defend(a.numberOf(e.Dahan))}},{actionId:"AddTrigger",textArea:[.807,.939],text:"After Invaders are added or moved to target land, 1 Damage to each added or moved Invader.",[r.Now]:async t=>{await a.afterPiecesAreAddedOrMovedAddTrigger({pieces:e.Invader,trigger:{triggerId:e.nextTriggerId(),[r.Now]:async({action:e})=>{for(const t of e.parentData.piecesAddedOrMoved)t.location===a&&await t.takeDamage(1)}},effect:t.effect,action:t.action})}}]})}}]},vt={name:"Carapaced Land",type:o.Minor,speed:d.Fast,energy:0,elements:[i.Earth,i.Plant,i.Animal],set:s.JaggedEarth,target:c.Land,range:0,modifiesRangePerLand:{range:1,condition:({$:e,land:a})=>a.has(e.Beasts)},fullText:["If targeting a land with <beasts>, this Power has <range+1>.","Defend 3.","If you have 2 <earth>:<br>Defend +3."],effects:[{textArea:[.713,.753],text:"Defend 3.",[r.InTargetLand]:async({land:e})=>{await e.defend(3)}},{textArea:[.878,.918],text:"If you have 2 <earth>:<br>Defend +3.",[r.InTargetLand]:async({you:e,land:a})=>{await e.askToConvertElements({[i.Earth]:2})&&await a.defend(3)}}]},It={name:"Desiccating Winds",type:o.Minor,speed:d.Slow,energy:1,elements:[i.Fire,i.Air,i.Earth],set:s.JaggedEarth,target:c.Land,sourceFilter:[l.SacredSite],targetFilter:[l.Mountain,l.Sands],range:1,hasDamageInstructions:!0,effects:[{textArea:[.679,.772],text:"If target land has <badlands>, 1 Damage.",[r.InTargetLand]:async({$:e,land:a})=>{a.has(e.Badlands)&&await a.damage(1)}},{textArea:[.785,.825],text:"Add 1 <badlands>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Badlands)}}]},At={name:"Dire Metamorphosis",type:o.Minor,speed:d.Slow,energy:1,elements:[i.Moon,i.Air,i.Earth,i.Animal],set:s.JaggedEarth,target:c.Land,range:1,blightWhiteListedPower:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.653,.693],text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.653,.693],text:"1 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(1)}},{textArea:[.707,.747],text:"1 Damage to <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.damage(1,e.Dahan)}},{textArea:[.756,.871],text:"Add 1 <badlands>, 1 <beasts>, 1 <disease>, 1 <strife>, 1 <wilds>, and 1 <blight>.",[r.InTargetLand]:async({$:e,land:a})=>{a.isLand&&(await a.add(1,e.Badlands),await a.add(1,e.Beasts),await a.add(1,e.Disease),await a.add(1,e.Strife),await a.add(1,e.Wilds)),await a.addBlight(1)}}]},xt={name:"Domesticated Animals Go Berserk",type:o.Minor,speed:d.Fast,energy:1,elements:[i.Moon,i.Fire,i.Animal],set:s.JaggedEarth,target:c.Land,targetFilter:[l.Town,l.City],range:0,generatesFear:!0,effects:[{textArea:[.659,.699],text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.659,.699],text:"Defend 5.",[r.InTargetLand]:async({land:e})=>{await e.defend(5)}},{textArea:[.87,.91],text:"If you have 3 <moon>:<br>Add 1 <beasts>.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[i.Moon]:3})&&await t.add(1,e.Beasts)}}]},bt={name:"Dry Wood Explodes In Smoldering Splinters",type:o.Minor,speed:d.Slow,energy:1,elements:[i.Fire,i.Air,i.Plant],set:s.JaggedEarth,target:c.Land,targetFilter:[l.NotWetlands],range:0,generatesFear:!0,hasDamageInstructions:!0,mayBeSpeed:{effect:{text:"You may spend 1 Energy to make this Power <fast>.",[r.Now]:async({action:e})=>{await e.spirit.payEnergy(1),await e.power.makeFast()}},condition:({speed:e,spirit:a})=>e===d.Fast&&a.energy>=1},effects:[{textArea:[.768,.808],text:"2 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.824,.864],text:"1 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(1)}}]},Tt={name:"Entrap The Forces Of Corruption",type:o.Minor,speed:d.Fast,energy:1,elements:[i.Earth,i.Plant,i.Air],set:s.JaggedEarth,target:c.Land,range:1,hasPushOrGather:!0,blightWhiteListedPower:!0,effects:[{textArea:[.659,.699],text:"Gather up to 1 <blight>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(1,e.Blight)}},{textArea:[.715,.755],text:"Isolate target land.",[r.InTargetLand]:async({land:e})=>{e.isLand&&await e.isolate()}},{textArea:[.766,.86],text:"When <blight> is added to target land, it doesn't cascade.",[r.InTargetLand]:async({$:e,land:a,effect:t})=>{await e.addSubEffectUntilEndOfTurn({[r.Reminder]:e=>e===a?t.text:void 0,[r.PreventCascade]:({location:e})=>Promise.resolve(e===a)})}}]},Et={name:"Favor Of The Sun And Star-lit Dark",type:o.Minor,speed:d.Fast,energy:1,elements:[i.Sun,i.Moon,i.Plant],set:s.JaggedEarth,target:c.Land,sourceFilter:[l.SacredSite],range:1,hasPushOrGather:!0,blightWhiteListedPower:!0,generatesFear:!0,effects:[{textArea:[.624,.664],text:"Defend 4",[r.InTargetLand]:async({land:e})=>{e.isLand&&await e.defend(4)}},{textArea:[.682,.722],text:"Push up to 1 <blight>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(1,e.Blight)}},{textArea:[.871,.911],text:"If you have 2 <sun>:<br>1 <fear>.",[r.InTargetLand]:async({you:e,land:a})=>{await e.askToConvertElements({[i.Sun]:2})&&await a.fear(1)}}]},Pt={name:"Flow Downriver Blow Downwind",type:o.Minor,speed:d.Slow,energy:0,elements:[i.Air,i.Water,i.Plant],set:s.JaggedEarth,target:c.Land,sourceFilter:[l.SacredSite],range:2,hasPushOrGather:!0,blightWhiteListedPower:!0,effects:[{textArea:[.746,.786],text:"Push up to 1 <blight>/<explorer>/<town>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(1,e.BlightExplorerOrTown)}}]},St={name:"Gift Of Natures Connection",type:o.Minor,speed:d.Fast,energy:0,elements:[],set:s.JaggedEarth,target:c.Spirit,effects:[{textArea:[.636,.772],text:"Target Spirit gains either 2 Energy or 2 of a single Element (their choice).",[r.TargetSpirit]:async({$:e,spirit:a})=>{await e.chooseBetween({players:[a],effects:[{actionId:"GainEnergy",text:"Gain 2 Energy.",players:[a],[r.Now]:async()=>{await a.gainEnergy(2)}},{actionId:"GainElement",text:"Gain 2 of a single Element.",players:[a],[r.Now]:async()=>{await a.gainElements({amount:2,same:!0})}}]})}},{textArea:[.779,.877],text:"If you target another Spirit, you gain an Element of your choice.",[r.TargetSpirit]:async({you:e,spirit:a})=>{a!==e&&await e.gainElements()}}]},Ot={name:"Gift Of Twinned Days",type:o.Minor,speed:d.Fast,energy:1,elements:[i.Sun,i.Moon],set:s.JaggedEarth,target:c.Spirit,targetFilter:[m.Another],effects:[{textArea:[.644,.88],text:"Once this turn, target Spirit may Repeat the lowest-cost Power Card they have in play by paying its cost again. You may do likewise.",[r.TargetSpirit]:async({$:e,spirit:a,you:t,...n})=>{n.isRepeat||await a.andAnotherSpirit(t,{now:async(a,t)=>{await e.addSubEffectUntilEndOfTurn({textArea:t?[.647,.822]:[.838,.878],text:(t?"Target Spirit":"You")+" may Repeat the lowest-cost Power Card you have in play by paying its cost again.",[r.GlobalReminder]:()=>({power:n.power.power,players:[a]}),[r.MayRepeatPowercard]:({power:e,speed:t})=>e.owner===a&&e.costToPlay<=a.energy&&e.data.type!==o.Innate&&e.isLowestCostOfPlayedCards&&e.possibleToRepeatAtSpeed(t),[r.RepeatPowerCard]:async({power:t,speed:n})=>{t.owner===a&&e.removeThisEffect(),await t.payForPlay(),await t.replay(n)}})}})}}]},Ct={name:"Haunted By Primal Memories",type:o.Minor,speed:d.Fast,energy:1,elements:[i.Moon,i.Air,i.Earth],set:s.JaggedEarth,target:c.Land,sourceFilter:[l.SacredSite],targetFilter:[l.Invaders],range:2,generatesFear:!0,effects:[{textArea:[.71,.75],text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.71,.75],text:"Defend 3.",[r.InTargetLand]:async({land:e})=>{await e.defend(3)}},{textArea:[.768,.808],text:"If <beasts> are present, +2 <fear>.",[r.InTargetLand]:async({$:e,land:a})=>{a.has(e.Beasts)&&await a.fear(2)}}]},Dt={name:"Hazards Spread Across The Island",type:o.Minor,speed:d.Fast,energy:0,elements:[i.Fire,i.Air,i.Earth,i.Plant],set:s.JaggedEarth,target:c.Land,sourceFilter:[l.SacredSite],range:2,effects:[{textArea:[.624,.9],text:"Choose a type of token from <badlands>/<beasts>/<disease>/<strife>/<wilds> that exists in an adjacent land; choosing <disease> costs 1 Energy.<br>Add 1 of that type of token to target land.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await e.chooseBetween({effects:[e.Badlands,e.Beasts,e.Disease,e.Strife,e.Wilds].map((n=>({actionId:n,text:ee[n].text,[r.Now]:async()=>{n===e.Disease&&await a.payEnergy(1),await t.add(1,n)},condition:()=>t.hasAdjacentLandWithPiece(n)&&a.energy>=(n===e.Disease?1:0)})))},{orChoice:!1})}}]},Bt={name:"Like Calls To Like",type:o.Minor,speed:d.Slow,energy:1,elements:[i.Sun,i.Water,i.Plant],set:s.JaggedEarth,target:c.Land,range:1,hasPushOrGather:!0,blightWhiteListedPower:!0,fullText:["If target land has <explorer>, Gather up to 1 <explorer>.","Do likewise for <town>, <dahan>, <blight>, and <beasts>."],effects:[Z.Explorer,Z.Town,Z.Dahan,Z.Blight,Z.Beasts].map((e=>({textArea:[.661,.863],text:`If target land has ${ee[e].text}, Gather up to 1 ${ee[e].text}.`,[r.InTargetLand]:async({land:a})=>{a.has(e)&&await a.gatherUpTo(1,e)}})))},kt={name:"Mesmerized Tranquility",type:o.Minor,speed:d.Fast,energy:0,elements:[i.Water,i.Earth,i.Animal],set:s.JaggedEarth,target:c.Land,range:0,effects:[{textArea:[.713,.753],text:"Isolate target land.",[r.InTargetLand]:async({land:e})=>{await e.isolate()}},{textArea:[.769,.809],text:"Each Invader does -1 Damage.",[r.InTargetLand]:async({$:e,land:a,effect:t})=>{await e.addSubEffectUntilEndOfTurn({[r.Reminder]:e=>e===a?t.text:void 0,[r.AdjustDamage]:({piece:e})=>e.isInvader&&e.location===a?-1:0})}}]},Lt={name:"Renewing Boon",type:o.Minor,speed:d.Slow,energy:1,elements:[i.Sun,i.Earth,i.Plant],set:s.JaggedEarth,target:c.Spirit,targetFilter:[m.Another],effects:[{textArea:[.648,.883],text:"Choose a land where you and target Spirit both have <presence>.<br>In that land: Remove 1 <blight>, and target Spirit may add 1 of their Destroyed <presence>.",[r.TargetSpirit]:({you:e,spirit:a})=>e.inLandsWhere((e=>e.hasPresenceOf(a))).pickOne((async e=>{await e.removeBlight(),await e.addPresence(a,{destroyed:!0})}))}]};var Ft;!function(e){e.Jungles="Jungles",e.Mountains="Mountains",e.Sands="Sands",e.Wetlands="Wetlands"}(Ft||(Ft={}));const Rt={name:"A",set:s.Base,thematic:!1,terrain:[Ft.Mountains,Ft.Wetlands,Ft.Jungles,Ft.Sands,Ft.Wetlands,Ft.Mountains,Ft.Sands,Ft.Jungles],setupSymbols:[[],[p.City,p.Dahan],[p.Dahan,p.Dahan],[p.Blight],[],[p.Dahan],[p.Dahan,p.Dahan],[p.Town]],adjacency:[[5,4,3,1,8],[8,0,3,2],[8,1,3],[2,1,0,4],[3,0,5,7,6],[7,4,0],[4,7],[6,4,5],[0,1,2]],outerBorders:[[0,0,5,5,7,7,7],[7,7,7,6,6,6,6],[6,4,3,3,2,2,2]]},Nt={name:"B",set:s.Base,thematic:!1,terrain:[Ft.Wetlands,Ft.Mountains,Ft.Sands,Ft.Jungles,Ft.Sands,Ft.Wetlands,Ft.Mountains,Ft.Jungles],setupSymbols:[[p.Dahan],[p.City],[p.Dahan,p.Dahan],[p.Blight],[],[p.Town],[p.Dahan],[p.Dahan,p.Dahan]],adjacency:[[5,4,3,1,8],[8,0,3,2],[8,1,3],[2,1,0,4,6],[0,5,6,3],[7,6,4,0],[3,4,5,7],[6,5],[0,1,2]],outerBorders:[[0,5,5,5,7,7,7],[7,7,7,6,6,6,6],[6,3,3,2,2,2,2]]},$t={name:"C",set:s.Base,thematic:!1,terrain:[Ft.Jungles,Ft.Sands,Ft.Mountains,Ft.Jungles,Ft.Wetlands,Ft.Sands,Ft.Mountains,Ft.Wetlands],setupSymbols:[[p.Dahan],[p.City],[p.Dahan,p.Dahan],[],[p.Blight,p.Dahan,p.Dahan],[p.Dahan],[p.Town],[]],adjacency:[[5,4,1,8],[8,0,4,3,2],[8,1,3],[2,1,4,6],[0,5,6,3,1],[7,6,4,0],[3,4,5,7],[6,5],[0,1,2]],outerBorders:[[0,0,5,5,7,7,7],[7,7,7,7,6,6,3],[3,3,3,3,2,2,2]]},Wt={name:"D",set:s.Base,thematic:!1,terrain:[Ft.Wetlands,Ft.Jungles,Ft.Wetlands,Ft.Sands,Ft.Mountains,Ft.Jungles,Ft.Sands,Ft.Mountains],setupSymbols:[[p.Dahan,p.Dahan],[p.City,p.Dahan],[],[],[p.Blight,p.Dahan],[],[p.Town,p.Dahan,p.Dahan],[]],adjacency:[[7,6,4,1,8],[8,0,4,3,2],[8,1,3],[2,1,4,5],[0,6,5,3,1],[3,4,6],[5,4,0,7],[6,0],[0,1,2]],outerBorders:[[0,0,0,0,0,0,7],[7,7,7,6,6,6,5],[5,5,3,3,3,2,2]]},Mt={name:"E",set:s.JaggedEarth,thematic:!1,terrain:[Ft.Sands,Ft.Mountains,Ft.Jungles,Ft.Wetlands,Ft.Mountains,Ft.Sands,Ft.Jungles,Ft.Wetlands],setupSymbols:[[p.Dahan],[p.City],[p.Dahan,p.Dahan],[p.Blight],[p.Dahan],[],[p.Town],[p.Dahan,p.Dahan]],adjacency:[[6,4,1,8],[8,0,4,2],[8,1,4,3],[2,4,6,5],[0,6,3,2,1],[3,6,7],[7,5,3,4,0],[5,6],[0,1,2]],outerBorders:[[0,0,0,6,6,7,7],[7,7,7,7,7,5,5],[5,3,3,3,2,2,2]]},Gt={name:"F",set:s.JaggedEarth,thematic:!1,terrain:[Ft.Sands,Ft.Jungles,Ft.Wetlands,Ft.Mountains,Ft.Jungles,Ft.Mountains,Ft.Wetlands,Ft.Sands],setupSymbols:[[p.Dahan,p.Dahan],[p.City],[p.Dahan],[p.Blight],[p.Dahan],[p.Dahan,p.Dahan],[],[p.Town]],adjacency:[[5,4,1,8],[8,0,4,3,2],[8,1,3],[2,1,4,7,6],[0,5,7,3,1],[7,4,0],[3,7],[6,3,4,5],[0,1,2]],outerBorders:[[0,0,0,5,5,5,7],[7,7,7,7,6,6,6],[6,6,3,3,3,2,2]]},Ht={name:"G",set:s.HorizonsOfSpiritIsland,thematic:!1,terrain:[Ft.Mountains,Ft.Wetlands,Ft.Sands,Ft.Wetlands,Ft.Sands,Ft.Jungles,Ft.Jungles,Ft.Mountains],setupSymbols:[[p.Dahan,p.Dahan],[p.City],[p.Dahan],[p.Dahan],[p.Blight],[],[p.Dahan,p.Dahan],[p.Town]],adjacency:[[5,1,8],[8,0,5,4,3,2],[8,1,3],[2,1,4,6],[5,7,6,3,1],[7,4,1,0],[3,4,7],[6,4,5],[0,1,2]],outerBorders:[[0,0,0,5,5,7,7],[7,7,7,7,6,6,6],[6,3,3,2,2,2,2]]},Ut={name:"H",set:s.HorizonsOfSpiritIsland,thematic:!1,terrain:[Ft.Jungles,Ft.Sands,Ft.Mountains,Ft.Mountains,Ft.Jungles,Ft.Wetlands,Ft.Wetlands,Ft.Sands],setupSymbols:[[p.Dahan],[p.City],[p.Dahan],[],[p.Blight],[p.Dahan,p.Dahan],[p.Town],[p.Dahan,p.Dahan]],adjacency:[[7,5,1,8],[8,0,5,4,2],[8,1,4,3],[2,4,6],[1,5,6,3,2],[0,7,6,4,1],[3,4,5,7],[6,5,0],[0,1,2]],outerBorders:[[0,0,0,0,7,7,7],[7,7,6,6,6,6,3],[3,3,3,3,2,2,2]]},qt={name:"EA",set:s.Base,thematic:!0,terrain:[Ft.Jungles,Ft.Wetlands,Ft.Wetlands,Ft.Wetlands,Ft.Sands,Ft.Mountains,Ft.Mountains,Ft.Mountains,Ft.Wetlands,Ft.Wetlands],setupSymbols:[[p.Explorer],[p.Disease,p.Disease,p.Town,p.Strife],[p.Dahan,p.Dahan,p.Blight,p.Disease,p.City,p.Town,p.Strife],[p.Explorer,p.Dahan,p.Dahan,p.Dahan],[],[p.Badlands],[p.Vitality],[p.Explorer],[p.Dahan,p.Dahan],[p.Dahan,p.Dahan]],adjacency:[[10,1,4,5],[10,2,3,4,0],[6,3,1,10],[2,6,7,8,4,1],[1,3,8,5,0],[0,4,8,9],[7,3,2],[8,3,6],[9,5,4,3,7],[5,8],[2,1,0]],outerBorders:[[0,0,5,5,5,5,9],[9,9,9,8,7,7,6],[6,6,6,2,2,2,2]]},jt={name:"NE",set:s.Base,thematic:!0,terrain:[Ft.Sands,Ft.Jungles,Ft.Jungles,Ft.Wetlands,Ft.Jungles,Ft.Mountains,Ft.Mountains,Ft.Sands,Ft.Wetlands],setupSymbols:[[p.City],[p.Wilds],[p.Dahan],[p.Dahan],[p.Town],[p.Dahan,p.Dahan],[p.Explorer,p.Explorer,p.Explorer,p.Dahan,p.Dahan,p.Dahan],[],[p.Beasts,p.Disease]],adjacency:[[9,1,4],[9,2,4,0],[9,3,6,4,1],[6,2,9],[0,1,2,6,7,8],[6],[5,7,4,2,3],[8,4,6],[4,7],[3,2,1,0]],outerBorders:[[0,0,4,4,8,8,8],[8,8,7,7,6,6,5],[5,5,6,3,3,3,3]]},Jt={name:"NW",set:s.Base,thematic:!0,terrain:[Ft.Sands,Ft.Sands,Ft.Wetlands,Ft.Jungles,Ft.Mountains,Ft.Sands,Ft.Wetlands,Ft.Mountains,Ft.Mountains],setupSymbols:[[p.Explorer,p.Explorer,p.Dahan,p.Vitality],[p.City],[p.Town,p.Disease],[],[p.Vitality],[p.Dahan,p.Dahan,p.Vitality],[p.Dahan,p.Badlands],[p.Explorer,p.Dahan],[p.Dahan]],adjacency:[[9,1,4,5],[9,2,3,4,0],[3,1,9],[6,4,1,2],[1,3,6,7,5,0],[0,4,7,8],[7,4,3],[8,5,4,6],[5,7],[2,1,0]],outerBorders:[[0,5,5,8,8,8,8],[8,8,7,6,6,6,6],[6,3,3,2,2,2,2]]},Vt={name:"SE",set:s.JaggedEarth,thematic:!0,terrain:[Ft.Jungles,Ft.Jungles,Ft.Wetlands,Ft.Mountains,Ft.Jungles,Ft.Wetlands,Ft.Sands,Ft.Mountains,Ft.Mountains],setupSymbols:[[p.Town,p.Dahan,p.Dahan],[p.Dahan,p.Dahan],[p.Dahan],[],[p.Beasts],[p.Town,p.Town,p.Dahan,p.Disease],[p.Explorer],[p.Blight,p.Wilds],[]],adjacency:[[9,1,4,5],[9,2,3,4,0],[3,1,9],[6,4,1,2],[1,3,6,7,5,0],[0,4,7,8],[7,4,3],[8,5,4,6],[5,7],[2,1,0]],outerBorders:[[0,0,5,5,8,8,8],[8,8,7,7,6,6,6],[6,3,3,3,2,2,2]]},Yt={name:"SW",set:s.JaggedEarth,thematic:!0,terrain:[Ft.Sands,Ft.Wetlands,Ft.Sands,Ft.Jungles,Ft.Jungles,Ft.Jungles,Ft.Mountains,Ft.Mountains,Ft.Sands,Ft.Jungles],setupSymbols:[[p.Beasts],[p.Town,p.Dahan],[p.Dahan,p.Blight,p.Town,p.Strife],[p.Explorer,p.Town,p.Beasts],[p.Wilds,p.Beasts],[p.Explorer,p.Badlands],[p.Explorer],[p.Blight,p.Wilds],[],[]],adjacency:[[10,1,3,4],[10,2,3,0],[6,3,1,10],[1,2,6,5,4,0],[0,3,5,9],[3,6,8,9,4],[7,8,5,3,2],[8,6],[9,5,6,7],[4,5,8],[2,1,0]],outerBorders:[[0,0,4,4,4,4,9],[9,9,8,8,7,7,7],[7,7,6,6,2,2,2]]},zt={name:"WE",set:s.Base,thematic:!0,terrain:[Ft.Jungles,Ft.Sands,Ft.Sands,Ft.Sands,Ft.Jungles,Ft.Mountains,Ft.Wetlands,Ft.Jungles,Ft.Sands,Ft.Mountains],setupSymbols:[[p.Town,p.Town,p.Dahan,p.Dahan],[p.Town],[p.Wilds],[p.Beasts],[p.Explorer],[p.Explorer,p.Dahan],[p.Dahan,p.Dahan],[p.Dahan,p.Dahan],[p.Badlands,p.Badlands],[p.Beasts]],adjacency:[[10,1,4,6,7,8],[10,2,3,4,0],[3,1,10],[5,4,1,2],[1,3,5,6,0],[6,4,3],[7,0,4,5],[9,8,0,6],[0,7,9],[8,7],[2,1,0]],outerBorders:[[0,0,8,8,9,9,9],[9,9,9,7,6,6,5],[5,5,5,3,3,2,2]]};var Qt;!function(e){e.BalancedA="BalancedA",e.BalancedB="BalancedB",e.BalancedC="BalancedC",e.BalancedD="BalancedD",e.BalancedE="BalancedE",e.BalancedF="BalancedF",e.BalancedG="BalancedG",e.BalancedH="BalancedH",e.ThematicEA="ThematicEA",e.ThematicNE="ThematicNE",e.ThematicNW="ThematicNW",e.ThematicSE="ThematicSE",e.ThematicSW="ThematicSW",e.ThematicWE="ThematicWE"}(Qt||(Qt={}));const Kt={[Qt.BalancedA]:Rt,[Qt.BalancedB]:Nt,[Qt.BalancedC]:$t,[Qt.BalancedD]:Wt,[Qt.BalancedE]:Mt,[Qt.BalancedF]:Gt,[Qt.BalancedG]:Ht,[Qt.BalancedH]:Ut,[Qt.ThematicEA]:qt,[Qt.ThematicNE]:jt,[Qt.ThematicNW]:Jt,[Qt.ThematicSE]:Vt,[Qt.ThematicSW]:Yt,[Qt.ThematicWE]:zt};var Xt;!function(e){e.CoastalLands="CoastalLands",e.Jungles="Jungles",e.JunglesAndSands="JunglesAndSands",e.JunglesAndWetlands="JunglesAndWetlands",e.JunglesEscalation="JunglesEscalation",e.Mountains="Mountains",e.MountainsAndJungles="MountainsAndJungles",e.MountainsAndWetlands="MountainsAndWetlands",e.MountainsEscalation="MountainsEscalation",e.Sands="Sands",e.SandsAndMountains="SandsAndMountains",e.SandsAndWetlands="SandsAndWetlands",e.SandsEscalation="SandsEscalation",e.SaltDeposits="SaltDeposits",e.WaveOfImmigration="WaveOfImmigration",e.Wetlands="Wetlands",e.WetlandsEscalation="WetlandsEscalation"}(Xt||(Xt={}));const _t={[Xt.CoastalLands]:{name:"Coastal Lands",text:"Coastal Lands",stage:2,terrains:[],saltDeposits:!1,coastal:!0,escalation:!1,set:s.Base},[Xt.Jungles]:{name:"Jungles",text:"<jungles>",stage:1,terrains:[Ft.Jungles],saltDeposits:!1,coastal:!1,escalation:!1,set:s.Base},[Xt.JunglesAndSands]:{name:"Jungles and Sands",text:"<jungles-sands>",stage:3,terrains:[Ft.Jungles,Ft.Sands],saltDeposits:!1,coastal:!1,escalation:!1,set:s.Base},[Xt.JunglesAndWetlands]:{name:"Jungles and Wetlands",text:"<jungles-wetlands>",stage:3,terrains:[Ft.Jungles,Ft.Wetlands],saltDeposits:!1,coastal:!1,escalation:!1,set:s.Base},[Xt.JunglesEscalation]:{name:"Jungles Escalation",text:"<jungles><escalation>",stage:2,terrains:[Ft.Jungles],saltDeposits:!1,coastal:!1,escalation:!0,set:s.Base},[Xt.Mountains]:{name:"Mountains",text:"<mountains>",stage:1,terrains:[Ft.Mountains],saltDeposits:!1,coastal:!1,escalation:!1,set:s.Base},[Xt.MountainsAndJungles]:{name:"Mountains and Jungles",text:"<mountains-jungles>",stage:3,terrains:[Ft.Mountains,Ft.Jungles],saltDeposits:!1,coastal:!1,escalation:!1,set:s.Base},[Xt.MountainsAndWetlands]:{name:"Mountains and Wetlands",text:"<mountains-wetlands>",stage:3,terrains:[Ft.Mountains,Ft.Wetlands],saltDeposits:!1,coastal:!1,escalation:!1,set:s.Base},[Xt.MountainsEscalation]:{name:"Mountains Escalation",text:"<mountains><escalation>",stage:2,terrains:[Ft.Mountains],saltDeposits:!1,coastal:!1,escalation:!0,set:s.Base},[Xt.Sands]:{name:"Sands",text:"<sands>",stage:1,terrains:[Ft.Sands],saltDeposits:!1,coastal:!1,escalation:!1,set:s.Base},[Xt.SandsAndMountains]:{name:"Sands and Mountains",text:"<mountains-sands>",stage:3,terrains:[Ft.Sands,Ft.Mountains],saltDeposits:!1,coastal:!1,escalation:!1,set:s.Base},[Xt.SandsAndWetlands]:{name:"Sands and Wetlands",text:"<sands-wetlands>",stage:3,terrains:[Ft.Sands,Ft.Wetlands],saltDeposits:!1,coastal:!1,escalation:!1,set:s.Base},[Xt.SandsEscalation]:{name:"Sands Escalation",text:"<sands><escalation>",stage:2,terrains:[Ft.Sands],saltDeposits:!1,coastal:!1,escalation:!0,set:s.Base},[Xt.SaltDeposits]:{name:"Salt Deposits",text:"Salt Deposits",stage:2,terrains:[],saltDeposits:!0,coastal:!1,escalation:!1,set:s.NatureIncarnate},[Xt.WaveOfImmigration]:{name:"Wave of Immigration",text:"Wave of Immigration",stage:0,terrains:[],saltDeposits:!1,coastal:!1,escalation:!1,set:s.JaggedEarth},[Xt.Wetlands]:{name:"Wetlands",text:"<wetlands>",stage:1,terrains:[Ft.Wetlands],saltDeposits:!1,coastal:!1,escalation:!1,set:s.Base},[Xt.WetlandsEscalation]:{name:"Wetlands Escalation",text:"<wetlands><escalation>",stage:2,terrains:[Ft.Wetlands],saltDeposits:!1,coastal:!1,escalation:!0,set:s.Base}},Zt={[q.Bring]:{verb:"Bring"},[q.Gather]:{verb:"Gather"},[q.Move]:{verb:"Move"},[q.Push]:{verb:"Push"},[q.Relocate]:{verb:"Relocate"}};var en,an,tn;!function(e){e.AdversaryAction="AdversaryAction",e.BlightCardAction="BlightCardAction",e.DahanEventAction="DahanEventAction",e.ExtraInvaderAction="ExtraInvaderAction",e.FearAction="FearAction",e.GameAction="GameAction",e.MainEventAction="MainEventAction",e.NormalInvaderAction="NormalInvaderAction",e.PowerAction="PowerAction",e.ScenarioAction="ScenarioAction",e.SpiritAction="SpiritAction",e.TokenEventAction="TokenEventAction"}(en||(en={})),function(e){e.Land="Land",e.Ocean="Ocean",e.EndlessDark="EndlessDark"}(an||(an={})),function(e){e.ChooseBetween="ChooseBetween",e.ClickToContinueCard="ClickToContinueCard",e.ClickToContinue="ClickToContinue",e.PayJointly="PayJointly",e.PlayPower="PlayPower",e.SelectBoard="SelectBoard",e.SelectCard="SelectCard",e.SelectCorner="SelectCorner",e.SelectFearCard="SelectFearCard",e.SelectGrowthOption="SelectGrowthOption",e.SelectHealingCard="SelectHealingCard",e.SelectLand="SelectLand",e.SelectPiece="SelectPiece",e.SelectPower="SelectPower",e.SelectPowerToGain="SelectPowerToGain",e.SelectPowerType="SelectPowerType",e.SelectSpirit="SelectSpirit",e.SelectTerrain="SelectTerrain",e.SelectTrack="SelectTrack"}(tn||(tn={}));const nn=(e,a)=>{let t=0;for(let n=0,r=e.length;n<r;n+=1)t+=a(e[n],n);return t},rn=(e,a)=>{let t=Number.MIN_SAFE_INTEGER;for(const n of e){const e=a(n);t=e>t?e:t}return t},sn=(e,a)=>0===e.length?0:e.reduce(((e,t)=>Math.min(e,a(t))),1/0),on=(e,a)=>{let t=0;for(const n of e)a(n)&&(t+=1);return t},dn=(e,a)=>{let t="[";return e.forEach(((e,n)=>{n>0&&(t+=", "),t+=a?a(e):e})),t+="]",t};class cn{items;$;query;order;constructor(e,a,t=[],n=!1){this.$=e,this.query=a,this.items=[...t],this.order=n}get anyOne(){return this.isEmpty?null:this.items[0]}get count(){return this.items.length}get isEmpty(){return 0===this.count}add(e){return this.items.push(e),this}addAll(e){return this.items.push(...e),this}autoPickOne(e,a){return this.pickOne(e,{...a,autoPlayOneOption:!0})}copy(){return new cn(this.$,this.query,[...this.items],this.order)}filteredByAllInPriority(...e){for(const a of e){const e=this.items.filter(a);e.length>0&&(this.items=e)}return this}filteredByAnyInPriority(...e){for(const a of e){const e=this.items.filter(a);if(e.length>0)return this.items=e,this}return this}firstOneWhere(e){return this.items.find(e)??null}async forEach(e,a){let t=[...this.items];this.query===tn.SelectLand&&t.sort(((e,a)=>e.serialized.localeCompare(a.serialized)));const n=this.order&&(void 0===a?.autoPlayOneOption||this.itemsInFirstPosition.length>1);if(t.length>0)for(;t.length>0;){const r=n?await this.$.query({query:this.query,items:t,actionIds:t.map((e=>e.serialized)),...a}):0;await e(t[r]),t.splice(r,1),this.query===tn.SelectPiece&&(t=t.filter((e=>null!==e.location)))}else a?.noOptions&&await this.$.clickToContinue(a)}has(e){return this.items.includes(e)}hasAtLeast(e,a){let t=0;for(const n of this.items)if(a(n)&&(t+=1,t>=e))return!0;return t>=e}hasExactlyOneWhere(e,a){return this.numberOf(a)===e}hasNoneWhere(e){return!this.items.some(e)}hasOneWhere(e){return this.items.some(e)}async inDifferent(e,a){0===this.count&&a?.noOptions?await this.$.clickToContinue(a):await e(((e,a)=>this.pickOne((async a=>{await e(a),this.remove(a)}),a)))}maxNumberOf(e){return rn(this.items,e)}minNumberOf(e){return sn(this.items,e)}numberOf(e){return on(this.items,e)}async optionallyPickOne(e,a){await this.pickOne(e,a,!0)}async pickMultiple(e){const{amount:a,forPickedItem:t,beforeNextItem:n,where:r,effect:i,optional:s=!1,repeatSame:o=!1,together:d=!1,autoplayIfPickingAll:c=!1}=e;if(r&&this.where(r),0===this.count)i?.noOptions&&await this.$.clickToContinue({...i});else if((void 0===a||a>=this.count)&&c&&!o&&!d)for(;this.count>0;)await t(this.items[0]),this.remove(this.items[0]);else for(let e=0;void 0===a||e<a;e+=1){let c=!1;if(await this.pickOne((async e=>{c=!0,await t(e),o||d||this.remove(e),d&&this.where((a=>a===e)),r&&this.where(r)}),{...i,noOptions:void 0,prompt:`${i?.prompt??this.$.defaultPromptForQueryType(this.query)}${void 0!==a&&a>1?` (${a-e} left.)`:""}`},s),!c||e===a)break;n?.()}}async pickOne(e,a,t=!1){const n=this.itemsInFirstPosition;if(n.length>0)if(this.query===tn.SelectLand&&n.sort(((e,a)=>e.serialized.localeCompare(a.serialized))),t){const t=await this.$.queryOptional({query:this.query,items:n,actionIds:n.map((e=>e.serialized)),...a});null!=t&&await e(n[t])}else{const t=await this.$.query({query:this.query,items:n,actionIds:n.map((e=>e.serialized)),...a});await e(n[t])}else a?.noOptions&&await this.$.clickToContinue(a)}remove(e){return ae(this.items,e),this}removeAllButFirst(){return this.items.length>1&&(this.items.length=1),this}selectOrder(e=!0){return this.order=e,this}sort(e){return this.items.sort(e),this}sum(e){return nn(this.items,e)}toString(){return dn(this.items)}where(e){return this.items=this.items.filter(e),this}withLeast(e){const a=sn(this.items,e);return this.where((t=>e(t)===a))}withMost(e){const a=rn(this.items,e);return this.where((t=>e(t)===a))}get itemsInFirstPosition(){let e=this.items;return this.query===tn.SelectPiece&&(e=this.items.filter((e=>e.isTopInStackOfPieces(this.items)))),e}}var ln,hn;!function(e){e.Amorphous="Amorphous",e.DarkFire="DarkFire",e.Deeps="Deeps",e.Encircle="Encircle",e.Enticing="Enticing",e.Foreboding="Foreboding",e.Haven="Haven",e.Immense="Immense",e.Intensify="Intensify",e.Lair="Lair",e.Locus="Locus",e.Madness="Madness",e.Mentor="Mentor",e.Might="Might",e.Nourishing="Nourishing",e.Pandemonium="Pandemonium",e.Reach="Reach",e.Regrowth="Regrowth",e.Resilience="Resilience",e.Sparking="Sparking",e.SpreadingHostility="SpreadingHostility",e.Stranded="Stranded",e.Sunshine="Sunshine",e.Tactician="Tactician",e.Tangles="Tangles",e.Transforming="Transforming",e.Travel="Travel",e.Unconstrained="Unconstrained",e.Violence="Violence",e.Warrior="Warrior",e.Wind="Wind"}(ln||(ln={})),function(e){e.Lightning="Lightning",e.River="River",e.Earth="Earth",e.Shadows="Shadows",e.Thunderspeaker="Thunderspeaker",e.Green="Green",e.Ocean="Ocean",e.Bringer="Bringer",e.Fangs="Fangs",e.Keeper="Keeper",e.Wildfire="Wildfire",e.Serpent="Serpent",e.Stone="Stone",e.Memory="Memory",e.Trickster="Trickster",e.Lure="Lure",e.ManyMinds="ManyMinds",e.Volcano="Volcano",e.Shroud="Shroud",e.Vengeance="Vengeance",e.Starlight="Starlight",e.Fractured="Fractured",e.Downpour="Downpour",e.Finder="Finder",e.Teeth="Teeth",e.Eyes="Eyes",e.Mud="Mud",e.Heat="Heat",e.Whirlwind="Whirlwind",e.Behemoth="Behemoth",e.HearthVigil="HearthVigil",e.Darkness="Darkness",e.Gaze="Gaze",e.Roots="Roots",e.Earthquakes="Earthquakes",e.Voice="Voice",e.Wounded="Wounded"}(hn||(hn={}));const gn=Symbol("annotationCache"),fn=Object.prototype;class un{static reactivity=!0;static makeObservable(e){this.reactivity&&(0,C.Gn)(e)}static observableClass(e,a){if(this.reactivity){this.makeAutoObservable(e);const t=Object.getOwnPropertyDescriptor(e,"dataStore");if(void 0!==a&&t?.get){const t=`sid-${a}`,n=localStorage.getItem(t);if(n){const a=JSON.parse(n,((e,a)=>"undefined"===a?void 0:a));e.dataStore=a}setTimeout((()=>{(0,C.fm)((()=>{localStorage.setItem(t,JSON.stringify((0,C.HO)(e.dataStore),((e,a)=>void 0===a?"undefined":a)))}))}),1)}}}static makeAutoObservable(e){if(this.reactivity){if((0,C.AT)(e))throw new Error("Target must not be observable");let a=e[gn];if(!a){a={};const t=Object.getPrototypeOf(e);let n=e;for(;n&&n!==fn;)Reflect.ownKeys(n).forEach((e=>{e!==C.BQ&&"constructor"!==e&&"toString"!==e&&(a[e]=!0)})),n=Object.getPrototypeOf(n);t&&t!==fn&&Object.defineProperty(t,gn,{value:a})}(0,C.Gn)(e,a,{autoBind:!0})}}}var pn=function(e,a,t,n){var r,i=arguments.length,s=i<3?a:null===n?n=Object.getOwnPropertyDescriptor(a,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,a,t,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(i<3?r(s):i>3?r(a,t,s):r(a,t))||s);return i>3&&s&&Object.defineProperty(a,t,s),s};class wn{baseHealth;baseStrife=0;damage=0;doesNotParticipateInRavage=!1;fightsBeforeInvaders=!1;id;isIncarna;location;marked;piece;positionIndex;scenarioNumber;shadowDamage=0;spiritNumber;$;constructor(e,a,t,n,r){un.makeObservable(this),this.$=e,this.id=this.$.generatePieceId(),this.piece=a,this.location=t,this.spiritNumber=r,this.positionIndex=n,this.isIncarna=ee[Z.Incarna].pieces.includes(a),this.baseHealth=wn.pieceBaseHealth(this.piece)}get adjustedIndividualInvaderRavageDamage(){return({normal:e,towardsLand:a})=>this.$.sumEffects(r.AdjustIndividualInvaderRavageDamage,{normal:e,piece:this,towardsLand:a})}get extraHealth(){if(!this.isInvader&&!this.isDahan)return 0;const e=this.$.sumEffects(r.AdjustHealth,{piece:this});return Math.max(e,1-this.baseHealth)}get fearFromDestruction(){switch(this.piece){case p.City:return 2;case p.Town:return 1;default:return 0}}get health(){return this.baseHealth+this.extraHealth}get healthSurplus(){return Math.max(this.health-this.totalDamage,0)}get index(){return null===this.location?0:this.location.pieces.filter((e=>e.piece===this.piece)).indexOf(this)}get isAlive(){return this.healthSurplus>0}get isAliveIgnoringHealthBonuses(){return this.totalDamage<this.baseHealth}get isBadlands(){return this.piece===p.Badlands||this.mustCountAsBadlands||this.mayCountAsBadlands}get isBeasts(){return this.piece===p.Beasts||this.mayCountAsBeast}get isBlight(){return this.piece===p.Blight}get isCity(){return this.piece===p.City}get isDahan(){return this.piece===p.Dahan}get isEmpowered(){return null!=this.owner&&this.owner.hasEmpoweredIncarna}get isExplorer(){return this.piece===p.Explorer||this.mayCountAsExplorer}get isInvader(){return this.piece===p.Explorer||this.piece===p.Town||this.piece===p.City||this.piece===p.Thief&&this.mayCountAsExplorer}get isPresence(){return this.piece===p.Presence||this.isIncarna&&!this.$.action.dontCountAs.has(p.Presence)}get isTopInStack(){if(null===this.location&&this.positionIndex>=0)return!1;const e=this.location.piecesByGroup[this.positionIndex];return e[e.length-1]===this}get isTown(){return this.piece===p.Town}get mayCountAsBadlands(){return!(this.piece!==p.Presence&&!this.isIncarna||!this.owner.presenceMayCountAsBadlandsOrBeasts)||(!(this.piece!==p.IncarnaLocus||!this.isEmpowered)||!(this.piece!==p.Presence||this.owner.aspect!==ln.SpreadingHostility||!this.isTopInStack||!this.location.hasSacredSiteOf(this.owner)))}get mayCountAsBeast(){return this.piece===p.IncarnaDarkness||(!(this.piece!==p.Presence&&!this.isIncarna||!this.owner.presenceMayCountAsBadlandsOrBeasts)||!(this.piece!==p.Presence||this.owner.spirit!==hn.ManyMinds||!this.isTopInStack||!this.location.hasSacredSiteOf(this.owner)))}get mayCountAsExplorer(){return this.piece===p.Thief&&void 0!==this.$.action.spirit&&(this.$.action.type===en.PowerAction||this.$.action.type===en.SpiritAction)}get mustCountAsBadlands(){return!(this.piece!==p.Beasts||!this.$.beastsCountAsBadlands)||this.piece===p.Blight&&this.$.action.spirit?.spirit===hn.Vengeance&&(this.$.action.type===en.PowerAction||this.$.action.type===en.SpiritAction)}get owner(){return void 0===this.spiritNumber?null:this.$.spirits[this.spiritNumber]}get scenarioNumberVisible(){if(void 0!==this.location){if(this.piece===p.Thief)return this.location.numberOfDahan>=2||this.location.isOcean||!!this.$.config.controlledFate;if(this.piece===p.HiddenLocation)return void 0!==this.scenarioNumber}return!1}get serialized(){return`${this.piece}-${this.id}`}get strengthDuringRavage(){return this.strength(!0)}get strengthOutOfRavage(){return this.strength(!1)}get strife(){return Math.max(this.baseStrife+(this.$.ignoreOneStrife?-1:0),0)}get targetable(){return!this.$.someEffect(r.PreventTargetPiece,{piece:this})}get totalDamage(){return this.damage+this.shadowDamage}static createCollection(e,a){return new cn(e,tn.SelectPiece,a)}static pieceBaseHealth(e){switch(e){case p.City:return 3;case p.Town:case p.Dahan:return 2;case p.Explorer:case p.Thief:return 1;default:return 0}}async abduct(){await this.move({locations:{target:g.ToThisLocation,location:this.$.theEndlessDark}})}async addStrife(e={}){const{amount:a=1,add:t=!0,pieceFilter:n=Z.Invader}=e;await this.$.waitForAnimationsToFinish(),this.baseStrife+=a,this.placeInGroup(),await this.$.sendEvent({type:T.StrifeAdded,piece:this,location:this.location,amount:a}),t&&await this.$.doEffects(r.AfterAddingStrife,{piece:this,amount:a,pieceFilter:n})}areSameGroupAs(e){return e.piece===this.piece&&e.spiritNumber===this.spiritNumber&&e.damage===this.damage&&e.shadowDamage===this.shadowDamage&&e.doesNotParticipateInRavage===this.doesNotParticipateInRavage&&e.fightsBeforeInvaders===this.fightsBeforeInvaders&&e.baseStrife===this.baseStrife&&e.targetable===this.targetable&&e.scenarioNumber===this.scenarioNumber&&e.marked===this.marked&&!this.scenarioNumberVisible}damageOnlyThis(e,a){return this.location.damage(e,a??Z[this.piece],{filter:void 0===a?e=>e===this:void 0,firstTarget:void 0===a?void 0:this,autoPlayOneOption:!0})}async dealDamageToOtherInvaders(){await this.$.addSubEffect({highlightPieces:[this],[r.Now]:async()=>{await this.location.damage(this.strengthOutOfRavage,this.$.Invader,{filter:e=>e!==this})}})}destroy(){return this.remove(A.DirectDestroy)}async downgrade(){return this.isCity?this.replace([p.Town]):this.isTown?this.replace([p.Explorer]):this.isExplorer?{removed:await this.remove(),added:[]}:{removed:[],added:[]}}drown(){return this.remove(A.Drown)}isA(e){if(ee[e].pieces.includes(this.piece))return!0;if(!ee[e].ignoreCountAs){const a=this.$.action.dontCountAs;return ee[e].pieces.some((e=>{if(a.has(e))return!1;switch(e){case p.Presence:return this.isIncarna;case p.Beasts:return this.mayCountAsBeast;case p.Badlands:return this.mustCountAsBadlands||this.mayCountAsBadlands;case p.Explorer:return this.mayCountAsExplorer;default:return!1}}))}return!1}isAPresenceOf(e){return this.isPresence&&this.owner===e}isIgnoringCountAsA(e){return ee[e].pieces.some((e=>e===this.piece))}isOneOf(...e){return e.some((e=>this.isA(e)))}isOneOfIgnoringCountAs(...e){return e.some((e=>this.isIgnoringCountAsA(e)))}isPieceWithOptionallyCountAs(e){if(ee[e].pieces.includes(this.piece))return!0;if(!ee[e].ignoreCountAs){const a=this.$.action.dontCountAs;return ee[e].pieces.some((e=>{if(a.has(e))return!1;switch(e){case p.Presence:return this.isIncarna;case p.Beasts:return this.mayCountAsBeast;case p.Badlands:return this.mayCountAsBadlands;case p.Explorer:return this.mayCountAsExplorer;default:return!1}}))}return!1}isTopInStackOfPieces(e){if(null===this.location||-1===this.positionIndex)return!1;const a=e.filter((e=>e.positionIndex===this.positionIndex)),t=this.location.piecesByGroup[this.positionIndex],n=Math.max(...a.map((e=>t.indexOf(e))));return t.indexOf(this)===n}mark(){return this.marked=!0,Promise.resolve()}move(e={}){return this.location?this.location.move({pieces:Z[this.piece],piece:this,...e}):Promise.resolve([])}async moveTo(e){const{location:a,movement:t=q.Move,pieceFilter:n,withoutWait:i=!1}=e;let s=i;const o=this.location;if(null===o)return;const d=null!=this.owner?o.numberOfPresenceOf(this.owner):0,c=null!=this.owner?a.numberOfPresenceOf(this.owner):0;a!==o&&(await this.$.doEffects(r.BeforeMoving,{piece:this,source:o,destination:a,pieceFilter:n,movement:t}),s=s||void 0!==this.$.someEffect(r.MoveWithoutWaiting,{piece:this,source:o,pieceFilter:n})),(0,C.h5)((()=>{o.removePiece({piece:this,removement:A.Silent,pieceFilter:n}),a.pieces.push(this),this.location=a,this.placeInGroup()})),await this.$.sendEvent({type:T.PieceMoved,piece:this,pieceType:this.piece,fromLocation:o,toLocation:a,movement:t,withoutWait:s}),await o.healthCheck(),await a.healthCheck(),await this.$.doEffectsWithPriority(r.AfterMoving,{source:o,destination:a,piece:this,movement:t,pieceFilter:n});const l=null!=this.owner?o.numberOfPresenceOf(this.owner):0,h=null!=this.owner?a.numberOfPresenceOf(this.owner):0;d!==l&&this.owner&&await this.$.doEffects(r.AfterLandChangesAmountOfPresence,{amountBefore:d,amountAfter:l,land:o,spirit:this.owner}),c!==h&&this.owner&&await this.$.doEffects(r.AfterLandChangesAmountOfPresence,{amountBefore:c,amountAfter:h,land:a,spirit:this.owner})}placeInGroup(){if(this.location.pieces.includes(this)){const e=this.location.groupToBe(this.piece,this.damage,this.shadowDamage,this.baseStrife,this.doesNotParticipateInRavage,this.fightsBeforeInvaders,this.targetable,this.spiritNumber,this.positionIndex,this.scenarioNumber,this.marked);this.location.removePieceFromItsPosition(this),this.location.insertPieceIntoPosition(this,e),this.location.possiblyReorderPieces()}}async possiblyDontCountAs(e){if(this.piece!==e&&this.isPieceWithOptionallyCountAs(Z[e])){const a=this.piece===p.Presence&&this.location.hasSacredSiteOf(this.owner)&&(e===p.Beasts&&this.owner.spirit===hn.ManyMinds||e===p.Badlands&&this.owner.aspect===ln.SpreadingHostility);return await this.$.may({prompt:`Count ${a?"<sacred>":ee[this.piece].text} as ${ee[e].text}?`})||this.$.dontCountAs(e),!0}return!1}push(e){return this.move({movement:q.Push,...e})}remove(e=A.Remove){return this.location?this.location.removePiece({piece:this,removement:e,pieceFilter:Z[this.piece]}):Promise.resolve([])}async removeStrife(e=1){this.baseStrife=Math.max(this.baseStrife-e,0),await this.$.sendEvent({type:T.StrifeRemoved,location:this.location,piece:this,amount:e}),this.placeInGroup()}async replace(e,a=A.Replace){const t=this.location,n={removed:[],added:[]},i=this.piece;if(await this.$.oneEffectActivates(r.PreventReplacePiece,{piece:this.piece,location:t,withPieces:e}))return n;if(await this.$.oneEffectActivates(r.PreventRemovePiece,{piece:this,location:t,removement:A.Replace}))return n;if(1===e.length)this.piece===p.Presence&&(this.owner.destroyedPresence+=1),this.piece===p.Blight&&await this.$.addBlightToBlightCard(1),this.location.removePieceFromItsPosition(this),this.piece=e[0],(i===p.Presence||this.isIncarna)&&(this.location.hasPresenceOf(this.owner)||this.owner.removeLand(this.location)),this.baseHealth=wn.pieceBaseHealth(this.piece),n.removed.push({piece:this,location:t,removement:a}),n.added.push({piece:this,location:t}),this.placeInGroup(),this.isInvader||(this.baseStrife=0);else{const r=this.damage,i=this.strife;n.removed=await t.removePiece({piece:this,removement:a,pieceFilter:Z[this.piece]});for(const a of e)n.added.push(...await t.add(1,Z[a]));r>0&&await wn.createCollection(this.$,n.added.map((e=>e.piece))).pickMultiple({where:e=>e.isAlive,amount:r,repeatSame:!0,effect:{text:"Reallocate damage to replaced pieces."},forPickedItem:async e=>{await e.takeDamage(1,{mayPrevent:!1})}}),i>0&&await wn.createCollection(this.$,n.added.map((e=>e.piece)).filter((e=>e.isInvader))).pickMultiple({amount:i,repeatSame:!0,effect:{text:"Reallocate <strife> to replaced pieces."},forPickedItem:async e=>{await e.addStrife({add:!1})}})}return await this.$.sendEvent({type:T.PieceReplaced,piece:this,pieceTypeFrom:i,pieceTypesTo:e,location:t}),n}async setDoesNotParticipateInRavage(e){this.doesNotParticipateInRavage=e,this.placeInGroup(),e&&await this.$.sendEvent({type:T.DoNotParticipateInRavage,piece:this,location:this.location})}setFightsBeforeInvaders(e){return this.fightsBeforeInvaders=e,this.placeInGroup(),Promise.resolve()}async takeDamage(e,a={}){const{mayPrevent:t=!0,fromBadlands:n=!1}=a,i=[],s=Math.min(e,this.healthSurplus),o=s<=0||t&&await this.$.oneEffectActivates(r.PreventDamagingPiece,{piece:this,damage:s});return s>0&&this.isInvader&&this.$.setHasAttemptedDamagingInvaderThisInstruction(),o?[]:(await this.$.waitForAnimationsToFinish(),this.damage+=s,await this.$.sendEvent({type:T.PieceDamaged,amount:e,location:this.location??void 0,piece:this,pieceType:this.piece,fromBadlands:n}),!this.isAlive||!this.isAliveIgnoringHealthBonuses&&this.$.damageIgnoreHealthBonuses?i.push(...await(this.location?this.location.removePiece({piece:this,removement:A.DestroyByDamageOrBlight,byDamage:!0,pieceFilter:Z[this.piece]}):Promise.resolve([]))):this.placeInGroup(),i)}async timePasses(){this.damage>0&&!this.$.someEffect(r.PreventClearDamage,{piece:this})&&(this.damage=0,await this.$.sendEvent({type:T.DamageCleared,location:this.location??void 0,piece:this}),this.placeInGroup())}toString(){return`${p[this.piece]}[${this.damage}]`}upgrade(){return this.isTown?this.replace([p.City]):this.isExplorer?this.replace([p.Town]):Promise.resolve({removed:[],added:[]})}get adjustedStrength(){return this.$.sumEffects(r.AdjustDamage,{piece:this})}get adjustedStrengthDuringRavage(){return this.$.sumEffects(r.AdjustDamageDuringRavage,{piece:this})}get strength(){return e=>(e=>{switch(this.piece){case p.City:return 3;case p.Town:case p.Dahan:return 2;case p.Explorer:return 1;default:return 0}})()+this.adjustedStrength+(e?this.adjustedStrengthDuringRavage:0)}}pn([C.sH],wn.prototype,"baseStrife",void 0),pn([C.sH],wn.prototype,"damage",void 0),pn([C.sH],wn.prototype,"doesNotParticipateInRavage",void 0),pn([C.sH],wn.prototype,"fightsBeforeInvaders",void 0),pn([C.sH],wn.prototype,"id",void 0),pn([C.sH],wn.prototype,"location",void 0),pn([C.sH],wn.prototype,"marked",void 0),pn([C.sH],wn.prototype,"piece",void 0),pn([C.sH],wn.prototype,"positionIndex",void 0),pn([C.sH],wn.prototype,"scenarioNumber",void 0),pn([C.sH],wn.prototype,"shadowDamage",void 0),pn([C.sH],wn.prototype,"spiritNumber",void 0),pn([C.XI],wn.prototype,"placeInGroup",null);class yn{board;boardIndex;locations;position;boardDistance=[];destroyed=!1;$;constructor(e,a,t,n,r,i){const s=Kt[i];this.$=e,this.boardIndex=a,this.board=i,this.position={x:t,y:n,r},this.locations=s.adjacency.map(((t,n)=>new An({$:e,boardIndex:a,board:this,landIndex:n,type:n===s.adjacency.length-1?an.Ocean:an.Land})))}get corners(){return this.$.corners.filter((e=>e.board===this))}get data(){return Kt[this.board]}get existingLocations(){return(this.$.someBoardsHasExtraLocations?this.locations.concat(this.extraLocations):this.locations).filter((e=>e.exists))}get extraLocations(){const e=[],a=this.$.effectsMappedWithFilter(r.BoardHasExtraLocation,{board:this});for(const t of a)e.includes(t)||e.push(t);return e}get ignoreInvaderAndBlightInSetup(){return this.$.boardCount>this.$.spiritCount&&(this.$.phase===Xe.Setup||this.$.phase===Xe.RoyalBacking||this.$.phase===Xe.InitialExplore)&&void 0===this.$.config.boards[this.boardIndex].spirit}get lands(){return this.existingLocations.filter((e=>e.isLand))}get landsExcludingExtraLocations(){return this.locations.filter((e=>e.exists&&e.isLand))}get landsOrderedByHighestNumber(){return this.lands.sort(((e,a)=>Math.max(...a.landNumbers)-Math.max(...e.landNumbers)))}get landsOrderedByLowestNumber(){return this.lands.sort(((e,a)=>Math.min(...e.landNumbers)-Math.min(...a.landNumbers)))}get name(){return this.data.name}get numberOfBlight(){return nn(this.existingLocations,(e=>on(e.pieces,(e=>e.isBlight))))}get ocean(){return this.existingLocations.find((e=>e.isOcean))}get pieces(){const e=[];return this.existingLocations.forEach((a=>{e.push(...a.pieces)})),e.sort(((e,a)=>e.id-a.id)),e}get preventAdversaryActions(){return this.$.someEffect(r.PreventAdversaryActionOnBoard,{board:this})}get serialized(){return this.board}static createCollection(e,a){return new cn(e,tn.SelectBoard,a)}addPresence(e,a){return e.addPresence({locations:g.AnyLands,filter:e=>(void 0===a?.filter||a.filter(e))&&e.board===this,...a})}async addRandomBoard(){const e=await this.$.randomFreePositionFromBoard(this);if(null===e)return null;const a=await this.$.addBoard(e);return this.$.invalidateBoardCache(),this.$.setupAdjacencies(),this.$.setupCorners(),a}async destroy(){const e={board:this,removement:A.DirectDestroy};if(await this.$.oneEffectActivates(r.PreventRemoveBoard,e))return[];this.destroyed=!0;for(const e of this.locations)e.exists=!1;return this.$.invalidateBoardCache(),this.$.migrateCornerCornersFromBoard(this),this.$.setupAdjacencies(),this.$.setupCorners(),await this.$.sendEvent({type:T.BoardRemoved,board:e.board,removement:e.removement}),[e]}async destroyPresence(e){await this.forPieces().where((e=>e.isPresence)).pickMultiple({amount:e,forPickedItem:async e=>{await e.destroy()},effect:{prompt:"Pick <presence> to destroy."}})}firstLandWhere(e){return this.lands.find(e)??null}forPieces(){return wn.createCollection(this.$,this.pieces)}forPiecesThatIs(e,a){return this.forPieces().where((t=>t.isA(e)&&(void 0===a||a(t.location))))}forPiecesWhere(e){return this.forPieces().where(e)}hasOneLandWhere(e){return this.lands.some(e)}hasOneLandWith(e){return this.hasOneLandWhere((a=>a.has(e)))}hasOneLocationWhere(e){return this.existingLocations.some(e)}highestNumberedLand(e=(()=>!0)){return this.landsOrderedByHighestNumber.find(e)}highestNumberedLandMatching(e,a){return this.landsOrderedByHighestNumber.find((t=>t.matchesInvaderCard(e,a)))}highestNumberedTerrain(e){return this.highestNumberedLand((a=>a.hasTerrain(e)))}inCoastalLands(){return this.inLandsWhere((e=>e.isCoastal))}inCoastalLocations(){return this.inLocationsWhere((e=>e.isCoastal))}inCornerLands(){return this.inLocationsWhere((e=>e.isCornerLand))}inInlandLands(){return this.inLandsWhere((e=>e.isInland))}inJungles(){return this.inLandsWhere((e=>e.isJungle))}inLandNumber(e){return this.firstLandWhere((a=>a.hasNumber(e)))}inLands(){return An.createCollection(this.$,this.lands)}inLandsFilteredByAllInPriority(...e){return this.inLands().filteredByAllInPriority(...e)}inLandsFilteredByAnyInPriority(...e){return this.inLands().filteredByAnyInPriority(...e)}inLandsWhere(e){return this.inLands().where(e)}inLandsWith(e){return this.inLands().where((a=>a.has(e)))}inLandsWithAllOf(...e){return this.inLands().where((a=>a.hasAllOf(...e)))}inLandsWithLeast(e){return this.inLands().withLeast(e)}inLandsWithMost(e){return this.inLands().withMost(e)}inLandsWithMostMinimumOne(e){return this.inLandsWith(e).withMost((a=>a.numberOf(e)))}inLandsWithNoneOf(...e){return this.inLands().where((a=>!a.hasOneOf(...e)))}inLandsWithOneOf(...e){return this.inLands().where((a=>a.hasOneOf(...e)))}inLandsWithOrAdjacentTo(e){return this.inLandsWhere((a=>a.hasOrIsAdjacentToLandsWith(e)))}inLandsWithStrife(){return this.inLands().where((e=>e.hasStrife))}inLandsWithout(e){return this.inLands().where((a=>a.doesntHave(e)))}inLocations(){return An.createCollection(this.$,this.existingLocations)}inLocationsWhere(e){return this.inLocations().where(e)}inLocationsWith(e){return this.inLocations().where((a=>a.has(e)))}inLocationsWithOrAdjacentTo(e){return this.inLocationsWhere((a=>a.hasOrIsAdjacentToLocationsWith(e)))}inMountains(){return this.inLandsWhere((e=>e.isMountains))}inSands(){return this.inLandsWhere((e=>e.isSands))}inWetlands(){return this.inLandsWhere((e=>e.isWetlands))}lowestNumberedLand(e=(()=>!0)){return this.landsOrderedByLowestNumber.find(e)}lowestNumberedLandMatching(e,a){return this.landsOrderedByLowestNumber.find((t=>t.matchesInvaderCard(e,a)))}lowestNumberedTerrain(e){return this.lowestNumberedLand((a=>a.hasTerrain(e)))}numberOf(e){return nn(this.existingLocations,(a=>a.numberOf(e)))}presence(){return this.forPieces().where((e=>e.isPresence))}spiritsWithPresence(){return this.$.spiritsWhich((e=>this.hasOneLocationWhere((a=>a.hasPresenceOf(e)))))}toString(){return`${Kt[this.board].name}: ${this.locations}`}}const mn=(e,a)=>{if(!e.length)return-1;if(!a)return e.length-1;for(let t=e.length-1;t>=0;t-=1)if(a(e[t],t))return t;return-1},vn=(...e)=>{const a={Sun:0,Moon:0,Fire:0,Air:0,Water:0,Earth:0,Plant:0,Animal:0,Any:0,SunOrMoon:0,WaterOrAnimal:0,FireOrPlant:0,DarkFire:0};return e.forEach((e=>{Object.keys(e).forEach((t=>{a[t]+=e[t]}))})),a};var In=function(e,a,t,n){var r,i=arguments.length,s=i<3?a:null===n?n=Object.getOwnPropertyDescriptor(a,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,a,t,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(i<3?r(s):i>3?r(a,t,s):r(a,t))||s);return i>3&&s&&Object.defineProperty(a,t,s),s};class An{adjacentLocations;board;boardData;boardIndex;landIndex;locationsWithinBase=[];pieces;piecesByGroup=[];type;exists;$;constructor({$:e,boardIndex:a,board:t,landIndex:n,type:r}){un.makeObservable(this),this.$=e,this.type=r,this.exists=this.type!==an.EndlessDark||this.$.theEndlessDarkExists,this.pieces=[],this.adjacentLocations=[],this.boardIndex=a,this.landIndex=n,this.board=t,this.boardData=null!==this.board?Kt[this.board.board]:null}get adjacentLands(){return this.adjacentLocations.filter((e=>e.isLand))}get adjacentNumberOfStrife(){return this.inAdjacentLands().sum((e=>e.numberOfStrife))}get blightAlwaysCascades(){return this.$.someEffect(r.BlightAlwaysCascadesInLand,{land:this})}get buildCardsAffectLandsWithoutInvaders(){return this.$.someEffect(r.BuildCardsAffectLandsWithoutInvaders,{land:this})}get buildPlans(){const e=this.$.resultFromFirstEffectOfType(r.AdjustBuildPlans,{land:this});return e||(on(this.pieces,(e=>e.isTown))>on(this.pieces,(e=>e.isCity))?Z.City:Z.Town)}get coordinate(){return null!==this.boardData?`${this.boardData.name}${this.landNumber}`:"TED"}get coordinateLink(){return this.isTheEndlessDark?"<endless-dark>":this.isOcean?"The Ocean":`${this.terrainIcon}&nbsp;<l>${this.boardData.name}${this.landNumber}</l>`}get corners(){return this.$.corners.filter((e=>e.inAdjacentLocations().has(this)))}get dahanFightSimultaneously(){return this.$.someEffect(r.DahanFightSimultaneously,{land:this})}get defense(){if(!this.isLand)return 0;return this.$.sumEffects(r.DefendFromSpirits,{land:this})+this.$.sumEffects(r.DefendFromGame,{land:this})}get defenseSource(){const e=this.$.firstEffectOfType(r.DefendFromSpirits,{land:this});return e?.spirit}get distanceToNearestOcean(){for(let e=0;e<this.locationsWithinBase.length;e+=1)if(this.locationsWithinBase[e].some((e=>e.isOcean)))return e;return 999}get distanceToThisBoardsOcean(){for(let e=0;e<this.locationsWithinBase.length;e+=1)if(this.locationsWithinBase[e].some((e=>e.isOcean&&e.board===this.board)))return e;return 999}get elements(){const e=[];return this.corners.forEach((a=>{a.element&&e.push({[a.element]:1})})),vn(...e)}get explorersFightWithDahan(){return this.$.someEffect(r.ExplorersFightWithDahan,{land:this})}get hasBlight(){return this.pieces.some((e=>e.isBlight))}get hasCity(){return this.pieces.some((e=>e.isCity))}get hasDahan(){return this.pieces.some((e=>e.isDahan))}get hasExploringSource(){const e=this.$.exploreDistance;let a=this.inLocationsWithin(1,null).hasOneWhere((e=>e.isExploringSource));return a||2!==e||(a=this.hasAdjacentLocationWhere((e=>!e.isIsolated&&e.hasAdjacentLocationWhere((e=>e.isExploringSource))))),!(this.$.phase===Xe.InitialExplore&&this.$.boardCount>this.$.spiritCount&&void 0===this.$.config.boards[this.boardIndex].spirit&&1===this.$.spiritCount)&&a}get hasInvaders(){return this.pieces.some((e=>e.isInvader))}get hasPresenceFromTwoDifferentSpirits(){const e=this.pieces.map((e=>e.spiritNumber)).filter((e=>void 0!==e));return W(e).length>1}get hasSacredSite(){return this.$.spirits.some((e=>this.hasSacredSiteOf(e)))}get hasSetupSymbols(){return this.setupSymbols.length>0}get hasSomeTerrain(){return this.isSandsOrWetlands||this.isMountainsOrJungles}get hasStrife(){return this.pieces.some((e=>e.strife>0))}get hasTownsOrCities(){return this.pieces.some((e=>e.isTown||e.isCity))}get isCoastal(){return this.isOcean||this.adjacentLocations.some((e=>e.isOcean))}get isCornerLand(){return this.type!==an.Ocean&&(this.isWestern&&this.isSouthern||this.isSouthern&&this.isEastern||this.isEastern&&this.isNorthern||this.isNorthern&&this.isWestern)&&"NE7"!==this.coordinate}get isCornerLandOrNumberOne(){return this.isCornerLand||1===this.landNumber}get isEastern(){return this.boardData?.outerBorders[1].includes(this.landIndex)??!1}get isEndlessDark(){return this.type===an.EndlessDark}get isExploringSource(){return!this.isIsolated&&!this.$.someEffect(r.PreventExploreSourceInLand,{land:this})&&(this.isOcean||this.hasTownsOrCities||this.$.someEffect(r.LandIsExploringSource,{land:this}))}get isFlooded(){return this.$.someEffect(r.Flooded,{location:this})}get isInland(){return!this.isCoastal&&!this.isOcean}get isIsolated(){return this.$.someEffect(r.Isolated,{land:this})}get isJungle(){return this.hasTerrain(Ft.Jungles)}get isJungleOrSands(){return this.isJungle||this.isSands}get isJungleOrWetlands(){return this.isJungle||this.isWetlands}get isLand(){return this.type===an.Land||this.isOceanAndLand||this.isTheEndlessDarkAndLand}get isLandForBlight(){return this.isLand||this.isOcean&&this.oceanIsLandForBlightOnThisBoard}get isMiningLand(){return this.hasAtLeast(3,this.$.Invader)}get isMountains(){return this.hasTerrain(Ft.Mountains)}get isMountainsOrJungles(){return this.isMountains||this.isJungle}get isMountainsOrSands(){return this.isMountains||this.isSands}get isMountainsOrWetlands(){return this.isMountains||this.isWetlands}get isNorthern(){return!this.$.config.thematic&&null!==this.boardData&&this.landIndex===this.boardData.adjacency.length-1||null!==this.boardData&&this.boardData.outerBorders[this.$.config.thematic?2:0].includes(this.landIndex)}get isOcean(){return this.type===an.Ocean||this.$.someNonOceanIsOcean&&this.$.someEffect(r.LocationIsOcean,{location:this})}get isOceanAndLand(){return this.isOcean&&(this.$.oceanIsAllowedForBlight||this.$.someEffectMakesOceanALand&&this.$.someEffect(r.OceanIsLand,{location:this}))}get isSands(){return this.hasTerrain(Ft.Sands)}get isSandsOrWetlands(){return this.isSands||this.isWetlands}get isSouthern(){return!(!this.$.config.thematic||null===this.boardData||this.landIndex!==this.boardData.adjacency.length-1)||null!==this.boardData&&this.boardData.outerBorders[this.$.config.thematic?0:2].includes(this.landIndex)}get isTheEndlessDark(){return this.type===an.EndlessDark}get isTheEndlessDarkAndLand(){return this.isTheEndlessDark&&(this.$.action.type===en.FearAction||this.$.action.type===en.TokenEventAction)}get isWestern(){return null!==this.boardData&&this.landIndex===this.boardData.adjacency.length-1||null!==this.boardData&&this.boardData.outerBorders[2][this.boardData.outerBorders[2].length-1]===this.landIndex}get isWetlands(){return this.hasTerrain(Ft.Wetlands)}get landNumber(){return this.landIndex+1}get landNumbers(){return[this.landNumber,...this.$.effectsMappedWithFilter(r.ExtraLandNumber,{location:this})]}get numberOfBlight(){return on(this.pieces,(e=>e.isBlight))}get numberOfBuildings(){return on(this.pieces,(e=>e.isTown||e.isCity))}get numberOfDahan(){return on(this.pieces,(e=>e.isDahan))}get numberOfInvaders(){return on(this.pieces,(e=>e.isInvader))}get numberOfParticipatingDahan(){return on(this.pieces,(e=>e.isDahan&&!e.doesNotParticipateInRavage))}get numberOfSacredSites(){return on(this.$.spirits,(e=>this.hasSacredSiteOf(e)))}get numberOfStrife(){return nn(this.pieces,(e=>e.strife))}get oceanIsLandForBlightOnThisBoard(){return this.$.oceanIsLandForBlight(this)}get reminderEffects(){return this.$.reminderEffects.map((e=>this.isLand&&void 0!==e[r.DefendFromGame]?e[r.DefendFromGame]({land:this})>0&&this.defense>0?[e.text,e.spirit]:void 0:this.isLand&&void 0!==e[r.DefendFromSpirits]?e[r.DefendFromSpirits]({land:this})>0&&this.defense>0?[e.text,e.spirit]:void 0:void 0!==e[r.Reminder]?[e[r.Reminder](this),e.spirit]:void 0)).filter((e=>void 0!==e&&void 0!==e[0]))}get reminderSpirit(){const e=this.reminderEffects.find((([,e])=>void 0!==e));return e?.[1]}get reminders(){return this.reminderEffects.map((([e])=>e))}get serialized(){return this.coordinate}get setupSymbols(){return this.landIndex>=0&&this.landIndex<this.boardData.setupSymbols.length?this.boardData.setupSymbols[this.landIndex]:[]}get sumAdjustedCollectiveDahanRavageDamage(){return this.$.sumEffects(r.AdjustCollectiveDahanRavageDamage,{land:this})}get targetingIsPrevented(){return this.$.someEffect(r.PreventTargetLand,{land:this})}get terrain(){return this.landIndex>=0&&this.landIndex<this.boardData.terrain.length?this.boardData.terrain[this.landIndex]:null}get terrainIcon(){switch(this.terrain){case Ft.Jungles:return"<jungles>";case Ft.Mountains:return"<mountains>";case Ft.Sands:return"<sands>";case Ft.Wetlands:return"<wetlands>";default:return""}}get the(){return e=>({outnumber:a=>this.numberOf(e)>this.numberOf(a),isAtLeastAsManyAs:a=>this.numberOf(e)>=this.numberOf(a)})}static createCollection(e,a){return new cn(e,tn.SelectLand,a)}abduct(e,a=Z.Invader,t){return this.move({amount:e,pieces:a,locations:{target:g.ToThisLocation,location:this.$.theEndlessDark},...t})}async add(e,a,t){const n=ee[a],i=[];if(n.pieces.length>1)await te(e,(async()=>{await this.$.chooseBetween({autoPlayOneOption:!0,prompt:"Select piece to add",effects:n.pieces.map((e=>({actionId:e,label:ee[e].text,[r.Now]:async()=>{e===p.Strife?await this.addStrife(1,t):i.push(...await this.createPiece(1,e))}})))})}));else{if(n.pieces[0]!==p.Strife)return this.createPiece(e,n.pieces[0]);await this.addStrife(e)}return i}async addBlight(e,a={}){const{mayCascade:t=!0,isCascade:n=!1,fromRavage:i=!1}=a,s=[];if(await this.$.oneEffectActivates(r.PreventAddBlight,{location:this}))return s;const o=Math.min(e,this.numberOf(this.$.Vitality)),d=e-o;if(await this.$.addSubEffect({text:`${o} <blight> in land ${this.coordinateLink} is prevented by ${o} <vitality>.`,[r.Now]:async()=>{await this.remove({amount:o,pieces:this.$.Vitality})}}),this.$.blightOnBlightCard>0&&d>0){await this.$.removeBlightFromBlightCard(d,this);const e=this.numberOfBlight;await this.add(d,this.$.Blight);for(let e=0;e<d;e+=1)s.push(this);if(!this.isTheEndlessDark)for(const e of this.$.spirits)this.blightIsPreventedFromDestroyingPresenceOf(e)||(await this.possiblyDontCountPiecesAs(p.Presence,e),await this.remove({pieces:Z.Presence,owner:e,removement:A.DestroyByDamageOrBlight}));await this.$.doEffects(r.WhenAddingBlight,{land:this,blightedLands:s,isCascade:n,fromRavage:i}),(e>0||this.blightAlwaysCascades)&&this.hasAtLeast(e+1,this.$.Blight)&&t&&(await this.$.oneEffectActivates(r.PreventCascade,{location:this,fromRavage:i})||(await this.$.sendEvent({type:T.Cascade,location:this}),s.push(...await this.cascade({fromRavage:i}))))}return s}addIncarna(e,a){return this.createPiece(1,e,a.spiritNumber)}addPresence(e,a){return e.addPresence({locations:g.AnyLands,filter:e=>e===this,autoPlayOneOption:!0,...a})}async addStrife(e,a=Z.Invader,t=!1){const n=[];return await this.piecesThatAre(a).pickMultiple({amount:e,optional:t,forPickedItem:async e=>{n.push(e),await e.addStrife({pieceFilter:a})},repeatSame:!0,effect:{prompt:`Pick one ${ee[a].text} to add <strife>.`,highlightLocations:[this]}}),n}adjacentLandsSortedByNorthernmost(){return this.inAdjacentLands().sort(((e,a)=>{if(this.board===e.board&&this.board===a.board)return this.boardData.adjacency[this.landIndex].indexOf(e.landIndex)<this.boardData.adjacency[this.landIndex].indexOf(a.landIndex)?-1:1;if(this.board===e.board&&this.board!==a.board)return this.isNorthern?1:-1;if(this.board===a.board&&this.board!==e.board)return this.isNorthern?-1:1;if(this.board!==e.board&&this.board!==a.board){if(this.isNorthern){const t=this.$.config.thematic?0:2,n=this.$.config.thematic?-1:1;return e.boardData.outerBorders[t].indexOf(e.landIndex)<a.boardData.outerBorders[t].indexOf(a.landIndex)?n:-n}if(this.isSouthern){const t=this.$.config.thematic?2:0,n=this.$.config.thematic?1:-1;return e.boardData.outerBorders[t].indexOf(e.landIndex)>a.boardData.outerBorders[t].indexOf(a.landIndex)?-n:n}}return 0}))}adjacentPiecesInLandsWhere(e){return this.piecesInAdjacentLands().where(e)}adjacentPiecesInLocations(){const e=[];return this.adjacentLocations.forEach((a=>e.push(...a.pieces))),wn.createCollection(this.$,e)}adjacentPiecesInLocationsWhere(e){return this.adjacentPiecesInLocations().where(e)}afterPiecesAreAddedOrMovedAddTrigger(e){return this.$.afterPiecesAreAddedOrMovedAddTrigger({...e,reminder:!0,locationFilter:e=>e===this})}blightIsPreventedFromDestroyingPresenceOf(e){return this.$.someEffect(r.PreventBlightDestroyingPresence,{location:this,spirit:e})}boards(){const e=null!==this.board?[this.board]:[];return e.push(...this.$.effectsMappedWithFilter(r.ExtraBoard,{location:this})),yn.createCollection(this.$,e)}boardsHasPresenceOf(e){return this.boards().hasOneWhere((a=>a.hasOneLocationWhere((a=>a.hasPresenceOf(e)))))}async calculateDoNotParticipateInRavage(){await this.$.doEffects(r.DoesNotParticipateInRavage,{location:this})}async cascade(e={}){const a=[];return await this.inAdjacentLocations().where((e=>e.isLandForBlight)).pickOne((async t=>{a.push(...await t.addBlight(1,{fromRavage:e.fromRavage??!1,isCascade:!0}))}),{prompt:`Blight cascades in ${this.coordinate}!<br>Add a <blight> to one adjacent land.`,noOptions:"No adjacent land to cascade into.",highlightLocations:[this]}),a}async createPiece(e,a,t){const n=this.groupToBe(a,0,0,0,!1,!1,!0,t),i=[];return await te(e,(async()=>{await this.$.waitForAnimationsToFinish();const e=new wn(this.$,a,this,n,t),s=void 0!==t?this.numberOfPresenceOf(this.$.spirits[t]):0;if(!await this.$.oneEffectActivates(r.PreventAddPiece,{piece:a,location:this})){this.pieces.push(e),this.insertPieceIntoPosition(e,n),i.push({piece:e,location:this}),await this.$.sendEvent({type:T.PieceAdded,piece:e,pieceType:e.piece,location:this}),this.$.phase!==Xe.Setup&&this.$.phase!==Xe.SetupPresence&&await this.$.doEffects(r.AfterAddingPiece,{land:this,additions:i});const a=void 0!==t?this.numberOfPresenceOf(this.$.spirits[t]):0;s!==a&&await this.$.doEffects(r.AfterLandChangesAmountOfPresence,{amountBefore:s,amountAfter:a,land:this,spirit:this.$.spirits[t]})}})),i}damage(e,a,t={}){return this.$.doInstruction((async()=>{if(e<=0)return[];const{efficiently:n=!1,maxTargets:i,autoPlayOneOption:s=!1}=t,o=e=>(!t.filter||t.filter(e))&&(a?e.isA(a):e.isInvader),d=a??Z.Invader,c={mustBe:t.firstTarget},l=[];let h=e;const g=n||d===Z.Dahan&&this.$.currentActionType!==en.SpiritAction&&this.$.currentActionType!==en.PowerAction,f=[];for(;h>=0;){let e=!1;const a=this.piecesWhere((e=>(void 0===c.mustBe||c.mustBe===e)&&o(e)&&e.targetable&&(void 0===i||f.includes(e)||f.length<i)));if(a.isEmpty)break;if(0===h&&f.some((e=>e.isDahan))){let e=0;for(;;){const a=this.piecesWhere((e=>e.isBadlands&&!this.$.action.data.usedBadlandsForDahan?.includes(e)));if(a.isEmpty)break;{e+=1,void 0===this.$.action.data.usedBadlandsForDahan&&(this.$.action.data.usedBadlandsForDahan=[]);const t=a.anyOne;t&&this.$.action.data.usedBadlandsForDahan.push(t)}}if(e>0)for(await this.$.sendEvent({type:T.GenericSub,text:`<badlands> increase damage done to <dahan> by ${e}.`});e>0;){const t=a.copy().where((e=>e.isDahan&&e.isAlive)).withLeast((e=>e.healthSurplus));await t.pickOne((async e=>{f.push(e),l.push(...await e.takeDamage(1))}),{autoPlayOneOption:s,text:`<badlands> increase damage done to <dahan> by ${e}.`,prompt:`Pick one <dahan> to damage. ${e} Damage left.`,highlightLocations:[this]}),e-=1}}if(0===h&&this.$.currentActionType===en.PowerAction&&await this.$.doEffects(r.DamageBoost,{spirit:this.$.action.spirit,filter:d,onUse:async()=>{let e=!1;const t=this.$.currentStackEffect.name;return await a.optionallyPickOne((async a=>{e=!0,f.push(a),l.push(...await a.takeDamage(1))}),{prompt:`Do 1 additional damage to ${ee[d].text} from ${t}?`,highlightLocations:[this]}),e}}),0===h&&f.some((e=>e.isInvader))){const t=this.piecesWhere((e=>e.isBadlands&&!this.$.action.data.usedBadlands?.includes(e)));if(!t.isEmpty){const n=a.copy().where((e=>e.isInvader));await n.optionallyPickOne((async a=>{e=!0,f.push(a),l.push(...await a.takeDamage(1,{fromBadlands:!0})),void 0===this.$.action.data.usedBadlands&&(this.$.action.data.usedBadlands=[]);const n=t.anyOne;n&&this.$.action.data.usedBadlands.push(n)}),{prompt:`Do 1 additional damage to ${ee[d===Z.InvaderOrDahan?Z.Invader:d].text} from <badlands>?`,highlightLocations:[this]})}}if(!e){if(0===h)break;if(g){const e=a.copy().where((e=>e.isDahan)).withLeast((e=>e.healthSurplus)),t=a.copy().where((e=>e.isInvader)).withLeast((e=>e.healthSurplus));a.where((a=>e.has(a)||t.has(a)))}const e=a.hasOneWhere((e=>e.isInvader))?ee[d].text:ee[this.$.Dahan].text;await a.pickOne((async e=>{f.push(e),l.push(...await e.takeDamage(1)),c.mustBe=void 0}),{autoPlayOneOption:s,prompt:`Pick one ${e} to damage. ${h} Damage left.`,highlightLocations:[this]}),h-=1}}return l}))}async damageDifferent(e,a=Z.Invader){const t=[];return await this.piecesThatAre(a).pickMultiple({amount:e,repeatSame:!1,forPickedItem:async e=>{t.push(...await e.damageOnlyThis(1))},effect:{prompt:`Pick a different ${ee[a].text}.`}}),t}damageEach(e,a=Z.Invader){return this.$.doInstruction((async()=>{const t=[],n=this.piecesWhere((e=>e.isA(a)));return this.$.orderOfRemoveAllMightMatter&&n.selectOrder(),await n.forEach((async a=>{a.isAlive&&t.push(...await a.damageOnlyThis(e))})),t}))}damageInAdjacentLands(e,a=this.$.Invader){return this.$.doInstruction((async()=>{await this.piecesInAdjacentLands().where((e=>e.isA(a))).pickMultiple({repeatSame:!0,amount:e,where:e=>null!==e.location&&e.location.isAdjacentTo(this),forPickedItem:async e=>{await e.damageOnlyThis(1,a)},effect:{prompt:"Pick Invader to damage."}})}))}damageInThisAndAdjacentLands(e,a=this.$.Invader){return this.$.doInstruction((async()=>{await this.piecesInThisAndAdjacentLands().where((e=>e.isA(a))).pickMultiple({repeatSame:!0,amount:e,forPickedItem:async e=>{await e.damageOnlyThis(1,a)},effect:{prompt:"Pick Invader to damage."}})}))}async damageLand(e){const a=Math.max(2+this.adjustedLandHealth,1);if(e>=a){const t=1+this.$.sumEffects(r.ExtraBlightFromDamage,{damageExceedingHealth:e-a}),n=await this.addBlight(t,{fromRavage:!0});await this.$.doEffects(r.AfterRavagingDamageLand,{land:this,blightedLands:n,damageToLand:e,damageExceedingHealth:e-a})}}async defend(e,a={}){const{reminder:t=!0,singleLand:n=!0}=a,i=this.$.action.type===en.PowerAction||this.$.action.type===en.SpiritAction?this.$.action.spirit:null;await this.$.waitForAnimationsToFinish();const s=t?this.$.currentStackEffect.text:void 0;null===i?(await this.$.addSubEffectUntilEndOfTurn({text:`Defend ${e}.`,[r.DefendFromGame]:({land:a})=>a===this?e:0,[r.Reminder]:e=>e===this?s:void 0}),await this.$.sendEvent({type:T.DefendAdded,location:this,amount:e})):(await this.$.oneEffectActivates(r.ExtraDefense,{location:this})&&(e+=2),await this.$.addSubEffectUntilEndOfTurn({text:`Defend ${e}.`,[r.DefendFromSpirits]:({land:a})=>a===this?e:0,[r.Reminder]:e=>e===this?s:void 0}),await this.$.sendEvent({type:T.DefendAdded,location:this,amount:e}),await this.$.doEffects(r.AfterPowerAddsDefense,{land:this,spirit:i,singleLand:n}))}destroy(e){return this.remove({...e,removement:A.DirectDestroy})}destroyAll(e,a={}){return this.remove({pieces:e,removement:A.DirectDestroy,quantifier:w.All,...a})}destroyOne(e,a){return this.remove({pieces:e,removement:A.DirectDestroy,...a})}destroyUpTo(e,a){return this.remove({quantifier:w.UpTo,amount:e,pieces:a,removement:A.DirectDestroy})}distanceToLocation(e){for(let a=0;a<this.locationsWithinBase.length;a+=1)if(this.locationsWithinBase[a].includes(e))return a;return 999}doExtraBuild(e){return this.build(!1,e)}doExtraExplore(e){return this.explore(!1,e)}doExtraRavage(e={}){const{calculateDoNotParticipateInRavage:a=!0}=e;return this.ravage({normal:!1,calculateDoNotParticipateInRavage:a})}doNormalBuild(e){return this.build(!0,e)}doNormalExplore(e){return this.explore(!0,e)}async doNotParticipateInRavage(e){const{pieceFilter:a=(()=>!0),amount:t=1,pieces:n=this.$.InvaderOrDahan,pickPiecesEffect:r}=e;let{quantifier:i=w.All}=e;const s=[];i===w.UpTo&&this.$.upToMustBeUsedAtMaximum&&(i=w.Exactly),i===w.May&&(i=w.UpTo);const o=()=>this.piecesThatAre(n).where((e=>!e.doesNotParticipateInRavage&&a(e)));if(i===w.AtLeast)await this.doNotParticipateInRavage({...e,quantifier:w.Exactly}),await this.doNotParticipateInRavage({...e,quantifier:w.Any});else if(i===w.UpToMinimumOne)await this.doNotParticipateInRavage({...e,amount:1,quantifier:w.Exactly}),await this.doNotParticipateInRavage({...e,amount:(e.amount??1)-1,quantifier:w.UpTo});else if(i===w.Any)await this.doNotParticipateInRavage({...e,quantifier:w.May,amount:o().count});else if(i===w.UpTo||i===w.All||i===w.Exactly)for(;i===w.UpTo&&s.length<t||i===w.All&&o().count>0||i===w.Exactly&&s.length!==t;){const e=s.length,a=o();if(i===w.All&&a.removeAllButFirst(),await a.pickOne((async e=>{s.push(e),await e.setDoesNotParticipateInRavage(!0)}),{autoPlayOneOption:!0,prompt:`Pick one ${ee[n].text} to not participate in ravage. (${t-s.length} left.)`,...r},i===w.UpTo),s.length===e)break}}doesntHave(e){return!this.pieces.some((a=>a.isA(e)))}doesntHaveIgnoringCountAs(e){return!this.hasIgnoringCountAs(e)}dontHaveAnyOf(...e){return!this.hasOneOf(...e)}downgrade(e={}){return this.upOrDowngrade({...e,downgrade:!0})}downgradeUpTo(e,a){return this.upOrDowngrade({quantifier:w.UpTo,amount:e,pieces:a,downgrade:!0})}drown(e){return this.remove({...e,removement:A.Drown})}fear(e){return this.isLand||this.isEndlessDark?this.$.generateFear({amount:e,location:this,fromDestroyingBuildings:!1}):Promise.resolve(null)}forEvery(e,a){return Math.floor(this.numberOf(a)/e)}forPieces(){return wn.createCollection(this.$,this.pieces)}forPiecesWithin(e,a,t={}){const n=[];return this.landsWithin(e,a,t).forEach((e=>n.push(...e.pieces))),wn.createCollection(this.$,n)}gather(e){return this.$.doInstruction((async()=>{const{pieces:a,owner:t,filter:n=(()=>!0),pieceFilter:i=(()=>!0),oceanIsAllowed:s=!1,pickPiecesEffect:o,single:d=!1}=e;let{amount:c=1}=e;const l=[],h=a===Z.Blight&&this.oceanIsLandForBlightOnThisBoard;if(!this.isLand&&!s&&!h)return Promise.resolve(l);h&&this.$.startAllowOceanForBlight(this);const g=a.includes(this.$.Beasts)&&this.$.extraBeastAdjacency?this.forPiecesWithin(2,null,{mayIncrease:!1}).where((e=>(e.isBeasts||e.isA(a)&&e.location.isAdjacentTo(this))&&e.location!==this)):this.piecesInAdjacentLands().where((e=>e.isA(a)));g.where((e=>i(e)&&null!==e.location&&n(e.location)&&!this.$.someEffect(r.PreventMovePiece,{source:e.location,destination:this,piece:e,movement:q.Gather})&&(void 0===t||e.owner===t)));const f=()=>{l.length>0&&(g.remove(l[l.length-1].piece),d&&g.where((e=>e.location===l[0].source)))};let{quantifier:u=w.Exactly}=e;if(u===w.Exactly&&ee[a].includesInvaders&&this.isIsolated?u=w.UpTo:u===w.UpTo&&this.$.upToMustBeUsedAtMaximum&&(u=w.Exactly),u===w.May&&(u=w.UpTo),u===w.AtLeast)l.push(...await this.gather({...e,quantifier:w.Exactly})),l.push(...await this.gather({...e,quantifier:w.Any}));else if(u===w.UpToMinimumOne)l.push(...await this.gather({...e,amount:1,quantifier:w.Exactly})),l.push(...await this.gather({...e,amount:(e.amount??1)-1,quantifier:w.UpTo}));else if(u===w.Any)l.push(...await this.gather({...e,quantifier:w.May,amount:g.count}));else if(u===w.UpTo)for(c<g.count&&await this.$.oneEffectActivates(r.ExtraMove,{movement:q.Gather,pieces:a,location:this,possiblePieces:g.items})&&(c+=1);l.length<c;){const e=l.length;if(await g.optionallyPickOne((async e=>{const t={piece:e,source:e.location,destination:this,movement:q.Gather,pieceFilter:a};l.push(t),this.$.reportMovement(t),await e.moveTo({location:this,movement:q.Gather,pieceFilter:a})}),{prompt:`Pick one ${ee[a].text} to Gather.${c>1?` (${c-l.length} left.)`:""}`,highlightLocations:[this],...o}),l.length===e)break;f()}else if(u===w.Exactly||u===w.All){let e=u===w.All?g.count:c;e<g.count&&await this.$.oneEffectActivates(r.ExtraMove,{movement:q.Gather,pieces:a,location:this,possiblePieces:g.items})&&(e+=1),await g.pickMultiple({amount:e,forPickedItem:async e=>{const t={piece:e,source:e.location,destination:this,movement:q.Gather,pieceFilter:a};l.push(t),this.$.reportMovement(t),await e.moveTo({location:this,movement:q.Gather,pieceFilter:a})},beforeNextItem:()=>{f()},effect:{prompt:`Pick one ${ee[a].text} to Gather.`,highlightLocations:[this],...o}})}return this.$.stopAllowOceanForBlight(),l}))}gatherAll(e){return this.gather({quantifier:w.All,pieces:e})}gatherOne(e){return this.gather({amount:1,pieces:e})}gatherUpTo(e,a){return this.gather({quantifier:w.UpTo,amount:e,pieces:a})}groupToBe(e,a,t,n,r,i,s,o,d,c,l){const h=this.piecesByGroup.findIndex((d=>d.length>0&&d[0].areSameGroupAs({piece:e,damage:a,shadowDamage:t,baseStrife:n,spiritNumber:o,doesNotParticipateInRavage:r,fightsBeforeInvaders:i,targetable:s,scenarioNumber:c,marked:l})));return void 0===(h>=0?this.piecesByGroup[h]:void 0)?void 0!==d&&d>=0&&(d>=this.piecesByGroup.length||0===this.piecesByGroup[d].length)?d:this.firstFreePosition:h}has(e){return this.pieces.some((a=>a.isA(e)))}hasAdjacentLandWhere(e){return this.adjacentLands.some(e)}hasAdjacentLandWithPiece(e){return this.hasAdjacentLandWhere((a=>a.has(e)))}hasAdjacentLocationWhere(e){return this.adjacentLocations.some(e)}hasAdjacentLocationWithPiece(e){return this.hasAdjacentLocationWhere((a=>a.has(e)))}hasAdjacentPresenceOf(e){return!this.adjacentPiecesInLandsWhere((a=>a.isPresence&&e.includes(a.owner))).isEmpty}hasAllOf(...e){return!e.some((e=>this.doesntHave(e)))}hasAtLeast(e,a){let t=0;for(const n of this.pieces)if(n.isA(a)&&(t+=1,t>=e))return!0;return t>=e}hasAtMost(e,a){return this.numberOf(a)<=e}hasExactly(e,a){return this.numberOf(a)===e}hasIgnoringCountAs(e){return this.pieces.some((a=>a.isIgnoringCountAsA(e)))}hasIncarnaOf(e){return this.pieces.some((a=>a.isIncarna&&a.owner===e))}hasNumber(e){return e===this.landNumber}hasOneOf(...e){return e.some((e=>this.has(e)))}hasOnePieceWhere(e){return this.pieces.some(e)}hasOrIsAdjacentToLandsWith(e){return this.has(e)||this.hasAdjacentLandWithPiece(e)}hasOrIsAdjacentToLocationsWith(e){return this.has(e)||this.hasAdjacentLocationWithPiece(e)}hasPresenceOf(e,a){return this.pieces.some((t=>t.isPresence&&(t.owner===e||a?.includes(t))))}hasSacredSiteOf(e,a=[]){return!this.isEndlessDark&&(this.numberOfPresenceOf(e,a)>=2||this.$.someEffect(r.HasSacredSiteOf,{land:this,spirit:e,helpers:a}))}hasSameTerrainAs(e){return this.isSands&&e.isSands||this.isMountains&&e.isMountains||this.isJungle&&e.isJungle||this.isWetlands&&e.isWetlands}hasTerrain(e,a=!1){return this.terrain===e||this.$.someLocationHasExtraTerrains&&this.$.someEffect(r.LocationIsTerrain,{location:this,terrain:e,isSpecialRule:a})}async healthCheck(){let e=!0;for(;e;){e=!1;for(const a of this.pieces)a.isAlive||!a.isInvader&&!a.isDahan||(await a.remove(A.DestroyByHealthChange),e=!0)}}inAdjacentLands(){return An.createCollection(this.$,this.adjacentLands)}inAdjacentLandsWhere(e){return this.inAdjacentLands().where(e)}inAdjacentLocations(){return An.createCollection(this.$,this.adjacentLocations)}inLands(e,a){if(e.target===g.ToThisLocation)return An.createCollection(this.$,[e.location]);if(e.target===g.WithinRange)return this.inLandsWithin(e.range,e.spirit);if(e.target===g.Adjacent)return 1===a?this.inAdjacentLands():this.inLandsWithin(a,null,{mayIncrease:!1}).remove(this);if(e.target===g.OnThisBoard)return null!==this.board?this.board.inLands():An.createCollection(this.$,[]);if(e.target===g.ToClosestLegalLand){for(let a=0;a<this.locationsWithinBase.length;a+=1){const t=this.inLandsWithin(a,null,{mayIncrease:!1}).where((a=>a.exists&&a.board!==e.notOnBoard));if(t.count>0)return t}return An.createCollection(this.$,[])}return e.target===g.AnyLocations?this.$.inLocations():this.$.inLands()}inLandsWithin(e,a=null,t={}){return An.createCollection(this.$,this.landsWithin(e,a,t))}inLocationsWithin(e,a){return An.createCollection(this.$,this.landsWithin(e,a,{allLocations:!0}))}inThisAndAdjacentLands(){return this.inAdjacentLands().add(this)}inThisAndAdjacentLocations(){return this.inAdjacentLocations().add(this)}insertPieceIntoPosition(e,a){for(;a>=this.piecesByGroup.length;)this.piecesByGroup.push([]);const t=this.piecesByGroup[a];for(let a=0;a<t.length+1;a+=1)if(a===t.length||e.id<t[a].id){t.splice(a,0,e);break}e.positionIndex=a,e.location=this,(e.piece===p.Presence||e.isIncarna)&&e.owner.addLand(this),this.$.pieceCount[e.piece]=(this.$.pieceCount[e.piece]??0)+1}invaders(){return this.piecesWhere((e=>e.isInvader))}isAdjacentTo(e){return this.adjacentLands.includes(e)}async isolate(){await this.$.sendEvent({type:T.LandIsolated,location:this}),await this.$.addSubEffectUntilEndOfTurn({[r.Reminder]:e=>e===this?"Isolated Land.":void 0,[r.Isolated]:({land:e})=>e===this})}landsContiguouslyConnectedBy(e){if(!this.hasPresenceOf(e))return[];const a=[],t=[this];for(;t.length>0;){const n=t.pop();a.push(n);for(const r of n.adjacentLands)!r.hasPresenceOf(e)||t.includes(r)||a.includes(r)||t.push(r)}return a}landsWithin(e,a,t={}){const{allLocations:n=!1,mayIncrease:i=!0,filter:s=(()=>!0),targetingLands:o=!1}=t,d=null!==a&&i?a.extraRange(this):0,c=this.locationsWithinBase.length>0?this.locationsWithinBase[Math.min(e+d,this.locationsWithinBase.length-1)].filter((e=>(e.isLand||n)&&s(e))):[];if(i&&null!==a){const t=[];for(const e of this.$.effectsMappedWithFilter(r.ExtraRangeToLand,{spirit:a,targetingLands:o}))e&&e.extraRangeToLand>0&&t.push(e);if(t.length>0){const a=e+d+nn(t,(e=>e.extraRangeToLand));this.locationsWithinBase[Math.min(a,this.locationsWithinBase.length-1)].forEach((a=>{if(c.includes(a)||!a.isLand&&!n)return;let r=e+d;for(const e of t)e.landFilter(a)&&(r+=e.extraRangeToLand);r=Math.min(r,this.locationsWithinBase.length-1),this.locationsWithinBase[r].includes(a)&&c.push(a)}))}}return c}matchesInvaderCard(e,a){const t=_t[e],n=this.$.resultFromFirstEffectOfType(r.OverrideMatchesInvaderCard,{land:this,card:e,invaderAction:a});return void 0!==n?n:this.terrainsMatchesInvaderCard(e)||t.coastal&&this.isCoastal||t.saltDeposits&&(a===K.Explore||a===K.Build)&&!this.isMiningLand||t.saltDeposits&&a===K.Ravage&&this.isMiningLand}matchesInvaderCards(e,a){return e.some((e=>this.matchesInvaderCard(e,a)))}mayGather(e){return this.gather({quantifier:w.May,pieces:e})}mayPush(e){return this.move({movement:q.Push,quantifier:w.May,pieces:e})}move(e){return this.$.doInstruction((async()=>{const{piece:a,pieces:t=Z.AllPieces,together:n=this.$.alwaysPushToSameDestination,pieceFilter:i=(()=>!0),destinationFilter:s=(()=>!0),owner:o,movement:d=q.Move,locations:c={target:g.Adjacent},differentLands:l=!1,pickPiecesEffect:h,pickDestinationEffect:f,oceanIsAllowed:u=!1,withoutWait:p=!1,evenly:y=!1}=e;let{amount:m=1}=e;const v=t===Z.Blight&&this.oceanIsLandForBlightOnThisBoard;if(d===q.Gather&&!this.isLand&&!u&&!v)return Promise.resolve([]);v&&this.$.startAllowOceanForBlight(this);let{quantifier:I=w.Exactly}=e,A=!1;I===w.Exactly&&ee[t].includesInvaders&&this.isIsolated?(I=w.UpTo,A=!0):I===w.UpTo&&this.$.upToMustBeUsedAtMaximum&&(I=w.Exactly),I===w.May&&(I=w.UpTo);const x=[],b=Zt[d].verb,T=()=>this.piecesWhere((e=>(void 0===a?e.isA(t)&&i(e)&&(void 0===o||e.owner===o):e===a)&&!x.some((a=>a.piece===e))));let E=T();const P=(e,a,t=!1)=>s(e)&&!this.$.someEffect(r.PreventMovePiece,{source:this,destination:e,piece:a,movement:d})&&(!n||0===x.length||x.some((a=>a.destination===e)))&&(!l&&!y||!x.some((a=>a.destination===e))||t)&&(!y&&!t||!x.some((a=>x.filter((e=>e.destination===a.destination)).length+1===x.filter((a=>a.destination===e)).length)));if(I===w.AtLeast)x.push(...await this.move({...e,quantifier:w.Exactly})),x.push(...await this.move({...e,quantifier:w.Any}));else if(I===w.UpToMinimumOne)x.push(...await this.move({...e,amount:1,quantifier:w.Exactly})),x.push(...await this.move({...e,amount:(e.amount??1)-1,quantifier:w.UpTo}));else{if(I===w.Any)return this.move({...e,quantifier:w.May,amount:E.count});if(I===w.UpTo||I===w.All||I===w.Exactly)for(I!==w.All&&m<E.count&&await this.$.oneEffectActivates(r.ExtraMove,{movement:d,pieces:t,location:this,possiblePieces:E.items})&&(m+=1);I===w.UpTo&&x.length<m||I===w.All&&E.count>0||I===w.Exactly&&x.length!==m;){const e=x.length;if(E=T(),I===w.All&&E.removeAllButFirst(),await E.pickOne((async a=>{const r=a.isBeasts&&d===q.Push&&this.$.extraBeastAdjacency;let i=this.inLands(c,r?2:1).where((e=>P(e,a)));0===i.count&&(i=this.inLands(c,r?2:1).where((e=>P(e,a,!0)))),await i.pickOne((async e=>{const n={piece:a,source:this,destination:e,movement:d,pieceFilter:t};x.push(n),this.$.reportMovement(n),await a.moveTo({location:e,movement:d,pieceFilter:t,withoutWait:p})}),{autoPlayOneOption:e>0&&n||c.target===g.ToThisLocation,highlightPieces:[a],prompt:`Pick land to ${b} ${ee[t].text}.${m>1?` (${m-x.length} left.)`:""}`,...f})}),{autoPlayOneOption:!0,prompt:`Pick one ${ee[t].text} to ${b}.${m>1?` (${m-x.length} left.)`:""}${A?" <br>(This is optional because land is Isolated)":""}`,...h},I===w.UpTo),x.length===e)break}}return this.$.stopAllowOceanForBlight(),x}))}moveBetween({upToAmount:e,pieces:a,destination:t}){return this.$.doInstruction((async()=>{const n=!this.$.upToMustBeUsedAtMaximum;await this.$.inLandsWhere(t).pickOne((async t=>{const i=this.$.forPiecesThatIs(a,(e=>e===this||e===t));let s=e;s<i.count&&await this.$.oneEffectActivates(r.ExtraMove,{movement:q.Move,pieces:a,location:this,possiblePieces:i.items})&&(s+=1),await this.$.forPiecesThatIs(a,(e=>e===this||e===t)).pickMultiple({amount:s,optional:n,effect:{highlightLocations:[this,t]},forPickedItem:async e=>{const n=e.location===this?t:this,r={piece:e,source:e.location,destination:n,movement:q.Move,pieceFilter:a};this.$.reportMovement(r),await e.moveTo({location:n,pieceFilter:a})}})}))}))}numberOf(e){return on(this.pieces,(a=>a.isA(e)))}numberOfPiecesInAdjacentLands(e){return this.inAdjacentLands().sum((a=>a.numberOf(e)))}numberOfPiecesInThisOrAdjacentLands(e,a){let t=0;for(const n of[this,...this.adjacentLands])for(const r of n.pieces)(r.isA(e)&&void 0===a||r.owner===a)&&(t+=1);return t}numberOfPresenceOf(e,a=[]){return on(this.pieces,(a=>a.isPresence&&a.owner===e))+a.filter((e=>e.location===this)).length}participatingDahan(){return this.piecesWhere((e=>!e.doesNotParticipateInRavage&&(e.isDahan||e.isExplorer&&this.explorersFightWithDahan)))}participatingInvaders(){return this.invaders().where((e=>!(e.doesNotParticipateInRavage||e.isExplorer&&this.explorersFightWithDahan)))}async pickOnePieceToNotParticipateInRavage(e){await this.doNotParticipateInRavage({quantifier:w.Exactly,amount:1,pieces:e})}piecesInAdjacentLands(){const e=[];return this.adjacentLands.forEach((a=>e.push(...a.pieces))),wn.createCollection(this.$,e)}piecesInThisAndAdjacentLands(){const e=[...this.pieces];return this.adjacentLands.forEach((a=>e.push(...a.pieces))),wn.createCollection(this.$,e)}piecesInThisAndAdjacentLocations(){const e=[...this.pieces];return this.adjacentLocations.forEach((a=>e.push(...a.pieces))),wn.createCollection(this.$,e)}piecesThatAre(e){return this.piecesWhere((a=>a.isA(e)))}piecesWhere(e){return this.forPieces().where(e)}piecesWithStrife(){return this.piecesWhere((e=>e.strife>0))}async piecesWithStrifeDealsDamageToOtherInvaders(){await this.piecesWithStrife().forEach((async e=>{await e.dealDamageToOtherInvaders()}),{noOptions:"No Invaders with <strife>."})}async possiblyDontCountPiecesAs(e,a){const t=void 0===a?this.pieces:this.pieces.filter((e=>e.owner===a));for(const a of t)if(await a.possiblyDontCountAs(e))return}possiblyReorderPieces(){for(;;){const e=this.firstOccupiedPositionInNextPage;if(!e)break;const a=this.firstFreePosition;if(a>=7)break;for(;this.piecesByGroup[e].length>0;){const t=this.piecesByGroup[e][0];this.removePieceFromItsPosition(t),this.insertPieceIntoPosition(t,a)}}}presenceOf(e){return this.piecesWhere((a=>a.owner===e&&a.isPresence))}push(e){return this.move({...e,movement:q.Push})}pushAll(e){return this.move({movement:q.Push,quantifier:w.All,pieces:e})}pushOne(e){return this.move({movement:q.Push,amount:1,pieces:e})}pushUpTo(e,a){return this.move({movement:q.Push,quantifier:w.UpTo,amount:e,pieces:a})}async putIncarna(e,a){const[t]=await this.createPiece(1,e,a.spiritNumber);return a.destroyedIncarna=null,t}putPresence(e,a){return this.createPiece(e,p.Presence,a.spiritNumber)}async ravage(e={}){if(this.isTheEndlessDark)return;const{normal:a=!0,card:t,calculateDoNotParticipateInRavage:n=!0}=e;await this.$.doInvaderAction(a?en.NormalInvaderAction:en.ExtraInvaderAction,(async()=>{await this.$.addEffect({name:"Ravage",text:`Ravage in land ${this.coordinate}.`,highlightLocations:[this],[r.Now]:async()=>{const e={land:this,normal:a,card:t,invaderAction:K.Ravage};let i=await this.$.oneEffectActivates(r.PreventInvaderActionInLand,e);if(i||(n&&await this.calculateDoNotParticipateInRavage(),i=await this.$.oneEffectActivates(r.AlterInvaderActionInLand,e)),i)return void await this.resetDoNotParticipateInRavage();await this.$.sendEvent({type:T.InvadersRavageInLand,location:this});let s=this.participatingInvaders();const o=this.participatingDahan();await this.$.doEffects(r.DahanFightBeforeInvaders,{land:this});const d=this.participatingDahan().where((e=>e.fightsBeforeInvaders)),c=o.sum((e=>e.fightsBeforeInvaders?0:e.strengthDuringRavage));if(this.$.beastsCountAsBadlands&&await this.possiblyDontCountPiecesAs(p.Beasts),await this.possiblyDontCountPiecesAs(p.Badlands),d.count>0){const e=d.sum((e=>e.strengthDuringRavage));if(e>0){const a=e+this.sumAdjustedCollectiveDahanRavageDamage;await this.damage(a,Z.Invader,{filter:e=>s.has(e)}),s=this.participatingInvaders()}}let l=s.sum((a=>a.strife>0?0:a.strengthDuringRavage+a.adjustedIndividualInvaderRavageDamage({towardsLand:!1,normal:e.normal}))),h=s.sum((a=>a.strife>0?0:a.strengthDuringRavage+a.adjustedIndividualInvaderRavageDamage({towardsLand:!0,normal:e.normal})));const g=this.sumAdjustedCollectiveInvaderRavageDamage({normal:e.normal,towardsLand:!1}),f=this.sumAdjustedCollectiveInvaderRavageDamage({normal:e.normal,towardsLand:!0});await s.forEach((async e=>{e.strife>0&&await e.removeStrife()}));let u=0;if(l>0&&(l+=g,l-=this.defense,u=l),h>0&&(h+=f,h-=this.defense),u>0){const e=await this.damage(u,Z.InvaderOrDahan,{filter:e=>o.has(e),efficiently:!0});e.length>0&&await this.$.doEffects(r.AfterDahanDestroyedInRavage,{land:this,amount:e.length})}h>0&&await this.damageLand(h);const w=o.where((e=>!e.fightsBeforeInvaders));if(w.count>0){const e=w.where((e=>e.isAlive)),a=this.dahanFightSimultaneously?c:e.sum((e=>e.strengthDuringRavage));if(a>0){const e=a+this.sumAdjustedCollectiveDahanRavageDamage;await this.damage(e,Z.Invader,{filter:e=>s.has(e)})}}await this.resetDoNotParticipateInRavage(),await this.resetDahanFightBefore()}})}),{land:this}),await this.$.doEffects(r.AfterRavaging,{land:this})}remove(e){return this.$.doInstruction((async()=>{const{amount:a=1,pieces:t=Z.AllPieces,owner:n,filter:i=(()=>!0),removement:s=A.Remove}=e,o=e.autoPlay??(e.quantifier===w.All&&!this.$.orderOfRemoveAllMightMatter),d=()=>this.piecesWhere((e=>e.isA(t)&&i(e)&&e.targetable&&(void 0===n||e.owner===n))),c=x[s].verb,l=[];let{quantifier:h=w.Exactly}=e;if(h===w.UpTo&&this.$.upToMustBeUsedAtMaximum&&(h=w.Exactly),h===w.May&&(h=w.UpTo),h===w.UpToMinimumOne)l.push(...await this.remove({...e,amount:1,quantifier:w.Exactly})),l.push(...await this.remove({...e,amount:(e.amount??1)-1,quantifier:w.UpTo}));else if(h===w.AtLeast)l.push(...await this.remove({...e,quantifier:w.Exactly})),l.push(...await this.remove({...e,quantifier:w.Any}));else{if(h===w.Any)return this.remove({...e,amount:d().count,quantifier:w.May});{const e=d();let n=h===w.All?e.count:a;n<e.count&&await this.$.oneEffectActivates(r.ExtraRemove,{removement:s,pieces:t,location:this,possiblePieces:e.items})&&(n+=1),await e.pickMultiple({amount:n,optional:h===w.UpTo,forPickedItem:async e=>{l.push(...await this.removePiece({piece:e,removement:s,removeAll:h===w.All,pieceFilter:t}))},autoplayIfPickingAll:o,effect:{autoPlayOneOption:o,prompt:`Pick one ${ee[t].text} to ${c}.`}})}}return l}))}async removeAllStrife(){await this.piecesWithStrife().forEach((async e=>{await e.removeStrife(e.baseStrife)}))}async removeBlight(e={}){const{amount:a=1,quantifier:t=w.Exactly,toTheBox:n=!1}=e,i=Math.min(this.numberOf(this.$.Blight),a),s=await this.remove({amount:i,pieces:this.$.Blight,quantifier:t,autoPlay:!0});return s.length>0&&!n&&!await this.$.oneEffectActivates(r.PreventAddRemovedBlightToBlightCard)&&await this.$.addBlightToBlightCard(s.length),s}removeInvadersWorthOfHealthUpTo(e,a={}){return this.$.doInstruction((async()=>{const{extraRemoveAllowed:t=!0,singleInvader:n=!1}=a,i=[],s=()=>this.invaders().where((a=>a.health<=e&&a.targetable));return await s().optionallyPickOne((async a=>{i.push(...await a.remove()),n||i.push(...await this.removeInvadersWorthOfHealthUpTo(e-a.health,{extraRemoveAllowed:!1}))}),{prompt:n?`Remove an Invader with ${e} health or less.`:`${e} health left to remove.`}),t&&await this.$.oneEffectActivates(r.ExtraRemove,{removement:A.Remove,pieces:this.$.Invader,location:this,possiblePieces:s().items})&&i.push(...await this.removeInvadersWorthOfHealthUpTo(e,{extraRemoveAllowed:!1,singleInvader:!0})),i}))}removeOne(e){return this.remove({pieces:e})}async removePiece(e){const{piece:a,removement:t,pieceFilter:n,byDamage:i=!1,removeAll:s=!1}=e;if(t!==A.Silent){const e={piece:a,location:this,removement:t,byDamage:i,removeAll:s};if(await this.$.oneEffectActivates(r.AdjustRemovePiece,e))return[];const n=await this.$.oneEffectActivates(r.PreventRemovePiece,e);if(x[t].isDestroyLike&&a.isInvader&&this.$.setHasAttemptedDestroyingInvaderThisInstruction(),n)return i&&(a.damage=0),await this.$.addEffectUntilEndOfAction({[r.PreventTargetPiece]:e=>a===e.piece,[r.PreventDamagingPiece]:e=>Promise.resolve(a===e.piece),[r.AdjustRemovePiece]:e=>Promise.resolve(a===e.piece),[r.ActionEnds]:()=>(a.placeInGroup(),Promise.resolve())}),a.placeInGroup(),[]}t!==A.Silent&&await this.$.waitForAnimationsToFinish();const o=ae(this.pieces,(e=>e.id===a.id));if(o){const e=o.positionIndex;this.removePieceFromItsPosition(o),0===this.piecesByGroup[e].length&&this.possiblyReorderPieces()}if(t!==A.Silent){if(o){if(!0!==x[t].skipEvent&&await this.$.sendEvent({type:T.PieceRemoved,piece:a,pieceType:a.piece,location:this,removement:t}),x[t].isDestroyLike&&await this.$.generateFear({amount:a.fearFromDestruction,location:this,fromDestroyingBuildings:!0}),a.piece===p.Presence){[A.DirectDestroy,A.DestroyByDamageOrBlight,A.Replace,A.Remove].includes(t)&&(a.owner.destroyedPresence+=1);const e=this.numberOfPresenceOf(a.owner);await this.$.doEffects(r.AfterLandChangesAmountOfPresence,{amountBefore:e+1,amountAfter:e,land:this,spirit:a.owner})}a.isIncarna&&![A.Relocate,A.Silent].includes(t)&&(a.owner.destroyedIncarna=a.piece)}await this.$.doEffects(r.AfterRemovePiece,{piece:a,location:this,removement:t,pieceFilter:n})}return o?[{piece:o,location:this,removement:t}]:[]}removePieceFromItsPosition(e){e.positionIndex>=0&&(e.positionIndex<this.piecesByGroup.length&&(ae(this.piecesByGroup[e.positionIndex],e),0!==this.piecesByGroup[e.positionIndex].length||e.piece!==p.Presence&&!e.isIncarna||this.hasPresenceOf(e.owner)||e.owner.removeLand(this),this.$.pieceCount[e.piece]=(this.$.pieceCount[e.piece]??0)-1),e.positionIndex=-1)}async removeStrife(e){await this.piecesWithStrife().pickMultiple({amount:e,where:e=>e.strife>0,forPickedItem:async e=>{await e.removeStrife()},repeatSame:!0,effect:{noOptions:"No <strife> to remove."}})}replaceIndividually(e){return this.$.doInstruction((async()=>{const{pieces:a,withPiece:t,owner:n,removement:i=A.Replace}=e;let{amount:s}=e;const o=this.piecesWhere((e=>e.isA(a)&&(void 0===n||e.owner===n))),d={removed:[],added:[]};return s<o.count&&await this.$.oneEffectActivates(r.ExtraRemove,{removement:i,pieces:a,location:this,possiblePieces:o.items})&&(s+=1),await o.pickMultiple({amount:s,forPickedItem:async e=>{const a=await e.replace([t],i);d.removed.push(...a.removed),d.added.push(...a.added)},effect:{autoPlayOneOption:!0}}),await this.$.doEffects(r.AfterReplacePieces,d),d}))}replaceOne(e){return this.$.doInstruction((async()=>{const{pieces:a,withAmount:t=1,withPiece:n,owner:i}=e,s={removed:[],added:[]};let o=1;const d=this.piecesWhere((e=>e.isA(a)&&(void 0===i||e.owner===i)));return o<d.count&&await this.$.oneEffectActivates(r.ExtraRemove,{removement:A.Replace,pieces:a,location:this,possiblePieces:d.items})&&(o+=1),await d.pickMultiple({amount:o,forPickedItem:async e=>{const a=await e.replace([...Array(t).keys()].map((()=>n)));s.removed.push(...a.removed),s.added.push(...a.added)}}),await this.$.doEffects(r.AfterReplacePieces,s),s}))}async resetDahanFightBefore(){for(const e of this.pieces)await e.setFightsBeforeInvaders(!1)}async resetDoNotParticipateInRavage(){for(const e of this.pieces)await e.setDoesNotParticipateInRavage(!1)}async restoreToSetupSymbols(e={}){const{exceptPieces:a=[],removeFirst:t=!0}=e,{setupSymbols:n}=this;n.length>0&&await this.$.sendEvent({type:T.RestoringLandToSetupSymbols,location:this}),t&&await this.remove({quantifier:w.All,autoPlay:!0,pieces:Z.AllPieces});let r=[...n];if(null!==this.board&&this.board.ignoreInvaderAndBlightInSetup){if(this.$.spiritCount<=4&&(r=r.filter((e=>![p.City,p.Town,p.Explorer].includes(e)))),3===this.$.spiritCount){let e=this.board.data.setupSymbols.findIndex((e=>e.includes(p.City)));e>=0?e===this.landIndex&&r.push(p.City):(e=this.board.data.setupSymbols.findIndex((e=>e.includes(p.Town))),e===this.landIndex&&r.push(p.Town))}if(4===this.$.spiritCount){mn(this.board.data.setupSymbols,(e=>e.includes(p.Town)))===this.landIndex&&r.push(p.Town)}}for(const e of r)if(!a.some((a=>ee[a].pieces.includes(e))))if(e!==p.Strife)(e!==p.Dahan||this.numberOfDahan<r.filter((e=>e===p.Dahan)).length)&&await this.createPiece(1,e);else{const e=n.indexOf(p.Strife)-1;if(e>=0){const a=n[e],t=this.pieces.find((e=>e.piece===a));void 0!==t&&await t.addStrife()}}}sharesCornerWith(e){return!!(this.isCornerLandOrNumberOne&&e.isCornerLandOrNumberOne&&e.boardIndex!==this.boardIndex&&e.isAdjacentTo(this))&&(2!==this.adjacentLocations.filter((a=>a.boardIndex===e.boardIndex&&a.isCornerLandOrNumberOne)).length||2!==e.adjacentLocations.filter((e=>e.boardIndex===this.boardIndex&&e.isCornerLandOrNumberOne)).length)}async skipInvaderAction(e={}){const{all:a=!1,next:t=!1,amount:n=1,textArea:i,text:s=this.$.currentStackEffect?.text,afterSkip:o,filter:d=(()=>!0)}=e,c=C.sH.box(0);await this.$.addSubEffectUntilEndOfTurn({[r.Reminder]:e=>e===this?`${s}${a?"":`<br><br>(${n-c.get()} left.)`}`:void 0,[r.PreventInvaderActionInLand]:async e=>!(e.land!==this||!d(e)||!(a||t||await this.$.may({textArea:i,highlightLocations:[this],prompt:`Skip ${e.invaderAction} Action?`})))&&(c.set(c.get()+1),a||c.get()!==n||this.$.removeThisEffect(),void 0!==o&&await o(e),!0)})}spiritsWithPresence(){return this.$.spiritsWhich((e=>this.hasPresenceOf(e)))}sumAdjustedCollectiveInvaderRavageDamage({normal:e,towardsLand:a}){return this.$.sumEffects(r.AdjustCollectiveInvaderRavageDamage,{land:this,normal:e,towardsLand:a})}terrainsMatchesInvaderCard(e){return _t[e].terrains.some((e=>this.hasTerrain(e)))}terrainsMatchesInvaderCards(e){return e.some((e=>this.terrainsMatchesInvaderCard(e)))}async timePasses(){for(const e of this.pieces)await e.timePasses()}toString(){return`${dn(this.pieces.map((e=>e.piece)))}`}upOrDowngrade(e){return this.$.doInstruction((async()=>{const{downgrade:a=!0,amount:t=1,pieces:n=this.$.Invader,filter:r=(()=>!0),pickPiecesEffect:i,different:s=!1}=e;let{quantifier:o=w.Exactly}=e;o===w.UpTo&&this.$.upToMustBeUsedAtMaximum&&(o=w.Exactly),o===w.May&&(o=w.UpTo);const d=[],c=()=>this.piecesWhere((e=>e.isA(n)&&r(e)&&(!s||0===d.length||!d.includes(e))));if(o===w.AtLeast)await this.upOrDowngrade({...e,quantifier:w.Exactly}),await this.upOrDowngrade({...e,quantifier:w.Any});else if(o===w.UpToMinimumOne)await this.upOrDowngrade({...e,amount:1,quantifier:w.Exactly}),await this.upOrDowngrade({...e,amount:(e.amount??1)-1,quantifier:w.UpTo});else if(o===w.Any)await this.upOrDowngrade({...e,quantifier:w.May,amount:c().count});else if(o===w.UpTo||o===w.All||o===w.Exactly)for(;o===w.UpTo&&d.length<t||o===w.All&&c().count>0||o===w.Exactly&&d.length!==t;){const e=d.length,r=c();if(o===w.All&&r.removeAllButFirst(),await r.pickOne((async e=>{d.push(e),a?await e.downgrade():await e.upgrade()}),{autoPlayOneOption:o===w.All,prompt:`Pick one ${ee[n].text} to ${a?"downgrade":"upgrade"}. (${t-d.length} left.)`,...i},o===w.UpTo),d.length===e)break}}))}upgrade(e){return this.upOrDowngrade({...e,downgrade:!1})}upgradeUpTo(e,a){return this.upOrDowngrade({quantifier:w.UpTo,amount:e,pieces:a,downgrade:!1})}get adjustedLandHealth(){return this.$.sumEffects(r.AdjustLandHealth,{land:this})}get firstFreePosition(){let e=0;for(;e<this.piecesByGroup.length&&this.piecesByGroup[e].length>0;)e+=1;return e}get firstOccupiedPositionInNextPage(){let e=7;for(;;){if(e>=this.piecesByGroup.length)return;if(this.piecesByGroup[e].length>0)break;e+=1}return e}async build(e,a){this.isTheEndlessDark||await this.$.doInvaderAction(e?en.NormalInvaderAction:en.ExtraInvaderAction,(async()=>{await this.$.addEffect({name:"Build",text:`Build in land ${this.coordinateLink}.`,highlightLocations:[this],[r.Now]:async()=>{const t={land:this,normal:e,card:a,invaderAction:K.Build};let n=await this.$.oneEffectActivates(r.PreventInvaderActionInLand,t);if(!n&&this.has(Z.Disease)&&(await this.$.oneEffectActivates(r.PreventDiseasePreventingBuilds,{location:this})||(n=!0,await this.$.addSubEffect({text:`The Build in land ${this.coordinateLink} is prevented by <disease>.`,[r.Now]:async()=>{await this.removeOne(this.$.Disease)}}))),!n&&(await this.$.doEffects(r.BeforeSuccessfulBuild,{land:this}),n=await this.$.oneEffectActivates(r.AlterInvaderActionInLand,t),!n)){const e=await this.add(1,this.buildPlans);await this.$.doEffects(r.AfterSuccessfulBuild,{land:this,additions:e})}}})}),{land:this})}async explore(e,a){this.isTheEndlessDark||await this.$.doInvaderAction(e?en.NormalInvaderAction:en.ExtraInvaderAction,(async()=>{await this.$.addEffect({name:"Explore",text:`Explore in land ${this.coordinate}.`,highlightLocations:[this],[r.Now]:async()=>{const t={land:this,normal:e,card:a,invaderAction:K.Explore};this.isIsolated||await this.$.oneEffectActivates(r.PreventInvaderActionInLand,t)||(await this.$.doEffects(r.BeforeSuccessfulExplore,{land:this}),this.has(Z.Wilds)&&!this.$.ignoreWildsDuringExplore?await this.removeOne(this.$.Wilds):await this.$.oneEffectActivates(r.AlterInvaderActionInLand,t)||await this.add(1,Z.Explorer),await this.$.doEffects(r.AfterSuccessfulExplore,t),a&&await this.$.escalate(a,{afterExploringLand:this}))}})}),{land:this})}}In([C.sH],An.prototype,"pieces",void 0),In([C.sH],An.prototype,"piecesByGroup",void 0),In([C.EW],An.prototype,"elements",null);const xn={name:"Scream Disease Into The Wind",type:o.Minor,speed:d.Fast,energy:1,elements:[i.Air,i.Water,i.Animal],set:s.JaggedEarth,target:c.Spirit,targetFilter:[m.Another],effects:[{textArea:[.607,.696],text:"Target Spirit gets <range+1> with all their Powers.",[r.TargetSpirit]:async({$:e,spirit:a})=>{await e.addSubEffectUntilEndOfTurn({[r.GlobalReminder]:()=>({icon:"<range+1>",players:[a]}),[r.ExtraRange]:e=>e.spirit===a?1:0})}},{textArea:[.703,.929],text:"Once this turn, after target Spirit uses a Power targeting a land, they may add 1 <disease> to that land. (Hand them a <disease> token as a reminder.)",[r.TargetSpirit]:async({$:e,power:a,spirit:t,...n})=>{const i=C.sH.box(!1),s={triggerId:e.nextTriggerId(),[r.Now]:async({action:a})=>{a.parentData.targetLands.some((e=>e.exists))&&await e.may({prompt:"Add 1 <disease> to target land?"})&&(i.set(!0),await An.createCollection(e,a.parentData.targetLands).pickOne((async a=>{await a.add(1,e.Disease)}),{autoPlayOneOption:!0}))}};await e.addSubEffectUntilEndOfTurn({[r.GlobalReminder]:()=>({icon:`<disease><br>${i.get()?"1":"0"} / 1`,players:[t]}),[r.AfterTargetingLands]:async a=>{a.power.owner!==t||i.get()||(e.action.data.targetLands=a.lands,await e.addTrigger(s,n.effect,n.action))}})}}]},bn={name:"Sear Anger Into The Wild Lands",type:o.Minor,speed:d.Slow,energy:0,elements:[i.Sun,i.Fire,i.Plant],set:s.JaggedEarth,target:c.Land,range:1,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.644,.877],text:"Add 1 <badlands>.<or>If <wilds> and Invaders are present, 1 <fear> and 1 Damage.",[r.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"Badlands",textArea:[.651,.691],text:"Add 1 <badlands>.",[r.Now]:async()=>{await a.add(1,e.Badlands)}},{actionId:"Wilds",textArea:[.778,.874],text:"If <wilds> and Invaders are present, 1 <fear> and 1 Damage.",[r.Now]:async()=>{a.hasAllOf(e.Wilds,e.Invader)&&(await a.fear(1),await a.damage(1))}}]})}}]},Tn={name:"Set Them On An Ever-Twisting Trail",type:o.Minor,speed:d.Fast,energy:1,elements:[i.Air,i.Plant,i.Animal],set:s.JaggedEarth,target:c.Land,sourceFilter:[l.SacredSite],range:1,hasPushOrGather:!0,effects:[{textArea:[.712,.752],text:"Gather or Push 1 <explorer>.",[r.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"Gather",text:"Gather 1 <explorer>.",[r.Now]:async()=>{await a.gatherOne(e.Explorer)}},{actionId:"Push",text:"Push 1 <explorer>",[r.Now]:async()=>{await a.pushOne(e.Explorer)}}]},{orChoice:!1})}},{textArea:[.768,.808],text:"Isolate target land.",[r.InTargetLand]:async({land:e})=>{await e.isolate()}}]},En={name:"Skies Herald The Season Of Return",type:o.Minor,speed:d.Fast,energy:1,elements:[i.Sun,i.Moon,i.Plant,i.Animal],set:s.JaggedEarth,target:c.Land,range:1,hasPushOrGather:!0,blightWhiteListedPower:!0,effects:[{textArea:[.657,.745],text:"A Spirit with <presence> on target board may add 1 of their Destroyed <presence>.",[r.InTargetLand]:async({$:e,land:a})=>{await e.spiritsWhich((e=>a.boards().hasOneWhere((a=>a.spiritsWithPresence().has(e))))).pickOne((async e=>{await a.addPresence(e,{destroyed:!0})}),{noOptions:"No Spirits with <presence> on target board."})}},{textArea:[.756,.796],text:"Gather up to 2 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(2,e.Dahan)}},{textArea:[.814,.854],text:"Push 1 <blight>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushOne(e.Blight)}}]},Pn={name:"Strong And Constant Currents",type:o.Minor,speed:d.Fast,energy:0,elements:[i.Sun,i.Water,i.Earth],set:s.JaggedEarth,target:c.Land,targetFilter:[l.Coastal],range:0,hasPushOrGather:!0,effects:[{textArea:[.59,.94],text:"Push 1 <explorer>/<town> to an adjacent Coastal land.<or>Move up to 2 <dahan> between target land and one other Coastal land.<br><br>If you have 2 <water>:<br>You may do both.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await e.chooseBetween({effects:[{actionId:"Push",textArea:[.59,.671],text:"Push 1 <explorer>/<town> to an adjacent Coastal land.",[r.Now]:async()=>{await t.push({amount:1,pieces:e.ExplorerOrTown,destinationFilter:e=>e.isCoastal})}},{actionId:"Move",textArea:[.719,.808],text:"Move up to 2 <dahan> between target land and one other Coastal land.",[r.Now]:async()=>{await t.moveBetween({upToAmount:2,pieces:e.Dahan,destination:e=>e.isCoastal&&e!==t})}},{actionId:"DoBoth",text:"Do both.",condition:()=>!e.treatingAllOrsAsAnds&&a.hasElementsWithConvert({[i.Water]:2}),[r.Now]:async()=>{await a.convertElements({[i.Water]:2}),await e.addSubEffect({textArea:[.59,.671],text:"Push 1 <explorer>/<town> to an adjacent Coastal land.",[r.Now]:async()=>{await t.push({amount:1,pieces:e.ExplorerOrTown,destinationFilter:e=>e.isCoastal})}}),await e.addSubEffect({textArea:[.719,.808],text:"Move up to 2 <dahan> between target land and one other Coastal land.",[r.Now]:async()=>{await t.moveBetween({upToAmount:2,pieces:e.Dahan,destination:e=>e.isCoastal&&e!==t})}})}}]})}}]},Sn={name:"Sucking Ooze",type:o.Minor,speed:d.Fast,energy:0,elements:[i.Moon,i.Water,i.Earth],set:s.JaggedEarth,target:c.Land,targetFilter:[l.Sands,l.Wetlands],range:1,generatesFear:!0,effects:[{textArea:[.719,.759],text:"2 <fear> if Invaders are present.",[r.InTargetLand]:async({land:e})=>{e.hasInvaders&&await e.fear(2)}},{textArea:[.773,.813],text:"Isolate target land.",[r.InTargetLand]:async({land:e})=>{await e.isolate()}}]},On={name:"Sunsets Fire Flows Across The Land",type:o.Minor,speed:d.Slow,energy:1,elements:[i.Sun,i.Moon,i.Fire,i.Water],set:s.JaggedEarth,target:c.Land,sourceFilter:[l.SacredSite],range:1,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.699,.739],text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.699,.739],text:"1 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(1)}},{textArea:[.756,.841],text:"You may pay 1 Energy to deal 1 Damage in an adjacent land.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{a.energy>=1&&await e.may({prompt:"Pay 1 Energy to deal 1 Damage in an adjacent land?"})&&await t.inAdjacentLands().pickOne((async e=>{await e.damage(1)}))}}]},Cn={name:"Territorial Strife",type:o.Minor,speed:d.Slow,energy:0,elements:[i.Sun,i.Fire,i.Animal],set:s.JaggedEarth,target:c.Land,targetFilter:[l.City],range:1,hasDamageInstructions:!0,effects:[{textArea:[.676,.858],text:"3 Damage to <explorer>/<town><or>Add 1 <strife>.",[r.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"Damage",textArea:[.683,.723],text:"3 Damage to <explorer>/<town>.",[r.Now]:async()=>{await a.damage(3,e.ExplorerOrTown)}},{actionId:"Strife",textArea:[.814,.854],text:"Add 1 <strife>.",[r.Now]:async()=>{await a.addStrife(1)}}]})}}]},Dn={name:"Terror Turns To Madness",type:o.Minor,speed:d.Slow,energy:0,elements:[i.Moon,i.Air,i.Water],set:s.JaggedEarth,target:c.Land,targetFilter:[l.Invaders],range:2,generatesFear:!0,effects:[{textArea:[.617,.906],text:"If the Terror Level is I: 3 <fear><br>II: 2 <fear> or add 1 <strife>.<br>III: Add 1 <strife>.",[r.InTargetLand]:async({$:e,land:a})=>{1===e.terrorLevel?await e.addSubEffect({textArea:[.703,.743],text:"3 <fear>.",[r.Now]:async()=>{await a.fear(3)}}):2===e.terrorLevel?await e.chooseBetween({effects:[{actionId:"Fear",textArea:[.779,.819],text:"2 <fear>.",[r.Now]:async()=>{await a.fear(2)}},{actionId:"AddStrife",textArea:[.779,.819],text:"Add 1 <strife>.",[r.Now]:async()=>{await a.addStrife(1)}}]},{orChoice:!1}):3===e.terrorLevel&&await e.addSubEffect({textArea:[.85,.89],text:"Add 1 <strife>.",[r.Now]:async()=>{await a.addStrife(1)}})}}]},Bn={name:"The Shore Seethes With Hatred",type:o.Minor,speed:d.Slow,energy:1,elements:[i.Fire,i.Water,i.Earth,i.Plant],set:s.JaggedEarth,target:c.Land,targetFilter:[l.Coastal],range:1,generatesFear:!0,effects:[{textArea:[.716,.756],text:"1 <fear>",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.778,.818],text:"Add 1 <badlands> and 1 <wilds>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Badlands),await a.add(1,e.Wilds)}}]},kn={name:"Thriving Chokefungus",type:o.Minor,speed:d.Slow,energy:1,elements:[i.Moon,i.Water,i.Plant],set:s.JaggedEarth,target:c.Land,sourceFilter:[l.SacredSite],targetFilter:[l.Jungle,l.Wetlands],range:1,effects:[{textArea:[.746,.786],text:"Add 1 <disease> and 1 <badlands>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Disease),await a.add(1,e.Badlands)}}]},Ln={name:"Treacherous Waterways",type:o.Minor,speed:d.Fast,energy:0,elements:[i.Fire,i.Water,i.Earth],set:s.JaggedEarth,target:c.Land,targetFilter:[l.Mountain,l.Wetlands],range:1,hasPushOrGather:!0,effects:[{textArea:[.676,.865],text:"Add 1 <wilds>.<or>Push 1 <explorer>.",[r.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"Wilds",textArea:[.683,.723],text:"Add 1 <wilds>.",[r.Now]:async()=>{await a.add(1,e.Wilds)}},{actionId:"Push",textArea:[.814,.854],text:"Push 1 <explorer>.",[r.Now]:async()=>{await a.pushOne(e.Explorer)}}]})}}]},Fn={name:"Unquenchable Flames",type:o.Minor,speed:d.Slow,energy:1,elements:[i.Moon,i.Fire,i.Earth],set:s.JaggedEarth,target:c.Land,sourceFilter:[l.SacredSite],range:2,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.607,.647],text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.607,.647],text:"1 Damage to <town>/<city>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.damage(1,e.TownOrCity)}},{textArea:[.661,.755],text:"Invaders do not heal Damage at end of turn.",[r.InTargetLand]:async({$:e,land:a,effect:t})=>{await e.addSubEffectUntilEndOfTurn({[r.Reminder]:e=>e===a?t.text:void 0,[r.PreventClearDamage]:({piece:e})=>e.isInvader&&e.location===a})}},{textArea:[.878,.918],text:"If you have 2 <fire>:<br>Add 1 <badlands>.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[i.Fire]:2})&&await t.add(1,e.Badlands)}}]},Rn={name:"Weep For What Is Lost",type:o.Minor,speed:d.Slow,energy:0,elements:[i.Fire,i.Water,i.Animal],set:s.JaggedEarth,target:c.Land,targetFilter:[l.Blight],range:1,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.71,.75],text:"1 <fear> per type of Invader present.",[r.InTargetLand]:async({$:e,land:a})=>{await a.fear((a.has(e.Explorer)?1:0)+(a.has(e.Town)?1:0)+(a.has(e.City)?1:0))}},{textArea:[.771,.811],text:"Push up to 1 <explorer>/<town> per <blight>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(a.numberOf(e.Blight),e.ExplorerOrTown)}}]},Nn={name:"Roiling Bog And Snagging Thorn",type:o.Minor,speed:d.Fast,energy:0,elements:[i.Moon,i.Fire,i.Water,i.Plant],set:s.NatureIncarnate,target:c.Land,sourceFilter:[l.SacredSite],range:1,generatesFear:!0,effects:[{textArea:[.652,.693],text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.652,.693],text:"Isolate.",[r.InTargetLand]:async({land:e})=>{await e.isolate()}},{textArea:[.652,.693],text:"Defend 2.",[r.InTargetLand]:async({land:e})=>{await e.defend(2)}},{textArea:[.727,.9],text:"1 <dahan> does not participate in Ravage. (Check when Ravaging; it does not take Damage and does not counterattack.).",[r.InTargetLand]:async({$:e,land:a,effect:t})=>{await e.addSubEffectUntilEndOfTurn({[r.Reminder]:e=>e===a?t.text:void 0,[r.DoesNotParticipateInRavage]:async({location:t})=>{t===a&&await t.pickOnePieceToNotParticipateInRavage(e.Dahan)}})}}]},$n={name:"Ward the Shores",type:o.Scenario,speed:d.Slow,energy:0,elements:[],set:s.BranchAndClaw,target:c.Land,range:0,sourceFilter:[l.SacredSite],targetFilter:[l.WardTheShores],effects:[{text:"Pay 2 Energy per <blight> and 2 Energy per <town>/<city> to add a Warding Pattern.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{const n=2*t.numberOf(e.Blight)+2*t.numberOf(e.TownOrCity);await a.payEnergy(n),await t.add(1,e.WardingPattern)}}]},Wn={name:"Call On Midnight's Dream",type:o.Unique,speed:d.Fast,energy:0,elements:[i.Moon,i.Animal],set:s.Base,target:c.Land,range:0,generatesFear:!0,effects:[{textArea:[.628,.91],text:"If target land has <dahan>, gain a Major Power. If you Forget this Power, gain Energy equal to <dahan> and you may play the Major Power immediately, paying its cost.<or>If Invaders are present, 2 <fear>.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await e.chooseBetween({effects:[{actionId:"GainMajor",textArea:[.633,.83],label:"Gain a Major Power.",text:"Gain a Major Power. If you Forget this Power, gain Energy equal to <dahan> and you may play the Major Power immediately, paying its cost.",[r.Now]:async()=>{const n=await a.gainPowerCard({powerType:o.Major});if(n.chosen.length>0){const r=n.chosen[0];if(!a.hasPower(_e.CallOnMidnightsDream)&&(await a.gainEnergy(t.numberOf(e.Dahan)),null!==n)){const t=bd[r.power].energy??0;a.energy>=t&&await e.may({prompt:`Play the Major Power immediately, paying ${t} energy?`})&&await r.play({withoutUsingCardPlays:!0})}}},condition:()=>t.has(e.Dahan)},{actionId:"Fear",textArea:[.864,.904],text:"If Invaders are present, 2 <fear>.",[r.Now]:async()=>{await t.fear(2)},condition:()=>t.hasInvaders}]})}}]},Mn={name:"Dread Apparitions",type:o.Unique,speed:d.Fast,energy:2,elements:[i.Moon,i.Air],set:s.Base,target:c.Land,targetFilter:[l.Invaders],range:1,generatesFear:!0,effects:[{textArea:[.624,.709],text:"When Powers generate <fear> in target land, Defend 1 per <fear>.",[r.InTargetLand]:async({$:e,land:a})=>{const t=C.sH.box(0);await e.addSubEffectUntilEndOfTurn({[r.Reminder]:void 0,[r.DefendFromSpirits]:e=>e.land===a?t.get():0}),await e.addSubEffectUntilEndOfTurn({[r.AfterPowerGenerateFearInLand]:({fromDestroyingBuildings:n,location:r,amount:i})=>(r!==a||n||e.currentActionType!==en.PowerAction||t.set(t.get()+i),Promise.resolve()),[r.Reminder]:e=>e===a?`${t.get()} <fear> = ${t.get()} Defense.`:void 0})}},{textArea:[.71,.75],text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}}]},Gn={name:"Dreams Of The Dahan",type:o.Unique,speed:d.Fast,energy:0,elements:[i.Moon,i.Air],set:s.Base,target:c.Land,range:2,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.673,.855],text:"Gather up to 2 <dahan>.<or>If target land has <town>/<city>, 1 <fear> for each <dahan>, to a maximum of 3 <fear>.",[r.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"Gather",textArea:[.679,.719],text:"Gather up to 2 <dahan>.",[r.Now]:async()=>{await a.gatherUpTo(2,e.Dahan)}},{actionId:"Fear",textArea:[.758,.854],text:"1 <fear> for each <dahan>, to a maximum of 3 <fear>.",[r.Now]:async()=>{await a.fear(Math.min(a.numberOf(e.Dahan),3))},condition:()=>a.has(e.TownOrCity)}]})}}]},Hn={name:"Night Terrors",type:o.Innate,speed:d.Fast,set:s.Base,target:c.Land,targetFilter:[l.Invaders],range:0,generatesFear:!0,effects:[{text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)},threshold:{[i.Moon]:1,[i.Air]:1}},{text:"+1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)},threshold:{[i.Moon]:2,[i.Air]:1,[i.Animal]:1}},{text:"+1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)},threshold:{[i.Moon]:3,[i.Air]:2,[i.Animal]:1}}]},Un={name:"Predatory Nightmares",type:o.Unique,speed:d.Slow,energy:2,elements:[i.Moon,i.Fire,i.Earth,i.Animal],set:s.Base,target:c.Land,sourceFilter:[l.SacredSite],targetFilter:[l.Invaders],range:1,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{textArea:[.637,.677],text:"2 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(2)}},{textArea:[.679,.719],text:"Push up to 2 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(2,e.Dahan)}}]},qn=[i.Sun,i.Moon,i.Fire,i.Air,i.Water,i.Earth,i.Plant,i.Animal],jn={name:"Spirits May Yet Dream",type:o.Innate,speed:d.Fast,set:s.Base,target:c.Spirit,effects:[{text:"Turn any face-down Fear Card face-up. (It's earned/resolved normally, but players can see what's coming.)",[r.TargetSpirit]:async({$:e})=>{const a=await e.pickAFaceDownFearCard();if(null!=a){const t=await e.revealFearCardInDeck(a);null!==t&&await e.query({query:tn.ClickToContinueCard,items:[t],actionIds:[t]})}},threshold:{[i.Moon]:2,[i.Air]:2}},{text:"Target Spirit gains an Element they have at least 1 of.",[r.TargetSpirit]:async({spirit:e})=>{const a=await e.gainElements({possiblyWithConvert:!0,elements:[...qn].filter((a=>e.hasElementsWithConvert({[a]:1})))});await e.convertElements(a);const t=Object.keys(a).find((e=>1===a[e]));void 0!==t&&1===e.elements[t]&&await e.convertElements({[t]:1})},threshold:{[i.Moon]:3}}]},Jn={name:"A Year Of Perfect Stillness",type:o.Unique,speed:d.Fast,energy:3,elements:[i.Sun,i.Earth],set:s.Base,target:c.Land,range:1,effects:[{textArea:[.719,.814],text:"Invaders skip all Actions in target land this turn.",[r.InTargetLand]:async({land:e})=>{await e.skipInvaderAction({all:!0})}}]},Vn={name:"Draw Of The Fruitful Earth",type:o.Unique,speed:d.Slow,energy:1,elements:[i.Earth,i.Plant,i.Animal],set:s.Base,target:c.Land,range:1,hasPushOrGather:!0,effects:[{textArea:[.722,.762],text:"Gather up to 2 <explorer>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(2,e.Explorer)}},{textArea:[.766,.806],text:"Gather up to 2 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(2,e.Dahan)}}]},Yn={[l.Beasts]:({$:e,land:a})=>a.has(e.Beasts),[l.Blight]:({$:e,land:a})=>a.has(e.Blight),[l.BlightAndInvaders]:({$:e,land:a})=>a.hasAllOf(e.Blight,e.Invader),[l.City]:({$:e,land:a})=>a.has(e.City),[l.Coastal]:({land:e})=>e.isCoastal,[l.CoastalCity]:({$:e,land:a})=>a.isCoastal&&a.has(e.City),[l.Dahan]:({$:e,land:a})=>a.has(e.Dahan),[l.Deeps]:({$:e,land:a})=>a.has(e.Deeps),[l.Disease]:({$:e,land:a})=>a.has(e.Disease),[l.Incarna]:({$:e,land:a})=>a.has(e.Incarna),[l.IncarnaAndDahan]:({$:e,land:a})=>a.hasAllOf(e.Incarna,e.Dahan),[l.IncarnaBehemoth]:({$:e,land:a})=>a.has(e.IncarnaBehemoth),[l.IncarnaLair]:({$:e,land:a})=>a.has(e.IncarnaLair),[l.IncarnaRoots]:({$:e,land:a})=>a.has(e.IncarnaRoots),[l.IncarnaVoice]:({$:e,land:a})=>a.has(e.IncarnaVoice),[l.Inland]:({land:e})=>e.isInland,[l.Invaders]:({land:e})=>e.hasInvaders,[l.InvadersAndIncarnaRoots]:({$:e,land:a})=>a.hasAllOf(e.Invader,e.IncarnaRoots),[l.Jungle]:({land:e})=>e.isJungle,[l.JunglesOrWetlands]:({land:e})=>e.isJungleOrWetlands,[l.Mountain]:({land:e})=>e.isMountains,[l.MountainOrJungles]:({land:e})=>e.isMountainsOrJungles,[l.NoInvaders]:({$:e,land:a})=>a.doesntHave(e.Invader),[l.NonBlight]:({$:e,land:a})=>a.doesntHave(e.Blight),[l.NonOceanLand]:({land:e})=>!e.isOcean,[l.NotWetlands]:({land:e})=>!e.isWetlands,[l.Quake]:({$:e,land:a})=>a.has(e.Quake),[l.SacredSite]:({land:e,owner:a,helpers:t})=>e.hasSacredSiteOf(a,t),[l.SacredSiteAndDahan]:({$:e,land:a,owner:t,helpers:n})=>a.hasSacredSiteOf(t,n)&&a.has(e.Dahan),[l.Sands]:({land:e})=>e.isSands,[l.Strife]:({land:e})=>e.hasStrife,[l.TheEndlessDark]:({land:e})=>e.isTheEndlessDark,[l.Town]:({$:e,land:a})=>a.has(e.Town),[l.TownOrCity]:({$:e,land:a})=>a.has(e.TownOrCity),[l.TwoBeasts]:({$:e,land:a})=>a.hasAtLeast(2,e.Beasts),[l.TwoBeastsAndInvaders]:({$:e,land:a})=>a.hasAtLeast(2,e.Beasts)&&a.hasInvaders,[l.TwoDahan]:({$:e,land:a})=>a.hasAtLeast(2,e.Dahan),[l.WardTheShores]:({$:e,land:a,owner:t})=>2*(a.numberOf(e.Blight)+a.numberOf(e.TownOrCity))<=t.energy,[l.Wetlands]:({land:e})=>e.isWetlands},zn={[ye.Minor]:{name:"Minor",text:"Minor Power",cardTypes:[o.Minor]},[ye.Major]:{name:"Major",text:"Major Power",cardTypes:[o.Major]},[ye.Unique]:{name:"Unique",text:"Unique Power",cardTypes:[o.Unique]},[ye.Innate]:{name:"Innate",text:"Innate Power",cardTypes:[o.Innate]},[ye.NonMinorCard]:{name:"Non-Minor",text:"non-Minor Power",cardTypes:[o.Major,o.Unique]},[ye.NonMajorCard]:{name:"Non-Major",text:"non-Major Power",cardTypes:[o.Minor,o.Unique]},[ye.NonUniqueCard]:{name:"Non-Unique",text:"non-Unique Power",cardTypes:[o.Minor,o.Major]},[ye.AnyCard]:{name:"Any Card",text:"any Power Card",cardTypes:[o.Minor,o.Major,o.Unique,o.Scenario]},[ye.Any]:{name:"Any",text:"any Power",cardTypes:[o.Minor,o.Major,o.Unique,o.Innate]}},Qn={[m.Another]:({$:e,spirit:a,owner:t})=>a!==t||1===e.spiritCount,[m.Yourself]:({spirit:e,owner:a})=>e===a};var Kn,Xn;!function(e){e.InHand="InHand",e.PlayedFast="PlayedFast",e.PlayedSlow="PlayedSlow",e.ResolvedFast="ResolvedFast",e.ResolvedSlow="ResolvedSlow",e.Discarded="Discarded",e.Impending="Impending"}(Kn||(Kn={})),function(e){e.ADiversityOfSpirits="ADiversityOfSpirits",e.Blitz="Blitz",e.DahanInsurrection="DahanInsurrection",e.DespicableTheft="DespicableTheft",e.DestinyUnfold="DestinyUnfold",e.ElementalInvocation="ElementalInvocation",e.GuardTheIslesHeart="GuardTheIslesHeart",e.LargerSurges="LargerSurges",e.PowersLongForgotten="PowersLongForgotten",e.RitualsOfTerror="RitualsOfTerror",e.RitualsOfTheDestroyingFlame="RitualsOfTheDestroyingFlame",e.SecondWave="SecondWave",e.SurgesOfColonization="SurgesOfColonization",e.TheGreatRiver="TheGreatRiver",e.VariedTerrain="VariedTerrain",e.WardTheShores="WardTheShores"}(Xn||(Xn={}));var _n=function(e,a,t,n){var r,i=arguments.length,s=i<3?a:null===n?n=Object.getOwnPropertyDescriptor(a,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,a,t,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(i<3?r(s):i>3?r(a,t,s):r(a,t))||s);return i>3&&s&&Object.defineProperty(a,t,s),s};class Zn{data;power;assisted=!1;impendingEnergy=0;status;$;blessed=!1;constructor(e,a,t){un.makeObservable(this),this.$=e,this.power=a,this.data=bd[this.power],this.status=t}get availablePresenceForTargeting(){return this.owner.availablePresenceForTargeting}get costTime(){return this.$.sumEffects(r.PowerCostExtraTime,{power:this})}get costToPlay(){if(this.assisted)return 0;let e=this.data.energy||0;return e+=this.$.scenario===Xn.Blitz&&this.data.speed===d.Fast?-1:0,e}get estimatedValueOfPower(){const e=[];for(const a of this.data.effects)if(a.threshold&&this.owner.hasElementsWithConvert(a.threshold)){if(a.instead){const t=this.data.effects.indexOf(a)-1,n=this.data.effects[t];e.includes(n)&&ae(e,n)}e.push(a)}return e.map((e=>Math.max(...Object.values(e.threshold))))}get hasThresholds(){return this.data.effects.some((e=>void 0!==e.threshold))}get helpers(){return this.owner.extraPresenceAvailableForTargeting}get isBlessed(){return this.blessed}get isCardWithDamageAndDestroy(){return this.isA(ye.AnyCard)&&(!!this.data.hasDamageInstructions||!!this.data.hasDestroyInstructions)}get isFast(){return this.status===Kn.PlayedFast||this.status===Kn.ResolvedFast}get isImpending(){return this.status===Kn.Impending}get isInDiscard(){return this.status===Kn.Discarded}get isInHand(){return this.status===Kn.InHand}get isInPlay(){return[Kn.PlayedFast,Kn.PlayedSlow,Kn.ResolvedFast,Kn.ResolvedSlow].includes(this.status)}get isLowestCostOfPlayedCards(){return!this.owner.powers.filter((e=>e.isInPlay&&e.isA(ye.AnyCard)&&!e.assisted)).some((e=>e.costToPlay<this.costToPlay))}get isPlayable(){return this.isInHand&&(this.costToPlay<=this.owner.energy||this.owner.canPlayCardsWithoutCost)&&this.data.type!==o.Innate}get isResolved(){return this.status===Kn.ResolvedFast||this.status===Kn.ResolvedSlow}get isSlow(){return this.status===Kn.PlayedSlow||this.status===Kn.ResolvedSlow}get mayChangeSpeed(){return!this.$.someEffect(r.PreventChangeSpeedOfPower,{power:this})&&this.$.someEffect(r.MayChangeSpeedOfPower,{power:this})||void 0!==bd[this.power].mayBeSpeed&&bd[this.power].mayBeSpeed.condition({speed:this.isFast?d.Slow:d.Fast,spirit:this.owner})}get mayIgnoreRangeWhenTargetingLand(){return(e,a)=>this.$.someEffect(r.MayIgnoreRangeWhenTargetingLand,{power:this,land:e,afterTargeting:a})}get owner(){const e=this.$.spirits.find((e=>e.powers.includes(this)));return void 0!==e?e:this.$.spirits.find((e=>e.hasPower(this.power)))}get ownerHasEnoughElementsToCastPower(){if(!this.hasThresholds)return!0;let e;for(const a of this.data.effects)if(a.threshold&&!a.dontResolveAlone&&(void 0===e&&(e=this.$.landElements),this.owner.hasElementsWithConvert(a.threshold,this.data.target===c.Land?e:void 0)))return!0;return!1}get powerLink(){return this.data.type===o.Innate?this.data.name:`<p>${this.power}</p>`}get serialized(){return this.power}get sourceFilter(){return this.targetingLandFilter(this.data.sourceFilter??[],this.owner,this.helpers)}get targetingLandFilter(){return(e,a,t)=>n=>0===e.length||e.some((e=>Yn[e]({land:n,$:this.$,owner:a,helpers:t})))}get validOriginSites(){return this.assisted?this.$.inLands():An.createCollection(this.$,this.availablePresenceForTargeting.map((e=>e.location)).filter((e=>this.sourceFilter(e))))}get validTargetSites(){return this.$.inTargetableLandsWhere((e=>this.targetingLandFilter(this.data.targetFilter??[],this.owner,this.helpers)(e)||this.$.someEffect(r.MayIgnoreTargetFilterWhenTargetingLand,{power:this})))}static createCollection(e,a){return new cn(e,tn.SelectPower,a)}async bless(){this.blessed=!0,await this.setStatus(this.data.speed===d.Fast?Kn.PlayedFast:Kn.PlayedSlow)}async changeSpeedIfNeeded(e){if((this.status===Kn.PlayedSlow||this.status===Kn.ResolvedSlow)&&e===d.Fast||(this.status===Kn.PlayedFast||this.status===Kn.ResolvedFast)&&e===d.Slow){const a=this.owner,t=[];bd[this.power].mayBeSpeed?.condition({speed:e,spirit:this.owner})&&t.push({...bd[this.power].mayBeSpeed.effect,actionId:`ChangeSpeed${t.length}`,name:bd[this.power].name,card:this.power,highlightPowers:[this],players:[a],spirit:a});for(const a of this.$.effectsOfType(r.MayChangeSpeedOfPower).filter((e=>e[r.MayChangeSpeedOfPower]?.({power:this}))))t.push({actionId:`ChangeSpeed${t.length}`,text:a.text,[r.Now]:async()=>{await this.$.doEffect(a,r.ChangeSpeedOfPower,{power:this}),await this.$.doEffects(r.AfterChangingSpeed,{effect:a,power:this,speed:e})}});await this.$.doPowerAction(this.owner,(async()=>{await this.$.chooseBetween({name:`Change speed of ${bd[this.power].name}`,text:"There are multiple ways to change speed of this power.",autoPlayOneOption:!0,effects:t})}),this)}}async discard(){this.assisted?await this.owner.forgetPowerState(this,{canRegain:!1,silent:!0}):(await this.setStatus(Kn.Discarded),await this.$.sendEvent({type:T.PowerCardDiscarded,powerType:this.power}),await this.didLeavePlay())}async forget(e={}){const a=await(this.owner?.forgetPowerState(this,e))??null;return a&&await a.didLeavePlay(),a}async fulfillsThreshold(e,a,t){return!(t===c.Land&&void 0!==e.targetLandThresholdCondition&&!e.targetLandThresholdCondition(a))&&(!(void 0!==e.powerOwnerThresholdCondition&&!e.powerOwnerThresholdCondition(this.owner))&&(void 0===e.threshold||!e.noConvertToThreshold&&!this.owner.didNotWantToReachThreshold.some((a=>{return t=a,n=e.threshold,!Object.keys(t).some((e=>void 0===n[e]||t[e]>n[e]));var t,n}))&&!!await this.owner.askToConvertElements(e.threshold,{optionalThreshold:!1})))}isA(e){return zn[e].cardTypes.includes(this.data.type)}landsWhichCanBeShiftedIntoToEnableTarget(e){const{targetLocation:a,range:t}=e;let n=t;return null!==n&&void 0!==this.data.modifiesRangePerLand&&(n+=this.data.modifiesRangePerLand.condition({$:this.$,spirit:this.owner,land:a})?this.data.range:0),a.inThisAndAdjacentLands().where((e=>!this.validOriginSites.has(e)&&(e.hasOnePieceWhere((e=>this.availablePresenceForTargeting.includes(e)))&&(null===n||e.landsWithin(n,this.owner,{targetingLands:!0}).includes(a))&&this.validTargetSites.has(a)&&(this.data.sourceFilter?.includes(l.SacredSite)&&e.hasPresenceOf(this.owner,this.helpers)||!this.data.sourceFilter?.includes(l.SacredSite)&&!e.hasPresenceOf(this.owner,this.helpers)&&this.sourceFilter(e)))))}async makeFast(){this.status===Kn.PlayedSlow?await this.setStatus(Kn.PlayedFast):this.status===Kn.ResolvedSlow&&await this.setStatus(Kn.ResolvedFast)}async makeSlow(){this.status===Kn.PlayedFast?await this.setStatus(Kn.PlayedSlow):this.status===Kn.ResolvedFast&&await this.setStatus(Kn.ResolvedSlow)}async maximizedThresholdsForPower(e,a){const t=[];this.owner&&(this.owner.didNotWantToReachThreshold=[]);for(const n of this.data.effects)if(await this.fulfillsThreshold(n,a,e)){if(n.instead){const e=this.data.effects.indexOf(n)-1,a=this.data.effects[e];t.includes(a)&&ae(t,a)}t.push(n)}else n.instead||t.push(n);return t}async payForPlay(e={}){const{payHalfRoundUp:a}=e;this.costToPlay>0?await this.owner.payEnergy(a?Math.ceil(this.costToPlay/2):this.costToPlay):this.costToPlay<0&&await this.owner.gainEnergy(-this.costToPlay)}async pickValidOriginTarget(){const e=this.validOriginSites;!this.assisted&&this.owner.mayShift&&void 0!==this.data.sourceFilter&&this.data.sourceFilter.includes(l.SacredSite)&&e.addAll(this.$.inLandsWhere((a=>!e.has(a)&&a.inThisAndAdjacentLands().sum((e=>e.numberOfPresenceOf(this.owner,this.helpers)))>=2)).items);let a=null;return await e.autoPickOne((async e=>{a=e,await this.$.doEffects(r.AfterTargetingSource,{power:this,land:e})}),{text:"Pick origin.",noOptions:"No valid source lands."}),a}async play(e={}){if(this.isInPlay)return;const{payHalfRoundUp:a=!1,withoutPaying:t=!1,withoutUsingCardPlays:n=!1,withoutImpending:i=!1}=e;this.data.type===o.Innate||this.blessed||this.assisted||n||(this.owner.cardsPlayedThisTurn.push(this),this.isCardWithDamageAndDestroy||(this.owner.usedCardPlaysForNonDamageAndDestroy+=this.owner.cardPlaysCostToPlayPowerCard));const{data:s,owner:d}=this;i||!await this.$.oneEffectActivates(r.AdjustPlayPower,{power:this})?(this.data.type!==o.Innate&&await this.$.sendEvent({type:T.PowerCardPlayed,spirit:d,power:this}),await this.setPlayed(),s.type===o.Innate||this.blessed||t||0===this.costToPlay||await this.payForPlay({payHalfRoundUp:a})):this.owner.cardsMadeImpendingThisTurn.push(this.power)}possibleToRepeatAtSpeed(e){return this.status===Kn.ResolvedFast&&e===d.Fast||this.status===Kn.ResolvedSlow&&e===d.Slow||this.status===Kn.ResolvedFast&&e===d.Slow&&this.mayChangeSpeed}range(e,a){const t=this.data.ranges,n=this.data.range;if(!t&&void 0===n)return null;const r=this.data.modifiesRange?.({spirit:this.owner,withConvert:!a})??0;return t?t[e]+r:n+r}async reclaim(){await this.setStatus(Kn.InHand),await this.$.sendEvent({type:T.PowerCardReclaimed,spirit:this.owner,power:this}),await this.didLeavePlay(),this.$.spiritPhase&&(this.owner.hasReclaimedACardDuringSpiritPhase=!0)}async repeat(){await this.$.addEffectUntilEndOfActionTree({[r.ActionEnds]:async()=>{void 0!==this.owner&&await this.owner.targetAndResolvePower(this,!0)}})}async repeatInLocations(e,a=!0){const t=this.owner;void 0!==t&&(a?await this.$.addEffectUntilEndOfActionTree({[r.ActionEnds]:async()=>{await t.doPowerAction((async()=>{this.data.type===o.Innate&&await t.possiblyDowngradeElements(this),await t.resolvePowerInLocations(this,e,!0)}),this)}}):await t.doPowerAction((async()=>{this.data.type===o.Innate&&await t.possiblyDowngradeElements(this),await t.resolvePowerInLocations(this,e,!0)}),this))}async replay(e){await this.changeSpeedIfNeeded(e),await this.setStatus(this.status===Kn.ResolvedFast?Kn.PlayedFast:Kn.PlayedSlow)}async setImpending(e){this.impendingEnergy=e,await this.setStatus(Kn.Impending)}async setPlayed(){await this.$.oneEffectActivates(r.AdjustPowerSpeedOnPlay,{power:this})||await this.setStatus(this.data.speed===d.Fast?Kn.PlayedFast:Kn.PlayedSlow)}async setResolved(){await this.setStatus(this.data.speed===d.Fast?Kn.ResolvedFast:Kn.ResolvedSlow)}setStatus(e){return this.status=e,this.owner?.invalidatePowerElementCache(),Promise.resolve()}async timePasses(){this.blessed?await this.setPlayed():this.isInPlay&&(this.data.type===o.Innate?await this.setStatus(Kn.InHand):await this.discard())}toString(){return`${_e[this.power]} [${Kn[this.status]}]`}validLandTargets(e={}){const{ignorePowerModifiesRange:a=!1,origin:t,targetIndex:n=0,mustTargetAdjacent:r=!1}=e,i=this.validLandTargetsWithoutShift({ignorePowerModifiesRange:a,source:t,targetIndex:n,mustTargetAdjacent:r});if(this.owner.mayShift&&void 0===t){const e=this.$.inLandsWhere((e=>{if(i.has(e))return!1;return!this.landsWhichCanBeShiftedIntoToEnableTarget({targetLocation:e,range:this.range(n,a)}).isEmpty}));i.addAll(e.items)}return i}validLandTargetsWithoutShift(e={}){const{ignorePowerModifiesRange:a=!1,source:t,targetIndex:n=0,mustTargetAdjacent:r=!1}=e,i=new Set;if(this.assisted)return this.$.inLandsWhere((e=>!e.targetingIsPrevented));const s=this.validTargetSites,o=this.range(n,a),d=this.validOriginSites;for(const e of d.items)if(void 0===t||t===e){let a;if(a=r?e.adjacentLands:null===o?this.$.lands:e.landsWithin(o,this.owner,{targetingLands:!0}),a.forEach((e=>{i.add(e)})),void 0!==this.data.modifiesRangePerLand&&null!==o){const a=this.data.modifiesRangePerLand.range;e.landsWithin(o+a,this.owner,{targetingLands:!0}).filter((e=>this.data.modifiesRangePerLand.condition({$:this.$,spirit:this.owner,land:e}))).forEach((e=>{i.add(e)}))}}return this.$.inTargetableLandsWhere((e=>this.mayIgnoreRangeWhenTargetingLand(e,!1))).items.forEach((e=>{i.add(e)})),s.copy().where((e=>i.has(e)&&!e.targetingIsPrevented))}validOriginsGivenTargetLand(e){const a=new Set,t=this.owner,n=t.extraPresenceAvailableForTargeting,r=this.mayIgnoreRangeWhenTargetingLand(e,!0),i=this.data.modifiesRange?.({spirit:t,withConvert:!0})??0;return W([...t.lands,...n.map((e=>e.location))]).filter(this.targetingLandFilter(this.data.sourceFilter??[],t,n)).filter((a=>r||a.landsWithin(this.data.range+i,t,{targetingLands:!0}).some((a=>a===e)))).forEach((e=>{a.add(e)})),An.createCollection(this.$,Array.from(a))}validSpiritTargets(){return this.$.spiritsWhich(this.targetingSpiritFilter(this.data.targetFilter??[],this.owner))}get targetingSpiritFilter(){return(e,a)=>t=>{if(e.length>0&&!e.some((e=>Qn[e]({$:this.$,spirit:t,owner:a}))))return!1;if(this.$.config.archipelagos){const e=a.boardDistanceToSpirit(t);if(null===e||a.energy<e)return!1}return!0}}didLeavePlay(){return this.$.doEffects(r.AfterPowerLeavesPlay,{power:this})}}_n([C.sH],Zn.prototype,"assisted",void 0),_n([C.sH],Zn.prototype,"impendingEnergy",void 0),_n([C.sH],Zn.prototype,"status",void 0),_n([C.sH],Zn.prototype,"blessed",void 0);const er={name:"Earth Moves With Vigor And Might",type:o.Innate,speed:d.Fast,set:s.FeatherAndFlame,target:c.Spirit,targetFilter:[m.Yourself],effects:[{text:"You may play an additional Power Card by paying 1 Energy plus its cost. (It's elements apply for the rest of this Innate Power's thresholds.)",[r.TargetSpirit]:async({$:e,you:a})=>{const t=Zn.createCollection(e,a.powers.filter((e=>e.isInHand&&e.costToPlay+1<=e.owner.energy&&e.data.type!==o.Innate)));t.count>0&&await e.may({prompt:"Play an additional Power Card by paying 1 Energy plus its cost?"})&&await t.pickOne((async e=>{await e.play({withoutUsingCardPlays:!0}),await a.payEnergy(1)}))},threshold:{[i.Plant]:1}},{text:"You do +1 Damage with each Damage-dealing Power you use this turn.",[r.TargetSpirit]:async({spirit:e,you:a})=>{await e.gainDamageBoost({amount:1,source:a})},threshold:{[i.Sun]:1,[i.Earth]:2}},{text:"You do +1 Damage with each Damage-dealing Power you use this turn.",[r.TargetSpirit]:async({spirit:e,you:a})=>{await e.gainDamageBoost({amount:1,source:a})},threshold:{[i.Plant]:2,[i.Earth]:3}},{text:"Gain a Power Card.",[r.TargetSpirit]:async({you:e})=>{await e.gainPowerCard()},threshold:{[i.Sun]:1,[i.Plant]:3}}]},ar=async({$:e,maxCost:a,you:t,spirit:n})=>{let i=1;await e.addSubEffectUntilEndOfTurn({[r.GlobalReminder]:()=>({icon:"Gift Of<br>Strength",spirit:t,players:[n]}),[r.MayRepeatPowercard]:({power:e,speed:t})=>i>0&&e.owner===n&&(e.costToPlay||0)<=a&&e.data.type!==o.Innate&&e.possibleToRepeatAtSpeed(t),[r.RepeatPowerCard]:async({power:e,speed:a})=>{i-=1,await e.replay(a)}})},tr={name:"Gift Of Strength",type:o.Innate,speed:d.Fast,set:s.Base,target:c.Spirit,effects:[{text:"Once this turn, Target Spirit may Repeat 1 Power Card with Energy cost of 1 or less.",[r.TargetSpirit]:async({$:e,spirit:a,you:t})=>{await ar({$:e,you:t,spirit:a,maxCost:1})},threshold:{[i.Sun]:1,[i.Earth]:2,[i.Plant]:2}},{instead:!0,text:"Instead, the Energy cost limit is 3 or less.",[r.TargetSpirit]:async({$:e,spirit:a,you:t})=>{await ar({$:e,you:t,spirit:a,maxCost:3})},threshold:{[i.Sun]:2,[i.Earth]:3,[i.Plant]:2}},{instead:!0,text:"Instead, the Energy cost limit is 6 or less.",[r.TargetSpirit]:async({$:e,spirit:a,you:t})=>(await ar({$:e,you:t,spirit:a,maxCost:6}),Promise.resolve()),threshold:{[i.Sun]:2,[i.Earth]:4,[i.Plant]:3}}]},nr={name:"Guard The Healing Land",type:o.Unique,speed:d.Fast,energy:3,elements:[i.Water,i.Earth,i.Plant],set:s.Base,target:c.Land,sourceFilter:[l.SacredSite],range:1,blightWhiteListedPower:!0,effects:[{textArea:[.722,.762],text:"Remove 1 <blight>.",[r.InTargetLand]:async({land:e})=>{await e.removeBlight()}},{textArea:[.768,.808],text:"Defend 4.",[r.InTargetLand]:async({land:e})=>{e.isLand&&await e.defend(4)}}]},rr={name:"Imbue With Nourishing Vitality",type:o.Innate,speed:d.Fast,set:s.NatureIncarnate,target:c.Land,hasPushOrGather:!0,range:1,sourceFilter:[l.SacredSite],targetFilter:[l.NonBlight],effects:[{textArea:[.568,.645],text:"Gather up to 1 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(1,e.Dahan)},threshold:{[i.Water]:1,[i.Plant]:1}},{textArea:[.668,.745],text:"Add 1 <vitality>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Vitality)},threshold:{[i.Water]:1,[i.Plant]:2}},{textArea:[.747,.889],text:"Each <dahan> has +2 Health while in target land. If target land has at least 2 <dahan>, Add 1 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await e.addSubEffectUntilEndOfTurn({[r.Reminder]:e=>e===a?"Each <dahan> has +2 Health while in target land.":void 0,[r.AdjustHealth]:({piece:t})=>t.location===a&&t.isA(e.Dahan)?2:0}),a.hasAtLeast(2,e.Dahan)&&await a.add(1,e.Dahan)},threshold:{[i.Water]:1,[i.Earth]:1,[i.Plant]:2}}]},ir={name:"Rituals Of Destruction",type:o.Unique,speed:d.Slow,energy:3,elements:[i.Sun,i.Moon,i.Fire,i.Earth,i.Plant],set:s.Base,target:c.Land,sourceFilter:[l.SacredSite],targetFilter:[l.Dahan],range:1,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.68,.72],text:"2 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(2)}},{textArea:[.761,.855],text:"If target land has at least 3 <dahan>, +3 Damage and 2 <fear>.",[r.InTargetLand]:async({$:e,land:a})=>{a.hasAtLeast(3,e.Dahan)&&(await a.damage(3),await a.fear(2))}}]},sr={name:"All-Enveloping Green",type:o.Innate,speed:d.Fast,set:s.Base,target:c.Land,sourceFilter:[l.SacredSite],range:1,blightWhiteListedPower:!0,effects:[{text:"Defend 2.",[r.InTargetLand]:async({land:e})=>{e.isLand&&await e.defend(2)},threshold:{[i.Water]:1,[i.Plant]:3}},{instead:!0,text:"Instead, Defend 4.",[r.InTargetLand]:async({land:e})=>{e.isLand&&await e.defend(4)},threshold:{[i.Water]:2,[i.Plant]:4}},{text:"Also, remove 1 <blight>.",[r.InTargetLand]:async({land:e})=>{await e.removeBlight()},threshold:{[i.Water]:3,[i.Earth]:1,[i.Plant]:5}}]},or={name:"Belligerent And Aggressive Crops",type:o.Unique,speed:d.Slow,energy:1,elements:[i.Sun,i.Fire,i.Plant],set:s.NatureIncarnate,target:c.Land,range:2,sourceFilter:[l.SacredSite],targetFilter:[l.TownOrCity],generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.694,.735],text:"Add 1 <wilds>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Wilds)}},{textArea:[.758,.799],text:"1 Damage, to <town>/<city> only.",[r.InTargetLand]:async({$:e,land:a})=>{await a.damage(1,e.TownOrCity)}},{textArea:[.817,.913],text:"If there are any adjacent <wilds>:<br>1 <fear>. 1 Damage, to <town>/<city> only.",[r.InTargetLand]:async({$:e,land:a})=>{a.hasAdjacentLandWithPiece(e.Wilds)&&(await a.fear(1),await a.damage(1,e.TownOrCity))}}]},dr={name:"Creepers Tear Into Mortar",type:o.Innate,speed:d.Slow,set:s.Base,target:c.Land,range:0,hasDamageInstructions:!0,effects:[{text:"1 Damage to 1 <town>/<city>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.damage(1,e.TownOrCity,{maxTargets:1})},threshold:{[i.Moon]:1,[i.Plant]:2}},{text:"Repeat this Power.",[r.InTargetLand]:async({power:e,isRepeat:a})=>{a||await e.repeat()},threshold:{[i.Moon]:2,[i.Plant]:3}},{text:"Repeat this Power again.",[r.InTargetLand]:async({power:e,isRepeat:a})=>{a||await e.repeat()},threshold:{[i.Moon]:3,[i.Plant]:4}}]},cr={name:"Fields Choked With Growth",type:o.Unique,speed:d.Slow,energy:0,elements:[i.Sun,i.Water,i.Plant],set:s.Base,target:c.Land,range:1,hasPushOrGather:!0,effects:[{textArea:[.696,.837],text:"Push 1 <town>.<or>Push 3 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"PushTown",textArea:[.703,.743],text:"Push 1 <town>.",[r.Now]:async()=>{await a.pushOne(e.Town)}},{actionId:"PushDahan",textArea:[.789,.829],text:"Push 3 <dahan>.",[r.Now]:async()=>{await a.push({amount:3,pieces:e.Dahan})}}]})}}]},lr={name:"Gift Of Proliferation",type:o.Unique,speed:d.Fast,energy:1,elements:[i.Moon,i.Plant],set:s.Base,target:c.Spirit,targetFilter:[m.Another],effects:[{textArea:[.72,.817],text:"Target Spirit adds 1 <presence> up to <range-1> from their <presence>.",[r.TargetSpirit]:async({spirit:e})=>{await e.addPresenceInRange(1)}}]},hr={name:"Impenetrable Tangles Of Greenery",type:o.Innate,speed:d.Fast,set:s.NatureIncarnate,target:c.Land,hasPushOrGather:!0,range:0,effects:[{textArea:[.51,.563],text:"Add 1 <wilds>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Wilds)},threshold:{[i.Sun]:1,[i.Plant]:2}},{textArea:[.626,.679],text:"Push 1 <explorer>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushOne(e.Explorer)},threshold:{[i.Sun]:2,[i.Plant]:3}},{textArea:[.739,.792],text:"Isolate target land.",[r.InTargetLand]:async({land:e})=>{await e.isolate()},threshold:{[i.Sun]:2,[i.Plant]:4}},{textArea:[.859,.912],text:"Downgrade 1 <city>. Add 1 <wilds>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.downgrade({pieces:e.City}),await a.add(1,e.Wilds)},threshold:{[i.Sun]:3,[i.Plant]:5}}]},gr={name:"Overgrow In A Night",type:o.Unique,speed:d.Fast,energy:2,elements:[i.Moon,i.Plant],set:s.Base,target:c.Land,range:1,effects:[{textArea:[.676,.857],text:"Add 1 <presence>.<or>If target land has your <presence> and Invaders, 3 <fear>.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await e.chooseBetween({effects:[{actionId:"AddPresence",textArea:[.679,.719],text:"Add 1 <presence>.",[r.Now]:async()=>{await t.addPresence(a)}},{actionId:"Fear",textArea:[.762,.854],text:"If target land has your <presence> and Invaders, 3 <fear>.",[r.Now]:async()=>{await t.fear(3)},condition:()=>t.hasPresenceOf(a)&&t.hasInvaders}]})}}]},fr={name:"Stem The Flow Of Fresh Water",type:o.Unique,speed:d.Slow,energy:0,elements:[i.Water,i.Plant],set:s.Base,target:c.Land,sourceFilter:[l.SacredSite],range:1,hasDamageInstructions:!0,effects:[{textArea:[.65,.851],text:"1 Damage to 1 <town>/<city>.<br><br>If target land is <mountains-sands>, instead, 1 Damage to each <town>/<city>.",[r.InTargetLand]:async({$:e,land:a})=>{a.isMountainsOrSands?await e.addSubEffect({textArea:[.739,.855],text:"1 Damage to each <town>/<city>.",[r.Now]:async()=>{await a.damageEach(1,e.TownOrCity)}}):await e.addSubEffect({textArea:[.661,.701],text:"1 Damage to 1 <town>/<city>.",[r.Now]:async()=>{await a.damage(1,e.TownOrCity,{maxTargets:1})}})}}]},ur={name:"Unbelievable Regrowth",type:o.Innate,speed:d.Slow,set:s.NatureIncarnate,target:c.Land,range:1,targetFilter:[l.JunglesOrWetlands],effects:[{textArea:[.514,.567],text:"This Power may target any terrain.",[r.InTargetLand]:async({you:e,land:a})=>{a.isJungleOrWetlands||await e.convertElements({[i.Water]:2,[i.Plant]:3})}},{text:"This Power may target any terrain.",[r.InTargetLand]:()=>Promise.resolve(),threshold:{[i.Water]:2,[i.Plant]:3},noConvertToThreshold:!0,dontResolveAlone:!0},{textArea:[.626,.679],text:"Add 1 <broken>.",[r.InTargetLand]:async({you:e,land:a})=>{await a.addPresence(e,{destroyed:!0})},threshold:{[i.Water]:1,[i.Plant]:3}},{textArea:[.739,.792],text:"Add 1 <broken>.",[r.InTargetLand]:async({you:e,land:a})=>{await a.addPresence(e,{destroyed:!0})},threshold:{[i.Water]:2,[i.Plant]:4}},{textArea:[.863,.916],text:"Add 1 <broken> to an adjacent land.",[r.InTargetLand]:async({you:e,land:a})=>{await a.inAdjacentLands().pickOne((async a=>{await a.addPresence(e,{destroyed:!0})}))},threshold:{[i.Water]:3,[i.Plant]:5}}]},pr={name:"Exaltation Of The Storm-Wind",type:o.Innate,speed:d.Fast,set:s.JaggedEarth,target:c.Spirit,targetFilter:[m.Another],hasPushOrGather:!0,effects:[{textArea:[.389,.513],text:"You and target Spirit may each make one of your non-Major <slow> Powers <fast>.",[r.TargetSpirit]:async({$:e,...a})=>{await e.clickToContinue();for(const e of[a.spirit,a.you])await e.gainMakeFastBuff({filter:e=>e.data.type!==o.Major})},threshold:{[i.Air]:1}},{textArea:[.526,.651],text:"You and target Spirit each gain <range+1> with all your Powers this turn.",[r.TargetSpirit]:async({$:e,you:a,spirit:t})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({[r.GlobalReminder]:()=>({icon:"<range+1>",spirit:a,players:[t,a]}),[r.ExtraRange]:e=>(e.spirit===t?1:0)+(e.spirit===a?1:0)})},threshold:{[i.Air]:3}},{textArea:[.661,.796],text:"You and target Spirit may each Push up to 2 <explorer> from one of your lands.",[r.TargetSpirit]:async({$:e,you:a,spirit:t})=>{for(const n of[a,t])await n.inLandsWith(e.Explorer).optionallyPickOne((async a=>{await a.pushUpTo(2,e.Explorer)}),{players:[n],noOptions:`No <explorer> in lands of ${n.nameLink}.`})},threshold:{[i.Air]:4,[i.Water]:1}},{textArea:[.81,.887],text:"Repeat this Power.",[r.TargetSpirit]:async({power:e,isRepeat:a})=>{a||await e.repeat()},threshold:{[i.Air]:5,[i.Water]:2}}]},wr={name:"Gift Of The Sparking Sky",type:o.Innate,speed:d.Fast,set:s.NatureIncarnate,target:c.Spirit,hasDamageInstructions:!0,effects:[{text:"Once this turn, after target Spirit uses a Power that targets a land, they may do 1 Damage to each Invader in that land. (This is their Action and get all benefits and penalties that apply to their Powers.).",textArea:[.259,.505],[r.TargetSpirit]:async({$:e,spirit:a,...t})=>{const n=C.sH.box(!1),i={triggerId:e.nextTriggerId(),[r.Now]:async({action:r})=>{const i=r.parentData.targetLands.filter((e=>e.exists));i.length>0&&await e.may({highlightLocations:i,prompt:`Do 1 Damage to each Invader in ${1===i.length?"this land":"in one of these lands"}?`})&&(n.set(!0),await An.createCollection(e,r.parentData.targetLands).pickOne((async e=>{await a.doPowerAction((async()=>{await e.damageEach(1)}),t.power)}),{autoPlayOneOption:!0}))}};await e.addSubEffectUntilEndOfTurn({[r.GlobalReminder]:()=>({icon:`+1<damage><br>${n.get()?"1":"0"} / 1`,players:[a]}),[r.AfterTargetingLands]:async r=>{r.power.owner!==a||n.get()||(e.action.data.targetLands=r.lands,await e.addTrigger(i,t.effect,t.action))}})},threshold:{[i.Sun]:2,[i.Fire]:5,[i.Air]:3}},{textArea:[.545,.599],text:"Target Spirit gains a Minor Power.",[r.TargetSpirit]:async({spirit:e})=>{await e.gainPowerCard({powerType:o.Minor})},threshold:{[i.Fire]:2,[i.Air]:2}},{textArea:[.63,.835],text:"Target Spirit may play a Power Card by paying its cost. (If you target yourself, its Elements arrive too late to apply to prior thresholds of this Power.).",[r.TargetSpirit]:async({spirit:e})=>{await e.playAPowerCardByPayingItsCost()},threshold:{[i.Sun]:1,[i.Fire]:3,[i.Air]:2}}]},yr={name:"Harbingers of the Lightning",type:o.Unique,speed:d.Slow,energy:0,elements:[i.Fire,i.Air],set:s.Base,target:c.Land,range:1,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.669,.86],text:"Push up to 2 <dahan>.<br><br>1 <fear> if you pushed any <dahan> into a land with <town>/<city>.",[r.InTargetLand]:async({$:e,land:a})=>{(await a.pushUpTo(2,e.Dahan)).some((({destination:a})=>a.has(e.TownOrCity)))&&await a.fear(1)}}]},mr={name:"Lightnings Boon",type:o.Unique,speed:d.Fast,energy:1,elements:[i.Fire,i.Air],set:s.Base,target:c.Spirit,effects:[{textArea:[.709,.847],text:"Target Spirit may use up to 2 <slow> Powers as if they were <fast> Powers this turn.",[r.TargetSpirit]:async({spirit:e})=>{await e.gainMakeFastBuff({amount:2})}}]},vr={name:"Lightning-Torn Skies Incite Pandemonium",type:o.Innate,speed:d.Slow,set:s.JaggedEarth,target:c.Land,sourceFilter:[l.SacredSite],targetFilter:[l.Invaders],range:1,generatesFear:!0,effects:[{textArea:[.413,.49],effects:[{text:"2 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(2)}},{text:"Add 1 <strife>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Strife)}}],threshold:{[i.Fire]:3,[i.Air]:2}},{textArea:[.496,.573],effects:[{text:"2 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(2)}},{text:"Add 1 <strife>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Strife)}}],threshold:{[i.Fire]:4,[i.Air]:3}},{textArea:[.6,.677],effects:[{text:"3 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(3)}},{text:"Add 1 <strife>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Strife)}}],threshold:{[i.Fire]:5,[i.Air]:4,[i.Moon]:1}},{textArea:[.699,.776],effects:[{text:"4 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(4)}},{text:"Add 1 <strife>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Strife)}}],threshold:{[i.Fire]:5,[i.Air]:5,[i.Moon]:2}}]},Ir={name:"Raging Storm",type:o.Unique,speed:d.Slow,energy:3,elements:[i.Fire,i.Air,i.Water],set:s.Base,target:c.Land,range:1,hasDamageInstructions:!0,effects:[{textArea:[.755,.795],text:"1 Damage to each Invader.",[r.InTargetLand]:async({land:e})=>{await e.damageEach(1)}}]},Ar={name:"Shatter Homesteads",type:o.Unique,speed:d.Slow,energy:2,elements:[i.Fire,i.Air],set:s.Base,sourceFilter:[l.SacredSite],target:c.Land,range:2,generatesFear:!0,hasDestroyInstructions:!0,effects:[{textArea:[.722,.762],text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.766,.806],text:"Destroy 1 <town>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.destroyOne(e.Town)}}]},xr={name:"Smite The Land With Fulmination",type:o.Unique,speed:d.Slow,energy:2,elements:[i.Sun,i.Fire,i.Air],set:s.NatureIncarnate,target:c.Land,range:1,hasDamageInstructions:!0,effects:[{textArea:[.739,.78],text:"1 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(1)}},{textArea:[.803,.844],text:"Add 1 <badlands>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Badlands)}}]},br={name:"Thundering Destruction",type:o.Innate,speed:d.Slow,set:s.Base,target:c.Land,sourceFilter:[l.SacredSite],range:1,hasDestroyInstructions:!0,effects:[{text:"Destroy 1 <town>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.destroyOne(e.Town)},threshold:{[i.Fire]:3,[i.Air]:2}},{instead:!0,text:"Destroy 1 <town>/<city>.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{let n=1;a.hasElements({[i.Fire]:5,[i.Air]:5,[i.Water]:2})?n=3:a.hasElements({[i.Fire]:5,[i.Air]:4,[i.Water]:1})&&(n=2),await e.addSubEffect({text:`Destroy ${n} <town>/<city>.`,[r.Now]:async()=>{await t.destroyUpTo(n,e.TownOrCity)}})},threshold:{[i.Fire]:4,[i.Air]:3}},{text:"Also, destroy 1 <town>/<city>.",threshold:{[i.Fire]:5,[i.Air]:4,[i.Water]:1}},{text:"Also, destroy 1 <town>/<city>.",threshold:{[i.Fire]:5,[i.Air]:5,[i.Water]:2}}]},Tr={name:"Call Of The Deeps",type:o.Unique,speed:d.Fast,energy:0,elements:[i.Moon,i.Air,i.Water],set:s.Base,target:c.Land,targetFilter:[l.Coastal],range:0,hasPushOrGather:!0,effects:[{textArea:[.679,.719],text:"Gather 1 <explorer>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherOne(e.Explorer)}},{textArea:[.766,.857],text:"If target land is the Ocean, you may Gather another <explorer>.",[r.InTargetLand]:async({$:e,land:a})=>{a.isOcean&&await a.mayGather(e.Explorer)}}]},Er={name:"Grasping Tide",type:o.Unique,speed:d.Fast,energy:1,elements:[i.Moon,i.Water],set:s.Base,target:c.Land,targetFilter:[l.Coastal],range:1,generatesFear:!0,effects:[{textArea:[.722,.762],text:"2 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.768,.808],text:"Defend 4.",[r.InTargetLand]:async({land:e})=>{await e.defend(4)}}]},Pr={name:"Ocean Breaks The Shore",type:o.Innate,speed:d.Slow,set:s.Base,target:c.Land,targetFilter:[l.Coastal],range:0,effects:[{text:"Drown 1 <town>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.drown({amount:1,pieces:e.Town})},threshold:{[i.Water]:2,[i.Earth]:1}},{instead:!0,text:"You may instead Drown 1 <city>.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{const n=a.hasElements({[i.Water]:4,[i.Earth]:3})?2:1;await e.addSubEffect({text:`Drown ${n} <city>.`,[r.Now]:async()=>{await t.drown({amount:n,pieces:e.TownOrCity})}})},threshold:{[i.Water]:3,[i.Earth]:2}},{text:"Also, Drown 1 <town>/<city>",threshold:{[i.Water]:4,[i.Earth]:3}}]},Sr={name:"Pound Ships To Splinters",type:o.Innate,speed:d.Fast,set:s.Base,target:c.Land,targetFilter:[l.Coastal],range:0,generatesFear:!0,effects:[{text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)},threshold:{[i.Moon]:1,[i.Air]:1,[i.Water]:2}},{text:"+1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)},threshold:{[i.Moon]:2,[i.Air]:1,[i.Water]:3}},{text:"+2 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(2)},threshold:{[i.Moon]:3,[i.Air]:2,[i.Water]:4}}]},Or={name:"Reclaimed By The Deeps",type:o.Innate,speed:d.Slow,set:s.NatureIncarnate,target:c.Land,range:1,targetFilter:[l.Deeps],hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{textArea:[.279,.341],text:"1 Damage per <deeps>, to <town>/<city> only.",[r.InTargetLand]:async({$:e,land:a})=>{await a.damage(a.numberOf(e.Deeps),e.TownOrCity)},threshold:{[i.Water]:2}},{text:"If at least 3 <deeps> and no <town>/<city> are present:<br>Drown all <explorer>/<dahan>.<br>Push all but 2 <deeps>.<br>Target land permanently becomes part of the Ocean on its board. Flip all remaining <deeps>; they are reminder markers for the expanded Ocean.",[r.InTargetLand]:async({$:e,land:a})=>{a.hasAtLeast(3,e.Deeps)&&a.doesntHave(e.TownOrCity)&&await e.addSubEffect({effects:[{textArea:[.381,.568],text:"If at least 3 <deeps> and no <town>/<city> are present:<br>Drown all <explorer>/<dahan>.",[r.Now]:async()=>{await a.drown({quantifier:w.All,pieces:e.ExplorerOrDahan})}},{textArea:[.5,.562],text:"Push all but 2 <deeps>.",[r.Now]:async()=>{await a.push({amount:a.numberOf(e.Deeps)-2,pieces:e.Deeps}),await a.remove({quantifier:w.All,pieces:e.Deeps,removement:A.Silent})}},{textArea:[.555,.797],text:"Target land permanently becomes part of the Ocean on its board. Flip all remaining <deeps>; they are reminder markers for the expanded Ocean.",[r.Now]:async()=>{if(!a.isOcean){const t=a.board.ocean,n=a.adjacentLocations.filter((e=>!t.isAdjacentTo(e)&&t!==e)).map((e=>({land1:t,land2:e})));await a.move({quantifier:w.All,pieces:e.AllPieces,movement:q.Relocate,locations:{target:g.ToThisLocation,location:t}}),a.exists=!1,await e.addSubEffect({[r.Flooded]:e=>e.location===a,[r.ExtraAdjacency]:()=>n}),e.setupAdjacencies()}}}]})},threshold:{[i.Water]:4,[i.Earth]:2}},{textArea:[.802,.929],text:"Repeat this Power in target land or in a land with your <presence>.",[r.InTargetLand]:async({land:e,you:a,isRepeat:t,power:n})=>{if(!t){const t=a.inLands();t.has(e)||t.add(e),await t.pickOne((async e=>{await n.repeatInLocations([e])}))}},threshold:{[i.Moon]:2,[i.Water]:3}}]},Cr={name:"Swallow The Land-Dwellers",type:o.Unique,speed:d.Slow,energy:0,elements:[i.Water,i.Earth],set:s.Base,target:c.Land,targetFilter:[l.Coastal],range:0,effects:[{textArea:[.756,.796],text:"Drown 1 <explorer>, 1 <town> and 1 <dahan>",[r.InTargetLand]:async({$:e,land:a})=>{await a.drown({pieces:e.Explorer}),await a.drown({pieces:e.Town}),await a.drown({pieces:e.Dahan})}}]},Dr={name:"Tidal Boon",type:o.Unique,speed:d.Slow,energy:1,elements:[i.Moon,i.Water,i.Earth],set:s.Base,target:c.Spirit,targetFilter:[m.Another],hasPushOrGather:!0,effects:[{textArea:[.615,.927],text:"Target Spirit gains 2 Energy and may Push 1 <town> and up to 2 <dahan> from one of their lands.<br><br>If <dahan> are pushed to your Ocean, you may move them to any Coastal land instead of Drowning them.",[r.TargetSpirit]:async({$:e,spirit:a,you:t})=>{await a.gainEnergy(2),await a.inLands().pickOne((async a=>{await a.mayPush(e.Town);const n=(await a.pushUpTo(2,e.Dahan)).filter((({destination:e})=>e.isOcean&&e.hasPresenceOf(t)));n.length>0&&await e.may({textArea:[.781,.926],text:"If <dahan> are pushed to your Ocean, you may move them to any Coastal land instead of Drowning them.",prompt:"Move the <dahan>?"})&&await e.inLandsWhere((e=>e.isCoastal)).pickOne((async e=>{for(const{piece:a}of n)await a.move({locations:{target:g.ToThisLocation,location:e}})}))}))}}]},Br={name:"Water Eats Away The Deep Roots Of Earth",type:o.Innate,speed:d.Slow,set:s.NatureIncarnate,target:c.Land,range:1,targetFilter:[l.Coastal],effects:[{textArea:[.296,.358],text:"Add 1 <deeps>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Deeps)},threshold:{[i.Water]:2}},{textArea:[.398,.529],text:"Add 1 <deeps> to a different Coastal land (on any board).",[r.InTargetLand]:async({$:e,land:a,action:t})=>{await e.inCoastalLands().where((e=>e!==a)).pickOne((async a=>{t.data.secondLand=a,await a.add(1,e.Deeps)}))},threshold:{[i.Water]:3}},{textArea:[.551,.755],text:"Add 1 <deeps> to a third Coastal land (on any board).",[r.InTargetLand]:async({$:e,land:a,action:t})=>{await e.inCoastalLands().where((e=>e!==a&&e!==t.data.secondLand)).pickOne((async a=>{t.data.secondLand=a,await a.add(1,e.Deeps)}))},threshold:{[i.Moon]:3,[i.Water]:4,[i.Earth]:3}}]},kr={name:"Boon Of Sunshines Promise",type:o.Innate,speed:d.Fast,set:s.Base,target:c.Spirit,targetFilter:[m.Another],effects:[{text:"Target Spirit gains Energy equal to 1 less than the highest uncovered number on your Energy track.",[r.TargetSpirit]:async({you:e,spirit:a})=>{await a.gainEnergy(Math.max(e.trackEnergy-1,0))},threshold:{[i.Sun]:2}},{text:"You also gain that much Energy.",[r.TargetSpirit]:async({you:e})=>{await e.gainEnergy(Math.max(e.trackEnergy-1,0))},threshold:{[i.Sun]:3,[i.Water]:3}},{text:"Target Spirit may remove 1 <blight> from any one of their lands with <dahan>.",[r.TargetSpirit]:async({$:e,spirit:a})=>{await a.inLandsWithAllOf(e.Dahan,e.Blight).optionallyPickOne((async e=>{await e.removeBlight()}),{noOptions:`${a.nameLink} has no lands with <blight> and <dahan>.`})},threshold:{[i.Sun]:4,[i.Water]:2}}]},Lr={name:"Boon Of Vigor",type:o.Unique,speed:d.Fast,energy:0,elements:[i.Sun,i.Water,i.Plant],set:s.Base,target:c.Spirit,effects:[{textArea:[.631,.904],text:"If you target yourself, gain 1 Energy.<br><br>If you target another Spirit, they gain 1 Energy per Power Card they played this turn.",[r.TargetSpirit]:async({you:e,spirit:a})=>{a===e?await e.gainEnergy(1):await a.gainEnergy(a.powerCardsInPlayNotBlessed.length)}}]},Fr={name:"Call To A Sunlit Haven",type:o.Innate,speed:d.Fast,set:s.NatureIncarnate,target:c.Land,hasPushOrGather:!0,range:0,sourceFilter:[l.SacredSite],effects:[{textArea:[.228,.356],text:"E is the highest uncovered number on your Energy track.",[r.InTargetLand]:({you:e,action:a})=>(a.data.energy=e.trackEnergy,Promise.resolve())},{textArea:[.378,.432],text:"Defend E.",[r.InTargetLand]:async({land:e,action:a})=>{await e.defend(a.data.energy)},threshold:{[i.Sun]:1,[i.Water]:1}},{textArea:[.458,.572],text:"In an adjacent land with your <presence>, Defend E.",[r.InTargetLand]:async({you:e,land:a,action:t})=>{await a.inAdjacentLandsWhere((a=>a.hasPresenceOf(e))).pickOne((async e=>{await e.defend(t.data.energy)}))},threshold:{[i.Sun]:1,[i.Water]:2,[i.Earth]:1}},{textArea:[.594,.766],text:"In target land or an adjacent land with your <presence>, Gather up to E <dahan>.",[r.InTargetLand]:async({$:e,land:a,you:t,action:n})=>{await a.inThisAndAdjacentLands().where((e=>e===a||e.hasPresenceOf(t))).pickOne((async a=>{await a.gatherUpTo(n.data.energy,e.Dahan)}))},threshold:{[i.Sun]:1,[i.Animal]:1}},{textArea:[.781,.898],text:"Remove up to E Health worth of Invaders.",[r.InTargetLand]:async({land:e,action:a})=>{await e.removeInvadersWorthOfHealthUpTo(a.data.energy)},threshold:{[i.Sun]:1,[i.Water]:1,[i.Plant]:2}}]},Rr={name:"Flash Floods",type:o.Unique,speed:d.Fast,energy:2,elements:[i.Sun,i.Water],set:s.Base,target:c.Land,range:1,hasDamageInstructions:!0,effects:[{textArea:[.679,.719],text:"1 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(1)}},{textArea:[.762,.854],text:"If target land is Coastal, +1 Damage.",[r.InTargetLand]:async({land:e})=>{e.isCoastal&&await e.damage(1)}}]},Nr={name:"Massive Flooding",type:o.Innate,speed:d.Slow,set:s.Base,target:c.Land,sourceFilter:[l.SacredSite],range:1,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{text:"Push 1 <explorer>/<town>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushOne(e.ExplorerOrTown)},threshold:{[i.Sun]:1,[i.Water]:2}},{instead:!0,text:"Instead, 2 Damage. Push up to 3 <explorer>/<town>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.damage(2),await a.pushUpTo(3,e.ExplorerOrTown)},threshold:{[i.Sun]:2,[i.Water]:3}},{instead:!0,text:"Instead, 2 Damage to each Invader.",[r.InTargetLand]:async({land:e})=>{await e.damageEach(2)},threshold:{[i.Sun]:3,[i.Water]:4,[i.Earth]:1}}]},$r={name:"River's Bounty",type:o.Unique,speed:d.Slow,energy:0,elements:[i.Sun,i.Water,i.Animal],set:s.Base,target:c.Land,range:0,hasPushOrGather:!0,effects:[{textArea:[.679,.719],text:"Gather up to 2 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(2,e.Dahan)}},{textArea:[.756,.854],text:"If there are now at least 2 <dahan>, add 1 <dahan> and gain 1 Energy.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{t.hasAtLeast(2,e.Dahan)&&(await t.add(1,e.Dahan),await a.gainEnergy(1))}}]},Wr={name:"Wash Away",type:o.Unique,speed:d.Slow,energy:1,elements:[i.Water,i.Earth],set:s.Base,target:c.Land,range:1,hasPushOrGather:!0,effects:[{textArea:[.75,.79],text:"Push up to 3 <explorer>/<town>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(3,e.ExplorerOrTown)}}]},Mr={name:"Concealing Shadows",type:o.Unique,speed:d.Fast,energy:0,elements:[i.Moon,i.Air],set:s.Base,target:c.Land,range:0,effects:[{textArea:[.71,.75],text:"1 fear.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.748,.84],text:"<dahan> take no Damage from Ravaging Invaders this turn.",[r.InTargetLand]:async({$:e,land:a,effect:t})=>{await e.addSubEffectUntilEndOfTurn({[r.Reminder]:e=>e===a?t.text:void 0,[r.PreventDamagingPiece]:({piece:t})=>Promise.resolve(t.isA(e.Dahan)&&t.location===a&&e.action.type===en.NormalInvaderAction)})}}]},Gr={name:"Crops Wither And Fade",type:o.Unique,speed:d.Slow,energy:1,elements:[i.Moon,i.Fire,i.Plant],set:s.Base,target:c.Land,range:0,effects:[{textArea:[.667,.707],text:"2 fear.",[r.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.745,.894],text:"Replace 1 <town> with 1 <explorer>.<or>Replace 1 <city> with 1 <town>.",[r.InTargetLand]:({$:e,land:a})=>e.chooseBetween({effects:[{actionId:"ReplaceTown",textArea:[.755,.795],text:"Replace 1 <town> with 1 <explorer>.",[r.Now]:async()=>{await a.replaceOne({pieces:e.Town,withPiece:p.Explorer})}},{actionId:"ReplaceCity",textArea:[.842,.882],text:"Replace 1 <city> with 1 <town>.",[r.Now]:async()=>{await a.replaceOne({pieces:e.City,withPiece:p.Town})}}]})}]},Hr={name:"Darkness Swallows The Unwary",type:o.Innate,speed:d.Fast,set:s.Base,target:c.Land,sourceFilter:[l.SacredSite],range:1,hasPushOrGather:!0,generatesFear:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{text:"Gather 1 <explorer>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherOne(e.Explorer)},threshold:{[i.Moon]:2,[i.Fire]:1}},{text:"Destroy up to 2 <explorer>. 1 <fear> per <explorer> destroyed.",[r.InTargetLand]:async({$:e,land:a})=>{if(a.has(e.Explorer)){const t=await a.destroyUpTo(2,e.Explorer);await a.fear(t.length)}},threshold:{[i.Moon]:3,[i.Fire]:2}},{text:"3 Damage. 1 <fear> per Invader destroyed by this Damage.",[r.InTargetLand]:async({$:e,land:a})=>{const t=await a.damage(3,e.Invader);await a.fear(t.length)},threshold:{[i.Moon]:4,[i.Fire]:3,[i.Air]:2}}]},Ur={name:"Enticing And Lulling Dreams",type:o.Innate,speed:d.Fast,set:s.NatureIncarnate,target:c.Land,range:1,hasPushOrGather:!0,effects:[{textArea:[.401,.517],text:"Each Invader/<dahan> does -1 Damage while in target land.",[r.InTargetLand]:async({$:e,land:a,effect:t})=>{await e.addSubEffectUntilEndOfTurn({[r.Reminder]:e=>e===a?t.text:void 0,[r.AdjustIndividualInvaderRavageDamage]:e=>e.piece.location===a&&e.piece.isInvader?-1:0})},threshold:{[i.Moon]:2,[i.Air]:1}},{textArea:[.551,.606],text:"Gather up to 1 <explorer>/<town>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(1,e.ExplorerOrTown)},threshold:{[i.Moon]:2,[i.Animal]:2}},{textArea:[.633,.808],text:"Each Invader/<dahan> does -1 Damage while in target land.",[r.InTargetLand]:async({$:e,land:a,effect:t})=>{await e.addSubEffectUntilEndOfTurn({[r.Reminder]:e=>e===a?t.text:void 0,[r.AdjustIndividualInvaderRavageDamage]:e=>e.piece.location===a&&e.piece.isInvader?-1:0})},threshold:{[i.Moon]:3,[i.Air]:2,[i.Animal]:1}},{textArea:[.845,.9],text:"Gather up to 4 <explorer>/<town>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(4,e.ExplorerOrTown)},threshold:{[i.Moon]:4,[i.Air]:3,[i.Animal]:2}}]},qr={name:"Favors Called Due",type:o.Unique,speed:d.Slow,energy:1,elements:[i.Moon,i.Air,i.Animal],set:s.Base,target:c.Land,range:1,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.68,.72],text:"Gather up to 4 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(4,e.Dahan)}},{textArea:[.756,.86],text:"If Invaders are present and <dahan> now outnumber them, 3 <fear>.",[r.InTargetLand]:async({$:e,land:a})=>{a.hasInvaders&&a.the(e.Dahan).outnumber(e.Invader)&&await a.fear(3)}}]},jr={name:"Mantle Of Dread",type:o.Unique,speed:d.Slow,energy:1,elements:[i.Moon,i.Fire,i.Air],set:s.Base,target:c.Spirit,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.71,.75],text:"2 <fear>.",[r.TargetSpirit]:async({$:e})=>{await e.fear(2)}},{textArea:[.745,.848],text:"Target Spirit may Push 1 <explorer> and <town> from a land where it has <presence>.",[r.TargetSpirit]:({$:e,spirit:a})=>a.inLands().optionallyPickOne((async a=>{await a.pushOne(e.Explorer),await a.pushOne(e.Town)}))}]},Jr={name:"Stretch Out Coils of Foreboding Dread",type:o.Innate,speed:d.Fast,set:s.FeatherAndFlame,target:c.Land,range:2,hasPushOrGather:!0,generatesFear:!0,effects:[{text:"Your other Powers may ignore Range when targeting the target land.",[r.InTargetLand]:async({$:e,you:a,land:t,effect:n})=>{await e.addSubEffectUntilEndOfTurn({[r.Reminder]:e=>e===t?n.text:void 0,[r.MayIgnoreRangeWhenTargetingLand]:e=>e.land===t&&e.power.owner===a})},threshold:{[i.Air]:2}},{text:"After an action generates <fear> in target land, including from destroying <town>/<city>: Push up to 1 <explorer> per <fear> / 1 <town> per 2 <fear>. (You may mix-and-match.)",[r.InTargetLand]:async({$:e,land:a,...t})=>{const n=e.nextTriggerId(),i={triggerId:n,[r.Now]:async({action:t})=>{let r=t.parentData.generatedFear[n];for(;r>=1;){const t=r>1?Z.ExplorerOrTown:Z.Explorer,n=await a.push({quantifier:w.UpTo,pieces:t,pickPiecesEffect:{prompt:`Pick one ${ee[t].text} to Push. (${r} <fear> left.)`,noOptions:"No more valid Invaders to Push."}});if(0===n.length)break;n[0].piece.isA(e.Explorer)?r-=1:r-=2}}};await e.addSubEffectUntilEndOfTurn({[r.Reminder]:e=>e===a?t.effect.text:void 0,[r.AfterPowerGenerateFearInLand]:async({location:r,amount:s})=>{r===a&&(void 0===e.action.data.generatedFear&&(e.action.data.generatedFear={}),e.action.data.generatedFear[n]=(e.action.data.generatedFear[n]??0)+s,await e.addTrigger(i,t.effect,t.action))}})},threshold:{[i.Moon]:1}},{text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)},threshold:{[i.Fire]:2}},{text:"+2 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(2)},threshold:{[i.Moon]:2,[i.Air]:4}}]},Vr={name:"Gather The Warriors",type:o.Innate,speed:d.Slow,set:s.Base,target:c.Land,range:1,hasPushOrGather:!0,mayBeSpeed:{effect:{text:"If you have 4 <air>: This power may be <fast>.",[r.Now]:async({action:e})=>{await e.spirit.convertElements({[i.Air]:4}),await e.power.makeFast()}},condition:({spirit:e,speed:a})=>a===d.Fast&&e.hasElementsWithConvert({[i.Air]:4}),noDowngrade:({element:e,spirit:a,speed:t})=>t===d.Fast&&e===i.Air&&!a.hasElementsWithConvert({[i.Air]:5})},effects:[{text:"This Power may be <fast>.",[r.InTargetLand]:()=>Promise.resolve(),threshold:{[i.Air]:4},noConvertToThreshold:!0,dontResolveAlone:!0},{effects:[{text:"Gather up to 1 <dahan> per <air> you have.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElementsToCombo({[i.Air]:1}),await t.gatherUpTo(a.elements[i.Air],e.Dahan)}},{text:"Push up to 1 <dahan> per <sun> you have.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElementsToCombo({[i.Sun]:1}),await t.pushUpTo(a.elements[i.Sun],e.Dahan)}}],threshold:{[i.Animal]:1}}]},Yr={name:"Lead The Furious Assault",type:o.Innate,speed:d.Slow,set:s.Base,target:c.Land,range:0,mayBeSpeed:{effect:{text:"If you have 4 <air>: This power may be <fast>.",[r.Now]:async({action:e})=>{await e.spirit.convertElements({[i.Air]:4}),await e.power.makeFast()}},condition:({spirit:e,speed:a})=>a===d.Fast&&e.hasElementsWithConvert({[i.Air]:4}),noDowngrade:({element:e,spirit:a,speed:t})=>t===d.Fast&&e===i.Air&&!a.hasElementsWithConvert({[i.Air]:5})},hasDestroyInstructions:!0,effects:[{text:"This Power may be <fast>.",[r.InTargetLand]:()=>Promise.resolve(),threshold:{[i.Air]:4},noConvertToThreshold:!0,dontResolveAlone:!0},{text:"Destroy 1 <town> for every 2 <dahan> in target land.",[r.InTargetLand]:async({$:e,land:a})=>{await a.destroy({amount:a.forEvery(2,e.Dahan),pieces:e.Town})},threshold:{[i.Sun]:2,[i.Fire]:1}},{text:"Destroy 1 <city> for every 3 <dahan> in target land.",[r.InTargetLand]:async({$:e,land:a})=>{await a.destroy({amount:a.forEvery(3,e.Dahan),pieces:e.City})},threshold:{[i.Sun]:4,[i.Fire]:3}}]},zr={name:"Lead The Warriors To Battle",type:o.Innate,speed:d.Slow,set:s.NatureIncarnate,target:c.Land,targetFilter:[l.IncarnaAndDahan],generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.736,.855],text:"1 <fear> if <town>/<city> are present. 1 Damage.",[r.InTargetLand]:async({$:e,land:a})=>{a.has(e.TownOrCity)&&await a.fear(1),await a.damage(1)},threshold:{[i.Sun]:1,[i.Fire]:2}},{textArea:[.875,.925],text:"1 Damage per <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.damage(a.numberOf(e.Dahan))},threshold:{[i.Sun]:3,[i.Fire]:3}}]},Qr={name:"Manifestation Of Power And Glory",type:o.Unique,speed:d.Slow,energy:3,elements:[i.Sun,i.Fire,i.Air],set:s.Base,target:c.Land,targetFilter:[l.Dahan],range:0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.679,.719],text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.716,.853],text:"Each <dahan> deals Damage equal to the number of your <presence> in target land.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await t.damage(t.numberOf(e.Dahan)*t.numberOfPresenceOf(a))}}]},Kr={name:"Sudden Ambush",type:o.Unique,speed:d.Fast,energy:2,elements:[i.Fire,i.Air,i.Animal],set:s.Base,target:c.Land,range:1,hasPushOrGather:!0,hasDestroyInstructions:!0,effects:[{textArea:[.722,.762],text:"You may Gather 1 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.mayGather(e.Dahan)}},{textArea:[.768,.808],text:"Each <dahan> destroys 1 <explorer>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.destroy({amount:a.numberOf(e.Dahan),pieces:e.Explorer})}}]},Xr={name:"Voice Of Thunder",type:o.Unique,speed:d.Slow,energy:0,elements:[i.Sun,i.Air],set:s.Base,target:c.Land,range:1,hasPushOrGather:!0,effects:[{textArea:[.7,.848],text:"Push up to 4 <dahan>.<or>If Invaders are present, 2 <fear>.",[r.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"PushDahan",textArea:[.71,.75],text:"Push up to 4 <dahan>.",[r.Now]:async()=>{await a.pushUpTo(4,e.Dahan)}},{actionId:"Fear",textArea:[.798,.838],text:"If Invaders are present, 2 <fear>.",[r.Now]:async()=>{a.hasInvaders&&await a.fear(2)}}]})}}]},_r={name:"Words Of Warning",type:o.Unique,speed:d.Fast,energy:1,elements:[i.Sun,i.Air,i.Animal],set:s.Base,target:c.Land,targetFilter:[l.Dahan],range:1,effects:[{textArea:[.68,.72],text:"Defend 3.",[r.InTargetLand]:async({land:e})=>{await e.defend(3)}},{textArea:[.716,.854],text:"During Ravage, <dahan> in target land deal Damage simultaneously with Invaders.",[r.InTargetLand]:async({$:e,land:a})=>{await e.addSubEffectUntilEndOfTurn({[r.DahanFightSimultaneously]:e=>e.land===a})}}]},Zr={name:"Encircle The Unsuspecting Prey",type:o.Innate,speed:d.Slow,set:s.NatureIncarnate,target:c.Land,range:1,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{textArea:[.266,.478],text:"You may Gather 1 <beasts> into target or an adjacent land. If you do, 1 Damage in that land.",[r.InTargetLand]:async({$:e,land:a})=>{await a.inThisAndAdjacentLands().where((a=>a.numberOfPiecesInAdjacentLands(e.Beasts)>0)).pickOne((async a=>{(await a.gatherOne(e.Beasts)).length>0&&await a.damage(1)}))},threshold:{[i.Plant]:1,[i.Animal]:2}},{textArea:[.5,.712],text:"If at least 2 <beasts> are within <range-1> (of target land), 1 Damage.",[r.InTargetLand]:async({$:e,land:a,you:t})=>{a.forPiecesWithin(1,t).where((a=>a.isA(e.Beasts))).count>=2&&await a.damage(1)},threshold:{[i.Moon]:1,[i.Animal]:3}},{textArea:[.738,.878],text:"For each adjacent land with <beasts>, 1 Damage.",[r.InTargetLand]:async({$:e,land:a})=>{const t=a.inAdjacentLands().where((a=>a.has(e.Beasts))).count;await a.damage(t)},threshold:{[i.Moon]:1,[i.Plant]:2,[i.Animal]:4}}]},ei={name:"Frenzied Assault",type:o.Innate,speed:d.Slow,set:s.BranchAndClaw,target:c.Land,targetFilter:[l.Beasts],range:1,generatesFear:!0,hasDamageInstructions:!0,effects:[{effects:[{text:"1 <fear> and 2 Damage.",[r.InTargetLand]:async({land:e})=>{await e.fear(1),await e.damage(2)}},{text:"Remove 1 <beasts>.",[r.InTargetLand]:async({$:e,land:a})=>{e.dontCountAs(p.Beasts),await a.remove({amount:1,pieces:e.Beasts})}}],threshold:{[i.Moon]:1,[i.Fire]:1,[i.Animal]:4}},{text:"+1 <fear> and +1 Damage.",[r.InTargetLand]:async({land:e})=>{await e.fear(1),await e.damage(1)},threshold:{[i.Moon]:1,[i.Fire]:2,[i.Animal]:5}}]},ai={name:"Prey On The Builders",type:o.Unique,speed:d.Fast,energy:1,elements:[i.Moon,i.Fire,i.Animal],set:s.BranchAndClaw,target:c.Land,range:0,hasPushOrGather:!0,effects:[{textArea:[.664,.704],text:"You may Gather 1 <beasts>",[r.InTargetLand]:async({$:e,land:a})=>{await a.mayGather(e.Beasts)}},{textArea:[.742,.88],text:"If target land has <beasts>, Invaders do not Build there this turn.",[r.InTargetLand]:async({$:e,land:a})=>{a.has(e.Beasts)&&await a.skipInvaderAction({all:!0,filter:({invaderAction:e})=>e===K.Build})}}]},ti={name:"Ranging Hunt",type:o.Innate,speed:d.Fast,set:s.BranchAndClaw,target:c.Land,targetFilter:[l.NonBlight],range:1,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{text:"You may Gather 1 <beasts>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.mayGather(e.Beasts)},threshold:{[i.Animal]:2}},{text:"1 Damage per <beasts>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.damage(a.numberOf(e.Beasts))},threshold:{[i.Plant]:2,[i.Animal]:3}},{text:"You may Push up to 2 <beasts>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(2,e.Beasts)},threshold:{[i.Animal]:2}}]},ni={name:"Teeth Gleam From Darkness",type:o.Unique,speed:d.Slow,energy:1,elements:[i.Moon,i.Plant,i.Animal],set:s.BranchAndClaw,target:c.Land,sourceFilter:[l.Jungle],targetFilter:[l.NonBlight],range:1,generatesFear:!0,effects:[{textArea:[.669,.863],text:"1 <fear>. Add 1 <beasts><or>If target land has both <beasts> and Invaders: 3 <fear>.",[r.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"Beasts",textArea:[.679,.719],text:"1 <fear>. Add 1 <beasts>",[r.Now]:async()=>{await a.fear(1),await a.add(1,e.Beasts)}},{actionId:"Fear",textArea:[.762,.854],text:"If target land has both <beasts> and Invaders: 3 <fear>.",[r.Now]:async()=>{a.hasAllOf(e.Beasts,e.Invader)&&await a.fear(3)}}]})}}]},ri={name:"Terrifying Chase",type:o.Unique,speed:d.Slow,energy:1,elements:[i.Sun,i.Animal],set:s.BranchAndClaw,target:c.Land,range:0,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.641,.681],text:"Push 2 <explorer>/<town>/<dahan>",[r.InTargetLand]:async({action:e,$:a,land:t})=>{e.data.movement=await t.push({amount:2,pieces:a.ExplorerTownOrDahan})}},{textArea:[.684,.779],text:"Push another 2 <explorer>/<town>/<dahan> per <beasts> in target land.",[r.InTargetLand]:async({action:e,$:a,land:t})=>{e.data.movement.push(...await t.push({amount:2*t.numberOf(a.Beasts),pieces:a.ExplorerTownOrDahan}))}},{textArea:[.814,.906],text:"If you Pushed any Invaders, 2 <fear>.",[r.InTargetLand]:async({action:e,land:a})=>{e.data.movement.some((({piece:e})=>e.isInvader))&&await a.fear(2)}}]},ii={name:"Too Near The Jungle",type:o.Unique,speed:d.Slow,energy:0,elements:[i.Plant,i.Animal],set:s.BranchAndClaw,target:c.Land,sourceFilter:[l.Jungle],range:1,generatesFear:!0,hasDestroyInstructions:!0,effects:[{textArea:[.705,.745],text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.75,.79],text:"Destroy 1 <explorer>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.destroyOne(e.Explorer)}}]},si={name:"Boon Of Growing Power",type:o.Unique,speed:d.Slow,energy:1,elements:[i.Sun,i.Moon,i.Plant],set:s.BranchAndClaw,target:c.Spirit,effects:[{textArea:[.68,.72],text:"Target Spirit gains a Power Card.",[r.TargetSpirit]:async({spirit:e})=>{await e.gainPowerCard()}},{textArea:[.765,.854],text:"If you target another Spirit, they also gain 1 Energy.",[r.TargetSpirit]:async({spirit:e,you:a})=>{e!==a&&await e.gainEnergy(1)}}]},oi={name:"Punish Those Who Trespass",type:o.Innate,speed:d.Slow,set:s.BranchAndClaw,target:c.Land,range:0,hasDestroyInstructions:!0,fullText:["Threshold 2 <sun> 1 <fire> 2 <plant>","2 Damage","Destroy 1 <dahan>.","Threshold 2 <sun> 2 <fire> 3 <plant>","+1 Damage per <sun> and <plant> you have.","Threshold 4 <plant>","You may split this Power's Damage however desired between target land and one of your lands."],effects:[{text:"You may split this Power's Damage however desired between target land and one of your lands.",[r.InTargetLand]:async({you:e,action:a})=>{e.hasElements({[i.Plant]:4})&&await e.inLands().optionallyPickOne((e=>(a.data.otherLand=e,Promise.resolve())))}},{effects:[{text:"2 Damage",[r.InTargetLand]:async({$:e,land:a,action:t})=>{await e.splittedDamage({amount:2,lands:[a,...[t.data.otherLand]??0]})}},{text:"Destroy 1 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.destroyOne(e.Dahan)}}],threshold:{[i.Sun]:2,[i.Fire]:1,[i.Plant]:2}},{text:"+1 Damage per <sun><plant> you have.",[r.InTargetLand]:async({$:e,action:a,you:t,land:n})=>{await t.askToConvertElementsToCombo({[i.Sun]:1,[i.Plant]:1}),await e.splittedDamage({amount:t.numberOfElementCombos({[i.Sun]:1,[i.Plant]:1}),lands:[n,...[a.data.otherLand]??0]})},threshold:{[i.Sun]:2,[i.Fire]:2,[i.Plant]:3}},{threshold:{[i.Plant]:4}}]},di={name:"Regrow From Roots",type:o.Unique,speed:d.Slow,energy:1,elements:[i.Water,i.Earth,i.Plant],set:s.BranchAndClaw,target:c.Land,targetFilter:[l.Jungle,l.Wetlands],range:1,blightWhiteListedPower:!0,effects:[{textArea:[.71,.817],text:"If there are 2 <blight> or fewer in target land, remove 1 <blight>.",[r.InTargetLand]:async({$:e,land:a})=>{a.hasAtMost(2,e.Blight)&&await a.removeBlight()}}]},ci={name:"Sacrosanct Wilderness",type:o.Unique,speed:d.Fast,energy:2,elements:[i.Sun,i.Earth,i.Plant],set:s.BranchAndClaw,target:c.Land,targetFilter:[l.NonBlight],range:1,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{textArea:[.636,.676],text:"Push 2 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.push({amount:2,pieces:e.Dahan})}},{textArea:[.719,.897],text:"2 Damage per <wilds> in target land.<or>Add 1 <wilds>.",[r.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"Damage",textArea:[.716,.808],text:"2 Damage per <wilds> in target land.",[r.Now]:async()=>{await a.damage(2*a.numberOf(e.Wilds))}},{actionId:"AddWilds",textArea:[.851,.891],text:"Add 1 <wilds>.",[r.Now]:async()=>{await a.add(1,e.Wilds)}}]})}}]},li={name:"Spreading Wilds",type:o.Innate,speed:d.Slow,set:s.BranchAndClaw,target:c.Land,targetFilter:[l.NonBlight],range:1,modifiesRange:({spirit:e,withConvert:a})=>e.hasElements({[i.Plant]:3,[i.Air]:1},a)?2:e.hasElements({[i.Plant]:3},a)||e.hasElements({[i.Air]:1},a)?1:0,payForRange:async({$:e,spirit:a})=>{await e.chooseBetween({text:"To cast Spreading Wilds in this land, you need to convert elements.",effects:[{actionId:"ConvertPlant",text:"Convert to 3 <plant>",[r.Now]:async()=>{await a.convertElements({[i.Plant]:3})},condition:()=>!a.hasElements({[i.Plant]:3})&&a.hasElementsWithConvert({[i.Plant]:3})},{actionId:"ConvertAir",text:"Convert to 1 <air>",[r.Now]:async()=>{await a.convertElements({[i.Air]:1})},condition:()=>!a.hasElements({[i.Air]:1})&&a.hasElementsWithConvert({[i.Air]:1})}]})},hasPushOrGather:!0,effects:[{text:"Push 1 <explorer> from target land per 2 <sun> you have.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElementsToCombo({[i.Sun]:2}),await t.push({amount:Math.floor(a.elements[i.Sun]/2),pieces:e.Explorer})},threshold:{[i.Sun]:2}},{text:"If target land has no <explorer>, add 1 <wilds>.",[r.InTargetLand]:async({$:e,land:a})=>{a.doesntHave(e.Explorer)&&await a.add(1,e.Wilds)},threshold:{[i.Plant]:1}},{text:"This Power has <range+1>.",threshold:{[i.Plant]:3},noConvertToThreshold:!0,dontResolveAlone:!0},{text:"This Power has <range+1>.",threshold:{[i.Air]:1},noConvertToThreshold:!0,dontResolveAlone:!0}]},hi={name:"Towering Wrath",type:o.Unique,speed:d.Slow,energy:3,elements:[i.Sun,i.Fire,i.Plant],set:s.BranchAndClaw,target:c.Land,sourceFilter:[l.SacredSite],range:1,generatesFear:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{textArea:[.661,.701],text:"2 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.7,.835],text:"For each of your <sacred> in/adjacent to target land, 2 Damage.",[r.InTargetLand]:async({you:e,land:a})=>{const t=a.inThisAndAdjacentLands().where((a=>a.hasSacredSiteOf(e))).count;await a.damage(2*t)}},{textArea:[.838,.878],text:"Destroy all <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.destroyAll(e.Dahan)}}]},gi={name:"Dark Skies Loose A Stinging Rain",type:o.Unique,speed:d.Fast,energy:1,elements:[i.Moon,i.Air,i.Water],set:s.FeatherAndFlame,target:c.Land,sourceFilter:[l.Wetlands],range:1,hasPushOrGather:!0,effects:[{textArea:[.699,.739],text:"Isolate target land.",[r.InTargetLand]:async({land:e})=>{await e.isolate()}},{textArea:[.762,.802],text:"Push up to 1 <explorer>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(1,e.Explorer)}},{textArea:[.762,.802],text:"Push up to 2 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(2,e.Dahan)}}]},fi={name:"Foundations Sink Into Mud",type:o.Unique,speed:d.Slow,energy:1,elements:[i.Water,i.Earth],set:s.FeatherAndFlame,target:c.Land,range:0,hasDamageInstructions:!0,effects:[{textArea:[.654,.878],text:"2 Damage to <town>.<br><br>If target land is <wetlands>, you may instead deal 1 Damage to each <town>/<city>.",[r.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"DamageToTown",textArea:[.666,.706],text:"2 Damage to <town>.",[r.Now]:async()=>{await a.damage(2,e.Town)}},{actionId:"DamageToEach",textArea:[.779,.876],text:"1 Damage to each <town>/<city>.",condition:()=>a.isWetlands,[r.Now]:async()=>{await a.damageEach(1,e.TownOrCity)}}]},{orChoice:!1})}}]},ui={name:"Gift Of Abundance",type:o.Unique,speed:d.Fast,energy:1,elements:[i.Sun,i.Air,i.Water,i.Plant],set:s.FeatherAndFlame,target:c.Spirit,targetFilter:[m.Another],effects:[{textArea:[.64,.758],text:"Target Spirit either gains 2 Energy, or may Repeat one Power Card this turn by paying its cost.",[r.TargetSpirit]:async({$:e,spirit:a,isRepeat:t,...n})=>{await e.chooseBetween({effects:[{actionId:"GainEnergy",textArea:[.64,.68],text:"Gain 2 Energy",[r.Now]:async()=>{await a.gainEnergy(2)}},{actionId:"Repeat",textArea:[.68,.763],text:"Repeat one Power Card this turn by paying its cost.",[r.Now]:async()=>{t||await e.addSubEffectUntilEndOfTurn({[r.GlobalReminder]:()=>({power:n.power.power,players:[a]}),[r.MayRepeatPowercard]:({power:e,speed:t})=>e.owner===a&&e.costToPlay<=a.energy&&e.data.type!==o.Innate&&e.possibleToRepeatAtSpeed(t),[r.RepeatPowerCard]:async({power:a,speed:t})=>{e.removeThisEffect(),await a.payForPlay(),await a.replay(t)}})}}]},{orChoice:!1})}},{textArea:[.772,.901],text:"Either you or target Spirit may add 1 Destroyed <presence> to a <wetlands> where you have <presence>.",[r.TargetSpirit]:async({$:e,you:a,spirit:t})=>{await e.chooseBetween({autoPlayOneOption:!0,effects:[{actionId:"YouAddPresence",textArea:[.814,.854],text:"You may add 1 Destroyed <presence>.",[r.Now]:async()=>{await a.addPresence({locations:g.AnyLands,destroyed:!0,filter:e=>e.isWetlands&&e.hasPresenceOf(a)})}},{actionId:"TargetAddPresence",textArea:[.814,.854],text:`${t.nameLink} adds 1 Destroyed <presence>.`,condition:()=>a!==t,[r.Now]:async()=>{await t.addPresence({locations:g.AnyLands,destroyed:!0,filter:e=>e.isWetlands&&e.hasPresenceOf(a)})}}]})}}]},pi={name:"Rain And Mud Suppress Conflict",type:o.Innate,speed:d.Fast,set:s.FeatherAndFlame,target:c.Spirit,targetFilter:[m.Yourself],generatesFear:!0,effects:[{text:"Each of your <presence> grants Defend 1 and lowers <dahan> counterattack Damage by 1. (Total, in its land.)",[r.TargetSpirit]:async({$:e,you:a})=>{await e.addSubEffectUntilEndOfTurn({[r.GlobalReminder]:()=>({icon:"<presence><br>Defend",spirit:a,players:[a]}),[r.DefendFromSpirits]:({land:e})=>e.numberOfPresenceOf(a),[r.AdjustCollectiveDahanRavageDamage]:({land:e})=>-e.numberOfPresenceOf(a)})},threshold:{[i.Air]:1,[i.Water]:3}},{text:"Each of your <presence> grants Defend 1 and lowers <dahan> counterattack Damage by 1. (Total, in its land.)",[r.TargetSpirit]:async({$:e,you:a})=>{await e.addSubEffectUntilEndOfTurn({[r.GlobalReminder]:()=>({icon:"<presence><br>Defend",spirit:a,players:[a]}),[r.DefendFromSpirits]:({land:e})=>e.numberOfPresenceOf(a),[r.AdjustCollectiveDahanRavageDamage]:({land:e})=>-e.numberOfPresenceOf(a)})},threshold:{[i.Water]:5,[i.Earth]:1}},{effects:[{text:"2 <fear>. In your lands, Invaders and <dahan> have -1 Health (min 1).",[r.TargetSpirit]:async({$:e,you:a})=>{await e.fear(2),await e.addSubEffectUntilEndOfTurn({[r.GlobalReminder]:()=>({text:"In your lands, Invaders and <dahan> have -1 Health (min 1).",icon:"<dahan><br>-1 HP",spirit:a,players:[a]}),[r.AdjustHealth]:({piece:t})=>null!=t.location&&t.location.hasPresenceOf(a)&&t.isA(e.InvaderOrDahan)?-1:0,[r.AfterAddingPiece]:async({land:e})=>{await e.healthCheck()}}),await a.inLands().forEach((async e=>{await e.healthCheck()}))}}],threshold:{[i.Air]:3,[i.Water]:9,[i.Earth]:2}}]},wi={name:"Unbearable Deluge",type:o.Unique,speed:d.Fast,energy:0,elements:[i.Air,i.Water,i.Earth],set:s.FeatherAndFlame,target:c.Land,range:0,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.703,.743],text:"1 <fear>",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.703,.743],text:"Push 2 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.push({amount:2,pieces:e.Dahan})}},{textArea:[.703,.743],text:"Defend 3.",[r.InTargetLand]:async({land:e})=>{await e.defend(3)}},{textArea:[.785,.825],text:"If target land is <wetlands>, Isolate it.",[r.InTargetLand]:async({land:e})=>{e.isWetlands&&await e.isolate()}}]},yi={name:"Water Nourishes Lifes Growth",type:o.Innate,speed:d.Fast,set:s.FeatherAndFlame,target:c.Land,range:0,hasPushOrGather:!0,blightWhiteListedPower:!0,effects:[{effects:[{text:"Gain 1 Energy.",[r.InTargetLand]:async({you:e})=>{await e.gainEnergy(1)}},{text:"You may Remove 1 <blight> by Removing 1 of your <presence> (from target land).",[r.InTargetLand]:async({$:e,you:a,land:t})=>{t.has(e.Blight)&&t.hasPresenceOf(a)&&(await t.remove({quantifier:w.UpTo,amount:1,pieces:e.Presence,owner:a})).length>0&&await t.removeBlight()}}],threshold:{[i.Water]:3,[i.Plant]:2}},{effects:[{text:"Gain +1 Energy.",[r.InTargetLand]:async({you:e})=>{await e.gainEnergy(1)}},{text:"Gather up to 1 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(1,e.Dahan)}}],threshold:{[i.Water]:5,[i.Earth]:1,[i.Plant]:2}},{text:"When <blight> would be added to target land instead leave it on the card.",[r.InTargetLand]:async({$:e,land:a,effect:t})=>{await e.addSubEffectUntilEndOfTurn({[r.Reminder]:e=>e===a?t.text:void 0,[r.PreventAddBlight]:({location:e})=>Promise.resolve(e===a)})},threshold:{[i.Water]:7,[i.Earth]:2,[i.Plant]:3}}]},mi={name:"A Circuitous And Wending Journey",type:o.Unique,speed:d.Slow,energy:0,elements:[i.Moon,i.Air],set:s.FeatherAndFlame,target:c.Land,range:0,hasPushOrGather:!0,fullText:["Push up to half (round up) of Invaders from target land.","Do likewise (separately) for <dahan>, <presence>, and <beasts>."],effects:[{textArea:[.67,.765],text:"Push up to half (round up) of Invaders from target land.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(Math.ceil(a.numberOf(e.Invader)/2),e.Invader)}},{textArea:[.775,.87],text:"Push up to half (round up) of <dahan> from target land.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(Math.ceil(a.numberOf(e.Dahan)/2),e.Dahan)}},{textArea:[.775,.87],text:"Push up to half (round up) of <presence> from target land.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(Math.ceil(a.numberOf(e.Presence)/2),e.Presence)}},{textArea:[.775,.87],text:"Push up to half (round up) of <beasts> from target land.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(Math.ceil(a.numberOf(e.Beasts)/2),e.Beasts)}}]},vi={name:"Aid From The Spirit-Speakers",type:o.Unique,speed:d.Fast,energy:2,elements:[i.Sun,i.Fire,i.Air,i.Animal],set:s.FeatherAndFlame,target:c.Land,range:1,effects:[{textArea:[.682,.825],text:"For each <dahan>, you may move 1 Invader/<dahan>/<presence>/<beasts> to a land within <range-2> that has <dahan>.",[r.InTargetLand]:async({$:e,land:a,you:t})=>{await a.move({quantifier:w.May,amount:a.numberOf(e.Dahan),pieces:e.InvaderDahanPresenceOrBeast,locations:{target:g.WithinRange,range:2,spirit:t},destinationFilter:a=>a.has(e.Dahan),together:!0})}}]},Ii={name:"Close The Ways",type:o.Innate,speed:d.Fast,set:s.FeatherAndFlame,target:c.Land,range:1,fullText:["Target each level of this as a separate Power.","1 <air> 2 <water>: Isolate target land.","2 <air> 2 <earth>: Isolate target land.","3 <air> 2 <plant>: Isolate target land."],effects:[{text:"Target each level of this as a separate Power. Isolate target land.",[r.InTargetLand]:async({you:e,power:a,land:t})=>{const n=[{[i.Air]:1,[i.Water]:2},{[i.Air]:2,[i.Earth]:2},{[i.Air]:3,[i.Plant]:2}].filter((a=>e.hasElements(a))).length;for(let e=0;e<n;e+=1)0===e?await t.isolate():await a.validLandTargets().pickOne((async e=>{await e.isolate()}))}},{threshold:{[i.Air]:1,[i.Water]:2}},{threshold:{[i.Air]:2,[i.Earth]:2}},{threshold:{[i.Air]:3,[i.Plant]:2}}]},Ai={name:"Lay Paths They Cannot Help But Walk",type:o.Innate,speed:d.Fast,set:s.FeatherAndFlame,target:c.Land,range:0,hasPushOrGather:!0,blightWhiteListedPower:!0,effects:[{text:"Push up to half (round down) of Invaders from target land. Do likewise for <dahan>, <presence>, and <beasts> (each separately).",[r.InTargetLand]:async({$:e,land:a})=>{await e.addSubEffect({effects:[e.Invader,e.Dahan,e.Presence,e.Beasts].map((e=>({text:`Push up to half (round down) of ${ee[e].text} from target land.`,[r.Now]:async()=>{await a.pushUpTo(Math.floor(a.numberOf(e)/2),e)}})))})},threshold:{[i.Moon]:2,[i.Air]:2}},{text:"Push up to 1 Invader/<dahan>/<presence>/<beasts>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(1,e.InvaderDahanPresenceOrBeast)},threshold:{[i.Sun]:2,[i.Air]:2}},{text:"Repeat this Power.",[r.InTargetLand]:async({power:e,isRepeat:a})=>{a||await e.repeat()},threshold:{[i.Moon]:2,[i.Air]:4,[i.Water]:3}}]},xi={name:"Offer Passage Between Worlds",type:o.Unique,speed:d.Fast,energy:1,elements:[i.Sun,i.Moon,i.Air],set:s.FeatherAndFlame,target:c.Land,range:1,effects:[{textArea:[.614,.929],text:"Move up to 4 <dahan> between target land and one of your lands<or>The next time <dahan> would be Destroyed in target land, Destroy 2 fewer <dahan>.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await e.chooseBetween({effects:[{actionId:"MoveDahan",textArea:[.613,.716],text:"Move up to 4 <dahan> between target land and one of your lands",[r.Now]:async()=>{await t.moveBetween({upToAmount:4,pieces:e.Dahan,destination:e=>e.hasPresenceOf(a)})}},{actionId:"ProtectDahan",textArea:[.782,.923],text:"The next time <dahan> would be Destroyed in target land, Destroy 2 fewer <dahan>.",[r.Now]:async a=>{let n=0;await e.addSubEffectUntilEndOfTurn({[r.Reminder]:e=>e===t?a.effect.text:void 0,[r.OrderOfRemoveAllMightMatter]:()=>!0,[r.PreventRemovePiece]:async({piece:a,removement:r})=>!!(a.isA(e.Dahan)&&a.location===t&&n<2&&x[r].isDestroyLike)&&(n+=1,await e.sendEvent({type:T.GenericSub,text:"The <dahan> is saved from destruction by <p>OfferPassageBetweenWorlds</p>."}),2===n&&e.removeThisEffect(),!0)})}}]})}}]},bi={name:"Paths Tied By Nature",type:o.Unique,speed:d.Slow,energy:0,elements:[i.Sun,i.Air,i.Earth,i.Plant],set:s.FeatherAndFlame,target:c.Land,range:1,effects:[{textArea:[.692,.842],text:"Move up to 2 Invaders/<dahan><presence><beasts> to a land within <range-2> that has the same terrain.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await t.move({quantifier:w.UpTo,amount:2,locations:{target:g.WithinRange,range:2,spirit:a},destinationFilter:e=>e.hasSameTerrainAs(t),pieces:e.InvaderDahanPresenceOrBeast,together:!0})}}]},Ti={name:"Travelers Boon",type:o.Unique,speed:d.Fast,energy:0,elements:[i.Moon,i.Air,i.Water],set:s.FeatherAndFlame,target:c.Spirit,targetFilter:[m.Another],effects:[{textArea:[.648,.89],text:"Target Spirit moves up to 3 of their <presence> to one of your lands.<br><br>They may move up to 1 Invader, 1 <dahan>, and 1 <beasts> along with their <presence>. (Total, not for each <presence>.).",[r.TargetSpirit]:async({$:e,you:a,spirit:t})=>{const n=[e.Invader,e.Dahan,e.Beasts];await a.inLands().pickOne((async e=>{await t.presence().pickMultiple({amount:3,optional:!0,forPickedItem:async a=>{const t=a.location;await a.move({locations:{target:g.ToThisLocation,location:e}}),await t.forPieces().pickMultiple({amount:n.length,optional:!0,where:e=>n.some((a=>e.isA(a))),forPickedItem:async a=>{ae(n,(e=>a.isA(e))),await a.move({locations:{target:g.ToThisLocation,location:e}})},effect:{textArea:[.756,.89],text:"They may move up to 1 Invader, 1 <dahan>, and 1 <beasts> along with their <presence>. (Total, not for each <presence>.)."}})},repeatSame:!0})}),{prompt:"Select destination land."})}}]},Ei={name:"Ways Of Shore And Heartland",type:o.Unique,speed:d.Slow,energy:1,elements:[i.Air,i.Water,i.Earth],set:s.FeatherAndFlame,target:c.Land,range:2,hasPushOrGather:!0,effects:[{textArea:[.696,.842],text:"Push up to 2 Invaders/<dahan>/<presence>/<beasts> to a land that is also Coastal/Inland (whichever the target land is).",[r.InTargetLand]:async({$:e,land:a})=>{await a.push({quantifier:w.UpTo,amount:2,destinationFilter:e=>e.isCoastal===a.isCoastal,pieces:e.InvaderDahanPresenceOrBeast,together:!0})}}]},Pi={name:"Absorb Essence",type:o.Unique,speed:d.Fast,energy:2,elements:[i.Moon,i.Fire,i.Water,i.Earth],set:s.FeatherAndFlame,target:c.Spirit,targetFilter:[m.Another],effects:[{textArea:[.634,.674],text:"Gain 3 Energy",[r.TargetSpirit]:async({you:e})=>{await e.gainEnergy(3)}},{textArea:[.676,.853],text:'Move 1 of target Spirit\'s <presence> from the board to your "Deep Slumber" Track. Absorbed <presence> cannot be returned to play.',[r.TargetSpirit]:async({you:e,spirit:a})=>{e.spirit===hn.Serpent&&await a.presence().pickOne((async a=>{const t=await a.remove(A.RemoveFromGame);t.length>0&&t[0].piece.piece===p.Presence&&await e.absorb(t[0].piece.owner)}))}},{textArea:[.809,.9],text:"Target Spirit gains 1 <any> and 1 Energy.",[r.TargetSpirit]:async({spirit:e})=>{await e.gainElements(),await e.gainEnergy(1)}}]},Si={name:"Elemental Aegis",type:o.Unique,speed:d.Fast,energy:1,elements:[i.Fire,i.Water,i.Earth],set:s.FeatherAndFlame,target:c.Land,range:0,effects:[{textArea:[.653,.881],text:'Defend 2 in target land and all adjacent lands. For every <presence> on your "Deep Slumber" Track, Defend 1 in target land and all adjacent lands.',[r.InTargetLand]:async({$:e,you:a,land:t})=>{await e.addSubEffectUntilEndOfTurn({[r.DefendFromSpirits]:e=>e.land===t||e.land.isAdjacentTo(t)?2+a.absorbedPresence.length:0})}}]},Oi={name:"Gift Of Flowing Power",type:o.Unique,speed:d.Fast,energy:1,elements:[i.Fire,i.Water],set:s.FeatherAndFlame,target:c.Spirit,targetFilter:[m.Another],effects:[{textArea:[.618,.658],text:"Target Spirit gains 1 Energy.",[r.TargetSpirit]:async({spirit:e})=>{await e.gainEnergy(1)}},{textArea:[.7,.932],text:"Target Spirit chooses to either:<br>Play another Power Card by paying its cost.<or>Gain 1 <fire> and 1 <water>.",[r.TargetSpirit]:async({$:e,spirit:a})=>{await e.chooseBetween({effects:[{actionId:"PlayPowerCard",textArea:[.745,.837],text:"Play another Power Card by paying its cost.",[r.Now]:async()=>{await a.playAPowerCardByPayingItsCost()}},{actionId:"GainElements",textArea:[.881,.921],text:"Gain 1 <fire> and 1 <water>.",[r.Now]:async()=>{await a.gainElementsUntilEndOfTurn({[i.Fire]:1,[i.Water]:1})}}]})}}]},Ci={name:"Gift Of The Primordial Deeps",type:o.Unique,speed:d.Fast,energy:1,elements:[i.Moon,i.Earth],set:s.FeatherAndFlame,target:c.Spirit,targetFilter:[m.Another],effects:[{textArea:[.615,.655],text:"Target Spirit gains a Minor Power.",[r.TargetSpirit]:async({spirit:e,action:a})=>{a.data.powerGain=await e.gainPowerCard({powerType:o.Minor})}},{textArea:[.7,.926],text:"Target Spirit chooses to either: Play it immediately by paying its cost.<or>Gain 1 <moon> and 1 <earth>.",[r.TargetSpirit]:async({$:e,spirit:a,action:t})=>{const n=t.data.powerGain.chosen;await e.chooseBetween({effects:[{actionId:"Play",textArea:[.746,.834],text:"Play it immediately by paying its cost.",condition:()=>n.length>0&&n[0].isPlayable,[r.Now]:async()=>{await n[0].play({withoutUsingCardPlays:!0})}},{actionId:"GainElements",textArea:[.88,.92],text:"Gain 1 <moon> and 1 <earth>.",[r.Now]:async()=>{await a.gainElementsUntilEndOfTurn({[i.Moon]:1,[i.Earth]:1})}}]})}}]},Di={name:"Serpent Rouses In Anger",type:o.Innate,speed:d.Slow,set:s.FeatherAndFlame,target:c.Land,range:0,hasPushOrGather:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{text:"For each <fire><earth> you have, 1 Damage to 1 <town>/<city>.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElementsToCombo({[i.Fire]:1,[i.Earth]:1});const n=a.numberOfElementCombos({[i.Fire]:1,[i.Earth]:1});await t.damage(n,e.TownOrCity,{maxTargets:n})},threshold:{[i.Fire]:1,[i.Earth]:1}},{text:"For each 2 <moon><earth> you have, 2 <fear> and you may Push 1 <town> from target land.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElementsToCombo({[i.Moon]:2,[i.Earth]:2});const n=a.numberOfElementCombos({[i.Moon]:2,[i.Earth]:2});await t.fear(2*n),await t.pushUpTo(n,e.Town)},threshold:{[i.Moon]:2,[i.Earth]:2}},{text:"Cost 7 Energy: In every land in the game: X Damage, where X is the number of <presence> you have in and adjacent to that land.",[r.InTargetLand]:async({$:e,you:a})=>{a.energy>=7&&await e.may({prompt:"Pay 7 Energy to do this effect?"})&&(await a.payEnergy(7),await e.inLands().forEach((async t=>{await t.damage(t.numberOfPiecesInThisOrAdjacentLands(e.Presence,a))})))},threshold:{[i.Moon]:5,[i.Fire]:6,[i.Earth]:6}}]},Bi={name:"Serpent Wakes In Power",type:o.Innate,speed:d.Slow,set:s.FeatherAndFlame,target:c.Spirit,targetFilter:[m.Yourself],effects:[{effects:[{text:"Gain 1 Energy.",[r.TargetSpirit]:async({you:e})=>{await e.gainEnergy(1)}},{text:"Other spirits with any Absorbed Presence also gain 1 Energy.",[r.TargetSpirit]:async({$:e,you:a})=>{await e.spiritsWhich((e=>e!==a&&a.absorbedPresence.includes(e.spiritNumber))).forEach((async e=>{await e.gainEnergy(1)}))}}],threshold:{[i.Fire]:2,[i.Water]:1,[i.Plant]:1}},{effects:[{text:"Add 1 <presence> at <range-1>.",[r.TargetSpirit]:async({you:e})=>{await e.addPresenceInRange(1)}},{text:"Other spirits with 2 or more Absorbed Presence may do likewise.",[r.TargetSpirit]:async({$:e,you:a})=>{await e.spiritsWhich((e=>e!==a&&a.numberOfAbsorbedPresenceOf(e)>=2)).forEach((async e=>{await e.addPresenceInRange(1)}))}}],threshold:{[i.Water]:2,[i.Earth]:3,[i.Plant]:2}},{effects:[{text:"Gain a Major Power without Forgetting.",[r.TargetSpirit]:async({you:e})=>{await e.gainPowerCard({powerType:o.Major,withoutForgetting:!0})}},{text:"Other Spirits with 3 or more Absorbed Presence may do likewise.",[r.TargetSpirit]:async({$:e,you:a})=>{await e.spiritsWhich((e=>e!==a&&a.numberOfAbsorbedPresenceOf(e)>=3)).forEach((async e=>{await e.gainPowerCard({powerType:o.Major,withoutForgetting:!0})}))}}],threshold:{[i.Fire]:3,[i.Water]:3,[i.Earth]:3,[i.Plant]:3}}]},ki={name:"Strength Of The Waking Island",type:o.Innate,speed:d.Fast,set:s.NatureIncarnate,target:c.Spirit,targetFilter:[m.Yourself],effects:[{textArea:[.396,.7],text:"After a Spirit uses a land-targeting Power Card, they may Repeat it at <incarna-locus> by paying its cost. (Max. 1 Power Card per turn for each of their absorbed <presence>.) You may help pay some or all of this cost. (These Repeats ignore Range and target requirements.)",[r.TargetSpirit]:async({$:e,you:a,...t})=>{let n=0;const i={triggerId:e.nextTriggerId(),[r.Now]:async({action:t})=>{const r=t.parentData.wakingIslandPower,i=r.owner===a,s=i?a.energy:r.owner.energy+a.energy;if(null!=a.incarna&&s>=r.costToPlay&&n<a.numberOfAbsorbedPresenceOf(r.owner)&&await e.may({prompt:`Repeat ${r.powerLink} at <incarna-locus>?`})){if(n+=1,i)await a.payEnergy(r.costToPlay);else{const t=Math.max(r.costToPlay-r.owner.energy,0),n=0===a.energy||0===r.costToPlay?0:await e.selectX(t,Math.min(a.energy,r.costToPlay),{players:[a],text:"You may help pay some or all of this cost.",prompt:"How much of the cost would you like to pay?"});await a.payEnergy(n),await r.owner.payEnergy(r.costToPlay-n)}await r.owner.resolvePowerInLocations(r,[a.incarna.location],!0,!0)}}};await e.addEffectUntilEndOfTurn({[r.AfterResolvingLandTargetingPower]:async({power:a,isRepeat:n})=>{!n&&a.isA(ye.AnyCard)&&(e.action.data.wakingIslandPower=a,await e.addTrigger(i,t.effect,t.action))}})},threshold:{[i.Water]:2,[i.Earth]:1}},{textArea:[.718,.938],text:"Add 1 <vitality> at <incarna-locus>. If a Spirit has 2 or more absorbed <presence>, you may instead Add 1 <vitality> in one of their lands without <blight>.",[r.TargetSpirit]:async({$:e,you:a,spirit:t})=>{const n=W(a.absorbedPresence.filter((e=>a.absorbedPresence.filter((a=>a===e)).length>=2)));await e.inLandsWhere((a=>a===t.incarna?.location||a.doesntHave(e.Blight)&&a.hasOnePieceWhere((e=>e.isPresence&&n.includes(e.spiritNumber))))).pickOne((async a=>{await a.add(1,e.Vitality)}))},threshold:{[i.Moon]:2,[i.Earth]:2,[i.Plant]:1}}]},Li={name:"Asphyxiating Smoke",type:o.Unique,speed:d.Slow,energy:2,elements:[i.Fire,i.Air,i.Plant],set:s.FeatherAndFlame,target:c.Land,sourceFilter:[l.SacredSite],range:2,hasPushOrGather:!0,generatesFear:!0,hasDestroyInstructions:!0,effects:[{textArea:[.716,.756],text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.756,.796],text:"Destroy 1 <town>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.destroyOne(e.Town)}},{textArea:[.799,.839],text:"Push 1 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushOne(e.Dahan)}}]},Fi={name:"Exaltation Of The Transforming Flame",type:o.Innate,speed:d.Fast,set:s.NatureIncarnate,target:c.Spirit,targetFilter:[m.Another],blightWhiteListedPower:!0,effects:[{textArea:[.259,.413],text:"Target Spirit may Forget a Power Card to gain a Power Card and 1 <any>. You may do likewise.",[r.TargetSpirit]:async({you:e,spirit:a})=>{await a.andAnotherSpirit(e,{text:e=>(e?"Target Spirit":"You")+" may Forget a Power Card to gain a Power Card and 1 <any>.",now:async e=>{if(e.numberOfPowerCards>0){(await e.forgetPowers({optional:!0})).length>0&&(await e.gainPowerCard(),await e.gainElements())}}})},threshold:{[i.Fire]:4,[i.Plant]:1}},{textArea:[.413,.567],text:"Target Spirit may pay 1 Energy to Replace 1 <blight> with 1 <badlands> in one of their lands. You may do likewise.",[r.TargetSpirit]:async({$:e,you:a,spirit:t})=>{await t.andAnotherSpirit(a,{text:e=>(e?"Target Spirit":"You")+" may pay 1 Energy to Replace 1 <blight> with 1 <badlands> in one of their lands.",now:async a=>{a.energy>0&&await a.forPiecesThatIs(e.Blight).optionallyPickOne((async e=>{await a.payEnergy(1),await e.replace([p.Badlands])}))}})},threshold:{[i.Fire]:3,[i.Earth]:1,[i.Plant]:2}},{textArea:[.571,.733],text:"Target Spirit may Replace 1 <explorer> with 1 <beasts> in one of their lands. You may do likewise.",[r.TargetSpirit]:async({$:e,spirit:a,you:t})=>{await a.andAnotherSpirit(t,{text:e=>(e?"Target Spirit":"You")+" may Replace 1 <explorer> with 1 <beasts> in one of their lands.",now:async a=>{await a.forPiecesThatIs(e.Explorer).optionallyPickOne((async e=>{await e.replace([p.Beasts])}))}})},threshold:{[i.Sun]:1,[i.Fire]:3,[i.Animal]:1}}]},Ri={name:"Firestorm",type:o.Innate,speed:d.Fast,set:s.FeatherAndFlame,target:c.Land,targetFilter:[l.Blight],range:0,hasPushOrGather:!0,mayAlwaysDowngrade:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{text:"1 Damage per 2 <fire> you have.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElementsToCombo({[i.Fire]:2});const n=Math.floor(a.elements[i.Fire]/2);a.hasElements({[i.Fire]:4,[i.Air]:2})?await e.splittedDamage({amount:n,lands:a.inLandsWhere((a=>a.has(e.Blight)||a===t)).items,effect:{text:"Split this Power's Damage however desired between target land and any number of your lands with <blight>."}}):await t.damage(n)},threshold:{[i.Plant]:1,[i.Fire]:2}},{instead:!0,text:"Instead, 1 Damage per <fire> you have.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElementsToCombo({[i.Fire]:1});const n=a.elements[i.Fire];a.hasElements({[i.Fire]:4,[i.Air]:2})?await e.splittedDamage({amount:n,lands:a.inLandsWhere((a=>a.has(e.Blight)||a===t)).items,effect:{text:"Split this Power's Damage however desired between target land and any number of your lands with <blight>."}}):await t.damage(n)},threshold:{[i.Plant]:3,[i.Fire]:1}},{text:"Split this Power's Damage however desired between target land and any number of your lands with <blight>.",[r.InTargetLand]:async()=>{},threshold:{[i.Fire]:4,[i.Air]:2}},{text:"In a land with <blight> where you have <presence>, Push all <dahan>. Destroy all Invaders and <beasts>. Add 1 <blight>.",[r.InTargetLand]:async({$:e,you:a})=>{await a.inLandsWith(e.Blight).pickOne((async a=>{e.dontCountAs(p.Beasts),await a.pushAll(e.Dahan),await a.destroyAll(e.Invader),await a.destroyAll(e.Beasts),await a.addBlight(1)}))},threshold:{[i.Fire]:7}}]},Ni={name:"Flames Fury",type:o.Unique,speed:d.Fast,energy:0,elements:[i.Sun,i.Fire,i.Plant],set:s.FeatherAndFlame,target:c.Spirit,effects:[{textArea:[.627,.667],text:"Target Spirit gains 1 Energy.",[r.TargetSpirit]:async({spirit:e})=>{await e.gainEnergy(1)}},{textArea:[.627,.906],text:"Target Spirit does +1 Damage with each Damage dealing Power they use this turn.<br><br>(Powers which Damage multiple lands or each Invader only get 1 extra Damage total. Repeated Powers keep the +1 boost. Destroy effects don't get any bonus.)",[r.TargetSpirit]:async({spirit:e,you:a})=>{await e.gainDamageBoost({amount:1,source:a})}}]},$i={name:"Flash-Fires",type:o.Unique,speed:d.Slow,energy:2,elements:[i.Fire,i.Air],set:s.FeatherAndFlame,target:c.Land,range:1,generatesFear:!0,hasDamageInstructions:!0,mayBeSpeed:{effect:{textArea:[.826,.936],text:"If you have 2 <air>:<br>This Power is <fast>.",[r.Now]:async({action:e})=>{await e.spirit.convertElements({[i.Air]:2})}},condition:({speed:e,spirit:a})=>e===d.Fast&&a.hasElementsWithConvert({[i.Air]:2})},fullText:["1 <fear>.","1 Damage.","If you have 2 <air>:<br>This Power is <fast>."],effects:[{textArea:[.65,.69],text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.696,.736],text:"1 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(1)}}]},Wi={name:"The Burned Land Regrows",type:o.Innate,speed:d.Slow,set:s.FeatherAndFlame,target:c.Land,range:0,blightWhiteListedPower:!0,effects:[{text:"If target land has 2 <blight> or more, remove 1 <blight>.",[r.InTargetLand]:async({$:e,land:a})=>{a.hasAtLeast(2,e.Blight)&&await a.removeBlight()},threshold:{[i.Fire]:4,[i.Plant]:1}},{instead:!0,text:"Instead, remove 1 <blight>.",[r.InTargetLand]:async({land:e})=>{await e.removeBlight()},threshold:{[i.Fire]:4,[i.Plant]:2}},{text:"Remove another <blight>.",[r.InTargetLand]:async({land:e})=>{await e.removeBlight()},threshold:{[i.Fire]:5,[i.Plant]:2,[i.Earth]:2}}]},Mi={name:"Threatening Flames",type:o.Unique,speed:d.Fast,energy:0,elements:[i.Fire,i.Plant],set:s.FeatherAndFlame,target:c.Land,targetFilter:[l.BlightAndInvaders],range:0,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.607,.647],text:"2 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(2)}},{text:"Push 1 <explorer>/<town> per Terror Level from target land to adjacent lands without your <presence>.<br><br>If there are no such adjacent lands, +2 <fear>.",[r.InTargetLand]:async({$:e,land:a,you:t})=>{a.inAdjacentLandsWhere((e=>!e.hasPresenceOf(t))).count>0?await e.addSubEffect({textArea:[.647,.798],text:"Push 1 <explorer>/<town> per Terror Level from target land to adjacent lands without your <presence>.",[r.Now]:async()=>{await a.push({amount:e.terrorLevel,pieces:e.ExplorerOrTown,destinationFilter:e=>!e.hasPresenceOf(t)})}}):await e.addSubEffect({textArea:[.832,.923],text:"If there are no such adjacent lands, +2 <fear>.",[r.Now]:async()=>{await a.fear(2)}})}}]},Gi={name:"Boon Of Watchful Guarding",type:o.Unique,speed:d.Fast,energy:0,elements:[i.Earth,i.Plant,i.Animal],set:s.HorizonsOfSpiritIsland,target:c.Spirit,effects:[{textArea:[.601,.794],text:"In one of Target Spirit's lands, Defend 4.<br><br>Target Spirit may pay 1 Energy to instead Defend 8.",[r.TargetSpirit]:async({$:e,spirit:a})=>{await e.chooseBetween({effects:[{actionId:"Defend",textArea:[.601,.692],text:"In one of Target Spirit's lands, Defend 4.",[r.Now]:async()=>{await a.inLands().pickOne((async e=>{await e.defend(4)}))}},{actionId:"PayEnergy",textArea:[.703,.791],text:"Target Spirit may pay 1 Energy to instead Defend 8.",condition:()=>a.energy>=1,[r.Now]:async()=>{await a.payEnergy(1),await a.inLands().pickOne((async e=>{await e.defend(8)}))}}]})}}]},Hi={name:"Eerie Noises And Moving Trees",type:o.Unique,speed:d.Slow,energy:2,elements:[i.Moon,i.Air,i.Plant],set:s.HorizonsOfSpiritIsland,target:c.Land,range:1,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.71,.75],text:"2 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.798,.838],text:"Push up to 2 <explorer>/<town>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(2,e.ExplorerOrTown)}}]},Ui={name:"Mischief And Sabotage",type:o.Innate,speed:d.Fast,set:s.HorizonsOfSpiritIsland,target:c.Land,sourceFilter:[l.SacredSite],targetFilter:[l.Invaders],range:1,generatesFear:!0,effects:[{text:"1 <fear> and Defend 2.",[r.InTargetLand]:async({land:e})=>{await e.fear(1),await e.defend(2)},threshold:{[i.Moon]:1,[i.Plant]:2}},{instead:!0,text:"Instead, 1 <fear> and Defend 4.",[r.InTargetLand]:async({land:e})=>{await e.fear(1),await e.defend(4)},threshold:{[i.Moon]:2,[i.Plant]:3}},{instead:!0,text:"Instead, 3 <fear> and Defend 6.",[r.InTargetLand]:async({land:e})=>{await e.fear(3),await e.defend(6)},threshold:{[i.Moon]:2,[i.Air]:2,[i.Plant]:4}},{instead:!0,text:"Instead, 5 <fear> and Defend 12.",[r.InTargetLand]:async({land:e})=>{await e.fear(5),await e.defend(12)},threshold:{[i.Moon]:3,[i.Air]:3,[i.Plant]:5}}]},qi={name:"Mysterious Abductions",type:o.Unique,speed:d.Fast,energy:1,elements:[i.Moon,i.Fire,i.Plant],set:s.HorizonsOfSpiritIsland,target:c.Land,range:0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.705,.745],text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.794,.834],text:"1 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(1)}}]},ji={name:"Whispered Guidance Through The Night",type:o.Unique,speed:d.Slow,energy:0,elements:[i.Moon,i.Air,i.Plant],set:s.HorizonsOfSpiritIsland,target:c.Land,sourceFilter:[l.Jungle],range:1,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.682,.722],text:"Gather up to 3 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(3,e.Dahan)}},{textArea:[.762,.855],text:"If Invaders and <dahan> are present, 1 <fear>.",[r.InTargetLand]:async({$:e,land:a})=>{a.hasAllOf(e.Invader,e.Dahan)&&await a.fear(1)}}]},Ji={name:"Call On Herders For Aid",type:o.Unique,speed:d.Slow,energy:1,elements:[i.Sun,i.Fire,i.Earth,i.Animal],set:s.HorizonsOfSpiritIsland,target:c.Land,range:2,hasPushOrGather:!0,effects:[{textArea:[.684,.724],text:"Gather up to 2 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(2,e.Dahan)}},{textArea:[.762,.861],text:"For each <dahan> present, Push up to 1 <explorer>/<town>/<dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(a.numberOf(e.Dahan),e.ExplorerTownOrDahan)}}]},Vi={name:"Gift Of Searing Heat",type:o.Unique,speed:d.Fast,energy:0,elements:[i.Sun,i.Fire,i.Air],set:s.HorizonsOfSpiritIsland,target:c.Spirit,targetFilter:[m.Another],hasDamageInstructions:!0,effects:[{textArea:[.679,.86],text:"Target Spirit gains 2 Energy.<or>Target Spirit may pay 1 Energy to do 1 Damage in one of their lands.",[r.TargetSpirit]:async({$:e,spirit:a})=>{await e.chooseBetween({effects:[{actionId:"GainEnergy",textArea:[.682,.722],text:"Target Spirit gains 2 Energy.",[r.Now]:async()=>{await a.gainEnergy(2)}},{actionId:"Damage",textArea:[.768,.86],text:"Target Spirit may pay 1 Energy to do 1 Damage in one of their lands.",players:[a],condition:()=>a.energy>=1,[r.Now]:async()=>{await a.payEnergy(1),await a.inLands().pickOne((async e=>{await e.damage(1)}))}}]})}}]},Yi={name:"Scorch With Waves Of Heat",type:o.Innate,speed:d.Slow,set:s.HorizonsOfSpiritIsland,target:c.Land,sourceFilter:[l.SacredSite],range:1,hasDamageInstructions:!0,effects:[{text:"2 Damage, to <explorer> only.",[r.InTargetLand]:async({$:e,land:a})=>{await a.damage(2,e.Explorer)},threshold:{[i.Fire]:2,[i.Air]:2}},{text:"2 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(2)},threshold:{[i.Fire]:3,[i.Earth]:2}},{text:"2 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(2)},threshold:{[i.Fire]:4,[i.Air]:1,[i.Earth]:3}},{text:"1 Damage to each Invader.",[r.InTargetLand]:async({land:e})=>{await e.damageEach(1)},threshold:{[i.Fire]:5,[i.Air]:2,[i.Earth]:3}}]},zi={name:"Stinging Sandstorm",type:o.Unique,speed:d.Slow,energy:1,elements:[i.Fire,i.Air,i.Earth],set:s.HorizonsOfSpiritIsland,target:c.Land,range:1,hasPushOrGather:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.605,.645],text:"Gather up to 1 of your <presence>.",[r.InTargetLand]:async({$:e,owner:a,land:t})=>{await t.gather({quantifier:w.UpTo,amount:1,pieces:e.Presence,owner:a})}},{textArea:[.662,.702],text:"1 <fear> and 1 Damage.",[r.InTargetLand]:async({land:e})=>{await e.fear(1),await e.damage(1)}}]},Qi={name:"Sweltering Exhaustion",type:o.Unique,speed:d.Fast,energy:2,elements:[i.Fire,i.Air],set:s.HorizonsOfSpiritIsland,target:c.Land,sourceFilter:[l.SacredSite],range:2,generatesFear:!0,effects:[{textArea:[.709,.749],text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.798,.838],text:"Skip up to 1 Ravage/Build Action.",[r.InTargetLand]:async({land:e})=>{await e.skipInvaderAction({filter:({invaderAction:e})=>e===K.Build||e===K.Ravage})}}]},Ki={name:"Exaltation Of Tangled Growth",type:o.Unique,speed:d.Slow,energy:0,elements:[i.Water,i.Earth,i.Plant],set:s.HorizonsOfSpiritIsland,target:c.Spirit,targetFilter:[m.Another],effects:[{textArea:[.67,.762],text:"Target Spirit may pay 1 Energy to Gain a Power Card.",[r.TargetSpirit]:async({$:e,spirit:a})=>{a.energy>=1&&await e.may({prompt:"Pay 1 Energy to Gain a Power Card?"})&&(await a.payEnergy(1),await a.gainPowerCard())}},{textArea:[.798,.887],text:"You may pay 2 Energy to Gain a Power Card.",[r.TargetSpirit]:async({$:e,you:a})=>{a.energy>=2&&await e.may({prompt:"Pay 2 Energy to Gain a Power Card?"})&&(await a.payEnergy(2),await a.gainPowerCard())}}]},Xi={name:"Foul Vapors And Fetid Muck",type:o.Unique,speed:d.Slow,energy:0,elements:[i.Fire,i.Air,i.Water,i.Earth],set:s.HorizonsOfSpiritIsland,target:c.Land,sourceFilter:[l.SacredSite],targetFilter:[l.Invaders],range:2,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.712,.752],text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.799,.839],text:"Push up to 2 <explorer>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(2,e.Explorer)}}]},_i={name:"Intractable Thickets And Thorns",type:o.Unique,speed:d.Fast,energy:2,elements:[i.Moon,i.Water,i.Earth,i.Plant],set:s.HorizonsOfSpiritIsland,target:c.Land,range:1,generatesFear:!0,effects:[{textArea:[.71,.75],text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.801,.841],text:"Defend 5.",[r.InTargetLand]:async({land:e})=>{await e.defend(5)}}]},Zi={name:"Open Shifting Waterways",type:o.Unique,speed:d.Slow,energy:1,elements:[i.Moon,i.Water,i.Animal],set:s.HorizonsOfSpiritIsland,target:c.Land,range:1,hasPushOrGather:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.679,.719],text:"Gather up to 2 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(2,e.Dahan)}},{textArea:[.758,.854],text:"If <dahan> and Invaders are present, 1 <fear> and 1 Damage.",[r.InTargetLand]:async({$:e,land:a})=>{a.hasAllOf(e.Dahan,e.Invader)&&(await a.fear(1),await a.damage(1))}}]},es={name:"Spreading And Dreadful Mire",type:o.Innate,speed:d.Slow,set:s.HorizonsOfSpiritIsland,target:c.Land,sourceFilter:[l.SacredSite],targetFilter:[l.Invaders],range:1,hasPushOrGather:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{text:"Move 1 <presence> from the origin <sacred> to the target land. (This is required.)",[r.InTargetLand]:async({$:e,owner:a,land:t,power:n})=>{await n.validOriginsGivenTargetLand(t).pickOne((async n=>{await n.move({amount:1,pieces:e.Presence,owner:a,locations:{target:g.ToThisLocation,location:t}})}),{prompt:"Select origin land."})},threshold:{[i.Water]:1}},{text:"1 <fear>. 1 Damage. Push 1 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await e.addSubEffectUntilEndOfTurn({effects:[{text:"1 <fear>",[r.Now]:async()=>{await a.fear(1)}},{text:"1 Damage.",[r.Now]:async()=>{await a.damage(1)}},{text:"Push 1 <dahan>.",[r.Now]:async()=>{await a.pushOne(e.Dahan)}}]})},threshold:{[i.Moon]:1,[i.Water]:2,[i.Earth]:1}},{text:"1 <fear>. 1 Damage. Push 1 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await e.addSubEffectUntilEndOfTurn({effects:[{text:"1 <fear>",[r.Now]:async()=>{await a.fear(1)}},{text:"1 Damage.",[r.Now]:async()=>{await a.damage(1)}},{text:"Push 1 <dahan>.",[r.Now]:async()=>{await a.pushOne(e.Dahan)}}]})},threshold:{[i.Moon]:2,[i.Water]:3,[i.Earth]:2}},{text:"2 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(2)},threshold:{[i.Moon]:3,[i.Water]:4,[i.Earth]:3,[i.Plant]:2}}]},as={name:"Death Approaches From Beneath The Surface",type:o.Innate,speed:d.Slow,set:s.HorizonsOfSpiritIsland,target:c.Land,targetFilter:[l.Invaders],range:1,hasPushOrGather:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{text:"If you don't have <presence> in target land, Gather 1 of your <presence>. (This is required.)",[r.InTargetLand]:async({$:e,owner:a,land:t})=>{t.hasPresenceOf(a)||await t.gather({amount:1,pieces:e.Presence,owner:a})},threshold:{[i.Fire]:1,[i.Animal]:1}},{text:'1 Damage. (+1 for your "Territorial Aggression" Special Rule)',[r.InTargetLand]:async({$:e,land:a})=>{await a.damage(1,e.Invader)},threshold:{[i.Fire]:2,[i.Earth]:1,[i.Animal]:2}},{text:"2 Damage.",[r.InTargetLand]:async({$:e,land:a})=>{await a.damage(2,e.Invader)},threshold:{[i.Fire]:3,[i.Earth]:1,[i.Animal]:3}},{effects:[{text:"2 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(2)}},{text:"4 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(4)}}],threshold:{[i.Fire]:4,[i.Earth]:2,[i.Animal]:5}}]},ts={name:"Ferocious Rampage",type:o.Unique,speed:d.Slow,energy:2,elements:[i.Fire,i.Animal],set:s.HorizonsOfSpiritIsland,target:c.Land,range:0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.637,.677],text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.726,.766],text:"3 Damage to <explorer>/<town> only.",[r.InTargetLand]:async({$:e,land:a})=>{await a.damage(3,e.ExplorerOrTown)}}]},ns={name:"Gift Of Furious Might",type:o.Unique,speed:d.Fast,energy:1,elements:[i.Moon,i.Fire,i.Animal],set:s.HorizonsOfSpiritIsland,target:c.Spirit,targetFilter:[m.Another],effects:[{textArea:[.621,.756],text:"Once this turn, Target Spirit may deal +3 Damage when using a Damage-dealing Power.",[r.TargetSpirit]:async({spirit:e,you:a})=>{await e.gainDamageBoost({amount:3,source:a,once:!0})}}]},rs={name:"Herd Towards The Lurking Maw",type:o.Unique,speed:d.Slow,energy:1,elements:[i.Water,i.Earth,i.Animal],set:s.HorizonsOfSpiritIsland,target:c.Land,range:0,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.71,.75],text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.796,.836],text:"Gather up to 1 <explorer>/<town>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(1,e.ExplorerOrTown)}}]},is={name:"Mark Territory With Scars And Teeth",type:o.Unique,speed:d.Fast,energy:2,elements:[i.Sun,i.Earth,i.Animal],set:s.HorizonsOfSpiritIsland,target:c.Land,range:0,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.664,.704],text:"Defend 9.",[r.InTargetLand]:async({land:e})=>{await e.defend(9)}},{textArea:[.753,.793],text:"2 <fear> if Invaders are present.",[r.InTargetLand]:async({land:e})=>{e.hasInvaders&&await e.fear(2)}},{textArea:[.837,.877],text:"Push 2 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.push({amount:2,pieces:e.Dahan})}}]},ss={name:"Gift Of The Sunlit Air",type:o.Unique,speed:d.Fast,energy:0,elements:[i.Sun,i.Fire,i.Air],set:s.HorizonsOfSpiritIsland,target:c.Spirit,effects:[{textArea:[.638,.745],text:"Target Spirit gets <range+1> with all their Powers.",[r.TargetSpirit]:async({$:e,you:a,spirit:t})=>{await e.addSubEffectUntilEndOfTurn({[r.GlobalReminder]:()=>({icon:"<range+1>",spirit:a,players:[t]}),[r.ExtraRange]:e=>e.spirit===t?1:0})}},{textArea:[.779,.877],text:"If you target another Spirit they gain 1 Energy.",[r.TargetSpirit]:async({you:e,spirit:a})=>{a!==e&&await a.gainEnergy(1)}}]},os={name:"Gift Of Wind-Sped Steps",type:o.Unique,speed:d.Fast,energy:1,elements:[i.Sun,i.Air,i.Animal],set:s.HorizonsOfSpiritIsland,target:c.Spirit,hasPushOrGather:!0,effects:[{textArea:[.64,.778],text:'Once this turn, Target Spirit may choose 1 of their <slow> Powers with a "Push" or "Gather" instruction and make that Power <fast> (for this turn).',[r.TargetSpirit]:async({spirit:e})=>{await e.gainMakeFastBuff({filter:e=>!0===e.data.hasPushOrGather})}},{textArea:[.815,.91],text:"If you target another Spirit, they gain 1 Energy.",[r.TargetSpirit]:async({you:e,spirit:a})=>{a!==e&&await a.gainEnergy(1)}}]},ds={name:"Scatter To The Winds",type:o.Unique,speed:d.Slow,energy:1,elements:[i.Fire,i.Air,i.Water],set:s.HorizonsOfSpiritIsland,target:c.Land,range:2,hasPushOrGather:!0,effects:[{textArea:[.693,.842],text:"Choose up to 5 <explorer>/<town>/<dahan>.<br>Push them to as many different lands as possible.",[r.InTargetLand]:async({$:e,land:a})=>{await a.push({amount:5,pieces:e.ExplorerTownOrDahan,quantifier:w.UpTo,differentLands:!0})}}]},cs={name:"Tempest Of Leaves And Branches",type:o.Unique,speed:d.Fast,energy:2,elements:[i.Sun,i.Air,i.Plant],set:s.HorizonsOfSpiritIsland,target:c.Land,sourceFilter:[l.SacredSite],range:1,hasDamageInstructions:!0,effects:[{textArea:[.679,.863],text:"Choose up to 5 different Invaders (in target land).<br><br>1 Damage to each of them.",[r.InTargetLand]:async({land:e})=>{await e.damageDifferent(5)}}]},ls={name:"Violent Windstorms",type:o.Innate,speed:d.Slow,set:s.HorizonsOfSpiritIsland,target:c.Land,range:1,hasPushOrGather:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{text:"Push up to 1 <explorer>.",[r.InTargetLand]:async({$:e,land:a,action:t})=>{t.data.moved=await a.pushUpTo(1,e.Explorer)},threshold:{[i.Sun]:1,[i.Air]:2}},{effects:[{text:"1 <fear>. Push up to 2 <explorer>/<town>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{text:"Push up to 2 <explorer>/<town>.",[r.InTargetLand]:async({$:e,land:a,action:t})=>{t.data.moved.push(...await a.pushUpTo(2,e.ExplorerOrTown))}}],threshold:{[i.Sun]:2,[i.Air]:3}},{text:"For each Invader Pushed by this Power, 1 Damage in the land it was Pushed to.",[r.InTargetLand]:async({action:e})=>{if(e.data.moved.length>0){const a=W(e.data.moved.map((e=>e.destination)));for(const t of a){const a=e.data.moved.filter((e=>e.destination===t&&e.piece.isInvader&&e.movement===q.Push)).length;await t.damage(a)}}},threshold:{[i.Sun]:2,[i.Air]:4}},{text:"4 Damage (in target land).",[r.InTargetLand]:async({land:e})=>{await e.damage(4)},threshold:{[i.Sun]:3,[i.Air]:5}}]},hs={name:"Absolute Stasis",type:o.Unique,speed:d.Fast,energy:1,elements:[i.Sun,i.Air,i.Earth],set:s.JaggedEarth,target:c.Land,sourceFilter:[l.SacredSite],targetFilter:[l.NonOceanLand],range:2,mayUse:({spirit:e})=>e.time>=1,effects:[{textArea:[.601,.641],text:"Cost to use: 1 Time.",[r.InTargetLand]:async({you:e})=>{await e.spendTime(1)}},{textArea:[.644,.921],text:"Until the end of the <slow> phase, target land and everything in it cease to exist for all purposes except checking victory/defeat.<br><br>(You cannot target into, out of, or through where the land was.) This cannot target an Ocean even if Oceans are in play.",[r.InTargetLand]:async({$:e,...a})=>{a.land.exists=!1,await e.addSubEffectUntilEndOfTurn({[r.Reminder]:e=>e===a.land?a.effect.text:void 0,[r.AfterSlowPhase]:()=>(e.removeThisEffect(),a.land.exists=!0,e.setupAdjacencies(),Promise.resolve())}),e.setupAdjacencies()}}]},gs={name:"Blur The Arc Of Years",type:o.Unique,speed:d.Fast,energy:1,elements:[i.Sun,i.Moon,i.Air],set:s.JaggedEarth,target:c.Land,range:1,hasPushOrGather:!0,blightWhiteListedPower:!0,effects:[{textArea:[.59,.676],text:"If no <dahan>/Invaders are present: Remove 1 <blight>.",[r.InTargetLand]:async({$:e,land:a})=>{a.dontHaveAnyOf(e.Dahan,e.Invader)&&await a.removeBlight()}},{textArea:[.684,.761],text:"If Invaders are present: they Build, then Ravage.",[r.InTargetLand]:async({land:e})=>{e.hasInvaders&&(await e.doExtraBuild(),await e.doExtraRavage())}},{textArea:[.768,.854],text:"If <dahan> are present: Add 1 <dahan>. Push up to 2 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{a.has(e.Dahan)&&(await a.add(1,e.Dahan),await a.pushUpTo(2,e.Dahan))}},{textArea:[.863,.939],text:"You may Repeat this Power (once) on the same land by spending 1 Time.",[r.InTargetLand]:async({$:e,power:a,land:t,you:n,isRepeat:r})=>{!r&&n.time>=1&&await e.may({prompt:"Spend 1 Time to Repeat this Power?"})&&(await n.spendTime(1),await a.repeatInLocations([t]))}}]},fs={name:"Pour Time Sideways",type:o.Unique,speed:d.Fast,energy:1,elements:[i.Moon,i.Air,i.Water],set:s.JaggedEarth,target:c.Spirit,targetFilter:[m.Yourself],mayUse:({spirit:e})=>e.time>=3,effects:[{textArea:[.602,.642],text:"Cost to Use: 3 Time.",[r.TargetSpirit]:async({you:e})=>{await e.spendTime(3)}},{textArea:[.643,.94],text:'Move 1 of your <presence> to a different land with your <presence>.<br><br>On the board moved from: During the Invader Phase, Resolve Invader and "Each board / Each land..." Actions one fewer time.<br><br>On the board moved to: During the Invader Phase, Resolve Invader and "Each board / Each land..." Actions one more time.',[r.TargetSpirit]:async({$:e,power:a,spirit:t})=>{await t.presence().pickOne((async n=>{const i=n.location;await t.inLandsWhere((e=>e!==i)).pickOne((async n=>{await i.move({pieces:e.Presence,owner:t,locations:{target:g.ToThisLocation,location:n}}),await i.boards().pickOne((async t=>{await n.boards().pickOne((async n=>{t!==n&&await e.addSubEffectUntilEndOfTurn({[r.GlobalReminder]:()=>({textArea:[.722,.937],text:`On board ${t.name}: During the Invader Phase, Resolve Invader and "Each board / Each land..." Actions one fewer time.<br><br>On board ${n.name}: During the Invader Phase, Resolve Invader and "Each board / Each land..." Actions one more time.`,power:a.power}),[r.AdjustNumberOfActions]:({land:a,board:r})=>{let i=0;return![Xe.BlightedIsland,Xe.Event,Xe.Fear,Xe.HighImmigration,Xe.Ravage,Xe.Build,Xe.Explore].includes(e.phase)||void 0===a&&void 0===r||((void 0!==a&&a.boards().has(t)||r===t)&&(i-=1),(void 0!==a&&a.boards().has(n)||r===n)&&(i+=1)),i}})}))}))}))}))}}]},us={name:"Slip The Flow Of Time",type:o.Innate,speed:d.Fast,set:s.JaggedEarth,target:c.Spirit,mayUse:({power:e,spirit:a})=>a.time>=e.costTime,effects:[{text:"You may use this Power any number of times. Cost to use: 1 Time per previous use this turn.",[r.TargetSpirit]:async({power:e,you:a})=>{await a.spendTime(e.costTime)}},{text:"Target Spirit may Resolve 1 <slow> Power now.",[r.TargetSpirit]:async({spirit:e})=>{await e.powersWhere((e=>e.isA(ye.Any)&&e.status===Kn.PlayedSlow)).optionallyPickOne((async a=>{await e.targetAndResolvePower(a)}))},threshold:{[i.Moon]:3,[i.Air]:1}},{text:"Target Spirit may Reclaim 1 Power Card from their discarded or played cards. (If they Reclaim a card from play, they lose its Elements.)",[r.TargetSpirit]:async({spirit:e})=>{await e.powersWhere((e=>e.isA(ye.AnyCard)&&!e.isInHand)).optionallyPickOne((async e=>{await e.reclaim()}))},threshold:{[i.Sun]:2,[i.Moon]:2}},{text:"Target Spirit may play a Power Card by paying its cost.",[r.TargetSpirit]:async({spirit:e})=>{await e.playAPowerCardByPayingItsCost()},threshold:{[i.Sun]:3,[i.Air]:2}},{[r.TargetSpirit]:async({$:e,power:a})=>{await e.addEffectUntilEndOfAction({[r.ActionEnds]:async()=>{await a.setStatus(Kn.PlayedFast),await e.addEffectUntilEndOfTurn({[r.PowerCostExtraTime]:e=>e.power===a?1:0})}})}}]};var ps;!function(e){e.Discard="Discard",e.HighImmigration="HighImmigration",e.Ravage="Ravage",e.Build="Build",e.Explore="Explore",e.Deck="Deck"}(ps||(ps={}));const ws={name:"The Past Returns Again",type:o.Unique,speed:d.Fast,energy:0,elements:[i.Sun,i.Moon],set:s.JaggedEarth,target:c.Spirit,targetFilter:[m.Yourself],mayUse:({$:e,spirit:a})=>e.playersCanJointlyPayEnergyAidedBy({energy:e.spiritCount})&&a.time>=e.spiritCount,effects:[{textArea:[.608,.684],text:"Cost to Use: N Time, and Spirits jointly pay N Energy (where N = # of players).",[r.TargetSpirit]:async({$:e,spirit:a})=>{await a.spendTime(e.spiritCount),await e.payEnergyJointlyAidedBy({energy:e.spiritCount})}},{textArea:[.692,.913],text:"Swap the top card of the Invader Deck with a card in the Invader discard that is within 1 Invader Stage of it.<br>(The discarded card stays face-down. The card going onto the deck turns face-down. You can't swap cards that don't exist.)",[r.TargetSpirit]:async({$:e})=>{const a=e.invaderDeckInSlot(ps.Discard),t=e.stageNumbersInSlot(ps.Discard),n=[1,2,3].filter((a=>Math.abs(e.stage-a)<=1));e.invaderCardsInExploreDeck.length>0&&await e.chooseBetween({text:"Choose card from discard to swap.",effects:a.cards.map(((i,s)=>({actionId:null!==i?i:`Stage${t[s]}Card`,label:null!==i?`${_t[i].text}`:`Stage ${t[s]} Card`,[r.Now]:async()=>{const t=e.invaderDeckInSlot(ps.Discard).possibleCardsAt(s);a.removeCard(s);const n=e.actualExploreCardIndex(0),r=e.exploreDeck.possibleCardsAt(n);await e.removeInvaderCard(0,{swapping:!0}),e.invaderDeckInSlot(ps.Discard).insertAtBottomOneOf(r),await e.addExploreCardToTop(t,n)},condition:()=>n.includes(t[s])})))})}}]},ys={name:"Visions Of A Shifting Future",type:o.Innate,speed:d.Slow,set:s.JaggedEarth,target:c.Spirit,targetFilter:[m.Yourself],fullText:["Threshold 1 <sun> 2 <moon> 2 <air>","Look at the top card of either the Invader Deck or (if relevant) the Event Deck.","Return it, then shuffle that deck's top 2 cards. (For the Invader Deck, differing Invader Stages may give away which card is next.)","Threshold 2 <sun> 3 <moon> 2 <air>","Instead of returning-and-shuffling, you may put the card you looked at on the bottom of its deck. You may not do this for cards specially placed during Setup."],effects:[{effects:[{text:"Look at the top card of either the Invader Deck or (if relevant) the Event Deck.",[r.TargetSpirit]:async({$:e,you:a})=>{const t={[i.Sun]:2,[i.Moon]:3,[i.Air]:2},n=a.hasElementsWithConvert(t);await e.chooseBetween({effects:[{actionId:"Invader",text:"Look at the top card of the Invader Deck.",[r.Now]:async()=>{null!==await e.revealTopInvaderCard()&&await e.chooseBetween({text:"Return it, then shuffle that deck's top 2 cards. (For the Invader Deck, differing Invader Stages may give away which card is next.)<br><br>If you have 2 <sun>, 3 <moon>, and 2 <air>: Instead of returning-and-shuffling, you may put the card you looked at on the bottom of its deck. You may not do this for cards specially placed during Setup.",effects:[{actionId:"ReturnAndShuffle",text:"Return it, then shuffle that deck's top 2 cards.",[r.Now]:async()=>{await e.shuffleTopTwoInvaderCards()}},{actionId:"PutOnBottom",label:"Put the card on the bottom of its deck",text:"Instead of returning-and-shuffling, you may put the card you looked at on the bottom of its deck. You may not do this for cards specially placed during Setup.",condition:()=>n&&!e.invaderCardAtIndexIsSpecial(0),[r.Now]:async()=>{await a.convertElements(t),await e.putTopInvaderCardToBottom()}}]})},condition:()=>e.invaderCardsInExploreDeck.length>0},{actionId:"Event",text:"Look at the top card of the Event Deck.",condition:()=>!!e.config.events&&!e.eventCardsInDeck.isEmpty,[r.Now]:async()=>{await e.revealTopEventCard(),await e.chooseBetween({effects:[{actionId:"ReturnAndShuffle",text:"Return it, then shuffle that deck's top 2 cards.",[r.Now]:async()=>{await e.shuffleTopTwoEventCards()}},{actionId:"PutOnBottom",label:"Put the card on the bottom of its deck",text:"Instead of returning-and-shuffling, you may put the card you looked at on the bottom of its deck. You may not do this for cards specially placed during Setup.",condition:()=>n&&!e.eventCardAtIndexIsSpecial(0),[r.Now]:async()=>{await a.convertElements(t),e.putTopEventCardToBottom()}}]})}}]})}}],threshold:{[i.Sun]:1,[i.Moon]:2,[i.Air]:2}},{threshold:{[i.Sun]:2,[i.Moon]:3,[i.Air]:2},[r.TargetSpirit]:async()=>{}}]},ms={name:"Forsake Society To Chase After Dreams",type:o.Innate,speed:d.Slow,set:s.JaggedEarth,target:c.Land,targetFilter:[l.Invaders],range:1,hasPushOrGather:!0,generatesFear:!0,effects:[{text:"After this Power Replaces pieces with <explorer>: Gather any number of those <explorer> into your lands. If target land has any <town>/<city> remaining, 1 <fear>.",[r.InTargetLand]:async({$:e,you:a,land:t,power:n,...i})=>{const s={triggerId:e.nextTriggerId(),[r.Now]:async({action:n})=>{await t.piecesWhere((e=>n.parentData.replacedExplorer.includes(e))).pickMultiple({optional:!0,repeatSame:!1,amount:n.parentData.replacedExplorer.length,forPickedItem:async e=>{await e.move({destinationFilter:e=>e.hasPresenceOf(a),movement:q.Gather})}}),t.has(e.TownOrCity)&&(await e.sendEvent({type:T.GenericSub,text:"Target land had <town>/<city> remaining."}),await t.fear(1))}};await e.addSubEffectUntilEndOfAction({[r.AfterReplacePieces]:async({added:a})=>{if(e.action.power===n)for(const{piece:n,location:r}of a)r===t&&n.isA(e.Explorer)&&(void 0===e.action.data.replacedExplorer&&(e.action.data.replacedExplorer=[]),e.action.data.replacedExplorer.push(n),await e.addTrigger(s,i.effect,i.action))}})}},{text:"Replace 1 <explorer> with 1 <explorer>",[r.InTargetLand]:async({$:e,land:a})=>{await a.replaceOne({pieces:e.Explorer,withPiece:p.Explorer})},threshold:{[i.Moon]:2}},{instead:!0,text:"Instead, Replace 1 <town> with 2 <explorer>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.replaceOne({pieces:e.Town,withAmount:2,withPiece:p.Explorer})},threshold:{[i.Moon]:2,[i.Air]:1}},{instead:!0,text:"Instead, Replace 1 <city> with 3 <explorer>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.replaceOne({pieces:e.City,withAmount:3,withPiece:p.Explorer})},threshold:{[i.Moon]:3,[i.Air]:2,[i.Animal]:1}},{text:"Repeat this Power.",[r.InTargetLand]:async({power:e,isRepeat:a})=>{a||await e.repeat()},threshold:{[i.Air]:4},dontResolveAlone:!0}]},vs={name:"Gift Of The Untamed Wild",type:o.Unique,speed:d.Slow,energy:0,elements:[i.Moon,i.Fire,i.Air,i.Plant],set:s.JaggedEarth,target:c.Spirit,effects:[{textArea:[.647,.855],text:"Target Spirit chooses to either:<br><br>Add 1 <wilds> to one of their lands.<or>Replace 1 of their <presence> with 1 <disease>.",[r.TargetSpirit]:async({$:e,spirit:a})=>{await e.chooseBetween({effects:[{actionId:"AddWilds",textArea:[.715,.755],text:"Add 1 <wilds> to one of their lands.",[r.Now]:async()=>{await a.inLands().pickOne((async a=>{await a.add(1,e.Wilds)}))}},{actionId:"Replace",textArea:[.802,.842],text:"Replace 1 of their <presence> with 1 <disease>.",[r.Now]:async()=>{await a.presence().pickOne((async e=>{await e.replace([p.Disease])}))}}]})}}]},Is={name:"Never Heard From Again",type:o.Innate,speed:d.Slow,set:s.JaggedEarth,target:c.Land,targetFilter:[l.Inland],range:0,generatesFear:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,fullText:["If this Power Destroys any <explorer>, 1 <fear>.","If this Power Destroys 5 or more <explorer>, +1 <fear>.","Threshold 1 <fire> 3 <plant>","Add 1 <badlands>.","Threshold 2 <plant>","Destroy up to 2 <explorer> per <badlands>/<beasts>/<disease>/<wilds>","Threshold 4 <plant> 1 <animal>","2 Damage.","Threshold 6 <plant>","Repeat this Power."],effects:[{text:"Add 1 <badlands>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Badlands)},threshold:{[i.Fire]:1,[i.Plant]:3}},{text:"Destroy up to 2 <explorer> per <badlands>/<beasts>/<disease>/<wilds>",[r.InTargetLand]:async({$:e,land:a,action:t})=>{t.data.removed=await a.destroyUpTo(2*(a.numberOf(e.Badlands)+a.numberOf(e.Beasts)+a.numberOf(e.Disease)+a.numberOf(e.Wilds)),e.Explorer)},threshold:{[i.Plant]:2}},{text:"2 Damage.",[r.InTargetLand]:async({land:e,action:a})=>{a.data.removed.push(...await e.damage(2))},threshold:{[i.Plant]:4,[i.Animal]:1}},{text:"If this Power Destroys any <explorer>, 1 <fear>.<br>If this Power Destroys 5 or more <explorer>, +1 <fear>.",[r.InTargetLand]:async({$:e,action:a,land:t})=>{const n=a.data.removed.filter((a=>a.piece.isA(e.Explorer)&&x[a.removement].isDestroyLike)).length;n>0&&n<5?(await e.sendEvent({type:T.GenericSub,text:"Never Heard From Again Destroyed at least one <explorer>."}),await t.fear(1)):n>=5&&(await e.sendEvent({type:T.GenericSub,text:"Never Heard From Again Destroyed at least 5 <explorer>."}),await t.fear(2))}},{text:"Repeat this Power.",[r.InTargetLand]:async({power:e,isRepeat:a})=>{a||await e.repeat()},threshold:{[i.Plant]:6}}]},As={name:"Perils Of The Deepest Island",type:o.Unique,speed:d.Slow,energy:1,elements:[i.Moon,i.Plant,i.Animal],set:s.JaggedEarth,target:c.Land,targetFilter:[l.Inland],range:0,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.679,.719],text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.679,.719],text:"Add 1 <badlands>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Badlands)}},{textArea:[.722,.762],text:"Add 1 <beasts> within <range-1>.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await t.inLandsWithin(1,a).pickOne((async a=>{await a.add(1,e.Beasts)}))}},{textArea:[.802,.842],text:"Push up to 2 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(2,e.Dahan)}}]},xs={name:"Society Dissolves At The Beckoning Heart",type:o.Innate,speed:d.Fast,set:s.NatureIncarnate,target:c.Land,targetFilter:[l.IncarnaLair],hasPushOrGather:!0,effects:[{textArea:[.271,.401],text:"For every 3 <explorer>/<dahan>, Downgrade a different <town>/<city>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.downgrade({amount:a.forEvery(3,e.ExplorerOrDahan),pieces:e.TownOrCity,different:!0})},threshold:{[i.Moon]:1}},{textArea:[.436,.492],text:"Gather 1 <explorer>/<town> and 1 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherOne(e.ExplorerOrTown),await a.gatherOne(e.Dahan)},threshold:{[i.Moon]:3,[i.Air]:1}},{textArea:[.543,.712],text:"Once for every 6 <explorer>/<dahan> present (at <incarna-lair>): Gather any Invader within <range-air> one land towards <incarna-lair>.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElementsToCombo({[i.Air]:1}),await t.forPiecesWithin(a.elements[i.Air],a).where((e=>e.location!==t&&e.isInvader)).pickMultiple({amount:t.forEvery(6,e.ExplorerOrDahan),forPickedItem:async e=>{await e.location.inAdjacentLands().withLeast((e=>e.distanceToLocation(t))).where((a=>a.distanceToLocation(t)<e.location.distanceToLocation(t))).pickOne((async a=>{await e.move({locations:{target:g.ToThisLocation,location:a},movement:q.Gather})}),{prompt:`Pick land to Gather ${ee[e.piece].text}`,highlightPieces:[e]})}})},threshold:{[i.Moon]:4,[i.Air]:1}}]},bs={name:"Softly Beckon Ever Inward",type:o.Unique,speed:d.Slow,energy:2,elements:[i.Moon,i.Air],set:s.JaggedEarth,target:c.Land,targetFilter:[l.Inland],range:0,hasPushOrGather:!0,effects:[{textArea:[.657,.697],text:"Gather up to 2 <explorer>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(2,e.Explorer)}},{textArea:[.716,.756],text:"Gather up to 2 <town>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(2,e.Town)}},{textArea:[.779,.819],text:"Gather up to 2 <beasts>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(2,e.Beasts)}},{textArea:[.84,.88],text:"Gather up to 2 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(2,e.Dahan)}}]},Ts={name:"Swallowed By The Wilderness",type:o.Unique,speed:d.Fast,energy:1,elements:[i.Fire,i.Air,i.Plant,i.Animal],set:s.JaggedEarth,target:c.Land,targetFilter:[l.Inland],range:0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.687,.727],text:"2 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.742,.837],text:"1 Damage per <beasts>/<disease>/<wilds>/<badlands>. (Count max. 5 tokens.)",[r.InTargetLand]:async({$:e,land:a})=>{await a.damage(Math.min(a.numberOf(e.Badlands)+a.numberOf(e.Beasts)+a.numberOf(e.Disease)+a.numberOf(e.Wilds),5))}}]},Es={name:"A Dreadful Tide Of Scurrying Flesh",type:o.Unique,speed:d.Fast,energy:0,elements:[i.Moon,i.Air,i.Water,i.Animal],set:s.JaggedEarth,target:c.Land,sourceFilter:[l.SacredSite],targetFilter:[l.TwoBeasts],range:1,generatesFear:!0,effects:[{textArea:[.664,.867],text:"Remove up to half (round down) of <beasts> in target land.<br><br>For each <beasts> Removed, 2 <fear> and skip one Invader Action.",[r.InTargetLand]:async({$:e,land:a})=>{const t=(await a.remove({quantifier:w.UpTo,amount:Math.floor(a.numberOf(e.Beasts)/2),pieces:e.Beasts})).length;await a.fear(2*t),await a.skipInvaderAction({textArea:[.819,.859],amount:t})}}]},Ps={name:"Beset And Confound The Invaders",type:o.Innate,speed:d.Fast,set:s.JaggedEarth,target:c.Land,targetFilter:[l.TwoBeastsAndInvaders],range:2,generatesFear:!0,fullText:["<beasts> (below) checks the number of <beasts> in target land.","Threshold 1 <air> 2 <animal> 2 <beasts>","2 <fear> and Defend 2","Threshold 2 <air> 3 <animal> 3 <beasts>","Instead, 3 <fear> and Defend 4.","Threshold 3 <air> 4 <animal> 4 <beasts>","Instead, 4 <fear> and Defend 7.","Threshold 4 <air> 1 <earth> 5 <animal> 5 <beasts>","Instead, 6 <fear> and Defend 10."],effects:[{text:"<beasts> (below) checks the number of <beasts> in target land.<br><br>2 <beasts>: 2 <fear> and Defend 2",[r.InTargetLand]:async({land:e})=>{await e.fear(2),await e.defend(2)},threshold:{[i.Air]:1,[i.Animal]:2},targetLandThresholdCondition:e=>e.numberOf(Z.Beasts)>=2},{instead:!0,text:"3 <beasts>: Instead, 3 <fear> and Defend 4.",[r.InTargetLand]:async({land:e})=>{await e.fear(3),await e.defend(4)},threshold:{[i.Air]:2,[i.Animal]:3},targetLandThresholdCondition:e=>e.numberOf(Z.Beasts)>=3},{instead:!0,text:"4 <beasts>: Instead, 4 <fear> and Defend 7.",[r.InTargetLand]:async({land:e})=>{await e.fear(4),await e.defend(7)},threshold:{[i.Air]:3,[i.Animal]:4},targetLandThresholdCondition:e=>e.numberOf(Z.Beasts)>=4},{instead:!0,text:"6 <beasts>: Instead, 6 <fear> and Defend 10.",[r.InTargetLand]:async({land:e})=>{await e.fear(6),await e.defend(10)},threshold:{[i.Air]:4,[i.Earth]:1,[i.Animal]:5},targetLandThresholdCondition:e=>e.numberOf(Z.Beasts)>=5}]},Ss={name:"Boon Of Swarming Bedevilment",type:o.Unique,speed:d.Fast,energy:0,elements:[i.Air,i.Water,i.Animal],set:s.JaggedEarth,target:c.Spirit,targetFilter:[m.Another],hasPushOrGather:!0,effects:[{textArea:[.653,.785],text:"For the rest of this turn, each of target Spirit's <presence> grants Defend 1 in its land.",[r.TargetSpirit]:async({$:e,power:a,spirit:t})=>{await e.addEffectUntilEndOfTurn({[r.GlobalReminder]:()=>({icon:"Defend<br><presence",power:a.power,players:[t]}),[r.DefendFromSpirits]:({land:e})=>e.numberOfPresenceOf(t)})}},{textArea:[.802,.888],text:"Target Spirit may Push up to 1 of their <presence>.",[r.TargetSpirit]:({spirit:e})=>e.presence().optionallyPickOne((async e=>{await e.push()}))}]},Os={name:"Ever-Multiplying Swarm",type:o.Unique,speed:d.Slow,energy:1,elements:[i.Fire,i.Earth,i.Animal],set:s.JaggedEarth,target:c.Land,range:0,effects:[{textArea:[.743,.783],text:"Add 2 <beasts>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.add(2,e.Beasts)}}]},Cs={name:"Guide The Way On Feathered Wings",type:o.Unique,speed:d.Fast,energy:0,elements:[i.Sun,i.Air,i.Animal],set:s.JaggedEarth,target:c.Land,range:1,effects:[{textArea:[.646,.886],text:"Move 1 <beasts> up to two lands. As it moves, up to 2 <dahan> may move with it, for part or all of the way.<br><br>The <beasts>/<dahan> may move to an adjacent land and then back.)",[r.InTargetLand]:async({$:e,land:a})=>{const t=await a.move({pieces:e.Beasts});if(t.length>0){const n=t[0].destination;await a.move({quantifier:w.UpTo,amount:2,pieces:e.Dahan,locations:{target:g.ToThisLocation,location:n}});const r=await n.move({pieces:e.Beasts});if(r.length>0){const a=r[0].destination;await n.move({quantifier:w.UpTo,amount:2,pieces:e.Dahan,locations:{target:g.ToThisLocation,location:a}})}}}}]},Ds={name:"Pursue With Scratches Pecks And Stings",type:o.Unique,speed:d.Fast,energy:0,elements:[i.Sun,i.Fire,i.Air,i.Animal],set:s.JaggedEarth,target:c.Land,targetFilter:[l.Beasts],range:2,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.677,.717],text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.732,.831],text:"For each <beasts> past the first, Push 1 <explorer>/<town>.",[r.InTargetLand]:async({$:e,land:a})=>{a.has(e.Beasts)&&(await a.possiblyDontCountPiecesAs(p.Beasts),await a.push({amount:Math.max(a.numberOf(e.Beasts)-1,0),pieces:e.ExplorerOrTown}))}}]},Bs={name:"The Teeming Host Arrives",type:o.Innate,speed:d.Fast,set:s.JaggedEarth,target:c.Land,range:2,hasPushOrGather:!0,effects:[{text:"Gather up to 1 <beasts>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(1,e.Beasts)},threshold:{[i.Air]:2,[i.Animal]:1}},{instead:!0,text:"Instead, Gather up to 1 <beasts> per <air> you have.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElementsToCombo({[i.Air]:1}),await t.gatherUpTo(a.elements[i.Air],e.Beasts)},threshold:{[i.Air]:3,[i.Water]:1,[i.Animal]:2}},{text:"Push up to 3 <beasts>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(3,e.Beasts)},threshold:{[i.Fire]:1,[i.Air]:4,[i.Animal]:2}}]},ks={name:"Boon Of Ancient Memories",type:o.Unique,speed:d.Slow,energy:1,elements:[i.Moon,i.Water,i.Earth,i.Plant],set:s.JaggedEarth,target:c.Spirit,effects:[{textArea:[.618,.907],text:"If you target yourself, gain a Minor Power. Otherwise: Target Spirit gains a Power Card. If it's a Major Power, they may pay 2 Energy instead of Forgetting a Power Card.",[r.TargetSpirit]:async({$:e,you:a,spirit:t})=>{t===a?await t.gainPowerCard({powerType:o.Minor}):await e.chooseBetween({effects:[{actionId:"MinorPower",textArea:[.723,.817],text:"Gain a Minor Power",[r.Now]:async()=>{await t.gainPowerCard({powerType:o.Minor})}},{actionId:"MajorPower",textArea:[.723,.817],text:"Gain a Major Power",[r.Now]:async()=>{await t.gainPowerCard({powerType:o.Major})}},{actionId:"PayEnergy",textArea:[.814,.906],text:"Pay 2 Energy to Gain a Major Power without Forgetting a Power Card.",[r.Now]:async()=>{await t.payEnergy(2),await t.gainPowerCard({powerType:o.Major,withoutForgetting:!0})},condition:()=>t.energy>=2}]})}}]},Ls={name:"Elemental Teachings",type:o.Unique,speed:d.Fast,energy:0,elements:[i.Moon,i.Air,i.Earth],set:s.JaggedEarth,target:c.Spirit,effects:[{textArea:[.64,.68],text:"Prepare 1 Element Marker.",[r.TargetSpirit]:async({you:e})=>{await e.prepareElement()}},{textArea:[.699,.897],text:"Discard up to 3 Element Markers. Target Spirit gains those Elements. (They can be any combination of Elements - the same or different.)",[r.TargetSpirit]:async({you:e,spirit:a})=>{const t=await e.discardElements(3,{optional:!0});await a.gainElementsUntilEndOfTurn(t)}}]},Fs={name:"Learn The Invaders Tactics",type:o.Innate,speed:d.Fast,set:s.JaggedEarth,target:c.Land,targetFilter:[l.Invaders],range:1,effects:[{text:"Defend 2",[r.InTargetLand]:async({land:e})=>{await e.defend(2)},threshold:{[i.Earth]:2}},{instead:!0,text:"Instead, Defend 3",[r.InTargetLand]:async({land:e})=>{await e.defend(3)},threshold:{[i.Air]:1,[i.Earth]:2}},{instead:!0,text:"Instead, Defend 2 per card in the Invader discard pile.",[r.InTargetLand]:async({$:e,land:a})=>{await a.defend(Math.max(e.invaderCardsInSlot(ps.Discard).length))},threshold:{[i.Moon]:2,[i.Air]:3,[i.Earth]:4}}]},Rs={name:"Observe The Ever Changing World",type:o.Innate,speed:d.Fast,set:s.JaggedEarth,target:c.Land,range:1,effects:[{text:"Prepare 1 Element Marker.",[r.InTargetLand]:async({you:e})=>{await e.prepareElement()},threshold:{[i.Moon]:1}},{instead:!0,text:"After each of the next three Actions that change which pieces are in target land, Prepare 1 Element Marker.",[r.InTargetLand]:async({$:e,you:a,land:t,...n})=>{let i=0;const s={triggerId:e.nextTriggerId(),[r.Now]:async()=>{i<3&&(await a.prepareElement(),i+=1)}};await e.addSubEffectUntilEndOfTurn({[r.Reminder]:e=>e===t?`${n.effect.text}<br><br>(${3-i} left.)`:void 0,[r.AfterAddingPiece]:async a=>{a.land===t&&a.additions.length>0&&await e.addTrigger(s,n.effect,n.action)},[r.AfterRemovePiece]:async a=>{a.location===t&&await e.addTrigger(s,n.effect,n.action)},[r.AfterAddingStrife]:async({piece:a})=>{a.location===t&&await e.addTrigger(s,n.effect,n.action)},[r.AfterMoving]:async a=>{a.source!==t&&a.destination!==t||a.movement===q.Relocate||await e.addTrigger(s,n.effect,n.action)}})},threshold:{[i.Moon]:2,[i.Air]:1}}]},Ns={name:"Share Mentorship And Expertise",type:o.Innate,speed:d.Fast,set:s.NatureIncarnate,target:c.Spirit,targetFilter:[m.Another],effects:[{textArea:[.252,.358],text:"Put a Power Card from your hand or discard into target Spirit's hand.",[r.TargetSpirit]:async({you:e,spirit:a,action:t})=>{await e.powersWhere((e=>e.isInHand||e.isInDiscard)).pickOne((async n=>{a!==e&&await a.givePower(n),t.data.givenPower=n}))},threshold:{[i.Air]:1}},{textArea:[.365,.479],text:"Target Spirit may play that Power Card now by paying its cost.",[r.TargetSpirit]:async({spirit:e,action:a})=>{const t=a.data.givenPower;void 0!==t&&await e.playAPowerCardByPayingItsCost((e=>e===t))},threshold:{[i.Air]:3,[i.Earth]:2}},{textArea:[.483,.645],text:"Target Spirit may Repeat that Power Card once this turn by paying its cost.",[r.TargetSpirit]:async({$:e,spirit:a,action:t})=>{const n=t.data.givenPower;await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({[r.GlobalReminder]:()=>({power:n.power,players:[a]}),[r.MayRepeatPowercard]:({power:e,speed:t})=>e===n&&e.costToPlay<=a.energy&&e.possibleToRepeatAtSpeed(t),[r.RepeatPowerCard]:async({power:a,speed:t})=>{a===n&&e.removeThisEffect(),await a.payForPlay(),await a.replay(t)}})},threshold:{[i.Sun]:1,[i.Air]:4,[i.Earth]:3}},{textArea:[.652,.813],text:"Prepare 1 Element Marker matching an Element on that Power Card. Prepare 1 Element Marker of your choice.",[r.TargetSpirit]:async({you:e,action:a})=>{const t=a.data.givenPower,n=t.power===_e.ElementalBoon?qn:t.data.elements;void 0!==n&&n.length>0&&await e.prepareElement(n),await e.prepareElement()},threshold:{[i.Air]:1}}]},$s={name:"Share Secrets Of Survival",type:o.Unique,speed:d.Fast,energy:0,elements:[i.Sun,i.Air,i.Earth],set:s.JaggedEarth,target:c.Land,sourceFilter:[l.SacredSite],range:1,hasPushOrGather:!0,effects:[{textArea:[.592,.939],text:"Each time <dahan> would be Destroyed in target land, Destroy 2 fewer <dahan>.<or>Gather up to 2 <dahan>.<br><br>If you have 3 <air>:<br>You may do both.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{const n={actionId:"DestroyFewer",textArea:[.588,.692],text:"Each time <dahan> would be Destroyed in target land, Destroy 2 fewer <dahan>",[r.Now]:async({effect:a})=>{await e.addSubEffectUntilEndOfTurn({[r.Reminder]:e=>e===t?a.text:void 0,[r.OrderOfRemoveAllMightMatter]:()=>!0,[r.PreventRemovePiece]:async a=>{const n=e.action.data.savedDahanThisAction??0;return!!(a.location===t&&a.piece.isA(e.Dahan)&&x[a.removement].isDestroyLike&&n<2)&&(e.action.data.savedDahanThisAction=(n??0)+1,await e.sendEvent({type:T.GenericSub,text:"<p>ShareSecretsOfSurvival</p> saved the <dahan> from Destruction."}),!0)}})}},s={actionId:"GatherDahan",textArea:[.739,.779],text:"Gather up to 2 <dahan>.",[r.Now]:async()=>{await t.gatherUpTo(2,e.Dahan)}};await e.chooseBetween({effects:[n,s,{actionId:"DoBoth",textArea:[.893,.933],text:"Do both.",condition:()=>!e.treatingAllOrsAsAnds&&a.hasElementsWithConvert({[i.Air]:3}),[r.Now]:async()=>{await a.convertElements({[i.Air]:3}),await e.addSubEffectUntilEndOfTurn({effects:[n,s]})}}]})}}]},Ws={name:"Study The Invader's Fears",type:o.Unique,speed:d.Fast,energy:0,elements:[i.Moon,i.Air,i.Animal],set:s.JaggedEarth,target:c.Land,targetFilter:[l.Town,l.City],range:0,generatesFear:!0,effects:[{textArea:[.692,.732],text:"2 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.748,.841],text:"Turn the top card of the Fear Deck face-up.",[r.InTargetLand]:async({$:e})=>{const a=await e.revealTopFearCard();null!==a&&await e.query({query:tn.ClickToContinueCard,items:[a],actionIds:[a]})}}]},Ms={name:"Dissolving Vapors",type:o.Unique,speed:d.Slow,energy:2,elements:[i.Air,i.Water],set:s.JaggedEarth,target:c.Land,range:0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.68,.72],text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.745,.785],text:"1 Damage to each Invader.",[r.InTargetLand]:async({land:e})=>{await e.damageEach(1)}},{textArea:[.807,.847],text:"1 Damage to each <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.damageEach(1,e.Dahan)}}]},Gs={name:"Flowing And Silent Forms Dart By",type:o.Unique,speed:d.Fast,energy:0,elements:[i.Moon,i.Air,i.Water],set:s.JaggedEarth,target:c.Land,range:0,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.598,.638],text:"2 <fear> if Invaders are present.",[r.InTargetLand]:async({land:e})=>{e.hasInvaders&&await e.fear(2)}},{textArea:[.657,.789],text:"When <presence> in target land would be Destroyed, its owner may if possible, instead Push that <presence>.",[r.InTargetLand]:async({$:e,land:a,effect:t})=>{await e.addSubEffectUntilEndOfTurn({[r.Reminder]:e=>e===a?t.text:void 0,[r.PreventRemovePiece]:async({piece:e,location:t,removement:n})=>{if(t===a&&x[n].isDestroyLike&&e.isPresence){return(await a.push({piece:e,quantifier:w.May})).length>0}return!1}})}},{textArea:[.805,.939],text:"You may Gather 1 <presence>/<sacred> of another Spirit (with their permission).",[r.InTargetLand]:async({$:e,you:a,land:t})=>{const n=await t.gather({quantifier:w.May,amount:1,pieces:e.Presence,pieceFilter:e=>e.owner!==a,pickPiecesEffect:{prompt:"Pick 1 <presence>/<sacred> to Gather. 2 <presence> left"}});n.length>0&&await t.gather({quantifier:w.May,amount:1,pieces:e.Presence,pieceFilter:e=>e.location===n[0].source&&e.owner===n[0].piece.owner})}}]},Hs={name:"Lost In The Swirling Haze",type:o.Innate,speed:d.Slow,set:s.JaggedEarth,target:c.Land,range:0,hasPushOrGather:!0,effects:[{text:"Push up to 1 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(1,e.Dahan)},threshold:{[i.Air]:1,[i.Water]:2}},{text:"Push up to 2 <explorer>/<dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(2,e.ExplorerOrDahan)},threshold:{[i.Air]:2,[i.Water]:3}},{text:"Push up to 2 <explorer>/<dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(2,e.ExplorerOrDahan)},threshold:{[i.Air]:3,[i.Water]:4}}]},Us={name:"Suffocating Shroud",type:o.Innate,speed:d.Slow,set:s.JaggedEarth,target:c.Land,range:0,hasDamageInstructions:!0,effects:[{text:"1 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(1)},threshold:{[i.Moon]:1,[i.Air]:2,[i.Water]:1}},{text:"For each adjacent land with your <presence>, 1 Damage to a different Invader.",[r.InTargetLand]:async({you:e,land:a})=>{const t=a.inAdjacentLandsWhere((a=>a.hasPresenceOf(e))).count;await a.damageDifferent(t)},threshold:{[i.Moon]:2,[i.Air]:3,[i.Water]:2}},{text:"1 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(1)},threshold:{[i.Moon]:4,[i.Air]:4,[i.Water]:3}},{text:"1 Damage to each Invader.",[r.InTargetLand]:async({land:e})=>{await e.damageEach(1)},threshold:{[i.Moon]:5,[i.Air]:6,[i.Water]:4}}]},qs={name:"The Fog Closes In",type:o.Unique,speed:d.Slow,energy:1,elements:[i.Moon,i.Air,i.Water],set:s.JaggedEarth,target:c.Land,range:0,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{textArea:[.674,.807],text:"For each adjacent land with your <presence>, 1 Damage to a different Invader.",[r.InTargetLand]:async({you:e,land:a})=>{const t=a.inAdjacentLandsWhere((a=>a.hasPresenceOf(e))).count;await a.damageDifferent(t)}},{textArea:[.824,.864],text:"Push 2 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.push({amount:2,pieces:e.Dahan})}}]},js={name:"Unnerving Pall",type:o.Unique,speed:d.Fast,energy:1,elements:[i.Moon,i.Air,i.Animal],set:s.JaggedEarth,target:c.Land,targetFilter:[l.Invaders],range:0,generatesFear:!0,effects:[{textArea:[.607,.921],text:"1 <fear>. Up to 3 damaged Invaders do not participate in Ravage.<or>1 <fear>. Defend 1 per <presence> you have in target land (when this Power is used).",[r.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"DoNotParticipate",textArea:[.613,.706],text:"1 <fear>. Up to 3 damaged Invaders do not participate in Ravage.",effects:[{text:"1 <fear>.",[r.Now]:async()=>{await a.fear(1)}},{text:"Up to 3 damaged Invaders do not participate in Ravage.",[r.Now]:async({effect:t})=>{await a.fear(1),await e.addSubEffectUntilEndOfTurn({[r.Reminder]:e=>e===a?t.text:void 0,[r.DoesNotParticipateInRavage]:async({location:t})=>{t===a&&await t.doNotParticipateInRavage({quantifier:w.UpTo,pieceFilter:e=>e.damage>0,amount:3,pieces:e.Dahan})}})}}]},{actionId:"Defend",textArea:[.776,.917],text:"1 <fear>. Defend 1 per <presence> you have in target land (when this Power is used).",[r.Now]:async({you:e})=>{await a.fear(1),await a.defend(a.numberOfPresenceOf(e))}}]})}}]},Js={name:"Air Moves Earth Endures",type:o.Innate,speed:d.Fast,set:s.JaggedEarth,target:c.Land,range:1,hasPushOrGather:!0,effects:[{text:"Push up to 2 <explorer> or 1 <town>.",[r.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"PushExplorer",text:"Push up to 2 <explorer>",[r.Now]:async()=>{await a.pushUpTo(2,e.Explorer)}},{actionId:"PushTown",text:"Push 1 <town>",[r.Now]:async()=>{await a.pushOne(e.Town)}}]})},threshold:{[i.Air]:3}},{text:"Defend 5.",[r.InTargetLand]:async({land:e})=>{await e.defend(5)},threshold:{[i.Earth]:3}}]},Vs={name:"Boon Of Reimagining",type:o.Unique,speed:d.Slow,energy:1,elements:[i.Moon],set:s.JaggedEarth,target:c.Spirit,effects:[{textArea:[.631,.805],text:"Target Spirit may Forget a Power Card from hand or discard to draw 6 Minor Power Cards and gain 2 of them.",[r.TargetSpirit]:async({spirit:e})=>{(await e.forgetPowers({filter:e=>!e.isInPlay,optional:!0})).length>0&&await e.gainPowerCard({powerType:o.Minor,drawAmount:6,keepAmount:2})}},{textArea:[.821,.911],text:"If you target another Spirit, they gain 1 Energy.",[r.TargetSpirit]:async({you:e,spirit:a})=>{a!==e&&await a.gainEnergy(1)}}]},Ys={name:"Fire Burns Water Soothes",type:o.Innate,speed:d.Slow,set:s.JaggedEarth,target:c.Land,sourceFilter:[l.SacredSite],range:1,blightWhiteListedPower:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{effects:[{text:"1 <fear>",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{text:"2 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(2)}}],threshold:{[i.Fire]:3}},{text:"Remove 1 <blight>.",[r.InTargetLand]:async({land:e})=>{await e.removeBlight()},threshold:{[i.Water]:3}}]},zs={name:"Gather The Scattered Light Of Stars",type:o.Unique,speed:d.Slow,energy:0,elements:[i.Moon],set:s.JaggedEarth,target:c.Spirit,targetFilter:[m.Yourself],fullText:["At the end of turn after discarding: Reclaim up to 2 cards to your hand.","You may then Forget a Unique Power Card to Reclaim up to 3 additional cards."],effects:[{textArea:[.653,.743],text:"At the end of turn after discarding: Reclaim up to 2 cards to your hand.",[r.TargetSpirit]:async({$:e,spirit:a})=>{await e.addSubEffectUntilEndOfTimePasses({[r.AtTimePassesEnds]:async()=>{await a.reclaim(2),a.powersWhere((e=>e.isA(ye.Unique))).count>0&&await e.addSubEffect({textArea:[.756,.888],[r.Now]:async()=>{await e.may({textArea:[.756,.888],prompt:"Forget a Unique Power Card to Reclaim up to 3 additional cards?"})&&(await a.forgetPowers({powerFilter:ye.Unique}),await a.reclaimCards({amount:3,optional:!0}))}})}})}}]},Qs={name:"Peace Of The Nighttime Sky",type:o.Unique,speed:d.Fast,energy:1,elements:[i.Moon],set:s.JaggedEarth,target:c.Land,sourceFilter:[l.SacredSite],range:1,effects:[{textArea:[.621,.755],text:"If the Terror Level is I, Invaders do not Ravage in target land this turn.",[r.InTargetLand]:async({$:e,land:a})=>{1===e.terrorLevel&&await a.skipInvaderAction({text:"Invaders do not Ravage here this turn.",all:!0,filter:({invaderAction:e})=>e===K.Ravage})}},{textArea:[.769,.906],text:"You may Repeat this Power. If you choose to do so, Forget this Power Card and gain <moon>.",[r.InTargetLand]:async({$:e,isRepeat:a,you:t,power:n})=>{!a&&await e.may({prompt:"Repeat this Power, Forget this Power Card and gain <moon>?"})&&(await t.targetAndResolvePower(n,!0),await n.forget(),await t.gainElementsUntilEndOfTurn({[i.Moon]:1}))}}]},Ks={name:"Shape The Self Anew",type:o.Unique,speed:d.Slow,energy:0,elements:[i.Moon],set:s.JaggedEarth,target:c.Spirit,targetFilter:[m.Yourself],fullText:["Gain a Minor Power.","You may Forget this Power Card to gain 3 Energy.","If you have 4 <moon>:<br>You may gain a Major Power instead of a Minor Power."],effects:[{textArea:[.595,.934],text:"Gain a Minor Power. If you have 4 <moon>:<br>You may gain a Major Power instead of a Minor Power.",[r.TargetSpirit]:async({spirit:e})=>{e.hasElementsWithConvert({[i.Moon]:4})?await e.gainPowerCard():await e.gainPowerCard({powerType:o.Minor})}},{textArea:[.659,.752],text:"You may Forget this Power Card to gain 3 Energy.",[r.TargetSpirit]:async({$:e,spirit:a,power:t})=>{t.owner===a&&await e.may({prompt:"Forget this Power Card to gain 3 Energy?"})&&(await t.forget(),await a.gainEnergy(3))}}]},Xs={name:"Sidereal Guidance",type:o.Innate,speed:d.Slow,set:s.JaggedEarth,target:c.Land,range:1,hasPushOrGather:!0,effects:[{text:"Gather up to 1 <explorer>/<dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(1,e.ExplorerOrDahan)},threshold:{[i.Moon]:2}},{instead:!0,text:"Instead, Gather up to 3 <explorer>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(3,e.Explorer)},threshold:{[i.Moon]:3}}]},_s={name:"Stars Blaze In The Daytime Sky",type:o.Innate,speed:d.Slow,set:s.JaggedEarth,target:c.Spirit,targetFilter:[m.Yourself],generatesFear:!0,effects:[{effects:[{text:"3 <fear>.",[r.TargetSpirit]:async({$:e})=>{await e.fear(3)}},{text:"Gain 1 Energy.",[r.TargetSpirit]:async({spirit:e})=>{await e.gainEnergy(1)}},{text:"Reclaim up to 1 Power Card from play or your discard pile.",[r.TargetSpirit]:async({spirit:e})=>{await e.reclaimCards({amount:1,filter:e=>e.isInDiscard||e.isInPlay})}}],threshold:{[i.Sun]:4}}]},Zs={name:"Wood Seeks Growth, Humans Seek Freedom",type:o.Innate,speed:d.Slow,set:s.JaggedEarth,target:c.Land,range:2,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{text:"Choose a Spirit with <presence> in target land. They gain a Power Card.",[r.InTargetLand]:async({land:e})=>{await e.spiritsWithPresence().pickOne((async e=>{await e.gainPowerCard()}),{autoPlayOneOption:!0,noOptions:"No Spirits with <presence> in target Land."})},threshold:{[i.Plant]:3}},{text:"1 Damage per <dahan><or>Push up to 3 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"Damage",text:"1 Damage per <dahan>",[r.Now]:async()=>{await a.damage(a.numberOf(e.Dahan))}},{actionId:"Dahan",text:"Push up to 3 <dahan>.",[r.Now]:async()=>{await a.pushUpTo(3,e.Dahan)}}]})},threshold:{[i.Animal]:3}}]},eo={name:"Hold The Island Fast With A Bulwark Of Will",type:o.Innate,speed:d.Fast,set:s.JaggedEarth,target:c.Spirit,targetFilter:[m.Yourself],effects:[{text:"When <blight> is added to one of your lands, you may pay 2 Energy per <blight> to take it from the box instead of from the Blight Card. (Handle any cascade separately.)",[r.TargetSpirit]:async({$:e,spirit:a})=>{const t=a.hasElements({[i.Earth]:4})?1:2;await e.addSubEffectUntilEndOfTurn({[r.GlobalReminder]:()=>({icon:`<blight><br>Pay ${t}`,spirit:a,players:[a]}),text:`When <blight> is added to one of your lands, you may pay ${t} Energy per <blight> to take it from the box instead of from the Blight Card. (Handle any cascade separately.)`,[r.PreventRemoveBlightFromBlightCard]:async({location:n})=>!!(void 0!==n&&n.hasPresenceOf(a)&&a.energy>=t&&await e.may({prompt:`Pay ${t} Energy to take <blight> from the box instead of from the Blight Card?`}))&&(await a.payEnergy(t),!0)})},threshold:{[i.Earth]:2}},{[r.TargetSpirit]:async()=>{},text:"The cost is 1 Energy instead of 2.",threshold:{[i.Earth]:4}},{text:'When an Event or Blight Card directly Destroys <presence> (yours or others), you may prevent any number of <presence> from being Destroyed by paying 1 Energy each. ("Directly" means "not by adding <blight>".)',[r.TargetSpirit]:async({$:e,spirit:a})=>{await e.addSubEffectUntilEndOfTurn({[r.GlobalReminder]:()=>({icon:"<blight><br><broken>",spirit:a,players:[a]}),[r.PreventRemovePiece]:async({piece:t,removement:n})=>!!([en.MainEventAction,en.DahanEventAction,en.TokenEventAction,en.BlightCardAction].includes(e.action.type)&&t.isPresence&&n===A.DirectDestroy&&a.energy>=1&&await e.may({prompt:"Pay 1 Energy to prevent <presence> from being Destroyed?"}))&&(await a.payEnergy(1),!0)})},threshold:{[i.Earth]:6,[i.Plant]:1}}]},ao={name:"Jagged Shards Push From The Earth",type:o.Unique,speed:d.Slow,energy:0,elements:[i.Fire,i.Earth],set:s.JaggedEarth,target:c.Land,range:1,hasPushOrGather:!0,effects:[{textArea:[.706,.746],text:"Add 1 <badlands>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Badlands)}},{textArea:[.768,.808],text:"Push up to 2 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(2,e.Dahan)}}]},to={name:"Let Them Break Themselves Against The Stone",type:o.Innate,speed:d.Fast,set:s.JaggedEarth,target:c.Land,range:0,hasDamageInstructions:!0,effects:[{text:"After Invaders deal 1 or more Damage to target land, 2 Damage.",[r.InTargetLand]:async({$:e,you:a,land:t,...n})=>{const s={triggerId:e.nextTriggerId(),[r.Now]:async({action:n})=>{await t.damage(2),await e.addSubEffect({text:"Also deal half of the Damage Invaders did to the land (rounding down).",[r.Now]:async()=>{a.hasElements({[i.Earth]:5})&&await t.damage(Math.floor(n.parentData.damageToLand/2))}})}};await e.addSubEffectUntilEndOfTurn({[r.Reminder]:e=>e===t?n.effect.text:void 0,[r.AfterRavagingDamageLand]:async a=>{a.land===t&&a.damageToLand>=1&&(e.action.data.damageToLand=a.damageToLand,await e.addTrigger(s,n.effect,n.action))}})},threshold:{[i.Earth]:3}},{text:"Also deal half of the Damage Invaders did to the land (rounding down).",[r.InTargetLand]:async({$:e,land:a})=>{await e.addSubEffectUntilEndOfTurn({[r.Reminder]:e=>e===a?"Also deal half of the Damage Invaders did to the land (rounding down).":void 0})},threshold:{[i.Earth]:5}},{text:"Repeat this Power.",[r.InTargetLand]:async({power:e,isRepeat:a})=>{a||await e.repeat()},threshold:{[i.Earth]:7,[i.Sun]:2}}]},no={name:"Plows Shatter On Rocky Ground",type:o.Unique,speed:d.Slow,energy:2,elements:[i.Earth],set:s.JaggedEarth,target:c.Land,range:1,hasPushOrGather:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{textArea:[.644,.876],text:"1 Damage to each <town>/<city>.<br>Push up to 1 <town>.<or>Destroy 1 <town>.",[r.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"DamageEach",textArea:[.647,.748],text:"1 Damage to each <town>/<city>.<br>Push up to 1 <town>.",[r.Now]:async()=>{await e.addSubEffect({effects:[{textArea:[.66,.7],text:"1 Damage to each <town>/<city>.",[r.Now]:async()=>{await a.damageEach(1,e.TownOrCity)}},{textArea:[.703,.743],text:"Push up to 1 <town>.",[r.Now]:async()=>{await a.pushUpTo(1,e.Town)}}]})}},{actionId:"DestroyTown",textArea:[.828,.868],text:"Destroy 1 <town>.",[r.Now]:async()=>{await a.destroyOne(e.Town)}}]})}}]},ro={name:"Scarred And Stony Land",type:o.Unique,speed:d.Slow,energy:2,elements:[i.Moon,i.Earth],set:s.JaggedEarth,target:c.Land,sourceFilter:[l.SacredSite],targetFilter:[l.Blight],range:1,blightWhiteListedPower:!0,hasDamageInstructions:!0,effects:[{textArea:[.641,.681],text:"2 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(2)}},{textArea:[.7,.74],text:"Add 1 <badlands>.",[r.InTargetLand]:async({$:e,land:a})=>{a.isLand&&await a.add(1,e.Badlands)}},{text:"Remove 1 <blight> in target land from the game. (It goes to the box, not the Blight Card.)",textArea:[.755,.894],[r.InTargetLand]:async({land:e})=>{await e.removeBlight({toTheBox:!0})}}]},io={name:"Stubborn Solidity",type:o.Unique,speed:d.Fast,energy:1,elements:[i.Sun,i.Earth,i.Animal],set:s.JaggedEarth,target:c.Land,range:1,effects:[{textArea:[.624,.664],text:"Defend 1 per <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.defend(a.numberOf(e.Dahan))}},{textArea:[.676,.92],text:"<dahan> in target land cannot be changed.<br><br>(When they would be Damaged, Destroyed, Removed, Replaced, or moved, instead don't.)",[r.InTargetLand]:async({$:e,land:a,effect:t})=>{await e.addSubEffectUntilEndOfTurn({[r.Reminder]:e=>e===a?t.text:void 0,[r.PreventDamagingPiece]:({piece:t})=>Promise.resolve(t.location===a&&t.isA(e.Dahan)),[r.PreventRemovePiece]:({piece:t})=>Promise.resolve(t.location===a&&t.isA(e.Dahan)),[r.PreventMovePiece]:({piece:t,source:n})=>n===a&&t.isA(e.Dahan)})}}]},so={name:"Impersonate Authority",type:o.Unique,speed:d.Slow,energy:0,elements:[i.Sun,i.Air,i.Animal],set:s.JaggedEarth,target:c.Land,range:1,effects:[{textArea:[.745,.785],text:"Add 1 <strife>.",[r.InTargetLand]:async({land:e})=>{await e.addStrife(1)}}]},oo={name:"Incite The Mob",type:o.Unique,speed:d.Slow,energy:1,elements:[i.Moon,i.Fire,i.Air],set:s.JaggedEarth,target:c.Land,targetFilter:[l.Invaders],range:1,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.644,.89],text:"1 Invader with <strife> deals Damage to other Invaders (not to each Invader). 1 <fear> per Invader this Power Destroyed.",[r.InTargetLand]:async({$:e,land:a})=>{await a.piecesWithStrife().pickOne((async t=>{await e.addSubEffect({highlightPieces:[t],[r.Now]:async()=>{const n=(await a.damage(t.strengthOutOfRavage,e.Invader,{filter:e=>e!==t})).filter((({piece:e,removement:a})=>x[a].isDestroyLike&&e.isInvader)).length;await a.fear(n)}})}),{autoPlayOneOption:!0,prompt:"Pick 1 Invader with <strife>.",noOptions:"No Invaders with <strife>."})}}]},co={name:"Lets See What Happens",type:o.Innate,speed:d.Fast,set:s.JaggedEarth,target:c.Land,targetFilter:[l.Invaders],range:1,effects:[{text:'Discard Minor Powers from the deck until you get one that targets a land. Use its text effects on target land immediately, ignoring normal Range and targeting restrictions. All "up to" instructions must be used at max. value. Treat all "OR"s as "AND"s.<br>It is not considered a card of yours or a card in play. Its effects are treated as performed by this Power, as if its text were copied here.)',[r.InTargetLand]:async({$:e,you:a,land:t,power:n,action:i})=>{let s;for(;s=await e.drawAndDiscardPower(o.Minor),void 0===s||bd[s].target!==c.Land;);void 0!==s&&(i.data.letsSeeCard=s,await e.addSubEffect({textArea:void 0,card:s,[r.Now]:async()=>{await e.clickToContinue(),await e.addEffectUntilEndOfAction({[r.UpToMustBeUsedAtMaximum]:()=>e.action===i,[r.TreatAllORsAsANDs]:()=>e.action===i});for(const i of bd[s].effects)await e.addEffect({name:bd[s].name,effects:[i],card:s,highlightLocations:[t],players:[a],spirit:a}),await e.doEffectsWithContext(r.InTargetLand,{power:n,land:t,owner:a,isRepeat:!1},(e=>e.card===s))}}))},threshold:{[i.Moon]:1,[i.Fire]:1,[i.Air]:2}},{text:"You may Forget a Power Card to gain the just-used Power Card (to hand) and 1 Energy.",[r.InTargetLand]:async({$:e,you:a,action:t})=>{const n=t.data.letsSeeCard;n&&await e.may({card:n,prompt:`Forget a Power Card to gain <p>${n}</p> (to hand) and 1 Energy?`})&&(await a.forgetPowers(),await a.gainPower(n),await a.gainEnergy(1))},threshold:{[i.Moon]:2,[i.Fire]:1,[i.Air]:2}}]},lo={name:"Overenthusiastic Arson",type:o.Unique,speed:d.Fast,energy:1,elements:[i.Fire,i.Air],set:s.JaggedEarth,target:c.Land,range:1,generatesFear:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{textArea:[.677,.717],text:"Destroy 1 <town>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.destroyOne(e.Town)}},{textArea:[.733,.871],text:"Discard the top card of the Minor Power Deck. If it provides <fire>: 1 <fear>, 2 Damage, and add 1 <blight>.",[r.InTargetLand]:async({$:e,land:a})=>{const t=await e.drawAndDiscardPower(o.Minor);await e.addSubEffect({[r.Now]:async()=>{await e.clickToContinue({card:t,textArea:void 0}),void 0!==t&&bd[t].elements.includes(i.Fire)?(await e.sendEvent({type:T.GenericSub,text:"The top card of the Minor Power Deck provided <fire>."}),await a.fear(1),await a.damage(2),await a.addBlight(1)):await e.sendEvent({type:T.GenericSub,text:"The top card of the Minor Power Deck did not provide <fire>."})}})}}]},ho={name:"Unexpected Tigers",type:o.Unique,speed:d.Slow,energy:0,elements:[i.Moon,i.Fire,i.Animal],set:s.JaggedEarth,target:c.Land,range:1,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.653,.693],text:"1 <fear> if Invaders are present.",[r.InTargetLand]:async({land:e})=>{e.hasInvaders&&await e.fear(1)}},{textArea:[.713,.871],text:"If you can Gather 1 <beasts>, do so, then Push 1 <explorer>. Otherwise, add 1 <beasts>.",[r.InTargetLand]:async({$:e,land:a})=>{await e.countPieceOptionally(p.Beasts,(()=>a.inAdjacentLandsWhere((a=>a.has(e.Beasts)))));(await a.gatherOne(e.Beasts)).length>0?await e.addSubEffect({textArea:[.712,.804],text:"If you can Gather 1 <beasts>, do so, then Push 1 <explorer>.",[r.Now]:async()=>{await a.pushOne(e.Explorer)}}):await e.addSubEffect({textArea:[.824,.864],text:"Otherwise, add 1 <beasts>.",[r.Now]:async()=>{await a.add(1,e.Beasts)}})}}]},go={text:"1 Invader and 1 <dahan> deal Damage to each other.",[r.InTargetLand]:async({$:e,land:a})=>{a.hasAllOf(e.Dahan,e.Invader)&&await a.invaders().pickOne((async t=>{await a.piecesThatAre(e.Dahan).pickOne((async n=>{await e.addSubEffect({highlightPieces:[t,n],[r.Now]:async()=>{const e=t.strengthOutOfRavage-a.defense,r=n.strengthOutOfRavage;t.strife>0?await t.removeStrife():await n.damageOnlyThis(e),await t.damageOnlyThis(r)}})}))}))}},fo={name:"Why Dont You And Them Fight",type:o.Innate,speed:d.Fast,set:s.JaggedEarth,target:c.Land,targetFilter:[l.Invaders],range:0,hasDamageInstructions:!0,mayBeSpeed:{effect:{text:"If you have 3 <moon>:<br>This Power may be <slow>.",[r.Now]:async({action:e})=>{await e.spirit.convertElements({[i.Moon]:3})}},condition:({speed:e,spirit:a})=>e===d.Slow&&a.hasElementsWithConvert({[i.Moon]:3}),noDowngrade:({element:e,spirit:a,speed:t})=>t===d.Slow&&e===i.Moon&&!a.hasElementsWithConvert({[i.Moon]:4})},fullText:["Threshold 3 <moon>","This Power may be <slow>.","Threshold 3 <air>","Add 1 <strife>.","Threshold 3 <sun> or 3 <fire>","1 Invader and 1 <dahan> deal Damage to each other.","Threshold 3 <animal>","If target land has <beasts>, 2 Damage. Otherwise, you may Gather 1 <beasts>."],effects:[{[r.InTargetLand]:async()=>{},threshold:{[i.Moon]:3},dontResolveAlone:!0,noConvertToThreshold:!0},{text:"Add 1 <strife>.",[r.InTargetLand]:async({land:e})=>{await e.addStrife(1)},threshold:{[i.Air]:3}},{...go,threshold:{[i.Sun]:3}},{instead:!0,...go,threshold:{[i.Fire]:3}},{text:"If target land has <beasts>, 2 Damage. Otherwise, you may Gather 1 <beasts>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.possiblyDontCountPiecesAs(p.Beasts),a.has(e.Beasts)?await a.damage(2):await a.mayGather(e.Beasts)},threshold:{[i.Animal]:3}}]},uo={name:"Epidemics Run Rampant",type:o.Innate,speed:d.Fast,set:s.JaggedEarth,target:c.Land,targetFilter:[l.Disease],range:1,generatesFear:!0,hasDamageInstructions:!0,fullText:["This Power's Damage is done (separately) to both Invaders and <dahan>.","Threshold 1 <fire> 3 <animal>","1 Damage per <disease>.","Threshold 1 <water> 2 <fire> 4 <animal>","+1 Damage per <disease>.","Threshold 3 <water> 3 <fire> 5 <animal>","+1 Damage per <disease>.","+1 <fear> per <disease> (max. 5).","Remove 1 <disease>."],effects:[{text:"This Power's Damage is done (separately) to both Invaders and <dahan><br><br>1 Damage per <disease>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.damage(a.numberOf(e.Disease)),await a.damage(a.numberOf(e.Disease),e.Dahan)},threshold:{[i.Fire]:1,[i.Animal]:3}},{text:"+1 Damage per <disease>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.damage(a.numberOf(e.Disease)),await a.damage(a.numberOf(e.Disease),e.Dahan)},threshold:{[i.Water]:1,[i.Fire]:2,[i.Animal]:4}},{effects:[{text:"+1 Damage per <disease>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.damage(a.numberOf(e.Disease)),await a.damage(a.numberOf(e.Disease),e.Dahan)}},{text:"+1 <fear> per <disease> (max. 5).",[r.InTargetLand]:async({$:e,land:a})=>{await a.fear(Math.min(a.numberOf(e.Disease),5))}},{text:"Remove 1 <disease>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.removeOne(e.Disease)}}],threshold:{[i.Water]:3,[i.Fire]:3,[i.Animal]:5}}]},po={name:"Fetid Breath Spreads Infection",type:o.Unique,speed:d.Slow,energy:2,elements:[i.Air,i.Water,i.Animal],set:s.JaggedEarth,target:c.Land,targetFilter:[l.Invaders],range:1,generatesFear:!0,effects:[{textArea:[.712,.752],text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.772,.812],text:"Add 1 <disease>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Disease)}}]},wo={name:"Fiery Vengeance",type:o.Unique,speed:d.Fast,energy:0,elements:[i.Sun,i.Fire],set:s.JaggedEarth,target:c.Spirit,mayUse:({spirit:e})=>e.destroyedPresence>0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.605,.917],text:"Cost to Use: Target Spirit Removes 1 of their Destroyed <presence> from the game.<br><br>1 <fear> and 1 Damage in one of target Spirit's lands.<br><br>(This is your Power, so <blight> counts as <badlands> even if target is another Spirit.)",[r.TargetSpirit]:async({spirit:e})=>{e.destroyedPresence-=1,await e.inLands().pickOne((async e=>{await e.fear(1),await e.damage(1)}))}}]},yo={name:"Plaguebearers",type:o.Unique,speed:d.Slow,energy:1,elements:[i.Fire,i.Water,i.Animal],set:s.JaggedEarth,target:c.Land,targetFilter:[l.Disease],range:2,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.653,.693],text:"1 <fear> if Invaders are present.",[r.InTargetLand]:async({land:e})=>{e.hasInvaders&&await e.fear(1)}},{textArea:[.709,.868],text:"For each <disease>, Push 2 <explorer>/<town>/<dahan>. 1 <disease> may move with each Pushed piece.",[r.InTargetLand]:async({$:e,land:a})=>{const t=await a.push({amount:2*a.numberOf(e.Disease),pieces:e.ExplorerTownOrDahan});for(;a.has(e.Disease)&&t.length>0;){const n=await a.move({quantifier:w.May,pieces:e.Disease,destinationFilter:e=>t.some((a=>a.destination===e)),movement:q.Bring});if(!(n.length>0))break;ae(t,(e=>e.destination===n[0].destination))}}}]},mo={name:"Savage Revenge",type:o.Innate,speed:d.Slow,set:s.JaggedEarth,target:c.Land,targetFilter:[l.Town,l.City],range:0,modifiesRange:({spirit:e,withConvert:a})=>e.hasElements({[i.Air]:3},a)?1:0,payForRange:async({spirit:e})=>{await e.convertElements({[i.Air]:3})},hasDamageInstructions:!0,effects:[{text:"This Power has <range+1>.",[r.InTargetLand]:async()=>{},threshold:{[i.Air]:3},noConvertToThreshold:!0,dontResolveAlone:!0},{instead:!0,text:"1 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(1)},threshold:{[i.Fire]:3,[i.Animal]:1}},{text:"+2 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(2)},threshold:{[i.Fire]:4,[i.Animal]:2}},{text:"+3 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(3)},threshold:{[i.Fire]:5,[i.Air]:2,[i.Animal]:2}}]},vo={name:"Strike Low With Sudden Fevers",type:o.Unique,speed:d.Fast,energy:2,elements:[i.Fire,i.Air,i.Earth,i.Animal],set:s.JaggedEarth,target:c.Land,targetFilter:[l.Disease],range:1,generatesFear:!0,effects:[{textArea:[.713,.753],text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.776,.816],text:"Invaders skip Ravage Actions.",[r.InTargetLand]:async({land:e})=>{await e.skipInvaderAction({all:!0,filter:({invaderAction:e})=>e===K.Ravage})}}]},Io={name:"Exaltation Of Molten Stone",type:o.Unique,speed:d.Fast,energy:1,elements:[i.Moon,i.Fire,i.Earth],set:s.JaggedEarth,target:c.Spirit,targetFilter:[m.Another],effects:[{textArea:[.604,.784],text:"Split 1 Energy per <fire> you have between yourself and target Spirit, as evenly as possible. (Gained from the supply.)",[r.TargetSpirit]:async({$:e,you:a,spirit:t})=>{await a.askToConvertElementsToCombo({[i.Fire]:1});const n=a.elements[i.Fire];t===a?await a.gainEnergy(n):n%2==0?(await a.gainEnergy(n/2),await t.gainEnergy(n/2)):await e.chooseBetween({effects:[{actionId:"YouGetLess",text:`${a.nameLink} gain ${Math.floor(n/2)} energy, ${t.nameLink} gain ${Math.ceil(n/2)} energy.`,[r.Now]:async()=>{await a.gainEnergy(Math.floor(n/2)),await t.gainEnergy(Math.ceil(n/2))}},{actionId:"TargetGetLess",text:`${a.nameLink} gain ${Math.ceil(n/2)} energy, ${t.nameLink} gain ${Math.floor(n/2)} energy.`,[r.Now]:async()=>{await a.gainEnergy(Math.ceil(n/2)),await t.gainEnergy(Math.floor(n/2))}}]})}},{textArea:[.772,.916],text:"Target Spirit gains <range+1> with their Powers that originate from a <mountains>.",[r.TargetSpirit]:async({$:e,power:a,spirit:t})=>{await e.addSubEffectUntilEndOfTurn({[r.GlobalReminder]:()=>({power:a.power,players:[t]}),[r.ExtraRange]:e=>e.spirit===t&&e.location.isMountains?1:0})}}]},Ao={name:"Explosive Eruption",type:o.Innate,speed:d.Fast,set:s.JaggedEarth,target:c.Land,range:0,generatesFear:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{text:"Destroy X (1 or more) of your <presence> in target land. <broken> (below) checks how many were Destroyed. This Power's Damage is done (separately) to both Invaders and <dahan>. The Ranges below can't be increased.",[r.InTargetLand]:async({$:e,you:a,land:t,action:n})=>{const r=await e.selectX(1,t.numberOfPresenceOf(a)),i=await t.destroy({amount:r,pieces:e.Presence,owner:a});n.data.explosiveEruptionCount=i.length},threshold:{}},{text:"2 <broken>: In one land within <range-1>, X Damage.",[r.InTargetLand]:async({$:e,land:a,you:t,action:n})=>{const r=n.data.explosiveEruptionCount;r>=2&&await a.inLandsWithin(1,t,{mayIncrease:!1}).pickOne((async a=>{await a.damage(r),await a.damage(r,e.Dahan)}))},threshold:{[i.Fire]:2,[i.Earth]:2}},{text:"4 <broken>: X <fear>.",[r.InTargetLand]:async({land:e,action:a})=>{const t=a.data.explosiveEruptionCount;t>=4&&await e.fear(t)},threshold:{[i.Fire]:3,[i.Earth]:3}},{effects:[{text:"6 <broken>: In each land within <range-1>, 4 Damage.",[r.InTargetLand]:async({$:e,you:a,land:t,action:n})=>{n.data.explosiveEruptionCount>=6&&await t.inLandsWithin(1,a,{mayIncrease:!1}).forEach((async a=>{await a.damage(4),await a.damage(4,e.Dahan)}))}},{text:"Add 1 <blight> to target land; doing so does not Destroy your <presence>.",[r.InTargetLand]:async({$:e,you:a,land:t,action:n})=>{n.data.explosiveEruptionCount>=6&&(await e.addEffectUntilEndOfAction({[r.PreventBlightDestroyingPresence]:({location:e,spirit:n})=>e===t&&n===a}),await t.addBlight(1))}}],threshold:{[i.Fire]:4,[i.Air]:2,[i.Earth]:4}},{effects:[{text:"10 <broken>: In each land within <range-2>, +4 Damage.",[r.InTargetLand]:async({$:e,you:a,land:t,action:n})=>{n.data.explosiveEruptionCount>=10&&await t.inLandsWithin(2,a,{mayIncrease:!1}).forEach((async a=>{await a.damage(4),await a.damage(4,e.Dahan)}))}},{text:"In each land adjacent to the target, add 1 <blight> if it doesn't have any.",[r.InTargetLand]:async({$:e,land:a,action:t})=>{t.data.explosiveEruptionCount>=10&&await a.inAdjacentLocations().forEach((async a=>{a.isLandForBlight&&a.doesntHave(e.Blight)&&await a.addBlight(1)}))}}],threshold:{[i.Fire]:5,[i.Air]:3,[i.Earth]:5}}]},xo={name:"Lava Flows",type:o.Unique,speed:d.Slow,energy:1,elements:[i.Fire,i.Moon],set:s.JaggedEarth,target:c.Land,range:1,hasDamageInstructions:!0,effects:[{textArea:[.673,.851],text:"Add 1 <badlands> and 1 <wilds>.<or>1 Damage.",[r.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"BadlandsAndWilds",textArea:[.68,.72],text:"Add 1 <badlands> and 1 <wilds>.",[r.Now]:async()=>{await a.add(1,e.Badlands),await a.add(1,e.Wilds)}},{actionId:"Damage",textArea:[.805,.845],text:"1 Damage.",[r.Now]:async()=>{await a.damage(1)}}]})}}]},bo={name:"Powered By The Furnace Of The Earth",type:o.Innate,speed:d.Slow,set:s.JaggedEarth,target:c.Land,range:0,effects:[{text:"Add 1 of your Destroyed <presence>.",[r.InTargetLand]:async({you:e,land:a})=>{await a.addPresence(e,{destroyed:!0})},threshold:{[i.Earth]:3}},{text:"Cost 2 Energy: Gain a Power Card.",[r.InTargetLand]:async({$:e,you:a})=>{a.energy>=2&&await e.may({prompt:"Pay 2 Energy to Gain a Power Card ?"})&&(await a.payEnergy(2),await a.gainPowerCard())},threshold:{[i.Fire]:3}},{text:"Move up to 2 of your <presence> from other lands to target land.",[r.InTargetLand]:async({you:e,land:a})=>{await e.presence().pickMultiple({optional:!0,amount:2,where:e=>e.location!==a,forPickedItem:async e=>{await e.move({locations:{target:g.ToThisLocation,location:a}})}})},threshold:{[i.Earth]:4,[i.Fire]:4}},{text:"Return up to 2 of your Destroyed <presence> to your <presence> tracks.",[r.InTargetLand]:async({you:e})=>{await e.returnPresenceToTracks(2,{optional:!0,destroyed:!0})},threshold:{[i.Fire]:5}}]},To={name:"Pyroclastic Bombardment",type:o.Unique,speed:d.Fast,energy:3,elements:[i.Fire,i.Air,i.Earth],set:s.JaggedEarth,target:c.Land,sourceFilter:[l.SacredSite],range:2,hasDamageInstructions:!0,effects:[{textArea:[.692,.732],text:"1 Damage to each <town>/<city>/<dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.damageEach(1,e.TownCityOrDahan)}},{textArea:[.755,.795],text:"1 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(1)}},{textArea:[.812,.852],text:"1 Damage to <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.damage(1,e.Dahan)}}]},Eo={name:"Rain Of Ash",type:o.Unique,speed:d.Slow,energy:2,elements:[i.Fire,i.Air,i.Earth],set:s.JaggedEarth,target:c.Land,range:1,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.693,.733],text:"2 <fear> if Invaders are present.",[r.InTargetLand]:async({land:e})=>{e.hasInvaders&&await e.fear(2)}},{textArea:[.746,.842],text:"Push 2 <dahan> and 2 <explorer>/<town> to land(s) without your <presence>.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await t.push({amount:2,pieces:e.Dahan,destinationFilter:e=>!e.hasPresenceOf(a)}),await t.push({amount:2,pieces:e.ExplorerOrTown,destinationFilter:e=>!e.hasPresenceOf(a)})}}]},Po={name:"Blazing Intimidation",type:o.Unique,speed:d.Fast,energy:2,elements:[i.Fire,i.Plant,i.Animal],set:s.NatureIncarnate,target:c.Land,range:1,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.637,.677],text:"1 <fear>",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.757,.848],text:"Push 2 <explorer>/<town> to a<br>land without <incarna-behemoth>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.push({amount:2,pieces:e.ExplorerOrTown,destinationFilter:a=>a.doesntHave(e.IncarnaBehemoth)})}}]},So={name:"Exaltation Of Grasping Roots",type:o.Unique,speed:d.Slow,energy:0,elements:[i.Moon,i.Fire,i.Earth,i.Plant],set:s.NatureIncarnate,target:c.Spirit,targetFilter:[m.Another],effects:[{textArea:[.699,.79],text:"Target Spirit may Add 1 <wilds> in one of their lands.",[r.TargetSpirit]:async({$:e,spirit:a})=>{await a.inLands().optionallyPickOne((async a=>{await a.add(1,e.Wilds)}),{players:[a]})}},{textArea:[.807,.848],text:"You may do likewise.",[r.TargetSpirit]:async({$:e,you:a})=>{await a.inLands().optionallyPickOne((async a=>{await a.add(1,e.Wilds)}))}}]},Oo={name:"Smash, Stomp, And Flatten",type:o.Innate,speed:d.Slow,set:s.NatureIncarnate,target:c.Land,targetFilter:[l.IncarnaBehemoth],range:0,hasPushOrGather:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{text:"2 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(2)},threshold:{[i.Fire]:2,[i.Earth]:1}},{effects:[{text:"1 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(1)}},{text:"Push 1 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushOne(e.Dahan)}}],threshold:{[i.Fire]:3,[i.Earth]:1,[i.Plant]:1}},{effects:[{text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{text:"1 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(1)}}],threshold:{[i.Fire]:4,[i.Earth]:2,[i.Plant]:1}},{effects:[{text:"2 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(2)}},{text:"2 Damage to <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.damage(2,e.Dahan)}}],threshold:{[i.Fire]:5,[i.Earth]:2,[i.Plant]:2}},{text:"If <incarna-behemoth> is empowered, you may Repeat this Power once each turn. (You may take other Actions before repeating, including the Behemoth Rises.)",[r.InTargetLand]:async({$:e,you:a,isRepeat:t,...n})=>{!t&&a.hasEmpoweredIncarna&&null!=a.incarna&&(e.hasEffectNamed("Prevent Repeat Smash and Stomp")||(await e.addEffectUntilEndOfTurn({name:"Prevent Repeat Smash and Stomp"}),await e.addEffectUntilEndOfActionTree({[r.ActionEnds]:async()=>{await n.power.replay(d.Slow)}})))}}]},Co={name:"Surging Lahar",type:o.Unique,speed:d.Slow,energy:2,elements:[i.Fire,i.Water,i.Earth],set:s.NatureIncarnate,target:c.Land,range:1,sourceFilter:[l.SacredSite],hasDamageInstructions:!0,effects:[{textArea:[.724,.765],text:"2 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(2)}},{textArea:[.788,.829],text:"If your <presence> is present, Add 1 <badlands>.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{t.hasPresenceOf(a)&&await t.add(1,e.Badlands)}}]},Do={name:"Terrifying Rampage",type:o.Unique,speed:d.Fast,energy:1,elements:[i.Moon,i.Fire,i.Earth],set:s.NatureIncarnate,target:c.Land,range:1,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.637,.677],text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.631,.858],text:"2 Invaders don't participate in Ravage. (Choose the Invaders when ravaging; they don't deal Damage or take counterattack Damage.)",[r.InTargetLand]:async({$:e,land:a,effect:t})=>{await e.addSubEffectUntilEndOfTurn({[r.Reminder]:e=>e===a?t.text:void 0,[r.DoesNotParticipateInRavage]:async({location:t})=>{t===a&&await t.doNotParticipateInRavage({quantifier:w.Exactly,amount:2,pieces:e.Invader})}})}},{textArea:[.871,.911],text:"Push 3 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.push({amount:3,pieces:e.Dahan})}}]},Bo={name:"Emerge From The Dread Night Wind",type:o.Unique,speed:d.Slow,energy:1,elements:[i.Moon,i.Air],set:s.NatureIncarnate,target:c.Land,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.651,.692],text:"Add/Move <incarna-darkness> to target land.",[r.InTargetLand]:async({you:e,land:a})=>{e.hasIncarna?await e.incarna.move({locations:{target:g.ToThisLocation,location:a}}):await a.addIncarna(p.IncarnaDarkness,e)}},{textArea:[.71,.751],text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.715,.843],text:"If exactly 1 Invader is present, Abduct it. Otherwise, Push up to 2 <explorer>/<town> to different lands.",[r.InTargetLand]:async({$:e,land:a})=>{a.hasExactly(1,e.Invader)?await a.invaders().anyOne.abduct():await a.push({amount:2,quantifier:w.UpTo,pieces:e.ExplorerOrTown,differentLands:!0})}},{textArea:[.857,.898],text:"Push up to 2 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(2,e.Dahan)}}]},ko={name:"Leave A Trail Of Deathly Silence",type:o.Innate,speed:d.Fast,set:s.NatureIncarnate,target:c.Spirit,targetFilter:[m.Yourself],hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{effects:[{text:"1 Damage at <incarna-darkness>.",[r.TargetSpirit]:async({spirit:e})=>{await(e.incarna?.location?.damage(1))}},{text:"You may Push <incarna-darkness>.",[r.TargetSpirit]:async({spirit:e})=>{await(e.incarna?.push({quantifier:w.May}))}}],threshold:{[i.Moon]:2,[i.Animal]:1}},{effects:[{text:"1 Damage at <incarna-darkness>.",[r.TargetSpirit]:async({spirit:e})=>{await(e.incarna?.location?.damage(1))}},{text:"You may Push <incarna-darkness>.",[r.TargetSpirit]:async({spirit:e})=>{await(e.incarna?.push({quantifier:w.May}))}}],threshold:{[i.Moon]:3,[i.Air]:1,[i.Animal]:1}},{effects:[{text:"1 Damage at <incarna-darkness>.",[r.TargetSpirit]:async({spirit:e})=>{await(e.incarna?.location?.damage(1))}},{text:"You may Push <incarna-darkness>.",[r.TargetSpirit]:async({spirit:e})=>{await(e.incarna?.push({quantifier:w.May}))}}],threshold:{[i.Moon]:4,[i.Air]:2,[i.Animal]:2}},{text:"Move <incarna-darkness> to the <endless-dark>. It Brings 1 Invader (from it's land).",[r.TargetSpirit]:async({$:e,spirit:a})=>{const t=await(a.incarna?.move({locations:{target:g.ToThisLocation,location:e.theEndlessDark}}));void 0!==t&&t.length>0&&await t[0].source.move({amount:1,pieces:e.Invader,locations:{target:g.ToThisLocation,location:e.theEndlessDark}})},threshold:{[i.Moon]:5,[i.Air]:2,[i.Animal]:3}}]},Lo={name:"Lost In The Endless Dark",type:o.Innate,speed:d.Slow,set:s.NatureIncarnate,target:c.Land,targetFilter:[l.TheEndlessDark],range:0,generatesFear:!0,effects:[{effects:[{text:"1 <fear> per Invader (max. 4).",[r.InTargetLand]:async({$:e,land:a})=>{await a.fear(Math.min(a.numberOf(e.Invader),4))}},{text:"You may Downgrade 1 Invader. (Downgrading Removes <explorer>.)",[r.InTargetLand]:async({$:e,land:a})=>{await a.downgrade({amount:1,quantifier:w.May,pieces:e.Invader})}}],threshold:{[i.Moon]:2,[i.Air]:1}},{effects:[{text:"1 <fear> per Invader (max. 4).",[r.InTargetLand]:async({$:e,land:a})=>{await a.fear(Math.min(a.numberOf(e.Invader),4))}},{text:"Downgrade any number of Invaders",[r.InTargetLand]:async({$:e,land:a})=>{await a.downgrade({quantifier:w.Any,pieces:e.Invader})}}],threshold:{[i.Moon]:4,[i.Air]:3}},{text:"Add <beasts>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Beasts)},threshold:{[i.Moon]:3,[i.Animal]:2}}]},Fo={name:"Reach From The Infinite Darkness",type:o.Unique,speed:d.Fast,energy:0,elements:[i.Moon,i.Air,i.Animal],set:s.NatureIncarnate,target:c.Spirit,targetFilter:[m.Yourself],effects:[{textArea:[.607,.792],text:"Abduct up to 2 <presence> (of any Spirits, with their permission) from any lands on the island, ignoring land type restrictions on moving <presence>.",[r.TargetSpirit]:async({$:e})=>{await e.forPiecesThatIs(e.Presence).pickMultiple({amount:2,optional:!0,forPickedItem:async e=>{await e.abduct()}})}},{textArea:[.802,.94],text:"Each Spirit's <presence> in the <endless-dark> grants them <range+1> with all their Powers (this turn).",[r.TargetSpirit]:async({$:e,power:a})=>{await e.addSubEffectUntilEndOfTurn({[r.GlobalReminder]:()=>({power:a.power}),[r.ExtraRange]:a=>e.theEndlessDark.numberOfPresenceOf(a.spirit)})}}]},Ro={name:"Swallowed By The Endless Dark",type:o.Unique,speed:d.Fast,energy:1,elements:[i.Moon,i.Air,i.Water],set:s.NatureIncarnate,target:c.Land,targetFilter:[l.Invaders],range:0,generatesFear:!0,effects:[{textArea:[.674,.715],text:"2 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.674,.715],text:"Abduct 1 <explorer>",[r.InTargetLand]:async({$:e,land:a})=>{await a.abduct(1,e.Explorer)}},{textArea:[.79,.938],text:"If you have 3 <moon> 3 <air>:<br>Abduct 1 Invader.",[r.InTargetLand]:async({you:e,land:a})=>{await e.askToConvertElements({[i.Moon]:3,[i.Air]:3})&&await a.abduct(1)}}]},No={name:"Terror Of The Hunted",type:o.Unique,speed:d.Slow,energy:1,elements:[i.Moon,i.Fire,i.Animal],set:s.NatureIncarnate,target:c.Land,targetFilter:[l.Invaders],range:0,generatesFear:!0,effects:[{textArea:[.624,.718],text:"If <beasts> are present, 1 <fear> and Add 1 <strife>.",[r.InTargetLand]:async({$:e,land:a})=>{a.has(e.Beasts)&&(await a.fear(1),await a.addStrife(1))}},{textArea:[.729,.77],text:"Add 1 <strife> per Terror Level.",[r.InTargetLand]:async({$:e,land:a})=>{await a.addStrife(e.terrorLevel)}},{textArea:[.791,.923],text:"If target land is the <endless-dark>, Add 1 <strife>. (<strife> only Escapes with the Invader it's attached to.)",[r.InTargetLand]:async({land:e})=>{e.isEndlessDark&&await e.addStrife(1)}}]},$o={name:"Earth Shudders Buildings Fall",type:o.Innate,speed:d.Slow,set:s.NatureIncarnate,target:c.Land,targetFilter:[l.Quake],range:0,generatesFear:!0,hasDamageInstructions:!0,fullText:["Power Cards is the # of Power Cards you have in play.","Threshold 2 <fire> 3 <earth> 3 Power Cards","2 Damage per <quake>, to <town>/<city> only.","Threshold 3 <fire> 4 <earth> 5 Power Cards","1 <fear>. In any number of lands with <quake>: 2 Damage per <quake>, to <town>/<city> only. Remove 1 <quake>.","Threshold 4 <fire> 5 <earth> 7 Power Cards","2 <fear>. In each land where you removed <quake>: 1 Damage to each Invader."],effects:[{text:"3 Power Cards: 2 Damage per <quake>, to <town>/<city> only.",[r.InTargetLand]:async({$:e,land:a})=>{await a.damage(2*a.numberOf(e.Quake),e.TownOrCity)},threshold:{[i.Fire]:2,[i.Earth]:3},powerOwnerThresholdCondition:e=>e.numberOfPowerCardsInPlay>=3},{effects:[{text:"5 Power Cards: 1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{text:"In any number of lands with <quake>: 2 Damage per <quake>, to <town>/<city> only. Remove 1 <quake>.",[r.InTargetLand]:async({$:e,action:a})=>{a.data.removement=[],await e.inLandsWithAllOf(e.Quake,e.Invader).pickMultiple({optional:!0,amount:e.inLandsWithAllOf(e.Quake,e.Invader).count,forPickedItem:async t=>{await t.damage(2*t.numberOf(e.Quake),e.TownOrCity),a.data.removement.push(...await t.removeOne(e.Quake))}})}}],threshold:{[i.Fire]:3,[i.Earth]:4},powerOwnerThresholdCondition:e=>e.numberOfPowerCardsInPlay>=5},{effects:[{text:"7 Power Cards: 2 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(2)}},{text:"In each land where you removed <quake>: 1 Damage to each Invader.",[r.InTargetLand]:async({$:e,action:a})=>{const t=An.createCollection(e,a.data.removement.map((e=>e.location)));await t.selectOrder().forEach((async e=>{await e.damageEach(1)}))}}],threshold:{[i.Fire]:4,[i.Earth]:5},powerOwnerThresholdCondition:e=>e.numberOfPowerCardsInPlay>=7}]},Wo={name:"Exaltation Of Echoed Steps",type:o.Unique,speed:d.Slow,energy:1,elements:[i.Moon,i.Water,i.Earth],set:s.NatureIncarnate,target:c.Spirit,targetFilter:[m.Another],hasPushOrGather:!0,effects:[{textArea:[.702,.791],text:"Target Spirit may Push 1 <presence>, Bringing up to 1 <explorer>/<town>/<dahan>/<beasts>.",[r.TargetSpirit]:async({$:e,spirit:a})=>{await a.presence().optionallyPickOne((async a=>{const t=a.location,n=await a.push();n.length>0&&await t.push({quantifier:w.UpTo,amount:1,pieces:e.ExplorerTownOrDahan,locations:{target:g.ToThisLocation,location:n[0].destination}})}))}},{textArea:[.808,.848],text:"You may do likewise.",[r.TargetSpirit]:async({$:e,you:a})=>{await a.presence().optionallyPickOne((async a=>{const t=a.location,n=await a.push();n.length>0&&await t.push({quantifier:w.UpTo,amount:1,pieces:e.ExplorerTownDahanOrBeasts,locations:{target:g.ToThisLocation,location:n[0].destination}})}))}}]},Mo={name:"Gift Of Seismic Energy",type:o.Unique,speed:d.Fast,energy:3,elements:[i.Sun,i.Fire,i.Earth,i.Plant],set:s.NatureIncarnate,target:c.Spirit,effects:[{textArea:[.624,.713],text:"If you target yourself, gain 3 Energy.",[r.TargetSpirit]:async({you:e,spirit:a})=>{a===e&&await a.gainEnergy(3)}},{textArea:[.726,.929],text:"Otherwise, target Spirit gains 1 Energy per Power Card you have in play (max. 6).<br>(Don't count <impending>.)",[r.TargetSpirit]:async({you:e,spirit:a})=>{a!==e&&await a.gainEnergy(Math.min(e.numberOfPowerCardsInPlay,6))}}]},Go={name:"Inspire A Winding Dance",type:o.Unique,speed:d.Slow,energy:0,elements:[i.Moon,i.Water,i.Earth,i.Animal],set:s.NatureIncarnate,target:c.Land,targetFilter:[l.Invaders],range:1,hasPushOrGather:!0,effects:[{textArea:[.724,.765],text:"Push up to 1 <explorer>/<town>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(1,e.ExplorerOrTown)}},{textArea:[.785,.826],text:"Gather up to 1 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(1,e.Dahan)}}]},Ho={name:"Land Creaks With Tension",type:o.Innate,speed:d.Fast,set:s.NatureIncarnate,target:c.Spirit,targetFilter:[m.Yourself],effects:[{text:"If you have at least 1 <impending>, Add 1 <quake> in one of your lands.",[r.TargetSpirit]:async({$:e,spirit:a})=>{a.numberOfImpendingCards>=1&&await a.inLands().pickOne((async a=>{await a.add(1,e.Quake)}))},threshold:{[i.Earth]:1}},{text:"In one of your lands, Defend 1 per <impending> (max. 3).",[r.TargetSpirit]:async({spirit:e})=>{e.numberOfImpendingCards>=1&&await e.inLands().pickOne((async a=>{await a.defend(Math.min(e.numberOfImpendingCards,3))}))},threshold:{[i.Moon]:1,[i.Earth]:1}},{text:"If you have at least 3 <impending>, Add 1 <quake> in one of your lands.",[r.TargetSpirit]:async({$:e,spirit:a})=>{a.numberOfImpendingCards>=3&&await a.inLands().pickOne((async a=>{await a.add(1,e.Quake)}))},threshold:{[i.Moon]:1,[i.Earth]:2}},{text:"In one of your lands, Defend 1 per <impending> (max. 3).",[r.TargetSpirit]:async({spirit:e})=>{e.numberOfImpendingCards>=1&&await e.inLands().pickOne((async a=>{await a.defend(Math.min(e.numberOfImpendingCards,3))}))},threshold:{[i.Moon]:2,[i.Earth]:3}}]},Uo={name:"Radiating Tremors",type:o.Unique,speed:d.Slow,energy:2,elements:[i.Moon,i.Fire,i.Earth],set:s.NatureIncarnate,target:c.Land,range:0,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{textArea:[.679,.72],text:"2 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(2)}},{textArea:[.738,.871],text:"You may Push any number of <quake>, dividing them as evenly as possible between adjacent lands.",[r.InTargetLand]:async({$:e,land:a})=>{await a.push({quantifier:w.Any,pieces:e.Quake,evenly:!0})}}]},qo={name:"Resounding Footfalls Sow Dismay",type:o.Unique,speed:d.Fast,energy:3,elements:[i.Fire,i.Air,i.Earth],set:s.NatureIncarnate,target:c.Land,range:0,generatesFear:!0,effects:[{textArea:[.693,.734],text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.752,.793],text:"Add 1 <quake>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Quake)}},{textArea:[.815,.856],text:"Skip all Ravage Actions.",[r.InTargetLand]:async({land:e})=>{await e.skipInvaderAction({all:!0,filter:({invaderAction:e})=>e===K.Ravage})}}]},jo={name:"Rumblings Portend A Greater Quake",type:o.Unique,speed:d.Fast,energy:1,elements:[i.Sun,i.Moon,i.Air,i.Earth],set:s.NatureIncarnate,target:c.Land,range:1,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.679,.818],text:"If you have at least as many <impending> as Power Cards in play, 1 <fear> and Add 1 <quake>.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{a.numberOfImpendingCards>=a.numberOfPowerCardsInPlay&&(await t.fear(1),await t.add(1,e.Quake))}},{textArea:[.829,.87],text:"Push up to 3 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(3,e.Dahan)}}]},Jo={name:"Blinding Glare",type:o.Unique,speed:d.Fast,energy:0,elements:[i.Sun,i.Air],set:s.NatureIncarnate,target:c.Land,range:0,targetFilter:[l.Invaders],generatesFear:!0,effects:[{textArea:[.59,.946],text:"2 <fear>.<or>Skip up to one Ravage Action.<br><br>If you have 5 <sun><br>Instead, 3 <fear>.<or>Skip up to one Invader Action.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{const n=await a.askToConvertElements({[i.Sun]:5})?3:2;await e.chooseBetween({effects:[{actionId:"Fear",text:`${n} <fear>.`,textArea:2===n?[.593,.634]:[.815,.856],[r.Now]:async()=>{await t.fear(n)}},{actionId:"SkipRavage",textArea:2===n?[.682,.723]:[.896,.937],text:`Skip up to one ${2===n?"Ravage":"Invader"} Action.`,[r.Now]:async()=>{await t.skipInvaderAction({filter:({invaderAction:e})=>2===n&&e===K.Ravage||3===n})}}]})}}]},Vo={name:"Consider A Harmonious Nature",type:o.Innate,speed:d.Fast,set:s.NatureIncarnate,target:c.Spirit,targetFilter:[m.Yourself],hasDestroyInstructions:!0,effects:[{text:"When your Powers would add <blight> you may Destroy 1 <presence> instead (there or elsewhere).",[r.TargetSpirit]:async({$:e,you:a})=>{await e.addSubEffectUntilEndOfTurn({[r.GlobalReminder]:()=>({icon:"-1 <blight><br>+1 <broken>",spirit:a,players:[a]}),[r.PreventAddBlight]:async()=>!(e.action.spirit!==a||!await e.may({prompt:"Destroy 1 <presence> to prevent <blight>?"}))&&(await a.destroyPresence(1),!0)})},threshold:{[i.Sun]:3,[i.Moon]:1}},{text:"Your Powers don't damage or destroy <dahan>.",[r.TargetSpirit]:async({$:e,you:a})=>{await e.addSubEffectUntilEndOfTurn({[r.GlobalReminder]:()=>({icon:"<dahan><br>No <damage>",spirit:a,players:[a]}),[r.PreventRemovePiece]:({piece:t,removement:n})=>Promise.resolve(e.action.spirit===a&&t.isA(e.Dahan)&&x[n].isDestroyLike),[r.PreventDamagingPiece]:({piece:t})=>Promise.resolve(e.action.spirit===a&&t.isA(e.Dahan))})},threshold:{[i.Sun]:3,[i.Water]:1}},{text:"Choose another Spirit. They Add 1 <broken> to one of your lands.",[r.TargetSpirit]:async({$:e,you:a,action:t})=>{await e.fromAllSpirits().pickOne((async e=>{t.data.harmoniousSpirit=e,await e.addPresence({locations:g.AnyLands,destroyed:!0,filter:e=>e.hasPresenceOf(a)})}))},threshold:{[i.Sun]:3,[i.Plant]:1}},{text:"Give up to 3 of your Energy to the chosen Spirit.",[r.TargetSpirit]:async({$:e,you:a,action:t})=>{await e.chooseBetween({effects:[0,1,2,3].map((e=>({actionId:`Give${e}Energy`,text:`Give ${e} Energy`,[r.Now]:async()=>{await a.loseEnergy(e),await t.data.harmoniousSpirit.gainEnergy(e)},condition:()=>a.energy>=e})))})},threshold:{[i.Sun]:3,[i.Water]:1,[i.Plant]:1}}]},Yo={name:"Focus The Suns Rays",type:o.Unique,speed:d.Slow,energy:0,elements:[i.Sun,i.Fire,i.Air],set:s.NatureIncarnate,target:c.Land,sourceFilter:[l.SacredSite],range:2,hasDamageInstructions:!0,effects:[{textArea:[.659,.699],text:"1 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(1)}},{textArea:[.659,.699],text:"2 Damage to <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.damage(2,e.Dahan)}},{textArea:[.717,.894],text:"Move up to 3 <presence> directly to target land (from anywhere on the island). You may Bring 1 <badlands> (total) with those <presence>.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{let n=!1;await a.presence().pickMultiple({amount:3,optional:!0,forPickedItem:async a=>{const r=a.location;if(await a.move({locations:{target:g.ToThisLocation,location:t}}),!n){(await r.move({quantifier:w.May,amount:1,pieces:e.Badlands,locations:{target:g.ToThisLocation,location:t},pickPiecesEffect:{text:"You may Bring 1 <badlands> (total) with those <presence>."}})).length>0&&(n=!0)}},repeatSame:!0})}}]},zo={name:"Scorching Convergence",type:o.Innate,speed:d.Slow,set:s.NatureIncarnate,target:c.Land,sourceFilter:[l.SacredSite],range:1,generatesFear:!0,hasDamageInstructions:!0,specifyOrigin:!0,effects:[{effects:[{text:"Move all of your <presence> from origin land directly to target land.",[r.InTargetLand]:async({$:e,you:a,land:t,origin:n})=>{await(n?.move({quantifier:w.All,pieces:e.Presence,owner:a,locations:{target:g.ToThisLocation,location:t}}))}},{text:"1 Damage, to <town>/<city> only.",[r.InTargetLand]:async({$:e,land:a,action:t})=>{const n=await a.damage(1,e.TownOrCity);t.data.destroyedInvaders=t.data.destroyedInvaders||n.length>0}}],threshold:{[i.Sun]:2}},{effects:[{text:"3 Damage to Invaders.",[r.InTargetLand]:async({land:e,action:a})=>{const t=await e.damage(3);a.data.destroyedInvaders=a.data.destroyedInvaders||t.length>0}},{text:"3 Damage to Dahan.",[r.InTargetLand]:async({$:e,land:a})=>{await a.damage(3,e.Dahan)}},{text:"Add 1 <blight> without cascading.",[r.InTargetLand]:async({land:e})=>{await e.addBlight(1,{mayCascade:!1})}}],threshold:{[i.Sun]:3,[i.Fire]:1}},{text:"3 <fear> if this Power destroyed any Invaders.",[r.InTargetLand]:async({land:e,action:a})=>{a.data.destroyedInvaders&&await e.fear(3)},threshold:{[i.Sun]:4,[i.Fire]:2,[i.Air]:1}},{text:"1 Damage per remaining <presence> of yours in target land.",[r.InTargetLand]:async({you:e,land:a})=>{await a.damage(a.numberOfPresenceOf(e))},threshold:{[i.Sun]:5,[i.Fire]:3,[i.Air]:2}}]},Qo={name:"Unbearable Gaze",type:o.Unique,speed:d.Slow,energy:1,elements:[i.Sun,i.Fire],set:s.NatureIncarnate,target:c.Land,range:1,sourceFilter:[l.SacredSite],hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.693,.734],text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.763,.854],text:"Push 2 <explorer>/<town> from origin or target land (or 1 <explorer>/<town> from each).",[r.InTargetLand]:async({$:e,land:a,power:t})=>{let n=t.validOriginsGivenTargetLand(a).items;const r=[];await te(2,(async()=>{await e.forPiecesWhere((t=>t.isA(e.ExplorerOrTown)&&!r.includes(t)&&(t.location===a||n.includes(t.location)))).pickOne((async e=>{e.location!==a&&(n=[e.location]),await e.push(),r.push(e)}))}))}}]},Ko={name:"Wither Bodies Scar Stones",type:o.Unique,speed:d.Slow,energy:1,elements:[i.Sun,i.Fire,i.Earth],set:s.NatureIncarnate,target:c.Land,sourceFilter:[l.SacredSite],range:2,hasDamageInstructions:!0,effects:[{textArea:[.685,.868],text:"1 Damage.<or>Add 1 <badlands>.",[r.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{textArea:[.69,.731],actionId:"Damage",text:"1 Damage.",[r.Now]:async()=>{await a.damage(1)}},{textArea:[.815,.856],actionId:"Badlands",text:"Add 1 <badlands>",[r.Now]:async()=>{await a.add(1,e.Badlands)}}]})}}]},Xo={name:"Call To Vigilance",type:o.Unique,speed:d.Slow,energy:2,elements:[i.Sun,i.Air,i.Animal],set:s.NatureIncarnate,target:c.Land,range:1,sourceFilter:[l.Dahan],hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.701,.742],text:"2 <fear> if Invaders are present.",[r.InTargetLand]:async({land:e})=>{e.hasInvaders&&await e.fear(2)}},{textArea:[.763,.852],text:"For each <dahan> in origin land, Push up to 1 <explorer>/<town>.",[r.InTargetLand]:async({$:e,land:a,power:t})=>{await t.validOriginsGivenTargetLand(a).autoPickOne((async t=>{await a.pushUpTo(t.numberOf(e.Dahan),e.ExplorerOrTown)}),{prompt:"Select origin land."})}}]},_o={name:"Coordinated Raid",type:o.Unique,speed:d.Slow,energy:1,elements:[i.Sun,i.Earth,i.Animal],set:s.NatureIncarnate,target:c.Land,sourceFilter:[l.Dahan],range:1,hasDamageInstructions:!0,effects:[{textArea:[.718,.759],text:"1 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(1)}},{textArea:[.785,.826],text:"If <dahan> are present, 1 Damage.",[r.InTargetLand]:async({$:e,land:a})=>{a.has(e.Dahan)&&await a.damage(1)}}]},Zo={name:"Favors Of Story And Season",type:o.Unique,speed:d.Fast,energy:1,elements:[i.Sun,i.Earth,i.Plant,i.Animal],set:s.NatureIncarnate,target:c.Spirit,targetFilter:[m.Another],hasPushOrGather:!0,effects:[{textArea:[.629,.718],text:"Target Spirit may Gather up to 3 <dahan> into one of their lands.",[r.TargetSpirit]:async({$:e,spirit:a})=>{await a.inLands().optionallyPickOne((async a=>{await a.gatherUpTo(3,e.Dahan)}))}},{textArea:[.738,.913],text:"If they have at least 3 <dahan> among their lands, they gain 1 Energy and may Reclaim 1 Power Card instead of discarding it at the end of turn.",[r.TargetSpirit]:async({$:e,power:a,spirit:t})=>{t.numberOfPiecesInLands(e.Dahan)>=3&&(await t.gainEnergy(1),await t.mayReclaimPowerCardInsteadOfDiscarding(a))}}]},ed={name:"Keep Watch For New Incursions",type:o.Innate,speed:d.Fast,set:s.NatureIncarnate,target:c.Land,sourceFilter:[l.SacredSiteAndDahan],range:1,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{text:"Gather up to 2 <dahan>, from your lands only.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await t.gather({quantifier:w.UpTo,amount:2,pieces:e.Dahan,filter:e=>e.hasPresenceOf(a)})},threshold:{[i.Animal]:1}},{text:"Once this turn after Invaders are added or moved into target land, 1 Damage per <dahan> in target land, to those added/moved Invaders only.",[r.InTargetLand]:async({$:e,land:a,...t})=>{await a.afterPiecesAreAddedOrMovedAddTrigger({pieces:e.Invader,trigger:{triggerId:e.nextTriggerId(),[r.Now]:async({action:t})=>{await a.damage(a.numberOf(e.Dahan),e.Invader,{filter:e=>t.parentData.piecesAddedOrMoved.includes(e)&&e.location===a})}},effect:t.effect,action:t.action,removeAfterTrigger:!0})},threshold:{[i.Sun]:1,[i.Air]:2,[i.Animal]:3}},{text:"Repeat this Power.",[r.InTargetLand]:async({power:e,isRepeat:a})=>{a||await e.repeat()},threshold:{[i.Sun]:2,[i.Air]:3,[i.Animal]:4}}]},ad={name:"Surrounded By The Dahan",type:o.Unique,speed:d.Fast,energy:0,elements:[i.Moon,i.Air,i.Animal],set:s.NatureIncarnate,target:c.Land,targetFilter:[l.Dahan],range:0,generatesFear:!0,effects:[{textArea:[.693,.733],text:"2 <fear> if Invaders are present.",[r.InTargetLand]:async({land:e})=>{e.hasInvaders&&await e.fear(2)}},{textArea:[.754,.795],text:"1 <fear> if <dahan> outnumber <town>/<city>.",[r.InTargetLand]:async({$:e,land:a})=>{a.the(e.Dahan).outnumber(e.TownOrCity)&&await a.fear(1)}},{textArea:[.817,.857],text:"Isolate target land.",[r.InTargetLand]:async({land:e})=>{await e.isolate()}}]},td={name:"Warn Of Impending Conflict",type:o.Innate,speed:d.Fast,set:s.NatureIncarnate,target:c.Spirit,targetFilter:[m.Yourself],effects:[{text:"In one of your lands, 1 <dahan> deals Damage before Invaders during Ravages. (Choose a land when Invaders Ravage there.)",[r.TargetSpirit]:async({$:e,spirit:a})=>{await e.addSubEffectUntilEndOfTurn({[r.GlobalReminder]:()=>({icon:"Ravage<br>1 <dahan>",spirit:a,players:[a]}),[r.DahanFightBeforeInvaders]:async t=>{t.land.hasPresenceOf(a)&&await t.land.piecesThatAre(e.Dahan).optionallyPickOne((async a=>{e.removeThisEffect(),await a.setFightsBeforeInvaders(!0)}))}})},threshold:{[i.Sun]:2,[i.Earth]:1}},{instead:!0,text:"In that land, another <dahan> deals Damage before Invaders during Ravages.",[r.TargetSpirit]:async({$:e,spirit:a})=>{await e.addSubEffectUntilEndOfTurn({[r.GlobalReminder]:()=>({icon:"Ravage<br>2 <dahan>",spirit:a,players:[a]}),[r.DahanFightBeforeInvaders]:async t=>{t.land.hasPresenceOf(a)&&await t.land.piecesThatAre(e.Dahan).pickMultiple({optional:!0,amount:2,forPickedItem:async a=>{e.removeThisEffect(),await a.setFightsBeforeInvaders(!0)},effect:{noOptions:`${a.nameLink} has no lands with <dahan>.`}})}})},threshold:{[i.Sun]:3,[i.Earth]:1}},{instead:!0,text:"In that land, all <dahan> deal Damage before Invaders during Ravages.",[r.TargetSpirit]:async({$:e,spirit:a})=>{await e.addSubEffectUntilEndOfTurn({[r.GlobalReminder]:()=>({icon:"Ravage<br>All <dahan>",spirit:a,players:[a]}),[r.DahanFightBeforeInvaders]:async t=>{t.land.hasPresenceOf(a)&&t.land.has(e.Dahan)&&await e.may({prompt:"Do damage before Invaders?"})&&(e.removeThisEffect(),await t.land.piecesThatAre(e.Dahan).forEach((async e=>{await e.setFightsBeforeInvaders(!0)})))}})},threshold:{[i.Sun]:4,[i.Earth]:2}},{instead:!0,text:"Instead, all <dahan> in all your lands does Damage before Invaders during Ravages.",label:"All <dahan> in all your lands.",[r.TargetSpirit]:async({$:e,spirit:a})=>{await e.addSubEffectUntilEndOfTurn({[r.GlobalReminder]:()=>({icon:"Ravage<br>All <dahan>",spirit:a,players:[a]}),[r.DahanFightBeforeInvaders]:async t=>{t.land.hasPresenceOf(a)&&await t.land.piecesThatAre(e.Dahan).forEach((async e=>{await e.setFightsBeforeInvaders(!0)}))}})},threshold:{[i.Sun]:5,[i.Earth]:3}}]},nd={name:"Blooming Of The Rocks And Trees",type:o.Unique,speed:d.Slow,energy:0,elements:[i.Sun,i.Air,i.Earth,i.Plant],set:s.NatureIncarnate,target:c.Land,sourceFilter:[l.SacredSite],range:1,effects:[{textArea:[.601,.934],text:"If no <blight> is present, Add 1 <vitality>.<or>If no Invaders are present, Add 1 <wilds>.<br><br>If you have 3 <plant>:<br>You may do both.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await e.chooseBetween({effects:[{actionId:"Vitality",textArea:[.612,.653],text:"If no <blight> is present, Add 1 <vitality>.",[r.Now]:async()=>{t.doesntHave(e.Blight)&&await t.add(1,e.Vitality)}},{actionId:"Wilds",textArea:[.732,.773],text:"If no Invaders are present, Add 1 <wilds>.",[r.Now]:async()=>{t.doesntHave(e.Invader)&&await t.add(1,e.Wilds)}},{actionId:"Both",textArea:[.891,.932],text:"Do both.",condition:()=>!e.treatingAllOrsAsAnds&&a.hasElementsWithConvert({[i.Plant]:3}),[r.Now]:async()=>{await a.convertElements({[i.Plant]:3}),t.doesntHave(e.Blight)&&await e.addSubEffect({textArea:[.612,.653],text:"If no <blight> is present, Add 1 <vitality>.",[r.Now]:async()=>{await t.add(1,e.Vitality)}}),t.doesntHave(e.Invader)&&await e.addSubEffect({textArea:[.732,.773],text:"If no Invaders are present, Add 1 <wilds>.",[r.Now]:async()=>{await t.add(1,e.Wilds)}})}}]})}}]},rd={name:"Boon Of Resilient Power",type:o.Unique,speed:d.Slow,energy:1,elements:[i.Sun,i.Moon,i.Water,i.Plant],set:s.NatureIncarnate,target:c.Spirit,effects:[{textArea:[.649,.752],text:"Target Spirit may Add 1 <broken> to one of your lands.",[r.TargetSpirit]:async({you:e,spirit:a})=>{await a.addPresence({filter:a=>a.hasPresenceOf(e),destroyed:!0,locations:g.AnyLands})}},{textArea:[.763,.899],text:"If you target yourself, gain a Major Power. Otherwise target Spirit gains a Power Card.",[r.TargetSpirit]:async({you:e,spirit:a})=>{a===e?await e.gainPowerCard({powerType:o.Major}):await a.gainPowerCard()}}]},id={name:"Entwine The Fates Of All",type:o.Unique,speed:d.Fast,energy:1,elements:[i.Moon,i.Water,i.Earth,i.Plant],set:s.NatureIncarnate,target:c.Spirit,effects:[{textArea:[.735,.821],text:"In one of target Spirit's lands, Defend 2 per <presence> (from all Spirits).",[r.TargetSpirit]:async({$:e,spirit:a})=>{await a.inLands().pickOne((async a=>{await a.defend(2*a.numberOf(e.Presence))}))}}]},sd={name:"Radiant And Hallowed Grove",type:o.Unique,speed:d.Fast,energy:2,elements:[i.Sun,i.Moon,i.Fire,i.Plant],set:s.NatureIncarnate,target:c.Land,targetFilter:[l.IncarnaRoots],generatesFear:!0,effects:[{textArea:[.607,.701],text:"2 <fear> if Invaders are present or adjacent.",[r.InTargetLand]:async({land:e})=>{e.piecesInThisAndAdjacentLocations().where((e=>e.isInvader)).count>0&&await e.fear(2)}},{textArea:[.718,.935],text:"In both target and one adjacent land, you may Remove an Invader with Health less than or equal to the Terror Level. (Damage doesn't reduce Health.)",[r.InTargetLand]:async({$:e,land:a})=>{await a.removeInvadersWorthOfHealthUpTo(e.terrorLevel),await a.inAdjacentLands().pickOne((async a=>{await a.removeInvadersWorthOfHealthUpTo(e.terrorLevel)}))}}]},od={name:"Revoke Sanctuary And Cast Out",type:o.Innate,speed:d.Slow,set:s.NatureIncarnate,target:c.Land,sourceFilter:[l.SacredSite],targetFilter:[l.InvadersAndIncarnaRoots],range:0,generatesFear:!0,effects:[{effects:[{text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{text:"Remove 1 <explorer>/<town>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.removeOne(e.ExplorerOrTown)}}],threshold:{[i.Sun]:1,[i.Moon]:1,[i.Plant]:2}},{effects:[{text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{text:"Remove 1 <explorer>/<town>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.removeOne(e.ExplorerOrTown)}}],threshold:{[i.Sun]:2,[i.Moon]:1,[i.Plant]:3}},{effects:[{text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{text:"Remove 1 Invader.",[r.InTargetLand]:async({$:e,land:a})=>{await a.removeOne(e.Invader)}}],threshold:{[i.Sun]:2,[i.Moon]:2,[i.Plant]:4}}]},dd={name:"Shelter Under Towering Branches",type:o.Innate,speed:d.Slow,set:s.NatureIncarnate,target:c.Land,sourceFilter:[l.SacredSite],range:0,hasPushOrGather:!0,effects:[{text:"Gather up to 1 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(1,e.Dahan)},threshold:{[i.Sun]:1,[i.Plant]:1}},{text:"Gather up to 1 <explorer>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(1,e.Explorer)},threshold:{[i.Sun]:1,[i.Earth]:1,[i.Plant]:2}},{text:"Gather up to 1 <town>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(1,e.Town)},threshold:{[i.Sun]:2,[i.Earth]:1,[i.Plant]:3}},{text:"Gather up to 1 <city>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(1,e.City)},threshold:{[i.Sun]:3,[i.Earth]:2,[i.Plant]:4}}]},cd={name:"Exhale Confusion And Delirium",type:o.Unique,speed:d.Fast,energy:0,elements:[i.Sun,i.Moon,i.Air,i.Animal],set:s.NatureIncarnate,target:c.Land,targetFilter:[l.Strife],range:1,generatesFear:!0,effects:[{textArea:[.624,.665],text:"2 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.683,.924],text:"Invaders with <strife> don't participate in Ravage. (Check when Ravaging; they don't do Damage or take counterattack Damage.)",[r.InTargetLand]:async({$:e,land:a,effect:t})=>{await e.addSubEffectUntilEndOfTurn({[r.Reminder]:e=>e===a?t.text:void 0,[r.DoesNotParticipateInRavage]:async({location:t})=>{t===a&&await t.doNotParticipateInRavage({pieces:e.Invader,pieceFilter:e=>e.strife>0})}})}}]},ld={name:"Frightful Keening",type:o.Unique,speed:d.Slow,energy:1,elements:[i.Sun,i.Fire,i.Air],set:s.NatureIncarnate,target:c.Land,targetFilter:[l.IncarnaVoice],hasPushOrGather:!0,generatesFear:!0,fullText:["Push <incarna-voice>.","If this pushes <incarna-voice> into a land with Invaders, 2 <fear> there (before adding <strife>)."],effects:[{textArea:[.674,.715],text:"Push <incarna-voice>.",[r.InTargetLand]:async({$:e,you:a,action:t})=>{a.incarna&&(await e.addSubEffectUntilEndOfAction({textArea:[.74,.874],text:"If this pushes <incarna-voice> into a land with Invaders, 2 <fear> there (before adding <strife>).",highPriority:!0,[r.AfterMoving]:async({piece:t,destination:n})=>{t.isA(e.IncarnaVoice)&&t.owner===a&&n.hasInvaders&&await n.fear(2)}}),t.data.movement=await a.incarna.push())}}]},hd={name:"Inscrutable Journeying",type:o.Innate,speed:d.Fast,set:s.NatureIncarnate,target:c.Spirit,targetFilter:[m.Yourself],hasPushOrGather:!0,effects:[{text:"You may Push <incarna-voice>.",[r.TargetSpirit]:async({spirit:e})=>{await(e.incarna?.push({quantifier:w.May}))},threshold:{[i.Air]:1}},{text:"You may Push <incarna-voice>.",[r.TargetSpirit]:async({spirit:e})=>{await(e.incarna?.push({quantifier:w.May}))},threshold:{[i.Air]:3}},{text:"You may Push <incarna-voice>.",[r.TargetSpirit]:async({spirit:e})=>{await(e.incarna?.push({quantifier:w.May}))},threshold:{[i.Air]:5}},{text:"Empower <incarna-voice>.",[r.TargetSpirit]:async({spirit:e})=>{await e.empowerIncarna()},threshold:{[i.Moon]:2,[i.Fire]:1,[i.Air]:4,[i.Plant]:1}}]},gd={name:"Mind Shattering Song",type:o.Innate,speed:d.Slow,set:s.NatureIncarnate,target:c.Land,sourceFilter:[l.SacredSite],targetFilter:[l.Strife],range:1,mayAlwaysDowngrade:!0,generatesFear:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{text:"1 <fear> per <moon> you have.",[r.InTargetLand]:async({you:e,land:a})=>{await e.askToConvertElementsToCombo({[i.Moon]:1}),await a.fear(e.elements[i.Moon])},threshold:{[i.Moon]:1,[i.Air]:2}},{text:"1 Damage per <sun> you have, to Invaders with <strife> only.",[r.InTargetLand]:async({$:e,you:a,land:t})=>{await t.damage(a.elements[i.Sun],e.Invader,{filter:e=>e.strife>0})},threshold:{[i.Sun]:1,[i.Air]:2}},{text:"For each <sun><moon> pair you have, Destroy 1 Invader with <strife>.",[r.InTargetLand]:async({you:e,land:a})=>{await e.askToConvertElementsToCombo({[i.Sun]:1,[i.Moon]:1}),await a.destroy({amount:e.numberOfElementCombos({[i.Sun]:1,[i.Moon]:1}),filter:e=>e.strife>0})},threshold:{[i.Moon]:1,[i.Sun]:1,[i.Air]:4}}]},fd={name:"Turmoil's Touch",type:o.Unique,speed:d.Slow,energy:0,elements:[i.Sun,i.Moon,i.Air,i.Plant],set:s.NatureIncarnate,target:c.Spirit,targetFilter:[m.Another],effects:[{textArea:[.66,.896],text:"Target Spirit may either pay 1 Energy or discard a Power Card (from hand) to Take a Minor Power into their discard. You  may do likewise.",[r.TargetSpirit]:async({$:e,you:a,spirit:t})=>{await t.andAnotherSpirit(a,{now:async(a,t)=>{await e.chooseBetween({text:`${t?"Target Spirit":"You"} may either pay 1 Energy or discard a Power Card (from hand) to Take a Minor Power into ${t?"their":"your"} discard.`,textArea:t?[.663,.832]:[.852,.893],effects:[{actionId:"Energy",text:"Pay 1 Energy to Take a Minor Power into their discard.",[r.Now]:async()=>{await a.payEnergy(1);const e=await a.gainPowerCard({powerType:o.Minor,drawAmount:1,taken:!0});for(const a of e.chosen)await a.discard()},condition:()=>a.energy>=1},{actionId:"DiscardPowerCard",text:"Discard a Power Card (from hand) to Take a Minor Power into their discard.",[r.Now]:async()=>{await a.discardPowerCards(1);const e=await a.gainPowerCard({powerType:o.Minor,drawAmount:1,taken:!0});for(const a of e.chosen)await a.discard()},condition:()=>a.numberOfPowerCardsInHand>0},{actionId:"Neither",text:"Neither.",[r.Now]:async()=>{}}]})}})}}]},ud={name:"Twist Perceptions",type:o.Unique,speed:d.Slow,energy:1,elements:[i.Moon,i.Air,i.Animal],set:s.NatureIncarnate,target:c.Land,targetFilter:[l.Invaders],range:1,hasPushOrGather:!0,fullText:["Add 1 <strife>.","You may Push the Invader you added <strife> to.","(If you add <strife> to <explorer>/<town>, you can push that Invader first with Senseless Roaming before pushing it with this Power.)"],effects:[{textArea:[.632,.673],text:"Add 1 <strife>.",[r.InTargetLand]:async({$:e,land:a})=>{const t=await a.addStrife(1);t.length>0&&await e.addSubEffect({textArea:[.629,.916],text:"You may Push the Invader you added <strife> to.<br><br>(If you add <strife> to <explorer>/<town>, you can push that Invader first with Senseless Roaming before pushing it with this Power.)",[r.Now]:async()=>{for(const e of t)await e.push({quantifier:w.May,pickPiecesEffect:{}})}})}}]},pd={name:"Afflict With Bloodthirst",type:o.Innate,speed:d.Fast,set:s.NatureIncarnate,target:c.Land,range:1,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{textArea:[.341,.381],text:"Gather 1 <beasts>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherOne(e.Beasts)},threshold:{[i.Animal]:1}},{textArea:[.423,.463],text:"2 <fear> if Invaders are present.",[r.InTargetLand]:async({land:e})=>{e.hasInvaders&&await e.fear(2)},threshold:{[i.Fire]:1,[i.Animal]:3}},{textArea:[.478,.597],text:"1 <explorer> and 1 <town>/<dahan> do Damage, to other Invaders only.",[r.InTargetLand]:async({$:e,land:a})=>{const t=[];for(const n of[e.Explorer,e.TownOrDahan])await a.piecesThatAre(n).autoPickOne((e=>(t.push(e),Promise.resolve())),{prompt:`Pick which ${ee[n].text} to do Damage to other Invaders.`});for(const n of t)await e.addSubEffect({highlightPieces:[n],[r.Now]:async()=>{await a.damage(n.strengthOutOfRavage,e.Invader,{filter:e=>e!==n})}})},threshold:{[i.Sun]:1,[i.Fire]:2,[i.Animal]:4}},{textArea:[.614,.698],text:"For each <beasts>: Push 1 <explorer> and 1 <town>/<dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.push({amount:a.numberOf(e.Beasts),pieces:e.Explorer}),await a.push({amount:a.numberOf(e.Beasts),pieces:e.TownOrDahan})},threshold:{[i.Fire]:1,[i.Animal]:2}}]},wd={name:"Blood Water And Bloodlust",type:o.Unique,speed:d.Slow,energy:1,elements:[i.Fire,i.Water,i.Animal],set:s.NatureIncarnate,target:c.Land,sourceFilter:[l.Blight],range:1,effects:[{textArea:[.752,.793],text:"Add 1 <beasts> and 1 <disease>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Beasts),await a.add(1,e.Disease)}}]},yd={name:"Boon Of Corrupted Blood",type:o.Unique,speed:d.Fast,energy:1,elements:[i.Sun,i.Fire,i.Animal],set:s.NatureIncarnate,target:c.Spirit,hasPushOrGather:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,fullText:["1 Damage in one of target Spirit's lands","If you target another Spirit, in that land also: Destroy 1 of their <presence>. 1 Damage. Gather 1 <beasts>."],effects:[{textArea:[.635,.724],text:"1 Damage in one of target Spirit's lands",[r.TargetSpirit]:async({$:e,you:a,spirit:t})=>{await t.inLands().pickOne((async n=>{await n.damage(1),t!==a&&await e.addSubEffect({effects:[{textArea:[.74,.871],text:"If you target another Spirit, in that land also: Destroy 1 of their <presence>.",[r.Now]:async()=>{await n.destroy({pieces:e.Presence,owner:t})}},{textArea:[.871,.912],text:"1 Damage.",[r.Now]:async()=>{await n.damage(1)}},{textArea:[.871,.912],text:"Gather 1 <beasts>.",[r.Now]:async()=>{await n.gatherOne(e.Beasts)}}]})}))}}]},md={name:"Call To A Fastness Of Renewal",type:o.Innate,speed:d.Fast,set:s.NatureIncarnate,target:c.Land,range:1,hasPushOrGather:!0,effects:[{textArea:[.348,.388],text:"Gather up to 2 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(2,e.Dahan)},threshold:{[i.Water]:1}},{textArea:[.423,.463],text:"Defend 3 or Downgrade 1 Invader.",[r.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"Defend",text:"Defend 3",[r.Now]:async()=>{await a.defend(3)}},{actionId:"Downgrade",text:"Downgrade 1 Invader.",[r.Now]:async()=>{await a.downgrade()}}]})},threshold:{[i.Water]:2,[i.Plant]:1}},{textArea:[.504,.544],text:"Add 1 <beasts>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Beasts)},threshold:{[i.Water]:3,[i.Plant]:1}},{textArea:[.565,.657],text:"If at least 2 <dahan> are present, Replace 1 Invader with 1 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{a.hasAtLeast(2,e.Dahan)&&await a.replaceOne({pieces:e.Invader,withPiece:p.Dahan})},threshold:{[i.Sun]:1,[i.Water]:4,[i.Plant]:2}}]},vd={name:"Draw To The Water's Edge",type:o.Unique,speed:d.Fast,energy:1,elements:[i.Sun,i.Water,i.Plant],set:s.NatureIncarnate,target:c.Land,range:0,hasPushOrGather:!0,effects:[{textArea:[.729,.818],text:"Gather up to 2 <town> from a single land.",[r.InTargetLand]:async({$:e,land:a})=>{await a.gather({quantifier:w.UpTo,pieces:e.Town,amount:2,single:!0})}}]},Id={name:"Sanguinary Taint",type:o.Innate,speed:d.Slow,set:s.NatureIncarnate,target:c.Land,range:1,hasPushOrGather:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{effects:[{text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{text:"1 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(1)}},{text:"Push 1 <dahan>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushOne(e.Dahan)}}],threshold:{[i.Animal]:2}},{effects:[{text:"1 Damage",[r.InTargetLand]:async({land:e})=>{await e.damage(1)}},{text:"Add 1 <beasts>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Beasts)}}],threshold:{[i.Water]:1,[i.Animal]:3}},{effects:[{text:"1 <fear>",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{text:"4 Damage.",[r.InTargetLand]:async({land:e})=>{await e.damage(4)}},{text:"Add 1 <disease>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Disease)}}],threshold:{[i.Fire]:2,[i.Water]:2,[i.Animal]:5}}]},Ad={name:"Swirl And Spill",type:o.Innate,speed:d.Slow,set:s.NatureIncarnate,target:c.Land,range:1,hasPushOrGather:!0,generatesFear:!0,effects:[{text:"Push up to 2 <explorer>/<dahan>/<blight>.",[r.InTargetLand]:async({$:e,land:a,action:t})=>{t.data.movements=[],t.data.movements.push(...await a.pushUpTo(2,e.ExplorerDahanOrBlight))},threshold:{[i.Water]:2}},{effects:[{text:"1 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(1)}},{text:"Push up to 2 <town>/<presence>/<beasts>.",[r.InTargetLand]:async({$:e,land:a,action:t})=>{t.data.movements.push(...await a.pushUpTo(2,e.TownPresenceOrBeasts))}}],threshold:{[i.Water]:3,[i.Animal]:1}},{text:"In one land pushed into, Downgrade all <town> and all <city>.",[r.InTargetLand]:async({$:e,action:a})=>{const t=a.data.movements.map((e=>e.destination));await An.createCollection(e,t).pickOne((async a=>{await a.downgrade({quantifier:w.All,pieces:e.TownOrCity})}))},threshold:{[i.Water]:5,[i.Plant]:2,[i.Animal]:2}}]},xd={name:"Wrack With Pain And Grief",type:o.Unique,speed:d.Slow,energy:1,elements:[i.Water,i.Plant,i.Animal],set:s.NatureIncarnate,target:c.Land,sourceFilter:[l.Blight],targetFilter:[l.Invaders],range:1,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.724,.765],text:"2 <fear>.",[r.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.782,.823],text:"Push 1 <explorer> and 1 <town>.",[r.InTargetLand]:async({$:e,land:a})=>{await a.pushOne(e.Explorer),await a.pushOne(e.Town)}}]},bd={[_e.ACircuitousAndWendingJourney]:mi,[_e.ADreadfulTideOfScurryingFlesh]:Es,[_e.AYearOfPerfectStillness]:Jn,[_e.AbsoluteStasis]:hs,[_e.AbsorbCorruption]:Wa,[_e.AbsorbEssence]:Pi,[_e.AcceleratedRot]:h,[_e.AfflictWithBloodthirst]:pd,[_e.AidFromTheSpiritspeakers]:vi,[_e.AirMovesEarthEndures]:Js,[_e.AllEnvelopingGreen]:sr,[_e.AngryBears]:ue,[_e.AnimatedWrackroot]:Ma,[_e.AsphyxiatingSmoke]:Li,[_e.BargainOfCoursingPaths]:Ge,[_e.BargainsOfPowerAndProtection]:we,[_e.BatsScoutForRaidsByDarkness]:pt,[_e.BelligerentAndAggressiveCrops]:or,[_e.BesetAndConfoundTheInvaders]:Ps,[_e.BirdsCryWarning]:wt,[_e.BlazingIntimidation]:Po,[_e.BlazingRenewal]:f,[_e.BlindingGlare]:Jo,[_e.BloodDrawsPredators]:yt,[_e.BloodWaterAndBloodlust]:wd,[_e.BloodwrackPlague]:U,[_e.BloomingOfTheRocksAndTrees]:nd,[_e.BlurTheArcOfYears]:gs,[_e.BombardWithBouldersAndStingingSeeds]:He,[_e.BoonOfAncientMemories]:ks,[_e.BoonOfCorruptedBlood]:yd,[_e.BoonOfGrowingPower]:si,[_e.BoonOfReimagining]:Vs,[_e.BoonOfResilientPower]:rd,[_e.BoonOfSunshinesPromise]:kr,[_e.BoonOfSwarmingBedevilment]:Ss,[_e.BoonOfVigor]:Lr,[_e.BoonOfWatchfulGuarding]:Gi,[_e.CallOfTheDahanWays]:ta,[_e.CallOfTheDeeps]:Tr,[_e.CallOnHerdersForAid]:Ji,[_e.CallOnMidnightsDream]:Wn,[_e.CallToAFastnessOfRenewal]:md,[_e.CallToASunlitHaven]:Fr,[_e.CallToBloodshed]:na,[_e.CallToFerocity]:Ga,[_e.CallToGuard]:mt,[_e.CallToIsolation]:ra,[_e.CallToMigrate]:ia,[_e.CallToTend]:sa,[_e.CallToTrade]:Ha,[_e.CallToVigilance]:Xo,[_e.CarapacedLand]:vt,[_e.CastDownIntoTheBrinyDeep]:j,[_e.CleansingFloods]:u,[_e.CloseTheWays]:Ii,[_e.ConcealingShadows]:Mr,[_e.ConfoundingMists]:Ua,[_e.ConsiderAHarmoniousNature]:Vo,[_e.CoordinatedRaid]:_o,[_e.CreepersTearIntoMortar]:dr,[_e.CropsWitherAndFade]:Gr,[_e.CyclesOfTimeAndTide]:qa,[_e.DarkAndTangledWoods]:oa,[_e.DarkSkiesLooseAStingingRain]:gi,[_e.DarknessSwallowsTheUnwary]:Hr,[_e.DeathApproachesFromBeneathTheSurface]:as,[_e.DeathFallsGentlyFromOpenBlossoms]:J,[_e.DelusionsOfDanger]:da,[_e.DesiccatingWinds]:It,[_e.DevouringAnts]:ca,[_e.DireMetamorphosis]:At,[_e.DisorientingLandscape]:ja,[_e.DissolveTheBondsOfKinship]:y,[_e.DissolvingVapors]:Ms,[_e.DomesticatedAnimalsGoBerserk]:xt,[_e.DrawOfTheFruitfulEarth]:Vn,[_e.DrawToTheWatersEdge]:vd,[_e.DrawTowardsAConsumingVoid]:me,[_e.DreadApparitions]:Mn,[_e.DreamOfTheUntouchedLand]:ve,[_e.DreamsOfTheDahan]:Gn,[_e.DriftDownIntoSlumber]:la,[_e.Drought]:ha,[_e.DryWoodExplodesInSmolderingSplinters]:bt,[_e.EarthMovesWithVigorAndMight]:er,[_e.EarthShuddersBuildingsFall]:$o,[_e.EerieNoisesAndMovingTrees]:Hi,[_e.ElementalAegis]:Si,[_e.ElementalBoon]:ga,[_e.ElementalTeachings]:Ls,[_e.ElusiveAmbushes]:Ja,[_e.EmergeFromTheDreadNightWind]:Bo,[_e.EncircleTheUnsuspectingPrey]:Zr,[_e.EncompassingWard]:fa,[_e.EnticingAndLullingDreams]:Ur,[_e.EnticingSplendor]:ua,[_e.EntrancingApparitions]:pa,[_e.EntrapTheForcesOfCorruption]:Tt,[_e.EntwineTheFatesOfAll]:id,[_e.EntwinedPower]:v,[_e.EpidemicsRunRampant]:uo,[_e.EvermultiplyingSwarm]:Os,[_e.ExaltationOfEchoedSteps]:Wo,[_e.ExaltationOfGraspingRoots]:So,[_e.ExaltationOfMoltenStone]:Io,[_e.ExaltationOfTangledGrowth]:Ki,[_e.ExaltationOfTheIncandescentSky]:Ue,[_e.ExaltationOfTheStormWind]:pr,[_e.ExaltationOfTheTransformingFlame]:Fi,[_e.ExhaleConfusionAndDelirium]:cd,[_e.ExplosiveEruption]:Ao,[_e.FavorOfTheSunAndStarlitDark]:Et,[_e.FavorsCalledDue]:qr,[_e.FavorsOfStoryAndSeason]:Zo,[_e.FerociousRampage]:ts,[_e.FetidBreathSpreadsInfection]:po,[_e.FieldsChokedWithGrowth]:cr,[_e.FieryVengeance]:wo,[_e.FireAndFlood]:V,[_e.FireBurnsWaterSoothes]:Ys,[_e.FireInTheSky]:Va,[_e.Firestorm]:Ri,[_e.FlamesFury]:Ni,[_e.FlashFloods]:Rr,[_e.Flashfires]:$i,[_e.FleshrotFever]:Ya,[_e.FlockingRedTalons]:qe,[_e.FlowDownriverBlowDownwind]:Pt,[_e.FlowLikeWaterReachLikeAir]:Y,[_e.FlowingAndSilentFormsDartBy]:Gs,[_e.FocusTheLandsAnguish]:Ie,[_e.FocusTheSunsRays]:Yo,[_e.ForestsOfLivingObsidian]:Ae,[_e.ForsakeSocietyToChaseAfterDreams]:ms,[_e.FoulVaporsAndFetidMuck]:Xi,[_e.FoundationsSinkIntoMud]:fi,[_e.FragmentsOfYesteryear]:je,[_e.FrenziedAssault]:ei,[_e.FrightfulKeening]:ld,[_e.GatherTheScatteredLightOfStars]:zs,[_e.GatherTheWarriors]:Vr,[_e.GiftOfAbundance]:ui,[_e.GiftOfConstancy]:wa,[_e.GiftOfFlowingPower]:Oi,[_e.GiftOfFuriousMight]:ns,[_e.GiftOfLivingEnergy]:ya,[_e.GiftOfNaturesConnection]:St,[_e.GiftOfPower]:ma,[_e.GiftOfProliferation]:lr,[_e.GiftOfSearingHeat]:Vi,[_e.GiftOfSeismicEnergy]:Mo,[_e.GiftOfStrength]:tr,[_e.GiftOfThePrimordialDeeps]:Ci,[_e.GiftOfTheSparkingSky]:wr,[_e.GiftOfTheSunlitAir]:ss,[_e.GiftOfTheUntamedWild]:vs,[_e.GiftOfTwinnedDays]:Ot,[_e.GiftOfWindspedSteps]:os,[_e.GnawingRootbiters]:va,[_e.GoldsAllure]:za,[_e.GrantHatredARavenousForm]:z,[_e.GraspingTide]:Er,[_e.GrowthThroughSacrifice]:Qa,[_e.GuardTheHealingLand]:nr,[_e.GuardianSerpents]:Ka,[_e.GuideTheWayOnFeatheredWings]:Cs,[_e.HarbingersOfTheLightning]:yr,[_e.HauntedByPrimalMemories]:Ct,[_e.HazardsSpreadAcrossTheIsland]:Dt,[_e.HerdTowardsTheLurkingMaw]:rs,[_e.HereThereBeMonsters]:Xa,[_e.HoldTheIslandFastWithABulwarkOfWill]:eo,[_e.ImbueWithNourishingVitality]:rr,[_e.ImpenetrableTanglesOfGreenery]:hr,[_e.ImpersonateAuthority]:so,[_e.InciteTheMob]:oo,[_e.IndomitableClaim]:I,[_e.InfestationOfVenomousSpiders]:xe,[_e.InfestedAquifers]:_a,[_e.InfiniteVitality]:b,[_e.InflameTheFiresOfLife]:Za,[_e.InsatiableHungerOfTheSwarm]:Q,[_e.InscrutableJourneying]:hd,[_e.InspireAWindingDance]:Go,[_e.InspireTheReleaseOfStolenLands]:Je,[_e.InstrumentsOfTheirOwnRuin]:X,[_e.IntractableThicketsAndThorns]:_i,[_e.IrresistibleCall]:be,[_e.JaggedShardsPushFromTheEarth]:ao,[_e.KeepWatchForNewIncursions]:ed,[_e.LandCreaksWithTension]:Ho,[_e.LandOfHauntsAndEmbers]:Ia,[_e.LavaFlows]:xo,[_e.LayPathsTheyCannotHelpButWalk]:Ai,[_e.LeadTheFuriousAssault]:Yr,[_e.LeadTheWarriorsToBattle]:zr,[_e.LearnTheInvadersTactics]:Fs,[_e.LeaveATrailOfDeathlySilence]:ko,[_e.LetThemBreakThemselvesAgainstTheStone]:to,[_e.LetsSeeWhatHappens]:co,[_e.LightningTornSkiesIncitePandemonium]:vr,[_e.LightningsBoon]:mr,[_e.LikeCallsToLike]:Bt,[_e.LostInTheEndlessDark]:Lo,[_e.LostInTheSwirlingHaze]:Hs,[_e.LureOfTheUnknown]:Aa,[_e.ManifestIncarnation]:_,[_e.ManifestationOfPowerAndGlory]:Qr,[_e.MantleOfDread]:jr,[_e.MarkTerritoryWithScarsAndTeeth]:is,[_e.MassiveFlooding]:Nr,[_e.MeltEarthIntoQuicksand]:Te,[_e.MesmerizedTranquility]:kt,[_e.MindShatteringSong]:gd,[_e.MischiefAndSabotage]:Ui,[_e.MistsOfOblivion]:E,[_e.MysteriousAbductions]:qi,[_e.NaturesResilience]:xa,[_e.NeverHeardFromAgain]:Is,[_e.NightTerrors]:Hn,[_e.ObserveTheEverChangingWorld]:Rs,[_e.OceanBreaksTheShore]:Pr,[_e.OfferPassageBetweenWorlds]:xi,[_e.OpenShiftingWaterways]:Zi,[_e.OverenthusiasticArson]:lo,[_e.OvergrowInANight]:gr,[_e.PactOfTheJoinedHunt]:et,[_e.ParalyzingFright]:P,[_e.PathsTiedByNature]:bi,[_e.PeaceOfTheNighttimeSky]:Qs,[_e.PentupCalamity]:ne,[_e.PerilsOfTheDeepestIsland]:As,[_e.PillarOfLivingFlame]:S,[_e.PlagueShipsSailToDistantPorts]:Ve,[_e.Plaguebearers]:yo,[_e.PlowsShatterOnRockyGround]:no,[_e.PoisonedDew]:at,[_e.PoisonedLand]:O,[_e.PortentsOfDisaster]:tt,[_e.PoundShipsToSplinters]:Sr,[_e.PourTimeSideways]:fs,[_e.PoweredByTheFurnaceOfTheEarth]:bo,[_e.Powerstorm]:D,[_e.PredatoryNightmares]:Un,[_e.PreyOnTheBuilders]:ai,[_e.PromisesOfProtection]:nt,[_e.ProwlingPanthers]:rt,[_e.PullBeneathTheHungryEarth]:ba,[_e.PunishThoseWhoTrespass]:oi,[_e.PurifyingFlame]:Ta,[_e.PursueWithScratchesPecksAndStings]:Ds,[_e.PyroclasticBombardment]:To,[_e.PyroclasticFlow]:re,[_e.QuickenTheEarthsStruggles]:Ea,[_e.RadiantAndHallowedGrove]:sd,[_e.RadiatingTremors]:Uo,[_e.RagingStorm]:Ir,[_e.RainAndMudSuppressConflict]:pi,[_e.RainOfAsh]:Eo,[_e.RainOfBlood]:Pa,[_e.RangingHunt]:ti,[_e.RavagedUndergrowthSlithersBackToLife]:Ye,[_e.RazorsharpUndergrowth]:it,[_e.ReachFromTheInfiniteDarkness]:Fo,[_e.ReachingGrasp]:Sa,[_e.ReclaimedByTheDeeps]:Or,[_e.RegrowFromRoots]:di,[_e.RenewingBoon]:Lt,[_e.RenewingRain]:st,[_e.ResoundingFootfallsSowDismay]:qo,[_e.RevokeSanctuaryAndCastOut]:od,[_e.RitesOfTheLandsRejection]:ot,[_e.RitualsOfDestruction]:ir,[_e.RiversBounty]:$r,[_e.RoilingBogAndSnaggingThorn]:Nn,[_e.RouseTheTreesAndStones]:Oa,[_e.RumblingEarthquakes]:ze,[_e.RumblingsPortendAGreaterQuake]:jo,[_e.SacrosanctWilderness]:ci,[_e.SanguinaryTaint]:Id,[_e.SapTheStrengthOfMultitudes]:Ca,[_e.SavageMawbeasts]:Da,[_e.SavageRevenge]:mo,[_e.SavageTransformation]:ie,[_e.ScarredAndStonyLand]:ro,[_e.ScatterToTheWinds]:ds,[_e.ScorchWithWavesOfHeat]:Yi,[_e.ScorchingConvergence]:zo,[_e.ScourTheLand]:dt,[_e.ScreamDiseaseIntoTheWind]:xn,[_e.SeaMonsters]:Ee,[_e.SearAngerIntoTheWildLands]:bn,[_e.SerpentRousesInAnger]:Di,[_e.SerpentWakesInPower]:Bi,[_e.SetThemOnAnEvertwistingTrail]:Tn,[_e.SettleIntoHuntinggrounds]:Pe,[_e.ShadowsOfTheBurningForest]:Ba,[_e.ShapeTheSelfAnew]:Ks,[_e.ShareMentorshipAndExpertise]:Ns,[_e.ShareSecretsOfSurvival]:$s,[_e.ShatterHomesteads]:Ar,[_e.ShelterUnderToweringBranches]:dd,[_e.SiderealGuidance]:Xs,[_e.SkiesHeraldTheSeasonOfReturn]:En,[_e.SkyStretchesToShore]:ct,[_e.SleepAndNeverWaken]:Se,[_e.SlipTheFlowOfTime]:us,[_e.SmashStompAndFlatten]:Oo,[_e.SmiteTheLandWithFulmination]:xr,[_e.SmotheringInfestation]:se,[_e.SocietyDissolvesAtTheBeckoningHeart]:xs,[_e.SoftlyBeckonEverInward]:bs,[_e.SolidifyEchoesOfMajestyPast]:Qe,[_e.SongOfSanctity]:ka,[_e.SpillBitternessIntoTheEarth]:Oe,[_e.SpiritsMayYetDream]:jn,[_e.SpreadingAndDreadfulMire]:es,[_e.SpreadingWilds]:li,[_e.SpurOnWithWordsOfFire]:lt,[_e.StarsBlazeInTheDaytimeSky]:_s,[_e.SteamVents]:La,[_e.StemTheFlowOfFreshWater]:fr,[_e.StingingSandstorm]:zi,[_e.Stormswath]:Ce,[_e.StranglingFirevine]:oe,[_e.StrengthOfTheWakingIsland]:ki,[_e.StretchOutCoilsOfForebodingDread]:Jr,[_e.StrikeLowWithSuddenFevers]:vo,[_e.StrongAndConstantCurrents]:Pn,[_e.StubbornSolidity]:io,[_e.StudyTheInvadersFears]:Ws,[_e.SuckingOoze]:Sn,[_e.SuddenAmbush]:Kr,[_e.SuffocatingShroud]:Us,[_e.SunsetsFireFlowsAcrossTheLand]:On,[_e.SurgingLahar]:Co,[_e.SurroundedByTheDahan]:ad,[_e.SwallowTheLanddwellers]:Cr,[_e.SwallowedByTheEndlessDark]:Ro,[_e.SwallowedByTheWilderness]:Ts,[_e.SwarmingWasps]:ht,[_e.SweepIntoTheSea]:de,[_e.SwelteringExhaustion]:Qi,[_e.SwirlAndSpill]:Ad,[_e.TalonsOfLightning]:B,[_e.TeemingRivers]:gt,[_e.TeethGleamFromDarkness]:ni,[_e.TempestOfLeavesAndBranches]:cs,[_e.TerrifyingChase]:ri,[_e.TerrifyingNightmares]:k,[_e.TerrifyingRampage]:Do,[_e.TerritorialStrife]:Cn,[_e.TerrorOfTheHunted]:No,[_e.TerrorTurnsToMadness]:Dn,[_e.TheBurnedLandRegrows]:Wi,[_e.TheFogClosesIn]:qs,[_e.TheJungleHungers]:L,[_e.TheLandThrashesInFuriousPain]:F,[_e.ThePastReturnsAgain]:ws,[_e.TheShoreSeethesWithHatred]:Bn,[_e.TheTeemingHostArrives]:Bs,[_e.TheTreesAndStonesSpeakOfWar]:R,[_e.TheWoundedWildTurnsOnItsAssailants]:De,[_e.ThicketsEruptWithEveryTouchOfBreeze]:Be,[_e.ThreateningFlames]:Mi,[_e.ThrivingChokefungus]:kn,[_e.ThunderingDestruction]:br,[_e.TidalBoon]:Dr,[_e.TigersHunting]:ce,[_e.TooNearTheJungle]:ii,[_e.TormentingRotflies]:ft,[_e.ToweringWrath]:hi,[_e.TransformToAMurderousDarkness]:ke,[_e.TransformativeSacrifice]:Ke,[_e.TravelersBoon]:Ti,[_e.TreacherousWaterways]:Ln,[_e.TreesRadiateCelestialBrilliance]:Le,[_e.Tsunami]:N,[_e.TurmoilsTouch]:fd,[_e.TwilightFogBringsMadness]:ut,[_e.TwistPerceptions]:ud,[_e.TwistedFlowersMurmurUltimatums]:le,[_e.UnbearableDeluge]:wi,[_e.UnbearableGaze]:Qo,[_e.UnbelievableRegrowth]:ur,[_e.UncannyMelting]:Fa,[_e.UnearthABeastOfWrathfulStone]:aa,[_e.UnexpectedTigers]:ho,[_e.UnleashATorrentOfTheSelfsOwnEssence]:Fe,[_e.UnlockTheGatesOfDeepestPower]:he,[_e.UnnervingPall]:js,[_e.UnquenchableFlames]:Fn,[_e.UnrelentingGrowth]:ge,[_e.UtterACurseOfDreadAndBone]:Re,[_e.VanishSoftlyAwayForgottenByAll]:Ne,[_e.VeilTheNightsHunt]:Ra,[_e.VengeanceOfTheDead]:$,[_e.VigorOfTheBreakingDawn]:M,[_e.ViolentWindstorms]:ls,[_e.VisionsOfAShiftingFuture]:ys,[_e.VisionsOfFieryDoom]:Na,[_e.VoiceOfCommand]:$e,[_e.VoiceOfThunder]:Xr,[_e.VolcanicEruption]:fe,[_e.VoraciousGrowth]:$a,[_e.WallsOfRockAndThorn]:We,[_e.WardTheShores]:$n,[_e.WarnOfImpendingConflict]:td,[_e.WashAway]:Wr,[_e.WaterEatsAwayTheDeepRootsOfEarth]:Br,[_e.WaterNourishesLifesGrowth]:yi,[_e.WaysOfShoreAndHeartland]:Ei,[_e.WeaveTogetherTheFabricOfPlace]:Me,[_e.WeepForWhatIsLost]:Rn,[_e.WhisperedGuidanceThroughTheNight]:ji,[_e.WhyDontYouAndThemFight]:fo,[_e.WindsOfRustAndAtrophy]:G,[_e.WitherBodiesScarStones]:Ko,[_e.WoodSeeksGrowthHumansSeekFreedom]:Zs,[_e.WordsOfWarning]:_r,[_e.WrackWithPainAndGrief]:xd,[_e.WrapInWingsOfSunlight]:H};var Td;!function(e){e.HealthyIsland="HealthyIsland",e.BlightedIsland="BlightedIsland"}(Td||(Td={}));const Ed=(e,a)=>{const t=e.filter((e=>a(e)));t.length>0&&e.splice(0,e.length,...t)},Pd=e=>{let a=0;for(let t=0,n=e.length;t<n;t+=1)a+=e[t];return a},Sd=[_e.ParalyzingFright,_e.VigorOfTheBreakingDawn],Od=[_e.BargainOfCoursingPaths,_e.BargainsOfPowerAndProtection,_e.EntwinedPower,_e.FlockingRedTalons,_e.IndomitableClaim,_e.InfiniteVitality,_e.InspireTheReleaseOfStolenLands,_e.InstrumentsOfTheirOwnRuin,_e.PentupCalamity,_e.RavagedUndergrowthSlithersBackToLife,_e.TheTreesAndStonesSpeakOfWar,_e.TransformativeSacrifice,_e.UnearthABeastOfWrathfulStone,_e.UnrelentingGrowth,_e.VanishSoftlyAwayForgottenByAll,_e.WindsOfRustAndAtrophy],Cd=[_e.DissolveTheBondsOfKinship,_e.GrantHatredARavenousForm,_e.MistsOfOblivion,_e.PillarOfLivingFlame,_e.SavageTransformation,_e.TransformToAMurderousDarkness,_e.VengeanceOfTheDead,_e.VolcanicEruption],Dd=["ExtraAction-Behemoth-UnrelentingStrides","Extra-UnrelentingStrides","Growth-Starlight-0-0","Growth-Starlight-3-0","Growth-Starlight-12-0","Growth-Starlight-12-3","Growth-Starlight-12-5","Growth-Starlight-12-6","Track-Finder-2","Track-Finder-9"];class Bd{static pruneQuery(e,a,t,n){const{query:r,name:i,text:s,prompt:d,optional:l,spirit:h,players:g}=a,f=l?[...a.actionIds,"Skip"]:a.actionIds,u=l?[...a.items,"Skip"]:a.items;t.debugQueries&&(console.log(`${tn[r]} ${i}: ${s} ${d}`),console.log(u));let w=[...Array(u.length).keys()];f[0].startsWith("Fate-")&&e.phase===Xe.Event&&1===e.turn&&(w=[0]),l&&[tn.SelectTrack].includes(r)&&Ed(w,(e=>"Skip"!==f[e])),f.find((e=>Dd.includes(e)))&&Ed(w,(e=>!Dd.includes(f[e])));for(const e of[0,1])h&&f.includes(`Gain${e}Time`)&&h.numberOfPresenceInTracks>e&&Ed(w,(a=>f[a]!==`Gain${e}Time`));if(Ed(w,(e=>["SkipDowngrade","Growth-Starlight-1-0","Track-Starlight-3","Track-Starlight-5","Track-River-8","Track-River-9","Track-River-10","Track-River-11"].includes(f[e]))),r===tn.SelectLand&&(d?.startsWith("Blight cascades")||s?.startsWith("Add 1 <blight>"))&&Ed(w,(e=>u[e].doesntHave(Z.Blight))),!n&&r===tn.SelectLand&&s?.startsWith("The Invaders")&&(s?.startsWith("The Invaders Ravage")&&e.blightStatus!==Td.HealthyIsland||(w=[w[0]])),r===tn.SelectPowerType&&h){const e=h.energy+h.trackEnergy+h.growthOptionEnergy;e>=6&&h.powersWhere((e=>e.isA(ye.Minor))).count>0&&0===h.powersWhere((e=>e.isA(ye.Major))).count&&Ed(w,(e=>u[e]===o.Major)),(e<3||h.powersWhere((e=>e.isA(ye.Major))).count>=4)&&Ed(w,(e=>u[e]===o.Minor))}if(r===tn.SelectPiece&&(n||(w.some((e=>u[e].damage>0))?w=w.filter((e=>u[e].damage>0)):w.some((e=>u[e].piece===p.City))?w=w.filter((e=>u[e].piece===p.City)):w.some((e=>u[e].piece===p.Town))&&(w=w.filter((e=>u[e].piece===p.Town)))),d?.startsWith("Do 1 additional damage")&&Ed(w,(e=>"Skip"!==f[e]))),r===tn.SelectGrowthOption){let a=null;for(const t of e.spirits)if(w.some((e=>u[e].spirit?.spirit===t.spirit&&"ExtraAction-Behemoth-UnrelentingStrides"!==f[e]))){w=w.filter((e=>u[e].spirit?.spirit===t.spirit)),a=t;break}if(i?.startsWith("Growths Begets Growth")||(w=w.filter((e=>void 0===u[e].subOption||!w.some((a=>void 0!==u[a].subOption&&u[a].option===u[e].option&&u[a].subOption<u[e].subOption))))),null!==a){const t=`ExtraAction-${a.spirit}-Gain`;if(w.some((e=>f[e].startsWith(t)))&&e.stage<3&&e.terrorLevel<3){const e=a.primaryElements,n=w.map((e=>f[e].startsWith(t)?f[e].slice(t.length):null)),r=w.map((e=>f[e].startsWith(t)?bd[f[e].slice(t.length)].elements:[])).map(((a,t)=>{let r=0;const i=n[t];return null!==i&&(Sd.includes(i)?r+=200:Od.includes(i)?r+=100:Cd.includes(i)&&(r-=100)),r+Pd(a.map((a=>e.length>0&&e[0]===a?4:e.length>1&&e[1]===a?2:e.length>2&&e[2]===a?1:0)))})),i=Math.max(...r);i>=4&&(w=w.filter(((e,a)=>r[a]===i)))}}}if(r===tn.PlayPower)for(const a of e.spirits)if(w.some((e=>u[e].spirit.spirit===a.spirit&&g?.includes(a)))){w=w.filter((e=>u[e].spirit.spirit===a.spirit));break}if(r===tn.SelectPower&&d?.includes("to forget")&&h){Ed(w,(e=>"Skip"===u[e]||!u[e].isA(ye.Major)));const e=h.primaryElements,a=w.map((e=>bd[f[e]]?bd[f[e]].elements??[]:[])).map((a=>Pd(a.map((a=>e.length>0&&e[0]===a?4:e.length>1&&e[1]===a?2:e.length>2&&e[2]===a?1:0))))),t=Math.min(...a);w=w.filter(((e,n)=>a[n]===t||bd[f[n]].type===o.Minor))}return r===tn.SelectPower&&"Select power to resolve"===s&&(w.some((e=>u[e].data?.target===c.Spirit))&&(w=w.filter((e=>u[e].data?.target===c.Spirit))),h?.spirit!==hn.Lightning&&Ed(w,(e=>"Skip"!==f[e]))),w?w.map((e=>f[e])):f}}var kd;!function(e){e.DahanInsurrectionLevelThree="DahanInsurrectionLevelThree",e.DahanInsurrectionTooFewDahan="DahanInsurrectionTooFewDahan",e.GameError="GameError",e.GreatRiver="GreatRiver",e.GuardTheIslesHeart="GuardTheIslesHeart",e.HuntersSwarmTheIsland="HuntersSwarmTheIsland",e.IrreparableDamage="IrreparableDamage",e.LandStrippedBare="LandStrippedBare",e.ProudAndMightCapital="ProudAndMightCapital",e.RanOutOfBlight="RanOutOfBlight",e.RanOutOfInvaderCards="RanOutOfInvaderCards",e.RanOutOfPresence="RanOutOfPresence",e.SprawlingPlantation="SprawlingPlantation",e.TheEndlessDark="TheEndlessDark",e.TradeHub="TradeHub"}(kd||(kd={}));const Ld={name:"Downward Spiral",set:s.Base,blightPerPlayer:5,requireEvents:!1,effects:[{textArea:[.245,.331],text:"At the start of each Invader Phase each Spirit destroys 1 of their <presence>.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffect({effectId:pe.DownwardSpiral,[r.BlightedIslandPhase]:async()=>{await e.eachSpirit((a=>e.doBlightCardAction((async()=>{await a.destroyPresence(1)}))))},[r.GlobalReminder]:()=>({icon:"<blight>",ongoing:!0})})}}]},Fd={name:"Memory Fades to Dust",set:s.Base,blightPerPlayer:4,requireEvents:!1,effects:[{textArea:[.242,.373],text:"At the start of each Invader Phase each Spirit Forgets a Power or destroys 1 of their <presence>.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffect({effectId:pe.MemoryFadesToDust,[r.BlightedIslandPhase]:async()=>{await e.eachSpirit((a=>e.doBlightCardAction((()=>e.chooseBetween({effects:[{actionId:"ForgetPower",text:"Forget a Power.",[r.Now]:async()=>{await a.forgetPowers()},condition:()=>a.hasAtLeastNonBlessed(1,ye.AnyCard)},{actionId:"DestroyPresence",text:"Destroy 1 of your <presence>.",[r.Now]:async()=>{await a.destroyPresence(1)},condition:()=>a.presence().count>0}]})))))},[r.GlobalReminder]:()=>({icon:"<blight>",ongoing:!0})})}}]},Rd={name:"Aid From Lesser Spirit",set:s.BranchAndClaw,blightPerPlayer:2,requireEvents:!0,effects:[{textArea:[.25,.463],text:"Immediately, draw 1 Minor Power Card per player plus 1 more. Give 1 to each Spirit. They may be used every turn as if played, but cost no Card Plays/Energy. Place unselected card in Minor Powers discard pile.",[r.Now]:async({$:e})=>{let a=[];await e.eachSpirit((t=>e.doBlightCardAction((async()=>{const n=await t.gainPowerCard({powerType:o.Minor,drawAmount:e.spiritCount+1,discardAfter:2===a.length,gifted:!0,fromSelection:a.length>0?a:void 0});a=n.notChosen,await n.chosen[0].bless()}))))}}]},Nd={name:"A Pall Upon The Land",set:s.BranchAndClaw,blightPerPlayer:3,requireEvents:!0,effects:[{textArea:[.248,.334],text:"Immediately, on each board: destroy 1 <presence> and remove 1 <town>.",[r.Now]:async({$:e})=>{await e.doBlightCardActionOnEachBoard((async a=>{await a.presence().pickOne((async e=>{await e.destroy()}),{text:"Destroy 1 <presence>.",highlightBoards:[a],noOptions:`On board ${a.name}: No <presence> to remove.`}),await a.forPiecesThatIs(e.Town).pickOne((async e=>{await e.remove()}),{text:"Remove 1 <town>.",highlightBoards:[a],noOptions:`On board ${a.name}: No <town> to remove.`})}))}}]},$d={name:"Back Against The Wall",set:s.BranchAndClaw,blightPerPlayer:2,requireEvents:!0,effects:[{textArea:[.245,.332],text:"Every Spirit Phase each Spirit gains +1 Energy and +1 Card Play.",[r.Now]:async({$:e})=>{const a=async()=>{await e.eachSpirit((a=>e.doBlightCardAction((async()=>{await a.gainEnergy(1),await a.gainCardPlays(1)}))))};await e.clickToContinue(),e.spiritPhase&&await a(),await e.addSubEffect({effectId:pe.BackAgainstTheWall,[r.StartOfSpiritPhase]:async()=>{await e.clickToContinue(),await a()},[r.GlobalReminder]:()=>({icon:"<blight>",ongoing:!0})})}}]},Wd={name:"Disintegrating Ecosystem",set:s.BranchAndClaw,blightPerPlayer:5,requireEvents:!0,effects:[{textArea:[.248,.34],text:"Immediately, on each board: Destroy 1 <beasts>, then add 1 <blight> to a land with <town>/<city>.",[r.Now]:async({$:e})=>{await e.doBlightCardActionOnEachBoard((async a=>{await e.addSubEffect({effects:[{highlightBoards:[a],textArea:[.25,.29],text:"Destroy 1 <beasts>",[r.Now]:()=>e.countPieceOnlyIfHavingPiece(p.Beasts,(()=>a.forPiecesThatIs(e.Beasts))).pickOne((async e=>{await e.destroy()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No <beasts> to destroy.`})},{highlightBoards:[a],textArea:[.295,.335],text:"Add 1 <blight> to a land with <town>/<city>.",[r.Now]:async()=>{await a.inLandsWith(e.TownOrCity).pickOne((async e=>{await e.addBlight(1)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <town>/<city>.`})}}]})}))}}]},Md={name:"Erosion Of Will",set:s.BranchAndClaw,blightPerPlayer:3,requireEvents:!0,effects:[{textArea:[.248,.335],text:"Immediately, 2 <fear> per player. Each Spirit destroys 1 of their <presence> and loses 1 Energy.",[r.Now]:async({$:e})=>{await e.doBlightCardAction((async()=>{await e.clickToContinue(),await e.fear(2*e.spiritCount),await e.eachSpirit((a=>e.doBlightCardAction((async()=>{await e.addSubEffect({effects:[{textArea:[.248,.335],text:"Each Spirit destroys 1 of their <presence> and loses 1 Energy.",[r.Now]:async()=>{await a.destroyPresence(1),await a.loseEnergy(1)}}]})}))))}))}}]},Gd={name:"Promising Farmlands",set:s.BranchAndClaw,blightPerPlayer:4,requireEvents:!0,effects:[{textArea:[.25,.337],text:"Immediately, on each board: Add 1 <town> and 1 <city> to an Inland land with no <town>/<city>.",[r.Now]:async({$:e})=>{await e.doBlightCardActionOnEachBoard((async a=>{await a.inLandsWhere((a=>a.isInland&&!a.has(e.TownOrCity))).pickOne((async a=>{await a.add(1,e.Town),await a.add(1,e.City)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No Inland lands without <town>/<city>`})}))}}]},Hd={name:"Tipping Point",set:s.BranchAndClaw,blightPerPlayer:5,requireEvents:!0,effects:[{textArea:[.248,.288],text:"Immediately, destroy 3 <presence> from each Spirit.",[r.Now]:async({$:e})=>{await e.eachSpirit((a=>e.doBlightCardAction((async()=>{await a.destroyPresence(3)}))))}}]},Ud={name:"All Things Weaken",set:s.JaggedEarth,blightPerPlayer:3,requireEvents:!1,effects:[{textArea:[.25,.337],text:"Ongoing, starting next turn: Invaders and <dahan> have -1 Health (min. 1).",[r.Now]:async({$:e})=>{const a=e.turn;await e.clickToContinue(),await e.addSubEffect({effectId:pe.AllThingsWeaken,[r.AdjustHealth]:({piece:t})=>e.turn>a&&t.isOneOf(e.Invader,e.Dahan)?-1:0,[r.StartOfSpiritPhase]:async()=>{e.turn===a+1&&await e.globalHealthCheck()},[r.GlobalReminder]:()=>({text:"Ongoing, starting next turn: Invaders and <dahan> have -1 Health (min. 1).<br><br>The land takes <blight> on 1 less Damage (normally 1).<br><br>When you add <blight>, it Destroys all <presence>/<beasts> in that land and 1 <presence> (total) in an adjacent land.",icon:"<blight>",ongoing:!0})})}},{textArea:[.289,.38],text:"The land takes <blight> on 1 less Damage (normally 1).",[r.Now]:async({$:e})=>{const a=e.turn;await e.clickToContinue(),await e.addSubEffect({[r.AdjustLandHealth]:()=>e.turn>a?-1:0})}},{textArea:[.334,.466],text:"When you add <blight>, it Destroys all <presence>/<beasts> in that land and 1 <presence> (total) in an adjacent land.",[r.Now]:async({$:e})=>{const a=e.turn;await e.clickToContinue(),await e.addSubEffect({[r.WhenAddingBlight]:async({land:t})=>{e.turn<=a||(e.dontCountAs(p.Beasts),e.dontCountAs(p.Presence),await t.piecesThatAre(e.Presence).forEach((async e=>{t.blightIsPreventedFromDestroyingPresenceOf(e.owner)||await e.remove(A.DestroyByDamageOrBlight)})),await t.destroyAll(e.Beasts,{removement:A.DestroyByDamageOrBlight}),await e.countPieceOnlyIfHavingPiece(p.Presence,(()=>t.adjacentPiecesInLandsWhere((e=>e.isPresence)))).pickOne((async e=>{t.blightIsPreventedFromDestroyingPresenceOf(e.owner)||await e.remove(A.DestroyByDamageOrBlight)}),{noOptions:"No adjacent lands with <presence>."}))}})}}]},qd={name:"Invaders Find The Land To Their Liking",set:s.JaggedEarth,blightPerPlayer:2,requireEvents:!1,stillHealthy:!0,effects:[{textArea:[.252,.381],text:"Immediately: If the Terror Level is I / II / III, add 1 / 1.5 / 2 Fear Markers per player to the Fear pool. (Round down at Terror Level II.)",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addFearToPool(Math.floor((.5*e.terrorLevel+.5)*e.spiritCount))}}]},jd={name:"Power Corrodes The Spirit",set:s.JaggedEarth,blightPerPlayer:4,requireEvents:!1,effects:[{textArea:[.292,.465],text:"Each Invader Phase: Each Spirit Destroys 1 of their <presence> if they have 3 or more Power Cards in play, or have a Power Card in play costing 4 or more (printed) Energy.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffect({effectId:pe.PowerCorrodesTheSpirit,[r.BlightedIslandPhase]:()=>e.spiritsWhich((e=>e.powerCardsInPlay.length>=3||e.powerCardsInPlay.some((e=>e.costToPlay>=4)))).forEach((a=>e.doBlightCardAction((async()=>{await a.destroyPresence(1)})))),[r.GlobalReminder]:()=>({icon:"<blight>",ongoing:!0})})}}]},Jd={name:"Strong Earth Shatters Slowly",set:s.JaggedEarth,blightPerPlayer:2,requireEvents:!1,stillHealthy:!0,effects:[{textArea:[.248,.332],text:"Immediately: Each player adds 1 <blight> (from this card) to a land adjacent to <blight>.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doBlightCardAction((()=>e.inLocationsWhere((a=>a.isLandForBlight&&a.hasAdjacentLocationWhere((a=>a.isLandForBlight&&a.has(e.Blight))))).pickOne((async e=>{await e.addBlight(1)}))))))}]},Vd={name:"Thriving Communities",set:s.JaggedEarth,blightPerPlayer:4,requireEvents:!0,effects:[{textArea:[.291,.388],text:"Immediately, on each board: In 4 different lands with <explorer>/<town>, Replace 1 <town> with 1 <city> or Replace 1 <explorer> with 1 <town>.",[r.Now]:({$:e})=>e.doBlightCardActionOnEachBoard((a=>a.inLandsWith(e.ExplorerOrTown).selectOrder().pickMultiple({amount:4,effect:{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <explorer>/<town>`},forPickedItem:async a=>{await a.piecesThatAre(e.ExplorerOrTown).pickOne((async a=>{a.isA(e.Explorer)?await a.replace([p.Town]):await a.replace([p.City])}))}})))}]},Yd={name:"Unnatural Proliferation",set:s.JaggedEarth,blightPerPlayer:3,requireEvents:!1,effects:[{textArea:[.25,.331],text:"Immediately: Each Spirit adds 1 <presence> to a land with their <presence>.",[r.Now]:({$:e})=>e.eachSpirit((a=>e.doBlightCardAction((async()=>{await a.addPresence()}))))},{textArea:[.332,.473],text:"On Each Board: Add 1 <dahan> to a land with <dahan>, and 2 <city> to the land with fewest <town>/<city> (min. 1).",[r.Now]:({$:e})=>e.doBlightCardActionOnEachBoard((async a=>{await e.addSubEffect({effects:[{highlightBoards:[a],textArea:[.335,.426],text:"Add 1 <dahan> to a land with <dahan>",[r.Now]:()=>a.inLandsWith(e.Dahan).pickOne((async a=>{await a.add(1,e.Dahan)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <dahan>.`})},{highlightBoards:[a],textArea:[.38,.475],text:"Add 2 <city> to the land with fewest <town>/<city> (min. 1).",[r.Now]:()=>a.inLandsWith(e.TownOrCity).withLeast((a=>a.numberOf(e.TownOrCity))).pickOne((async a=>{await a.add(2,e.City)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <town>/<city>.`})}]})}))}]},zd={name:"Untended Land Crumbles",set:s.JaggedEarth,blightPerPlayer:4,requireEvents:!1,effects:[{textArea:[.292,.509],text:"Each Invader Phase: On Each Board: Add 1 <blight> to a land adjacent to <blight>. Spirits may prevent this on any/all boards; each board to be protected requires jointly paying 3 Energy or Destroying 1 <presence> from that board.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffect({effectId:pe.UntendedLandCrumbles,[r.BlightedIslandPhase]:()=>e.onEachBoard((async a=>{await e.chooseBetween({highlightBoards:[a],effects:[{actionId:"AddBlight",textArea:[.292,.38],text:"Add 1 <blight> to a land adjacent to <blight>.",[r.Now]:()=>a.inLocationsWhere((a=>a.isLandForBlight&&a.hasAdjacentLocationWhere((a=>a.isLandForBlight&&a.has(e.Blight))))).pickOne((async e=>{await e.addBlight(1)})),condition:()=>a.hasOneLocationWhere((a=>a.isLandForBlight&&a.hasAdjacentLocationWhere((a=>a.isLandForBlight&&a.has(e.Blight)))))},{actionId:"PreventByEnergy",textArea:[.424,.464],text:"Prevent this by jointly paying 3 Energy.",[r.Now]:async()=>{await e.payEnergyJointlyAidedBy({energy:3})},condition:()=>e.playersCanJointlyPayEnergyAidedBy({energy:3})},{actionId:"PreventByDestroyingPresence",textArea:[.469,.509],text:"Prevent this by Destroying 1 <presence> from that board.",[r.Now]:()=>a.destroyPresence(1),condition:()=>a.numberOf(e.Presence)>=1}]})})),[r.GlobalReminder]:()=>({icon:"<blight>",ongoing:!0})})}}]},Qd={name:"Attenuated Essence",set:s.NatureIncarnate,blightPerPlayer:4,requireEvents:!1,effects:[{textArea:[.248,.334],text:"Each Invader Phase: Each Spirit with at least 5 <presence> on the island Destroys 1 <presence>.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffect({effectId:pe.AttenuatedEssence,[r.BlightedIslandPhase]:()=>e.spiritsWhich((e=>e.numberOfPresenceInLands>=5)).forEach((a=>e.doBlightCardAction((async()=>{await a.destroyPresence(1)})))),[r.GlobalReminder]:()=>({icon:"<blight>",ongoing:!0})})}}]},Kd={name:"Blight Corrodes The Spirit",set:s.NatureIncarnate,blightPerPlayer:4,requireEvents:!1,effects:[{textArea:[.251,.337],text:"Each Invader Phase: On Each Board, Destroy 1 <presence> in a land with <blight>.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffect({effectId:pe.BlightCorrodesTheSpirit,[r.BlightedIslandPhase]:()=>e.doBlightCardActionOnEachBoard((async a=>(await e.countPieceOptionally(p.Presence,(()=>a.forPiecesThatIs(e.Presence).where((a=>a.location.has(e.Blight)))))).pickOne((async e=>{await e.destroy()})))),[r.GlobalReminder]:()=>({icon:"<blight>",ongoing:!0})})}}]},Xd={name:"Burn Brightest Before The End",set:s.NatureIncarnate,blightPerPlayer:2,requireEvents:!0,effects:[{textArea:[.249,.423],text:"Immediately: Each Spirit Adds 1 <presence> to one of their lands or removes 1 <presence> from their Presence Tracks. (<presence> removed from Presence Tracks goes to the <broken> supply.)",[r.Now]:({$:e})=>e.eachSpirit((a=>e.doBlightCardAction((async()=>{await e.chooseBetween({effects:[{actionId:"AddToLands",text:"Add 1 <presence> to one of your lands.",[r.Now]:async()=>{await a.addPresence()}},{actionId:"Remove",text:"Remove 1 <presence> from your Presence Tracks.",[r.Now]:async()=>{await a.addPresence({locations:g.Remove})}}]})}))))}]},_d={name:"Intensifying Exploitation",set:s.NatureIncarnate,blightPerPlayer:5,requireEvents:!1,effects:[{textArea:[.251,.334],text:"Ongoing, starting next turn: During Ravage Actions, Invaders deal +2 Damage (per land).",[r.Now]:async({$:e})=>{const a=e.turn;await e.clickToContinue(),await e.addSubEffect({effectId:pe.IntensifyingExploitation,[r.AdjustCollectiveInvaderRavageDamage]:()=>e.turn>a?2:0,[r.GlobalReminder]:()=>({icon:"<blight>",ongoing:!0})})}}]},Zd={name:"Shattered Fragments Of Power",set:s.NatureIncarnate,blightPerPlayer:2,requireEvents:!0,effects:[{textArea:[.249,.423],text:"Immediately: Draw 1 Major Power Card per Spirit plus 2 more. Each Spirit Takes 1 and gains 2 Energy. (Discard the 2 unselected cards.)",[r.Now]:async({$:e})=>{let a=[];await e.eachSpirit((t=>e.doBlightCardAction((async()=>{const n=await t.gainPowerCard({powerType:o.Major,drawAmount:e.spiritCount+2,discardAfter:3===a.length,withoutForgetting:!0,fromSelection:a.length>0?a:void 0,taken:!0});a=n.notChosen,await t.gainEnergy(2)}))))}}]},ec={name:"Slow Dissolution Of Will",set:s.NatureIncarnate,blightPerPlayer:3,requireEvents:!1,effects:[{textArea:[.249,.506],text:"Immediately: Each Spirit chooses one of <badlands>, <beasts>, or <wilds>.<br><br>Each Invader Phase: Each Spirit Replaces 1 <presence> with their chosen type of Spirit Token. (The <presence> goes to the <broken> supply.)",[r.Now]:async({$:e})=>{await e.eachSpirit((a=>e.doBlightCardAction((()=>e.chooseBetween({effects:[p.Badlands,p.Beasts,p.Wilds].map((t=>({actionId:t,text:ee[t].text,[r.Now]:async()=>{await e.addSubEffect({textArea:[.377,.513],text:"Each Invader Phase: Each Spirit Replaces 1 <presence> with their chosen type of Spirit Token. (The <presence> goes to the <broken> supply.)",[r.BlightedIslandPhase]:()=>a.presence().pickOne((async e=>{await e.replace([t])})),[r.GlobalReminder]:()=>({icon:`<broken> = <br>${ee[t].text}`,spirit:a,players:[a],ongoing:!0})})}})))})))))}}]};var ac;!function(e){e.APallUponTheLand="APallUponTheLand",e.AidFromLesserSpirit="AidFromLesserSpirit",e.AllThingsWeaken="AllThingsWeaken",e.AttenuatedEssence="AttenuatedEssence",e.BackAgainstTheWall="BackAgainstTheWall",e.BlightCorrodesTheSpirit="BlightCorrodesTheSpirit",e.BurnBrightestBeforeTheEnd="BurnBrightestBeforeTheEnd",e.DisintegratingEcosystem="DisintegratingEcosystem",e.DownwardSpiral="DownwardSpiral",e.ErosionOfWill="ErosionOfWill",e.IntensifyingExploitation="IntensifyingExploitation",e.InvadersFindTheLandToTheirLiking="InvadersFindTheLandToTheirLiking",e.MemoryFadesToDust="MemoryFadesToDust",e.PowerCorrodesTheSpirit="PowerCorrodesTheSpirit",e.PromisingFarmlands="PromisingFarmlands",e.ShatteredFragmentsOfPower="ShatteredFragmentsOfPower",e.SlowDissolutionOfWill="SlowDissolutionOfWill",e.StrongEarthShattersSlowly="StrongEarthShattersSlowly",e.TheBorderOfLifeAndDeath="TheBorderOfLifeAndDeath",e.ThrivingCommunities="ThrivingCommunities",e.ThrivingCrops="ThrivingCrops",e.TippingPoint="TippingPoint",e.UnnaturalProliferation="UnnaturalProliferation",e.UntendedLandCrumbles="UntendedLandCrumbles"}(ac||(ac={}));const tc={name:"The Border Of Life And Death",set:s.NatureIncarnate,blightPerPlayer:1,requireEvents:!1,stillHealthy:!0,effects:[{textArea:[.251,.426],text:"Now and Each Invader Phase (until this card is replaced): Each Spirit with at least 2 <presence> on the island Destroys 1 <presence> and may discard a Power Card to gain 1 Energy.",[r.Now]:async({$:e})=>{const a=async()=>{await e.spiritsWhich((e=>e.numberOfPresenceInLands>=2)).forEach((a=>e.doBlightCardAction((async()=>{await a.destroyPresence(1),a.numberOfPowerCardsInHand>0&&await e.may({prompt:"Discard a Power Card to gain 1 Energy?"})&&(await a.discardPowerCards(1),await a.gainEnergy(1))}))),{noOptions:"No Spirits with at least 2 <presence>."})};await e.addSubEffect({effectId:pe.TheBorderOfLifeAndDeath,[r.AfterDrawingBlightCard]:({blightCard:a})=>(a!==ac.TheBorderOfLifeAndDeath&&e.removeThisEffect(),Promise.resolve()),[r.BlightedIslandPhase]:async()=>{await a()},[r.GlobalReminder]:()=>({icon:"<blight>",ongoing:!0})}),await a()}}]},nc={name:"Thriving Crops",set:s.NatureIncarnate,blightPerPlayer:2,requireEvents:!1,stillHealthy:!0,effects:[{textArea:[.251,.379],text:"Immediately: On Each Board, Build in 3 lands. (Build Actions in lands without Invaders normally Build 1 <town>.)",[r.Now]:({$:e})=>e.doBlightCardActionOnEachBoard((e=>e.inLands().pickMultiple({amount:3,forPickedItem:async e=>{await e.doExtraBuild()},effect:{highlightBoards:[e]}})))}]},rc={[ac.APallUponTheLand]:Nd,[ac.AidFromLesserSpirit]:Rd,[ac.AllThingsWeaken]:Ud,[ac.AttenuatedEssence]:Qd,[ac.BackAgainstTheWall]:$d,[ac.BlightCorrodesTheSpirit]:Kd,[ac.BurnBrightestBeforeTheEnd]:Xd,[ac.DisintegratingEcosystem]:Wd,[ac.DownwardSpiral]:Ld,[ac.ErosionOfWill]:Md,[ac.IntensifyingExploitation]:_d,[ac.InvadersFindTheLandToTheirLiking]:qd,[ac.MemoryFadesToDust]:Fd,[ac.PowerCorrodesTheSpirit]:jd,[ac.PromisingFarmlands]:Gd,[ac.ShatteredFragmentsOfPower]:Zd,[ac.SlowDissolutionOfWill]:ec,[ac.StrongEarthShattersSlowly]:Jd,[ac.TheBorderOfLifeAndDeath]:tc,[ac.ThrivingCommunities]:Vd,[ac.ThrivingCrops]:nc,[ac.TippingPoint]:Hd,[ac.UnnaturalProliferation]:Yd,[ac.UntendedLandCrumbles]:zd},ic=(e,a)=>Math.exp(-e/a),sc=(e,a)=>1-Math.exp(-e/a),oc=(e,a,t)=>{const n=Math.min(Math.max(e,Math.min(a,t)),Math.max(a,t));return a===t?a:Math.abs((n-a)/(t-a))},dc=[pe.ProudAndMightCapital,pe.BuildingBoom,pe.IndenturedServantsEarnLand,pe.HighImmigrationI,pe.HighImmigrationFull,pe.LocalAutonomy,pe.IndependentResolve,pe.SprawlingPlantation,pe.DemandForNewCashCrops,pe.FrontierExplorers,pe.SlaveLabor,pe.TriangleTrade,pe.SlowHealingEcosystem,pe.PersistentExplorers,pe.IrreparableDamage,pe.SeekPrimeTerritory,pe.MigratoryHerders,pe.MoreRuralThanUrban,pe.HerdsThriveInVerdantLands,pe.WaveOfImmigration,pe.FarFlungHerds,pe.LandRush,pe.HuntersSwarmTheIsland,pe.StalkThePredators,pe.HuntersSeekShellAndHide,pe.ASenseForImpendingDisaster,pe.CompetitionAmongHunters,pe.PressureForFastProfit,pe.LandStrippedBare,pe.MiningTunnels,pe.AvariceRewarded,pe.CeaselessMining,pe.MiningBoomI,pe.UntappedSaltDeposits,pe.MiningBoomII,pe.TheEmpireAscendant,pe.TradeHub,pe.PortsSprawlOutward,pe.TradingPort,pe.ChartTheCoastline,pe.RunoffAndBilgewater,pe.ExportsFuelInwardGrowth,pe.SwayedByTheInvaders,pe.HeavyMining,pe.FineSteelForToolsAndGuns,pe.RoyalBacking,pe.MiningRush,pe.ShadowsPartake,pe.Immense,pe.Travel,pe.Madness,pe.Reach,pe.Resilience,pe.DarkFire,pe.Encircle,pe.Intensify,pe.Lair,pe.Locus,pe.Mentor,pe.Nourishing,pe.Regrowth,pe.SpreadingHostility,pe.Stranded,pe.Tactician,pe.Transforming,pe.Unconstrained,pe.Violence,pe.Warrior,pe.DownwardSpiral,pe.MemoryFadesToDust,pe.BackAgainstTheWall,pe.AllThingsWeaken,pe.PowerCorrodesTheSpirit,pe.UntendedLandCrumbles,pe.AttenuatedEssence,pe.BlightCorrodesTheSpirit,pe.IntensifyingExploitation,pe.TheBorderOfLifeAndDeath,pe.RoilingWaters,pe.SereneWaters,pe.DreamOfTheUntouchedLand,pe.BargainsOfPowerAndProtection,pe.BargainsOfCoursingPath,pe.Bringer,pe.Earth,pe.GreenChokeTheLandWithGreen,pe.GreenSteadyRegeneration,pe.Lightning,pe.Ocean,pe.River,pe.Shadows,pe.Thunderspeaker,pe.FangsAllyOfTheBeasts,pe.FangsCallForthPredators,pe.Keeper,pe.Downpour,pe.Finder,pe.Serpent,pe.Wildfire,pe.Eyes,pe.Heat,pe.Mud,pe.Teeth,pe.Whirlwind,pe.Fractured,pe.LureHomeOfTheIslandsHeart,pe.LureEnthrallTheForeignExplorers,pe.ManyMinds,pe.MemoryKnowledge,pe.MemoryInsight,pe.ShroudGatherPowerFromTheCoolAndDark,pe.ShroudMistsShiftAndFlow,pe.SlowAndSilentDeath,pe.Starlight,pe.Stone,pe.Trickster,pe.Vengeance,pe.Volcano,pe.Behemoth,pe.Darkness,pe.Earthquakes,pe.Gaze,pe.HearthVigil,pe.Roots,pe.Voice,pe.WoundedSeekingAPathTowardsHealing],cc={[Xe.Setup]:0,[Xe.SetupPresence]:0,[Xe.InitialExplore]:0,[Xe.RoyalBacking]:0,[Xe.Grow]:0,[Xe.GainEnergy]:0,[Xe.PlayPowers]:0,[Xe.FastPowers]:0,[Xe.BlightedIsland]:.5,[Xe.Event]:.5,[Xe.Fear]:.5,[Xe.HighImmigration]:.5,[Xe.Ravage]:.5,[Xe.Build]:.5,[Xe.Explore]:.5,[Xe.AdvanceCards]:.5,[Xe.SlowPowers]:1,[Xe.TimePasses]:1},lc={[Z.City]:1,[Z.Town]:.5};class hc{static inputNames=["Blight lost, healthy island","Blight lost, blighted island","Slow healing blight","Capital size","Coastal lands with cities","Max towns allowed","Fear","Terror level","Stage","Turn","Phase",...["1","2","3","4","5","6","7","8"].flatMap((e=>["Building","Ravaging","Strength","Health","Coastalness","Badlands","Blight","Cities","Dahan","Disease","Explorers","Presence","Towns","Vitality","Wilds","Defense","Incarna","Presence","Adjacent Presence","Adjacent Buildings"].map((a=>`${e}: ${a}`)))),"Energy","Energy Income","Cardplays","Destroyed Presence","Absorbed Presence","Presence in Ocean","Incarna","Empowered Incarna","Sun Elements","Moon Elements","Fire Elements","Air Elements","Water Elements","Earth Elements","Plant Elements","Animal Elements","Minor Powers","Major Powers","Forgotten Uniques","Number of discarded cards",...dc,...Object.keys(bd)];static getInputs(e,a){const{effectIds:t,startingBlight:n,fearCardsInLevelCount:r,fearPool:s,currentFear:o}=e,d=e.spirits[a],c=d.startingBoard,l=d.elements,h=e.invaderCardsInVisibleSlot(ps.Build),g=e.invaderCardsInVisibleSlot(ps.Ravage);return[e.blightStatus===Td.HealthyIsland?oc(e.blightOnBlightCard,n,0):0,e.blightStatus===Td.BlightedIsland?oc(e.blightOnBlightCard,rc[e.blightCardActive].blightPerPlayer*e.spiritCount,0):0,oc(e.slowHealingBlight,0,3),oc(e.capitalSize,0,7),oc(e.coastalLandsWithCities,0,2*e.boardCount+1),oc(e.townsCount,0,e.maxTownsAllowed+1),ic(Pd(r)*s-o,30),oc(e.terrorLevel,1,3),oc(e.stage,1,3),sc(e.turn,5),cc[e.phase],...c.locations.flatMap((e=>e.type===an.Ocean?[]:[h.some((a=>e.matchesInvaderCard(a,K.Build)))?lc[e.buildPlans]:0,g.some((a=>e.matchesInvaderCard(a,K.Ravage)))?1:0,sc(e.invaders().where((e=>0===e.strife&&!e.doesNotParticipateInRavage)).sum((e=>e.strengthDuringRavage)),2),sc(e.invaders().where((e=>0===e.strife&&!e.doesNotParticipateInRavage)).sum((e=>e.health)),2),e.isCoastal?1:0,...[Z.Badlands,Z.Blight,Z.City,Z.Dahan,Z.Disease,Z.Explorer,Z.Presence,Z.Town,Z.Vitality,Z.Wilds].map((a=>sc(e.numberOf(a),1))),sc(e.defense,3),e.hasIncarnaOf(d)?1:0,sc(e.numberOfPresenceOf(d),1),sc(e.numberOfPiecesInAdjacentLands(Z.Presence),1),sc(e.numberOfPiecesInAdjacentLands(Z.TownOrCity),1)])),sc(d.energy,5),sc(d.trackEnergy,3),oc(d.cardPlays,1,6),sc(d.destroyedPresence,1),oc(d.absorbedPresence.length,0,6),sc(c.ocean.numberOfPresenceOf(d),1),d.hasIncarna?1:0,d.hasEmpoweredIncarna?1:0,...[i.Sun,i.Moon,i.Fire,i.Air,i.Water,i.Earth,i.Plant,i.Animal].map((e=>sc(l[e],2))),sc(on(d.powers,(e=>e.isA(ye.Minor))),2),sc(on(d.powers,(e=>e.isA(ye.Major))),2),ic(on(d.powers,(e=>e.isA(ye.Unique))),2),1-d.numberOfPowerCardsInHand/d.numberOfPowerCards,...dc.map((e=>t.includes(e)?1:0)),...Object.keys(bd).map((e=>d.hasPower(e)?1:0))]}}var gc,fc,uc;function pc(e,a,t=" "){if(e.length>=a)return e;const n=a-e.length;return t.repeat(n)+e}!function(e){e.BrandenburgPrussia="BrandenburgPrussia",e.Sweden="Sweden",e.England="England",e.France="France",e.Scotland="Scotland",e.Habsburg="Habsburg",e.Russia="Russia",e.Saltburg="Saltburg"}(gc||(gc={})),function(e){e.Covered="Covered",e.Uncovered="Uncovered",e.UncoveredPlayed="UncoveredPlayed"}(fc||(fc={}));class wc{static weights={absorbedPresence:1.5,badlandsWithInvaders:.38,bargainEffects:2,beneficialPiecesInOcean:-1,blightLeft:2.5,blightLeftImportant:2.8,boardsWithLessThanFiveDahan:-.6,boardsWithLessThanFourDahan:-1.2,boardsWithLessThanSixDahan:-1.2,cityBuildingLands:-2,coastalLandsWithThieves:-2,coastalLandsWithWarding:3,damage:.1,destroyedSerpentPresence:1,discardedCards:-.1,earnedFearCardsAtTL1:1,earnedFearCardsAtTL2:3,earnedFearCardsAtTL3:5,elementsInCorners:1,emptyLands:.3,energy:.09,energyMismatch:-.2,explorersLeftAtTL1:-1,explorersLeftBeyondTL1:-.5,fearLeft:-1.5,fearPool:0,floodedLands:5,highImmigrationLands:-1,islandIsBlighted:-9.375,landsAdjacentToFlameMarker:1,landsAdjacentToPresence:.3,landsAdjacentToSacredSite:.4,landsWithBuildings:0,landsWithCities:0,landsWithConvertableDahan:-1,landsWithDahanAndInvader:.1275,landsWithExplorersAndBeasts:.75,landsWithInvaders:-.2,landsWithInvadersAndDisease:.51,landsWithPresence:.4,landsWithSacredSite:.51,landsWithTwoDahan:.19,landsWithTwoDahanAndInvader:.3,majorPowerCards:5.625,minPresenceOnIsland:1.5,minPresenceOnIslandDuringDownwardSpiral:4,minorPowerCards:2.1,numberOfBadLands:1,numberOfBeasts:.4,numberOfBlight:-1,numberOfCardsInExploreDeck:2,numberOfCities:-4,numberOfDahan:1,numberOfDeeps:.5,numberOfDisease:.4,numberOfOmen:-2.5,numberOfQuake:.3,numberOfThieves:-1,numberOfVitality:.8,numberOfWardingPattern:2,numberOfWilds:.8,preparedElements:.2,presenceOnIsland:.1,quakesWithBuildings:.3,ravagingLandsNoBlightBlighted:-1.6,ravagingLandsNoBlightHealthy:-1,ravagingLandsWithBlightBlighted:-3.2,ravagingLandsWithBlightHealthy:-2,spiritsWithAtLeast1Dahan:.2,spiritsWithAtLeast2Dahan:1.3,spiritsWithAtLeast3Dahan:1.2,spiritsWithAtLeast4Dahan:.5,stage:0,strifeHealth:.3,sumEnergyCostOfCards:0,terrorLevel:1,townBuildingLandsAtTL3:-.75,townBuildingLandsBeforeTL3:-1.5,townsLeftAtTL3:-1,townsLeftBeforeTL3:-2,uncoveredPresence:3,uniquePowerCards:2.8};lastValue={};static extractFeatures(e){const{blightOnBlightCard:a,blightCardActive:t,blightStatus:n,currentFear:i,fearCardsEarned:s,fearCardsInLevelCount:o,fearPool:d,pieceCount:c,spiritCount:l,spirits:h,stage:g,terrorLevel:f,invaderCardsInExploreDeck:u}=e,w=Math.min(sn(h,(e=>e.presence().count)),4)*l,y=nn(h,(e=>e.presence().count)),m=t&&[ac.BlightCorrodesTheSpirit,ac.DownwardSpiral,ac.MemoryFadesToDust,ac.SlowDissolutionOfWill,ac.UntendedLandCrumbles].includes(t)?w:0,v=e.spirits.find((e=>e.spirit===hn.Serpent)),I=v?v.absorbedPresence.length:0,A=v?v.destroyedPresence:0,x=e.spirits.find((e=>e.spirit===hn.Memory)),b=x?Pd(Object.values(x.preparedElements)):0;let T=0;for(const a of e.invaderCardsInSlot(ps.HighImmigration))null!==a&&(T+=e.inLandsWhere((e=>e.matchesInvaderCard(a,K.Build)&&(e.has(Z.Invader)||e.buildCardsAffectLandsWithoutInvaders))).count);let E=0;e.adversaryLeading?.adversary===gc.Sweden&&e.stage<=2&&(E+=e.inLandsWhere((e=>e.hasDahan&&e.numberOfDahan<=e.numberOfInvaders+1)).count);let P=0;for(const a of e.invaderCardsInVisibleSlot(ps.Build))P+=e.inLandsWhere((e=>e.matchesInvaderCard(a,K.Build)&&e.buildPlans===Z.City&&!e.has(Z.Disease)&&(e.has(Z.Invader)||e.buildCardsAffectLandsWithoutInvaders))).count;let S=0;for(const a of e.invaderCardsInVisibleSlot(ps.Build))S+=e.inLandsWhere((e=>e.matchesInvaderCard(a,K.Build)&&e.buildPlans===Z.Town&&!e.has(Z.Disease)&&(e.has(Z.Invader)||e.buildCardsAffectLandsWithoutInvaders))).count;let O=0,C=0;for(const a of e.invaderCardsInVisibleSlot(ps.Ravage)){const t=e.inLandsWhere((e=>e.matchesInvaderCard(a,K.Ravage)&&e.invaders().where((e=>0===e.strife&&!e.doesNotParticipateInRavage)).sum((e=>e.strengthDuringRavage))>=2));C+=t.copy().where((e=>!e.hasBlight&&!e.has(Z.Vitality))).count,O+=t.copy().where((e=>e.hasBlight&&!e.has(Z.Vitality))).count}const D=n===Td.BlightedIsland?C:0,B=n===Td.HealthyIsland?C:0,k=n===Td.BlightedIsland?O:0,L=n===Td.HealthyIsland?O:0,F=Pd(h.map((e=>e.lands.length))),R=Pd(h.map((e=>this.spiritCaresAboutSacredSite(e)?e.numberOfSacredSites:1))),N=Pd(h.map((a=>e.inLandsWhere((e=>e.hasPresenceOf(a)||e.hasAdjacentPresenceOf([a]))).count))),$=e.effectsOfType(r.EnergyDebt).length,W=e.inLandsWhere((e=>e.hasDahan&&e.hasInvaders)).count,M=e.inLandsWhere((e=>e.numberOfDahan>=2&&e.hasInvaders)).count,G=e.inLandsWhere((e=>e.numberOfDahan>=2)).count;let H=0,U=0,q=0,j=0;e.spirits.forEach((e=>{const a=e.numberOfPiecesInLands(Z.Dahan);a>=1&&(H+=1),a>=2&&(U+=1),a>=3&&(q+=1),a>=4&&(j+=1)}));let J=0,V=0,Y=0;e.boards.forEach((e=>{e.numberOf(Z.Dahan)<6&&(Y+=1),e.numberOf(Z.Dahan)<5&&(J+=1),e.numberOf(Z.Dahan)<4&&(V+=1)}));const z=Pd(h.map((a=>this.spiritCaresAboutSacredSite(a)?e.inLandsWhere((e=>e.hasSacredSiteOf(a)||e.hasAdjacentLandWhere((e=>e.hasSacredSiteOf(a))))).count:5))),Q=e.scenario===Xn.RitualsOfTheDestroyingFlame?e.inLandsWithOrAdjacentTo(Z.FlameMarker).count:0,X=e.scenario===Xn.WardTheShores?e.inCoastalLands().numberOf((e=>e.has(Z.WardingPattern))):0,_=e.scenario===Xn.DespicableTheft?e.inCoastalLands().sum((e=>e.numberOf(Z.Thief))):0,ee=e.scenario===Xn.ElementalInvocation?e.inCornersWhere((e=>void 0!==e.element)).count:0,ae=nn(h,(e=>on(e.trackStatus,(e=>e!==fc.Covered)))),te=nn(h,(e=>e.powersWhere((e=>e.isA(ye.Major))).count)),ne=nn(h,(e=>e.powersWhere((e=>e.isA(ye.Minor))).count)),re=nn(h,(e=>e.powersWhere((e=>e.isA(ye.Unique))).count)),ie=nn(h,(e=>Math.abs(e.cardPlays*e.averageEnergyCost-e.trackEnergy))),se=nn(h,(e=>e.powersWhere((e=>e.isInDiscard)).count)),oe=nn(h,(e=>Pd(e.powers.map((e=>e.costToPlay))))),de=nn(h,(e=>e.energy)),ce=n===Td.HealthyIsland?0:1,le=a,he=Math.min(ce?le:3*l,3*l),ge=Pd(o)*d-i,fe=1===f?s.length*l:0,ue=2===f?s.length*l:0,pe=3===f?s.length*l:0,we=u.length*l,[me,ve,Ie,Ae,xe,be,Te,Ee,Pe,Se,Oe,Ce,De,Be,ke]=[p.Badlands,p.Beasts,p.Blight,p.City,p.Dahan,p.Deeps,p.Disease,p.Explorer,p.Omen,p.Quake,p.Thief,p.Town,p.Vitality,p.WardingPattern,p.Wilds].map((e=>c[e]||0)),Le=e.forPieces().sum((e=>e.strife?e.baseHealth:0)),Fe=e.inOceans().sum((e=>e.piecesWhere((e=>e.isOneOf(Z.BadlandsBeastsDiseaseOrWilds,Z.Deeps,Z.Quake))).count)),Re=e.inLandsWhere((e=>e.hasInvaders&&e.has(Z.Disease))).count,Ne=e.inLandsWhere((e=>e.hasInvaders&&e.has(Z.Badlands))).sum((e=>e.numberOf(Z.Badlands))),$e=e.inLandsWhere((e=>e.has(Z.Quake)&&e.hasTownsOrCities)).sum((e=>e.numberOf(Z.Quake))),We=e.inLandsWhere((e=>e.has(Z.Explorer)&&e.has(Z.Beasts))).count,Me=e.inLandsWhere((e=>e.isFlooded)).count,Ge=1===f?Ee:0,He=f>1?Ee:0,Ue=f<3?Ce:0,qe=3===f?Ce:0,je=f<3?S:0,Je=3===f?S:0,Ve=e.inLandsWhere((e=>!e.hasTownsOrCities)).count,Ye=e.inLandsWhere((e=>e.hasTownsOrCities)).count,ze=e.inLandsWhere((e=>e.hasCity)).count,Qe=e.inLandsWhere((e=>e.hasInvaders)).count,Ke=Pd(e.pieces.map((e=>e.damage)));return{absorbedPresence:I,badlandsWithInvaders:Ne,bargainEffects:$,beneficialPiecesInOcean:Fe,blightLeft:le,blightLeftImportant:he,boardsWithLessThanFiveDahan:J,boardsWithLessThanFourDahan:V,boardsWithLessThanSixDahan:Y,cityBuildingLands:P,coastalLandsWithThieves:_,coastalLandsWithWarding:X,damage:Ke,destroyedSerpentPresence:A,discardedCards:se,earnedFearCardsAtTL1:fe,earnedFearCardsAtTL2:ue,earnedFearCardsAtTL3:pe,elementsInCorners:ee,emptyLands:Ve,energy:de,energyMismatch:ie,explorersLeftAtTL1:Ge,explorersLeftBeyondTL1:He,fearLeft:ge,fearPool:d,floodedLands:Me,highImmigrationLands:T,islandIsBlighted:ce,landsAdjacentToFlameMarker:Q,landsAdjacentToPresence:N,landsAdjacentToSacredSite:z,landsWithBuildings:Ye,landsWithCities:ze,landsWithConvertableDahan:E,landsWithDahanAndInvader:W,landsWithExplorersAndBeasts:We,landsWithInvaders:Qe,landsWithInvadersAndDisease:Re,landsWithPresence:F,landsWithSacredSite:R,landsWithTwoDahan:G,landsWithTwoDahanAndInvader:M,majorPowerCards:te,minPresenceOnIsland:w,minPresenceOnIslandDuringDownwardSpiral:m,minorPowerCards:ne,numberOfBadLands:me,numberOfBeasts:ve,numberOfBlight:Ie,numberOfCardsInExploreDeck:we,numberOfCities:Ae,numberOfDahan:xe,numberOfDeeps:be,numberOfDisease:Te,numberOfOmen:Pe,numberOfQuake:Se,numberOfThieves:Oe,numberOfVitality:De,numberOfWardingPattern:Be,numberOfWilds:ke,preparedElements:b,presenceOnIsland:y,quakesWithBuildings:$e,ravagingLandsNoBlightBlighted:D,ravagingLandsNoBlightHealthy:B,ravagingLandsWithBlightBlighted:k,ravagingLandsWithBlightHealthy:L,spiritsWithAtLeast1Dahan:H,spiritsWithAtLeast2Dahan:U,spiritsWithAtLeast3Dahan:q,spiritsWithAtLeast4Dahan:j,stage:g,strifeHealth:Le,sumEnergyCostOfCards:oe,terrorLevel:f,townBuildingLandsAtTL3:Je,townBuildingLandsBeforeTL3:je,townsLeftAtTL3:qe,townsLeftBeforeTL3:Ue,uncoveredPresence:ae,uniquePowerCards:re}}estimateValue(e,a=!1,t){const n=wc.extractFeatures(e),r=t||wc.weights;let i=0;for(const[e,t]of Object.entries(n))a&&this.row(e,r[e]??0,t),i+=(r[e]??0)*t;return i/=e.spiritCount,Promise.resolve(i)}async estimateValueWithReward(e,a=!1,t){let n=await this.estimateValue(e,a,t);return n+=1e3*this.reward(e),Promise.resolve(n)}reward(e){const{winReason:a,lostReason:t}=e;return void 0!==a?1:void 0!==t?-1:0}static spiritCaresAboutSacredSite(e){return void 0!==e.powers.find((e=>e.data.sourceFilter?.includes(l.SacredSite)||e.data.sourceFilter?.includes(l.SacredSiteAndDahan)))}row(e,a,t){const n=this.lastValue[e]??null,r=a*t;console.log(`${pc(e,34)} | ${pc(""+Math.round(10*a)/10,5)} | ${pc(""+Math.round(10*t)/10,5)} | ${pc(`${r.toFixed(2)}`,6)} | ${null!==n?pc(`${(r-n).toFixed(2)}`,6):""}`),this.lastValue[e]=r}}!function(e){e.AccumulatedDevastation="AccumulatedDevastation",e.AnOminousDawn="AnOminousDawn",e.AStrangeMadnessAmongTheBeasts="AStrangeMadnessAmongTheBeasts",e.BureaucratsAdjustFunding="BureaucratsAdjustFunding",e.CitiesRise="CitiesRise",e.CivicEngagement="CivicEngagement",e.CoastalTownsMultiply="CoastalTownsMultiply",e.CulturalAssimilation="CulturalAssimilation",e.DahanTradeWithTheInvaders="DahanTradeWithTheInvaders",e.DistantExploration="DistantExploration",e.EagerExplorers="EagerExplorers",e.EtherealConjunction="EtherealConjunction",e.FarOffWarsTouchTheIsland="FarOffWarsTouchTheIsland",e.FarmersSeekTheDahanForAid="FarmersSeekTheDahanForAid",e.FocusedFarming="FocusedFarming",e.Fortuneseekers="Fortuneseekers",e.GradualCorruption="GradualCorruption",e.HardworkingSettlers="HardworkingSettlers",e.HarvestBountyHarvestDust="HarvestBountyHarvestDust",e.HeavyFarming="HeavyFarming",e.InfluxOfSettlers="InfluxOfSettlers",e.InterestingDiscoveries="InterestingDiscoveries",e.InvadersSurgeInland="InvadersSurgeInland",e.InvestedAristocracy="InvestedAristocracy",e.InvestigationOfDangers="InvestigationOfDangers",e.LesserSpiritsImperiled="LesserSpiritsImperiled",e.LifesBalanceTilts="LifesBalanceTilts",e.MapmakersChartTheWild="MapmakersChartTheWild",e.MissionariesArrive="MissionariesArrive",e.NewSpeciesSpread="NewSpeciesSpread",e.NoBraveryWithoutNumbers="NoBraveryWithoutNumbers",e.NuminousCrisis="NuminousCrisis",e.Outpaced="Outpaced",e.Overconfidence="Overconfidence",e.PopulationRises="PopulationRises",e.PromisingFarmland="PromisingFarmland",e.ProvincialSeat="ProvincialSeat",e.PullTogetherInAdversity="PullTogetherInAdversity",e.PuttingDownRoots="PuttingDownRoots",e.RelentlessOptimism="RelentlessOptimism",e.RemnantsOfASpiritsHeart="RemnantsOfASpiritsHeart",e.ResourcefulPopulace="ResourcefulPopulace",e.RisingInterestInTheIsland="RisingInterestInTheIsland",e.SacredSitesUnderThreat="SacredSitesUnderThreat",e.SearchForNewLands="SearchForNewLands",e.SearchForUnclaimedLand="SearchForUnclaimedLand",e.SeekNewFarmland="SeekNewFarmland",e.SeekingTheInterior="SeekingTheInterior",e.SlaveRebellion="SlaveRebellion",e.SmallerPortsSpringUp="SmallerPortsSpringUp",e.SprawlContainedByTheWilds="SprawlContainedByTheWilds",e.StrangeTalesAttractExplorers="StrangeTalesAttractExplorers",e.TemporaryTruce="TemporaryTruce",e.TerrorSpikesUpwards="TerrorSpikesUpwards",e.TheFrontierCalls="TheFrontierCalls",e.TheStrugglesOfGrowth="TheStrugglesOfGrowth",e.ThrivingTrade="ThrivingTrade",e.TightknitCommunities="TightknitCommunities",e.UrbanDevelopment="UrbanDevelopment",e.VisionsOutOfTime="VisionsOutOfTime",e.WarTouchesTheIslandsShores="WarTouchesTheIslandsShores",e.WaveOfReconnaissance="WaveOfReconnaissance",e.WellpreparedExplorers="WellpreparedExplorers",e.WoundedLandsAttractExplorers="WoundedLandsAttractExplorers",e.YearsOfLittleRain="YearsOfLittleRain"}(uc||(uc={}));var yc=function(e,a,t,n){var r,i=arguments.length,s=i<3?a:null===n?n=Object.getOwnPropertyDescriptor(a,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,a,t,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(i<3?r(s):i>3?r(a,t,s):r(a,t))||s);return i>3&&s&&Object.defineProperty(a,t,s),s};class mc{$;cardMap={};deck;stacked;unused;constructor(e,a){un.makeObservable(this),this.$=e,this.unused=a?a.slice():[],this.deck=this.unused.map((()=>[])),this.stacked=[]}get cardAt(){return e=>{if(e>=this.deck.length)return null;if(1===this.deck[e].length){const a=this.deck[e][0];if("number"!=typeof a)return a}return null}}get cards(){return this.deck.map(((e,a)=>this.cardAt(a)))}get count(){return this.deck.length}get hasRevealed(){return e=>!this.includes(e)||this.deck.some((a=>1===a.length&&a[0]===e||a.some((a=>a===e))&&a.some((e=>"number"==typeof e))))}get includes(){return e=>this.deck.some((a=>a.includes(e)))||this.unused.includes(e)}get isEmpty(){return 0===this.count}get possibleCards(){return this.deck.map(((e,a)=>this.possibleCardsAt(a)))}get possibleCardsAt(){return e=>{if(e>=this.deck.length)return[];if(0===this.deck[e].length)return[...this.unused];{const a=[...this.deck[e]];for(;;){const e=a.findIndex((e=>"number"==typeof e));if(e<0)break;const t=a[e],n=this.cardMap[t];a.splice(e,1,...n&&n.length>0?n:this.unused)}return W(a)}}}get unusedCards(){return this.unused}addStackedCard(e){this.stacked.push(e)}async draw(e=0){await this.reveal(e);const[a]=this.deck.splice(e,1);return void 0!==a?a[0]:void 0}async drawFromBottom(){await this.reveal(this.count-1);const e=this.deck.pop();return void 0!==e?e[0]:void 0}insert(e,a=0){this.insertOneOf([e],a)}insertAtBottom(e){this.insertOneOf([e],this.count)}insertAtBottomOneOf(e){this.insertOneOf(e,this.count)}insertOneOf(e,a=0){this.deck.splice(a,0,e)}putBottomCardToTop(){const e=this.removeCard(this.deck.length-1);void 0!==e&&this.insertOneOf(e)}remove(e){if("number"!=typeof e){const a=this.unused.indexOf(e);a>=0&&this.unused.splice(a,1)}Object.values(this.cardMap).forEach((a=>{const t=a.indexOf(e);t>=0&&a.splice(t,1)})),this.deck.forEach((a=>{const t=a.indexOf(e);t>=0&&a.splice(t,1)}))}removeCard(e){if(e<this.deck.length){const[a]=this.deck.splice(e,1);return a}}async reveal(e){if(e<this.deck.length){const a=this.possibleCardsAt(e);this.$.config.controlledFate&&a.length>1&&await this.$.addEffect({[r.Now]:async()=>{const e=await this.$.query({name:"Controlled Fate",text:"Select Card",query:tn.SelectCard,items:a,actionIds:a.map((e=>`Fate-${e}`))});this.addStackedCard(a[e])}});const t=this.stacked.length>0&&a.includes(this.stacked[0]);let n=await this.getCardFromPossibilities(this.deck[e],t);return await(0,C.h5)((async()=>{for(this.deck[e].length=0,this.remove(n);"number"==typeof n;){const e=await this.getCardFromPossibilities(this.cardMap[n],t);delete this.cardMap[n],this.remove(e),n=e}this.deck[e].push(n)})),n}return null}async shuffleTopNCards(e,a){if(a){const a=[this.deck[e[0]][0]];for(let t=1;t<e.length;t+=1){let n=0;for(;n in this.cardMap;)n+=1;this.cardMap[n]=this.deck[e[t]],a.push(n)}for(let t=0;t<e.length;t+=1)this.deck[e[t]]=[...a]}else{let a=e.map((e=>this.deck[e]));this.$.config.controlledFate?await this.$.may({name:"Controlled Fate",text:"Reverse order?"},!0)&&(a=a.reverse()):a=this.$.shuffle(a);for(let t=0;t<e.length;t+=1)this.deck.splice(e[t],1,a[t])}}get getCardFromPossibilities(){return(e,a)=>{const t=e.length;if(1===t)return Promise.resolve(e[0]);if(0===t)return a&&this.unused.includes(this.stacked[0])?Promise.resolve(this.stacked.shift()):this.$.drawFrom(this.unused,[]);if(a){if(e.includes(this.stacked[0]))return Promise.resolve(this.stacked.shift());{const a=e.find((e=>"number"==typeof e));if(void 0!==a)return Promise.resolve(a)}}return Promise.resolve(this.$.randomFromArray(e))}}}yc([C.sH],mc.prototype,"deck",void 0);const vc=Object.keys(s),Ic=(e,a=1)=>{let t="\n";return Object.entries(e).forEach((([n,r],i)=>{for(let e=0;e<a;e+=1)t+="  ";t+=`${n}: ${null!=r?r:"None"}`,i<Object.entries(e).length-1&&(t+="\n")})),t};var Ac=function(e,a,t,n){var r,i=arguments.length,s=i<3?a:null===n?n=Object.getOwnPropertyDescriptor(a,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,a,t,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(i<3?r(s):i>3?r(a,t,s):r(a,t))||s);return i>3&&s&&Object.defineProperty(a,t,s),s};class xc{blightCardActive;blightCardsInDeck;blightCardsInDiscard=[];blightOnBlightCard=0;blightPool=0;revealedBlightCards=0;slowHealingBlight=0;static allBlightCards=Object.keys(rc);$;currentBlightCardEffect;constructor(e){un.makeObservable(this),this.$=e;const a=this.$.playingWithCommandBeasts,t=e.config.sets??vc;this.blightCardsInDeck=new mc(e,xc.allBlightCards.filter((a=>t.includes(rc[a].set)&&!e.bannedCards.includes(a))).filter((e=>!a||!rc[e].requireEvents))),this.blightOnBlightCard=this.startingBlight}get blightStatus(){return this.blightCardData&&!this.blightCardData.stillHealthy?Td.BlightedIsland:Td.HealthyIsland}get startingBlight(){return this.$.config.boards.length*(this.$.config.blightCards?2:5)+1}get willTakeFromBlightPool(){return this.revealedBlightCards>0}async addBlightToBlightCard(e){e>0&&(this.blightOnBlightCard+=e,await this.$.sendEvent({type:T.BlightAdded,amount:e}))}addBlightToBlightPool(e){return e>0&&(this.blightPool+=e),Promise.resolve()}addOneToRevealedBlightCards(){this.revealedBlightCards+=1}async addSlowHealingBlight(e){this.slowHealingBlight+=e,await this.$.sendEvent({type:T.SlowHealingBlightAdded,amount:e}),await this.$.doEffects(r.AfterAddingSlowHealingBlight)}discardBlightCard(e){return this.blightCardsInDeck.remove(e),this.blightCardsInDiscard.push(e),Promise.resolve()}async removeBlightFromBlightCard(e,a){await te(e,(async()=>{if(this.blightOnBlightCard>0){if(await this.$.oneEffectActivates(r.PreventRemoveBlightFromBlightCard,{location:a}))return;this.blightOnBlightCard-=1,await this.$.sendEvent({type:T.BlightRemoved,amount:1})}0===this.blightOnBlightCard&&this.blightStatus===Td.HealthyIsland&&this.$.config.blightCards&&await this.drawNewBlightCard()}))}removeBlightFromBlightPool(e){return e>0&&(this.blightPool=Math.max(this.blightPool-e,0)),Promise.resolve()}removeSlowHealingBlight(e){return this.slowHealingBlight=Math.max(this.slowHealingBlight-e,0),Promise.resolve()}toString(){return Ic({blightCardsInDeck:this.blightCardsInDeck.count,blightCardActive:this.blightCardActive??"None",blightCardsInDiscard:dn(this.blightCardsInDiscard,(e=>e)),blightOnBlightCard:this.blightOnBlightCard,blightPool:this.blightPool},2)}get blightCardData(){return void 0!==this.blightCardActive?rc[this.blightCardActive]:void 0}async drawNewBlightCard(){if(this.blightCardsInDeck.count>0){this.currentBlightCardEffect&&(this.$.removeEffectsWithName(this.currentBlightCardEffect.name),this.currentBlightCardEffect=void 0);const e=await this.blightCardsInDeck.draw();this.blightCardActive&&this.blightCardsInDiscard.push(this.blightCardActive),this.blightCardActive=e,await this.$.sendEvent({type:T.BlightCardFlipped,blightCard:e});const a={...rc[e],card:e};if(this.willTakeFromBlightPool){const e=Math.min(this.blightPool,a.blightPerPlayer*this.$.boardCount);this.blightPool-=e,this.blightOnBlightCard+=e,this.revealedBlightCards-=1,0===this.revealedBlightCards&&(this.blightOnBlightCard+=this.blightPool,this.blightPool=0)}else this.blightOnBlightCard+=a.blightPerPlayer*this.$.boardCount;await this.$.doEffects(r.BeforeRevealingBlightCard,{blightCard:e}),await this.$.query({query:tn.ClickToContinueCard,items:[e],actionIds:[e]}),await this.$.addEffect({name:a.name,text:`${a.name} drawn.<br><br>When playing solo, if you get a Blight Card which has only 2 Blight per player, you may choose to draw a random replacement.`,card:this.blightCardActive,[r.Now]:async()=>{await this.$.chooseBetween({autoPlayOneOption:!0,effects:[{actionId:"Keep",text:`Keep ${a.name}.`,[r.Now]:async()=>{this.currentBlightCardEffect=a,await this.$.addEffect(a),await this.$.doEffects(r.AfterDrawingBlightCard,{blightCard:e})}},{actionId:"DrawNew",text:"Draw a new blight card.",[r.Now]:async()=>{this.blightOnBlightCard=0,await this.drawNewBlightCard()},condition:()=>1===this.$.spiritCount&&!a.stillHealthy&&2===a.blightPerPlayer}]})}}),0===this.blightOnBlightCard&&this.blightStatus===Td.HealthyIsland&&this.$.config.blightCards&&await this.drawNewBlightCard()}}}Ac([C.sH],xc.prototype,"blightCardActive",void 0),Ac([C.sH],xc.prototype,"blightCardsInDeck",void 0),Ac([C.sH],xc.prototype,"blightCardsInDiscard",void 0),Ac([C.sH],xc.prototype,"blightOnBlightCard",void 0),Ac([C.sH],xc.prototype,"blightPool",void 0),Ac([C.sH],xc.prototype,"revealedBlightCards",void 0),Ac([C.sH],xc.prototype,"slowHealingBlight",void 0);const bc={set:s.BranchAndClaw,name:"A Strange Madness Among The Beasts",events:[{name:"A Strange Madness Among the Beasts",fullText:["&nbsp;&nbsp;They grow even wilder and more savage. You may:","Let them Rampage unto Death","&nbsp;&nbsp;<bullet> Each <beasts> destroys 1 <dahan>.","&nbsp;&nbsp;<bullet> Remove 1 <beasts> from each board.","Guide the Madness","&nbsp;&nbsp;Cost: 3 Energy per <beasts> you decide to keep on the Island (min 3 Energy). Aided by <animal>","&nbsp;&nbsp;<bullet> Remove any number of <beasts>.","&nbsp;&nbsp;<bullet> Each Spirit may Push 1 <beasts> to an adjacent land."],effects:[{textArea:[.168,.521],text:"They grow even wilder and more savage. You may:<br><br>Let them Rampage unto Death <or>Guide the Madness",[r.Now]:async({$:e})=>{await e.chooseBetween({effects:[{actionId:"RampageUntoDeath",label:"Let them Rampage unto Death",effects:[{textArea:[.213,.253],text:"Each <beasts> destroys 1 <dahan>.",[r.Now]:async()=>{await e.inLandsWithAllOf(e.Beasts,e.Dahan).selectOrder().forEach((async a=>{await e.doMainEventAction((async()=>{e.dontCountAs(p.Beasts),await a.destroy({amount:a.numberOf(e.Beasts),pieces:e.Dahan})}),{land:a})}),{noOptions:"No lands with <beasts> and <dahan>."})}},{textArea:[.25,.29],text:"Remove 1 <beasts> from each board.",[r.Now]:()=>e.doMainEventActionOnEachBoard((a=>e.countPieceOnlyIfHavingPiece(p.Beasts,(()=>a.forPiecesThatIs(e.Beasts))).pickOne((async e=>{await e.remove()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No <beasts> to remove.`})))}]},{actionId:"GuideTheMadness",label:"Guide the Madness",effects:[{textArea:[.36,.473],text:"Cost: 3 Energy per <beasts> you decide to keep on the Island (min 3 Energy).<br>Aided by <animal>",[r.Now]:async()=>{await e.doMainEventAction((async()=>{const a=e.forPiecesThatIs(e.Beasts);let t=a.count;for(;!e.playersCanJointlyPayEnergyAidedBy({energy:3*t,element:i.Animal});)t-=1;for(const e of[!1,!0])await a.pickMultiple({optional:e,amount:a.count-(e?0:t),forPickedItem:async e=>{await e.remove()},effect:{prompt:"Pick <beasts> to remove."}});await e.payEnergyJointlyAidedBy({energy:Math.max(3*a.count,3),element:i.Animal}),await e.eachSpirit((a=>e.doMainEventAction((()=>e.forPiecesThatIs(e.Beasts).optionallyPickOne((async e=>{await e.push()}),{textArea:[.466,.506],players:[a],text:"Each Spirit may Push 1 <beasts> to an adjacent land.",noOptions:"No lands with <beasts>."})),{spirit:a})))}))}}],condition:()=>e.playersCanJointlyPayEnergyAidedBy({energy:3,element:i.Animal})}]})}}]},{name:"Savage Frenzy",tokenEvent:!0,effects:[{textArea:[.64,.729],text:"Each <beasts> destroys 1 <explorer> and deals 2 Damage.",[r.Now]:({$:e})=>e.inLandsWith(e.Beasts).selectOrder().forEach((a=>e.doTokenEventAction((async()=>{await a.destroy({amount:a.numberOf(e.Beasts),pieces:e.Explorer}),await a.damage(2*a.numberOf(e.Beasts))}),{land:a})),{noOptions:"No lands with <beasts>."})}]},{name:"Seek a Safer Home",dahanEvent:!0,effects:[{textArea:[.799,.924],text:"On Each Board: Push 2 <dahan> from a land with <beasts>/<disease>/<wilds> to a land without any of these tokens.",[r.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((async a=>(await e.countPieceOptionally(p.Beasts,(()=>a.inLandsWith(e.Dahan).where((a=>a.hasOneOf(e.Beasts,e.Disease,e.Wilds)&&a.hasAdjacentLandWhere((a=>a.dontHaveAnyOf(e.Beasts,e.Disease,e.Wilds))))).filteredByAnyInPriority((a=>a.hasAtLeast(2,e.Dahan)))))).pickOne((async a=>{await a.push({amount:2,pieces:e.Dahan,together:!0,destinationFilter:a=>a.dontHaveAnyOf(e.Beasts,e.Disease,e.Wilds)})}),{highlightBoards:[a],noOptions:`On board ${a.name}: No applicable lands.`})))}]}]},Tc={name:"Beasts Attack",tokenEvent:!0,effects:[{textArea:[.649,.729],text:"Each <beasts> deals 2 Damage. Remove any token that destroys <town>/<city>.",[r.Now]:({$:e})=>e.inLandsWithAllOf(e.Beasts,e.Invader).selectOrder().forEach((a=>e.doTokenEventAction((async()=>{await a.possiblyDontCountPiecesAs(p.Beasts),await te(a.numberOf(e.Beasts),(async()=>{(await a.damage(2,e.Invader)).some((a=>x[a.removement].isDestroyLike&&a.piece.isA(e.TownOrCity)))&&await a.removeOne(e.Beasts)}))}),{land:a})),{noOptions:"No lands with <beasts> and Invaders."})}]},Ec={set:s.BranchAndClaw,name:"Cultural Assimilation",events:[{name:"Cultural Assimilation",terrorLevels:[1,2],effects:[{textArea:[.103,.217],text:"On Each Board: In a land with exactly 1 <dahan> that has or is adjacent to a <city>, replace that <dahan> with 1 <town>.",[r.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>a.forPiecesThatIs(e.Dahan).where((a=>a.location.hasExactly(1,e.Dahan)&&(a.location.has(e.City)||a.location.hasAdjacentLandWhere((a=>a.has(e.City)&&!a.isIsolated))&&!a.location.isIsolated))).pickOne((async e=>{await e.replace([p.Town])}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with exactly 1 <dahan> that has or is adjacent to a <city>.`})))}]},{name:"Reprisal Against the Dahan",terrorLevels:[3],effects:[{textArea:[.373,.48],text:"On Each Board: Choose a land with <dahan> and <town>/<city>. Invaders do 3 Damage to <dahan> there, ignoring Defend Powers.",[r.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>a.inLandsWithAllOf(e.Dahan,e.TownOrCity).pickOne((async a=>{await a.damage(3,e.Dahan)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <dahan> and <town>/<city>.`})))}]},Tc,{name:"Reckless Offensive",dahanEvent:!0,effects:[{textArea:[.79,.939],text:"On Each Board: Choose a land with at least 2 <dahan> and at least 2 <town>/<city>. Each <dahan> destroys 1 <town>/<city>. Add 1 <blight>.",[r.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((a=>a.inLandsWhere((a=>a.hasAtLeast(2,e.Dahan)&&a.hasAtLeast(2,e.TownOrCity))).pickOne((async a=>{await a.destroy({amount:a.numberOf(e.Dahan),pieces:e.TownOrCity}),await a.addBlight(1)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with at least 2 <dahan> and at least 2 <town>/<city>.`})),{selectOrder:!0})}]}]},Pc={name:"Fierce Mien",dahanEvent:!0,effects:[{textArea:[.821,.905],text:"1 <fear> per land with Invaders where <dahan> outnumber <town>/<city>.",[r.Now]:async({$:e})=>{const a=e.inLandsWithAllOf(e.Invader,e.Dahan).where((a=>a.the(e.Dahan).outnumber(e.TownOrCity)));await e.clickToContinue({highlightLocations:a.items,noOptions:`${a.count} land${a.count>1?"s":""} = ${a.count} <fear>.`}),await a.forEach((async a=>{await e.doDahanEventAction((async()=>{await a.fear(1)}),{land:a})}),{noOptions:"No lands with Invaders where <dahan> outnumber <town>/<city>"})}}]},Sc={name:"Grim Toll",tokenEvent:!0,effects:[{textArea:[.636,.754],text:"On Each Board: Choose a land with <disease>. In that land, do 2 Damage to Invaders and 2 Damage to <dahan>.",[r.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((a=>a.inLandsWith(e.Disease).pickOne((async a=>{await a.damage(2),await a.damage(2,e.Dahan)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <disease>.`})),{selectOrder:!0})}]},Oc={set:s.BranchAndClaw,name:"Distant Exploration",events:[{name:"Distant Exploration",terrorLevels:[1],effects:[{textArea:[.107,.284],text:"During the Explore step, Invaders Explore at +1 distance.<br><br>(So a land 2 away from a <town>/<city>/Ocean will be Explored into.)",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.DistantExploration,[r.ExtraExploreDistance]:()=>!0,[r.GlobalReminder]:()=>({icon:"<range+1><br>Explore"})})}}]},{name:"Fearful Mobs",terrorLevels:[2,3],effects:[{textArea:[.372,.447],text:"When Ravaging, Invaders do +3 Damage (per land) in lands with 3 or more Invaders.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.FearfulMobs,[r.AdjustCollectiveInvaderRavageDamage]:({land:e})=>e.participatingInvaders().count>=3?3:0,[r.GlobalReminder]:()=>({icon:"Ravage<br>+3 <damage>"})})}}]},Sc,Pc]},Cc=e=>({name:"New diseases",tokenEvent:!0,effects:[{textArea:e?[.797,.939]:[.615,.76],text:"On half of the boards (rounding up), add 1 <disease> to a land with both <dahan> and Invaders. Do 2 Damage to <dahan> there.",[r.Now]:({$:e})=>e.inBoards().pickMultiple({amount:Math.ceil(e.boards.length/2),forPickedItem:a=>e.doTokenEventAction((()=>a.inLandsWithAllOf(e.Dahan,e.Invader).pickOne((async a=>{await a.add(1,e.Disease),await a.damage(2,e.Dahan)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with both <dahan> and Invaders.`})),{board:a}),effect:{prompt:"Pick board to add <disease>."}})}]}),Dc={set:s.BranchAndClaw,name:"Farmers Seek The Dahan For Aid",events:[{name:"Farmers Seek the Dahan for Aid",fullText:["&nbsp;&nbsp;The Dahan are uncertain whether to teach the Invaders farming techniques more in tune with the Island's life. You recommend they:","Spurn The Invaders","&nbsp;&nbsp;<bullet> On Each Board: 2 Damage to <dahan> in a land with <town>/<city> and <dahan>.","&nbsp;&nbsp;<bullet> On Each Board: Add 1 <blight> to a land with at least 2 <town>/<city>.","&nbsp;&nbsp;<bullet> <town>/<city> have -1 Health (to a minimum of 1) until the end of the turn.","Teach The Invaders","&nbsp;&nbsp;<bullet> On Each Board: Add 1 <town> to a land with <dahan>.","&nbsp;&nbsp;<bullet> The next normal Ravage becomes a Build. (This could be on a future turn.)"],effects:[{textArea:[.247,.681],text:"The Dahan are uncertain whether to teach the Invaders farming techniques more in tune with the Island's life. You recommend they:<br><br>Spurn The Invaders<or>Teach The Invaders",[r.Now]:async({$:e})=>{await e.chooseBetween({effects:[{actionId:"SpurnTheInvaders",label:"Spurn The Invaders",effects:[{textArea:[.284,.359],text:"On Each Board: 2 Damage to <dahan> in a land with <town>/<city> and <dahan>.",[r.Now]:()=>e.doMainEventActionOnEachBoard((a=>a.inLandsWithAllOf(e.Dahan,e.TownOrCity).pickOne((async a=>{await a.damage(2,e.Dahan)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <dahan> and <town>/<city>.`})))},{textArea:[.355,.429],text:"On Each Board: Add 1 <blight> to a land with at least 2 <town>/<city>.",[r.Now]:()=>e.doMainEventActionOnEachBoard((a=>a.inLandsWhere((a=>a.hasAtLeast(2,e.TownOrCity))).pickOne((async e=>{await e.addBlight(1)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with at least 2 <town>/<city>.`})))},{textArea:[.418,.495],text:"<town>/<city> have -1 Health (to a minimum of 1) until the end of the turn.",[r.Now]:async()=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.SpurnTheInvaders,[r.AdjustHealth]:({piece:a})=>a.isA(e.TownOrCity)?-1:0,[r.GlobalReminder]:()=>({icon:"<town>/<city><br>-1 HP"})}),await e.globalHealthCheck()}}]},{actionId:"TeachTheInvaders",label:"Teach The Invaders",effects:[{textArea:[.564,.604],text:"On Each Board: Add 1 <town> to a land with <dahan>.",[r.Now]:()=>e.doMainEventActionOnEachBoard((a=>a.inLandsWith(e.Dahan).pickOne((async a=>{await a.add(1,e.Town)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <dahan>.`})))},{textArea:[.6,.674],text:"The next normal Ravage becomes a Build. (This could be on a future turn.)",[r.Now]:async()=>{await e.clickToContinue(),await e.addSubEffect({effectId:pe.TeachTheInvaders,[r.GlobalReminder]:()=>({icon:"Ravage<br>=Build"}),[r.SkipNextRavageCard]:async({card:a})=>(await e.clickToContinue({name:"Ravage",text:`The Ravage in ${_t[a].text} becomes a Build.`,textArea:void 0,card:a}),await e.buildFromCard(a,ps.Ravage,{noIntro:!0}),e.removeThisEffect(),!0)})}}]}]})}}]},Cc(!0)]},Bc=e=>({name:"Prey on the Unwary",tokenEvent:!0,effects:[{textArea:e?[.82,.9]:[.649,.729],text:"Each <beasts> destroys 1 <explorer>.",[r.Now]:async({$:e})=>{await e.inLandsWith(e.Beasts).selectOrder().forEach((a=>e.doTokenEventAction((async()=>{await a.destroy({amount:a.numberOf(e.Beasts),pieces:e.Explorer})}),{land:a})),{noOptions:"No lands with <beasts>."})}},{textArea:e?[.86,.9]:[.689,.729],text:"Add 1 <beasts> on a board without one.",[r.Now]:({$:e})=>e.doTokenEventAction((async()=>{e.dontCountAs(p.Beasts),await e.inBoardsWithout(e.Beasts).pickOne((a=>a.inLands().pickOne((async a=>{await a.add(1,e.Beasts)}),{highlightBoards:[a]})),{noOptions:"No boards without <beasts>."})}))}]}),kc={set:s.BranchAndClaw,name:"Heavy Farming",events:[{name:"Heavy Farming",blightStatus:Td.HealthyIsland,effects:[{textArea:[.107,.25],text:"During the next normal Ravage, each <town> does +1 Damage. (If there is no Ravage this Phase, leave this card by the Ravage Space until one happens.)",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffect({effectId:pe.HeavyFarming,[r.AdjustIndividualInvaderRavageDamage]:({normal:a,piece:t})=>a&&t.isA(e.Town)?1:0,[r.AfterResolvingRavageCard]:()=>(e.removeThisEffect(),Promise.resolve()),[r.GlobalReminder]:()=>({icon:"<town><br>+1 <damage>"})})}}]},{name:"Overcrowded Cities",blightStatus:Td.BlightedIsland,effects:[{textArea:[.372,.58],text:"On Each Board with <city>: Add 1 <blight> to a land with <city>.<br><br>Spirits may prevent this on any/all boards by destroying 2 <presence> from each board to be protected.",[r.Now]:({$:e})=>e.inBoardsWith(e.City).forEach((a=>e.doMainEventAction((()=>e.chooseBetween({effects:[{actionId:"AddBlight",textArea:[.372,.443],text:"Add 1 <blight> to a land with <city>.",[r.Now]:()=>a.inLandsWith(e.City).pickOne((async e=>{await e.addBlight(1)}),{prompt:"Pick a land to add 1 <blight>.",highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <city>.`})},{actionId:"PreventByDestroyingPresence",textArea:[.474,.58],text:"Prevent this by destroying 2 <presence>.",[r.Now]:()=>a.destroyPresence(2),condition:()=>a.numberOf(e.Presence)>=2}]})),{board:a})),{noOptions:"No boards with <city>."})}]},Bc(!1),{name:"Coming of Age",dahanEvent:!0,effects:[{textArea:[.827,.9],text:"On Each Board: Add 1 <dahan> to a Jungle or Wetland with <dahan>.",[r.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((a=>a.inLandsWith(e.Dahan).where((e=>e.isJungleOrWetlands)).pickOne((async a=>{await a.add(1,e.Dahan)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <dahan> in Jungles or Wetlands.`})))}]}]},Lc={set:s.BranchAndClaw,name:"Interesting Discoveries",events:[{name:"Interesting Discoveries",stages:[1],effects:[{textArea:[.105,.179],text:"On Each Board: Choose a <sacred>. Gather 1 <explorer> into its land, and add 1 additional <explorer>.",[r.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>a.inLandsWhere((e=>e.hasSacredSite)).pickOne((async a=>{await a.gatherOne(e.Explorer),await a.add(1,e.Explorer)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <sacred>.`})),{selectOrder:!0})}]},{name:"Increasing Aggression",stages:[2,3],effects:[{textArea:[.372,.447],text:"Invaders do +1 Damage (per land) when Ravaging.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.IncreasingAggression,[r.AdjustCollectiveInvaderRavageDamage]:()=>1,[r.GlobalReminder]:()=>({icon:"+1 <damage>"})})}}]},{name:"Wheezlelung Outbreak",tokenEvent:!0,effects:[{textArea:[.634,.74],text:"On Each Board: Add 1 <disease> to the Jungle/Wetland with the most <town>/<city> (minimum 1).",[r.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((a=>a.inLandsWith(e.TownOrCity).where((e=>e.isJungleOrWetlands)).withMost((a=>a.numberOf(e.TownOrCity))).pickOne((async a=>{await a.add(1,e.Disease)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No Jungle/Wetland with <town>/<city>.`})))}]},{name:"Tend the Land",dahanEvent:!0,effects:[{textArea:[.823,.9],text:"On Each Board: Remove 1 <blight> from a land with at least 2 <dahan>.",[r.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((a=>a.forPiecesThatIs(e.Blight,(a=>a.hasAtLeast(2,e.Dahan))).pickOne((async e=>{await e.location.removeBlight()}),{prompt:"Pick a <blight> to remove.",highlightBoards:[a]})))}]}]},Fc={name:"Canny Defense",dahanEvent:!0,effects:[{textArea:[.824,.9],text:"During Ravage, in every land, Defend 1 per <dahan> in the land.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.CannyDefense,[r.GlobalReminder]:()=>({icon:"Defend<br><dahan>"}),[r.DefendFromGame]:({land:e})=>e.numberOfParticipatingDahan})}}]},Rc={set:s.BranchAndClaw,name:"Invaders Surge Inland",events:[{name:"Invaders Surge Inland",blightStatus:Td.HealthyIsland,effects:[{textArea:[.107,.183],text:"On a Coastal land on Each Board: Move 1 <town> one or two lands Inland.",[r.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>a.forPiecesThatIs(e.Town,(e=>e.isCoastal)).pickOne((async e=>{const a=await e.move({destinationFilter:a=>a.distanceToNearestOcean>e.location.distanceToNearestOcean,pickDestinationEffect:{noOptions:"Picked land has no land that is more Inland."}});if(a.length>0){const{destination:t}=a[0];await e.move({quantifier:w.May,destinationFilter:e=>e.distanceToNearestOcean>t.distanceToNearestOcean,pickDestinationEffect:{noOptions:"Town can not move further. No lands are more Inland."}})}}),{highlightBoards:[a],noOptions:`On board ${a.name}: No Coastal lands with <town>.`})),{selectOrder:!0})}]},{name:"Widening Destruction",blightStatus:Td.BlightedIsland,effects:[{textArea:[.371,.579],text:"On Each Board: Add 1 <blight> to a land with/adjacent to <town>/<city>.<br><br>Spirits may prevent this on any/all boards by destroying 2 <presence> from each board to be protected.",[r.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>e.chooseBetween({effects:[{actionId:"AddBlight",textArea:[.373,.446],text:"Add 1 <blight> to a land with/adjacent to <town>/<city>.",[r.Now]:()=>a.inLocationsWithOrAdjacentTo(e.TownOrCity).where((e=>e.isLandForBlight)).pickOne((async e=>{await e.addBlight(1)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with/adjacent to <town>/<city>.`})},{actionId:"PreventByDestroyingPresence",textArea:[.474,.58],text:"Prevent this by destroying 2 <presence>.",[r.Now]:()=>a.destroyPresence(2),condition:()=>a.numberOf(e.Presence)>=2}]})),{selectOrder:!0})}]},Sc,Fc]},Nc={set:s.BranchAndClaw,name:"Investigation Of Dangers",events:[{name:"Investigation of Dangers",terrorLevels:[1],effects:[{textArea:[.107,.181],text:"On Each Board: Add 1 <explorer> to a land without Invaders or <dahan>.",[r.Now]:({$:e})=>e.onEachBoard((a=>a.inLandsWithout(e.InvaderOrDahan).pickOne((async a=>{await a.add(1,e.Explorer)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands without Invaders or <dahan>.`})))}]},{name:"Destroy the Unnatural!",terrorLevels:[2,3],effects:[{textArea:[.371,.447],text:"Invaders do +3 Damage (per land) when Ravaging in lands with <presence>.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.DestroyTheUnnatural,[r.AdjustCollectiveInvaderRavageDamage]:({land:a})=>a.hasIgnoringCountAs(e.Presence)?3:0,[r.GlobalReminder]:()=>({icon:"+3 <damage><br><presence>"})})}}]},Bc(!1),{name:"Rouse the Spirits",dahanEvent:!0,effects:[{textArea:[.804,.916],text:"Each Spirit with at least 3 <dahan> among all its lands may use a <slow> Power now (instead of later).",[r.Now]:({$:e})=>e.spiritsWhich((a=>a.numberOfPiecesInLands(e.Dahan)>=3)).selectOrder().forEach((a=>e.doDahanEventAction((async()=>{await Zn.createCollection(e,a.resolvableCardsWithSpeed(d.Slow)).optionallyPickOne((async e=>{await e.owner.targetAndResolvePower(e,!1)}),{players:[a],noOptions:`${a.nameLink} does not have a <slow> Power in play.`})}))),{noOptions:"No spirits have at least 3 <dahan> among all its lands."})}]}]},$c={set:s.BranchAndClaw,name:"Missionaries Arrive",events:[{name:"Missionaries Arrive",fullText:["&nbsp;&nbsp;They teach and spread lessons of a foreign god. You may:","Ignore their contact with the Dahan","&nbsp;&nbsp;<bullet> For each board, discard the top Minor Power. If it has <sun>, Push 1 <explorer> from a land with <dahan>. Otherwise, replace 1 <dahan> with 1 <town>.","&nbsp;&nbsp;<bullet> After resolving this card, return it to the Event Deck under the top 2 cards.","Curse the tongues of the foreigners","&nbsp;&nbsp;Cost: 4 Energy per player. Aided by <sun>.","&nbsp;&nbsp;<bullet> Each Spirit adds 1 <disease> to a land with <city>.","&nbsp;&nbsp;<bullet> 2 <fear> per player.","&nbsp;&nbsp;<bullet> During the next normal Ravage, <city> do +3 Damage."],effects:[{textArea:[.212,.683],text:"They teach and spread lessons of a foreign god. You may:<br><br>Ignore their contact with the Dahan<or>Curse the tongues of the foreigners",[r.Now]:async({$:e})=>{await e.chooseBetween({effects:[{actionId:"IgnoreContact",label:"Ignore their contact with the Dahan",effects:[{textArea:[.25,.363],text:"For each board, discard the top Minor Power. If it has <sun>, Push 1 <explorer> from a land with <dahan>. Otherwise, replace 1 <dahan> with 1 <town>.",[r.Now]:async()=>{await e.clickToContinue(),await e.doMainEventActionOnEachBoard((async a=>{const t=await e.drawAndDiscardPower(o.Minor);if(void 0!==t){let n=!1;t===_e.ElementalBoon&&(n=await e.may({text:"Do you want Elemental Boon to have <sun>?"})),bd[t].elements?.includes(i.Sun)||n?await e.addSubEffect({textArea:void 0,card:t,text:"If it has <sun>, Push 1 <explorer> from a land with <dahan>.",[r.Now]:()=>a.forPiecesThatIs(e.Explorer,(a=>a.has(e.Dahan))).pickOne((async e=>{await e.push()}),{prompt:"Pick a <explorer> to Push.",highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <dahan> and <explorer>.`})}):await e.addSubEffect({textArea:void 0,card:t,text:"Card does not have <sun>:<br><br>Replace 1 <dahan> with 1 <town>.",[r.Now]:()=>a.forPiecesThatIs(e.Dahan).pickOne((async e=>{await e.replace([p.Town])}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <dahan>.`})})}}))}},{textArea:[.358,.433],text:"After resolving this card, return it to the Event Deck under the top 2 cards.",[r.Now]:async()=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({[r.AfterResolvingEventCard]:({eventCard:a})=>(e.removeThisEffect(),e.removeEventCardFromDiscard(a),e.insertEventCard(a).underCards(2),Promise.resolve())})}}]},{actionId:"CurseTheTongues",label:"Curse the tongues of the foreigners",condition:()=>e.playersCanJointlyPayEnergyAidedBy({energy:4*e.spiritCount,element:i.Sun}),effects:[{textArea:[.509,.549],text:"Cost: 4 Energy per player. Aided by <sun>.",[r.Now]:async()=>{await e.payEnergyJointlyAidedBy({energy:4*e.spiritCount,element:i.Sun})}},{textArea:[.541,.581],text:"Each Spirit adds 1 <disease> to a land with <city>.",[r.Now]:()=>e.eachSpirit((()=>e.doMainEventAction((()=>e.inLandsWith(e.City).pickOne((async a=>{await a.add(1,e.Disease)}),{noOptions:"No lands with <city>."})))))},{textArea:[.577,.617],text:"2 <fear> per player.",[r.Now]:async()=>{await e.clickToContinue({noOptions:`${e.spiritCount} player${e.spiritCount>1?"s":""} = ${2*e.spiritCount} <fear>.`}),await e.doMainEventAction((async()=>{await e.fear(2*e.spiritCount)}))}},{textArea:[.611,.682],text:"During the next normal Ravage, <city> do +3 Damage.",[r.Now]:async()=>{await e.clickToContinue(),await e.addSubEffect({effectId:pe.CurseTheTongues,[r.AdjustIndividualInvaderRavageDamage]:({normal:a,piece:t})=>a&&t.isA(e.City)?3:0,[r.AfterResolvingRavageCard]:()=>(e.removeThisEffect(),Promise.resolve()),[r.GlobalReminder]:()=>({icon:"<city><br>+3 <damage>"})})}}]}]})}}]},Bc(!0)]},Wc={name:"Offerings of Pattern and Dance",dahanEvent:!0,effects:[{textArea:[.848,.92],text:"Each Spirit with at least 2 <dahan> among all its lands gains 1 Energy.",[r.Now]:async({$:e})=>{const a=e.spiritsWhich((a=>a.numberOfPiecesInLands(e.Dahan)>=2));await e.clickToContinue({noOptions:a.count>0?`${a.count} out of ${e.spiritCount} Spirits ${a.count>1?"have":"has"} at least 2 <dahan> among all its lands:<br>${a.items.map((e=>e.nameLink)).join(" ")}`:"No spirits have at least 2 <dahan> among all its lands."}),await a.forEach((a=>e.doDahanEventAction((async()=>{await a.gainEnergy(1)}))))}}]},Mc={set:s.BranchAndClaw,name:"New Species Spread",events:[{name:"New Species Spread",fullText:["&nbsp;&nbsp;New plants and animals brought by the Invaders Damage the local ecology. You may:","Let the Invasive Species Bloom","&nbsp;&nbsp;<bullet> For each board, discard the top Minor Power. If it is <fast>, add 1 <blight> to a land with <town>/<city>.","&nbsp;&nbsp;<bullet> After resolving this card, return it to the Event Deck under the top 2 cards.","Transmute the Worst of the Species","&nbsp;&nbsp;Cost: 4 Energy per player. Aided by <moon>.","&nbsp;&nbsp;<bullet> 1 <fear> per player. On Each Board: Add 1 <beasts> to a land with <town>/<city>."],effects:[{textArea:[.212,.584],text:"New plants and animals brought by the Invaders Damage the local ecology. You may:<br><br>Let the Invasive Species Bloom<or>Transmute the Worst of the Species",[r.Now]:async({$:e})=>{await e.chooseBetween({effects:[{actionId:"LetThemBloom",label:"Let the Invasive Species Bloom",effects:[{textArea:[.253,.329],text:"For each board, discard the top Minor Power. If it is <fast>, add 1 <blight> to a land with <town>/<city>.",[r.Now]:async()=>{await e.clickToContinue(),await e.doMainEventActionOnEachBoard((async a=>{const t=await e.drawAndDiscardPower(o.Minor);void 0!==t&&(bd[t].speed===d.Fast?await e.addSubEffect({card:t,textArea:void 0,highlightBoards:[a],text:"If it is <fast>, add 1 <blight> to a land with <town>/<city>.",[r.Now]:()=>a.inLandsWith(e.TownOrCity).pickOne((async e=>{await e.addBlight(1)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <town>/<city>.`})}):await e.clickToContinue({card:t,textArea:void 0,highlightBoards:[a],text:"The discarded Power is <slow>:<br><br>Nothing happens."}))}))}},{textArea:[.319,.393],text:"After resolving this card, return it to the Event Deck under the top 2 cards.",[r.Now]:async()=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({[r.AfterResolvingEventCard]:({eventCard:a})=>(e.removeThisEffect(),e.insertEventCard(a).underCards(2),Promise.resolve())})}}]},{actionId:"TransmuteTheWorst",label:"Transmute the Worst of the Species",condition:()=>e.playersCanJointlyPayEnergyAidedBy({energy:4*e.spiritCount,element:i.Moon}),effects:[{textArea:[.47,.51],text:"Cost: 4 Energy per player. Aided by <moon>.",[r.Now]:async()=>{await e.payEnergyJointlyAidedBy({energy:4*e.spiritCount,element:i.Moon})}},{textArea:[.506,.546],text:"1 <fear> per player.",[r.Now]:async()=>{await e.clickToContinue({noOptions:`${e.spiritCount} player${e.spiritCount>1?"s":""} = ${e.spiritCount} <fear>.`}),await e.doMainEventAction((async()=>{await e.fear(e.spiritCount)}))}},{textArea:[.506,.578],text:"On Each Board: Add 1 <beasts> to a land with <town>/<city>.",[r.Now]:()=>e.doMainEventActionOnEachBoard((a=>a.inLandsWith(e.TownOrCity).pickOne((async a=>{await a.add(1,e.Beasts)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <town>/<city>.`})))}]}]})}}]},Cc(!1),Wc]},Gc={name:"Lingering Plagues",tokenEvent:!0,effects:[{textArea:[.641,.71],text:"On Each Board: Add 1 <disease>.",[r.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((a=>a.inLands().pickOne((async a=>{await a.add(1,e.Disease)}))))},{textArea:[.673,.746],text:"Ignore <disease> during Builds this Invader Phase.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.LingeringPlagues,[r.GlobalReminder]:()=>({icon:"Ignore<br><disease>"}),[r.PreventDiseasePreventingBuilds]:()=>Promise.resolve(!0)})}}]},Hc={set:s.BranchAndClaw,name:"Outpaced",events:[{name:"Outpaced",fullText:["&nbsp;&nbsp;Humanity has always been faster than you, but the Invaders' terrifying speed catches you off guard. Each Spirit chooses independently for each of their Slow Power Cards played this turn:","Stay Steady and Slow","&nbsp;&nbsp;<bullet> Discard the Power Card.","&nbsp;&nbsp;<bullet> Gain 1 Energy, plus the card's printed Energy cost.","Work to Match their Pace","&nbsp;&nbsp;<bullet> Pay 3 Energy.<or>Destroy 2 <presence>.","&nbsp;&nbsp;<bullet> You may choose to resolve the Power Card now. (Instead of during the <slow> Phase.)"],effects:[{textArea:[.279,.581],text:"Humanity has always been faster than you, but the Invaders' terrifying speed catches you off guard. Each Spirit chooses independently for each of their Slow Power Cards played this turn:<br><br>Stay Steady and Slow<or>Work to Match their Pace",[r.Now]:({$:e})=>e.resolvablePowers(d.Slow,!0).where((e=>e.isA(ye.AnyCard))).selectOrder().forEach((a=>e.doMainEventAction((async()=>{const t=[];a.isSlow&&a.mayChangeSpeed?t.push({actionId:"MakeFastToAvoidEffect",label:"Make <fast> to avoid effect.",effects:[{[r.Now]:async()=>{await a.changeSpeedIfNeeded(d.Fast)}}]}):a.isFast&&t.push({actionId:"LeaveItFastToAvoidEffect",label:"Leave it <fast> to avoid effect.",[r.Now]:async()=>{}}),(a.isSlow||a.mayChangeSpeed)&&t.push({actionId:"StaySteadyAndSlow",label:"Stay Steady and Slow",effects:[{textArea:[.318,.358],text:"Discard the Power Card.",[r.Now]:async()=>{await a.changeSpeedIfNeeded(d.Slow),await a.discard()}},{textArea:[.354,.394],text:"Gain 1 Energy, plus the card's printed Energy cost.",[r.Now]:async()=>{await a.owner.gainEnergy(1+a.costToPlay)}}],condition:()=>a.isSlow||a.mayChangeSpeed},{actionId:"WorkToMatchTheirPace",label:"Work to Match their Pace",effects:[{textArea:[.462,.502],text:"Pay 3 Energy.<or>Destroy 2 <presence>.",[r.Now]:async()=>{await a.changeSpeedIfNeeded(d.Slow),await e.chooseBetween({effects:[{actionId:"PayEnergy",text:"Pay 3 Energy.",condition:()=>a.owner.energy>=3,[r.Now]:()=>a.owner.payEnergy(3)},{actionId:"DestroyPresence",text:"Destroy 2 <presence>.",[r.Now]:async()=>{await a.owner.destroyPresence(2)}}]})}},{textArea:[.498,.572],text:"You may choose to resolve the Power Card now. (Instead of during the <slow> Phase.)",[r.Now]:async()=>{!a.isResolved&&await e.may({prompt:`Resolve ${a.powerLink} now?`})&&await a.owner.targetAndResolvePower(a)}}],condition:()=>a.isSlow||a.mayChangeSpeed}),await e.chooseBetween({effects:t})}))),{noOptions:"No resolvable Slow Power Cards."})}]},Gc,{name:"Raids in Force",dahanEvent:!0,effects:[{textArea:[.814,.917],text:"Each Spirit chooses a different land where <dahan> outnumber <town>/<city>. Each <dahan> there does 1 Damage.",[r.Now]:({$:e})=>e.inLandsWhere((a=>a.the(e.Dahan).outnumber(e.TownOrCity))).inDifferent((a=>e.eachSpirit((()=>e.doDahanEventAction((()=>a((async a=>{await a.damage(a.numberOf(e.Dahan))}))))))),{noOptions:"No lands where <dahan> outnumber <town>/<city>."})}]}]},Uc={set:s.BranchAndClaw,name:"Population Rises",events:[{name:"Population Rises",blightStatus:Td.HealthyIsland,effects:[{textArea:[.102,.18],text:"On Each Board: Add 1 <town> to a land with <explorer>/<town>.",[r.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>a.inLandsWith(e.ExplorerOrTown).pickOne((async a=>{await a.add(1,e.Town)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <explorer>/<town>.`})))}]},{name:"Power Fades",blightStatus:Td.BlightedIsland,effects:[{textArea:[.365,.611],text:"Each Spirit chooses independently to: Destroy 2 of their <presence><or>Forget 2 of their Powers<or>Take 1 <blight> from the Blight Card and remove it from the game.",[r.Now]:({$:e})=>e.eachSpirit((a=>e.doMainEventAction((async()=>{await e.chooseBetween({effects:[{actionId:"DestroyPresence",textArea:[.401,.441],text:"Destroy 2 of their <presence>",[r.Now]:async()=>{await a.destroyPresence(2)},condition:()=>a.numberOfPresenceInLands>=2},{actionId:"ForgetPowers",textArea:[.47,.51],text:"Forget 2 of their Powers",condition:()=>a.hasAtLeastNonBlessed(2,ye.AnyCard),[r.Now]:async()=>{await a.forgetPowers({amount:2})}},{actionId:"RemoveBlight",textArea:[.538,.608],text:"Take 1 <blight> from the Blight Card and remove it from the game.",[r.Now]:async()=>{await e.removeBlightFromBlightCard(1)}}]})}))))}]},{name:"Sandfever Outbreak",tokenEvent:!0,effects:[{textArea:[.636,.745],text:"On Each Board: Add 1 <disease> to the Sands or Mountains with most <town>/<city> (minimum 1).",[r.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((a=>a.inLandsWith(e.TownOrCity).where((e=>e.isMountainsOrSands)).withMost((a=>a.numberOf(e.TownOrCity))).pickOne((async a=>{await a.add(1,e.Disease)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <town>/<city>.`})))}]},Wc]},qc={[Ft.Jungles]:{plural:"Jungles",text:"<jungles>"},[Ft.Mountains]:{plural:"Mountains",text:"<mountains>"},[Ft.Sands]:{plural:"Sands",text:"<sands>"},[Ft.Wetlands]:{plural:"Wetlands",text:"<wetlands>"}},jc={set:s.BranchAndClaw,name:"Promising Farmland",events:[{name:"Promising Farmland",blightStatus:Td.HealthyIsland,effects:[{textArea:[.105,.179],text:"When Exploring, once per board, place 1 <town> instead of 1 <explorer>.",[r.Now]:async({$:e})=>{await e.clickToContinue();const a=[];await e.addSubEffectUntilEndOfTurn({effectId:pe.PromisingFarmland,[r.GlobalReminder]:()=>({icon:"Explore<br>+1 <town>"}),[r.ExploreOrderMatters]:()=>!0,[r.AlterInvaderActionInLand]:async({land:t,invaderAction:n})=>{const r=t.boards().where((e=>!a.includes(e.boardIndex)));return n===K.Explore&&r.count>0&&(await t.add(1,e.Town),a.push(r.anyOne.boardIndex),!0)}})}}]},{name:"New Cash Crops take Hold",blightStatus:Td.BlightedIsland,effects:[{textArea:[.373,.582],text:"Invaders immediately Ravage in 1 terrain type not showing under any Invader Action<br><br>Spirits may prevent this on any/all boards by destroying 2 <presence> from each board to be protected.",[r.Now]:({$:e})=>e.doMainEventAction((async()=>{const a=await e.pickTerrainsWhere((a=>!e.showingTerrainTypes.includes(a)),{noOptions:"No terrain types are not showing."});if(!a)return;const t=[];await e.onEachBoard((n=>e.chooseBetween({highlightBoards:[n],prompt:`On board ${n.name}, choose between:`,effects:[{actionId:"Ravage",textArea:[.371,.446],text:`Let Invaders Ravage in ${qc[a].text}.`,[r.Now]:()=>Promise.resolve()},{actionId:"PreventRavage",textArea:[.475,.579],text:"Prevent ravage by destroying 2 <presence>.",[r.Now]:async()=>{t.push(n),await n.destroyPresence(2)},condition:()=>n.numberOf(e.Presence)>=2}]}))),await e.addEffectUntilEndOfAction({[r.PreventInvaderActionInLand]:({land:e})=>Promise.resolve(e.boards().hasOneWhere((e=>t.includes(e))))}),await e.doExtraRavageInTerrain(a)}))}]},{name:"Beasts Provoked",tokenEvent:!0,effects:[{textArea:[.648,.727],text:"On Each Board: Add 1 <beasts> to a land without <blight> that has <town>.",[r.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((a=>a.inLandsWithout(e.Blight).where((a=>a.has(e.Town))).pickOne((async a=>{await a.add(1,e.Beasts)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands without <blight> that has <town>.`})))}]},Fc]},Jc={name:"Stricken",tokenEvent:!0,effects:[{textArea:[.656,.73],text:"In lands with <disease>/<strife>, Invaders skip Ravage Actions.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.Stricken,[r.GlobalReminder]:()=>({icon:"Skip<br>Ravage"}),[r.PreventInvaderActionInLand]:({land:a,invaderAction:t})=>Promise.resolve(t===K.Ravage&&(a.has(e.Disease)||a.participatingInvaders().hasOneWhere((e=>e.strife>0))))})}}]},Vc={set:s.BranchAndClaw,name:"Putting Down Roots",events:[{name:"Putting Down Roots",blightStatus:Td.HealthyIsland,effects:[{textArea:[.107,.181],text:"On an Inland land on Each Board: Replace 1 <explorer> with 1 <town>.",[r.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>a.forPiecesThatIs(e.Explorer,(e=>e.isInland)).pickOne((async e=>{await e.upgrade()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No Inland lands with <explorer>.`})))}]},{name:"The Center Crumbles",blightStatus:Td.BlightedIsland,effects:[{textArea:[.371,.581],text:"On Each Board with Invaders: Add 1 <blight> to an Inland land.<br><br>Spirits may prevent this on any/all boards by destroying 3 <presence> from each board to be protected.",[r.Now]:({$:e})=>e.inBoardsWith(e.Invader).selectOrder().forEach((a=>e.doMainEventAction((()=>e.chooseBetween({highlightBoards:[a],prompt:`On board ${a.name}, choose between:`,effects:[{actionId:"AddBlight",textArea:[.371,.442],text:"Add 1 <blight> to an Inland land.",prompt:"Pick a land to add <blight>.",[r.Now]:()=>a.inInlandLands().pickOne((async e=>{await e.addBlight(1)}))},{actionId:"PreventBlight",textArea:[.472,.582],text:"Prevent <blight> by destroying 3 <presence>.",[r.Now]:()=>a.destroyPresence(3),condition:()=>a.numberOf(e.Presence)>=3}]})),{board:a})),{autoPlayOneOption:!0})}]},Jc,{name:"Drive Off the Interlopers",dahanEvent:!0,effects:[{textArea:[.824,.901],text:"Each player may Push 1 <explorer>/<town> from a land with <dahan>.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doDahanEventAction((()=>e.forPiecesThatIs(e.ExplorerOrTown,(a=>a.has(e.Dahan))).optionallyPickOne((async e=>{await e.push()}),{noOptions:"No lands with <explorer>/<town> and <dahan>."})))))}]}]},Yc={set:s.BranchAndClaw,name:"Rising Interest In The Island",events:[{name:"Rising Interest In The Island",fullText:["&nbsp;&nbsp;Your Island is unlike any the Invaders have seen. Their leaders begin to take interest in tales of strangeness. You may:","Ignore the Curiosity","&nbsp;&nbsp;<bullet> Return the top card of the Invader Deck to the box. (Skip cards specially placed during Setup.)","&nbsp;&nbsp;<bullet> On Each Board: Add 1 <town> to a land without one.","Weave Lies in the Minds of their Observers","&nbsp;&nbsp;Cost: 4 Energy per player. Aided by <air>.","&nbsp;&nbsp;<bullet> Return the top Fear Card to the box.","&nbsp;&nbsp;<bullet> During the next normal Ravage, each <town>/<city> does +1 Damage."],effects:[{textArea:[.227,.567],text:"Your Island is unlike any the Invaders have seen. Their leaders begin to take interest in tales of strangeness. You may:<br><br>Ignore the Curiosity<or>Weave Lies in the Minds of their Observers",[r.Now]:async({$:e})=>{await e.doMainEventAction((async()=>{await e.chooseBetween({effects:[{actionId:"IgnoreTheCuriosity",label:"Ignore the Curiosity",effects:[{textArea:[.265,.337],text:"Return the top card of the Invader Deck to the box. (Skip cards specially placed during Setup.)",[r.Now]:async()=>{await e.clickToContinue(),await e.removeTopNonSpecialExploreCard()}},{textArea:[.332,.372],text:"On Each Board: Add 1 <town> to a land without one.",[r.Now]:()=>e.doMainEventActionOnEachBoard((a=>a.inLandsWithout(e.Town).pickOne((async a=>{await a.add(1,e.Town)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands without <town>.`})))}]},{actionId:"WeaveLies",label:"Weave Lies in the Minds of their Observers",condition:()=>e.playersCanJointlyPayEnergyAidedBy({energy:4*e.spiritCount,element:i.Air}),effects:[{textArea:[.423,.463],text:"Cost: 4 Energy per player. Aided by <air>.",[r.Now]:async()=>{await e.payEnergyJointlyAidedBy({energy:4*e.spiritCount,element:i.Air})}},{textArea:[.456,.496],text:"Return the top Fear Card to the box.",[r.Now]:async()=>{await e.clickToContinue(),await e.removeTopFearCard()}},{textArea:[.49,.565],text:"During the next normal Ravage, each <town>/<city> does +1 Damage.",[r.Now]:async()=>{await e.clickToContinue(),await e.addSubEffect({effectId:pe.WeaveLies,[r.AdjustIndividualInvaderRavageDamage]:({normal:a,piece:t})=>a&&t.isA(e.TownOrCity)?1:0,[r.AfterResolvingRavageCard]:()=>(e.removeThisEffect(),Promise.resolve()),[r.GlobalReminder]:()=>({icon:"<town>/<city><br>+1 <damage>"})})}}]}]})}))}}]},{name:"Beasts of the Jungle",tokenEvent:!0,effects:[{textArea:[.63,.739],text:"On Each Board: Add 1 <beasts> to a Jungle without <blight>. 1 <fear> if Invaders are present.",[r.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((a=>a.inLandsWithout(e.Blight).where((e=>e.isJungle)).pickOne((async a=>{await a.add(1,e.Beasts),a.hasInvaders&&await a.fear(1)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No Jungle without <blight>.`})))}]},{name:"Traps and Snares",dahanEvent:!0,effects:[{textArea:[.822,.897],text:"On Each Board: Add 1 <wilds> to a land with <dahan>.",[r.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((a=>a.inLandsWith(e.Dahan).pickOne((async a=>{await a.add(1,e.Wilds)}),{highlightBoards:[a],noOptions:`On board ${a.name}: no lands with <dahan>.`})))}]}]},zc={name:"Beasts Prowl",tokenEvent:!0,effects:[{textArea:[.634,.746],text:"Each <beasts> generates 1 <fear> if Invaders are present, and moves to an adjacent land if not.",[r.Now]:async({$:e})=>{const a=new Set;await e.inLandsWith(e.Beasts).selectOrder().forEach((t=>e.doTokenEventAction((async()=>{const n=t.piecesWhere((t=>t.isA(e.Beasts)&&!a.has(t)));t.hasInvaders?await t.fear(n.count):await n.forEach((async a=>{await a.move({quantifier:a.isIgnoringCountAsA(e.Beasts)?w.Exactly:w.UpTo})}));for(const e of n.items)a.add(e)}),{land:t})),{noOptions:"No lands with <beasts>."})}}]},Qc={set:s.BranchAndClaw,name:"Sacred Sites Under Threat",events:[{name:"Sacred Sites Under Threat",fullText:["&nbsp;&nbsp;Invaders have begun to find hidden places of natural power. You may:","Let the Island's Strength Repulse Them","&nbsp;&nbsp;<bullet> Each <sacred> Pushes 1 <explorer>/<town> to an adjacent land.","&nbsp;&nbsp;<bullet> Remove 1 <blight> per player from the Blight Card, returning it to the box.","Guard Them Yourself, for Well or Ill","&nbsp;&nbsp;Cost: 3 Energy per land where you do Damage.<br>Aided by <fire>.","&nbsp;&nbsp;In Each land with <sacred> and Invaders:","&nbsp;&nbsp;Either do 2 Damage.<or>Destroy 1 <presence> from each Spirit."],effects:[{textArea:[.194,.602],text:"Invaders have begun to find hidden places of natural power. You may:<br><br>Let the Island's Strength Repulse Them<or>Guard Them Yourself, for Well or Ill",[r.Now]:async({$:e})=>{await e.doMainEventAction((async()=>{await e.chooseBetween({effects:[{actionId:"Repulse",label:"Let the Island's Strength Repulse Them",effects:[{textArea:[.23,.27],text:"Each <sacred> Pushes 1 <explorer>/<town> to an adjacent land.",[r.Now]:()=>e.inLandsWhere((e=>e.hasSacredSite)).selectOrder().forEach((a=>e.doMainEventAction((async()=>{await a.push({amount:a.numberOfSacredSites,pieces:e.ExplorerOrTown})}),{land:a})))},{textArea:[.266,.34],text:"Remove 1 <blight> per player from the Blight Card, returning it to the box.",[r.Now]:async()=>{await e.clickToContinue({noOptions:`${e.spiritCount} player${e.spiritCount>1?"s":""} = ${e.spiritCount} <blight>.`}),await e.removeBlightFromBlightCard(1)}}]},{actionId:"GuardThem",label:"Guard Them Yourself, for Well or Ill",effects:[{textArea:[.39,.604],text:"In Each land with <sacred> and Invaders:<br><br>Either do 2 Damage.<or>Destroy 1 <presence> from each Spirit.",[r.Now]:async()=>{let a=0;await e.inLandsWith(e.Invader).where((e=>e.hasSacredSite)).selectOrder().forEach((t=>e.doMainEventAction((async()=>{await e.chooseBetween({effects:[{actionId:"Damage",textArea:[.496,.536],text:"Do 2 Damage.",[r.Now]:async()=>{a+=1,await t.damage(2)},condition:()=>e.playersCanJointlyPayEnergyAidedBy({energy:3*(a+1)*e.spiritCount,element:i.Fire})},{actionId:"DestroyPresence",textArea:[.561,.601],text:"Destroy 1 <presence> from each Spirit.",[r.Now]:async()=>{await e.eachSpirit((async a=>{await t.destroy({pieces:e.Presence,owner:a})}))}}]})}),{land:t}))),await e.addSubEffect({textArea:[.39,.467],text:"Cost: 3 Energy per land where you do Damage.<br>Aided by <fire>.",[r.Now]:async()=>{await e.payEnergyJointlyAidedBy({energy:3*a*e.spiritCount,element:i.Fire})}})}}]}]})}))}}]},zc,{name:"Spirit Speakers Solve Riddles of Power",dahanEvent:!0,effects:[{textArea:[.845,.913],text:"Each Spirit with at least 4 <dahan> among it lands gains a Minor Power.",[r.Now]:({$:e})=>e.spiritsWhich((a=>a.numberOfPiecesInLands(e.Dahan)>=4)).forEach((a=>e.doDahanEventAction((async()=>{await a.gainPowerCard({powerType:o.Minor})}))),{noOptions:"No spirits has at least 4 <dahan> among it lands."})}]}]},Kc={set:s.BranchAndClaw,name:"Search For New Lands",events:[{name:"Search For New Lands",blightStatus:Td.HealthyIsland,effects:[{textArea:[.107,.186],text:"In Each land with at least 2 <explorer>: Push 1 <explorer> to an adjacent land without Invaders.",[r.Now]:({$:e})=>e.inLandsWhere((a=>a.hasAtLeast(2,e.Explorer))).selectOrder().forEach((a=>e.doMainEventAction((async()=>{await a.push({amount:1,pieces:e.Explorer,destinationFilter:a=>a.doesntHave(e.Invader)})}),{land:a})),{noOptions:"No lands with at least 2 <explorer>"})}]},{name:"Devastated Shores",blightStatus:Td.BlightedIsland,effects:[{textArea:[.371,.579],text:"On Each Board with Invaders: Add 1 <blight> to a Coastal land.<br><br>Spirits may prevent this on any/all boards by destroying 2 <presence> from each board to be protected.",[r.Now]:({$:e})=>e.inBoardsWith(e.Invader).selectOrder().forEach((a=>e.doMainEventAction((async()=>{await e.chooseBetween({prompt:`On board ${a.name}, choose between:`,highlightBoards:[a],effects:[{actionId:"AddBlight",textArea:[.371,.442],text:"Add 1 <blight> to a Coastal land.",prompt:"Pick a land to add <blight>.",[r.Now]:()=>a.inCoastalLocations().where((e=>e.isLandForBlight)).pickOne((async e=>{await e.addBlight(1)}))},{actionId:"PreventByDestroyingPresence",textArea:[.473,.584],text:"Prevent <blight> by destroying 2 <presence>.",[r.Now]:()=>a.destroyPresence(2),condition:()=>a.numberOf(e.Presence)>=2}]})}),{board:a})))}]},{name:"Distant Hunt",tokenEvent:!0,effects:[{textArea:[.638,.748],text:"On Each Board: Push 1 <beasts> to an adjacent land with no <blight>. It deals 1 Damage there.",[r.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((async a=>(await e.countPieceOptionally(p.Beasts,(()=>a.forPiecesThatIs(e.Beasts,(a=>a.hasAdjacentLandWhere((a=>a.doesntHave(e.Blight)))))))).pickOne((async a=>{const t=await a.push({destinationFilter:a=>a.doesntHave(e.Blight)});t.length>0&&await t[0].destination.damage(1)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <beasts> adjacent to a land with no <blight>.`})),{selectOrder:!0})}]},Fc]},Xc={set:s.BranchAndClaw,name:"Seeking The Interior",events:[{name:"Seeking The Interior",stages:[1],effects:[{textArea:[.107,.18],text:"In each Coastal land, Push 1 <explorer> one land Inland.",[r.Now]:({$:e})=>e.inCoastalLands().forEach((a=>e.doMainEventAction((async()=>{await a.push({amount:1,pieces:e.Explorer,destinationFilter:e=>e.distanceToNearestOcean>a.distanceToNearestOcean})}),{land:a})))}]},{name:"Local Diaspora",stages:[2,3],effects:[{textArea:[.367,.444],text:"In the single land with the most Invaders, Push 1 <explorer>/<town> to each adjacent land.",[r.Now]:({$:e})=>e.doMainEventAction((()=>e.inLands().withMost((a=>a.numberOf(e.Invader))).pickOne((async a=>{await a.push({amount:a.adjacentLands.length,pieces:e.ExplorerOrTown,differentLands:!0})}))))}]},zc,{name:"Forsake the Barren Land",dahanEvent:!0,effects:[{textArea:[.805,.917],text:"On Each Board: Push 2 <dahan> from a land with <blight> to a land without <blight>.",[r.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((a=>a.inLandsWithAllOf(e.Dahan,e.Blight).where((a=>a.hasAdjacentLandWhere((a=>a.doesntHave(e.Blight))))).filteredByAnyInPriority((a=>a.hasAtLeast(2,e.Dahan))).pickOne((async a=>{await a.push({amount:2,pieces:e.Dahan,together:!0,destinationFilter:a=>a.doesntHave(e.Blight)})}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <dahan> and <blight> adjacent to a land without <blight>.`})),{selectOrder:!0})}]}]},_c={set:s.BranchAndClaw,name:"Slave Rebellion",events:[{name:"Small Uprising",stages:[1,2],effects:[{textArea:[.239,.279],text:"On Each Board: Add <strife> to 1 <town>.",[r.Now]:async({$:e})=>{await e.doMainEventActionOnEachBoard((a=>a.forPiecesThatIs(e.Town).pickOne((async e=>{await e.addStrife()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No <town>.`})))}},{textArea:[.239,.383],text:"After finishing the Event Card, draw another one, then return this card to the Event Deck as per Setup.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({[r.AfterResolvingEventCard]:async()=>{await e.clickToContinue(),e.removeThisEffect(),e.config.events&&(await e.drawEventCard(),e.config.thematicRebellion?(e.insertEventCard(uc.SlaveRebellion).underCards(0),await e.shuffleTopThreeEventCards(),e.putBottomEventCardToTop(),e.putBottomEventCardToTop()):e.insertEventCard(uc.SlaveRebellion).underCards(3))}})}}]},{name:"Rebellion",stages:[3],effects:[{textArea:[.503,.578],text:"On Each Board: Destroy 1 <town>. Add <strife> to any 2 <town>/<city>.",[r.Now]:async({$:e})=>{await e.doMainEventActionOnEachBoard((async a=>{await a.forPiecesThatIs(e.Town).pickOne((async e=>{await e.destroy()}),{prompt:"Pick a <town> to Destroy.",highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <town>.`}),await a.forPiecesThatIs(e.TownOrCity).pickMultiple({amount:2,forPickedItem:async e=>{await e.addStrife()},effect:{prompt:"Pick <town>/<city> to add <strife>.",highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <town>/<city>.`}})}))}},{textArea:[.539,.608],text:"Then, every Invader takes 1 Damage per <strife> it has.",[r.Now]:async({$:e})=>{await e.inLandsWithStrife().selectOrder().forEach((a=>e.doMainEventAction((()=>a.piecesWithStrife().forEach((async e=>{await e.damageOnlyThis(e.strife)}))),{land:a})),{noOptions:"No lands with <strife>."})}},{textArea:[.575,.679],text:"After finishing this Event Card, draw another one. This card is discarded.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({[r.AfterResolvingEventCard]:async()=>{await e.clickToContinue(),e.removeThisEffect(),e.config.events&&await e.drawEventCard()}})}}]},{name:"Aid the Uprising",dahanEvent:!0,effects:[{textArea:[.809,.914],text:"Invaders with <strife> take 1 Damage per <dahan> present. Add 1 <dahan> per <town>/<city> this destroys.",[r.Now]:async({$:e})=>{await e.inLandsWithStrife().where((a=>a.has(e.Dahan))).selectOrder().forEach((async a=>{const t=a.numberOf(e.Dahan);await e.doDahanEventAction((()=>a.piecesWithStrife().forEach((async n=>{const r=await n.damageOnlyThis(t);for(const{piece:t,removement:n}of r)t.isA(e.TownOrCity)&&x[n].isDestroyLike&&await a.add(1,e.Dahan)}))),{land:a})}),{noOptions:"No lands with <strife> and <dahan>."})}}]}]},Zc={set:s.BranchAndClaw,name:"Strange Tales Attract Explorers",events:[{name:"Strange Tales Attract Explorers",stages:[1],effects:[{textArea:[.107,.147],text:"Now: 1 <fear> per Spirit that has at least 1 <sacred>.",[r.Now]:({$:e})=>e.doMainEventAction((async()=>{const a=e.spiritsWhich((e=>e.numberOfSacredSites>0)).count;await e.clickToContinue({noOptions:`${a} Spirit${a>1?"s":""} with <sacred> = ${a} <fear>.`}),await e.fear(a)}))},{textArea:[.14,.216],text:"After advancing Invaders Cards: Add 1 <explorer> to each land with <sacred>.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.StrangeTalesAttractExplorers,[r.AfterAdvancingCards]:()=>e.inLandsWhere((e=>e.hasSacredSite)).forEach((a=>e.doMainEventAction((async()=>{await a.add(1,e.Explorer)}),{land:a}))),[r.GlobalReminder]:()=>({icon:"+1 <explorer><br><sacred>"})})}}]},{name:"Fortification",stages:[2,3],effects:[{textArea:[.373,.518],text:"After advancing Invader Cards: Invaders Build in one terrain not shown under any Invader Action. (If there's no such terrain, nothing happens.)",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.Fortification,[r.AfterAdvancingCards]:async()=>{const a=await e.pickTerrainsWhere((a=>!e.showingTerrainTypes.includes(a)),{noOptions:"No terrain types are not showing."});a&&await e.doExtraBuildInTerrain(a)},[r.GlobalReminder]:()=>({icon:"Extra<br>Build"})})}}]},Tc,{name:"Coming of Age",dahanEvent:!0,effects:[{textArea:[.824,.904],text:"On Each Board: Add 1 <dahan> to a Mountain or Sands with <dahan>.",[r.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((a=>a.inLandsWith(e.Dahan).where((e=>e.isMountainsOrSands)).pickOne((async a=>{await a.add(1,e.Dahan)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No Mountain or Sands with <dahan>.`})))}]}]},el={name:"Blight Spreads",blightStatus:Td.BlightedIsland,effects:[{textArea:[.371,.585],text:"On Each Board: Add 1 <blight> to a land adjacent to a land with <blight>.<br><br>Spirits may prevent this on any/all boards by destroying 2 <presence> from each board to be protected.",[r.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>e.chooseBetween({highlightBoards:[a],prompt:`On board ${a.name}: choose between:`,effects:[{actionId:"AddBlight",textArea:[.371,.446],text:"Add 1 <blight> to a land adjacent to a land with <blight>",[r.Now]:()=>a.inLocationsWhere((a=>a.isLandForBlight&&a.hasAdjacentLocationWhere((a=>a.isLandForBlight&&a.has(e.Blight))))).pickOne((async e=>{await e.addBlight(1)}),{prompt:"Pick land to add <blight>.",highlightBoards:[a],noOptions:`On board ${a.name}: No lands adjacent to a land with <blight>.`})},{actionId:"PreventByDestroyingPresence",textArea:[.472,.585],text:"Prevent this by destroying 2 <presence>.",[r.Now]:()=>a.destroyPresence(2),condition:()=>a.numberOf(e.Presence)>=2}]})),{selectOrder:!0})}]},al={set:s.BranchAndClaw,name:"Tight-Knit Communities",events:[{name:"Tight-Knit Communities",blightStatus:Td.HealthyIsland,effects:[{textArea:[.107,.181],text:"For the rest of the turn, <town>/<city> have +1 Health.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.TightknitCommunities,[r.AdjustHealth]:({piece:a})=>a.isA(e.TownOrCity)?1:0,[r.GlobalReminder]:()=>({icon:"<town>/<city><br>+1 HP"})})}}]},el,Bc(!1),{name:"Coming of Age",dahanEvent:!0,effects:[{textArea:[.821,.903],text:"On Each Board: Add 1 <dahan> to a Coastal land with <dahan>.",[r.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((a=>a.inCoastalLands().where((a=>a.has(e.Dahan))).pickOne((async a=>{await a.add(1,e.Dahan)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No Coastal lands with <dahan>.`})))}]}]},tl={set:s.BranchAndClaw,name:"Urban Development",events:[{name:"Urban Development",blightStatus:Td.HealthyIsland,effects:[{textArea:[.107,.25],text:"During the next normal Ravage, each <city> does +2 Damage. (If there is no Ravage this Phase, leave this card by the Ravage Space until one happens.)",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffect({effectId:pe.UrbanDevelopment,[r.AdjustIndividualInvaderRavageDamage]:({normal:a,piece:t})=>a&&t.isA(e.City)?2:0,[r.AfterResolvingRavageCard]:()=>(e.removeThisEffect(),Promise.resolve()),[r.GlobalReminder]:()=>({icon:"<city><br>+2 <damage>"})})}}]},{name:"Festering Pits of Blight",blightStatus:Td.BlightedIsland,effects:[{textArea:[.371,.447],text:"On Each Board with Invaders: Add 1 <blight> to a land with at least 2 <blight>, but do not cascade.",[r.Now]:({$:e})=>e.inBoardsWith(e.Invader).selectOrder().forEach((a=>e.doMainEventAction((()=>a.inLocationsWhere((a=>a.isLandForBlight&&a.hasAtLeast(2,e.Blight))).pickOne((async e=>{await e.addBlight(1,{mayCascade:!1})}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with at least 2 <blight>.`})),{board:a})))}]},Gc,Pc]},nl={set:s.BranchAndClaw,name:"War Touches The Islands Shores",events:[{name:"War Touches The Islands Shores",fullText:["&nbsp;&nbsp;Invaders from a different faraway land assault the ones here, torching farms and bombarding Cities. You may:","Allow the Attacks","&nbsp;&nbsp;<bullet> For each board, discard the top Major Power. Deal its Energy in Damage to Invaders and the land in the Coastal land with the most <town>/<city> (minimum 1). Defend reduces the Damage to both Invaders and the Land.","Help Repel the Newcomers","&nbsp;&nbsp;Cost: 1 Energy per player.","&nbsp;&nbsp;<bullet> Add a Fear Card to the top of the Fear Deck."],effects:[{textArea:[.245,.607],text:"Invaders from a different faraway land assault the ones here, torching farms and bombarding Cities. You may:<br><br>Allow the Attacks<or>Help Repel the Newcomers",[r.Now]:async({$:e})=>{await e.chooseBetween({effects:[{actionId:"AllowTheAttacks",label:"Allow the Attacks",textArea:[.285,.462],text:"For each board, discard the top Major Power. Deal its Energy in Damage to Invaders and the land in the Coastal land with the most <town>/<city> (minimum 1). Defend reduces the Damage to both Invaders and the Land.",[r.Now]:()=>e.doMainEventActionOnEachBoard((async a=>{await a.inCoastalLands().where((a=>a.has(e.TownOrCity))).withMost((a=>a.numberOf(e.TownOrCity))).pickOne((async a=>{const t=await e.drawAndDiscardPower(o.Major);if(void 0!==t){const n=bd[t].energy-a.defense;await e.addSubEffect({card:t,textArea:void 0,text:"Deal its Energy in Damage to Invaders and the land in the Coastal land with the most <town>/<city> (minimum 1). Defend reduces the Damage to both Invaders and the Land.",[r.Now]:async()=>{n>0?(await a.damage(n),await a.damageLand(n)):await e.clickToContinue({noOptions:"Defend reduced the Damage to 0."})}})}}),{highlightBoards:[a],noOptions:`On board ${a.name}: no Coastal land with <town>/<city>.`})}),{selectOrder:!0})},{actionId:"RepelTheNewcomers",label:"Help Repel the Newcomers",condition:()=>e.playersCanJointlyPayEnergyAidedBy({energy:e.spiritCount}),effects:[{textArea:[.532,.572],text:"Cost: 1 Energy per player.",[r.Now]:async()=>{await e.payEnergyJointlyAidedBy({energy:e.spiritCount})}},{textArea:[.567,.607],text:"Add a Fear Card to the top of the Fear Deck.",[r.Now]:async()=>{await e.clickToContinue(),await e.addFearCards(1).toLevel(e.terrorLevel)}}]}]})}}]},{name:"Beasts Find New Homes",tokenEvent:!0,effects:[{textArea:[.627,.743],text:"On Each Board: Push 1 <beasts> to an adjacent land without <blight>. 1 <fear> if Invaders are present there.",[r.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((async a=>(await e.countPieceOptionally(p.Beasts,(()=>a.forPiecesThatIs(e.Beasts,(a=>a.hasAdjacentLandWhere((a=>a.doesntHave(e.Blight)))))))).pickOne((async a=>{const t=await a.push({destinationFilter:a=>a.doesntHave(e.Blight)});t.length>0&&t[0].destination.hasInvaders&&await t[0].destination.fear(1)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No <beasts> adjacent to a land without <blight>.`})),{selectOrder:!0})}]},{name:"Reclaim Territory",dahanEvent:!0,effects:[{textArea:[.814,.923],text:"Each player may Push 1 <dahan> to an adjacent land, doing 1 Damage there.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doDahanEventAction((()=>e.forPiecesThatIs(e.Dahan).optionallyPickOne((async e=>{const a=await e.push();a.length>0&&await a[0].destination.damage(1)}),{noOptions:"No <dahan>."})))))}]}]},rl={set:s.BranchAndClaw,name:"Wave Of Reconnaissance",events:[{name:"Wave Of Reconnaissance",stages:[1],effects:[{textArea:[.108,.179],text:"When Exploring: Add 1 additional <explorer> to each land Explored.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.WaveOfReconnaissance,[r.AfterSuccessfulExplore]:async({land:a})=>{await a.add(1,e.Explorer)},[r.GlobalReminder]:()=>({icon:"+1 <explorer>"})})}}]},{name:"Urbanization",stages:[2,3],effects:[{textArea:[.371,.446],text:"In each land with at least 2 <town>, replace half the <town> (rounding up) with <city>.",[r.Now]:({$:e})=>e.inLandsWhere((a=>a.hasAtLeast(2,e.Town))).selectOrder().forEach((a=>e.doMainEventAction((async()=>{const t=Math.ceil(a.numberOf(e.Town)/2);await a.replaceIndividually({amount:t,pieces:e.Town,withPiece:p.City})}),{land:a})),{noOptions:"No lands with at least 2 <town>."})}]},Jc,{name:"Retreat",dahanEvent:!0,effects:[{textArea:[.821,.899],text:"On Each Board: Push 2 <dahan> from a land with <city> to a land without <city>.",[r.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((a=>a.forPiecesThatIs(e.Dahan,(a=>a.has(e.City)&&a.hasAdjacentLandWhere((a=>a.doesntHave(e.City))))).filteredByAnyInPriority((a=>a.location.hasAtLeast(2,e.Dahan))).pickOne((async a=>{const t=a.location,n=await a.push({withoutWait:t.numberOf(e.Dahan)>=2,destinationFilter:a=>a.doesntHave(e.City)});n.length>0&&t.has(e.Dahan)&&await t.piecesThatAre(e.Dahan).autoPickOne((async e=>{await e.push({pickDestinationEffect:{autoPlayOneOption:!0},destinationFilter:e=>e===n[0].destination})}))}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <dahan> and <city> adjacent to a land without <city>.`})),{selectOrder:!0})}]}]},il={set:s.BranchAndClaw,name:"Well-prepared Explorers",events:[{name:"Well-prepared Explorers",blightStatus:Td.HealthyIsland,effects:[{textArea:[.105,.145],text:"For the rest of this turn, <explorer> have +1 Health.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.WellpreparedExplorers,[r.AdjustHealth]:({piece:a})=>a.isIgnoringCountAsA(e.Explorer)?1:0,[r.GlobalReminder]:()=>({icon:"<explorer><br>+1 HP"})})}}]},el,zc,{name:"Coming of Age",dahanEvent:!0,effects:[{textArea:[.828,.904],text:"On Each Board: Add 1 <dahan> to an Inland with <dahan>.",[r.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((a=>a.inInlandLands().where((a=>a.has(e.Dahan))).pickOne((async a=>{await a.add(1,e.Dahan)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No Inland lands with <dahan>.`})),{selectOrder:!0})}]}]},sl={set:s.BranchAndClaw,name:"Years Of Little Rain",events:[{name:"Years Of Little Rain",fullText:["&nbsp;&nbsp;A terrible drought parches the Island. You may:","Let the Plants die and the Land Wither","&nbsp;&nbsp;<bullet> For each board, discard the top Minor Power. If it lacks <water>, add 1 <blight> to a Sands.","&nbsp;&nbsp;<bullet> <town>, <city>, and <dahan> have -1 Health (minimum 1) until the end of the turn.","Act to Ease the Drought","&nbsp;&nbsp;Cost: 4 Energy per player. Aided by <water>.","&nbsp;&nbsp;<bullet> Each Spirit may add 1 <presence> to one of their lands with <dahan>."],effects:[{textArea:[.179,.549],text:"A terrible drought parches the Island. You may:<br><br>Let the Plants die and the Land Wither<or>Act to Ease the Drought",[r.Now]:async({$:e})=>{await e.chooseBetween({effects:[{actionId:"LetThePlantsDie",label:"Let the Plants die and the Land Wither",effects:[{textArea:[.219,.299],text:"For each board, discard the top Minor Power. If it lacks <water>, add 1 <blight> to a Sands.",[r.Now]:()=>e.doMainEventActionOnEachBoard((async a=>{const t=await e.drawAndDiscardPower(o.Minor);if(void 0===t)return;let n=!1;t===_e.ElementalBoon&&(n=await e.may({text:"Do you want Elemental Boon to have <water>?"})),bd[t].elements.includes(i.Water)||n?await e.clickToContinue({card:t,textArea:void 0,highlightBoards:[a],text:"The discarded Power has <water>:<br><br>Nothing happens."}):await e.addSubEffect({card:t,textArea:void 0,highlightBoards:[a],text:"If it lacks <water>, add 1 <blight> to a Sands.",[r.Now]:()=>a.inSands().pickOne((async e=>{await e.addBlight(1)}))})}),{selectOrder:!0})},{textArea:[.294,.365],text:"<town>, <city>, and <dahan> have -1 Health (minimum 1) until the end of the turn.",[r.Now]:async()=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.YearsOfLittleRain,[r.AdjustHealth]:({piece:a})=>a.isOneOf(e.Town,e.City,e.Dahan)?-1:0,[r.GlobalReminder]:()=>({icon:"-1 HP"})}),await e.globalHealthCheck()}}]},{actionId:"ActToEase",label:"Act to Ease the Drought",condition:()=>e.playersCanJointlyPayEnergyAidedBy({energy:4*e.spiritCount,element:i.Water}),effects:[{textArea:[.44,.48],text:"Cost: 4 Energy per player. Aided by <water>.",[r.Now]:async()=>{await e.payEnergyJointlyAidedBy({energy:4*e.spiritCount,element:i.Water})}},{textArea:[.475,.544],text:"Each Spirit may add 1 <presence> to one of their lands with <dahan>.",[r.Now]:()=>e.eachSpirit((a=>e.doMainEventAction((async()=>{a.presence().hasOneWhere((a=>a.location.has(e.Dahan)))?await a.addPresence({filter:a=>a.has(e.Dahan)}):await e.clickToContinue({noOptions:`${a.nameLink} has no lands with <dahan>.`})}))))}]}]})}}]},Tc,Fc]},ol={name:"Coordinated Defense",dahanEvent:!0,effects:[{textArea:[.805,.918],text:"When Invaders Ravage, if the land has both <dahan> and <presence>, Defend 5.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.CoordinatedDefense,[r.GlobalReminder]:()=>({icon:"Defend<br><dahan>+<presence>"}),[r.DefendFromGame]:({land:a})=>a.has(e.Presence)&&a.numberOfParticipatingDahan>0?5:0})}}]},dl={set:s.JaggedEarth,name:"Bureaucrats Adjust Funding",events:[{name:"Bureaucrats Adjust Funding",terrorLevels:[1,2],effects:[{textArea:[.104,.177],text:"On Each Board with 9 or more <town>/<city>: Build Cards skip the highest-numbered matching land.",[r.Now]:({$:e})=>e.inBoardsWhere((a=>a.numberOf(e.TownOrCity)>=9)).forEach((async a=>{for(const t of e.invaderCardsInVisibleSlot(ps.Build)){const n=a.highestNumberedLandMatching(t,K.Build);await e.addSubEffectUntilEndOfTurn({effectId:pe.BureaucratsAdjustFunding,[r.Reminder]:e=>e===n?"Build Cards skip the highest-numbered matching land.":void 0,[r.PreventInvaderActionInLand]:async({land:a,invaderAction:r,card:i})=>r===K.Build&&i===t&&a===n&&(await e.sendEvent({type:T.GenericSub,text:`The Build in land ${a.coordinateLink} was prevented by <e>BureaucratsAdjustFunding</e>.`}),!0)})}}),{noOptions:"No boards with 9 or more <town>/<city>."})},{textArea:[.168,.305],text:"On Each Board with 3 or fewer <town>/<city>: Build Cards cause 1 extra Build Action in the highest-numbered matching land. (This can affect a land without Invaders.)",[r.Now]:({$:e})=>e.inBoardsWhere((a=>a.numberOf(e.TownOrCity)<=3)).forEach((async a=>{for(const t of e.invaderCardsInVisibleSlot(ps.Build)){const n=a.highestNumberedLandMatching(t,K.Build);n&&await e.addSubEffectUntilEndOfTurn({effectId:pe.BureaucratsAdjustFunding,[r.Reminder]:e=>e===n?"Build Cards cause 1 extra Build Action in the highest-numbered matching land.":void 0,[r.AfterResolvingBuildCard]:async({card:a,normal:t})=>{t&&(await e.sendEvent({type:T.GenericSub,text:`<e>BureaucratsAdjustFunding</e> caused an extra Build in land ${n.coordinateLink}.`}),await n.doNormalBuild(a),e.removeThisEffect())}})}}),{noOptions:"No boards with 3 or fewer <town>/<city>."})}]},{name:"Ransack and Run",terrorLevels:[3],effects:[{textArea:[.393,.5],text:"After the Ravage Step, On Each Board: In the land with the most <city> (min. 1), Ravage, then Remove 1 <city>.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.RansackAndRun,[r.GlobalReminder]:()=>({icon:"Extra<br>Ravage"}),[r.AfterTheNormalRavageStep]:()=>e.doMainEventActionOnEachBoard((a=>a.inLandsWithMostMinimumOne(e.City).pickOne((async a=>{await a.doExtraRavage(),await a.remove({amount:1,pieces:e.City})}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <city>.`})))})}}]},{name:"Terrifying Beasts",tokenEvent:!0,effects:[{textArea:[.64,.732],text:"2 <fear> per board with 2 or more <beasts>.",[r.Now]:async({$:e})=>{const a=e.inBoardsWhere((a=>a.numberOf(e.Beasts)>=2));await e.clickToContinue({highlightBoards:a.items,noOptions:`${a.count} board${a.count>1?"s":""} = ${2*a.count} <fear>.`}),await e.doTokenEventAction((async()=>{await e.fear(2*a.count)}))}}]},ol]},cl={name:"Beasts chase off Homesteaders",tokenEvent:!0,effects:[{textArea:[.668,.738],text:"On Each Board: Push up to 2 <explorer> or 1 <town> from a land with <beasts>.",[r.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((a=>a.forPiecesThatIs(e.ExplorerOrTown,(a=>a.has(e.Beasts))).optionallyPickOne((async a=>{const t=await a.push();t.length>0&&t[0].piece.isA(e.Explorer)&&await t[0].source.pushUpTo(1,e.Explorer)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No <explorer>/<town> in a land with <beasts>.`})),{selectOrder:!0})}]},ll={name:"Careful Defense",dahanEvent:!0,effects:[{textArea:[.82,.896],text:"When Invaders Ravage, if the land has <dahan>, Defend 2.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.CarefulDefense,[r.GlobalReminder]:()=>({icon:"Defend<br><dahan>"}),[r.DefendFromGame]:({land:e})=>e.numberOfParticipatingDahan>0?2:0})}}]},hl={set:s.JaggedEarth,name:"Cities Rise",events:[{name:"Cities Rise",blightStatus:Td.HealthyIsland,effects:[{textArea:[.104,.223],text:"On Each Board: In the land with the most <town>, Replace 2 <town> with 2 <city>. (If there is only 1 <town>, instead Replace it with 1 <city>.)",[r.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>a.inLandsWithMostMinimumOne(e.Town).pickOne((async a=>{const t=Math.min(a.numberOf(e.Town),2);await a.replaceIndividually({amount:t,pieces:e.Town,withPiece:p.City})}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <town>.`})))}]},{name:"Depleted Soil",blightStatus:Td.BlightedIsland,effects:[{textArea:[.372,.451],text:"In lands with <town>/<city>, it only takes 1 Damage to add <blight>.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.DepletedSoil,[r.AdjustLandHealth]:({land:a})=>a.has(e.TownOrCity)?-1:0,[r.GlobalReminder]:()=>({icon:"Lands<br>-1 HP"})})}}]},cl,ll]},gl={set:s.JaggedEarth,name:"Civic Engagement",events:[{name:"Civic Engagement",blightStatus:Td.HealthyIsland,effects:[{textArea:[.104,.221],text:"On Each Board: Remove 1 <strife>. If you can't Invaders do +1 Damage (per land) when Ravaging in lands with <town>/<city>.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.doMainEventActionOnEachBoard((async a=>{const t=a.forPiecesWhere((e=>e.strife>0));t.count>0?await t.pickOne((async e=>{await e.removeStrife()})):await e.addSubEffectUntilEndOfTurn({effectId:pe.CivicEngagement,[r.GlobalReminder]:()=>({icon:`${a.name}<br>+1 <damage>`,text:`On board ${a.name}: +1 Damage (per land) when Ravaging in lands with <town>/<city>.`}),[r.AdjustCollectiveInvaderRavageDamage]:({land:t})=>t.boards().has(a)&&t.participatingInvaders().where((a=>a.isA(e.TownOrCity))).count>0?1:0})}))}}]},{name:"Life's Web Torn Asunder",blightStatus:Td.BlightedIsland,effects:[{textArea:[.373,.452],text:"On Each Board with 6 or more <blight>: Add 1 <blight> to a land adjacent to <blight>.",[r.Now]:({$:e})=>e.inBoardsWhere((a=>a.numberOf(e.Blight)>=6)).selectOrder().forEach((a=>e.doMainEventAction((()=>a.inLocationsWhere((a=>a.isLandForBlight&&a.hasAdjacentLocationWithPiece(e.Blight))).pickOne((async e=>{await e.addBlight(1)}))),{board:a})),{noOptions:"No boards with 6 or more <blight>."})}]},{name:"Casualties of Fang and Sting",tokenEvent:!0,effects:[{textArea:[.667,.743],text:"On Each Board: Destroy 1 <explorer>/<town> in a land with <beasts>.",[r.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((a=>a.forPiecesThatIs(e.ExplorerOrTown,(a=>a.has(e.Beasts))).pickOne((async e=>{await e.destroy()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <explorer>/<town> and <beasts>.`})),{selectOrder:!0})}]},{name:"Keep Far from the Lands of Plague",dahanEvent:!0,effects:[{textArea:[.839,.914],text:"On Each Board: Push 3 <dahan> from lands with <disease> to lands without <disease>.",[r.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((a=>a.forPiecesThatIs(e.Dahan,(a=>a.has(e.Disease)&&a.hasAdjacentLandWhere((a=>a.doesntHave(e.Disease))))).pickMultiple({amount:3,effect:{highlightBoards:[a],noOptions:`On board ${a.name}: No such lands.`},forPickedItem:async a=>{await a.push({destinationFilter:a=>a.doesntHave(e.Disease)})}})))}]}]},fl={name:"Explorers Blunder",tokenEvent:!0,effects:[{textArea:[.651,.735],text:"On Each Board: Destroy 2 <explorer> among lands with <beasts>.",[r.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((a=>a.forPiecesThatIs(e.Explorer,(a=>a.has(e.Beasts))).pickMultiple({amount:2,forPickedItem:async e=>{await e.destroy()},effect:{prompt:"Destroy <explorer> among lands with <beasts>.",highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <beasts> and <explorer>.`},repeatSame:!0})),{selectOrder:!0})}]},ul={set:s.JaggedEarth,name:"Coastal Towns Multiply",events:[{name:"Coastal Towns Multiply",blightStatus:Td.HealthyIsland,effects:[{textArea:[.107,.183],text:"On Each Board: Add 1 <town> to a Coastal land adjacent to a Coastal <town>.",[r.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>a.inCoastalLands().where((a=>!a.isIsolated&&a.hasAdjacentLandWhere((a=>a.isCoastal&&a.has(e.Town)&&!a.isIsolated)))).pickOne((async a=>{await a.add(1,e.Town)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No Coastal lands adjacent to a Coastal <town>.`})),{selectOrder:!0})}]},{name:"Cooperation Among Towns",blightStatus:Td.BlightedIsland,effects:[{textArea:[.375,.453],text:"Invaders do +1 Damage (per land) when Ravaging in lands with <town>/<city> and no <strife>.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.CooperationAmongTowns,[r.GlobalReminder]:()=>({icon:"<town>/<city><br>+1 <damage>"}),[r.AdjustCollectiveInvaderRavageDamage]:({land:a})=>a.participatingInvaders().where((a=>a.isA(e.TownOrCity))).count>0&&!a.hasStrife?1:0})}}]},fl,{name:"Coming of Age",dahanEvent:!0,effects:[{textArea:[.82,.893],text:"On Each Board: Add 1 <dahan> to a land with <dahan> and no <blight>/<disease>.",[r.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((a=>a.inLandsWith(e.Dahan).where((a=>a.dontHaveAnyOf(e.Blight,e.Disease))).pickOne((async a=>{await a.add(1,e.Dahan)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <dahan> and no <blight>/<disease>.`})))}]}]},pl={set:s.JaggedEarth,name:"Dahan Trade With The Invaders",events:[{name:"Dahan Trade With The Invaders",fullText:["&nbsp;&nbsp;Some seek knowledge, others are interested in tools and trade goods, still others simply curious. All hope to avoid violence, and the Invaders seem amenable - at least for now. You may:","Ignore their Interest","&nbsp;&nbsp;<dahan> do not participate in Ravages this turn.","Display Your Wrath at this Betrayal","&nbsp;&nbsp;Cost: 2 Energy per player, aided by <fire>.","&nbsp;&nbsp;Each Spirit with <dahan> in their lands Destroys 1 of them and generates 1 <fear>.","Change and Help them Learn from the Enemy","&nbsp;&nbsp;Cost: 6 Energy per player, aided by <air>.","&nbsp;&nbsp;<dahan> do not participate in Ravages this turn.","&nbsp;&nbsp;Each Spirit Forgets a Power Card.","&nbsp;&nbsp;From next turn on, each <dahan> provides Defend 1 in its land. (There is a Reminder Card for this.)"],effects:[{textArea:[.263,.743],text:"Some seek knowledge, others are interested in tools and trade goods, still others simply curious. All hope to avoid violence, and the Invaders seem amenable - at least for now. You may:<br><br>Ignore Their Interest<or>Display Your Wrath at this Betrayal<or>Change and Help them Learn from the Enemy",[r.Now]:async({$:e})=>{await e.chooseBetween({effects:[{actionId:"IgnoreTheirInterest",label:"Ignore Their Interest",textArea:[.309,.349],text:"<dahan> do not participate in Ravages this turn.",[r.Now]:async()=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.IgnoreTheirInterest,[r.GlobalReminder]:()=>({icon:"<dahan><br>DNPIR"}),[r.DoesNotParticipateInRavage]:async({location:a})=>{await a.doNotParticipateInRavage({pieces:e.Dahan})}})}},{actionId:"DisplayYourWrath",label:"Display Your Wrath at this Betrayal",textArea:[.436,.508],text:"Each Spirit with <dahan> in their lands Destroys 1 of them and generates 1 <fear>.",condition:()=>e.playersCanJointlyPayEnergyAidedBy({energy:2*e.spiritCount,element:i.Fire}),[r.Now]:async()=>{await e.addSubEffect({effects:[{textArea:[.399,.439],text:"Cost: 2 Energy per player, aided by <fire>.",[r.Now]:async()=>{await e.payEnergyJointlyAidedBy({energy:2*e.spiritCount,element:i.Fire})}},{[r.Now]:()=>e.spiritsWhich((a=>a.hasPieceInLands(e.Dahan))).selectOrder().forEach((a=>e.doMainEventAction((async()=>{await a.forPiecesThatIs(e.Dahan).pickOne((async e=>{await e.destroy()}),{prompt:"Pick <dahan> to Destroy.",noOptions:`${a.nameLink} has no lands with <dahan>.`}),await e.fear(1)}))),{noOptions:"No spirits with <dahan> in their lands."})}]})}},{actionId:"ChangeAndHelp",label:"Change and Help them Learn from the Enemy",condition:()=>e.playersCanJointlyPayEnergyAidedBy({energy:6*e.spiritCount,element:i.Air}),effects:[{textArea:[.561,.601],text:"Cost: 6 Energy per player, aided by <air>.",[r.Now]:async()=>{await e.payEnergyJointlyAidedBy({energy:6*e.spiritCount,element:i.Air})}},{textArea:[.594,.634],text:"<dahan> do not participate in Ravages this turn.",[r.Now]:async()=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.ChangeAndHelp,[r.GlobalReminder]:()=>({icon:"<dahan><br>DNPIR"}),[r.DoesNotParticipateInRavage]:async({location:a})=>{await a.doNotParticipateInRavage({pieces:e.Dahan})}})}},{textArea:[.627,.667],text:"Each Spirit Forgets a Power Card.",[r.Now]:()=>e.eachSpirit((a=>e.doMainEventAction((async()=>{await a.forgetPowers()}))))},{textArea:[.661,.731],text:"From next turn on, each <dahan> provides Defend 1 in its land.",[r.Now]:async()=>{await e.clickToContinue();const a=e.turn+1;await e.addSubEffect({[r.GlobalReminder]:()=>({icon:"Defend<br><dahan>",ongoing:!0}),[r.DefendFromGame]:({land:t})=>e.turn>=a?t.numberOfParticipatingDahan:0})}}]}]})}}]},{name:"Outbreaks Shift",tokenEvent:!0,effects:[{textArea:[.839,.913],text:"On Each Board: Push 1 <disease> to the adjacent land with the most Invaders (min. 1).",[r.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((a=>a.forPiecesThatIs(e.Disease,(a=>a.hasAdjacentLandWithPiece(e.Invader))).pickOne((async a=>{const t=a.location.inAdjacentLands().maxNumberOf((a=>a.numberOf(e.Invader)));await a.push({destinationFilter:a=>a.numberOf(e.Invader)===t})}),{prompt:"Pick a <disease> to Push."})),{selectOrder:!0})}]}]},wl={set:s.JaggedEarth,name:"Eager Explorers",events:[{name:"Eager Explorers",terrorLevels:[1],effects:[{textArea:[.106,.217],text:"On Each Board: After the first successful Build Action, add 1 <explorer> to an adjacent land without Invaders.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.onEachBoard((async a=>{await e.addSubEffectUntilEndOfTurn({effectId:pe.EagerExplorers,[r.GlobalReminder]:()=>({icon:"+1 <explorer>"}),[r.AfterSuccessfulBuild]:async({land:t})=>{t.boards().has(a)&&(t.isIsolated||await t.inAdjacentLandsWhere((a=>a.doesntHave(e.Invader)&&!a.isIsolated)).pickOne((async a=>{await a.add(1,e.Explorer)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No adjacent lands without Invaders.`}),e.removeThisEffect())}})}))}}]},{name:"Xenophobia",terrorLevels:[2,3],effects:[{textArea:[.372,.485],text:"When Ravaging in lands with <dahan>, each individual Invader does -1 Damage to the land and +1 Damage to <dahan>.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.Xenophobia,[r.GlobalReminder]:()=>({icon:"-1/+1 <damage>"}),[r.AdjustIndividualInvaderRavageDamage]:({piece:e,towardsLand:a})=>e.isInvader&&e.location.numberOfParticipatingDahan>0?a?-1:1:0})}}]},cl,{name:"At Their Gates Demanding Redress",dahanEvent:!0,effects:[{textArea:[.857,.897],text:"2 <fear> per land with <dahan> and <city>.",[r.Now]:async({$:e})=>{const a=e.inLandsWithAllOf(e.Dahan,e.City);await e.clickToContinue({highlightLocations:a.items,noOptions:`${a.count} land${a.count>1?"s":""} = ${2*a.count} <fear>.`}),await a.forEach((a=>e.doDahanEventAction((async()=>{await a.fear(2)}),{land:a})))}}]}]},yl={set:s.JaggedEarth,name:"Fortune-Seekers",events:[{name:"Fortune-Seekers",blightStatus:Td.HealthyIsland,effects:[{textArea:[.106,.218],text:"The next Explore Card matches all lands without <town>/<city> instead of the printed land type. Ignore any <escalation> on it.",[r.Now]:async({$:e})=>{await e.clickToContinue();let a=null;await e.addSubEffectUntilEndOfTurn({effectId:pe.Fortuneseekers,[r.GlobalReminder]:()=>({icon:"Explore<br>Changed"}),[r.OverrideMatchesInvaderCard]:({land:a,invaderAction:t})=>t===K.Explore?!a.has(e.TownOrCity):void 0,[r.PreventEscalation]:({card:e})=>null===a?(a=e,Promise.resolve(!0)):Promise.resolve(!1),[r.AfterResolvingExploreCard]:()=>(e.removeThisEffect(),Promise.resolve())})}}]},{name:"The land's Bounty Exhausted",blightStatus:Td.BlightedIsland,effects:[{textArea:[.369,.442],text:"In lands without <presence>, it only takes 1 Damage to add <blight>.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.TheLandsBountyExhausted,[r.AdjustLandHealth]:({land:a})=>a.doesntHave(e.Presence)?-1:0,[r.GlobalReminder]:()=>({icon:"Land<br>-1 HP"})})}}]},Sc,{name:"Tell the Old Stories",dahanEvent:!0,effects:[{textArea:[.789,.93],text:"Each Spirit with at least 2 <dahan> among its lands either Reclaims 1 Power Card or re-gains a Unique Power it previously Forgot.",[r.Now]:({$:e})=>e.spiritsWhich((a=>a.numberOfPiecesInLands(e.Dahan)>=2)).forEach((a=>e.doDahanEventAction((async()=>{await e.chooseBetween({players:[a],noOptions:`${a.nameLink} has no reclaimable/forgotten cards.`,effects:[{actionId:"Reclaim",text:"Reclaim 1 Power Card.",[r.Now]:async()=>{await a.reclaim(1)},condition:()=>a.hasReclaimableCards},{actionId:"Regain",text:"Re-gain a previously Forgotten Unique Power.",condition:()=>a.availableRememberedUniques.length>0,[r.Now]:async()=>{await a.gainPowerCard({fromSelection:a.availableRememberedUniques,taken:!0})}}]})}))),{noOptions:"No Spirit has at least 2 <dahan> among its lands."})}]}]},ml={set:s.JaggedEarth,name:"Gradual Corruption",events:[{name:"Gradual Corruption",blightStatus:Td.HealthyIsland,effects:[{textArea:[.107,.352],text:"On Each Board: Add 1 <blight> to a land with <town>/<city>.<br><br>Spirits may prevent this on any/all boards py paying X Energy per board to protect where X is the number of cards in the Invader discard. (This may be 0.)",[r.Now]:async({$:e})=>{const a=e.invaderCardsInVisibleSlot(ps.Discard).length;await e.doMainEventActionOnEachBoard((t=>e.chooseBetween({prompt:`On board ${t.name}, choose between:`,highlightBoards:[t],effects:[{actionId:"AddBlight",text:"Add 1 <blight> to a land with <town>/<city>.",[r.Now]:()=>t.inLandsWith(e.TownOrCity).pickOne((async e=>{await e.addBlight(1)}),{noOptions:"No lands with <town>/<city>."})},{actionId:"PreventByPayingEnergy",text:`Prevent <blight> by jointly paying ${a} Energy.`,[r.Now]:async()=>{await e.payEnergyJointlyAidedBy({energy:a})},condition:()=>e.playersCanJointlyPayEnergyAidedBy({energy:a})}]})))}}]},{name:"Ravaged Wilderness",blightStatus:Td.BlightedIsland,effects:[{textArea:[.418,.494],text:"On Each Board: Remove 1 <beasts> from a land with <blight>. Remove 1 <wilds> from a land with <blight>.",[r.Now]:({$:e})=>e.doMainEventActionOnEachBoard((async a=>{await e.addSubEffect({effects:[{textArea:[.418,.494],text:"Remove 1 <beasts> from a land with <blight>.",[r.Now]:()=>e.countPieceOnlyIfHavingPiece(p.Beasts,(()=>a.forPiecesThatIs(e.Beasts,(a=>a.has(e.Blight))))).pickOne((async e=>{await e.remove()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <beasts> and <blight>.`})},{textArea:[.452,.492],text:"Remove 1 <wilds> from a land with <blight>.",[r.Now]:()=>a.forPiecesThatIs(e.Wilds,(a=>a.has(e.Blight))).pickOne((async e=>{await e.remove()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <wilds> and <blight>.`})}]})}))}]},{name:"Fatalities Rise",tokenEvent:!0,effects:[{textArea:[.617,.76],text:"In each land with <disease>, 1 Damage to each Invader and 1 Damage to each <dahan>. Remove 1 <disease> from each land where this Destroys any <town>/<city>.",[r.Now]:({$:e})=>e.inLandsWith(e.Disease).selectOrder().forEach((a=>e.doTokenEventAction((async()=>{const t=await a.damageEach(1);await a.damageEach(1,e.Dahan),t.some((({removement:a,piece:t})=>x[a].isDestroyLike&&t.isA(e.TownOrCity)))&&await a.removeOne(e.Disease)}),{land:a})),{noOptions:"No lands with <disease>."})}]},{name:"Blessings of Bounty and Health",dahanEvent:!0,effects:[{textArea:[.838,.914],text:"Each Spirit may add 1 <dahan> to one of its lands with <dahan>.",[r.Now]:({$:e})=>e.eachSpirit((a=>e.doDahanEventAction((()=>a.inLandsWith(e.Dahan).optionallyPickOne((async a=>{await a.add(1,e.Dahan)}),{noOptions:`${a.nameLink} has no lands with <dahan>.`})))))}]}]},vl={set:s.JaggedEarth,name:"Hard-Working Settlers",events:[{name:"Hard-Working Settlers",fullText:["&nbsp;&nbsp;The latest round of settlers are regrettably diligent, focused, and curious. You may:","Act Cautiously in the Background","&nbsp;&nbsp;<bullet> Push up to 2 <dahan>.","&nbsp;&nbsp;<bullet> Add 1 <town> to a land without <town>.","&nbsp;&nbsp;<bullet> Immediately Ravage in the land with the most Invaders that matches a Ravage Card.","Create Unnerving Distractions at the cost of piquing their interest.","&nbsp;&nbsp;<bullet> Ravage Cards skip up to one matching land on each board. (Players choose which.)","&nbsp;&nbsp;<bullet> 1 <fear> per player.","&nbsp;&nbsp;<bullet> Remove the bottommost Stage II and Stage III Cards in the Invader Deck from the game."],effects:[{textArea:[.197,.708],text:"The latest round of settlers are regrettably diligent, focused, and curious. You may:<br><br>Act Cautiously in the Background<or>Create Unnerving Distractions",[r.Now]:async({$:e})=>{await e.doMainEventAction((async()=>{await e.chooseBetween({effects:[{actionId:"ActCautiously",label:"Act Cautiously in the Background",[r.Now]:()=>e.doMainEventActionOnEachBoard((async a=>{await e.addSubEffect({highlightBoards:[a],effects:[{textArea:[.274,.314],text:"Push up to 2 <dahan>.",[r.Now]:async()=>{const t=[];await a.forPiecesThatIs(e.Dahan).pickMultiple({amount:2,forPickedItem:async e=>{t.push(e),await e.push()},where:e=>!t.includes(e),optional:!0,repeatSame:!0,effect:{highlightBoards:[a],prompt:"Pick <dahan> to Push.",noOptions:`On board ${a.name}: No lands with <dahan>.`}})}},{textArea:[.308,.348],text:"Add 1 <town> to a land without <town>.",[r.Now]:()=>a.inLandsWithout(e.Town).pickOne((async a=>{await a.add(1,e.Town)}),{prompt:"Pick a land to add 1 <town>.",highlightBoards:[a],noOptions:`On board ${a.name}: No lands without <town>.`})},{textArea:[.345,.418],text:"Immediately Ravage in the land with the most Invaders that matches a Ravage Card.",[r.Now]:()=>a.inLandsWhere((a=>a.hasInvaders&&a.matchesInvaderCards(e.invaderCardsInVisibleSlot(ps.Ravage),K.Ravage))).withMost((a=>a.numberOf(e.Invader))).pickOne((async e=>{await e.doExtraRavage()}),{prompt:"Pick a land to Ravage.",highlightBoards:[a],noOptions:`On board ${a.name}: No lands with Invaders match a Ravage Card.`})}]})}),{selectOrder:!0})},{actionId:"CreateUnnervingDistractions",label:"Create Unnerving Distractions",effects:[{textArea:[.523,.594],text:"Ravage Cards skip up to one matching land on each board. (Players choose which.)",[r.Now]:async()=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.CreateUnnervingDistractions,[r.GlobalReminder]:()=>({icon:"Skip<br>Ravage"}),[r.BeforeResolvingInvaderCard]:async({card:a,invaderAction:t})=>{t===K.Ravage&&await e.doMainEventActionOnEachBoard((t=>t.inLandsWhere((e=>e.matchesInvaderCard(a,K.Ravage))).optionallyPickOne((async t=>{await e.addEffectUntilEndOfTurn({[r.OverrideMatchesInvaderCard]:e=>(e.land!==t||e.card!==a||e.invaderAction!==K.Ravage)&&void 0})}))))}})}},{textArea:[.589,.629],text:"1 <fear> per player.",[r.Now]:async()=>{await e.clickToContinue({noOptions:`${e.spiritCount} player${e.spiritCount>1?"s":""} = ${e.spiritCount} <fear>.`}),await e.doMainEventAction((async()=>{await e.fear(e.spiritCount)}))}},{textArea:[.624,.697],text:"Remove the bottommost Stage II and Stage III Cards in the Invader Deck from the game.",[r.Now]:async()=>{await e.clickToContinue(),await e.removeBottomMostInvaderCardOfStage(2),await e.removeBottomMostInvaderCardOfStage(3)}}]}]})}))}}]},{name:"Beasts Prey on the Injured",tokenEvent:!0,effects:[{textArea:[.828,.868],text:"This turn, <beasts> also count as <badlands>.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.BeastsPreyOnTheInjured,[r.BeastsCountAsBadlands]:()=>!0,[r.GlobalReminder]:()=>({icon:"<beasts>=<badlands>"})})}},{textArea:[.863,.933],text:"On Each Board: Destroy a Damaged Invader in a land with <beasts>.",[r.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((async a=>(await e.countPieceOptionally(p.Beasts,(()=>a.forPiecesWhere((a=>a.isInvader&&a.damage>0&&a.location.has(e.Beasts)))))).pickOne((async e=>{await e.destroy()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No Damaged Invader in a land with <beasts>.`})))}]}]},Il={set:s.JaggedEarth,name:"Harvest Bounty, Harvest Dust",events:[{name:"Harvest Bounty, Harvest Dust",stages:[1,2],effects:[{textArea:[.106,.32],text:"If the island is Healthy, On Each Board: Choose a land with <town>/<city>. Ravage there.<br><br>If the island is Blighted, On Each Board: Push 1 <town> from a land with 2 or more <town>/<city> to a land without <town>/<city>.",[r.Now]:async({$:e})=>{e.blightStatus===Td.HealthyIsland?await e.addSubEffect({textArea:[.106,.187],text:"If the island is Healthy, On Each Board: Choose a land with <town>/<city>. Ravage there.",[r.Now]:()=>e.doMainEventActionOnEachBoard((a=>a.inLandsWith(e.TownOrCity).pickOne((async e=>{await e.doExtraRavage()}))),{selectOrder:!0})}):await e.addSubEffect({textArea:[.21,.32],text:"If the island is Blighted, On Each Board: Push 1 <town> from a land with 2 or more <town>/<city> to a land without <town>/<city>.",[r.Now]:()=>e.doMainEventActionOnEachBoard((a=>a.forPiecesThatIs(e.Town,(a=>a.hasAtLeast(2,e.TownOrCity)&&a.hasAdjacentLandWhere((a=>a.doesntHave(e.TownOrCity))))).pickOne((async a=>{await a.push({destinationFilter:a=>a.doesntHave(e.TownOrCity)})}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with 2 or more <town>/<city> adjacent to a land without <town>/<city>.`})),{selectOrder:!0})})}}]},{name:"Widespread Clearcutting",stages:[3],effects:[{textArea:[.394,.537],text:"On Each Board: Choose a land with <town>/<city>. Add 1 <blight> there, without cascading. Players may Destroy 2 <presence>/<dahan> in that land to prevent adding <blight>.",[r.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>a.inLandsWith(e.TownOrCity).pickOne((async a=>{await e.chooseBetween({effects:[{actionId:"AddBlight",textArea:[.426,.466],text:"Add 1 <blight> there, without cascading.",[r.Now]:async()=>{await a.addBlight(1,{mayCascade:!1})}},{actionId:"PreventByDestroyingPresence",textArea:[.429,.541],text:"Prevent adding <blight> by Destroying 2 <presence>/<dahan> in this land.",condition:()=>a.piecesWhere((a=>a.isPresence||a.isA(e.Dahan))).count>=2,[r.Now]:async()=>{await a.destroy({amount:2,filter:a=>a.isPresence||a.isA(e.Dahan)})}}]})}))))}]},fl,{name:"Coordinated Strikes",dahanEvent:!0,effects:[{textArea:[.821,.894],text:"In each land with 3 or more <dahan>, 2 Damage and Defend 2.",[r.Now]:async({$:e})=>{await e.inLandsWhere((a=>a.hasAtLeast(3,e.Dahan))).selectOrder().forEach((async e=>{await e.damage(2)}),{noOptions:"No lands with 3 or more <dahan>."}),await e.addSubEffectUntilEndOfTurn({effectId:pe.CoordinatedStrikes,[r.GlobalReminder]:()=>({icon:"3 <dahan><br>Defend"}),[r.DefendFromGame]:({land:e})=>e.numberOfParticipatingDahan>=3?2:0})}}]}]},Al=e=>({name:"Prey on the Heedless",tokenEvent:!0,effects:[{textArea:e?[.66,.735]:[.653,.727],text:"In each land with <beasts>, 1 Damage per <beasts>.",[r.Now]:({$:e})=>e.inLandsWith(e.Beasts).selectOrder().forEach((a=>e.doTokenEventAction((async()=>{await a.damage(a.numberOf(e.Beasts))}),{land:a})),{noOptions:"No lands with <beasts>."})}]}),xl={set:s.JaggedEarth,name:"Invested Aristocracy",events:[{name:"Invested Aristocracy",stages:[1,2],effects:[{textArea:[.105,.217],text:"After the Ravage Step, On Each Board: If no <blight> was added to this board, add 1 <town> to the highest-numbered land with no Invaders.",[r.Now]:async({$:e})=>{let a=[];await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.InvestedAristocracy,[r.GlobalReminder]:()=>({icon:"+1 <town>"}),[r.StartOfRavageStep]:()=>(a=e.boards.map((a=>a.numberOf(e.Blight))),Promise.resolve()),[r.AfterTheNormalRavageStep]:()=>e.doMainEventActionOnEachBoard((async t=>{t.numberOf(e.Blight)<=a[t.boardIndex]&&await t.inLandsWhere((a=>a===t.highestNumberedLand((a=>a.doesntHave(e.Invader))))).pickOne((async a=>{await a.add(1,e.Town)}),{prompt:"Pick a land to add <town>.",highlightBoards:[t],noOptions:`On board ${t.name}: No lands without Invaders.`})}))})}}]},{name:"Foreign Dignitaries Visit",stages:[3],effects:[{textArea:[.369,.576],text:"If the island is Healthy, Ravages do +2 Damage (total) in the lowest-numbered matching land on each board.<br><br>If the island is Blighted, add 1 Fear Card to the top of the Fear Deck.",[r.Now]:async({$:e})=>{e.blightStatus===Td.HealthyIsland?await e.addSubEffect({textArea:[.369,.477],text:"If the island is Healthy, Ravages do +2 Damage (total) in the lowest-numbered matching land on each board.",[r.Now]:async()=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.ForeignDignitariesVisit,[r.GlobalReminder]:()=>({icon:"Ravage<br>+2 <damage>"}),[r.BeforeResolvingInvaderCard]:async({card:a,invaderAction:t})=>{t===K.Ravage&&await e.onEachBoard((async t=>{const n=t.lowestNumberedLandMatching(a,K.Ravage);await e.addSubEffectUntilEndOfTurn({[r.Reminder]:e=>e===n?"Ravages do +2 Damage (total).":void 0,[r.AdjustCollectiveInvaderRavageDamage]:e=>e.land===n?2:0,[r.AfterResolvingRavageCard]:()=>(e.removeThisEffect(),Promise.resolve())})}))}})}}):await e.addSubEffect({textArea:[.502,.576],text:"If the island is Blighted, add 1 Fear Card to the top of the Fear Deck.",[r.Now]:async()=>{await e.clickToContinue(),await e.doMainEventAction((async()=>{await e.addFearCards(1).toLevel(e.terrorLevel)}))}})}}]},Al(!1),{name:"Coming of Age",dahanEvent:!0,effects:[{textArea:[.821,.891],text:"On Each Board: Add 1 <dahan> to an land with 2 or more <dahan>.",[r.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((a=>a.inLandsWhere((a=>a.hasAtLeast(2,e.Dahan))).pickOne((async a=>{await a.add(1,e.Dahan)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with 2 or more <dahan>.`})))}]}]},bl={name:"Return to Old Pillars",dahanEvent:!0,effects:[{textArea:[.803,.915],text:"On Each Board: Gather 1 or 2 <dahan> into a land with <dahan> Setup symbols.",[r.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((a=>a.inLandsWhere((a=>a.setupSymbols.includes(p.Dahan)&&a.hasAdjacentLandWithPiece(e.Dahan))).pickOne((async a=>{await a.gather({quantifier:w.UpToMinimumOne,amount:2,pieces:e.Dahan})}),{highlightBoards:[a]})),{selectOrder:!0})}]},Tl={set:s.JaggedEarth,name:"Lesser Spirits Imperiled",events:[{name:"Lesser Spirits Imperiled",fullText:["&nbsp;&nbsp;The Invaders' spread is threatening many of the island's smaller Spirits. You may:","Tend to your own Strength","&nbsp;&nbsp;<bullet> Each Spirit gains 1 Energy.","&nbsp;&nbsp;<bullet> Discard 1 Minor Power per player from the deck. For each with <plant>, Remove 1 <blight> from the Blight Card, returning it to the box. For each with <animal>, Destroy 1 <dahan> in a land with <blight>.","Forge a Web of Mutual Support","&nbsp;&nbsp;Cost: 4 Energy per player, aided by <plant>.","&nbsp;&nbsp;<bullet> Each Spirit Destroys 1 of their <presence>.","&nbsp;&nbsp;<bullet> Each Spirit gains 1 permanent Element for the rest of the game. (Choose separately, now.)"],effects:[{textArea:[.196,.6],text:"The Invaders' spread is threatening many of the island's smaller Spirits. You may:<br><br>Tend to your own Strength<or>Forge a Web of Mutual Support",[r.Now]:async({$:e})=>{await e.chooseBetween({effects:[{actionId:"TendToYourOwnStrength",label:"Tend to your own Strength",effects:[{textArea:[.23,.27],text:"Each Spirit gains 1 Energy.",[r.Now]:async()=>{await e.clickToContinue(),await e.eachSpirit((a=>e.doMainEventAction((async()=>{await a.gainEnergy(1)}))))}},{textArea:[.265,.403],text:"Discard 1 Minor Power per player from the deck. For each with <plant>, Remove 1 <blight> from the Blight Card, returning it to the box. For each with <animal>, Destroy 1 <dahan> in a land with <blight>.",[r.Now]:async()=>{await e.clickToContinue(),await e.eachSpirit((()=>e.doMainEventAction((async()=>{const a=await e.drawAndDiscardPower(o.Minor);void 0!==a&&await e.addSubEffect({textArea:[.265,.403],text:"Discard 1 Minor Power per player from the deck. For each with <plant>, Remove 1 <blight> from the Blight Card, returning it to the box. For each with <animal>, Destroy 1 <dahan> in a land with <blight>.",[r.Now]:async()=>{const t=bd[a].elements?.includes(i.Plant),n=bd[a].elements?.includes(i.Animal);t&&await e.addSubEffect({card:a,textArea:void 0,text:"For each with <plant>, Remove 1 <blight> from the Blight Card, returning it to the box.",[r.Now]:async()=>{await e.clickToContinue(),await e.removeBlightFromBlightCard(1)}}),n&&await e.addSubEffect({card:a,textArea:void 0,text:"For each with <animal>, Destroy 1 <dahan> in a land with <blight>.",[r.Now]:async()=>{await e.clickToContinue(),await e.inLandsWithAllOf(e.Blight,e.Dahan).pickOne((async a=>{await a.destroyOne(e.Dahan)}),{noOptions:"No lands with <dahan> and <blight>."})}}),t||n||await e.clickToContinue({card:a,textArea:void 0,text:"The discarded Power has neither <plant> nor <animal>."})}})}))))}}]},{actionId:"ForgeAWeb",label:"Forge a Web of Mutual Support",condition:()=>e.playersCanJointlyPayEnergyAidedBy({energy:4*e.spiritCount,element:i.Plant}),effects:[{textArea:[.457,.497],text:"Cost: 4 Energy per player, aided by <plant>.",[r.Now]:async()=>{await e.payEnergyJointlyAidedBy({energy:4*e.spiritCount,element:i.Plant})}},{textArea:[.49,.53],text:"Each Spirit Destroys 1 of their <presence>.",[r.Now]:()=>e.eachSpirit((a=>e.doMainEventAction((async()=>{await a.destroyPresence(1)}))))},{textArea:[.523,.597],text:"Each Spirit gains 1 permanent Element for the rest of the game. (Choose separately, now.)",[r.Now]:()=>e.eachSpirit((a=>e.doMainEventAction((async()=>{await a.gainElements({amount:1,forTheRestOfTheGame:!0})}))))}]}]})}}]},{name:"Quit the Farmed Lands",tokenEvent:!0,effects:[{textArea:[.633,.745],text:"On Each Board: Push 1 <beasts> to a land without <town>/<city>. 1 <fear> if <explorer> are present there.",[r.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((async a=>(await e.countPieceOptionally(p.Beasts,(()=>a.forPiecesThatIs(e.Beasts,(a=>a.hasAdjacentLandWhere((a=>a.doesntHave(e.TownOrCity)))))))).pickOne((async a=>{const t=await a.push({destinationFilter:a=>a.doesntHave(e.TownOrCity)});t.length>0&&t[0].destination.has(e.Explorer)&&await t[0].destination.fear(1)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <beasts> adjacent to a land without <town>/<city>.`})),{selectOrder:!0})}]},bl]},El={name:"A Thousand Small Struggles",tokenEvent:!0,effects:[{textArea:[.825,.934],text:"On Each Board with 4 or more <town>/<city> and 4 or fewer <dahan>: Add 1 <blight> to a land without <dahan>.",[r.Now]:({$:e})=>e.inBoardsWhere((a=>a.numberOf(e.TownOrCity)>=4&&a.numberOf(e.Dahan)<=4)).selectOrder().forEach((a=>e.doTokenEventAction((()=>a.inLandsWithout(e.Dahan).pickOne((async e=>{await e.addBlight(1)}),{highlightBoards:[a]})),{board:a})),{noOptions:"No board with 4 or more <town>/<city> and 4 or fewer <dahan>."})}]},Pl={set:s.JaggedEarth,name:"Life's Balance Tilts",events:[{name:"Life's Balance Tilts",fullText:["&nbsp;&nbsp;The energies of life shift towards destruction, bringing wasting and disease to the animals of the island. Death is a part of life, but does this go too far? You may:","Let Destruction Have its Day","&nbsp;&nbsp;<bullet> On Each Board: Remove 1 <beasts>. Add 1 <disease>.","&nbsp;&nbsp;<bullet> For Each Board: Discard the top Minor Power. If it is <fast>, add 1 <blight>.","&nbsp;&nbsp;<bullet> Invaders and <dahan> have -1 Health (min. 1) this turn.","Fortify the Resilience of Life","&nbsp;&nbsp;Cost: 4 Energy per player, aided by <animal>.","&nbsp;&nbsp;<bullet> On Each Board: Add 1 <beasts>. Remove 1 <disease>.","&nbsp;&nbsp;<bullet> For Each Board: Discard the top Minor Power. If it is <slow>, Remove 1 <blight>.","&nbsp;&nbsp;<bullet> Invaders and <dahan> have +1 Health this turn."],effects:[{textArea:[.273,.709],text:"The energies of life shift towards destruction, bringing wasting and disease to the animals of the island. Death is a part of life, but does this go too far? You may:<br><br>Let Destruction Have its Day<or>Fortify the Resilience of Life",[r.Now]:async({$:e})=>{await e.chooseBetween({effects:[{actionId:"LetDestructionHaveItsDay",label:"Let Destruction Have its Day",effects:[{textArea:[.311,.351],text:"On Each Board: Remove 1 <beasts>. Add 1 <disease>.",[r.Now]:()=>e.doMainEventActionOnEachBoard((async a=>{await e.countPieceOnlyIfHavingPiece(p.Beasts,(()=>a.forPiecesThatIs(e.Beasts))).pickOne((async e=>{await e.remove()}),{highlightBoards:[a],text:"Remove 1 <beasts>.",noOptions:`On board ${a.name}: No lands with <beasts>.`}),await a.inLands().pickOne((async a=>{await a.add(1,e.Disease)}),{highlightBoards:[a],text:"Add 1 <disease>."})}))},{textArea:[.348,.419],text:"For Each Board: Discard the top Minor Power. If it is <fast>, add 1 <blight>.",[r.Now]:async()=>{await e.clickToContinue(),await e.doMainEventActionOnEachBoard((async a=>{const t=await e.drawAndDiscardPower(o.Minor);void 0!==t&&bd[t].speed===d.Fast?await e.addSubEffect({card:t,textArea:void 0,text:"If it is <fast>, add 1 <blight>.",[r.Now]:()=>a.inLocationsWhere((e=>e.isLandForBlight)).pickOne((async e=>{await e.addBlight(1)}),{highlightBoards:[a]})}):await e.clickToContinue({text:"Discarded Power was <slow>. Nothing happens.",card:t,textArea:void 0,highlightBoards:[a]})}))}},{textArea:[.414,.454],text:"Invaders and <dahan> have -1 Health (min. 1) this turn.",[r.Now]:async()=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.LetDestructionHaveItsDay,[r.GlobalReminder]:()=>({icon:"-1 HP"}),[r.AdjustHealth]:({piece:a})=>a.isOneOf(e.Invader,e.Dahan)?-1:0}),await e.globalHealthCheck()}}]},{actionId:"FortifyTheResilienceOfLife",label:"Fortify the Resilience of Life",condition:()=>e.playersCanJointlyPayEnergyAidedBy({energy:4*e.spiritCount,element:i.Animal}),effects:[{textArea:[.525,.565],text:"Cost: 4 Energy per player, aided by <animal>.",[r.Now]:async()=>{await e.payEnergyJointlyAidedBy({energy:4*e.spiritCount,element:i.Animal})}},{textArea:[.558,.598],text:"On Each Board: Add 1 <beasts>. Remove 1 <disease>.",[r.Now]:()=>e.doMainEventActionOnEachBoard((async a=>{await a.inLands().pickOne((async a=>{await a.add(1,e.Beasts)}),{text:"Add 1 <beasts>.",highlightBoards:[a]}),await a.forPiecesThatIs(e.Disease).pickOne((async e=>{await e.remove()}),{text:"Remove 1 <disease>.",highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <disease>.`})}))},{textArea:[.59,.661],text:"For Each Board: Discard the top Minor Power. If it is <slow>, Remove 1 <blight>.",[r.Now]:async()=>{await e.clickToContinue(),await e.doMainEventActionOnEachBoard((async a=>{const t=await e.drawAndDiscardPower(o.Minor);void 0!==t&&bd[t].speed===d.Slow?await e.addSubEffect({card:t,text:"If it is <slow>, Remove 1 <blight>.",textArea:void 0,[r.Now]:()=>a.forPiecesThatIs(e.Blight).pickOne((async e=>{await e.location.removeBlight()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <blight>.`})}):await e.clickToContinue({text:"Discarded Power was <fast>. Nothing happens.",card:t,textArea:void 0,highlightBoards:[a]})}))}},{textArea:[.66,.7],text:"Invaders and <dahan> have +1 Health this turn.",[r.Now]:async()=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.FortifyTheResilienceOfLife,[r.GlobalReminder]:()=>({icon:"+1 HP"}),[r.AdjustHealth]:({piece:a})=>a.isOneOf(e.Invader,e.Dahan)?1:0})}}]}]})}}]},El]},Sl={set:s.JaggedEarth,name:"Mapmakers Chart The Wild",events:[{name:"Mapmakers Chart The Wild",stages:[1,2],effects:[{textArea:[.107,.147],text:"Ignore <wilds> during the Explore Step.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.MapmakersChartTheWild,[r.GlobalReminder]:()=>({icon:"Ignore<br><wilds>"}),[r.IgnoreWildsDuringExplore]:()=>!0})}},{textArea:[.141,.216],text:"On Each Board without <wilds>: Explore Actions add +1 <explorer> (in each land successfully Explored).",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.inBoardsWhere((a=>0===a.numberOf(e.Wilds))).forEach((async a=>{await e.addSubEffectUntilEndOfTurn({text:`On board ${a.name}: Explore Actions add +1 <explorer> (in each land successfully Explored).`,[r.GlobalReminder]:()=>({icon:`${a.name}<br>+1 <explorer>`}),[r.AfterSuccessfulExplore]:async({land:t})=>{t.boards().has(a)&&await t.add(1,e.Explorer)}})}))}}]},{name:"Increasing Aggression",stages:[3],effects:[{textArea:[.367,.442],text:"Invaders do +1 Damage (per land) when Ravaging.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.IncreasingAggression,[r.GlobalReminder]:()=>({icon:"+1 <damage>"}),[r.AdjustCollectiveInvaderRavageDamage]:()=>1})}}]},Al(!1),{name:"Coming of Age",dahanEvent:!0,effects:[{textArea:[.819,.9],text:"On Each Board: Add 1 <dahan> to a land with <dahan> and no <badlands>/<beasts>/<disease>/<wilds>.",[r.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((async a=>{e.dontCountAs(p.Badlands),e.dontCountAs(p.Beasts),await a.inLandsWith(e.Dahan).where((a=>!a.hasOneOf(e.Badlands,e.Beasts,e.Disease,e.Wilds))).pickOne((async a=>{await a.add(1,e.Dahan)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <dahan> and no <badlands>/<beasts>/<disease>/<wilds>.`})}))}]}]},Ol={set:s.JaggedEarth,name:"No Bravery Without Numbers",events:[{name:"No Bravery Without Numbers",stages:[1,2],effects:[{textArea:[.107,.216],text:"Invaders do not Ravage in lands unless there are more Invaders than the current Terror Level.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.NoBraveryWithoutNumbers,[r.GlobalReminder]:()=>({icon:"Skip<br>Ravage"}),[r.PreventInvaderActionInLand]:({land:a,invaderAction:t})=>Promise.resolve(a.participatingInvaders().count<=e.terrorLevel&&t===K.Ravage)})}}]},{name:"Courage of the Crowd",stages:[3],effects:[{textArea:[.368,.476],text:"Invaders do not Ravage in lands unless there are more Invaders than the current Terror Level.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.CourageOfTheCrowd,[r.GlobalReminder]:()=>({icon:"Skip<br>Ravage"}),[r.PreventInvaderActionInLand]:({land:a,invaderAction:t})=>Promise.resolve(a.participatingInvaders().count<=e.terrorLevel&&t===K.Ravage)})}},{textArea:[.502,.542],text:"Ravage actions do +2 Damage (per land).",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.CourageOfTheCrowd,[r.GlobalReminder]:()=>({icon:"+2 <damage>"}),[r.AdjustCollectiveInvaderRavageDamage]:()=>2})}}]},Al(!1),{name:"Leave the Hostile Land",dahanEvent:!0,effects:[{textArea:[.807,.914],text:"In each land, Push 1 <dahan> per <badlands>/<disease> to lands without <badlands>/<disease>.",[r.Now]:({$:e})=>e.inLands().where((a=>a.hasAllOf(e.Dahan,e.BadlandsOrDisease))).selectOrder().forEach((a=>e.doDahanEventAction((async()=>{await a.possiblyDontCountPiecesAs(p.Badlands),await a.push({amount:a.numberOf(e.BadlandsOrDisease),pieces:e.Dahan,destinationFilter:a=>a.doesntHave(e.BadlandsOrDisease)})}),{land:a})),{noOptions:"No lands with <dahan> and <badlands>/<disease>."})}]}]},Cl={name:"Plagues Bring Fear and Death",tokenEvent:!0,effects:[{textArea:[.667,.707],text:"1 <fear> per board with <disease>.",[r.Now]:async({$:e})=>{const a=e.inBoardsWith(e.Disease);await e.clickToContinue({highlightBoards:a.items,noOptions:`${a.count} board${a.count>1?"s":""} = ${a.count} <fear>.`}),await e.doTokenEventAction((async()=>{await e.fear(a.count)}))}},{textArea:[.699,.739],text:"On Each Board: 2 Damage to <dahan> in a land with <disease>.",[r.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((a=>a.inLandsWithAllOf(e.Disease,e.Dahan).pickOne((async a=>{await a.damage(2,e.Dahan)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <dahan> and <disease>.`})))}]},Dl={set:s.JaggedEarth,name:"Numinous Crisis",events:[{name:"Numinous Crisis",fullText:["&nbsp;&nbsp;The spiritual energy of the island weakens as life's connections grow ever more tattered. You may:","Draw Strength from it while you can","&nbsp;&nbsp;<bullet> Remove 1 <blight> per player from the Blight Card. Then if the Blight Card has not flipped, keep Removing <blight> until it flips. Gain 3 Energy per <blight> Removed, divided as evenly as possible among all Spirits.","Pour your Strength into the Island","&nbsp;&nbsp;<bullet> Each Spirit either pays 3 Energy, Forgets 2 Power Cards, or return 1 <presence> to their <presence> tracks.","&nbsp;&nbsp;<bullet> Add 1 <blight> per Spirit to the Blight Card (from the box)."],effects:[{textArea:[.193,.601],text:"The spiritual energy of the island weakens as life's connections grow ever more tattered. You may:<br><br>Draw Strength from it while you can<or>Pour your Strength into the Island",[r.Now]:async({$:e})=>{await e.chooseBetween({effects:[{actionId:"DrawStrength",label:"Draw Strength from it while you can",textArea:[.229,.404],text:"Remove 1 <blight> per player from the Blight Card. Then if the Blight Card has not flipped, keep Removing <blight> until it flips. Gain 3 Energy per <blight> Removed, divided as evenly as possible among all Spirits.",[r.Now]:async()=>{await e.clickToContinue(),await e.doMainEventAction((async()=>{let a=e.spiritCount;for(await e.removeBlightFromBlightCard(a);void 0===e.blightCardActive;)await e.removeBlightFromBlightCard(1),a+=1;await e.clickToContinue({textArea:[.299,.404],text:"Gain 3 Energy per <blight> Removed, divided as evenly as possible among all Spirits.",noOptions:`Removed ${a} <blight> = ${3*a} energy.`}),await e.gainEnergyDividedEvenly(3*a)}))}},{actionId:"PourYourStrength",label:"Pour your Strength into the Island",effects:[{textArea:[.457,.529],text:"Each Spirit either pays 3 Energy, Forgets 2 Power Cards, or return 1 <presence> to their <presence> tracks.",[r.Now]:()=>e.eachSpirit((a=>e.doMainEventAction((()=>e.chooseBetween({effects:[{actionId:"PayEnergy",textArea:[.457,.497],text:"Pay 3 Energy.",condition:()=>a.energy>=3,[r.Now]:async()=>{await a.payEnergy(3)}},{actionId:"ForgetPowerCards",textArea:[.457,.528],text:"Forget 2 Power Cards.",condition:()=>a.nonBlessedPowerCards.length>=2,[r.Now]:async()=>{await a.forgetPowers({amount:2})}},{actionId:"ReturnPresence",textArea:[.492,.532],text:"Return 1 <presence> to the <presence> tracks.",[r.Now]:async()=>{await a.destroyPresence(1,A.Silent),await a.returnPresenceToTracks(1)}}]})))))},{textArea:[.523,.598],text:"Add 1 <blight> per Spirit to the Blight Card (from the box).",[r.Now]:async()=>{await e.clickToContinue({noOptions:`${e.spiritCount} Spirit${e.spiritCount>1?"s":""} = ${e.spiritCount} <blight>.`}),await e.doMainEventAction((async()=>{await e.addBlightToBlightCard(e.spiritCount)}))}}]}]})}}]},Cl,ll]},Bl={set:s.JaggedEarth,name:"Overconfidence",events:[{name:"Overconfidence",terrorLevels:[1],effects:[{textArea:[.107,.317],text:"If you have any Earned Fear Cards, discard 2 of them now (so you don't get their text benefits).<br><br>Otherwise, move 2 Earned <fear> Markers per player to the top of the Fear pool.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.doMainEventAction((async()=>{e.fearCardsEarnedCount>0?await e.discardEarnedFearCards(2):await e.loseFear(2)}))}}]},{name:"Terror Breeds Aggression",terrorLevels:[2,3],effects:[{textArea:[.383,.495],text:"For every 2 Fear Cards currently in the Earned Fear Cards pile, Invaders do +1 Damage (per land) when Ravaging.",[r.Now]:async({$:e})=>{await e.clickToContinue();const a=Math.floor(e.fearCardsEarnedCount/2);a>0&&await e.addSubEffectUntilEndOfTurn({effectId:pe.TerrorBreedsAggression,[r.GlobalReminder]:()=>({icon:`+${a} <damage>`}),[r.AdjustCollectiveInvaderRavageDamage]:()=>a})}}]},{name:"Beasts Multiply",tokenEvent:!0,effects:[{textArea:[.63,.742],text:"On Each Board: Add 1 <beasts> to a land adjacent to <beasts>, then Destroy 1 <dahan> in a land with <beasts>.",[r.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((async a=>{await(await e.countPieceOptionally(p.Beasts,(()=>a.inLandsWhere((a=>a.hasAdjacentLandWithPiece(e.Beasts)))))).pickOne((async a=>{await a.add(1,e.Beasts)}),{textArea:[.664,.704],text:"Add 1 <beasts> to a land adjacent to <beasts>",highlightBoards:[a],noOptions:`On board ${a.name}: No land adjacent to <beasts>.`}),await a.forPiecesThatIs(e.Dahan,(a=>a.has(e.Beasts))).pickOne((async e=>{await e.destroy()}),{textArea:[.664,.738],text:"Destroy 1 <dahan> in a land with <beasts>.",highlightBoards:[a],noOptions:`On board ${a.name}: No land with <dahan> and <beasts>.`})}),{selectOrder:!0})}]},ol]},kl={set:s.JaggedEarth,name:"Provincial Seat",events:[{name:"Provincial Seat",blightStatus:Td.HealthyIsland,effects:[{textArea:[.107,.179],text:"On Each Board: Choose a land with <city>. Build there.",[r.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>a.inLandsWith(e.City).pickOne((async e=>{await e.doExtraBuild()}))))}]},{name:"Lands Hollow of Promise",blightStatus:Td.BlightedIsland,effects:[{textArea:[.373,.579],text:"On Each Board: Add 1 <blight> to a land without <presence>.<br><br>Spirits may prevent this on any/all boards by Destroying 2 <presence> from each board to be protected.",[r.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>e.chooseBetween({highlightBoards:[a],prompt:`On board ${a.name}, choose between:`,effects:[{actionId:"AddBlight",textArea:[.37,.443],text:"Add 1 <blight> to a land without <presence>.",prompt:"Pick land to add <blight>.",[r.Now]:()=>a.inLocationsWhere((a=>a.isLandForBlight&&a.doesntHaveIgnoringCountAs(e.Presence))).pickOne((async e=>{await e.addBlight(1)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands without <presence>.`})},{actionId:"PreventByDestroyingPresence",textArea:[.472,.577],text:"Prevent this by destroying 2 <presence>.",[r.Now]:()=>a.destroyPresence(2),condition:()=>a.numberOf(e.Presence)>=2}]})))}]},cl,{name:"Rally to the Defense of Distant Kin",dahanEvent:!0,effects:[{textArea:[.837,.914],text:"On Each Board: Gather 1 <dahan> into a land with <dahan>. In that land, Defend 1 per <dahan>.",[r.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((a=>a.inLandsWith(e.Dahan).pickOne((async a=>{await a.gatherOne(e.Dahan),await a.defend(a.numberOf(e.Dahan))}))),{selectOrder:!0})}]}]},Ll={set:s.JaggedEarth,name:"Pull Together In Adversity",events:[{name:"Pull Together In Adversity",terrorLevels:[1,2],effects:[{textArea:[.105,.176],text:"For the rest of this turn, ignore 1 <strife> on each Invader. (This includes not removing that <strife>.)",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.PullTogetherInAdversity,[r.GlobalReminder]:()=>({icon:"Ignore<br><strife>"}),[r.IgnoreOneStrife]:()=>!0})}}]},{name:"Purge the Land with Salt and Fire",terrorLevels:[3],effects:[{textArea:[.368,.476],text:"On Each Board in a land with 2 or more <town>:<br>Add 1 <blight> without cascading. Add 2 <badlands>. Remove all <town>.",[r.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>a.inLandsWhere((a=>a.hasAtLeast(2,e.Town))).pickOne((async a=>{await a.addBlight(1,{mayCascade:!1}),await a.add(2,e.Badlands),await a.remove({quantifier:w.All,pieces:e.Town})}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with 2 or more <town>.`})),{selectOrder:!0})}]},fl,ll]},Fl={set:s.JaggedEarth,name:"Relentless Optimism",events:[{name:"Relentless Optimism",terrorLevels:[1],effects:[{textArea:[.107,.183],text:"For the rest of this turn, don't generate <fear> for Destroying <town>/<city>.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.RelentlessOptimism,[r.GlobalReminder]:()=>({icon:"No <fear><br><town>/<city>"}),[r.PreventFearGeneration]:({fromDestroyingBuildings:e})=>Promise.resolve(e)})}}]},{name:"Cultures Mix and Clash",terrorLevels:[2,3],effects:[{textArea:[.406,.584],text:"On Each Board: If <dahan> outnumber <town>/<city> by 2 or more, Replace 1 <town> with 1 <dahan>.<br><br>If <town>/<city> outnumber <dahan> by 2 or more, Replace 1 <dahan> with 1 <town>.",[r.Now]:({$:e})=>e.doMainEventActionOnEachBoard((async a=>{a.numberOf(e.Dahan)>=a.numberOf(e.TownOrCity)+2?await a.forPiecesThatIs(e.Town).pickOne((async e=>{await e.replace([p.Dahan])}),{textArea:[.407,.48],text:"If <dahan> outnumber <town>/<city> by 2 or more, Replace 1 <town> with 1 <dahan>.",highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <town>.`}):a.numberOf(e.TownOrCity)>=a.numberOf(e.Dahan)+2?await a.forPiecesThatIs(e.Dahan).pickOne((async e=>{await e.replace([p.Town])}),{textArea:[.508,.582],text:"If <town>/<city> outnumber <dahan> by 2 or more, Replace 1 <dahan> with 1 <town>.",highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <dahan>.`}):await e.clickToContinue({noOptions:`On board ${a.name}: Neither applies.`})}))}]},{name:"Foreign Diseases",tokenEvent:!0,effects:[{textArea:[.637,.742],text:"On Each Board, in the land with the most combined Invaders + <dahan> (min. 1 of each): Add 1 <disease>. 2 Damage to <dahan>.",[r.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((a=>a.inLandsWithAllOf(e.Invader,e.Dahan).withMost((a=>a.numberOf(e.InvaderOrDahan))).pickOne((async a=>{await a.add(1,e.Disease),await a.damage(2,e.Dahan)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with Invaders and <dahan>.`})))}]},Wc]},Rl={set:s.JaggedEarth,name:"Remnants Of A Spirits Heart",events:[{name:"Remnants Of A Spirits Heart",fullText:["&nbsp;&nbsp;A group of Dahan find a stony ridge with lingering blessings from an ancient mountain-Spirit. You may:","Leave its Strength with the Dahan","&nbsp;&nbsp;<bullet> <dahan> have +10 Health this turn.","&nbsp;&nbsp;<bullet> In lands with <dahan>, Invaders have +1 Health this turn.","With Patient Focus Craft a Great Warding","&nbsp;&nbsp;Cost: 4 Energy per player, aided by <earth>.","&nbsp;&nbsp;<bullet> Defend from Spirits is 4 lower per land this turn (min.0).","&nbsp;&nbsp;<bullet> During one future Spirit Phase, players may jointly decide to grant Defend 4 to all lands that turn. (There is a Reminder Card for this.)"],effects:[{textArea:[.207,.592],text:"A group of Dahan find a stony ridge with lingering blessings from an ancient mountain-Spirit. You may:<br><br>Leave its Strength with the Dahan<or>With Patient Focus Craft a Great Warding",[r.Now]:async({$:e})=>{await e.doMainEventAction((async()=>{await e.chooseBetween({effects:[{actionId:"LeaveItsStrength",label:"Leave its Strength with the Dahan",effects:[{textArea:[.242,.282],text:"<dahan> have +10 Health this turn.",[r.Now]:async()=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.LeaveItsStrength,[r.GlobalReminder]:()=>({icon:"<dahan><br>+10 HP"}),[r.AdjustHealth]:({piece:a})=>a.isA(e.Dahan)?10:0})}},{textArea:[.276,.316],text:"In lands with <dahan>, Invaders have +1 Health this turn.",[r.Now]:async()=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.LeaveItsStrength,[r.GlobalReminder]:()=>({icon:"Invaders<br>+1 HP"}),[r.AdjustHealth]:({piece:a})=>a.isInvader&&a.location?.has(e.Dahan)?1:0,[r.AfterRemovePiece]:async({piece:a,location:t})=>{a.isA(e.Dahan)&&await t.healthCheck()}})}}]},{actionId:"CraftAGreatWarding",label:"With Patient Focus Craft a Great Warding",condition:()=>e.playersCanJointlyPayEnergyAidedBy({energy:4*e.spiritCount,element:i.Earth}),effects:[{textArea:[.377,.417],text:"Cost: 4 Energy per player, aided by <earth>.",[r.Now]:async()=>{await e.payEnergyJointlyAidedBy({energy:4*e.spiritCount,element:i.Earth})}},{textArea:[.414,.483],text:"Defend from Spirits is 4 lower per land this turn (min.0).",[r.Now]:async()=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.CraftAGreatWardingUntilEndOfTurn,[r.GlobalReminder]:()=>({icon:"Defend<br>4 lower"}),[r.DefendFromSpirits]:()=>-4})}},{textArea:[.479,.585],text:"During one future Spirit Phase, players may jointly decide to grant Defend 4 to all lands that turn. (There is a Reminder Card for this.)",[r.Now]:async()=>{await e.clickToContinue(),await e.addSubEffect({effectId:pe.CraftAGreatWardingOngoing,[r.GlobalReminder]:()=>({icon:"Defend<br>4 to All",ongoing:!0}),[r.ExtraAction]:({effect:a})=>({actionId:"GreatWarding",[r.Now]:async()=>{await e.addSubEffectUntilEndOfTurn({text:"Defend 4 to all lands.",[r.DefendFromGame]:()=>4}),e.removeEffect(a)}})})}}]}]})}))}}]},{name:"Hunting Parties",tokenEvent:!0,effects:[{textArea:[.653,.73],text:"For each land with <beasts> and <city>: 1 <fear> and Destroy 1 <beasts> there.",[r.Now]:({$:e})=>e.inLandsWithAllOf(e.Beasts,e.City).selectOrder().forEach((a=>e.doTokenEventAction((async()=>{await a.possiblyDontCountPiecesAs(p.Beasts),a.has(e.Beasts)&&(await a.fear(1),await a.destroyOne(e.Beasts,{autoPlay:!0}))}),{land:a})),{noOptions:"No lands with <beasts> and <city>."})}]},El]},Nl={name:"Offerings of Story and Season",dahanEvent:!0,effects:[{textArea:[.804,.913],text:"Each Spirit with at least 3 <dahan> among its lands gains 1 Energy and may Reclaim 1 Card.",[r.Now]:({$:e})=>e.spiritsWhich((a=>a.numberOfPiecesInLands(e.Dahan)>=3)).forEach((a=>e.doDahanEventAction((async()=>{await a.gainEnergy(1),await a.reclaim(1)}))),{noOptions:"No Spirits with at least 3 <dahan> among all its lands."})}]},$l={set:s.JaggedEarth,name:"Resourceful Populace",events:[{name:"Resourceful Populace",terrorLevels:[1],effects:[{textArea:[.107,.285],text:"For the rest of this turn, after an Action Destroys 1 or more <town>/<city>, add 1 <town> to an adjacent land. (If there are no adjacent lands - e.g., due to Isolate - don't add anything.)",[r.Now]:async({$:e,effect:a,...t})=>{await e.clickToContinue();const n={triggerId:e.nextTriggerId(),[r.Now]:({action:a})=>e.doMainEventAction((()=>e.inLandsWhere((e=>e.hasAdjacentLocationWhere((e=>a.parentData.resourcefulPopulaceLocations.includes(e))))).pickOne((async a=>{await a.add(1,e.Town)}),{noOptions:"No adjacent lands."})))};await e.addSubEffectUntilEndOfTurn({effectId:pe.ResourcefulPopulace,[r.GlobalReminder]:()=>({icon:"+1 <town>"}),[r.AfterRemovePiece]:async({piece:r,location:i,removement:s})=>{r.isA(e.TownOrCity)&&x[s].isDestroyLike&&e.action.type!==en.GameAction&&!i.isIsolated&&(void 0===e.action.data.resourcefulPopulaceLocations&&(e.action.data.resourcefulPopulaceLocations=[]),e.action.data.resourcefulPopulaceLocations.push(i),await e.addTrigger(n,a,t.action))}})}}]},{name:"Strip the Land Bare",terrorLevels:[2,3],effects:[{textArea:[.373,.413],text:"<town> each do +1 Damage when Ravaging.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.StripTheLandBare,[r.GlobalReminder]:()=>({icon:"<town><br>+1 <damage>"}),[r.AdjustIndividualInvaderRavageDamage]:({piece:a})=>a.isA(e.Town)?1:0})}},{textArea:[.408,.482],text:"After a Ravage Action adds <blight>, Remove 1 <explorer> and 1 <town> from the Ravaged land.",[r.Now]:async({$:e,...a})=>{await e.clickToContinue();const t={triggerId:e.nextTriggerId(),[r.Now]:async({action:a})=>{const t=a.parentData.damagedLand;await t.remove({amount:1,pieces:e.Explorer}),await t.remove({amount:1,pieces:e.Town})}};await e.addSubEffectUntilEndOfTurn({effectId:pe.StripTheLandBare,[r.GlobalReminder]:()=>({icon:"<blight><br>-<explorer><town>"}),[r.AfterRavagingDamageLand]:async({blightedLands:n,land:r})=>{n.length>0&&(e.action.data.damagedLand=r,await e.addTrigger(t,a.effect,a.action))}})}}]},{name:"Virulence among Close-Packed Homes",tokenEvent:!0,effects:[{textArea:[.664,.74],text:"On Each Board: Add <disease> to the Inland land with the most <town>/<city> (min. 1).",[r.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((a=>a.inInlandLands().where((a=>a.has(e.TownOrCity))).withMost((a=>a.numberOf(e.TownOrCity))).pickOne((async a=>{await a.add(1,e.Disease)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No Inland land with <town>/<city>.`})))}]},Nl]},Wl={set:s.JaggedEarth,name:"Seek New Farmland",events:[{name:"Seek New Farmland",blightStatus:Td.HealthyIsland,effects:[{textArea:[.107,.181],text:"In each land with 2 or more <town>, Push 1 <town> to a land without <town>.",[r.Now]:({$:e})=>e.inLandsWhere((a=>a.hasAtLeast(2,e.Town))).selectOrder().forEach((a=>e.doMainEventAction((async()=>{await a.push({amount:1,pieces:e.Town,destinationFilter:a=>a.doesntHave(e.Town)})}),{land:a})),{noOptions:"No lands with 2 or more <town>."})}]},{name:"Voracious Consumption",blightStatus:Td.BlightedIsland,effects:[{textArea:[.373,.582],text:"On Each Board: After the Ravage Step, add 1 <blight> to a land with <city> and no <blight>.<br><br>Spirits may prevent this on any/all boards by Destroying 2 <presence> from each board to be protected.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.VoraciousConsumption,[r.GlobalReminder]:()=>({icon:"+1 <blight>"}),[r.AfterTheNormalRavageStep]:()=>e.doMainEventActionOnEachBoard((async a=>{await e.chooseBetween({prompt:`On board ${a.name}, choose between:`,highlightBoards:[a],effects:[{actionId:"AddBlight",textArea:[.373,.447],text:"Add 1 <blight> to a land with <city> and no <blight>.",prompt:"Pick a land to add <blight>.",[r.Now]:()=>a.inLandsWith(e.City).where((a=>a.doesntHave(e.Blight))).pickOne((async e=>{await e.addBlight(1)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <city> and no <blight>.`})},{actionId:"PreventByDestroyingPresence",textArea:[.476,.585],text:"Prevent <blight> by destroying 2 <presence>.",[r.Now]:()=>a.destroyPresence(2),condition:()=>a.numberOf(e.Presence)>=2}]})}),{selectOrder:!0})})}}]},Cl,{name:"Engage on their own Terms",dahanEvent:!0,effects:[{textArea:[.805,.913],text:"During Ravage, <dahan> only do 1 Damage each, but deal Damage before Invaders.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.EngageOnTheirOwnTerms,[r.GlobalReminder]:()=>({icon:"<dahan><br>1 <damage>"}),[r.DahanFightBeforeInvaders]:async({land:a})=>{a.has(e.Dahan)&&await e.clickToContinue(),await a.piecesThatAre(e.Dahan).forEach((async e=>{await e.setFightsBeforeInvaders(!0)}))},[r.AdjustDamageDuringRavage]:({piece:a})=>a.isA(e.Dahan)?-1:0})}}]}]},Ml={set:s.JaggedEarth,name:"Smaller Ports Spring Up",events:[{name:"Smaller Ports Spring Up",stages:[1,2],effects:[{textArea:[.105,.187],text:"On Each Board with exactly 1 Coastal <city>: Add 1 <town> to a Coastal land without <city>.",[r.Now]:({$:e})=>e.inBoardsWhere((a=>a.inCoastalLands().hasExactlyOneWhere(1,(a=>a.has(e.City)))&&1===a.inCoastalLands().firstOneWhere((a=>a.has(e.City))).numberOf(e.City))).forEach((a=>e.doMainEventAction((()=>a.inCoastalLands().where((a=>a.doesntHave(e.City))).pickOne((async a=>{await a.add(1,e.Town)}))),{board:a})),{noOptions:"No boards with exactly 1 Coastal <city>."})}]},{name:"Extensive Building",stages:[3],effects:[{textArea:[.371,.452],text:"On Each Board: Build in a land with Invaders not matching a Build Card.",[r.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>a.inLandsWith(e.Invader).where((a=>!a.matchesInvaderCards(e.invaderCardsInVisibleSlot(ps.Build),K.Build))).pickOne((async e=>{await e.doExtraBuild()}),{noOptions:`On board ${a.name}: No lands with Invaders not matching a Build Card.`})))}]},Jc,{name:"Settlers Encroach too far",dahanEvent:!0,effects:[{textArea:[.841,.914],text:"On Each Board: Choose a land with <town> and <dahan>. Push 1 <town> per 2 <dahan> there.",[r.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((a=>a.inLandsWithAllOf(e.Town,e.Dahan).pickOne((async a=>{await a.push({amount:Math.floor(a.numberOf(e.Dahan)/2),pieces:e.Town})}),{highlightBoards:[a],noOptions:`On board ${a.name}: No land with <town> and <dahan>.`})),{selectOrder:!0})}]}]},Gl={set:s.JaggedEarth,name:"Sprawl Contained By The Wilds",events:[{name:"Sprawl Contained By The Wilds",blightStatus:Td.HealthyIsland,effects:[{textArea:[.107,.21],text:"On Each Board: Add 1 <wilds> to a land without Invaders. Build in the land with the most <town>/<city> (min. 1).",[r.Now]:({$:e})=>e.doMainEventActionOnEachBoard((async a=>{await e.addSubEffect({effects:[{textArea:[.107,.176],text:"Add 1 <wilds> to a land without Invaders.",[r.Now]:()=>a.inLandsWithout(e.Invader).pickOne((async a=>{await a.add(1,e.Wilds)}))},{textArea:[.138,.21],text:"Build in the land with the most <town>/<city> (min. 1).",[r.Now]:()=>a.inLandsWithMostMinimumOne(e.TownOrCity).pickOne((async e=>{await e.doExtraBuild()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <town>/<city>.`})}]})}))}]},{name:"Dissolution Threatens",blightStatus:Td.BlightedIsland,effects:[{textArea:[.383,.604],text:"Each Spirit chooses:<br>Accept this Fragmentation<or>Focus your will towards Wholeness",[r.Now]:({$:e})=>e.eachSpirit((a=>e.doMainEventAction((()=>e.chooseBetween({effects:[{actionId:"AcceptThisFragmentation",label:"Accept this Fragmentation",textArea:[.423,.463],text:"Destroy 2 <presence>, adding 1 <wilds> in place of each.",[r.Now]:async()=>{const t=await a.destroyPresence(2);for(const{location:a}of t)await a.add(1,e.Wilds)}},{actionId:"FocusYourWill",label:"Focus your will towards Wholeness",effects:[{textArea:[.499,.539],text:"Add 1 of your Destroyed <presence> to one of your lands.",[r.Now]:async()=>{await a.addPresence({destroyed:!0})}},{textArea:[.534,.604],text:"Next turn, all your Powers are <slow> and cannot be made <fast>.",[r.Now]:async()=>{await e.clickToContinue();const t=e.turn;await e.addSubEffect({effectId:pe.FocusYourWill,[r.GlobalReminder]:()=>({players:[a],icon:"Powers<br><slow>"}),[r.AdjustPowerSpeedOnPlay]:async({power:n})=>n.owner===a&&e.turn===t+1&&(await n.setStatus(Kn.PlayedSlow),!0),[r.PreventChangeSpeedOfPower]:({power:n})=>n.owner===a&&e.turn===t+1,[r.TimePasses]:()=>(e.turn===t+1&&e.removeThisEffect(),Promise.resolve())})}}]}]})))))}]},fl,{name:"Lay Ambushes",dahanEvent:!0,effects:[{textArea:[.819,.899],text:"During Ravage, <dahan> deal Damage at the same time as Invaders.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.LayAmbushes,[r.GlobalReminder]:()=>({icon:"Ravage<br><dahan>"}),[r.DahanFightSimultaneously]:()=>!0})}}]}]},Hl={set:s.JaggedEarth,name:"Temporary Truce",events:[{name:"Temporary Truce",terrorLevels:[1],effects:[{textArea:[.107,.216],text:"In lands with <dahan>: 1 <dahan> and 1 <town>/<city> do not participate in Ravages. (They neither take nor deal Damage.)",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.TemporaryTruce,[r.GlobalReminder]:()=>({icon:"DNPIR"}),[r.DoesNotParticipateInRavage]:async({location:a})=>{a.has(e.Dahan)&&(await a.pickOnePieceToNotParticipateInRavage(e.Dahan),await a.pickOnePieceToNotParticipateInRavage(e.TownOrCity))}})}}]},{name:"Temporary Caution",terrorLevels:[2,3],effects:[{textArea:[.373,.485],text:"During the Ravage Step, On Each Board: Skip 1 Ravage Action in a land where <dahan> outnumber <town>/<city>.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.TemporaryCaution,[r.GlobalReminder]:()=>({icon:"Skip<br>Ravage"}),[r.BeforeResolvingInvaderCard]:async({invaderAction:a,card:t})=>{a===K.Ravage&&await e.onEachBoard((a=>a.inLandsWhere((a=>a.participatingDahan().count>a.participatingInvaders().where((a=>a.isA(e.TownOrCity))).count)).pickOne((async a=>{await e.addEffectUntilEndOfTurn({[r.PreventInvaderActionInLand]:e=>Promise.resolve(e.land===a&&e.invaderAction===K.Ravage&&e.card===t)})}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands where <dahan> outnumber <town>/<city>.`})))}})}}]},Al(!1),{name:"Speak of the Spirits' Anger",dahanEvent:!0,effects:[{textArea:[.809,.921],text:"For each board, 1 <fear> if any <dahan> are in lands with <town>/<city>.",[r.Now]:async({$:e})=>{const a=a=>a.hasOneLandWhere((a=>a.hasAllOf(e.Dahan,e.TownOrCity))),t=e.inBoardsWhere(a).count;await e.clickToContinue({noOptions:`${t} board${1!==t?"s":""} = ${t} <fear>.`}),await e.doDahanEventActionOnEachBoard((async t=>{a(t)&&await e.fear(1)}))}}]}]},Ul={set:s.JaggedEarth,name:"The Frontier Calls",events:[{name:"The Frontier Calls",blightStatus:Td.HealthyIsland,effects:[{textArea:[.107,.181],text:"Explore Actions add +1 <explorer> to lands without <town>/<city>.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.TheFrontierCalls,[r.GlobalReminder]:()=>({icon:"+1 <explorer>"}),[r.BeforeSuccessfulExplore]:({land:a})=>(a.has(e.TownOrCity)||(e.action.data.hadNoBuilding=!0),Promise.resolve()),[r.AfterSuccessfulExplore]:async({land:a})=>{e.action.data.hadNoBuilding&&(await e.sendEvent({type:T.GenericMain,text:"Invaders successfully Explored into a land which had no <town>/<city>."}),await a.add(1,e.Explorer))}})}}]},{name:"Self-Sacrifice Buys Time",blightStatus:Td.BlightedIsland,effects:[{textArea:[.374,.414],text:"Destroy 1 <presence> from each Spirit.",[r.Now]:({$:e})=>e.eachSpirit((a=>e.doMainEventAction((async()=>{await a.destroyPresence(1)}))))},{textArea:[.44,.582],text:"The next X <blight> added to the island this turn come from the box instead of the Blight Card where X is the number of Spirits.",[r.Now]:async({$:e})=>{const a=C.sH.box(0);await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.SelfSacrificeBuysTime,[r.GlobalReminder]:()=>({icon:`<blight><br>${a.get()} / ${e.spiritCount}`}),[r.PreventRemoveBlightFromBlightCard]:async({location:t})=>void 0!==t&&a.get()<e.spiritCount&&(a.set(a.get()+1),await e.sendEvent({type:T.GenericMain,text:"Self-Sacrifice Buys Time made <blight> come from the box instead of the Blight Card."}),a.get()===e.spiritCount&&e.removeThisEffect(),!0)})}}]},{name:"Lair in Untamed Lands",tokenEvent:!0,effects:[{textArea:[.648,.729],text:"On Each Board: Add 1 <beasts> to a land without <town>/<city>/<blight>.",[r.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((a=>a.inLandsWithNoneOf(e.Town,e.City,e.Blight).pickOne((async a=>{await a.add(1,e.Beasts)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands without <town>/<city>/<blight>.`})))}]},{name:"Seek out new Grounds",dahanEvent:!0,effects:[{textArea:[.804,.911],text:"On Each Board: Gather 1 or 2 <dahan> into a land without <dahan> Setup symbols.",[r.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((a=>a.inLandsWhere((a=>!a.hasSetupSymbols&&a.hasAdjacentLandWithPiece(e.Dahan))).pickOne((async a=>{await a.gather({quantifier:w.UpToMinimumOne,amount:2,pieces:e.Dahan})}))),{selectOrder:!0})}]}]},ql=e=>({name:"Irregular Outbreaks",tokenEvent:!0,effects:[{textArea:e?[.638,.71]:[.637,.714],text:"<disease> doesn't prevent Builds this Invader Phase.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.IrregularOutbreaks,[r.GlobalReminder]:()=>({icon:"Ignore<br><disease>"}),[r.PreventDiseasePreventingBuilds]:()=>Promise.resolve(!0)})}},{textArea:e?[.704,.745]:[.67,.75],text:"1 <fear> per board with <disease>.",[r.Now]:async({$:e})=>{const a=e.inBoardsWith(e.Disease);await e.clickToContinue({highlightBoards:a.items,noOptions:`${a.count} board${a.count>1?"s":""} = ${a.count} <fear>.`}),await e.doTokenEventAction((async()=>{await e.fear(a.count)}))}}]}),jl={set:s.JaggedEarth,name:"The Struggles Of Growth",events:[{name:"The Struggles Of Growth",fullText:["&nbsp;&nbsp;A painful crux-point. Each Spirit chooses:","Trade Reach for Deeper Nature","&nbsp;&nbsp;Destroy 2 of your <presence>. Gain a Power Card.","Leave Behind that which restrains you","&nbsp;&nbsp;Forget a Power Card. Gain 2 Energy. Move up to 2 of your <presence> up to <range-4>."],blightStatus:Td.HealthyIsland,effects:[{textArea:[.151,.34],text:"A painful crux-point. Each Spirit chooses: Trade Reach for Deeper Nature<or>Leave Behind that which Restrains you",[r.Now]:({$:e})=>e.eachSpirit((a=>e.doMainEventAction((()=>e.chooseBetween({effects:[{actionId:"TradeReach",label:"Trade Reach for Deeper Nature",effects:[{textArea:[.184,.224],text:"Destroy 2 of your <presence>.",[r.Now]:async()=>{await a.destroyPresence(2)}},{textArea:[.184,.224],text:"Gain a Power Card.",[r.Now]:async()=>{await a.gainPowerCard()}}]},{actionId:"LeaveBehind",label:"Leave Behind that which restrains you",effects:[{textArea:[.265,.305],text:"Forget a Power Card.",[r.Now]:async()=>{await a.forgetPowers()}},{textArea:[.265,.305],text:"Gain 2 Energy.",[r.Now]:async()=>{await a.gainEnergy(2)}},{textArea:[.265,.337],text:"Move up to 2 of your <presence> up to <range-4>.",[r.Now]:async()=>{await a.presence().pickMultiple({amount:2,optional:!0,forPickedItem:async e=>{await e.move({locations:{target:g.WithinRange,range:4,spirit:a}})},effect:{prompt:"Pick a <presence> to move."}})}}]}]})))))}]},{name:"Blight Deepens",blightStatus:Td.BlightedIsland,effects:[{textArea:[.4,.568],text:"On Each Board: Add 1 <blight> to a land with <blight>, but do not cascade.<br><br>Spirits may prevent this on any/all boards by Destroying 1 <presence> from each board to be protected.",[r.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>e.chooseBetween({effects:[{actionId:"AddBlight",textArea:[.4,.47],text:"Add 1 <blight> to a land with <blight>, but do not cascade.",[r.Now]:()=>a.inLocationsWith(e.Blight).where((e=>e.isLandForBlight)).pickOne((async e=>{await e.addBlight(1,{mayCascade:!1})}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <blight>.`})},{actionId:"PreventByDestroyingPresence",textArea:[.493,.567],text:"Prevent adding <blight> by destroying 2 <presence>.",[r.Now]:()=>a.destroyPresence(2),condition:()=>a.numberOf(e.Presence)>=2}]})),{selectOrder:!0})}]},ql(!1),ll]},Jl={set:s.JaggedEarth,name:"Thriving Trade",events:[{name:"Thriving Trade",blightStatus:Td.HealthyIsland,effects:[{textArea:[.107,.184],text:"On Each Board: Add 1 <city> to a Coastal land with <city>.",[r.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>a.inCoastalLands().where((a=>a.has(e.City))).pickOne((async a=>{await a.add(1,e.City)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No Coastal lands with <city>.`})))}]},{name:"Partitioned Wilderness",blightStatus:Td.BlightedIsland,effects:[{textArea:[.354,.598],text:"On Each Board: If there are 4 or more lands with <town>, add 1 <blight> to a land with or adjacent to <town>.<br><br>Spirits may prevent this on any/all boards by Destroying 3 <presence> from each board to be protected.",[r.Now]:({$:e})=>e.doMainEventActionOnEachBoard((async a=>{a.inLandsWith(e.Town).count>=4?await e.chooseBetween({highlightBoards:[a],effects:[{actionId:"AddBlight",textArea:[.354,.457],text:"Add 1 <blight> to a land with or adjacent to <town>.",[r.Now]:()=>a.inLocationsWithOrAdjacentTo(e.Town).where((e=>e.isLandForBlight)).pickOne((async a=>{await a.add(1,e.Blight)}))},{actionId:"PreventByDestroyingPresence",textArea:[.489,.6],text:"Prevent adding <blight> by destroying 3 <presence>.",[r.Now]:()=>a.destroyPresence(3),condition:()=>a.numberOf(e.Presence)>=3}]}):await e.clickToContinue({noOptions:`On board ${a.name}: There are not 4 or more lands with <town>.`,highlightBoards:[a]})}),{selectOrder:!0})}]},{name:"Pestilence Arrives on Canvas Sails",tokenEvent:!0,effects:[{textArea:[.654,.765],text:"On Each Board: Add 1 <disease> to the Coastal land with the most <town>/<city> (min. 1). In that land, 3 Damage to <dahan>.",[r.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((a=>a.inCoastalLands().where((a=>a.has(e.TownOrCity))).withMost((a=>a.numberOf(e.TownOrCity))).pickOne((async a=>{await a.add(1,e.Disease),await a.damage(3,e.Dahan)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No Coastal land with <town>/<city>.`})))}]},{name:"Clever Cooperation",dahanEvent:!0,effects:[{textArea:[.805,.914],text:"Each Spirit may Push 1 of their <presence> from a land with <dahan>. 2 Damage in the land Pushed to.",[r.Now]:({$:e})=>e.eachSpirit((a=>e.doDahanEventAction((()=>a.presence().where((a=>a.location.has(e.Dahan))).optionallyPickOne((async e=>{const a=await e.push();a.length>0&&await a[0].destination.damage(2)}),{prompt:"Pick 1 of your <presence> to Push.",noOptions:`${a.nameLink} has no lands with <dahan>.`})))))}]}]},Vl=e=>({name:"The World's Vibrance Fades",blightStatus:Td.BlightedIsland,effects:[{textArea:e?[.407,.571]:[.363,.542],text:"Remove 1 <blight> per player from the Blight Card, returning it to the box.<br><br>Each Spirit may prevent 1 <blight> from being Removed by Destroying 2 of their <presence>.",[r.Now]:({$:a})=>a.eachSpirit((t=>a.doMainEventAction((()=>a.chooseBetween({effects:[{actionId:"RemoveBlight",textArea:e?[.407,.479]:[.363,.433],text:"Remove 1 <blight> from the Blight Card.",[r.Now]:async()=>{await a.removeBlightFromBlightCard(1)}},{actionId:"DestroyPresence",textArea:e?[.496,.574]:[.463,.542],text:"Destroy 2 of your <presence>.",[r.Now]:async()=>{await t.destroyPresence(2)}}]})))))}]}),Yl={set:s.JaggedEarth,name:"Wounded Lands Attract Explorers",events:[{name:"Wounded Lands Attract Explorers",blightStatus:Td.HealthyIsland,effects:[{textArea:[.105,.145],text:"On Each Board: Add 1 <explorer> to a land with <blight>.",[r.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>a.inLandsWith(e.Blight).pickOne((async a=>{await a.add(1,e.Explorer)}),{highlightBoards:[a],noOptions:`On board: ${a.name}: No land with <blight>.`})))}]},Vl(!1),cl,{name:"Raiding and Retaliation",dahanEvent:!0,effects:[{textArea:[.789,.934],text:"In each land with <town>/<city>: 1 Damage per <dahan>, then each surviving <town>/<city> deals 1 Damage to <dahan>. (Defend/<strife> apply normally.)",[r.Now]:({$:e})=>e.inLandsWith(e.TownOrCity).where((a=>a.has(e.Dahan))).selectOrder().forEach((a=>e.doDahanEventAction((async()=>{if(await a.damage(a.numberOf(e.Dahan)),a.has(e.Dahan)){const t=a.piecesThatAre(e.TownOrCity).sum((e=>e.strife>0?0:1))-a.defense;await a.piecesThatAre(e.TownOrCity).forEach((async e=>{e.strife>0&&await e.removeStrife()})),await a.damage(t,e.Dahan)}}),{land:a})))}]}]},zl={set:s.NatureIncarnate,name:"Accumulated Devastation",events:[{name:"Accumulated Devastation",blightStatus:Td.HealthyIsland,effects:[{textArea:[.106,.348],text:"On Each Board: During the first successful Ravage Action (in one land) this Invader Phase, increase the total Damage ravaging Invaders deal to each land (but not to <dahan>) by the current Invader Stage. Do this for at most one Ravage Action per board (for one Ravage Action in one land).",[r.Now]:async({$:e})=>{const a=[];await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.AccumulatedDevastation,[r.AlterInvaderActionInLand]:async({land:t,invaderAction:n,normal:i})=>(n===K.Ravage&&i&&!a.includes(t.board)&&(a.push(t.board),await e.addSubEffectUntilEndOfAction({[r.AdjustCollectiveInvaderRavageDamage]:({towardsLand:a})=>a?e.stage:0,[r.ActionEnds]:()=>(e.removeThisEffect(),Promise.resolve())})),!1),[r.GlobalReminder]:()=>({icon:"Extra<br><damage>"})})}}]},Vl(!0),{name:"Territorial Beasts",tokenEvent:!0,effects:[{textArea:[.632,.746],text:"On Each Board: Isolate a land with <beasts>. 1 <fear> if Invaders are present.",[r.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((async a=>{await a.inLandsWith(e.Beasts).pickOne((async e=>{await e.isolate(),e.hasInvaders&&await e.fear(1)}),{highlightBoards:[a]})}))}]},{name:"Years of Health and Harmony",dahanEvent:!0,effects:[{textArea:[.838,.91],text:"On Each Board with 5 or more <dahan>: Add 1 <dahan> to the land with the most <dahan>.",[r.Now]:({$:e})=>e.inBoardsWhere((a=>a.numberOf(e.Dahan)>=5)).forEach((a=>e.doDahanEventAction((()=>a.inLandsWithMost((a=>a.numberOf(e.Dahan))).pickOne((async a=>{await a.add(1,e.Dahan)}),{highlightBoards:[a]})),{board:a})),{noOptions:"No boards with 5 ore more <dahan>."})}]}]},Ql={set:s.NatureIncarnate,name:"An Ominous Dawn",events:[{name:"An Ominous Dawn",terrorLevels:[1],effects:[{textArea:[.109,.293],text:"1 <fear> per Power Card in play that generates <fear>. (In its instructions, not by destroying <town>/<city>. Count thresholds even if you don't have the Elements. Generated <fear> can't cause Wavering Resolve.)",[r.Now]:({$:e})=>e.doMainEventAction((async()=>{const a=e.powerCardsInPlayThatGeneratesFear,t=a.length;await e.clickToContinue({highlightPowers:a,noOptions:`${t} Power Card${t>1?"s":""} = ${t} <fear>.`}),await e.fear(t)}))}]},{name:"Wavering Resolve",terrorLevels:[2,3],effects:[{textArea:[.366,.549],text:"Remove 1 Health worth of Invaders per Power Card in play that generates <fear>. (In its instructions, not by destroying <town>/<city>. Count thresholds even if you don't have the Elements.)",[r.Now]:({$:e})=>e.doMainEventAction((async()=>{const a=e.powerCardsInPlayThatGeneratesFear,t=a.length;await e.clickToContinue({highlightPowers:a,noOptions:`${t} Power Card${t>1?"s":""} = ${t} Health worth.`}),await e.removeInvadersWorthOfHealthUpTo(t)}))}]},{name:"Dangerous Lands",tokenEvent:!0,effects:[{textArea:[.626,.74],text:"On Each Board: 1 Damage in a land with <badlands>/<beasts>. 1 Damage to <dahan> in a land with <badlands>/<beasts> and <dahan>.",[r.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((async a=>{await a.inLandsWith(e.BadlandsOrBeasts).pickOne((async e=>{await e.damage(1)}),{noOptions:`On board ${a.name}: No land with <badlands>/<beasts>.`}),await a.inLandsWithAllOf(e.BadlandsOrBeasts,e.Dahan).pickOne((async a=>{await a.damage(1,e.Dahan)}),{noOptions:`On board ${a.name}: No land with <badlands>/<beasts> and <dahan>.`})}),{selectOrder:!0})}]},{name:"Waning Support",dahanEvent:!0,effects:[{textArea:[.785,.935],text:"On Each Board with <town>/<city><br>...and 5 or fewer <dahan>: Destroy 1 <presence>.<br>...and 3 or fewer <dahan>: Also Add 1 <blight> to a land with <town>/<city>.",[r.Now]:({$:e})=>e.inBoardsWhere((a=>a.hasOneLandWith(e.TownOrCity))).forEach((a=>e.doDahanEventAction((async()=>{a.numberOf(e.Dahan)<=5?(await e.addSubEffect({textArea:[.787,.859],text:"On Each Board with <town>/<city> and 5 or fewer <dahan>:<br>Destroy 1 <presence>.",[r.Now]:async()=>{await a.destroyPresence(1)}}),a.numberOf(e.Dahan)<=3&&await e.addSubEffect({textArea:[.854,.934],text:"...and 3 or fewer <dahan>: Also Add 1 <blight> to a land with <town>/<city>.",[r.Now]:async()=>{await a.inLandsWith(e.TownOrCity).pickOne((async e=>{await e.addBlight(1)}))}})):await e.clickToContinue({noOptions:`On board ${a.name}: More than 5 <dahan>.`})}),{board:a})),{noOptions:"No boards with <town>/<city."})}]}]},Kl={set:s.NatureIncarnate,name:"Ethereal Conjunction",events:[{name:"Ethereal Conjunction:",fullText:["&nbsp;&nbsp;A confluence of spiritual forces gathers into an unformed maelstrom. Each Spirit chooses:","Endure It's Forces as Best you Can","&nbsp;&nbsp;<bullet> Destroy 1 <presence> and lose 1 Energy.","Seek to Control it, though it Exhausts you","&nbsp;&nbsp;<bullet> Choose any non-Major Power Card of yours (in hand, play or discard). Put it into play (without paying its cost); use it immediately (even if already used this turn); and then Forget it.","&nbsp;&nbsp;<bullet> Discard all Power Cards (from hand)."],effects:[{textArea:[.191,.502],text:"A confluence of spiritual forces gathers into an unformed maelstrom. Each spirit chooses:<br><br>Endure It's Forces as Best you Can<or>Seek to Control it, though it Exhausts you",[r.Now]:({$:e})=>e.eachSpirit((a=>e.doMainEventAction((()=>e.chooseBetween({effects:[{actionId:"EndureItsForces",label:"Endure It's Forces as Best you Can",textArea:[.233,.273],text:"Destroy 1 <presence> and lose 1 Energy.",[r.Now]:async()=>{await a.destroyPresence(1),await a.loseEnergy(1)}},{actionId:"SeekToControlIt",label:"Seek to Control it, though it Exhausts you",effects:[{textArea:[.324,.461],text:"Choose any non-Major Power Card of yours (in hand, play or discard). Put it into play (without paying its cost); use it immediately (even if already used this turn); and then Forget it.",[r.Now]:()=>a.powersWhere((e=>e.isA(ye.NonMajorCard)&&!e.isBlessed&&!e.assisted)).pickOne((async t=>{await e.addSubEffect({effects:[{textArea:[.357,.429],text:"Put it into play (without paying its cost).",[r.Now]:async()=>{await t.play({withoutPaying:!0,withoutUsingCardPlays:!0})}},{textArea:[.39,.463],text:"Use it immediately (even if already used this turn).",[r.Now]:async()=>{await a.targetAndResolvePower(t)}},{textArea:[.422,.462],text:"Forget it.",[r.Now]:async()=>{await a.forgetPowerState(t)}}]})}),{noOptions:`${a.nameLink} has no non-Major Power Card.`})},{textArea:[.454,.494],text:"Discard all Power Cards (from hand).",[r.Now]:async()=>{await e.clickToContinue(),await a.discardAllPowerCards()}}]}]})))))}]},ql(!0),{name:"Tend to the Living Earth",dahanEvent:!0,effects:[{textArea:[.81,.921],text:"On Each Board with 5 or more <dahan>, Remove 1 <blight> in a land with <dahan>.",[r.Now]:({$:e})=>e.inBoardsWhere((a=>a.numberOf(e.Dahan)>=5)).forEach((a=>e.doDahanEventAction((()=>a.forPiecesThatIs(e.Blight,(a=>a.has(e.Dahan))).pickOne((async e=>{await e.location.removeBlight()}),{prompt:"Pick <blight> to Remove.",highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <blight> and <dahan>.`})),{board:a})),{noOptions:"No boards with 5 ore more <dahan>."})}]}]},Xl={set:s.NatureIncarnate,name:"Far-Off Wars Touch The Island",events:[{name:"Far Off Wars Touch The Island",fullText:["&nbsp;&nbsp;Invaders from a different, distant land launch an assault upon the island while the Invaders here rally together in a wave of nationalism. Defending the island with them might come at too high a price.","&nbsp;&nbsp;<bullet> Add a Fear Card to the top of the Fear Deck","&nbsp;&nbsp;<bullet> On Each Board, in the land with the most <town>/<city>, choose (for that board) either:","Encourage the Destruction","&nbsp;&nbsp;<bullet> 4 <fear>. Destroy half of <town> (round up) and half of <city> (round up). Add 2 <blight> without cascading.","Blunt the Offensive","&nbsp;&nbsp;<bullet> Destroy 1 <town> but do not gain <fear>."],effects:[{textArea:[.269,.31],text:"Invaders from a different, distant land launch an assault upon the island while the Invaders here rally together in a wave of nationalism. Defending the island with them might come at too high a price.<br><br>Add a Fear Card to the top of the Fear Deck",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.doTokenEventAction((async()=>{await e.addFearCards(1).toLevel(e.terrorLevel)}))}},{textArea:[.298,.599],text:"On Each Board, in the land with the most <town>/<city>, choose (for that board) either:<br><br>Encourage the Destruction<or>Blunt the Offensive",[r.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>a.inLandsWithMost((a=>a.numberOf(e.TownOrCity))).pickOne((t=>e.chooseBetween({highlightBoards:[a],highlightLocations:[t],effects:[{actionId:"EncourageTheDestruction",label:"Encourage the Destruction",effects:[{textArea:[.432,.473],text:"4 <fear>.",[r.Now]:async()=>{await t.fear(4)}},{textArea:[.432,.513],text:"Destroy half of <town> (round up) and half of <city> (round up).",[r.Now]:async()=>{await t.destroy({amount:Math.ceil(t.numberOf(e.Town)/2),pieces:e.Town}),await t.destroy({amount:Math.ceil(t.numberOf(e.City)/2),pieces:e.City})}},{textArea:[.463,.503],text:"Add 2 <blight> without cascading.",[r.Now]:async()=>{await t.addBlight(2,{mayCascade:!1})}}]},{actionId:"BluntTheOffensive",label:"Blunt the Offensive",textArea:[.563,.604],text:"Destroy 1 <town> but do not gain <fear>.",[r.Now]:async()=>{await e.addEffectUntilEndOfAction({[r.PreventFearGeneration]:({fromDestroyingBuildings:e})=>Promise.resolve(e)}),await t.destroyOne(e.Town)}}]})),{autoPlayOneOption:!0,highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <town>/<city>.`})))}]},{name:"Ecosystem Damage",tokenEvent:!0,effects:[{textArea:[.654,.732],text:"On Each Board: Add 1 <badlands> to a land with <blight>.",[r.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((a=>a.inLandsWith(e.Blight).pickOne((async a=>{await a.add(1,e.Badlands)}))),{selectOrder:!0})}]},bl]},_l={set:s.NatureIncarnate,name:"Focused Farming",events:[{name:"Focused Farming",blightStatus:Td.HealthyIsland,effects:[{textArea:[.112,.19],text:"On Each Board: Add 1 <explorer> and 1 <town> to land with <town>/<blight>.",[r.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>a.inLandsWhere((a=>a.hasOneOf(e.Town,e.Blight))).pickOne((async a=>{await a.add(1,e.Explorer),await a.add(1,e.Town)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No land with <town>/<blight>.`})))}]},{name:"Essence Disperses",blightStatus:Td.BlightedIsland,effects:[{textArea:[.368,.582],text:"Each Spirit chooses independently to:<br><br>Forget 1 Power Card.<or>Lose 2 Energy (to min. 0) and Destroy 1 <presence>. In the land where you destroyed <presence>, return 1 <blight> to the box (if possible).",[r.Now]:({$:e})=>e.eachSpirit((a=>e.doMainEventAction((()=>e.chooseBetween({effects:[{actionId:"ForgetPowerCard",label:"Forget 1 Power Card.",effects:[{textArea:[.398,.439],text:"Forget 1 Power Card.",[r.Now]:async()=>{await a.forgetPowers()}}]},{actionId:"DestroyPresence",label:"Lose Energy and Destroy <presence>.",effects:[{textArea:[.473,.582],text:"Lose 2 Energy (to min. 0) and Destroy 1 <presence>. In the land where you destroyed <presence>, return 1 <blight> to the box (if possible).",[r.Now]:async()=>{await a.loseEnergy(2);const e=await a.destroyPresence(1);e.length>0&&await e[0].location.removeBlight({toTheBox:!0})}}]}]})))))}]},fl,Nl]},Zl=async(e,a)=>{await e.addSubEffect({textArea:[.366,.442],text:"On Each Board: Skip the first Ravage Action (in one land matching the Ravage Card).",[r.Now]:async()=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.InfluxOfSettlers,text:`The first Ravage Action is skipped on Board ${a.name}.`,[r.GlobalReminder]:()=>({icon:`${a.name}: Skip<br>Ravage`}),[r.PreventInvaderActionInLand]:async({land:t,invaderAction:n})=>t.board===a&&n===K.Ravage&&(await e.sendEvent({type:T.GenericSub,text:`The Ravage in land ${t.coordinateLink} was skipped from Lethargy and Degeneration.`}),e.removeThisEffect(),!0)})}})},eh=async(e,a)=>{await a.inLandsWith(e.TownOrCity).pickOne((async e=>{await e.addBlight(1)}),{textArea:[.407,.448],text:"Add 1 <blight> to a land with <town>/<city>.",highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <town>/<city>.`})},ah={set:s.NatureIncarnate,name:"Influx Of Settlers",events:[{name:"Influx Of Settlers",blightStatus:Td.HealthyIsland,effects:[{textArea:[.116,.257],text:"On the single board with the most <town>/<city>: Add 1 <town> per player, split between as many different lands as possible. (This will usually be 1 <town> per chosen land.)",[r.Now]:({$:e})=>e.inBoards().withMost((a=>a.numberOf(e.TownOrCity))).pickOne((a=>a.inLands().inDifferent((a=>e.eachSpirit((()=>e.doMainEventAction((()=>a((async a=>{await a.add(1,e.Town)}))))))))))}]},{name:"Lethargy and Degeneration",blightStatus:Td.BlightedIsland,effects:[{textArea:[.371,.59],text:"On Each Board: Skip the first Ravage Action (in one land). Add 1 <blight> to a land with <town>/<city>.<br><br>Spirits may prevent either/both effects on any/all boards (choose per board) by Destroying 2 <presence> from each board to be protected.",[r.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>e.chooseBetween({highlightBoards:[a],effects:[{actionId:"LetBothHappen",textArea:[.371,.585],label:"Let both effects happen.",[r.Now]:async()=>{await Zl(e,a),await eh(e,a)}},{actionId:"PreventRavage",label:"Prevent Ravage skip by Destroying 2 <presence>.",textArea:[.451,.587],[r.Now]:async()=>{await a.destroyPresence(2),await eh(e,a)},condition:()=>a.numberOf(e.Presence)>=2},{actionId:"PreventBlight",textArea:[.451,.587],label:"Prevent adding <blight> by Destroying 2 <presence>.",[r.Now]:async()=>{await a.destroyPresence(2),await Zl(e,a)},condition:()=>a.numberOf(e.Presence)>=2},{actionId:"PreventBoth",textArea:[.451,.587],label:"Prevent both effect by Destroying 2 <presence>.",[r.Now]:async()=>{await a.destroyPresence(2)},condition:()=>a.numberOf(e.Presence)>=2}]})))}]},{name:"Sand Stalkers",tokenEvent:!0,effects:[{textArea:[.635,.743],text:"On Each Board: Add 1 <beasts> to the Sands with the most Invaders. 1 <fear> if Invaders are present there.",[r.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((a=>a.inSands().withMost((a=>a.numberOf(e.Invader))).pickOne((async a=>{await a.add(1,e.Beasts),a.hasInvaders&&await a.fear(1)}))))}]},{name:"Network of Support and Trade",dahanEvent:!0,effects:[{textArea:[.835,.911],text:"When Invaders Ravage, if the land has <dahan>, Defend 1 + Defend 1 per adjacent <dahan>.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.NetworkOfSupportAndTrade,[r.GlobalReminder]:()=>({icon:"Defend<br><dahan>"}),[r.DefendFromGame]:({land:a})=>a.has(e.Dahan)?1+a.inAdjacentLands().sum((e=>e.numberOfParticipatingDahan)):0})}}]}]},th={set:s.NatureIncarnate,name:"Search For Unclaimed Land",events:[{name:"Search For Unclaimed Land",blightStatus:Td.HealthyIsland,effects:[{textArea:[.115,.19],text:"On Each Board: Explore in the land with the fewest total Invaders/<dahan> (no source required).",[r.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>a.inLandsWithLeast((a=>a.numberOf(e.InvaderOrDahan))).pickOne((async e=>{await e.doExtraExplore()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No land with Invaders/<dahan>.`})))}]},{name:"Widespread Hunting",blightStatus:Td.BlightedIsland,effects:[{textArea:[.362,.585],text:"When <town>/<city> Ravage in a land:<br><bullet> If no <beasts> are present, Invaders do +2 Damage (total).<br><bullet> Otherwise, Destroy 1 <beasts>.<br><br>Do this at most once per board (for one Ravage Action in one land).",[r.Now]:async({$:e})=>{const a=[];await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.WidespreadHunting,[r.AlterInvaderActionInLand]:async({land:t,invaderAction:n,normal:i})=>(n===K.Ravage&&i&&!a.includes(t.board)&&(a.push(t.board),t.has(e.Beasts)?await t.destroyOne(e.Beasts):await e.addSubEffectUntilEndOfAction({[r.AdjustCollectiveInvaderRavageDamage]:()=>2})),!1),[r.GlobalReminder]:()=>({icon:"Extra<br><damage>"})})}}]},{name:"Plagues in Populous Lands",tokenEvent:!0,effects:[{textArea:[.635,.74],text:"On Each Board: Add 1 <disease> to a land with 3 or more Invaders.",[r.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((async a=>{await a.inLandsWhere((a=>a.numberOf(e.Invader)>=3)).pickOne((async a=>{await a.add(1,e.Disease)}),{noOptions:`On board ${a.name}: No land with 3 or more Invaders.`})}))}]},{name:"Spreading Conflict Prompts Caution",dahanEvent:!0,effects:[{textArea:[.827,.935],text:"On Each Board: Push up to 3 <dahan> from a land matching a Ravage card to a land not matching a Ravage card.",[r.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((async a=>{await a.inLands().where((a=>a.has(e.Dahan)&&a.matchesInvaderCards(e.invaderCardsInVisibleSlot(ps.Ravage),K.Ravage))).pickOne((async a=>{await a.push({amount:3,quantifier:w.UpTo,pieces:e.Dahan,destinationFilter:a=>!a.matchesInvaderCards(e.invaderCardsInVisibleSlot(ps.Ravage),K.Ravage)})}),{noOptions:`On board ${a.name}: No lands with <dahan> in a land matching a Ravage Card.`})}),{selectOrder:!0})}]}]},nh={set:s.NatureIncarnate,name:"Terror Spikes Upwards",events:[{name:"Terror Spikes Upwards",terrorLevels:[1,2],effects:[{textArea:[.112,.306],text:"If you have any Earned Fear Cards, resolve the first one now as if the Terror Level were 1 higher (then discard it).<br><br>Otherwise, 1 <fear> per player. (Generated <fear> can't cause Final Harvest.)",[r.Now]:({$:e})=>e.doMainEventAction((async()=>{await e.clickToContinue(),e.fearCardsEarnedCount>0?await e.addSubEffect({textArea:[.112,.219],text:"If you have any Earned Fear Cards, resolve the first one now as if the Terror Level were 1 higher (then discard it).",[r.Now]:async()=>{await e.resolveNextFearCard({extraTerrorLevel:1})}}):await e.addSubEffect({textArea:[.236,.306],text:"Otherwise, 1 <fear> per player. (Generated <fear> can't cause Final Harvest.)",[r.Now]:async()=>{await e.fear(e.spiritCount)}})}))}]},{name:"Final Harvest",terrorLevels:[3],effects:[{textArea:[.37,.443],text:"Each <city> does +3 Damage during Ravage Actions.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.FinalHarvest,[r.GlobalReminder]:()=>({icon:"<city><br>+3 <damage>"}),[r.AdjustIndividualInvaderRavageDamage]:({piece:a})=>a.isA(e.City)?3:0})}},{textArea:[.462,.538],text:"After each Ravage Action, Remove 1 <town>/<city> from that land.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.FinalHarvest,[r.GlobalReminder]:()=>({icon:"Remove<br><town>/<city>"}),[r.AfterRavaging]:({land:a})=>e.doMainEventAction((async()=>{await a.remove({amount:1,pieces:e.TownOrCity})}))})}}]},{name:"Secure Settled Territory",tokenEvent:!0,effects:[{textArea:[.624,.769],text:"On Each Board: In a land with <badlands>/<beasts> and <town>/<city>: Destroy 1 <badlands>/<beasts>. 1 Damage to <dahan>. 1 Damage.",[r.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((a=>e.countPiecesOnlyIfHavingPieces([p.Badlands,p.Beasts],(()=>a.inLandsWithAllOf(e.BadlandsOrBeasts,e.TownOrCity))).pickOne((async a=>{await e.addSubEffect({effects:[{textArea:[.696,.736],text:"Destroy 1 <badlands>/<beasts>.",[r.Now]:async()=>{await a.destroyOne(e.BadlandsOrBeasts)}},{textArea:[.696,.736],text:"1 Damage to <dahan>.",[r.Now]:async()=>{await a.damage(1,e.Dahan)}},{textArea:[.732,.772],text:"1 Damage.",[r.Now]:async()=>{await a.damage(1)}}]})}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <badlands>/<beasts> and <town>/<city>.`})),{selectOrder:!0})}]},{name:"War Among the Dahan",dahanEvent:!0,effects:[{textArea:[.811,.917],text:"On Each Board: In the land with the most <dahan> (min. 2), Push half the <dahan> (round down).",[r.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((a=>a.inLands().where((a=>a.hasAtLeast(2,e.Dahan))).withMost((a=>a.numberOf(e.Dahan))).pickOne((async a=>{await a.push({amount:Math.floor(a.numberOf(e.Dahan)/2),pieces:e.Dahan})}),{noOptions:`On board ${a.name}: No lands with at least 2 <dahan>.`})),{selectOrder:!0})}]}]},rh={set:s.NatureIncarnate,name:"Visions Out Of Time",events:[{name:"Visions Out Of Time",fullText:["&nbsp;&nbsp;A Spirit more loosely time-moored than most warns of catastrophe's subtle seeds. Each Spirit chooses:","Let the Warning Waft into Day's Past","&nbsp;&nbsp;Lose 1 Energy and replace your most expensive non-Unique Power Card in hand or discard pile (combined) with one of the same type: Reveal the top 4 cards of the deck, Take 1, put it where your card is, then put your card in that deck's discard.","Head off the Problems Yourself","&nbsp;&nbsp;Add 1 Omen token (Scenario Marker) to the land without Omens that has the most Invaders (min. 1). After the Ravage Step next turn, at each Omen: 2 <fear>. Invaders Ravage. Remove 1 Omen."],effects:[{textArea:[.195,.601],text:"A Spirit more loosely time-moored than most warns of catastrophe's subtle seeds. Each Spirit chooses:<br><br>Let the Warning Waft into Day's Past<or>Head off the Problems Yourself",[r.Now]:({$:e})=>e.eachSpirit((a=>e.doMainEventAction((()=>e.chooseBetween({effects:[{actionId:"LetTheWarningWaft",label:"Let the Warning Waft into Day's Past",textArea:[.232,.409],text:"Lose 1 Energy and replace your most expensive non-Unique Power Card in hand or discard pile (combined) with one of the same type: Reveal the top 4 cards of the deck, Take 1, put it where your card is, then put your card in that deck's discard.",[r.Now]:async()=>{await a.loseEnergy(1);const e=a.powersWhere((e=>e.isA(ye.NonUniqueCard)&&(e.isInHand||e.isInDiscard))).withMost((e=>e.costToPlay));if(e.count>0){const t=e.anyOne.data.type===o.Major,n=await a.gainPowerCard({powerType:t?o.Major:o.Minor,withoutForgetting:!0,taken:!0});n.chosen.length>0&&await e.pickOne((async e=>{e.isInDiscard&&await n.chosen[0].discard(),await e.forget({silent:!0})}))}}},{actionId:"HeadOffTheProblems",label:"Head off the Problems Yourself",effects:[{textArea:[.46,.599],text:"Add 1 Omen token (Scenario Marker) to the land without Omens that has the most Invaders (min. 1). After the Ravage Step next turn, at each Omen: 2 <fear>. Invaders Ravage. Remove 1 Omen.",[r.Now]:async()=>{const a=e.turn;await e.inLandsWithout(e.Omen).where((e=>e.hasInvaders)).withMost((a=>a.numberOf(e.Invader))).pickOne((async a=>{await a.add(1,e.Omen)})),e.hasEffectNamed("Head off the Problems Yourself")||await e.addSubEffect({name:"Head off the Problems Yourself",effectId:pe.HeadOffTheProblems,[r.GlobalReminder]:()=>({icon:"Omen",visible:e.turn<=a+1}),[r.AfterTheNormalRavageStep]:async()=>{e.turn===a+1&&await e.inLandsWith(e.Omen).selectOrder().forEach((async a=>{await e.doMainEventAction((async()=>{await a.fear(2),await a.doExtraRavage(),await a.removeOne(e.Omen)}))}))}})}}]}]})))))}]},Al(!0),{name:"Strength from Trade",dahanEvent:!0,effects:[{textArea:[.804,.918],text:"Lands with <dahan> have Defend 2. In lands with <town>/<city> and no <dahan>, Ravage Actions do +1 Damage.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.StrengthFromTrade,[r.GlobalReminder]:()=>({icon:"Defend<br>+1 <damage>"}),[r.DefendFromGame]:({land:a})=>a.hasAtLeast(1,e.Dahan)?2:0,[r.AdjustCollectiveDahanRavageDamage]:({land:a})=>a.has(e.TownOrCity)&&a.doesntHave(e.Dahan)?1:0})}}]}]},ih={[uc.AccumulatedDevastation]:zl,[uc.AnOminousDawn]:Ql,[uc.AStrangeMadnessAmongTheBeasts]:bc,[uc.BureaucratsAdjustFunding]:dl,[uc.CitiesRise]:hl,[uc.CivicEngagement]:gl,[uc.CoastalTownsMultiply]:ul,[uc.CulturalAssimilation]:Ec,[uc.DahanTradeWithTheInvaders]:pl,[uc.DistantExploration]:Oc,[uc.EagerExplorers]:wl,[uc.EtherealConjunction]:Kl,[uc.FarOffWarsTouchTheIsland]:Xl,[uc.FarmersSeekTheDahanForAid]:Dc,[uc.FocusedFarming]:_l,[uc.Fortuneseekers]:yl,[uc.GradualCorruption]:ml,[uc.HardworkingSettlers]:vl,[uc.HarvestBountyHarvestDust]:Il,[uc.HeavyFarming]:kc,[uc.InfluxOfSettlers]:ah,[uc.InterestingDiscoveries]:Lc,[uc.InvadersSurgeInland]:Rc,[uc.InvestedAristocracy]:xl,[uc.InvestigationOfDangers]:Nc,[uc.LesserSpiritsImperiled]:Tl,[uc.LifesBalanceTilts]:Pl,[uc.MapmakersChartTheWild]:Sl,[uc.MissionariesArrive]:$c,[uc.NewSpeciesSpread]:Mc,[uc.NoBraveryWithoutNumbers]:Ol,[uc.NuminousCrisis]:Dl,[uc.Outpaced]:Hc,[uc.Overconfidence]:Bl,[uc.PopulationRises]:Uc,[uc.PromisingFarmland]:jc,[uc.ProvincialSeat]:kl,[uc.PullTogetherInAdversity]:Ll,[uc.PuttingDownRoots]:Vc,[uc.RelentlessOptimism]:Fl,[uc.RemnantsOfASpiritsHeart]:Rl,[uc.ResourcefulPopulace]:$l,[uc.RisingInterestInTheIsland]:Yc,[uc.SacredSitesUnderThreat]:Qc,[uc.SearchForNewLands]:Kc,[uc.SearchForUnclaimedLand]:th,[uc.SeekNewFarmland]:Wl,[uc.SeekingTheInterior]:Xc,[uc.SlaveRebellion]:_c,[uc.SmallerPortsSpringUp]:Ml,[uc.SprawlContainedByTheWilds]:Gl,[uc.StrangeTalesAttractExplorers]:Zc,[uc.TemporaryTruce]:Hl,[uc.TerrorSpikesUpwards]:nh,[uc.TheFrontierCalls]:Ul,[uc.TheStrugglesOfGrowth]:jl,[uc.ThrivingTrade]:Jl,[uc.TightknitCommunities]:al,[uc.UrbanDevelopment]:tl,[uc.VisionsOutOfTime]:rh,[uc.WarTouchesTheIslandsShores]:nl,[uc.WaveOfReconnaissance]:rl,[uc.WellpreparedExplorers]:il,[uc.WoundedLandsAttractExplorers]:Yl,[uc.YearsOfLittleRain]:sl};var sh=function(e,a,t,n){var r,i=arguments.length,s=i<3?a:null===n?n=Object.getOwnPropertyDescriptor(a,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,a,t,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(i<3?r(s):i>3?r(a,t,s):r(a,t))||s);return i>3&&s&&Object.defineProperty(a,t,s),s};class oh{eventCardsInDeck;eventCardsInDiscard=[];lastSeenEventCard;static allEventCards=Object.keys(ih);$;constructor(e){un.makeObservable(this),this.$=e;const a=e.config.sets??vc;this.eventCardsInDeck=new mc(e,oh.allEventCards.filter((t=>a.includes(ih[t].set)&&!e.bannedCards.includes(t)))),this.eventCardsInDeck.remove(uc.SlaveRebellion)}get activeEventCard(){return this.eventCardIsActive&&this.eventCardsInDiscard.length>0?this.eventCardsInDiscard[this.eventCardsInDiscard.length-1]:void 0}get eventCardAtIndexIsSpecial(){return e=>this.eventCardsInDeck.cardAt(e)===uc.SlaveRebellion}get eventCardIsActive(){return[Xe.AdvanceCards,Xe.Build,Xe.Event,Xe.Explore,Xe.Fear,Xe.HighImmigration,Xe.Ravage,Xe.SlowPowers].includes(this.$.phase)}async drawEventCard(){if(this.eventCardsInDeck.count>0){await this.$.setPhase(Xe.Event);const e=await this.eventCardsInDeck.draw();this.lastSeenEventCard=e,this.eventCardsInDiscard.push(e);const a=this.$.blightStatus,t=this.$.terrorLevel,n=this.$.stage;if(await this.$.sendEvent({type:T.DrawEventCard,eventCard:e}),await this.$.query({query:tn.ClickToContinueCard,items:[e],actionIds:[e]}),this.$.turn>1&&this.$.randomEventsEnabled){const i=ih[e];for(const r of i.events){const{blightStatus:i,terrorLevels:s,stages:o}=r;this.$.gameEnded||void 0!==i&&a!==i||void 0!==s&&!s.includes(t)||void 0!==o&&!o.includes(n)||(await this.$.sendEvent({type:T.ResolveEventCard,eventData:r}),await this.$.addEffectUntilEndOfTurn({...r,card:e}))}await this.$.doEffects(r.AfterResolvingEventCard,{eventCard:e})}}}insertEventCard(e){return{underCards:a=>{this.eventCardsInDiscard.includes(e)&&ae(this.eventCardsInDiscard,e),this.eventCardsInDeck.insert(e,a)}}}putBottomEventCardToTop(){if(!this.eventCardsInDeck.isEmpty){const e=this.eventCardsInDeck.removeCard(this.eventCardsInDeck.count-1);this.eventCardsInDeck.insertOneOf(e,0)}}putTopEventCardToBottom(){if(!this.eventCardsInDeck.isEmpty){const e=this.eventCardsInDeck.removeCard(0);this.eventCardsInDeck.insertOneOf(e,this.eventCardsInDeck.count)}}removeEventCardFromDiscard(e){this.eventCardsInDiscard.includes(e)&&ae(this.eventCardsInDiscard,e)}async revealTopEventCard(){const e=await this.eventCardsInDeck.reveal(0);return null!==e&&await this.$.clickToContinue({card:e,text:`The top Event Card is ${ih[e].name}.`}),e}shuffleTopThreeEventCards(){return this.eventCardsInDeck.shuffleTopNCards([0,1,2],!0)}shuffleTopTwoEventCards(){return this.eventCardsInDeck.shuffleTopNCards([0,1],!0)}toString(){return Ic({eventCardsInDeck:this.eventCardsInDeck.count,eventCardsInDiscard:dn(this.eventCardsInDiscard)},2)}}sh([C.sH],oh.prototype,"eventCardsInDeck",void 0),sh([C.sH],oh.prototype,"eventCardsInDiscard",void 0),sh([C.sH],oh.prototype,"lastSeenEventCard",void 0);const dh={name:"Avoid the Dahan",set:s.Base,levels:[{textArea:[.273,.36],text:"Invaders do not Explore into lands with at least 2 <dahan>.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.AvoidTheDahanI,[r.GlobalReminder]:()=>({icon:"Skip<br>Explore"}),[r.PreventInvaderActionInLand]:({land:a,invaderAction:t})=>Promise.resolve(t===K.Explore&&a.hasAtLeast(2,e.Dahan))})}},{textArea:[.549,.64],text:"Invaders do not Build in lands where <dahan> outnumber <town>/<city>.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.AvoidTheDahanII,[r.GlobalReminder]:()=>({icon:"Skip<br>Build"}),[r.PreventInvaderActionInLand]:({land:a,invaderAction:t})=>Promise.resolve(t===K.Build&&a.the(e.Dahan).outnumber(e.TownOrCity))})}},{textArea:[.854,.894],text:"Invaders do not Build in lands with <dahan>.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.AvoidTheDahanIII,[r.GlobalReminder]:()=>({icon:"Skip<br>Build"}),[r.PreventInvaderActionInLand]:({land:a,invaderAction:t})=>Promise.resolve(t===K.Build&&a.has(e.Dahan))})}}]},ch={name:"Belief Takes Root",set:s.Base,levels:[{textArea:[.296,.336],text:"Defend 2 in all lands with <presence>.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.BeliefTakesRootI,[r.GlobalReminder]:()=>({icon:"Defend<br><presence>"}),[r.DefendFromGame]:({land:a})=>a.hasAtLeast(1,e.Presence)?2:0})}},{effects:[{textArea:[.538,.578],text:"Defend 2 in all lands with <presence>.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.BeliefTakesRootII,[r.GlobalReminder]:()=>({icon:"Defend<br><presence>"}),[r.DefendFromGame]:({land:a})=>a.hasAtLeast(1,e.Presence)?2:0})}},{textArea:[.584,.669],text:"Each Spirit gains 1 Energy per <sacred> they have in lands with Invaders.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.eachSpirit((a=>e.doFearAction((async()=>{await a.gainEnergy(a.inLandsWhere((e=>e.hasSacredSiteOf(a)&&e.hasInvaders)).count)}))))}}]},{textArea:[.819,.949],text:"Each player chooses a different land and removes up to 2 Health worth of Invaders per <presence> there.",[r.Now]:async({$:e})=>{await e.inDifferentLands((a=>e.eachSpirit((()=>e.doFearAction((()=>a((async a=>{await a.removeInvadersWorthOfHealthUpTo(2*a.numberOf(e.Presence))}))))))))}}]},lh={name:"Dahan Enheartened",set:s.Base,levels:[{textArea:[.252,.383],text:"Each player may Push 1 <dahan> from a land with Invaders or Gather 1 <dahan> into a land with Invaders.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.inLandsWhere((a=>a.hasInvaders&&a.hasOrIsAdjacentToLandsWith(e.Dahan))).optionallyPickOne((a=>e.forPiecesThatIs(e.Dahan,(e=>e.isAdjacentTo(a)||e===a)).pickOne((t=>e.doFearAction((async()=>{t.location===a?await t.push():await a.gather({pieces:e.Dahan,pieceFilter:e=>e===t,pickPiecesEffect:{autoPlayOneOption:!0}})}))),{text:"Push/Gather 1 <dahan> from/into this land.",highlightLocations:[a]})),{text:"Choose a land with Invaders.",noOptions:"No applicable lands."})))},{textArea:[.534,.664],text:"Each player chooses a different land. In chosen lands: Gather up to 2 <dahan>, then 1 Damage if <dahan> are present.",[r.Now]:({$:e})=>e.inDifferentLands((a=>e.eachSpirit((()=>e.doFearAction((()=>a((async a=>{await a.gatherUpTo(2,e.Dahan),a.has(e.Dahan)&&await a.damage(1)}))))))))},{textArea:[.817,.952],text:"Each player chooses a different land. In chosen lands: Gather up to 2 <dahan>, then 1 Damage per <dahan> present.",[r.Now]:({$:e})=>e.inDifferentLands((a=>e.eachSpirit((()=>e.doFearAction((()=>a((async a=>{await a.gatherUpTo(2,e.Dahan),a.has(e.Dahan)&&await a.damage(a.numberOf(e.Dahan))}))))))))}]},hh={name:"Dahan On Their Guard",set:s.Base,levels:[{textArea:[.296,.336],text:"In each land, Defend 1 per <dahan>.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.DahanOnTheirGuardI,[r.GlobalReminder]:()=>({icon:"Defend<br><dahan>"}),[r.DefendFromGame]:({land:a})=>a.numberOf(e.Dahan)})}},{textArea:[.551,.638],text:"In each land with <dahan>, Defend 1, plus an additional Defend 1 per <dahan>.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.DahanOnTheirGuardII,[r.GlobalReminder]:()=>({icon:"Defend<br><dahan>"}),[r.DefendFromGame]:({land:e})=>e.numberOfParticipatingDahan>0?1+e.numberOfParticipatingDahan:0})}},{textArea:[.858,.898],text:"In each land, Defend 2 per <dahan>.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.DahanOnTheirGuardIII,[r.GlobalReminder]:()=>({icon:"Defend<br><dahan>"}),[r.DefendFromGame]:({land:e})=>2*e.numberOfParticipatingDahan})}}]},gh={name:"Dahan Raid",set:s.Base,levels:[{textArea:[.279,.367],text:"Each player chooses a different land with <dahan>. 1 Damage there.",[r.Now]:({$:e})=>e.inLandsWith(e.Dahan).inDifferent((a=>e.eachSpirit((()=>e.doFearAction((()=>a((async e=>{await e.damage(1)}))))))),{noOptions:"No lands with <dahan>."})},{textArea:[.548,.636],text:"Each player chooses a different land with <dahan>. 1 Damage per <dahan> there.",[r.Now]:({$:e})=>e.inLandsWith(e.Dahan).inDifferent((a=>e.eachSpirit((()=>e.doFearAction((()=>a((async a=>{await a.damage(a.numberOf(e.Dahan))}))))))))},{textArea:[.837,.923],text:"Each player chooses a different land with <dahan>. 2 Damage per <dahan> there.",[r.Now]:({$:e})=>e.inLandsWith(e.Dahan).inDifferent((a=>e.eachSpirit((()=>e.doFearAction((()=>a((async a=>{await a.damage(2*a.numberOf(e.Dahan))}))))))),{noOptions:"No lands with <dahan>."})}]},fh={name:"Emigration Accelerates",set:s.Base,levels:[{textArea:[.276,.364],text:"Each player removes 1 <explorer> from a Coastal land.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Explorer,(e=>e.isCoastal)).pickOne((async e=>{await e.remove()}),{noOptions:"No Coastal lands with <explorer>."})))))},{textArea:[.549,.636],text:"Each player removes 1 <explorer>/<town> from a Coastal land.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.ExplorerOrTown,(e=>e.isCoastal)).pickOne((async e=>{await e.remove()}),{noOptions:"No Coastal lands with <explorer>/<town>."})))))},{textArea:[.834,.921],text:"Each player removes 1 <explorer>/<town> from any land.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.ExplorerOrTown).pickOne((async e=>{await e.remove()}),{noOptions:"No lands with <explorer>/<town>."})))))}]},uh={name:"Fear Of The Unseen",set:s.Base,levels:[{textArea:[.275,.363],text:"Each player removes 1 <explorer>/<town> from a land with <sacred>.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.ExplorerOrTown,(e=>e.hasSacredSite)).pickOne((async e=>{await e.remove()}),{noOptions:"No lands with <sacred> and <explorer>/<town>."})))))},{textArea:[.548,.638],text:"Each player removes 1 <explorer>/<town> from a land with <presence>.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.ExplorerOrTown,(a=>a.has(e.Presence))).pickOne((async e=>{await e.remove()}),{noOptions:"No lands with <explorer>/<town> and <presence>."})))))},{textArea:[.834,.924],text:"Each player removes 1 <explorer>/<town> from a land with <presence>, or 1 <city> from a land with <sacred>.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesWhere((a=>a.isA(e.ExplorerOrTown)&&a.location.has(e.Presence)||a.isA(e.City)&&a.location.hasSacredSite)).pickOne((async e=>{await e.remove()}),{noOptions:"No applicable lands."})))))}]},ph={name:"Isolation",set:s.Base,levels:[{textArea:[.276,.361],text:"Each player removes 1 <explorer>/<town> from a land where it is the only Invader.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.ExplorerOrTown,(a=>a.hasExactly(1,e.Invader))).pickOne((async e=>{await e.remove()}),{noOptions:"No lands with <explorer>/<town> where it is the only Invader."})))))},{textArea:[.554,.64],text:"Each player removes 1 <explorer>/<town> from a land with 2 or fewer Invaders.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.ExplorerOrTown,(a=>a.hasAtMost(2,e.Invader))).pickOne((async e=>{await e.remove()}),{noOptions:"No lands with <explorer>/<town> with 2 or fewer Invaders."})))))},{textArea:[.837,.921],text:"Each player removes an Invader from a land with 2 or fewer Invaders.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Invader,(a=>a.hasAtMost(2,e.Invader))).pickOne((async e=>{await e.remove()}),{noOptions:"No lands with 2 or fewer Invaders."})))))}]},wh={name:"Overseas Trade SeemSafer",set:s.Base,levels:[{textArea:[.296,.336],text:"Defend 3 in all Coastal lands.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.OverseasTradeSeemSaferI,[r.GlobalReminder]:()=>({icon:"Defend<br>Coastal"}),[r.DefendFromGame]:({land:e})=>e.isCoastal?3:0})}},{effects:[{textArea:[.552,.592],text:"Defend 6 in all Coastal lands.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.OverseasTradeSeemSaferII,[r.GlobalReminder]:()=>({icon:"Defend<br>Coastal"}),[r.DefendFromGame]:({land:e})=>e.isCoastal?6:0})}},{textArea:[.552,.638],text:"Invaders do not Build <city> in Coastal lands this turn.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.OverseasTradeSeemSaferII,[r.GlobalReminder]:()=>({icon:"Skip<br>Build"}),[r.PreventInvaderActionInLand]:({land:e,invaderAction:a})=>Promise.resolve(a===K.Build&&e.isCoastal&&e.buildPlans===Z.City)})}}]},{effects:[{textArea:[.838,.878],text:"Defend 9 in all Coastal lands.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.OverseasTradeSeemSaferIII,[r.GlobalReminder]:()=>({icon:"Defend<br>Coastal"}),[r.DefendFromGame]:({land:e})=>e.isCoastal?9:0})}},{textArea:[.838,.923],text:"Invaders do not Build in Coastal lands this turn.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.OverseasTradeSeemSaferIII,[r.GlobalReminder]:()=>({icon:"Skip<br>Build"}),[r.PreventInvaderActionInLand]:({land:e,invaderAction:a})=>Promise.resolve(a===K.Build&&e.isCoastal&&e.buildPlans===Z.City)})}}]}]},yh={name:"Retreat!",set:s.Base,levels:[{textArea:[.269,.364],text:"Each player may Push up to 2 <explorer> from an Inland land.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.inLandsWith(e.Explorer).where((e=>e.isInland)).optionallyPickOne((async a=>{await a.pushUpTo(2,e.Explorer)}),{noOptions:"No Inland lands with <explorer>."})))))},{textArea:[.549,.638],text:"Each player may Push up to 3 <explorer>/<town> from an Inland land.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.inLandsWith(e.ExplorerOrTown).where((e=>e.isInland)).optionallyPickOne((async a=>{await a.pushUpTo(3,e.ExplorerOrTown)}),{noOptions:"No Inland lands with <explorer>/<town>."})))))},{textArea:[.837,.923],text:"Each player may Push any number of <explorer>/<town> from one land.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.inLandsWith(e.ExplorerOrTown).optionallyPickOne((async a=>{await a.push({quantifier:w.Any,pieces:e.ExplorerOrTown})}),{noOptions:"No lands with <explorer>/<town>."})))))}]},mh={name:"Scapegoats",set:s.Base,levels:[{textArea:[.296,.336],text:"Each <town> destroys 1 <explorer> in its land.",[r.Now]:({$:e})=>e.inLandsWith(e.Town).selectOrder().forEach((a=>e.doFearAction((async()=>{await a.destroy({amount:a.numberOf(e.Town),pieces:e.Explorer})}),{land:a})),{noOptions:"No lands with <town>."})},{textArea:[.544,.647],text:"Each <town> destroys 1 <explorer> in its land. Each <city> destroys 2 <explorer> in its land.",[r.Now]:({$:e})=>e.inLandsWith(e.TownOrCity).selectOrder().forEach((a=>e.doFearAction((async()=>{await a.destroy({amount:a.numberOf(e.Town)+2*a.numberOf(e.City),pieces:e.Explorer})}),{land:a})),{noOptions:"No lands with <town>/<city>."})},{textArea:[.828,.932],text:"Destroy all <explorer> in lands with <town>/<city>. Each <city> destroys 1 <town> in its land.",[r.Now]:({$:e})=>e.inLandsWith(e.TownOrCity).selectOrder().forEach((a=>e.doFearAction((async()=>{await a.destroyAll(e.Explorer),await a.destroy({amount:a.numberOf(e.City),pieces:e.Town})}),{land:a})),{noOptions:"No lands with <town>/<city>."})}]},vh={name:"Seek Safety",set:s.Base,levels:[{textArea:[.256,.388],text:"Each player may Push 1 <explorer> into a land with more <town>/<city> than the land it came from.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Explorer,(a=>a.hasAdjacentLandWhere((t=>t.numberOf(e.TownOrCity)>a.numberOf(e.TownOrCity))))).optionallyPickOne((async a=>{await a.push({amount:1,pieces:e.Explorer,destinationFilter:t=>t.numberOf(e.TownOrCity)>a.location.numberOf(e.TownOrCity)})}),{noOptions:"No applicable lands."})))))},{textArea:[.532,.676],text:"Each player may Gather 1 <explorer> into a land with <town>/<city>, or Gather 1 <town> into a land with <city>.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.chooseBetween({effects:[{actionId:"GatherExplorer",text:"Gather 1 <explorer> into a land with <town>/<city>.",[r.Now]:()=>e.inLandsWith(e.TownOrCity).where((a=>a.hasAdjacentLandWhere((a=>a.has(e.Explorer))))).pickOne((async a=>{await a.gatherOne(e.Explorer)})),condition:()=>e.existLandWhere((a=>a.has(e.TownOrCity)&&a.hasAdjacentLandWhere((a=>a.has(e.Explorer)))))},{actionId:"GatherTown",text:"Gather 1 <town> into a land with <city>.",[r.Now]:()=>e.inLandsWith(e.City).where((a=>a.hasAdjacentLandWithPiece(e.Town))).pickOne((async a=>{await a.gatherOne(e.Town)})),condition:()=>e.existLandWhere((a=>a.has(e.City)&&a.hasAdjacentLandWithPiece(e.Town)))},{actionId:"Neither",text:"Neither."}]})))))},{textArea:[.819,.957],text:"Each player may remove up to 3 Health worth of Invaders from a land without <city>.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.inLandsWhere((a=>a.has(e.ExplorerOrTown)&&a.doesntHave(e.City))).optionallyPickOne((async e=>{await e.removeInvadersWorthOfHealthUpTo(3)}),{noOptions:"No lands with Invader without <city>."})))))}]},Ih={name:"Tall Tales Of Savagery",set:s.Base,levels:[{textArea:[.276,.365],text:"Each player removes 1 <explorer> from a land with <dahan>.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Explorer,(a=>a.has(e.Dahan))).pickOne((async e=>{await e.remove()}),{noOptions:"No lands with <dahan> and <explorer>."})))))},{textArea:[.549,.638],text:"Each player removes 2 <explorer> or 1 <town> from a land with <dahan>.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((async()=>{await e.forPiecesThatIs(e.ExplorerOrTown,(a=>a.has(e.Dahan))).filteredByAnyInPriority((a=>a.location.hasAtLeast(2,e.Explorer)||a.location.has(e.Town)),(a=>a.location.hasAtLeast(1,e.Explorer))).pickOne((async a=>{await e.doFearAction((async()=>{const t=a.piece,n=a.location;await a.remove(),t===p.Explorer&&await n.removeOne(e.Explorer)}))}),{noOptions:"No applicable lands."})}))))},{effects:[{textArea:[.819,.911],text:"Remove 2 <explorer> or 1 <town> from each land with <dahan>.",[r.Now]:async({$:e})=>{await e.inLandsWith(e.Dahan).selectOrder().forEach((async a=>{await e.doFearAction((async()=>{await a.piecesThatAre(e.ExplorerOrTown).pickOne((async a=>{const t=a.piece,n=a.location;await a.remove(),t===p.Explorer&&await n.removeOne(e.Explorer)}))}))}),{noOptions:"No lands with <dahan>."})}},{textArea:[.868,.955],text:"Then, remove 1 <city> from each land with at least 2 <dahan>.",[r.Now]:async({$:e})=>{await e.inLandsWith(e.City).where((a=>a.hasAtLeast(2,e.Dahan))).forEach((async a=>{await e.doFearAction((async()=>{await a.removeOne(e.City)}))}),{noOptions:"No lands with <city> and at least 2 <dahan>."})}}]}]},Ah={name:"Trade Suffers",set:s.Base,levels:[{textArea:[.305,.345],text:"Invaders do not Build in lands with <city>.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.TradeSuffersI,[r.GlobalReminder]:()=>({icon:"Skip<br>Build"}),[r.PreventInvaderActionInLand]:({land:a,invaderAction:t})=>Promise.resolve(t===K.Build&&a.has(e.City))})}},{textArea:[.549,.64],text:"Each player may replace 1 <town> with 1 <explorer> in a Coastal land.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Town,(e=>e.isCoastal)).optionallyPickOne((async e=>{await e.replace([p.Explorer])}),{noOptions:"No Coastal lands with <town>."})))))},{textArea:[.832,.92],text:"Each player may replace 1 <city> with 1 <town>, or 1 <town> with 1 <explorer> in a Coastal land.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.TownOrCity,(e=>e.isCoastal)).optionallyPickOne((async e=>{await e.downgrade()}),{noOptions:"No Coastal lands with <town>."})))))}]},xh={name:"Wary Of The Interior",set:s.Base,levels:[{textArea:[.273,.365],text:"Each player removes 1 <explorer> from an Inland land.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Explorer,(e=>e.isInland)).pickOne((async e=>{await e.remove()}),{noOptions:"No Inland lands with <explorer>."})))))},{textArea:[.549,.636],text:"Each player removes 1 <explorer>/<town> from an Inland land.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.ExplorerOrTown,(e=>e.isInland)).pickOne((async e=>{await e.remove()}),{noOptions:"No Inland lands with <explorer>/<town>."})))))},{textArea:[.835,.924],text:"Each player removes 1 <explorer>/<town> from any land.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.ExplorerOrTown).pickOne((async e=>{await e.remove()}),{noOptions:"No lands with <explorer>/<town>."})))))}]},bh={name:"Dahan Attack",set:s.BranchAndClaw,levels:[{textArea:[.276,.361],text:"Each player removes 1 <explorer> from a land with <dahan>.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Explorer,(a=>a.has(e.Dahan))).pickOne((async e=>{await e.remove()}),{noOptions:"No lands with <dahan> and <explorer>."})))))},{textArea:[.552,.643],text:"Each player chooses a different land with <dahan>. 1 Damage per <dahan> there.",[r.Now]:({$:e})=>e.inLandsWith(e.Dahan).inDifferent((a=>e.eachSpirit((()=>e.doFearAction((()=>a((async a=>{await a.damage(a.numberOf(e.Dahan))}))))))),{noOptions:"No lands with <dahan>."})},{textArea:[.814,.946],text:"Each player chooses a different land with <town>/<city>. Gather 1 <dahan> into that land. Then 2 Damage per <dahan> there.",[r.Now]:({$:e})=>e.inLandsWith(e.TownOrCity).inDifferent((a=>e.eachSpirit((()=>e.doFearAction((()=>a((async a=>{await a.gatherOne(e.Dahan),await a.damage(2*a.numberOf(e.Dahan))}))))))),{noOptions:"No lands with <town>/<city>."})}]},Th=({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Invader,(a=>a.has(e.Dahan))).pickOne((async e=>{await e.addStrife()}),{noOptions:"No lands with <dahan> and Invaders."}))))),Eh={name:"Dahan Threaten",set:s.BranchAndClaw,levels:[{textArea:[.288,.328],text:"Each player adds 1 <strife> in a land with <dahan>.",[r.Now]:Th},{effects:[{textArea:[.534,.574],text:"Each player adds 1 <strife> in a land with <dahan>.",[r.Now]:Th},{textArea:[.579,.666],text:"For the rest of this turn, Invaders have -1 Health per <strife> to a minimum of 1.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.invadersHaveMinusOneHealthPerStrife()}}]},{effects:[{textArea:[.838,.878],text:"Each player adds 1 <strife> in a land with <dahan>.",[r.Now]:Th},{textArea:[.881,.921],text:"In every land with <strife>, 1 Damage per <dahan>.",[r.Now]:({$:e})=>e.inLandsWithStrife().where((a=>a.has(e.Dahan))).selectOrder().forEach((a=>e.doFearAction((async()=>{await a.damage(a.numberOf(e.Dahan))}),{land:a})),{noOptions:"No lands with <dahan> and <strife>."})}]}]},Ph={name:"Demoralized",set:s.BranchAndClaw,levels:[{textArea:[.294,.334],text:"Defend 1 in all lands.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.DemoralizedI,[r.GlobalReminder]:()=>({icon:"Defend<br>1 to All"}),[r.DefendFromGame]:()=>1})}},{textArea:[.569,.609],text:"Defend 2 in all lands.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.DemoralizedII,[r.GlobalReminder]:()=>({icon:"Defend<br>2 to All"}),[r.DefendFromGame]:()=>2})}},{textArea:[.854,.894],text:"Defend 3 in all lands.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.DemoralizedIII,[r.GlobalReminder]:()=>({icon:"Defend<br>3 to All"}),[r.DefendFromGame]:()=>3})}}]},Sh={name:"Depart The DangerousLand",set:s.BranchAndClaw,levels:[{textArea:[.269,.364],text:"Each player removes 1 <explorer> from a land with <beasts>, <disease>, or at least 2 <dahan>.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Explorer,(a=>a.hasOneOf(e.Beasts,e.Disease)||a.hasAtLeast(2,e.Dahan))).pickOne((async e=>{await e.remove()}),{noOptions:"No lands with <explorer> and <beasts>/<disease> or at least 2 <dahan>."})))))},{textArea:[.546,.633],text:"Each player removes 1 <explorer>/<town> from a land with <beasts>, <disease>, or at least 2 <dahan>.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.ExplorerOrTown,(a=>a.hasOneOf(e.Beasts,e.Disease)||a.hasAtLeast(2,e.Dahan))).pickOne((async e=>{await e.remove()}),{noOptions:"No lands with <explorer>/<town> and <beasts>/<disease> or at least 2 <dahan>."})))))},{textArea:[.808,.939],text:"Each player removes up to 4 Health worth of Invaders from a land with <beasts>, <disease>, or at least 2 <dahan>.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.inLandsWhere((a=>a.hasOneOf(e.Beasts,e.Disease)||a.hasAtLeast(2,e.Dahan))).pickOne((async e=>{await e.removeInvadersWorthOfHealthUpTo(4)}),{noOptions:"No lands with Invaders and <beasts>/<disease> or at least 2 <dahan>."})))))}]},Oh={name:"Explorers Are Reluctant",set:s.BranchAndClaw,levels:[{textArea:[.252,.384],text:"During the next normal Explore, skip the lowest-numbered land matching the Invader Card on each board.",[r.Now]:async({$:e})=>{const a=[];await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.ExplorersAreReluctantI,[r.GlobalReminder]:()=>({icon:"Skip<br>Explore"}),[r.BeforeResolvingInvaderCard]:({invaderAction:t,card:n,normal:r})=>{if(r&&t===K.Explore)for(const t of e.boards){const e=t.lowestNumberedLandMatching(n,K.Explore);e&&a.push(e)}return Promise.resolve()},[r.PreventInvaderActionInLand]:({land:e})=>Promise.resolve(a.includes(e)),[r.AfterResolvingExploreCard]:()=>(e.removeThisEffect(),Promise.resolve())})}},{effects:[{textArea:[.529,.569],text:"Skip the next normal Explore.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.ExplorersAreReluctantII,[r.GlobalReminder]:()=>({icon:"Skip<br>Explore"}),[r.AdjustNumberOfExploreCards]:()=>-1,[r.SkipNextExploreCard]:()=>(e.removeThisEffect(),Promise.resolve(!0))})}},{textArea:[.529,.661],text:"During the next Invader Phase, draw an additional Explore Card.",[r.Now]:async({$:e})=>{const a=e.turn;await e.clickToContinue(),await e.addSubEffect({effectId:pe.ExplorersAreReluctantII,highPriority:!0,[r.GlobalReminder]:()=>({icon:"Extra<br>Explore"}),[r.AdjustNumberOfExploreCards]:()=>e.turn===a+1?1:0,[r.AfterTheNormalExploreStep]:async()=>{e.turn===a+1&&(e.removeThisEffect(),await e.explore())}})}}]},{textArea:[.815,.946],text:"Skip the next normal Explore, but still reveal a card. (Perform the <escalation> if relevant.) Cards shift left as usual.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.ExplorersAreReluctantIII,[r.GlobalReminder]:()=>({icon:"Skip<br>Explore"}),[r.PreventInvaderActionInLand]:({invaderAction:e,normal:a})=>Promise.resolve(a&&e===K.Explore),[r.AfterResolvingExploreCard]:()=>(e.removeThisEffect(),Promise.resolve())})}}]},Ch={name:"Flee The PestilentLand",set:s.BranchAndClaw,levels:[{textArea:[.271,.358],text:"Each player removes 1 <explorer>/<town> from a land with <disease>.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.ExplorerOrTown,(a=>a.has(e.Disease))).pickOne((async e=>{await e.remove()}),{noOptions:"No lands with <explorer>/<town> and <disease>."})))))},{textArea:[.534,.669],text:"Each player removes up to 3 Health of Invaders from a land with <disease> or 1 <explorer> from an Inland land.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.chooseBetween({noOptions:"No land with <disease> or Inland land with <explorer>.",effects:[{actionId:"RemoveFromDisease",textArea:[.534,.618],text:"Remove up to 3 Health of Invaders from a land with <disease>.",condition:()=>e.existLandWhere((a=>a.hasAllOf(e.Invader,e.Disease))),[r.Now]:()=>e.inLandsWithAllOf(e.Invader,e.Disease).pickOne((async e=>{await e.removeInvadersWorthOfHealthUpTo(3)}))},{actionId:"RemoveFromInland",textArea:[.624,.664],text:"Remove 1 <explorer> from an Inland land.",[r.Now]:()=>e.forPiecesThatIs(e.Explorer,(e=>e.isInland)).pickOne((async e=>{await e.remove()})),condition:()=>e.existLandWhere((a=>a.has(e.Explorer)&&a.isInland))}]})))))},{textArea:[.811,.949],text:"Each player removes up to 5 Health of Invaders from a land with <disease> or 1 <explorer>/<town> from an Inland land.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.chooseBetween({effects:[{actionId:"RemoveFromDisease",textArea:[.814,.9],text:"Remove up to 5 Health of Invaders from a land with <disease>.",condition:()=>e.existLandWhere((a=>a.hasInvaders&&a.has(e.Disease))),[r.Now]:()=>e.inLandsWhere((a=>a.hasInvaders&&a.has(e.Disease))).pickOne((async e=>{await e.removeInvadersWorthOfHealthUpTo(5)}))},{actionId:"RemoveFromInland",textArea:[.903,.943],text:"Remove 1 <explorer>/<town> from an Inland land.",[r.Now]:()=>e.forPiecesThatIs(e.ExplorerOrTown,(e=>e.isInland)).pickOne((async e=>{await e.remove()})),condition:()=>e.existLandWhere((a=>a.has(e.ExplorerOrTown)&&a.isInland))}]})))))}]},Dh={name:"Immigration Slows",set:s.BranchAndClaw,levels:[{textArea:[.252,.384],text:"During the next normal Build, skip the lowest-numbered land matching the Invader Card on each board.",[r.Now]:async({$:e})=>{const a=[];await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.ImmigrationSlowsI,[r.GlobalReminder]:()=>({icon:"Skip<br>Build"}),[r.BeforeResolvingInvaderCard]:({invaderAction:t,card:n,normal:r})=>{if(r&&t===K.Build)for(const t of e.boards){const e=t.lowestNumberedLandMatching(n,K.Build);e&&a.push(e)}return Promise.resolve()},[r.PreventInvaderActionInLand]:({land:e})=>Promise.resolve(a.includes(e)),[r.AfterResolvingBuildCard]:()=>(e.removeThisEffect(),Promise.resolve())})}},{effects:[{textArea:[.555,.595],text:"Skip the next normal Build.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.ImmigrationSlowsII,[r.GlobalReminder]:()=>({text:"Skip the next normal Build.<br><br>The Build Card remains in place instead of shifting left.",icon:"Skip<br>Build"}),[r.SkipNextBuildCard]:()=>(e.removeThisEffect(),Promise.resolve(!0))})}},{textArea:[.555,.64],text:"The Build Card remains in place instead of shifting left.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.ImmigrationSlowsII,[r.BeforeAdvancingCards]:async()=>{await e.advanceCardsIn(ps.Explore).to(ps.Build),await e.advanceCardsIn(ps.Build).to(ps.Explore)}})}}]},{textArea:[.834,.919],text:"Skip the next normal Build. The Build Card shifts left as usual.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.ImmigrationSlowsIII,[r.GlobalReminder]:()=>({icon:"Skip<br>Build"}),[r.SkipNextBuildCard]:()=>(e.removeThisEffect(),Promise.resolve(!0))})}}]},Bh={name:"Panic",set:s.BranchAndClaw,levels:[{textArea:[.271,.357],text:"Each player adds 1 <strife> in a land with <beasts>/<disease>/<dahan>.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Invader,(a=>a.hasOneOf(e.Beasts,e.Disease,e.Dahan))).pickOne((async e=>{await e.addStrife()}),{noOptions:"No lands with Invader and <beasts>/<disease>/<dahan>."})))))},{effects:[{textArea:[.513,.602],text:"Each player adds 1 <strife> in a land with <beasts>/<disease>/<dahan>.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Invader,(a=>a.hasOneOf(e.Beasts,e.Disease,e.Dahan))).pickOne((async e=>{await e.addStrife()}),{noOptions:"No lands with Invader and <beasts>/<disease>/<dahan>."})))))},{textArea:[.559,.689],text:"For the rest of this turn, Invaders have -1 Health per <strife> to a minimum of 1.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.invadersHaveMinusOneHealthPerStrife()}}]},{effects:[{textArea:[.819,.859],text:"Each player adds 1 <strife> to an Invader.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Invader).pickOne((async e=>{await e.addStrife()}))))))},{textArea:[.863,.949],text:"For the rest of this turn, Invaders have -1 Health per <strife> to a minimum of 1.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.invadersHaveMinusOneHealthPerStrife()}}]}]},kh={name:"Panicked By Wild Beasts",set:s.BranchAndClaw,levels:[{textArea:[.273,.361],text:"Each player adds 1 <strife> in a land with or adjacent to <beasts>.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Invader,(a=>a.hasOrIsAdjacentToLandsWith(e.Beasts))).pickOne((async e=>{await e.addStrife()}),{noOptions:"No lands with Invaders in or adjacent to a land with <beasts>."})))))},{effects:[{textArea:[.536,.62],text:"Each player adds 1 <strife> in a land with or adjacent to <beasts>.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.forPiecesThatIs(e.Invader,(a=>a.hasOrIsAdjacentToLandsWith(e.Beasts))).pickOne((async e=>{await e.addStrife()}),{noOptions:"No lands with Invaders in or adjacent to a land with <beasts>."})))},{textArea:[.579,.666],text:"Invader skip their normal Explore and Build in lands with <beasts>.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.PanickedByWildBeastsII,[r.GlobalReminder]:()=>({icon:"Skip<br><beasts>"}),[r.PreventInvaderActionInLand]:({land:a,invaderAction:t,normal:n})=>Promise.resolve(n&&[K.Explore,K.Build].includes(t)&&a.has(e.Beasts))})}}]},{effects:[{textArea:[.818,.903],text:"Each player adds 1 <strife> in a land with or adjacent to <beasts>.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Invader,(a=>a.hasOrIsAdjacentToLandsWith(e.Beasts))).pickOne((async e=>{await e.addStrife()}),{noOptions:"No lands with Invaders in or adjacent to a land with <beasts>."})))))},{textArea:[.864,.949],text:"Invader skip all normal Actions in lands with <beasts>.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.PanickedByWildBeastsIII,[r.GlobalReminder]:()=>({icon:"Skip<br><beasts>"}),[r.PreventInvaderActionInLand]:({land:a,normal:t})=>Promise.resolve(t&&a.has(e.Beasts))})}}]}]},Lh={name:"Plan For Departure",set:s.BranchAndClaw,levels:[{textArea:[.276,.361],text:"Each player may Gather 1 <town> into a Coastal land.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.inLandsWhere((a=>a.isCoastal&&a.hasAdjacentLandWithPiece(e.Town))).optionallyPickOne((async a=>{await a.gatherOne(e.Town)}),{noOptions:"No Coastal lands with adjacent <town>."})))))},{effects:[{textArea:[.534,.62],text:"Each player may Gather 1 <explorer>/<town> into a Coastal land.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.inLandsWhere((a=>a.isCoastal&&a.hasAdjacentLandWithPiece(e.ExplorerOrTown))).optionallyPickOne((async a=>{await a.gatherOne(e.ExplorerOrTown)}),{noOptions:"No Coastal lands with adjacent <explorer>/<town>."})))))},{textArea:[.579,.661],text:"Defend 2 in all Coastal lands.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.PlanForDepartureII,[r.GlobalReminder]:()=>({icon:"Defend<br>Coastal"}),[r.DefendFromGame]:({land:e})=>e.isCoastal?2:0})}}]},{effects:[{textArea:[.814,.899],text:"Each player may Gather 2 <explorer>/<town> into a Coastal land.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.inLandsWhere((a=>a.isCoastal&&a.hasAdjacentLandWithPiece(e.ExplorerOrTown))).optionallyPickOne((async a=>{await a.gatherUpTo(2,e.ExplorerOrTown)}),{noOptions:"No Coastal lands with adjacent <explorer>/<town>."})))))},{textArea:[.854,.946],text:"Defend 4 in all Coastal lands.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.PlanForDepartureIII,[r.GlobalReminder]:()=>({icon:"Defend<br>Coastal"}),[r.DefendFromGame]:({land:e})=>e.isCoastal?4:0})}}]}]},Fh={name:"Quarantine",set:s.BranchAndClaw,levels:[{textArea:[.285,.325],text:"Explore does not affect Coastal lands.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.QuarantineI,[r.GlobalReminder]:()=>({icon:"Skip<br>Explore"}),[r.PreventInvaderActionInLand]:({land:e,invaderAction:a})=>Promise.resolve(a===K.Explore&&e.isCoastal)})}},{effects:[{textArea:[.534,.574],text:"Explore does not affect Coastal lands.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.QuarantineII,[r.GlobalReminder]:()=>({icon:"Skip<br>Explore"}),[r.PreventInvaderActionInLand]:({land:e,invaderAction:a})=>Promise.resolve(a===K.Explore&&e.isCoastal)})}},{textArea:[.572,.664],text:"Lands with <disease> are not a source of Invaders when Exploring.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.QuarantineII,[r.GlobalReminder]:()=>({icon:"<disease>"}),[r.PreventExploreSourceInLand]:({land:a})=>a.has(e.Disease)})}}]},{effects:[{textArea:[.837,.877],text:"Explore does not affect Coastal lands.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.QuarantineIII,[r.GlobalReminder]:()=>({icon:"Skip<br>Explore"}),[r.PreventInvaderActionInLand]:({land:e,invaderAction:a})=>Promise.resolve(a===K.Explore&&e.isCoastal)})}},{textArea:[.883,.923],text:"Invaders do not act in lands with <disease>.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.QuarantineIII,[r.GlobalReminder]:()=>({icon:"<disease>"}),[r.PreventInvaderActionInLand]:({land:a})=>Promise.resolve(a.has(e.Disease))})}}]}]},Rh={name:"Too Many Monsters",set:s.BranchAndClaw,levels:[{textArea:[.278,.365],text:"Each player removes 1 <explorer>/<town> from a land with <beasts>.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.ExplorerOrTown,(a=>a.has(e.Beasts))).pickOne((async e=>{await e.remove()}),{noOptions:"No lands with <explorer>/<town> and <beasts>."})))))},{textArea:[.532,.664],text:"Each player removes 1 <explorer> and 1 <town> from a land with <beasts> or 1 <explorer> from a land adjacent to <beasts>.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesWhere((a=>a.isA(e.Explorer)&&(a.location.has(e.Beasts)||a.location.hasAdjacentLandWithPiece(e.Beasts))||a.isA(e.Town)&&a.location.has(e.Beasts))).pickOne((async a=>{const t=a.location,n=a.piece;await a.remove(),t.has(e.Beasts)&&await t.removeOne(n===p.Explorer?e.Town:e.Explorer)}),{noOptions:"No applicable lands."})))))},{textArea:[.814,.947],text:"Each player removes 2 <explorer> and 2 <town> from a land with <beasts> or 1 <explorer>/<town> from a land adjacent to <beasts>.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.inLandsWhere((a=>a.hasAllOf(e.Beasts,e.ExplorerOrTown)||a.hasAdjacentLandWithPiece(e.Beasts)&&a.has(e.ExplorerOrTown))).pickOne((async a=>{a.has(e.Beasts)?(await a.remove({amount:2,pieces:e.Explorer}),await a.remove({amount:2,pieces:e.Town})):await a.removeOne(e.ExplorerOrTown)}),{noOptions:"No applicable lands."})))))}]},Nh={name:"Tread Carefully",set:s.BranchAndClaw,levels:[{textArea:[.252,.381],text:"Each player may choose a land with <dahan> or adjacent to at least 5 <dahan>. Invaders do not Ravage there this turn.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.inLandsWhere((a=>a.has(e.Dahan)||a.numberOfPiecesInAdjacentLands(e.Dahan)>=5)).pickOne((async e=>{await e.skipInvaderAction({text:"Invaders do not Ravage here this turn.",all:!0,filter:({invaderAction:e})=>e===K.Ravage})}),{noOptions:"No lands with <dahan>."})))))},{textArea:[.529,.657],text:"Each player may choose a land with <dahan> or adjacent to at least 3 <dahan>. Invaders do not Ravage there this turn.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.inLandsWhere((a=>a.has(e.Dahan)||a.numberOfPiecesInAdjacentLands(e.Dahan)>=3)).pickOne((async e=>{await e.skipInvaderAction({text:"Invaders do not Ravage here this turn.",all:!0,filter:({invaderAction:e})=>e===K.Ravage})}),{noOptions:"No lands with <dahan>."})))))},{textArea:[.812,.943],text:"Each player may choose a land with <dahan> or adjacent to <dahan>. Invaders do not Ravage there this turn.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.inLandsWithOrAdjacentTo(e.Dahan).pickOne((async e=>{await e.skipInvaderAction({text:"Invaders do not Ravage here this turn.",all:!0,filter:({invaderAction:e})=>e===K.Ravage})}),{noOptions:"No lands with <dahan>."})))))}]},$h={name:"Unrest",set:s.BranchAndClaw,levels:[{textArea:[.289,.329],text:"Each player adds 1 <strife> to a <town>.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Town).pickOne((async e=>{await e.addStrife()}),{noOptions:"No lands with <town>."})))))},{effects:[{textArea:[.536,.576],text:"Each player adds 1 <strife> to a <town>.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Town).pickOne((async e=>{await e.addStrife()}),{noOptions:"No lands with <town>."})))))},{textArea:[.577,.664],text:"For the rest of this turn, Invaders have -1 Health per <strife> to a minimum of 1.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.invadersHaveMinusOneHealthPerStrife()}}]},{effects:[{textArea:[.821,.861],text:"Each player adds 1 <strife> to an Invader.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Invader).pickOne((async e=>{await e.addStrife()}),{noOptions:"No lands with Invaders."})))))},{textArea:[.865,.95],text:"For the rest of this turn, Invaders have -1 Health per <strife> to a minimum of 1.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.invadersHaveMinusOneHealthPerStrife()}}]}]},Wh={name:"Angry Mobs",set:s.FeatherAndFlame,levels:[{textArea:[.272,.363],text:"Each player may Replace 1 <town> with 2 <explorer>. 1 <fear> per player who does.",[r.Now]:({$:e})=>e.eachSpirit((async()=>{await e.doFearAction((async()=>{await e.forPiecesThatIs(e.Town).optionallyPickOne((async e=>{const a=e.location;await e.replace([p.Explorer,p.Explorer]),await a.fear(1)}),{noOptions:"No lands with <town>."})}))}))},{textArea:[.549,.643],text:"In each land with 2 or more <explorer>, Destroy 1 <explorer>/<town> per 2 <explorer>.",[r.Now]:({$:e})=>e.inLandsWhere((a=>a.hasAtLeast(2,e.Explorer))).selectOrder().forEach((a=>e.doFearAction((async()=>{await a.destroy({amount:a.forEvery(2,e.Explorer),pieces:e.ExplorerOrTown})}),{land:a})),{noOptions:"No lands with at least 2 <explorer>."})},{textArea:[.831,.916],text:"In each land with 2 or more <explorer>, Destroy 1 Invader per 2 <explorer>.",[r.Now]:({$:e})=>e.inLandsWhere((a=>a.hasAtLeast(2,e.Explorer))).selectOrder().forEach((a=>e.doFearAction((async()=>{await a.destroy({amount:a.forEvery(2,e.Explorer),pieces:e.Invader})}),{land:a})),{noOptions:"No lands with at least 2 <explorer>."})}]},Mh={name:"Communities In Disarray",set:s.FeatherAndFlame,levels:[{effects:[{textArea:[.262,.302],text:"<city> each deal -1 Damage during Ravage.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.CommunitiesInDisarrayI,[r.GlobalReminder]:()=>({icon:"<city><br>-1 <damage>"}),[r.AdjustIndividualInvaderRavageDamage]:({piece:a})=>a.isA(e.City)?-1:0})}},{textArea:[.306,.387],text:"Invaders do not heal Damage at the end of this turn.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.CommunitiesInDisarrayI,[r.GlobalReminder]:()=>({icon:"Prevent<br>Heal"}),[r.PreventClearDamage]:({piece:e})=>e.isInvader})}}]},{effects:[{textArea:[.536,.621],text:"<town>/<city> each deal -1 Damage during Ravage.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.CommunitiesInDisarrayII,[r.GlobalReminder]:()=>({icon:"<town>/<city><br>-1 <damage>"}),[r.AdjustIndividualInvaderRavageDamage]:({piece:a})=>a.isA(e.TownOrCity)?-1:0})}},{textArea:[.579,.664],text:"Invaders do not heal Damage at the end of this turn.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.CommunitiesInDisarrayII,[r.GlobalReminder]:()=>({icon:"Prevent<br>Heal"}),[r.PreventClearDamage]:({piece:e})=>e.isInvader})}}]},{effects:[{textArea:[.821,.906],text:"<town>/<city> each deal -2 Damage during Ravage.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.CommunitiesInDisarrayIII,[r.GlobalReminder]:()=>({icon:"<town>/<city><br>-2 <damage>"}),[r.AdjustIndividualInvaderRavageDamage]:({piece:a})=>a.isA(e.TownOrCity)?-2:0})}},{textArea:[.867,.953],text:"Invaders do not heal Damage at the end of this turn.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.CommunitiesInDisarrayIII,[r.GlobalReminder]:()=>({icon:"Prevent<br>Heal"}),[r.PreventClearDamage]:({piece:e})=>e.isInvader})}}]}]},Gh={name:"Depopulation",set:s.FeatherAndFlame,levels:[{textArea:[.296,.336],text:"On Each Board: Replace 1 <town> with 1 <explorer>.",[r.Now]:({$:e})=>e.onEachBoard((a=>e.doFearAction((()=>a.forPiecesThatIs(e.Town).pickOne((async e=>{await e.replace([p.Explorer])}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <town>.`})),{board:a})))},{textArea:[.572,.612],text:"On Each Board: Remove 1 <town>.",[r.Now]:({$:e})=>e.onEachBoard((a=>e.doFearAction((()=>a.forPiecesThatIs(e.Town).pickOne((async e=>{await e.remove()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <town>.`})),{board:a})))},{textArea:[.841,.929],text:"On Each Board: Remove 1 <town>, or replace 1 <city> with <town>.",[r.Now]:({$:e})=>e.onEachBoard((a=>a.forPiecesThatIs(e.TownOrCity).pickOne((a=>e.doFearAction((async()=>{a.isA(e.Town)?await a.remove():await a.replace([p.Town])}))),{highlightBoards:[a],noOptions:`On board ${a.name}: No <town>/<city>.`})))}]},Hh={name:"Discord",set:s.FeatherAndFlame,levels:[{textArea:[.272,.355],text:"Each player adds 1 <strife> in a different land with at least 2 Invaders.",[r.Now]:({$:e})=>e.inLands().where((a=>a.hasAtLeast(2,e.Invader))).inDifferent((a=>e.eachSpirit((()=>e.doFearAction((()=>a((async e=>{await e.addStrife(1)}))))))),{noOptions:"No lands with at least 2 Invaders."})},{effects:[{textArea:[.534,.623],text:"Each player adds 1 <strife> in a different land with at least 2 Invaders.",[r.Now]:({$:e})=>e.inLands().where((a=>a.hasAtLeast(2,e.Invader))).inDifferent((a=>e.eachSpirit((()=>e.doFearAction((()=>a((async e=>{await e.addStrife(1)}))))))),{noOptions:"No lands with at least 2 Invaders."})},{textArea:[.577,.664],text:"Then, each Invader takes 1 Damage per <strife> it has.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.inLandsWithStrife().forEach((a=>e.doFearAction((()=>a.piecesWithStrife().forEach((async e=>{await e.damageOnlyThis(e.strife)}))),{land:a})),{noOptions:"No lands with <strife>."})}}]},{effects:[{textArea:[.801,.886],text:"Each player adds 1 <strife> in a different land with at least 2 Invaders.",[r.Now]:({$:e})=>e.inLands().where((a=>a.hasAtLeast(2,e.Invader))).inDifferent((a=>e.eachSpirit((()=>e.doFearAction((()=>a((async e=>{await e.addStrife(1)}))))))),{noOptions:"No lands with at least 2 Invaders."})},{textArea:[.842,.967],text:"Then, each Invader with <strife> deals Damage to other Invaders in its land.",[r.Now]:({$:e})=>e.inLandsWithStrife().selectOrder().forEach((a=>e.doFearAction((async()=>{await a.piecesWithStrifeDealsDamageToOtherInvaders()}),{land:a})),{noOptions:"No Invader with <strife>."})}]}]},Uh={name:"Mimic The Dahan",set:s.FeatherAndFlame,levels:[{textArea:[.268,.357],text:"Each player Removes 1 <explorer>/<town> from a land with 2 or more <dahan>.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.ExplorerOrTown,(a=>a.hasAtLeast(2,e.Dahan))).pickOne((async e=>{await e.remove()}),{noOptions:"No lands with <explorer>/<town> with 2 or more <dahan>."})))))},{textArea:[.554,.641],text:"Each player Replaces 1 <explorer>/<town> with 1 <dahan> in a land with 2 or more <dahan>.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.ExplorerOrTown,(a=>a.hasAtLeast(2,e.Dahan))).pickOne((async e=>{await e.replace([p.Dahan])}),{noOptions:"No lands with <explorer>/<town> with 2 or more <dahan>."})))))},{textArea:[.818,.944],text:"Each player Replaces 1 <explorer>/<town> with 1 <dahan> in a land with <dahan>, or adjacent to 3 or more <dahan>.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.ExplorerOrTown,(a=>a.has(e.Dahan)||a.numberOfPiecesInAdjacentLands(e.Dahan)>=3)).pickOne((async e=>{await e.replace([p.Dahan])}),{noOptions:"No lands with <explorer>/<town> with <dahan> or adjacent to 3 or more <dahan>."})))))}]},qh={name:"Spreading Timidity",set:s.FeatherAndFlame,levels:[{textArea:[.291,.331],text:"Each player chooses a land to Isolate.",[r.Now]:({$:e})=>e.inDifferentLands((a=>e.eachSpirit((()=>e.doFearAction((()=>a((async e=>{await e.isolate()}))))))))},{textArea:[.552,.637],text:"Each player chooses a different land to Isolate. Also, Defend 2 in those lands.",[r.Now]:({$:e})=>e.inDifferentLands((a=>e.eachSpirit((()=>e.doFearAction((()=>a((async e=>{await e.isolate(),await e.defend(2)}))))))))},{textArea:[.831,.923],text:"Each player chooses a different land to Isolate. Also, Defend 4 in those lands.",[r.Now]:({$:e})=>e.inDifferentLands((a=>e.eachSpirit((()=>e.doFearAction((()=>a((async e=>{await e.isolate(),await e.defend(4)}))))))))}]},jh={name:"Beset By Many Troubles",set:s.JaggedEarth,levels:[{textArea:[.278,.363],text:"In each land with <badlands>/<beasts>/<disease>/<wilds>/<strife>, Defend 3.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.BesetByManyTroublesI,[r.GlobalReminder]:()=>({icon:"Defend"}),[r.DefendFromGame]:({land:a})=>a.has(e.BadlandsBeastsDiseaseOrWilds)||a.hasStrife?3:0})}},{textArea:[.555,.641],text:"In each land with <badlands>/<beasts>/<disease>/<wilds>/<strife>, or adjacent to 3 or more such tokens, Defend 5.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.BesetByManyTroublesII,[r.GlobalReminder]:()=>({icon:"Defend"}),[r.DefendFromGame]:({land:a})=>a.has(e.BadlandsBeastsDiseaseOrWilds)||a.hasStrife||a.numberOfPiecesInAdjacentLands(e.BadlandsBeastsDiseaseOrWilds)+a.adjacentNumberOfStrife>=3?5:0})}},{textArea:[.831,.919],text:"Every <badlands>/<beasts>/<disease>/<wilds>/<strife> grants Defend 3 in its land and adjacent lands.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.BesetByManyTroublesIII,[r.GlobalReminder]:()=>({icon:"Defend"}),[r.DefendFromGame]:({land:a})=>3*(a.numberOf(e.BadlandsBeastsDiseaseOrWilds)+a.numberOfStrife+a.numberOfPiecesInAdjacentLands(e.BadlandsBeastsDiseaseOrWilds)+a.adjacentNumberOfStrife)})}}]},Jh={name:"Dahan Reclaim Fishing Grounds",set:s.JaggedEarth,levels:[{textArea:[.255,.388],text:"Each player chooses a different Coastal land with <dahan>. In each: 1 Damage per <dahan>.",[r.Now]:({$:e})=>e.inCoastalLands().where((a=>a.has(e.Dahan))).inDifferent((a=>e.eachSpirit((()=>e.doFearAction((()=>a((async a=>{await a.damage(a.numberOf(e.Dahan))}))))))),{noOptions:"No Coastal lands with <dahan>."})},{textArea:[.534,.664],text:"Each player chooses a different Coastal land. In each: Gather up to 1 <dahan>. 1 Damage per <dahan>.",[r.Now]:({$:e})=>e.inCoastalLands().inDifferent((a=>e.eachSpirit((()=>e.doFearAction((()=>a((async a=>{await a.gatherUpTo(1,e.Dahan),await a.damage(a.numberOf(e.Dahan))}))))))))},{textArea:[.818,.952],text:"Each player chooses a different Coastal land. In each: Gather up to 1 <dahan>. 2 Damage per <dahan>.",[r.Now]:({$:e})=>e.inCoastalLands().inDifferent((a=>e.eachSpirit((()=>e.doFearAction((()=>a((async a=>{await a.gatherUpTo(1,e.Dahan),await a.damage(2*a.numberOf(e.Dahan))}))))))))}]},Vh={name:"Flee From Dangerous Lands",set:s.JaggedEarth,levels:[{textArea:[.273,.365],text:"On Each Board: Push 1 <explorer>/<town> from a land with <badlands>/<wilds>/<dahan>.",[r.Now]:({$:e})=>e.onEachBoard((a=>e.doFearAction((()=>a.forPiecesThatIs(e.ExplorerOrTown,(a=>a.hasOneOf(e.Badlands,e.Wilds,e.Dahan))).pickOne((async e=>{await e.push()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <explorer>/<town> in a land with <badlands>/<wilds>/<dahan>.`})),{board:a})))},{textArea:[.555,.641],text:"On Each Board: Remove 1 <explorer>/<town> from a land with <badlands>/<wilds>/<dahan>.",[r.Now]:({$:e})=>e.onEachBoard((a=>e.doFearAction((()=>a.forPiecesThatIs(e.ExplorerOrTown,(a=>a.hasOneOf(e.Badlands,e.Wilds,e.Dahan))).pickOne((async e=>{await e.remove()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <explorer>/<town> in a land with <badlands>/<wilds>/<dahan>.`})),{board:a})))},{textArea:[.814,.946],text:"On Each Board: Remove 1 <explorer>/<town> from any land, or Remove 1 <city> from a land with <badlands>/<wilds>/<dahan>.",[r.Now]:({$:e})=>e.onEachBoard((a=>e.doFearAction((()=>a.forPiecesWhere((a=>a.isA(e.ExplorerOrTown)||a.isA(e.City)&&a.location.hasOneOf(e.Badlands,e.Wilds,e.Dahan))).pickOne((async e=>{await e.remove()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No applicable lands.`})),{board:a})))}]},Yh={name:"Nerves Fray",set:s.JaggedEarth,levels:[{textArea:[.276,.364],text:"Each player adds 1 <strife> in a land not matching a Ravage Card.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Invader,(a=>!a.matchesInvaderCards(e.invaderCardsInVisibleSlot(ps.Ravage),K.Ravage))).pickOne((async e=>{await e.addStrife()}),{noOptions:"No lands with Invaders not matching a Ravage Card."})))))},{textArea:[.558,.644],text:"Each player adds 2 <strife> in a single land not matching a Ravage Card.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.inLandsWith(e.Invader).where((a=>!a.matchesInvaderCards(e.invaderCardsInVisibleSlot(ps.Ravage),K.Ravage))).pickOne((async e=>{await e.addStrife(2)}),{noOptions:"No lands with Invaders not matching a Ravage Card."})))))},{effects:[{textArea:[.817,.904],text:"Each player adds 2 <strife> in a single land not matching a Ravage Card.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.inLandsWith(e.Invader).where((a=>!a.matchesInvaderCards(e.invaderCardsInVisibleSlot(ps.Ravage),K.Ravage))).pickOne((async e=>{await e.addStrife(2)}),{noOptions:"No lands with Invaders not matching a Ravage Card."})))))},{textArea:[.907,.947],text:"1 <fear> per player.",[r.Now]:async({$:e})=>{await e.clickToContinue({noOptions:`${e.spiritCount} player${e.spiritCount>1?"s":""} = ${e.spiritCount} <fear>.`}),await e.doFearAction((async()=>{await e.fear(e.spiritCount)}))}}]}]},zh={name:"Sense Of Dread",set:s.JaggedEarth,levels:[{textArea:[.269,.367],text:"On Each Board: Remove 1 <explorer> from a land matching a Ravage Card.",[r.Now]:({$:e})=>e.onEachBoard((a=>e.doFearAction((()=>a.forPiecesThatIs(e.Explorer).where((a=>a.location.matchesInvaderCards(e.invaderCardsInVisibleSlot(ps.Ravage),K.Ravage))).pickOne((async e=>{await e.remove()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No land with <explorer> in a land matching a Ravage Card.`})),{board:a})))},{textArea:[.552,.641],text:"On Each Board: Remove 1 <explorer>/<town> from a land matching a Ravage Card.",[r.Now]:({$:e})=>e.onEachBoard((a=>e.doFearAction((()=>a.forPiecesThatIs(e.ExplorerOrTown).where((a=>a.location.matchesInvaderCards(e.invaderCardsInVisibleSlot(ps.Ravage),K.Ravage))).pickOne((async e=>{await e.remove()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No land with <explorer>/<town> in a land matching a Ravage Card.`})),{board:a})))},{textArea:[.831,.917],text:"On Each Board: Remove 1 Invader from a land matching a Ravage Card.",[r.Now]:({$:e})=>e.onEachBoard((a=>e.doFearAction((()=>a.forPiecesThatIs(e.Invader).where((a=>a.location.matchesInvaderCards(e.invaderCardsInVisibleSlot(ps.Ravage),K.Ravage))).pickOne((async e=>{await e.remove()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No land with Invader in a land matching a Ravage Card.`})),{board:a})))}]},Qh={name:"Theological Strife",set:s.JaggedEarth,levels:[{textArea:[.302,.342],text:"Each player adds 1 <strife> in a land with <presence>.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Invader,(a=>a.has(e.Presence))).pickOne((async e=>{await e.addStrife()}),{noOptions:"No Invaders in a land with <presence>."})))))},{effects:[{textArea:[.538,.578],text:"Each player adds 1 <strife> in a land with <presence>.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Invader,(a=>a.has(e.Presence))).pickOne((async e=>{await e.addStrife()}),{noOptions:"No Invaders in a land with <presence>."})))))},{textArea:[.582,.664],text:"Each Spirit gains 1 Energy per <sacred> they have in lands with Invaders.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.eachSpirit((a=>e.doFearAction((async()=>{await a.gainEnergy(a.inSacredSites().where((e=>e.hasInvaders)).count)}))))}}]},{effects:[{textArea:[.818,.858],text:"Each player adds 1 <strife> in a land with <presence>.",[r.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Invader,(a=>a.has(e.Presence))).pickOne((async e=>{await e.addStrife()}),{noOptions:"No Invaders in a land with <presence>."})))))},{textArea:[.863,.95],text:"Then, each Invader with <strife> deals Damage to other Invaders in its land.",[r.Now]:({$:e})=>e.inLandsWithStrife().selectOrder().forEach((a=>e.doFearAction((async()=>{await a.piecesWithStrifeDealsDamageToOtherInvaders()}),{land:a})),{noOptions:"No Invader with <strife>"})}]}]},Kh=({$:e})=>e.onEachBoard((a=>e.doFearAction((()=>a.forPiecesThatIs(e.TownOrCity).where((a=>!a.location.matchesInvaderCards(e.invaderCardsInVisibleSlot(ps.Ravage),K.Ravage))).pickOne((async e=>{await e.addStrife()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No land with <town>/<city> in a land not matching a Ravage Card.`})),{board:a}))),Xh=async({$:e})=>{await e.clickToContinue(),await e.inLandsWithStrife().forEach((a=>e.doFearAction((()=>a.piecesWithStrife().forEach((async e=>{await e.damageOnlyThis(e.strife)}))),{land:a})),{noOptions:"No lands with <strife>."})},_h={name:"Civil Unrest",set:s.NatureIncarnate,levels:[{textArea:[.284,.373],text:"On Each Board: Add 1 <strife> to a <town>/<city> in a land not matching a Ravage Card.",[r.Now]:Kh},{effects:[{textArea:[.534,.629],text:"On Each Board: Add 1 <strife> to a <town>/<city> in a land not matching a Ravage Card.",[r.Now]:Kh},{textArea:[.632,.673],text:"Each Invader takes 1 Damage per <strife> it has.",[r.Now]:Xh}]},{effects:[{textArea:[.826,.866],text:"On Each Board: Add 1 <strife>.",[r.Now]:({$:e})=>e.onEachBoard((a=>e.doFearAction((()=>a.forPiecesThatIs(e.Invader).pickOne((async e=>{await e.addStrife()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No land with Invaders.`})),{board:a})))},{textArea:[.865,.905],text:"Each Invader takes 1 Damage per <strife> it has.",[r.Now]:Xh}]}]},Zh=(e,a)=>({$:t})=>t.inLandsWith(t.Dahan).inDifferent((n=>t.eachSpirit((r=>t.doFearAction((()=>n((async t=>{e>0&&await t.damage(e),await t.defend(a)}))),{spirit:r})))),{noOptions:"No lands with <dahan>."}),eg={name:"Dahan Gain The Edge",set:s.NatureIncarnate,levels:[{textArea:[.267,.354],text:"Each player chooses a different land with <dahan>. In Each: Defend 2.",[r.Now]:Zh(0,2)},{textArea:[.546,.638],text:"Each player chooses a different land with <dahan>. In Each: 1 Damage and Defend 3.",[r.Now]:Zh(1,3)},{textArea:[.829,.916],text:"Each player chooses a different land with <dahan>. In Each: 2 Damage and Defend 4.",[r.Now]:Zh(2,4)}]},ag=async({$:e})=>{const a=e.inBoardsWhere((a=>a.hasOneLandWith(e.Invader)&&a.hasOneLandWith(e.Dahan))).count;await e.clickToContinue({noOptions:`${a} board${a>1?"s":""} = ${a} <fear>.`}),await e.doFearAction((async()=>{await e.fear(a)}))},tg=async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.DauntedByTheDahan,text:"Invaders do -6 Damage on their Ravage.",[r.GlobalReminder]:()=>({icon:"-6 <damage><br>to <dahan>"}),[r.AdjustCollectiveInvaderRavageDamage]:e=>!1===e.towardsLand?-6:0})},ng=async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.DauntedByTheDahan,[r.GlobalReminder]:()=>({icon:"Defend"}),[r.DefendFromGame]:({land:a})=>a.has(e.Dahan)?3:0})},rg={name:"Daunted By The Dahan",set:s.NatureIncarnate,levels:[{effects:[{textArea:[.253,.293],text:"1 <fear> per board with both Invaders and <dahan>.",[r.Now]:ag},{textArea:[.298,.385],text:"Invaders do -6 Damage to <dahan> (per land) during Ravage.",[r.Now]:tg}]},{effects:[{textArea:[.531,.571],text:"1 <fear> per board with both Invaders and <dahan>.",[r.Now]:ag},{textArea:[.573,.613],text:"Lands with <dahan> have Defend 3.",[r.Now]:ng},{textArea:[.573,.66],text:"Invaders do -6 Damage to <dahan> (per land) during Ravage.",[r.Now]:tg}]},{effects:[{textArea:[.798,.838],text:"1 <fear> per board with both Invaders and <dahan>.",[r.Now]:ag},{textArea:[.845,.885],text:"Lands with <dahan> have Defend 3.",[r.Now]:ng},{textArea:[.837,.927],text:"Invaders do -6 Damage to <dahan> (per land) during Ravage.",[r.Now]:tg},{textArea:[.927,.967],text:"Isolate all lands with <dahan>.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.DauntedByTheDahan,[r.GlobalReminder]:()=>({icon:"Isolate<br><dahan>"}),[r.Reminder]:a=>a.has(e.Dahan)?"Isolated Land.":void 0,[r.Isolated]:({land:a})=>a.has(e.Dahan)})}}]}]},ig={name:"Distracted By Local Troubles",set:s.NatureIncarnate,levels:[{textArea:[.279,.363],text:"On Each Board, in a land matching a Ravage Card: 1 Damage.",[r.Now]:({$:e})=>e.onEachBoard((a=>e.doFearAction((()=>a.forPiecesThatIs(e.Invader,(a=>a.matchesInvaderCards(e.invaderCardsInVisibleSlot(ps.Ravage),K.Ravage))).pickOne((async a=>{await a.damageOnlyThis(1,e.Invader)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with invaders matching a Ravage Card.`})),{board:a})))},{effects:[{textArea:[.525,.604],text:"Invaders each do -1 Damage per Damage they have taken.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.DistractedByLocalTroublesII,[r.GlobalReminder]:()=>({icon:"Reduce<br><damage>"}),[r.AdjustDamage]:({piece:e})=>e.isInvader?-e.damage:0})}},{textArea:[.562,.688],text:"On Each Board, in a land matching a Ravage Card: 1 Damage each to up to 2 Invaders",[r.Now]:({$:e})=>e.onEachBoard((a=>e.doFearAction((()=>a.inLandsWhere((a=>a.hasInvaders&&a.matchesInvaderCards(e.invaderCardsInVisibleSlot(ps.Ravage),K.Ravage))).pickOne((async a=>{await a.piecesWhere((e=>e.isInvader)).pickMultiple({amount:2,forPickedItem:async a=>{await a.damageOnlyThis(1,e.Invader)},optional:!0})}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with invaders matching a Ravage Card.`})),{board:a})))}]},{effects:[{textArea:[.806,.888],text:"Invaders each do -1 Damage per Damage they have taken.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:pe.DistractedByLocalTroublesIII,[r.GlobalReminder]:()=>({icon:"Reduce<br><damage>"}),[r.AdjustDamage]:({piece:e})=>e.isInvader?-e.damage:0})}},{textArea:[.843,.963],text:"On Each Board, in two lands matching a Ravage Card: 2 Damage (per land).",[r.Now]:({$:e})=>e.onEachBoard((a=>e.doFearAction((()=>a.inLandsWhere((a=>a.hasInvaders&&a.matchesInvaderCards(e.invaderCardsInVisibleSlot(ps.Ravage),K.Ravage))).pickMultiple({amount:2,forPickedItem:async e=>{await e.damage(2)},effect:{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with invaders matching a Ravage Card.`}})),{board:a})))}]}]},sg=(e,a)=>({$:t})=>t.eachSpirit((n=>t.doFearAction((async()=>{let r=null;await t.forPiecesThatIs(t.ExplorerOrTown).where((e=>!e.location.matchesInvaderCards(t.invaderCardsInVisibleSlot(ps.Build),K.Build))).pickMultiple({amount:a,optional:!0,where:e=>null===r||e.location===r,forPickedItem:async a=>{r=a.location,e?await a.push():await a.remove()},effect:{players:[n],noOptions:"No land with <town>/<city> in a land not matching a Build Card."}})}),{spirit:n}))),og={name:"Restlessness",set:s.NatureIncarnate,levels:[{textArea:[.276,.362],text:"Each player Pushes up to 1 <explorer>/<town> form a land not matching a Build card.",[r.Now]:sg(!0,1)},{textArea:[.551,.635],text:"Each player Pushes up to 3 <explorer>/<town> from a land not matching a Build card.",[r.Now]:sg(!0,3)},{textArea:[.818,.913],text:"Each player Removes up to 3 <explorer>/<town> from a land not matching a Build card.",[r.Now]:sg(!1,3)}]},dg=(e,a)=>({$:t})=>t.onEachBoard((n=>t.doFearAction((()=>n.inLandsWhere((e=>e.hasAtLeast(2,t.Invader))).pickOne((async t=>{await t.gather({quantifier:w.UpTo,amount:e,pieces:a,single:!0})}),{prompt:"Pick a land to gather into.",noOptions:"No land with at least 2 Invaders."})),{board:n}))),cg={name:"Seek Company",set:s.NatureIncarnate,levels:[{textArea:[.279,.363],text:"On Each Board: Gather up to 1 <explorer> into a land with 2 or more Invaders.",[r.Now]:dg(1,Z.Explorer)},{textArea:[.537,.669],text:"On Each Board: Gather up to 3 <explorer>/<town> from a single land into a land with 2 or more Invaders.",[r.Now]:dg(3,Z.ExplorerOrTown)},{textArea:[.837,.927],text:"On Each Board: Gather up to 4 <explorer>/<town> (total) into lands with 2 or more Invaders.",[r.Now]:({$:e})=>e.onEachBoard((a=>e.doFearAction((async()=>{const t=[];await a.inLandsWhere((a=>a.hasAtLeast(2,e.Invader))).pickMultiple({amount:4,repeatSame:!0,optional:!0,forPickedItem:async a=>{t.push(...await a.gather({amount:1,pieceFilter:e=>!t.some((a=>a.piece===e)),pieces:e.ExplorerOrTown}))}})}),{board:a})))}]},lg={name:"Struggles Over Farmland",set:s.NatureIncarnate,levels:[{textArea:[.298,.339],text:"Each player Adds 1 <strife> in a land with <blight>.",[r.Now]:({$:e})=>e.eachSpirit((a=>e.doFearAction((()=>e.forPiecesThatIs(e.Invader,(a=>a.has(e.Blight))).pickOne((async e=>{await e.addStrife()}),{noOptions:"No Invaders in land with <blight>."})),{spirit:a})))},{textArea:[.554,.649],text:"Each player Adds 1 <strife> to a <town> or Adds 1 <strife> in a land with <blight>.",[r.Now]:({$:e})=>e.eachSpirit((a=>e.doFearAction((()=>e.forPiecesWhere((a=>a.isA(e.Town)||a.isInvader&&a.location.has(e.Blight))).pickOne((async e=>{await e.addStrife()}),{noOptions:"No <town> or Invaders in a land with <blight>."})),{spirit:a})))},{effects:[{textArea:[.823,.863],text:"Each player Adds 1 <strife>.",[r.Now]:({$:e})=>e.eachSpirit((a=>e.doFearAction((()=>e.forPiecesThatIs(e.Invader).pickOne((async e=>{await e.addStrife()}),{noOptions:"No Invaders."})),{spirit:a})))},{textArea:[.865,.949],text:"In each land with <strife>, 1 Invader with <strife> does Damage to other Invaders.",[r.Now]:({$:e})=>e.inLandsWithStrife().selectOrder().forEach((a=>e.doFearAction((async()=>{await a.piecesWithStrife().pickOne((e=>e.dealDamageToOtherInvaders()))}),{land:a})),{noOptions:"No Invader with <strife>"})}]}]},hg=(e,a)=>({$:t})=>t.onEachBoard((n=>t.doFearAction((()=>n.inLands().pickMultiple({amount:e,forPickedItem:async e=>{await e.isolate(),a&&e.has(t.TownOrCity)&&await e.skipInvaderAction({all:!0,filter:({invaderAction:e})=>e===K.Build})}})),{board:n}))),gg={name:"Supply Chains Abandoned",set:s.NatureIncarnate,levels:[{textArea:[.301,.342],text:"On Each Board: Isolate one land.",[r.Now]:hg(1,!1)},{textArea:[.54,.674],text:"On Each Board: Isolate one land.<br>If <town>/<city> are present, skip all Build Actions (in that land).",[r.Now]:hg(1,!0)},{textArea:[.796,.968],text:"On Each Board: Isolate two lands.<br>In Each of those lands, if <town>/<city> are present, skip all Build Actions (in that land).",[r.Now]:hg(2,!0)}]},fg=e=>({$:a})=>a.onEachBoard((t=>a.doFearAction((()=>t.inLandsWhere((e=>e.hasOneOf(a.Beasts,a.Dahan)||e.hasStrife)).pickOne((t=>e({$:a,land:t})),{noOptions:`On board: ${t.name}: No land with <beasts>/<strife>/<dahan>.`})),{board:t}))),ug=e=>fg((({$:a,land:t})=>a.chooseBetween({effects:[e?{actionId:"Downgrade",text:"Downgrade 1 <town>/<city> there.",[r.Now]:async()=>{await t.downgrade({pieces:a.TownOrCity})},condition:()=>t.has(a.TownOrCity)}:{actionId:"Remove",text:"Remove 1 <town>/<city> there.",[r.Now]:async()=>{await t.remove({pieces:a.TownOrCity})},condition:()=>t.has(a.TownOrCity)},{actionId:"SkipBuild",text:"Skip the next Build Action there.",[r.Now]:()=>t.skipInvaderAction({next:!0,filter:({invaderAction:e})=>e===K.Build})}]}))),pg={name:"Unsettled",set:s.NatureIncarnate,levels:[{textArea:[.278,.371],text:"On Each Board: Choose a land with <beasts>/<strife>/<dahan>. Downgrade 1 <town>/<city> there.",[r.Now]:fg((({$:e,land:a})=>a.downgrade({pieces:e.TownOrCity})))},{textArea:[.534,.669],text:"On Each Board: Choose a land with <beasts>/<strife>/<dahan>. Downgrade 1 <town>/<city> there or skip the next Build Action there (this turn).",[r.Now]:ug(!0)},{textArea:[.826,.955],text:"On Each Board: Choose a land with <beasts>/<strife>/<dahan>. Remove 1 Invader there or skip the next Build Action there (this turn).",[r.Now]:ug(!1)}]};var wg;!function(e){e.AngryMobs="AngryMobs",e.AvoidTheDahan="AvoidTheDahan",e.BeliefTakesRoot="BeliefTakesRoot",e.BesetByManyTroubles="BesetByManyTroubles",e.CivilUnrest="CivilUnrest",e.CommunitiesInDisarray="CommunitiesInDisarray",e.DahanAttack="DahanAttack",e.DahanEnheartened="DahanEnheartened",e.DahanGainTheEdge="DahanGainTheEdge",e.DahanOnTheirGuard="DahanOnTheirGuard",e.DahanRaid="DahanRaid",e.DahanReclaimFishingGrounds="DahanReclaimFishingGrounds",e.DahanThreaten="DahanThreaten",e.DauntedByTheDahan="DauntedByTheDahan",e.Demoralized="Demoralized",e.DepartTheDangerousLand="DepartTheDangerousLand",e.Depopulation="Depopulation",e.Discord="Discord",e.DistractedByLocalTroubles="DistractedByLocalTroubles",e.EmigrationAccelerates="EmigrationAccelerates",e.ExplorersAreReluctant="ExplorersAreReluctant",e.FearOfTheUnseen="FearOfTheUnseen",e.FleeFromDangerousLands="FleeFromDangerousLands",e.FleeThePestilentLand="FleeThePestilentLand",e.ImmigrationSlows="ImmigrationSlows",e.Isolation="Isolation",e.MimicTheDahan="MimicTheDahan",e.NervesFray="NervesFray",e.OverseasTradeSeemSafer="OverseasTradeSeemSafer",e.Panic="Panic",e.PanickedByWildBeasts="PanickedByWildBeasts",e.PlanForDeparture="PlanForDeparture",e.Restlessness="Restlessness",e.Quarantine="Quarantine",e.Retreat="Retreat",e.Scapegoats="Scapegoats",e.SeekCompany="SeekCompany",e.SeekSafety="SeekSafety",e.SenseOfDread="SenseOfDread",e.SpreadingTimidity="SpreadingTimidity",e.StrugglesOverFarmland="StrugglesOverFarmland",e.SupplyChainsAbandoned="SupplyChainsAbandoned",e.TallTalesOfSavagery="TallTalesOfSavagery",e.TheologicalStrife="TheologicalStrife",e.TooManyMonsters="TooManyMonsters",e.TradeSuffers="TradeSuffers",e.TreadCarefully="TreadCarefully",e.Unrest="Unrest",e.Unsettled="Unsettled",e.WaryOfTheInterior="WaryOfTheInterior"}(wg||(wg={}));const yg={[wg.AngryMobs]:Wh,[wg.AvoidTheDahan]:dh,[wg.BeliefTakesRoot]:ch,[wg.BesetByManyTroubles]:jh,[wg.CivilUnrest]:_h,[wg.CommunitiesInDisarray]:Mh,[wg.DahanAttack]:bh,[wg.DahanEnheartened]:lh,[wg.DahanGainTheEdge]:eg,[wg.DahanOnTheirGuard]:hh,[wg.DahanRaid]:gh,[wg.DahanReclaimFishingGrounds]:Jh,[wg.DahanThreaten]:Eh,[wg.DauntedByTheDahan]:rg,[wg.Demoralized]:Ph,[wg.DepartTheDangerousLand]:Sh,[wg.Depopulation]:Gh,[wg.Discord]:Hh,[wg.DistractedByLocalTroubles]:ig,[wg.EmigrationAccelerates]:fh,[wg.ExplorersAreReluctant]:Oh,[wg.FearOfTheUnseen]:uh,[wg.FleeFromDangerousLands]:Vh,[wg.FleeThePestilentLand]:Ch,[wg.ImmigrationSlows]:Dh,[wg.Isolation]:ph,[wg.MimicTheDahan]:Uh,[wg.NervesFray]:Yh,[wg.OverseasTradeSeemSafer]:wh,[wg.Panic]:Bh,[wg.PanickedByWildBeasts]:kh,[wg.PlanForDeparture]:Lh,[wg.Quarantine]:Fh,[wg.Retreat]:yh,[wg.Restlessness]:og,[wg.Scapegoats]:mh,[wg.SeekCompany]:cg,[wg.SeekSafety]:vh,[wg.SenseOfDread]:zh,[wg.SpreadingTimidity]:qh,[wg.StrugglesOverFarmland]:lg,[wg.SupplyChainsAbandoned]:gg,[wg.TallTalesOfSavagery]:Ih,[wg.TheologicalStrife]:Qh,[wg.TooManyMonsters]:Rh,[wg.TradeSuffers]:Ah,[wg.TreadCarefully]:Nh,[wg.Unrest]:$h,[wg.Unsettled]:pg,[wg.WaryOfTheInterior]:xh};var mg;!function(e){e.CoastalLands="CoastalLands",e.SaltDeposits="SaltDeposits",e.Stage1Card="Stage1Card",e.Stage2CardIncludingCoastal="Stage2CardIncludingCoastal",e.Stage2CardExceptCoastalAndSaltDeposits="Stage2CardExceptCoastalAndSaltDeposits",e.Stage3Card="Stage3Card",e.WaveOfImmigration="WaveOfImmigration"}(mg||(mg={}));const vg={[mg.Stage1Card]:{cards:[Xt.Jungles,Xt.Mountains,Xt.Sands,Xt.Wetlands],stage:1},[mg.Stage2CardIncludingCoastal]:{cards:[Xt.JunglesEscalation,Xt.MountainsEscalation,Xt.SandsEscalation,Xt.WetlandsEscalation,Xt.CoastalLands],stage:2},[mg.Stage2CardExceptCoastalAndSaltDeposits]:{cards:[Xt.JunglesEscalation,Xt.MountainsEscalation,Xt.SandsEscalation,Xt.WetlandsEscalation],stage:2},[mg.CoastalLands]:{cards:[Xt.CoastalLands],stage:2},[mg.SaltDeposits]:{cards:[Xt.SaltDeposits],stage:2},[mg.Stage3Card]:{cards:[Xt.JunglesAndSands,Xt.JunglesAndWetlands,Xt.MountainsAndJungles,Xt.MountainsAndWetlands,Xt.SandsAndMountains,Xt.SandsAndWetlands],stage:3},[mg.WaveOfImmigration]:{cards:[Xt.WaveOfImmigration],stage:2}};var Ig=function(e,a,t,n){var r,i=arguments.length,s=i<3?a:null===n?n=Object.getOwnPropertyDescriptor(a,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,a,t,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(i<3?r(s):i>3?r(a,t,s):r(a,t))||s);return i>3&&s&&Object.defineProperty(a,t,s),s};class Ag{fear=0;fearCardsDiscarded=[];fearCardsEarnedCount=0;fearCardsInDeck;fearCardsInLevelCount=[0,0,0];fearPool=0;hasResolvedFearCard=!1;invaderCardsInFearDeck=[];resolvingFearCard;terrorLevel=1;static allFearCards=Object.keys(yg);$;constructor(e){un.makeObservable(this),this.$=e;const{boards:a}=this.$.config,t=e.config.sets??vc,n=a.filter((e=>void 0!==e.spirit)).length;this.fearCardsInDeck=new mc(e,Ag.allFearCards.filter((a=>t.includes(yg[a].set)&&!e.bannedCards.includes(a)))),this.fearPool=(a.length>n?5:4)*n}get fearCardsEarned(){const e=[];for(let a=0;a<this.fearCardsEarnedCount;a+=1)e.push(this.fearCardsInDeck.cardAt(a));return e}get fearCardsInLevel(){return e=>{let a=this.fearCardsEarnedCount;for(let t=0;t<e;t+=1)a+=this.fearCardsInLevelCount[t];const t=[];for(let n=0;n<this.fearCardsInLevelCount[e];n+=1)t.push(this.fearCardsInDeck.cardAt(a+n));return t}}get preventTerrorLevelAndResolveFearCards(){return this.$.someEffect(r.PreventTerrorLevelAndResolveFearCards)}get unusedFearCardsLeft(){return this.fearCardsInDeck.count-Pd(this.fearCardsInLevelCount)+this.fearCardsEarnedCount}addFearCards(e){return{toLevel:async a=>{await te(e,(()=>{this.unusedFearCardsLeft>0&&(this.fearCardsInLevelCount[a-1]+=1,this.fearCardsInDeck.putBottomCardToTop())})),await this.moveInvaderCardsInFearDeck(e),await this.$.sendEvent({type:T.FearCardAdded,amount:e,level:a})}}}async addFearToPool(e){this.fearPool+=e,await this.$.sendEvent({type:T.FearAddedToPool,amount:e})}async discardEarnedFearCards(e){let a=e;for(;this.fearCardsEarnedCount>0&&a>0;){const e=await this.fearCardsInDeck.draw();await this.$.sendEvent({type:T.FearCardDiscarded,fearCard:e}),this.fearCardsDiscarded.push(e),this.fearCardsEarnedCount-=1,a-=1}}async discardTopFearCard(){let e=null;return this.terrorLevel<4&&(this.fearCardsInLevelCount[this.terrorLevel-1]-=1,e=await this.fearCardsInDeck.draw(this.fearCardsEarnedCount),await this.moveInvaderCardsInFearDeck(-1),this.fearCardsDiscarded.push(e),await this.$.doEffects(r.AfterFearDeckIsDecreasing),await this.updateTerrorLevel()),e}async earnFearCard(){this.terrorLevel<4&&this.fearCardsInLevelCount[this.terrorLevel-1]>0&&(this.fearCardsEarnedCount+=1,this.fearCardsInLevelCount[this.terrorLevel-1]-=1,await this.moveInvaderCardsInFearDeck(-1),await this.$.sendEvent({type:T.FearCardEarned}),await this.$.doEffects(r.AfterFearDeckIsDecreasing),await this.updateTerrorLevel())}async earnTerrorLevel(){this.terrorLevel+=1,await this.$.sendEvent({type:T.NewTerrorLevel,level:this.terrorLevel}),await this.$.doEffects(r.AfterReachingTerrorLevel,{terrorLevel:this.terrorLevel})}async generateFear(e){let a=e.amount;const{location:t,fromDestroyingBuildings:n}=e,i=()=>({amount:a,location:t,fromDestroyingBuildings:n});if(a>0)if(await this.$.oneEffectActivates(r.PreventFearGeneration,i()))a=0;else for(await this.$.waitForAnimationsToFinish(),this.fear+=a,await this.$.doEffects(r.AfterPowerGenerateFearInLand,e),await this.$.sendEvent({type:T.FearEarned,amount:a,location:t});this.fear>=this.fearPool;)this.fear-=this.fearPool,await this.earnFearCard();return i()}insertInvaderCardUnderFearCards(e,a){this.invaderCardsInFearDeck.push({card:e,position:a})}async loseFear(e){const a=Math.min(this.fear,e);this.fear-=a,a>0&&await this.$.sendEvent({type:T.FearLost,amount:a})}async pickAFaceDownFearCard(){const e=this.fearCardsEarnedCount+Pd(this.fearCardsInLevelCount),a=e>0?[...Array(e).keys()].filter((e=>null===this.fearCardsInDeck.cardAt(e))):[];if(a.length>0){const e=await this.$.query({query:tn.SelectFearCard,items:a,actionIds:a.map((e=>`FearCard-${e}`))});return a[e]}return await this.$.clickToContinue({noOptions:"No Fear Cards available"}),null}putAllFearCardsInDeckIntoLevel(e){this.fearCardsInLevelCount[e-1]+=this.unusedFearCardsLeft}putAllFearCardsIntoLevel(e){for(let a=0;a<3;a+=1)this.fearCardsInLevelCount[a]=a===e-1?this.fearCardsInDeck.count:0}async removeTopFearCard(){this.terrorLevel<4&&(this.fearCardsInLevelCount[this.terrorLevel-1]-=1,this.fearCardsInDeck.removeCard(0),await this.moveInvaderCardsInFearDeck(-1),await this.$.doEffects(r.AfterFearDeckIsDecreasing),await this.updateTerrorLevel())}async reshuffleFearDeck(){await this.$.sendEvent({type:T.GenericMain,text:"The Fear Deck was reshuffled from its discard."}),this.fearCardsInDeck=new mc(this.$,this.fearCardsDiscarded),this.fearCardsDiscarded=[]}async resolveFearCards(){for(;this.fearCardsEarnedCount>0&&!this.$.gameEnded&&this.$.randomEventsEnabled&&(!this.preventTerrorLevelAndResolveFearCards||this.$.phase!==Xe.Fear);)await this.resolveNextFearCard()}async resolveNextFearCard(e={}){const{extraTerrorLevel:a=0}=e;this.fearCardsEarnedCount-=1,this.hasResolvedFearCard=!0,this.resolvingFearCard=await this.fearCardsInDeck.draw(),void 0===this.resolvingFearCard&&(await this.reshuffleFearDeck(),this.resolvingFearCard=await this.fearCardsInDeck.draw()),await this.$.sendEvent({type:T.FearCardResolved,fearCard:this.resolvingFearCard,terrorLevel:this.terrorLevel}),await this.$.query({query:tn.ClickToContinueCard,items:[this.resolvingFearCard],actionIds:[this.resolvingFearCard]});const t=yg[this.resolvingFearCard],n=t.levels[Math.min(this.terrorLevel+a,3)-1];await this.$.addEffectUntilEndOfTurn({name:t.name,...n,card:this.resolvingFearCard}),this.fearCardsDiscarded.push(this.resolvingFearCard),this.resolvingFearCard=void 0}revealFearCard(e,a){let t=this.fearCardsEarnedCount;for(let a=0;a<e;a+=1)t+=this.fearCardsInLevelCount[a];return t+=a,this.revealFearCardInDeck(t)}revealFearCardInDeck(e){return this.fearCardsInDeck.reveal(e)}revealTopFearCard(){return this.revealFearCard(this.terrorLevel-1,0)}async setupFearDeck(){const e=[3,3,3].map(((e,a)=>e+nn([this.$.adversaryLeading,this.$.adversarySupporting],(e=>e?e.levelData.fearCards[a]-3:0))));await this.addFearCards(e[0]).toLevel(1),await this.addFearCards(e[1]).toLevel(2),await this.addFearCards(e[2]).toLevel(3)}timePasses(){return this.hasResolvedFearCard=!1,Promise.resolve()}toString(){return Ic({fear:this.fear,fearPool:this.fearPool,terrorLevel:this.terrorLevel,fearCardsDiscarded:dn(this.fearCardsDiscarded),fearCardsEarned:this.fearCardsEarnedCount,fearCardsInDeck:this.fearCardsInDeck.count,fearCardsInLevel:dn(this.fearCardsInLevelCount),invaderCardsInFearDeck:dn(this.invaderCardsInFearDeck,(e=>`${e.card} @ ${e.number}`))},2)}async moveInvaderCardsInFearDeck(e){if(this.invaderCardsInFearDeck.length>0&&(this.invaderCardsInFearDeck.forEach((a=>{a.position+=e})),0===this.invaderCardsInFearDeck[0].position)){const{card:e}=this.invaderCardsInFearDeck.shift(),a=vg[e].cards.filter((e=>!this.$.invaderDeckInSlot(ps.Deck).hasRevealed(e))),t=await this.$.drawFrom(a,a.map((e=>_t[e].text)));this.$.invaderDeckInSlot(ps.Deck).remove(t),this.$.invaderDeckInSlot(ps.Build).insertAtBottom(t)}}async updateTerrorLevel(){if(!this.preventTerrorLevelAndResolveFearCards)for(;this.terrorLevel<4&&0===this.fearCardsInLevelCount[this.terrorLevel-1];)await this.earnTerrorLevel()}}Ig([C.sH],Ag.prototype,"fear",void 0),Ig([C.sH],Ag.prototype,"fearCardsDiscarded",void 0),Ig([C.sH],Ag.prototype,"fearCardsEarnedCount",void 0),Ig([C.sH],Ag.prototype,"fearCardsInDeck",void 0),Ig([C.sH],Ag.prototype,"fearCardsInLevelCount",void 0),Ig([C.sH],Ag.prototype,"fearPool",void 0),Ig([C.sH],Ag.prototype,"hasResolvedFearCard",void 0),Ig([C.sH],Ag.prototype,"invaderCardsInFearDeck",void 0),Ig([C.sH],Ag.prototype,"resolvingFearCard",void 0),Ig([C.sH],Ag.prototype,"terrorLevel",void 0);var xg=function(e,a,t,n){var r,i=arguments.length,s=i<3?a:null===n?n=Object.getOwnPropertyDescriptor(a,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,a,t,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(i<3?r(s):i>3?r(a,t,s):r(a,t))||s);return i>3&&s&&Object.defineProperty(a,t,s),s};class bg{invaderCardsInSlot;$;escalatedInvaderCards=[];invaderCardIsSpecial=[];constructor(e){un.makeObservable(this),this.$=e,this.invaderCardsInSlot={[ps.Discard]:new mc(e),[ps.HighImmigration]:new mc(e),[ps.Ravage]:new mc(e),[ps.Build]:new mc(e),[ps.Explore]:new mc(e),[ps.Deck]:new mc(e)}}get actualExploreCardIndex(){return e=>{let a=-1;for(let t=0;t<this.exploreDeck.count;t+=1){if(this.exploreDeck.cardAt(t)!==Xt.WaveOfImmigration&&(a+=1,a===e))return t}return 0}}get exploreDeck(){return this.invaderCardsInSlot[ps.Deck]}get invaderCardAtIndexIsSpecial(){return e=>this.invaderCardIsSpecial[e]}get invaderCardsInExploreDeck(){return this.exploreDeck.cards}get invaderCardsVisible(){return[...this.invaderCardsInSlot[ps.HighImmigration].cards,...this.invaderCardsInSlot[ps.Ravage].cards,...this.invaderCardsInSlot[ps.Build].cards]}get lowestStageNumber(){return Math.min(...this.stageNumbers.filter((e=>e>0)))}get numberOfExploreCardsThisTurn(){return 1+this.$.sumEffects(r.AdjustNumberOfExploreCards)}get showingTerrainTypes(){const e=[];return this.invaderCardsVisible.forEach((a=>{_t[a].terrains.forEach((a=>{e.includes(a)||e.push(a)}))})),e}get stage(){return this.stageNumbers.length>0?3===this.stageNumbers[0]&&this.invaderCardIsSpecial[0]?2:this.stageNumbers[0]>0?this.stageNumbers[0]:this.stageNumbers[1]:3}get stageNumbers(){return this.stageNumbersInSlot(ps.Deck)}get stageNumbersInSlot(){return e=>this.invaderCardsInSlot[e].possibleCards.map((e=>_t[e[0]].stage))}get unusedInvaderCardOfStage(){return e=>Object.keys(_t).filter((a=>_t[a].stage===e&&!Object.values(this.invaderCardsInSlot).some((e=>e.includes(a)))))}async accelerateTheInvaderDeck(){const e=this.lowestStageNumber,a=this.stageNumbers.findIndex((a=>a===e));if(-1===a)return null;const t=await this.exploreDeck.reveal(a);return await this.removeCardFromExploreDeck(a),null!==t&&this.invaderCardsInSlot[ps.Discard].insert(t),t}async addExploreCardToTop(e,a=0){this.exploreDeck.insertOneOf(e,a),this.invaderCardIsSpecial.splice(a,0,!1),await this.$.doEffects(r.AfterChangingInvaderDeck)}advanceCardsIn(e){return{to:async a=>{for(;!this.invaderCardsInSlot[e].isEmpty;)this.invaderCardsInSlot[a].insertAtBottom(await this.invaderCardsInSlot[e].draw())}}}async advanceInvaderCards(){await this.$.doEffects(r.BeforeAdvancingCards),await this.advanceCardsIn(ps.Ravage).to(ps.Discard),await this.advanceCardsIn(ps.Build).to(ps.Ravage),await this.advanceCardsIn(ps.Explore).to(ps.Build),await this.$.doEffects(r.AfterAdvancingCards),await this.$.doEffects(r.AfterChangingInvaderDeck);for(const e of this.$.invaderCardsInVisibleSlot(ps.Build))await this.escalate(e,{afterAdvancingCards:!0})}async drawNextExploreCard(){if(this.exploreDeck.isEmpty)return this.$.loseGame(kd.RanOutOfInvaderCards),null;{const e=await this.exploreDeck.draw();return ae(this.escalatedInvaderCards,e),this.invaderCardIsSpecial.shift(),this.invaderCardsInSlot[ps.Explore].insertAtBottom(e),await this.$.sendEvent({type:T.InvadersExplore,invaderCard:e}),await this.$.doEffects(r.AfterChangingInvaderDeck),e}}async escalate(e,a={}){const{afterAdvancingCards:t=!1,afterExplore:n=!1,afterExploringLand:i,beforeBuilding:s=!1,beforeExplore:o=!1}=a;if(!this.escalatedInvaderCards.includes(e)){const a=_t[e];if(a.escalation&&null!==this.$.adversaryLeading||3===a.stage&&null!==this.$.adversarySupporting){if(await this.$.oneEffectActivates(r.PreventEscalation,{card:e,normal:!0}))this.escalatedInvaderCards.push(e);else{const d=a.escalation?this.$.adversaryLeading.adversary:this.$.adversarySupporting.adversary;await this.$.oneEffectActivates(r.Escalation,{card:e,adversary:d,afterAdvancingCards:t,afterExplore:n,afterExploringLand:i,beforeBuilding:s,beforeExplore:o})&&this.escalatedInvaderCards.push(e)}}}}insertInvaderCard(e,a={}){const{isSpecial:t=!1}=a;return{justBelowCards:async a=>{this.exploreDeck.insertOneOf([...vg[e].cards],a),this.invaderCardIsSpecial.splice(a,0,t),await this.$.sendEvent({type:T.InvaderCardAdded,amount:1,invaderCardType:e})},insteadOfNthCardOfStage:async(a,t)=>{let n=0;for(let r=0;r<this.stageNumbers.length;r+=1)if(this.stageNumbers[r]===t&&(n+=1,n===a)){await this.removeCardFromExploreDeck(r),this.exploreDeck.insertOneOf([...vg[e].cards],r),await this.$.sendEvent({type:T.InvaderCardAdded,amount:1,invaderCardType:e});break}},justBelowBottomMostOfStage:async a=>{const n=mn(this.stageNumbers,(e=>e===a));this.exploreDeck.insertOneOf([...vg[e].cards],n+1),this.invaderCardIsSpecial.splice(n+1,0,t),await this.$.sendEvent({type:T.InvaderCardAdded,amount:1,invaderCardType:e})},justBelowNthCardOfStage:async(a,n)=>{let r=0;for(let i=0;i<this.stageNumbers.length;i+=1)if(this.stageNumbers[i]===n&&(r+=1,r===a)){this.exploreDeck.insertOneOf([...vg[e].cards],i+1),this.invaderCardIsSpecial.splice(i+1,0,t),await this.$.sendEvent({type:T.InvaderCardAdded,amount:1,invaderCardType:e});break}}}}async moveNthCardOfStageUpByOne(e,a){let t=0;for(let n=0;n<this.stageNumbers.length;n+=1)if(this.stageNumbers[n]===a&&(t+=1,t===e)){const e=await this.removeCardFromExploreDeck(n);this.invaderCardIsSpecial.splice(n,1),this.exploreDeck.insertOneOf(e,n-1),this.invaderCardIsSpecial.splice(n-1,0,!1);break}}nthCardOfStage(e,a){let t=0;for(let n=0;n<this.stageNumbers.length;n+=1)if(this.stageNumbers[n]===a&&(t+=1,t===e))return this.exploreDeck.possibleCardsAt(n);return[]}async putTopInvaderCardToBottom(){if(!this.exploreDeck.isEmpty){const e=await this.removeCardFromExploreDeck(0);this.invaderCardIsSpecial.shift(),this.exploreDeck.insertOneOf(e,this.exploreDeck.count),this.invaderCardIsSpecial.push(!1),await this.$.doEffects(r.AfterChangingInvaderDeck)}}async removeBottomMostInvaderCardOfStage(e){const a=mn(this.stageNumbers,(a=>a===e));await this.removeCardFromExploreDeck(a)}async removeCardFromExploreDeck(e,a={}){const{allCards:t=!1,swapping:n=!1}=a;if(e<0||e>=this.exploreDeck.count)return;const i=t?e:this.actualExploreCardIndex(e);this.invaderCardIsSpecial.splice(i,1);const s=this.stageNumbers[i],o=this.exploreDeck.removeCard(i);return void 0!==o&&(s>0&&await this.$.sendEvent({type:T.InvaderCardRemoved,amount:1,stage:s}),n||await this.$.doEffects(r.AfterChangingInvaderDeck)),o}async removeTopMostInvaderCardOfStage(e){const a=this.stageNumbers.findIndex((a=>a===e));await this.removeCardFromExploreDeck(a,{allCards:0===e})}async removeTopNonSpecialExploreCard(){const e=this.invaderCardIsSpecial.findIndex((e=>!1===e));await this.removeCardFromExploreDeck(e)}async revealTopInvaderCard(){const e=await this.exploreDeck.reveal(0);return null!==e&&await this.$.clickToContinue({card:e,text:`The top Invader Card is ${_t[e].text}.`}),e}async setupInvaderDeck(){await this.addInvaderCards(3).ofType(mg.Stage1Card),await this.addInvaderCards(4).ofType(mg.Stage2CardIncludingCoastal),await this.addInvaderCards(5).ofType(mg.Stage3Card)}async shuffleTopTwoInvaderCards(){if(this.exploreDeck.count>=2){const e=this.actualExploreCardIndex(0),a=this.actualExploreCardIndex(1);if(e>=this.stageNumbers.length||a>=this.stageNumbers.length)return;const t=this.stageNumbers[e],n=this.stageNumbers[e]===this.stageNumbers[a];await this.exploreDeck.shuffleTopNCards([e,a],n),n?(this.invaderCardIsSpecial[e]=!1,this.invaderCardIsSpecial[a]=!1):t!==this.stageNumbers[e]&&([this.invaderCardIsSpecial[e],this.invaderCardIsSpecial[a]]=[this.invaderCardIsSpecial[a],this.invaderCardIsSpecial[e]]),await this.$.doEffects(r.AfterChangingInvaderDeck)}}toString(){return Ic({invaderCardsInBuildStep:dn(this.invaderCardsInSlot[ps.Build].cards),invaderCardsInDiscard:dn(this.invaderCardsInSlot[ps.Discard].cards),invaderCardsInExploreDeck:dn(this.invaderCardsInSlot[ps.Deck].cards),invaderCardsInExploreStep:dn(this.invaderCardsInSlot[ps.Explore].cards),invaderCardsInHighImmigrationStep:dn(this.invaderCardsInSlot[ps.HighImmigration].cards),invaderCardsInRavageStep:dn(this.invaderCardsInSlot[ps.Ravage].cards)},2)}addInvaderCards(e){return{ofType:async a=>{await te(e,(()=>{this.exploreDeck.insertAtBottomOneOf([...vg[a].cards]),this.invaderCardIsSpecial.push(!1)})),await this.$.sendEvent({type:T.InvaderCardAdded,amount:e,invaderCardType:a})}}}}xg([C.sH],bg.prototype,"invaderCardsInSlot",void 0);var Tg,Eg=function(e,a,t,n){var r,i=arguments.length,s=i<3?a:null===n?n=Object.getOwnPropertyDescriptor(a,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,a,t,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(i<3?r(s):i>3?r(a,t,s):r(a,t))||s);return i>3&&s&&Object.defineProperty(a,t,s),s};class Pg{powercardsInMajorDeck;powercardsInMajorDiscard=[];powercardsInMinorDeck;powercardsInMinorDiscard=[];static allMajorPowers=Object.keys(bd).filter((e=>bd[e].type===o.Major));static allMinorPowers=Object.keys(bd).filter((e=>bd[e].type===o.Minor));$;constructor(e){un.makeObservable(this),this.$=e;const a=e.config.sets??vc;this.powercardsInMinorDeck=new mc(e,Pg.allMinorPowers.filter((t=>a.includes(bd[t].set)&&!e.bannedCards.includes(t)))),this.powercardsInMajorDeck=new mc(e,a.length===vc.length?Pg.allMajorPowers:Pg.allMajorPowers.filter((e=>a.includes(bd[e].set))))}discardPower(e){switch(bd[e].type){case o.Major:this.powercardsInMajorDiscard.includes(e)||this.powercardsInMajorDiscard.push(e);break;case o.Minor:this.powercardsInMinorDiscard.includes(e)||this.powercardsInMinorDiscard.push(e)}return Promise.resolve()}async drawAndDiscardPower(e){const a=await this.drawPower(e);return null!=a&&await this.discardPower(a),a}async drawPower(e,a={}){const{silent:t}=a;if(e===o.Minor){let e=await this.powercardsInMinorDeck.draw();return void 0===e&&(await this.$.sendEvent({type:T.GenericMain,text:"The Minor Deck was reshuffled from its discard."}),this.powercardsInMinorDeck=new mc(this.$,this.powercardsInMinorDiscard),this.powercardsInMinorDiscard=[],e=await this.powercardsInMinorDeck.draw()),void 0===e||t||await this.$.sendEvent({type:T.PowerCardDrawn,powerType:e}),e}if(e===o.Major){let e=await this.powercardsInMajorDeck.draw();return void 0===e&&(await this.$.sendEvent({type:T.GenericMain,text:"The Major Deck was reshuffled from its discard."}),this.powercardsInMajorDeck=new mc(this.$,this.powercardsInMajorDiscard),this.powercardsInMajorDiscard=[],e=await this.powercardsInMajorDeck.draw()),void 0===e||t||await this.$.sendEvent({type:T.PowerCardDrawn,powerType:e}),e}}removePowerCardFromDecks(e){this.powercardsInMinorDeck.remove(e),this.powercardsInMajorDeck.remove(e)}toString(){return Ic({powercardsInMajorDeck:this.powercardsInMajorDeck.count,powercardsInMajorDiscard:dn(this.powercardsInMajorDiscard),powercardsInMinorDeck:this.powercardsInMinorDeck.count,powercardsInMinorDiscard:dn(this.powercardsInMinorDiscard)},2)}}Eg([C.sH],Pg.prototype,"powercardsInMajorDeck",void 0),Eg([C.sH],Pg.prototype,"powercardsInMajorDiscard",void 0),Eg([C.sH],Pg.prototype,"powercardsInMinorDeck",void 0),Eg([C.sH],Pg.prototype,"powercardsInMinorDiscard",void 0),function(e){e.TerrorLevelOne="TerrorLevelOne",e.TerrorLevelTwo="TerrorLevelTwo",e.TerrorLevelThree="TerrorLevelThree",e.FearVictory="FearVictory",e.DahanInsurrectionLevelTwo="DahanInsurrectionLevelTwo",e.DahanInsurrectionLevelThree="DahanInsurrectionLevelThree",e.WardTheShores="WardTheShores"}(Tg||(Tg={}));var Sg=function(e,a,t,n){var r,i=arguments.length,s=i<3?a:null===n?n=Object.getOwnPropertyDescriptor(a,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,a,t,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(i<3?r(s):i>3?r(a,t,s):r(a,t))||s);return i>3&&s&&Object.defineProperty(a,t,s),s};const Og=Object.freeze(new Set(["expireAtEndOfTurn","expireAtEndOfTimePasses","expireAtEndOfAction","expireAtEndOfActionTree"]));class Cg{effects=[];sortedEffects={expireAtEndOfTurn:[],expireAtEndOfTimePasses:[],expireAtEndOfAction:[],expireAtEndOfActionTree:[]};static effectsWithPriority=[r.AdjustNumberOfExploreCards,r.AfterMoving,r.AlterInvaderActionInLand,r.AfterTheNormalExploreStep];$;stack=[];nextId=0;constructor(e){un.makeObservable(this),this.$=e}get currentStackEffect(){return this.stack.length>0?this.stack[this.stack.length-1]:void 0}get effectIds(){const e=[];for(const a of this.effects)a.effectId&&!e.includes(a.effectId)&&e.push(a.effectId);return e}get globalReminderEffects(){return this.effectsOfType(r.GlobalReminder)}get hasLostFromEffect(){return this.resultFromFirstEffectOfType(r.LossCondition)??null}get hasWonFromEffect(){return this.resultFromFirstEffectOfType(r.WinCondition)??null}get parentEffect(){return this.stack.length>1?this.stack[this.stack.length-2]:void 0}get reminderEffects(){return[...this.effectsOfType(r.Reminder),...this.effectsOfType(r.DefendFromGame).filter((e=>void 0===e[r.Reminder])),...this.effectsOfType(r.DefendFromSpirits).filter((e=>void 0===e[r.Reminder]&&void 0===e[r.DefendFromGame]))]}static enhanceParentEffectWithChild(e,a){return{name:e?.name,text:e?.text,prompt:e?.prompt,cancel:e?.cancel,card:e?.card,players:e?.players,spirit:e?.spirit,textArea:e?.textArea,scenario:e?.scenario,adversary:e?.adversary,adversaryLevel:e?.adversaryLevel,highlightBoards:e?.highlightBoards,highlightPieces:e?.highlightPieces,highlightLocations:e?.highlightLocations,highlightCorners:e?.highlightCorners,highlightPowers:e?.highlightPowers,...a}}async addEffect(e){if(e.effects){const{effects:a,...t}=e;for(const e of a)await this.addEffect({...t,...e})}else e[r.Now]?await this.doEffectWithContext(e,r.Now):this.addAndSortEffect(e)}async addEffectUntilEndOfAction(e){await this.addEffect({...e,expireAtEndOfAction:this.$.action})}async addEffectUntilEndOfActionTree(e){await this.addEffect({...e,expireAtEndOfActionTree:this.$.action})}async addEffectUntilEndOfTurn(e){await this.addEffect({...e,expireAtEndOfTurn:!0})}async addSubEffect(e){const a=this.enhanceEffectWithCurrentEffect(e);if(e.effects)for(const t of e.effects)await this.addSubEffect(Cg.enhanceParentEffectWithChild(a,t));else e[r.Now]?await this.doEffectWithContext(a,r.Now):this.addAndSortEffect(a);return a}addSubEffectUntilEndOfAction(e){return this.addSubEffect({...e,expireAtEndOfAction:this.$.action})}addSubEffectUntilEndOfTimePasses(e){return this.addSubEffect({...e,expireAtEndOfTimePasses:!0})}addSubEffectUntilEndOfTurn(e){return this.addSubEffect({...e,expireAtEndOfTurn:!0})}async doEffect(e,a,t){this.stack.push(e),await(e[a]?.(t)),this.stack.pop(),(e[r.InTargetLand]||e[r.TargetSpirit])&&this.removeEffect(e)}async doEffectWithContext(e,a,t){this.stack.push(e),await(e[a]?.({$:this.$,effect:e,you:e.spirit,action:this.$.action,...t})),this.stack.pop(),(e[r.InTargetLand]||e[r.TargetSpirit])&&this.removeEffect(e)}async doEffects(e,a,t){for(const n of this.effectsOfType(e).slice())(void 0===t||t(n))&&await this.doEffect(n,e,a)}async doEffectsWithContext(e,a,t){for(const n of this.effectsOfType(e).slice())(void 0===t||t(n))&&await this.doEffectWithContext(n,e,a)}async doEffectsWithPriority(e,a){const t=this.effectsOfType(e).slice();if(Cg.effectsWithPriority.includes(e))for(const n of t)n.highPriority&&n[e]&&await this.doEffect(n,e,a);for(const n of t)!n.highPriority&&n[e]&&await this.doEffect(n,e,a)}effectsMappedWithFilter(e,a){return this.effectsOfType(e).reduce(((t,n)=>{const r=n[e]?.(a);return r&&t.push(r),t}),[])}effectsOfType(e){return this.sortedEffects[e]??[]}enhanceEffectWithCurrentEffect(e){return void 0!==this.currentStackEffect?Cg.enhanceParentEffectWithChild(this.currentStackEffect,e):e}existEffect(e){return this.effectsOfType(e).length>0}firstEffectOfType(e,a){for(const t of this.effectsOfType(e)){const n=t[e]?.(a);if(n)return t}}hasEffectNamed(e){return this.effects.some((a=>a.name===e&&a.id!==this.currentStackEffect?.id))}async oneEffectActivates(e,a){const t=this.effectsOfType(e),n=Cg.effectsWithPriority.includes(e)?[!0,void 0]:[void 0],r=this.$.action;for(const i of n)for(const n of t)if(n.highPriority===i){const t=n[e];if(void 0!==t){this.stack.push(n);const e=await t({$:this.$,effect:n,you:n.spirit,action:r,...a});if(this.stack.pop(),!0===e)return!0}}return!1}removeCurrentEffect(){this.removeEffect(this.currentStackEffect)}removeEffect(e){ae(this.effects,(a=>a.id===e.id));for(const a of Object.keys(e))if("function"==typeof e[a]||Og.has(a)){const t=this.sortedEffects[a];void 0!==t&&ae(t,(a=>a.id===e.id))}void 0!==e[r.Elements]&&this.$.spirits.forEach((e=>{e.invalidateEffectElementCache()}))}removeEffectsWithId(e){for(const a of this.effects.slice())a.effectId===e&&this.removeEffect(a)}removeEffectsWithName(e){for(const a of this.effects.slice())a.name===e&&this.removeEffect(a)}resultFromFirstEffectOfType(e,a){for(const t of this.effectsOfType(e)){const n=t[e];if(n){const e=n(a);if(void 0!==e)return e}}}async runEndOfActionEffects(e){if(this.sortedEffects.expireAtEndOfAction.length>0){const a=[],t=this.sortedEffects.expireAtEndOfAction.slice();for(const n of t)n.expireAtEndOfAction===e&&t.some((e=>e.id===n.id))&&(this.$.removeEffect(n),a.push(n));for(const e of a)await this.doEffect(e,r.ActionEnds)}await this.doEffects(r.AnyActionEnds)}async runEndOfActionTreeEffects(e){if(this.sortedEffects.expireAtEndOfActionTree.length>0){const a=[],t=this.sortedEffects.expireAtEndOfActionTree.slice();for(const n of t)n.expireAtEndOfActionTree===e&&t.some((e=>e.id===n.id))&&(this.$.removeEffect(n),a.push(n));for(const e of a)await this.doEffect(e,r.ActionEnds)}}someEffect(e,a){return this.sortedEffects[e]?.some((t=>t[e](a)))??!1}sumEffects(e,a){const t=this.sortedEffects[e];if(!t)return 0;let n=0;for(const r of t)n+=r[e]?.(a)??0;return n}async timePasses(){for(const e of this.sortedEffects.expireAtEndOfTurn.slice())e.expireAtEndOfTurn&&this.removeEffect(e);await this.doEffects(r.TimePasses)}timePassesLateExpiration(){for(const e of this.sortedEffects.expireAtEndOfTimePasses.slice())e.expireAtEndOfTimePasses&&this.removeEffect(e);return Promise.resolve()}addAndSortEffect(e){e.id=this.nextId,this.nextId+=1,this.effects.push(e);for(const a of Object.keys(e))("function"==typeof e[a]||Og.has(a))&&(this.sortedEffects[a]||(this.sortedEffects[a]=[]),this.sortedEffects[a].push(e))}}Sg([C.sH],Cg.prototype,"sortedEffects",void 0);var Dg=function(e,a,t,n){var r,i=arguments.length,s=i<3?a:null===n?n=Object.getOwnPropertyDescriptor(a,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,a,t,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(i<3?r(s):i>3?r(a,t,s):r(a,t))||s);return i>3&&s&&Object.defineProperty(a,t,s),s};class Bg{currentAction={type:en.GameAction,triggers:[],data:{},parentData:{},blackList:[],dontCountAs:new Set};$;actionStack=[this.currentAction];isDoublingActions=!1;triggerId=0;constructor(e){un.makeObservable(this),this.$=e}get currentActionType(){return this.currentAction.type}get currentTriggers(){return this.currentAction.triggers}get hasRunningAction(){return this.actionStack.length>1}async addTrigger(e,a,t,n={}){const{movingAction:r,priority:i}=n;this.currentTriggers.some((a=>a.childEffect.triggerId===e.triggerId))||this.currentAction.blackList.some((a=>a.triggerId===e.triggerId))?this.currentAction.blackList.some((a=>a.triggerId===e.triggerId))&&await this.$.sendEvent({type:T.GenericSub,text:`${a.name} is not triggered because it cannot trigger itself.`}):i?this.currentTriggers.unshift({childEffect:e,parentEffect:a,parentAction:t,movingAction:r}):this.currentTriggers.push({childEffect:e,parentEffect:a,parentAction:t,movingAction:r})}checkIfEnded(){if(this.$.phase===Xe.Setup||this.$.phase===Xe.SetupPresence)return!1;const e=this.combinedLostReason;e&&this.$.loseGame(e);const a=this.combinedWinReason;return a&&this.$.winGame(a),this.$.gameEnded}async doAction(e,a,t={}){const{spirit:n,power:i,data:s,parentData:o,blackList:d,land:c,board:l}=t,h=this.numberOfActions(c,l);h>1&&(this.isDoublingActions=!0);for(let t=0;t<h;t+=1)if(!this.$.gameEnded){const t=d??this.currentAction.blackList;this.currentAction={type:e,spirit:n,power:i,triggers:[],data:s??{},parentData:o??{},blackList:t,dontCountAs:new Set},this.actionStack.push(this.currentAction),await this.$.doEffects(r.AnyActionStarts),await a(),await this.$.runEndOfActionEffects(this.currentAction);for(const e of this.currentTriggers){const{childEffect:a,parentEffect:n,movingAction:r}=e;this.currentAction.data.movingAction=r;const i=Cg.enhanceParentEffectWithChild(n,a);await this.doAction(e.parentAction.type,(()=>this.$.addEffect(i)),{spirit:e.parentAction.spirit,power:e.parentAction.power,parentData:this.currentAction.data,blackList:[...t,a]})}const c=this.actionStack.pop();this.currentAction=this.actionStack.slice(-1)[0],1===this.actionStack.length&&(await this.checkForInvalidPieces(),this.checkIfEnded()),await this.$.runEndOfActionTreeEffects(c)}h>1&&(this.isDoublingActions=!1)}nextTriggerId(){const e=this.triggerId;return this.triggerId+=1,e}get combinedLostReason(){return this.$.hasLostFromEffect?this.$.hasLostFromEffect:this.someSpiritLacksPresence?kd.RanOutOfPresence:this.ranOutOfBlight?kd.RanOutOfBlight:null}get combinedWinReason(){return this.$.hasWonFromEffect?this.$.hasWonFromEffect:1!==this.$.terrorLevel||this.$.fearBasedVictoryIsRemoved||0!==(this.$.pieceCount[p.Explorer]||0)||0!==(this.$.pieceCount[p.Town]||0)||0!==(this.$.pieceCount[p.City]||0)?2!==this.$.terrorLevel||this.$.fearBasedVictoryIsRemoved||0!==(this.$.pieceCount[p.Town]||0)||0!==(this.$.pieceCount[p.City]||0)?3!==this.$.terrorLevel||this.$.fearBasedVictoryIsRemoved||0!==(this.$.pieceCount[p.City]||0)?4!==this.$.terrorLevel||this.$.fearBasedVictoryIsRemoved?null:Tg.FearVictory:Tg.TerrorLevelThree:Tg.TerrorLevelTwo:Tg.TerrorLevelOne}get numberOfActions(){return(e,a)=>{let t=1;const n={land:e,board:a};return this.isDoublingActions||(t+=this.$.sumEffects(r.AdjustNumberOfActions,n)),t}}get ranOutOfBlight(){return(this.$.blightStatus===Td.BlightedIsland||!this.$.config.blightCards)&&0===this.$.blightOnBlightCard}get someSpiritLacksPresence(){return this.$.spirits.some((e=>0===e.landsIncludingNonExisting.length))}async checkForInvalidPieces(){await this.$.inOceans().forEach((async e=>{e.hasSomeTerrain||!e.hasInvaders&&!e.hasDahan||await e.move({quantifier:w.All,pieces:this.$.InvaderOrDahan,movement:q.Relocate,oceanIsAllowed:!0,pickDestinationEffect:{name:"Clean-up",text:"If <dahan> or Invaders winds up in a place its not allowed to be, they are cleaned up to the closest legal land."}})}))}}Dg([C.sH],Bg.prototype,"currentAction",void 0),Dg([C.sH],Bg.prototype,"actionStack",void 0);var kg=function(e,a,t,n){var r,i=arguments.length,s=i<3?a:null===n?n=Object.getOwnPropertyDescriptor(a,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,a,t,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(i<3?r(s):i>3?r(a,t,s):r(a,t))||s);return i>3&&s&&Object.defineProperty(a,t,s),s};class Lg{lostReason;phase=Xe.Setup;reportedPhase=Xe.Setup;turn=0;winReason;$;constructor(e){un.makeObservable(this),this.$=e}get gameEnded(){return this.gameLost||this.gameWon}get gameLost(){return void 0!==this.lostReason}get gameWon(){return void 0!==this.winReason}async doSteps(e){for(const a of e)this.gameEnded||await a()}loseGame(e){this.lostReason=e}async run(e){try{for(await this.doSteps([()=>this.setPhase(Xe.Setup),()=>this.$.setupFearDeck(),()=>this.$.setupInvaderDeck(),()=>this.$.forEachLand((e=>e.restoreToSetupSymbols())),()=>this.$.setupStartingTokens(),()=>this.$.setupScenario(),()=>this.$.setupAdversaries(),()=>this.$.setupCommandBeast(),()=>this.$.setupSpirits(),()=>e&&this.$.possiblyResolveHistoryFinished(),()=>this.$.gameStartQuery(),()=>this.$.doEffects(r.BeforeSetupPresence),()=>this.setPhase(Xe.SetupPresence),()=>this.$.setupPresence(),()=>this.$.doEffects(r.AfterSetupPresence),()=>this.$.doEffects(r.BeforeInitialExplore),()=>!this.$.config.skipInitialExplore&&this.setPhase(Xe.InitialExplore),()=>!this.$.config.skipInitialExplore&&this.$.explore(),()=>!this.$.config.skipInitialExplore&&this.$.doEffects(r.AfterInitialExplore),()=>!this.$.config.skipInitialExplore&&this.setPhase(Xe.AdvanceCards),()=>!this.$.config.skipInitialExplore&&this.$.advanceInvaderCards(),()=>this.$.doEffects(r.OnSetupAfterAddingInvaders),()=>!!this.$.config.extraGrowth&&this.growthPhase(),()=>!!this.$.config.extraGrowth&&this.timePasses(),()=>!this.$.config.extraGrowth&&this.nextTurn()]);!this.gameEnded;)await this.spiritPhase(),this.$.spiritSimulation?await this.$.scoreFromPowers():await this.doSteps([()=>this.fastPhase(),()=>this.$.doEffects(r.AfterFastPhase),()=>this.invaderPhase(),()=>this.$.doEffects(r.AfterInvaderPhase),()=>this.slowPhase(),()=>this.$.doEffects(r.AfterSlowPhase)]),this.gameEnded||await this.timePasses()}catch(e){console.error(e),this.loseGame(kd.GameError)}await this.$.sendEvent({type:T.GameEnd,gameLost:this.gameLost,gameWon:this.gameWon,winReason:this.winReason,lostReason:this.lostReason});const a=this.winReason,t=this.lostReason;this.winReason=void 0,this.lostReason=void 0,await this.$.doEffects(r.AfterGameEnds,{winReason:a,lostReason:t}),this.winReason=a,this.lostReason=t,await this.$.possiblyResolveHistoryFinished()}setPhase(e){return this.phase=e,Promise.resolve()}toString(){return Ic({turn:this.turn},2)}updateReportedPhase(){this.reportedPhase=this.phase}winGame(e){this.winReason=e}async fastPhase(){await this.doSteps([()=>this.setPhase(Xe.FastPowers),()=>this.$.resolvePowers(d.Fast)])}async growthPhase(){await this.doSteps([()=>this.setPhase(Xe.Grow),()=>this.$.doEffects(r.StartOfSpiritPhase),()=>this.$.growAndPlayTrackActions(),()=>this.$.doEffects(r.AfterGrowth)])}async invaderPhase(){await this.doSteps([()=>this.setPhase(Xe.BlightedIsland),()=>this.$.doEffects(r.BlightedIslandPhase),()=>!!this.$.config.events&&this.$.drawEventCard(),()=>this.$.doEffects(r.AfterEventPhase),()=>this.setPhase(Xe.Fear),()=>this.$.resolveFearCards(),()=>this.$.doEffects(r.HighImmigration),()=>this.$.doEffects(r.BeforeRavageStep),()=>this.setPhase(Xe.Ravage),()=>this.$.doEffects(r.StartOfRavageStep),()=>this.$.ravage(),()=>this.$.doEffects(r.AfterTheNormalRavageStep),()=>this.setPhase(Xe.Build),()=>this.$.build(),()=>this.$.doEffects(r.AfterTheNormalBuildStep),()=>this.setPhase(Xe.Explore),()=>this.$.explore(),()=>this.$.doEffectsWithPriority(r.AfterTheNormalExploreStep),()=>this.setPhase(Xe.AdvanceCards),()=>this.$.advanceInvaderCards()])}nextTurn(){return this.turn+=1,Promise.resolve()}async slowPhase(){await this.doSteps([()=>this.setPhase(Xe.SlowPowers),()=>this.$.doEffects(r.StartOfSlowPhase),()=>this.$.resolvePowers(d.Slow)])}async spiritPhase(){await this.doSteps([()=>this.growthPhase(),()=>this.setPhase(Xe.GainEnergy),()=>this.$.gainEnergyFromTracks(),()=>this.$.doEffects(r.AfterGainingEnergyFromTracks),()=>this.$.playTrackActions(),()=>this.$.doEffects(r.BeforePlayPowers),()=>this.setPhase(Xe.PlayPowers),()=>this.$.playPowers(),()=>this.$.doEffects(r.AfterPlayPowers)])}async timePasses(){await this.doSteps([()=>this.setPhase(Xe.TimePasses),()=>this.$.doEffects(r.AtTimePassesBegin),()=>this.$.timePassesForSpirits(),()=>this.$.forEachLand((e=>e.timePasses())),()=>this.$.timePassesForFear(),()=>this.$.timePassesForEffects(),()=>this.$.doEffects(r.AtTimePassesEnds),()=>this.$.timePassesLateExpiration(),()=>this.$.globalHealthCheck(),()=>this.nextTurn()])}}kg([C.sH],Lg.prototype,"lostReason",void 0),kg([C.sH],Lg.prototype,"phase",void 0),kg([C.sH],Lg.prototype,"reportedPhase",void 0),kg([C.sH],Lg.prototype,"turn",void 0),kg([C.sH],Lg.prototype,"winReason",void 0);const Fg={name:"The Kingdom of England",set:s.Base,levels:[{difficulty:1,fearCards:[3,3,3],effect:{effects:[{name:"Proud & Might Capital",text:"If 7 or more <town>/<city> are ever in a single land, the Invaders win.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.ProudAndMightCapital,[r.LossCondition]:()=>e.existLandWhere((a=>a.hasAtLeast(7,e.TownOrCity)))?kd.ProudAndMightCapital:null,[r.GlobalReminder]:()=>({icon:`<town>/<city><br>${e.capitalSize} / 7`,ongoing:!0,adversary:gc.England})})}},{name:"Stage II Escalation <escalation><br>Building Boom",text:"On each board with <town>/<city>, Build in the land with the most <town>/<city>.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.BuildingBoom,[r.Escalation]:async({adversary:a,beforeExplore:t,beforeBuilding:n})=>!(a!==gc.England||!t&&!n)&&(await e.doAdversaryActionOnEachBoard({where:a=>a.hasOneLandWith(e.TownOrCity),forEach:a=>a.inLandsWithMost((a=>a.numberOf(e.TownOrCity))).pickOne((e=>e.doExtraBuild())),effect:{noOptions:"No boards with <town>/<city>."}}),!0),[r.GlobalReminder]:()=>({icon:"<escalation><br><town>/<city>",ongoing:!0,visible:e.stage===(e.adversaryLeading?.adversary===gc.England?2:3),adversary:gc.England})})}}]}},{difficulty:3,fearCards:[3,4,3],effect:{name:"Indentured Servants Earn Land",text:"Invader Build actions affect lands without Invaders, if they are adjacent to at least 2 <town>/<city> before the Build Action.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.IndenturedServantsEarnLand,[r.BuildCardsAffectLandsWithoutInvaders]:({land:a})=>a.adjacentPiecesInLandsWhere((e=>!e.location.isIsolated)).hasAtLeast(2,(a=>a.isA(e.TownOrCity))),[r.GlobalReminder]:()=>({icon:"2+<br><town>/<city>",ongoing:!0,adversary:gc.England})})}}},{difficulty:4,fearCards:[4,4,3],effect:{name:"Criminals and Malcontents",text:"During Setup, on each board add 1 <city> to land #1 and 1 <town> to land #2.",[r.Now]:({$:e})=>e.onEachBoard((async a=>{a.ignoreInvaderAndBlightInSetup||(e.config.adversaryLeading?.adversary===gc.Scotland||e.config.adversarySupporting?.adversary===gc.Scotland?await e.addSubEffectUntilEndOfTurn({[r.BeforeSetupPresence]:async()=>{await a.inLandNumber(1).inAdjacentLandsWhere((e=>e.isInland)).pickOne((async a=>{await a.add(1,e.City)}),{name:"Combing the Kingdom of Scotland",text:"Criminals and Malcontents:<br>During Setup, on each board add 1 <city> to land #1.<br><br>If the other Adversary's Setup instructions would add <city> to a Coastal land other than land #2, instead add the <city> to an adjacent inland land."})}}):await a.inLandNumber(1).add(1,e.City),await a.inLandNumber(2).add(1,e.Town))}))}},{difficulty:6,fearCards:[4,5,4],effect:{name:"High Immigration (I)",text:"Put the 'High Immigration' tile on the Invader Board, to the left of 'Ravage'. The Invaders take this Build action each Invader Phase before Ravaging. Cards slide left from Ravage to it, and from it to the discard pile. Remove the tile when a Stage II card slides onto it, putting that card in the discard.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.HighImmigrationI,[r.HighImmigration]:async()=>{await e.setPhase(Xe.HighImmigration),await e.build(ps.HighImmigration)},[r.BeforeAdvancingCards]:async()=>{await e.advanceCardsIn(ps.HighImmigration).to(ps.Discard),await e.advanceCardsIn(ps.Ravage).to(ps.HighImmigration),!e.someEffect(r.PermanentHighImmigration)&&e.invaderCardsInVisibleSlot(ps.HighImmigration).some((e=>2===_t[e].stage))&&(e.removeThisEffect(),await e.advanceCardsIn(ps.HighImmigration).to(ps.Discard))}})}}},{difficulty:7,fearCards:[4,5,5],effect:{name:"High Immigration Full",text:"The extra Build tile remains out the entire game.",effectId:pe.HighImmigrationFull,[r.PermanentHighImmigration]:()=>!0}},{difficulty:9,fearCards:[4,5,5],effect:{name:"Local Autonomy",text:"<town>/<city> have +1 Health.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.LocalAutonomy,[r.AdjustHealth]:({piece:a})=>a.isA(e.TownOrCity)?1:0})}}},{difficulty:11,fearCards:[4,5,4],effect:{name:"Independent Resolve",effects:[{text:"During Setup, add an additional <fear> to the Fear Pool per player in the game.",[r.Now]:({$:e})=>e.addFearToPool(e.spiritCount)},{text:"During any Invader Phase where you resolve no Fear Cards, perform the Build from High immigration twice. (This has no effect if no card in on the extra Build slot.)",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.IndependentResolve,[r.HighImmigration]:async()=>{e.hasResolvedFearCard||await e.build(ps.HighImmigration)},[r.GlobalReminder]:()=>({icon:"No <fear><br>x2",ongoing:!0,adversary:gc.England})})}}]}}]},Rg={name:"The Kingdom of France (Plantation Colony)",set:s.BranchAndClaw,levels:[{difficulty:2,fearCards:[3,3,3],effect:{effects:[{name:"Sprawling Plantation",effects:[{text:"Before Setup, return all but 7 <town> per player to the box. Invaders win if you ever cannot place a <town>.",[r.Now]:async({$:e})=>{const a=C.sH.box(!1);await e.addSubEffect({effectId:pe.SprawlingPlantation,[r.LossCondition]:()=>a.get()?kd.SprawlingPlantation:null,[r.GlobalReminder]:()=>({icon:`<town><br>${e.townsCount} / ${e.maxTownsAllowed}`,ongoing:!0,adversary:gc.France}),[r.PreventReplacePiece]:async({piece:t,withPieces:n})=>{const r=t===p.Town?-1:0,i=on(n,(e=>e===p.Town));return e.townsCount+r+i>e.maxTownsAllowed&&(await e.sendEvent({type:T.GenericSub,text:"There are no more <town> to add!"}),a.set(!0),!0)},[r.PreventAddPiece]:async({piece:t})=>t===p.Town&&e.townsCount===e.maxTownsAllowed&&(await e.sendEvent({type:T.GenericSub,text:"There are no more <town> to add!"}),a.set(!0),!0)})}}]},{name:"Stage II Escalation <escalation><br>Demand for New Cash Crops",effects:[{text:"After Exploring, on each board, pick a land of the shown terrain. If it has <town>/<city>, add 1 <blight>. Otherwise, add 1 <town>.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.DemandForNewCashCrops,[r.Escalation]:async({adversary:a,card:t,afterExplore:n,beforeBuilding:r})=>{if(a===gc.France&&(n||r)){const a=[..._t[t].terrains],n=a.length>1;n&&await e.clickToContinue({text:"If the Escalation is specific to a terrain - as with France and Sweden - choose one of the terrain randomly."});const r=a.length>1?await e.drawFrom(a,a.map((e=>qc[e].text))):a[0];return n&&await e.clickToContinue({text:`If the Escalation is specific to a terrain - as with France and Sweden - choose one of the terrain randomly.<br><br>France Escalates in terrain ${qc[r].text}`}),await e.doAdversaryActionOnEachBoard({forEach:a=>a.inLandsWhere((e=>e.hasTerrain(r))).pickOne((async a=>{a.has(e.TownOrCity)?await a.addBlight(1):await a.add(1,e.Town)}))}),!0}return!1},[r.GlobalReminder]:()=>({icon:"<escalation><br>+<blight>/<town>",ongoing:!0,visible:e.stage===(e.adversaryLeading?.adversary===gc.France?2:3),adversary:gc.France})})}}]}]}},{difficulty:3,fearCards:[3,3,3],effect:{name:"Frontier Explorers",text:"Except during Setup: After Invaders successfully Explore into a land which had no <town>/<city>, add 1 <explorer> there.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.FrontierExplorers,[r.BeforeSuccessfulExplore]:({land:a})=>(a.has(e.TownOrCity)||e.phase===Xe.InitialExplore||(e.action.data.hadNoBuilding=!0),Promise.resolve()),[r.AfterSuccessfulExplore]:async({land:a})=>{e.action.data.hadNoBuilding&&(await e.sendEvent({type:T.GenericMain,text:"Invaders successfully Explored into a land which had no <town>/<city>."}),await a.add(1,e.Explorer))},[r.GlobalReminder]:()=>({icon:"<explorer><explorer>",ongoing:!0,adversary:gc.France})})}}},{difficulty:5,fearCards:[3,4,3],effect:{name:"Slave Labor",effects:[{text:"During Setup, put the 'Slave Rebellion' Event under the top 3 cards of the Event Deck.",[r.Now]:async({$:e})=>{if(e.config.events)e.config.thematicRebellion?(e.insertEventCard(uc.SlaveRebellion).underCards(0),await e.shuffleTopThreeEventCards(),e.putBottomEventCardToTop(),e.putBottomEventCardToTop()):e.insertEventCard(uc.SlaveRebellion).underCards(3);else{let a=e.config.thematicRebellion?3:4,t=e.config.thematicRebellion?[0,1,2]:[0];await e.addEffect({effectId:pe.SlaveLabor,[r.AfterEventPhase]:async()=>{if(e.turn>=a&&0===await e.drawFrom(t,t.map((e=>0===e?"Rebellion now.":"Rebellion later.")))){const n=3===e.stage;e.insertEventCard(uc.SlaveRebellion).underCards(0),await e.drawEventCard(),a=e.turn+(e.config.thematicRebellion?3:4),t=e.config.thematicRebellion?[0,1,2]:[0],n&&(a=99)}}})}}},{text:"After Invaders Build in a land with 2 <explorer> or more, replace all but 1 <explorer> there with an equal number of <town>.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.SlaveLabor,[r.BeforeSuccessfulBuild]:({land:a})=>(a.hasAtLeast(2,e.Explorer)&&(e.action.data.hadAtLeastTwoExplorers=!0),Promise.resolve()),[r.AfterSuccessfulBuild]:async({land:a})=>{if(e.action.data.hadAtLeastTwoExplorers){const t=a.numberOf(e.Explorer)-1;await e.sendEvent({type:T.GenericMain,text:`Slave Labor converted ${t} <explorer>.`}),await a.replaceIndividually({amount:t,pieces:e.Explorer,withPiece:p.Town})}},[r.GlobalReminder]:()=>({icon:"<explorer><explorer><br>=<explorer><town>",ongoing:!0,adversary:gc.France})})}}]}},{difficulty:7,fearCards:[4,4,3],effect:{name:"Early Plantations",effects:[{text:"During Setup, on each board add 1 <town> to the highest-numbered land without <town>.",[r.Now]:async({$:e})=>{await e.onEachBoard((async a=>{if(!a.ignoreInvaderAndBlightInSetup){const t=a.highestNumberedLand((a=>!a.has(e.Town)));t&&await t.add(1,e.Town)}}))}},{text:"Add 1 <town> to land #1.",[r.Now]:async({$:e})=>{await e.onEachBoard((async a=>{a.ignoreInvaderAndBlightInSetup||await a.inLandNumber(1).add(1,e.Town)}))}}]}},{difficulty:8,fearCards:[4,4,4],effect:{name:"Triangle Trade",effects:[{text:"Whenever Invaders Build a Coastal <city>, add 1 <town> to the adjacent land with the fewest <town>.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.TriangleTrade,[r.AfterSuccessfulBuild]:async({land:a,additions:t})=>{t.some((t=>t.location.isCoastal&&t.piece.isA(e.City)&&!a.isIsolated))&&await e.doAdversaryAction((()=>a.inAdjacentLandsWhere((e=>!e.isIsolated)).withLeast((a=>a.numberOf(e.Town))).pickOne((async a=>{await e.sendEvent({type:T.GenericMain,text:"Invaders Built a Coastal <city>:"}),await a.add(1,e.Town)}))))},[r.GlobalReminder]:()=>({icon:"<city><br>+1 <town>",ongoing:!0,adversary:gc.France})})}}]}},{difficulty:9,fearCards:[4,5,4],effect:{name:"Slow-Healing Ecosystem",effects:[{text:"When you remove <blight> from the board, put it here instead of onto the Blight Card. As soon as you have 3 <blight> per player here, move it all back to the Blight Card.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.SlowHealingEcosystem,[r.PreventAddRemovedBlightToBlightCard]:async()=>(await e.addSlowHealingBlight(),!0),[r.AfterAddingSlowHealingBlight]:async()=>{for(;e.slowHealingBlight>=3;)await e.clickToContinue(),await e.removeSlowHealingBlight(3),await e.addBlightToBlightCard(3)},[r.GlobalReminder]:()=>({icon:"3 <blight>",ongoing:!0,adversary:gc.France})})}}]}},{difficulty:10,fearCards:[4,5,5],effect:{name:"Persistent Explorers",effects:[{text:"After the normal Explore, on each board add 1 <explorer> to a land without any.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.PersistentExplorers,[r.AfterResolvingExploreCard]:()=>e.doAdversaryActionOnEachBoard({forEach:async a=>{a.ignoreInvaderAndBlightInSetup||await a.inLandsWithout(e.Explorer).pickOne((async a=>{await a.add(1,e.Explorer)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands without <explorer>.`})}}),[r.GlobalReminder]:()=>({icon:"+1 <explorer>",ongoing:!0,adversary:gc.France})})}},{text:"Fear Card effects never remove <explorer>. If one would, you may instead Push that <explorer>.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.PersistentExplorers,[r.PreventRemovePiece]:async({piece:a,removement:t})=>!(e.action.type!==en.FearAction||t!==A.Remove||!a.isA(e.Explorer))&&(await a.push({quantifier:w.May}),!0),[r.GlobalReminder]:()=>({icon:"<fear><br>Push <explorer>",ongoing:!0,adversary:gc.France})})}}]}}]},Ng={name:"The Habsburg Monarchy (Livestock Colony)",set:s.JaggedEarth,levels:[{difficulty:2,fearCards:[3,3,3],effect:{effects:[{name:"Irreparable Damage",text:"Track how many <blight> come off the Blight Card during Ravages that do 8+ Damage to the land. If that number ever exceeds players, the Invaders win.",[r.Now]:async({$:e})=>{const a=C.sH.box(0);await e.addSubEffect({effectId:pe.IrreparableDamage,effects:[{[r.AfterRavagingDamageLand]:async({blightedLands:t,damageExceedingHealth:n})=>{n>=6&&t.length>0&&(a.set(a.get()+t.length),await e.sendEvent({type:T.GenericSub,text:`The Invaders did 8+ Damage to the land and caused ${t.length} Irreparable Damage.`}))},[r.LossCondition]:()=>a.get()>e.spiritCount?kd.IrreparableDamage:null,[r.GlobalReminder]:()=>({icon:`<blight><br>${a.get()} / ${e.maxIrreparableDamage}`,ongoing:!0,adversary:gc.Habsburg})}]})}},{name:"Stage II Escalation <escalation><br>Seek Prime Territory",text:"After Exploring: On each board with 4 or fewer <blight>, add 1 <town> to a land without <town>/<blight>. On each board with 2 or fewer <blight>, do so again.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.SeekPrimeTerritory,[r.Escalation]:async({adversary:a,afterExplore:t,beforeBuilding:n})=>{if(a===gc.Habsburg&&(t||n)){for(const a of[4,2])await e.doAdversaryActionOnEachBoard({where:e=>e.numberOfBlight<=a,forEach:async t=>{await t.inLandsWithNoneOf(e.Town,e.Blight).pickOne((async a=>{await a.add(1,e.Town)}),{text:4===a?"On each board with 4 or fewer <blight>, add 1 <town> to a land without <town>/<blight>.":"On each board with 2 or fewer <blight>, do so again.",highlightBoards:[t],noOptions:`On board ${t.name}: No lands without <town>/<blight>.`})}});return!0}return!1},[r.GlobalReminder]:()=>({icon:"<escalation>",ongoing:!0,visible:e.stage===(e.adversaryLeading?.adversary===gc.Habsburg?2:3),adversary:gc.Habsburg})})}}]}},{difficulty:3,fearCards:[3,4,3],effect:{name:"Migratory Herders",text:"After the normal Build Step: In each land matching a Build Card, Gather 1 <town> from a land not matching a Build Card. (In board/land order.)",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.MigratoryHerders,[r.AfterTheNormalBuildStep]:()=>e.doAdversaryActionOnEachBoard({forEach:a=>a.inLandsWhere((a=>a.matchesInvaderCards(e.invaderCardsInVisibleSlot(ps.Build),K.Build))).forEach((async a=>{a.isIsolated||await a.gather({amount:1,pieces:e.Town,filter:a=>!a.matchesInvaderCards(e.invaderCardsInVisibleSlot(ps.Build),K.Build)&&!a.isIsolated,pickPiecesEffect:{noOptions:`Land ${a.coordinateLink} has no adjacent <town> not matching a Build Card.`}})}))}),[r.GlobalReminder]:()=>({icon:"Gather<br>1 <town>",ongoing:!0,adversary:gc.Habsburg})})}}},{difficulty:5,fearCards:[4,5,2],effect:{name:"More Rural than Urban",effects:[{text:"During Setup, on each board, add 1 <town> to land #2 and 1 <town> to the highest-numbered land without Setup symbols.",[r.Now]:({$:e})=>e.onEachBoard((async a=>{a.ignoreInvaderAndBlightInSetup||(await a.inLandNumber(2).add(1,e.Town),await(a.highestNumberedLand((e=>!e.hasSetupSymbols))??a.highestNumberedLand()).add(1,e.Town))}))},{text:"During Play, when Invaders would Build 1 <city> in an Inland land, they instead Build 2 <town>.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.MoreRuralThanUrban,[r.AlterInvaderActionInLand]:async({invaderAction:a,land:t})=>{if(a===K.Build&&t.isInland&&t.buildPlans===e.City){await e.sendEvent({type:T.GenericSub,text:`Invaders would Build 1 <city> in the inland ${t.coordinateLink}, so they instead Build 2 <town>.`});const a=await t.add(2,e.Town);return await e.doEffects(r.AfterSuccessfulBuild,{land:t,additions:a}),!0}return!1},[r.GlobalReminder]:()=>({icon:"1 <city><br>=2 <town>",ongoing:!0,adversary:gc.Habsburg})})}}]}},{difficulty:6,fearCards:[4,5,3],effect:{name:"Fast Spread",text:"When making the Invader Deck, Remove 1 additional Stage I Card. (New deck order: 11-2222-33333)",[r.Now]:({$:e})=>e.removeTopMostInvaderCardOfStage(1)}},{difficulty:8,fearCards:[4,5,3],effect:{name:"Herds Thrive in Verdant Lands",text:"<town> in lands without <blight> are Durable: they have +2 Health, and 'Destroy <town>' effects instead deal 2 Damage (to <town> only) per <town> they could Destroy. ('Destroy all <town>' works normally.)",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.HerdsThriveInVerdantLands,[r.AdjustHealth]:({piece:e})=>e.isTown&&!e.location?.hasBlight?2:0,[r.AfterAddingPiece]:async({land:e,additions:a})=>{a.length>0&&a[0].piece.isBlight&&await e.healthCheck()},[r.AdjustRemovePiece]:async({piece:a,location:t,removement:n,removeAll:r})=>!(!a.isA(e.Town)||t.hasBlight||!1!==r||n!==A.DirectDestroy&&n!==A.Drown)&&(e.action.data.targetableTowns=e.action.data.targetableTowns??[],e.action.data.targetableTowns.push(a),await a.location.damage(2,e.Town,{filter:a=>e.action.data.targetableTowns.includes(a)}),!0)})}}},{difficulty:9,fearCards:[4,6,3],effect:{name:"Wave of Immigration",text:"Before the initial Explore, put the Habsburg Reminder Card under the top 5 Invader Cards. When revealed, on each board, add 1 <city> to a Coastal land without <city> and 1 <town> to the 3 Inland lands with the fewest <blight>.",card:Xt.WaveOfImmigration,[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.WaveOfImmigration,[r.BeforeInitialExplore]:async()=>{await e.clickToContinue(),await e.insertInvaderCard(mg.WaveOfImmigration,{isSpecial:!0}).justBelowCards(5)},[r.AfterChangingInvaderDeck]:async()=>{e.invaderCardsInExploreDeck.length>0&&e.invaderCardsInExploreDeck[0]===Xt.WaveOfImmigration&&0===e.invaderCardsInSlot(ps.Explore).length&&(await e.sendEvent({type:T.WaveOfImmigration}),await e.doAdversaryActionOnEachBoard({forEach:async a=>{await a.inLandsWithout(e.City).where((e=>e.isCoastal)).pickOne((async a=>{await a.add(1,e.City)}),{textArea:[.579,.75],text:"Add 1 <city> to a Coastal land without <city>.",highlightBoards:[a],noOptions:`On board ${a.name}: No Coastal lands without <city>.`});const t=a.inInlandLands();await te(3,(a=>t.copy().withLeast((a=>a.numberOf(e.Blight))).pickOne((async a=>{t.remove(a),await a.add(1,e.Town)}),{textArea:[.686,.918],text:"Add 1 <town> to the 3 Inland lands with the fewest <blight>.",prompt:`Pick Inland land to add <town>. ${3-a} left.`})))}}),await e.removeTopMostInvaderCardOfStage(0))}})}}},{difficulty:10,fearCards:[5,6,3],effect:{name:"Far-Flung Herds",text:"Ravages do +2 Damage (total) if any adjacent lands have <town>. (This does not cause lands without Invaders to Ravage.)",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.FarFlungHerds,[r.AdjustCollectiveInvaderRavageDamage]:({land:a})=>!a.isIsolated&&a.hasAdjacentLandWhere((a=>a.participatingInvaders().where((a=>a.isA(e.Town))).count>0&&!a.isIsolated))?2:0,[r.GlobalReminder]:()=>({icon:"<range-1><br>+2 <damage>",ongoing:!0,adversary:gc.Habsburg})})}}}]},$g={name:"The Kingdom of Brandenburg-Prussia",set:s.Base,levels:[{difficulty:1,fearCards:[3,3,3],effect:{name:"Stage II Escalation <escalation><br>Land Rush",text:"On each board with <town>/<city>, add 1 <town> to a land without <town>.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.LandRush,[r.Escalation]:async({beforeExplore:a,beforeBuilding:t,adversary:n})=>!(n!==gc.BrandenburgPrussia||!a&&!t)&&(await e.doAdversaryActionOnEachBoard({where:a=>a.hasOneLandWith(e.TownOrCity),forEach:a=>a.inLandsWithout(e.Town).pickOne((async a=>{await a.add(1,e.Town)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands without <town>.`}),effect:{noOptions:"No boards with <town>/<city>."}}),!0),[r.GlobalReminder]:()=>({icon:"<escalation><br>+1 <town>",ongoing:!0,visible:e.stage===(e.adversaryLeading?.adversary===gc.BrandenburgPrussia?2:3),adversary:gc.BrandenburgPrussia})})}}},{fearCards:[3,3,3],difficulty:2,effect:{name:"Fast Start",text:"During Setup, on each board add 1 <town> to land #3.",[r.Now]:({$:e})=>e.onEachBoard((async a=>{a.ignoreInvaderAndBlightInSetup||await a.inLandNumber(3).add(1,e.Town)}))}},{difficulty:4,fearCards:[3,3,3],effect:{name:"Surge of Colonists",text:"When making the Invader Deck, put I of the stage III cards between Stage I and Stage II.<br>(New Deck Order: 111-3-2222-3333)",[r.Now]:async({$:e})=>{await e.removeBottomMostInvaderCardOfStage(3),await e.insertInvaderCard(mg.Stage3Card,{isSpecial:!0}).justBelowBottomMostOfStage(1)}}},{difficulty:6,fearCards:[3,4,3],effect:{name:"Efficient",text:"When making the Invader Deck, remove and additional Stage I card.<br>(New Deck Order: 11-3-2222-3333)",[r.Now]:({$:e})=>e.removeTopMostInvaderCardOfStage(1)}},{difficulty:7,fearCards:[4,4,3],effect:{name:"Aggressive Timetable",text:"When making the Invader Deck, remove and additional Stage II card.<br>(New Deck Order: 11-3-222-3333)",[r.Now]:({$:e})=>e.removeTopMostInvaderCardOfStage(2)}},{difficulty:9,fearCards:[4,4,3],effect:{name:"Ruthlessly Efficient",text:"When making the Invader Deck, remove an additional Stage I card.<br>(New Deck Order: 1-3-222-3333)",[r.Now]:({$:e})=>e.removeTopMostInvaderCardOfStage(1)}},{difficulty:10,fearCards:[4,4,4],effect:{name:"Terrifyingly Efficient",text:"When making the Invader Deck, remove all Stage I cards.<br>(New Deck Order: 3-222-3333)",[r.Now]:({$:e})=>e.removeTopMostInvaderCardOfStage(1)}}]},Wg={name:"The Tsardom of Russia",set:s.JaggedEarth,levels:[{difficulty:1,fearCards:[3,3,3],effect:{effects:[{name:"Hunters Swarm the Island",text:"Put <beasts> Destroyed by Adversary rules on this panel. If there are ever more <beasts> on this panel than on the island, the Invaders win.",[r.Now]:async({$:e})=>{const a=C.sH.box(0);await e.addSubEffect({effectId:pe.HuntersSwarmTheIsland,[r.AfterRemovePiece]:({removement:t,piece:n})=>(n.isIgnoringCountAsA(e.Beasts)&&x[t].isDestroyLike&&e.action.type===en.AdversaryAction&&a.set(a.get()+1),Promise.resolve()),[r.LossCondition]:()=>a.get()>e.beastsOnIsland?kd.HuntersSwarmTheIsland:null,[r.GlobalReminder]:()=>{return{icon:`<beasts><br>${a.get()} ${t=a.get(),n=e.beastsOnIsland,t<n?"<":t===n?"=":">"} ${e.beastsOnIsland}`,ongoing:!0,adversary:gc.Russia};var t,n}})}},{name:"Stage II Escalation <escalation><br>Stalk the Predators",text:"On each board: Add 2 <explorer> (total) among lands with <beasts>. If you can't instead add 2 <explorer> among lands with <beasts> on a different board.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.StalkThePredators,[r.Escalation]:async({adversary:a,beforeExplore:t,beforeBuilding:n})=>!(a!==gc.Russia||!t&&!n)&&(await e.doAdversaryActionOnEachBoard({forEach:async a=>{let t=e.countPieceOnlyIfHavingPiece(p.Beasts,(()=>a.inLandsWith(e.Beasts)));0===t.count&&(t=e.countPieceOnlyIfHavingPiece(p.Beasts,(()=>e.inLandsWith(e.Beasts))));let n=e.boards;await t.pickMultiple({amount:2,where:e=>e.boards().hasOneWhere((e=>n.includes(e))),forPickedItem:async a=>{n=a.boards().items,await a.add(1,e.Explorer)},repeatSame:!0,effect:{highlightBoards:[a]}})}}),!0),[r.GlobalReminder]:()=>({icon:"<escalation><br>+2 <explorer>",ongoing:!0,visible:e.stage===(e.adversaryLeading?.adversary===gc.Russia?2:3),adversary:gc.Russia})})}}]}},{difficulty:3,fearCards:[3,3,4],effect:{name:"Hunters Seek Shell and Hide",effects:[{text:"During Setup, on each board, add 1 <beasts> and 1 <explorer> to the highest-numbered land without <town>/<city>.",[r.Now]:({$:e})=>e.onEachBoard((async a=>{const t=a.highestNumberedLand((a=>a.doesntHave(e.TownOrCity)))??a.highestNumberedLand();await t.add(1,e.Beasts),a.ignoreInvaderAndBlightInSetup||await t.add(1,e.Explorer)}))},{text:"During Play, <explorer> do +1 Damage.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.HuntersSeekShellAndHide,[r.AdjustDamage]:({piece:a})=>a.isA(e.Explorer)?1:0,[r.GlobalReminder]:()=>({icon:"<explorer><br>+1 <damage>",ongoing:!0,adversary:gc.Russia})})}},{text:"When Ravage adds <blight> to a land (including cascades), Destroy 1 <beasts> in that land.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.HuntersSeekShellAndHide,[r.WhenAddingBlight]:async({blightedLands:a,fromRavage:t})=>{if(t)for(const t of W(a))await e.doAdversaryAction((async()=>{await t.possiblyDontCountPiecesAs(p.Beasts),await t.destroyOne(e.Beasts)}))},[r.GlobalReminder]:()=>({icon:"<blight><br>-1 <beasts>",ongoing:!0,adversary:gc.Russia})})}}]}},{difficulty:4,fearCards:[4,3,4],effect:{name:"A Sense for Impending Disaster",text:"The first time each Action would Destroy <explorer>: If possible, 1 of those <explorer> is instead Pushed; 1 <fear> when you do so.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.ASenseForImpendingDisaster,[r.PreventRemovePiece]:async({piece:a,location:t,removement:n})=>{if(a.isA(e.Explorer)&&x[n].isDestroyLike&&e.action.type!==en.GameAction&&!e.action.data.hasDestroyedExplorer){e.action.data.hasDestroyedExplorer=!0,a.damage=0,a.shadowDamage=0;return 0===(await a.push({amount:1,pieces:e.Explorer})).length?await a.destroy():await t.fear(1),!0}return!1},[r.OrderOfRemoveAllMightMatter]:()=>!0,[r.GlobalReminder]:()=>({icon:"Push <explorer><br>+1 <fear>",ongoing:!0,adversary:gc.Russia})})}}},{difficulty:6,fearCards:[4,4,3],effect:{name:"Competition Among Hunters",text:"Ravage Cards also match lands with 3 or more <explorer>. (If the land already matched the Ravage Card, it still Ravages just once.)",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.CompetitionAmongHunters,[r.OverrideMatchesInvaderCard]:({land:a,invaderAction:t})=>a.participatingInvaders().where((a=>a.isA(e.Explorer))).count>=3&&t===K.Ravage||void 0,[r.GlobalReminder]:()=>({icon:"<explorer><explorer><explorer>",ongoing:!0,adversary:gc.Russia})})}}},{difficulty:7,fearCards:[4,4,4],effect:{name:"Accelerated Exploitation",text:"When making the Invader Deck, put 1 Stage III Card after each Stage II Card. (New Deck Order: 111-2-3-2-3-2-3-2-33).",[r.Now]:async({$:e})=>{for(let a=1;a<=4;a+=1)await e.removeBottomMostInvaderCardOfStage(3),await e.insertInvaderCard(mg.Stage3Card,{isSpecial:!0}).justBelowNthCardOfStage(a,2)}}},{difficulty:9,fearCards:[4,5,4],effect:{name:"Entrench in the Face of Fear",text:"Put an unused Stage II Invader Card under the top 3 Fear Cards, and an unused Stage III Card under the top 7 Fear Cards. When one is revealed, immediately, place it in the Build space (face-up).",[r.Now]:({$:e})=>(e.insertInvaderCardUnderFearCards(mg.Stage2CardIncludingCoastal,3),e.insertInvaderCardUnderFearCards(mg.Stage3Card,7),Promise.resolve())}},{difficulty:11,fearCards:[5,5,4],effect:{name:"Pressure for Fast Profit",text:"After the Ravage Step of turn 2+, on each board where it added no <blight>: In the land with the most <explorer> (min. 1), add 1 <explorer> and 1 <town>.",[r.Now]:async({$:e})=>{let a=[];await e.addSubEffect({effectId:pe.PressureForFastProfit,[r.StartOfRavageStep]:()=>(a=e.boards.map((a=>a.numberOf(e.Blight))),Promise.resolve()),[r.AfterTheNormalRavageStep]:()=>e.doAdversaryActionOnEachBoard({forEach:async t=>{e.turn>=2&&(t.numberOf(e.Blight)<=a[t.boardIndex]?await t.inLandsWithMostMinimumOne(e.Explorer).pickOne((async a=>{await a.add(1,e.Explorer),await a.add(1,e.Town)}),{highlightBoards:[t],noOptions:`On board ${t.name}: No lands with <explorer>.`}):await e.clickToContinue({highlightBoards:[t],noOptions:`On board ${t.name}: The Ravage added <blight>.`}))}}),[r.GlobalReminder]:()=>({icon:"No <blight><br><explorer>+<town>",ongoing:!0,adversary:gc.Russia})})}}}]},Mg={name:"Habsburg Mining Expedition",set:s.NatureIncarnate,levels:[{difficulty:1,fearCards:[3,3,3],effect:{effects:[{name:"Land Stripped Bare",text:"At the end of the <fast> Phase, the Invaders win if any land has at least 8 total Invaders/<blight> (combined).",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.LandStrippedBare,[r.AfterFastPhase]:()=>(e.existLocationIncludingNonExistingWhere((a=>a.numberOf(e.Blight)+a.numberOf(e.Invader)>=8))&&e.loseGame(kd.LandStrippedBare),Promise.resolve()),[r.ShowLossCondition]:()=>e.strippedLandSize>=8?kd.LandStrippedBare:null,[r.GlobalReminder]:()=>({icon:`<fast><br>${e.strippedLandSize} / 8`,ongoing:!0,adversary:gc.Saltburg})})}},{name:"Stage II Escalation <escalation><br>Mining Tunnels",text:"After Advancing Invader Cards: On each board, Explore in 2 lands whose terrains don't match a Ravage or Build Card (no source required).",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.MiningTunnels,[r.Escalation]:async({adversary:a,afterAdvancingCards:t,beforeBuilding:n})=>!(a!==gc.Saltburg||!t&&!n)&&(await e.doAdversaryActionOnEachBoard({forEach:async a=>{await a.inLandsWhere((a=>!a.terrainsMatchesInvaderCards([...e.invaderCardsInVisibleSlot(ps.Ravage),...e.invaderCardsInVisibleSlot(ps.Build),...e.invaderCardsInVisibleSlot(ps.HighImmigration)]))).pickMultiple({amount:2,forPickedItem:async e=>{await e.doExtraExplore()}})}}),!0),[r.GlobalReminder]:()=>({icon:"<escalation><br>Explore",ongoing:!0,visible:e.stage===(e.adversaryLeading?.adversary===gc.Saltburg?2:3),adversary:gc.Saltburg})})}}]}},{difficulty:3,fearCards:[3,3,3],effect:{effects:[{name:"Avarice Rewarded",text:"When <blight> added by a Ravage Action would cascade, instead Upgrade 1 <explorer>/<town> (before <dahan> counterattack).",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.AvariceRewarded,[r.PreventCascade]:async({location:a,fromRavage:t})=>!!t&&(await a.upgrade({amount:1,pieces:e.ExplorerOrTown}),!0),[r.GlobalReminder]:()=>({icon:"2+ <blight><br>Upgrade",ongoing:!0,adversary:gc.Saltburg})})}},{name:"Ceaseless Mining",text:"Lands with 3 or more Invaders are Mining Lands. In Mining lands:<br><br><disease> and modifiers to <disease> affect Ravage Actions as though they were Build Actions.<br><br>During the Build Step, Build Cards cause Ravage Actions (instead of Build Actions).",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.CeaselessMining,[r.PreventInvaderActionInLand]:async({land:a,invaderAction:t})=>!(!a.isMiningLand||t!==K.Ravage||!a.has(e.Disease)||await e.oneEffectActivates(r.PreventDiseasePreventingBuilds,{location:a}))&&(await a.removeOne(e.Disease),!0),[r.MiningLandsCauseRavageActions]:()=>!0,[r.BuildOrderMatters]:()=>!0,[r.GlobalReminder]:()=>({icon:"Build =<br>Ravage",ongoing:!0,adversary:gc.Saltburg})})}}]}},{difficulty:4,fearCards:[3,3,4],effect:{name:"Miners Come From Far and Wide",effects:[{text:"Setup: Add 1 <explorer> in each land with no <dahan>.",[r.Now]:async({$:e})=>{await e.inLandsWithout(e.Dahan).forEach((async a=>{a.board.ignoreInvaderAndBlightInSetup||await a.add(1,e.Explorer)}))}},{text:"Add 1 <disease> and 1 <city> in the highest-numbered land with a <town> Setup symbol.",[r.Now]:async({$:e})=>{await e.onEachBoard((async a=>{const t=a.highestNumberedLand((e=>e.setupSymbols.includes(p.Town)))??a.highestNumberedLand();await t.add(1,e.Disease),a.ignoreInvaderAndBlightInSetup||await t.add(1,e.City)}))}}]}},{difficulty:5,fearCards:[3,4,4],effect:{name:"Mining Boom (I)",text:"After the Build Step, on each board: Choose a land with <explorer>: Upgrade 1 <explorer> there.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.MiningBoomI,[r.AfterTheNormalBuildStep]:()=>e.doAdversaryActionOnEachBoard({forEach:a=>a.inLandsWith(e.Explorer).pickOne((async a=>{await a.upgrade({amount:1,pieces:e.Explorer})}),{highlightBoards:[a]})}),[r.GlobalReminder]:()=>({icon:"Upgrade<br>1 <explorer>",ongoing:!0,adversary:gc.Saltburg})})}}},{difficulty:7,fearCards:[4,4,4],effect:{name:"Untapped Salt Deposits",effects:[{text:"Setup: Remove the Stage II Coastal Lands card before randomly choosing Stage II cards. Place the 'Salt Deposits' card in place of the 2nd Stage II card. (New Deck Order: 111-2S22-33333, where S is the Salt Deposits card. <escalation> ignores S.)",[r.Now]:async({$:e})=>{for(let a=1;a<=4;a+=1){1!==e.nthCardOfStage(a,2).length&&await e.insertInvaderCard(2===a?mg.SaltDeposits:mg.Stage2CardExceptCoastalAndSaltDeposits,{isSpecial:3===a}).insteadOfNthCardOfStage(a,2)}await e.addSubEffect({effectId:pe.UntappedSaltDeposits,[r.AfterAdvancingCards]:()=>(e.invaderDeckInSlot(ps.Discard).includes(Xt.SaltDeposits)&&(e.invaderDeckInSlot(ps.Discard).remove(Xt.SaltDeposits),e.invaderDeckInSlot(ps.Ravage).insert(Xt.SaltDeposits)),Promise.resolve())})}}]}},{difficulty:9,fearCards:[4,5,4],effect:{name:"Mining Boom (II)",text:"Instead of Mining Boom (I), after the Build Step, on each board: Choose a land with <explorer>: Build there, then Upgrade 1 <explorer>. (Build normally in a Mining land.)",[r.Now]:async({$:e})=>{e.removeEffectsWithId(pe.MiningBoomI),await e.addSubEffect({effectId:pe.MiningBoomII,[r.AfterTheNormalBuildStep]:()=>e.doAdversaryActionOnEachBoard({forEach:a=>a.inLandsWith(e.Explorer).pickOne((async a=>{await a.doExtraBuild(),await a.upgrade({amount:1,pieces:e.Explorer})}),{highlightBoards:[a]})}),[r.GlobalReminder]:()=>({icon:"Build &<br>Upgrade",ongoing:!0,adversary:gc.Saltburg})})}}},{difficulty:10,fearCards:[4,5,4],effect:{name:"The Empire Ascendant",text:"Setup and During the Explore Step: On boards with 3 or fewer <blight>, Add +1 <explorer> in each land successfully explored. (Max. 2 lands per board per Explore Card.)",[r.Now]:async({$:e})=>{let a=e.boards.map((()=>0));await e.addSubEffect({effectId:pe.TheEmpireAscendant,effects:[{[r.BeforeResolvingInvaderCard]:()=>(a=e.boards.map((()=>0)),Promise.resolve()),[r.AfterSuccessfulExplore]:async({land:t})=>{if(e.phase===Xe.InitialExplore||e.phase===Xe.Explore){const n=t.boards().where((t=>t.numberOf(e.Blight)<=3&&a[t.boardIndex]<2));if(n.count>0){for(const e of n.items)a[e.boardIndex]+=1;await t.add(1,e.Explorer)}}},[r.ExploreOrderMatters]:({card:a})=>e.turn>0&&_t[a].coastal||_t[a].terrains.length>1||_t[a].saltDeposits,[r.GlobalReminder]:()=>({icon:"0-3 <blight><br>+1 <explorer>",ongoing:!0,adversary:gc.Saltburg})}]})}}}]},Gg={name:"The Kingdom of Scotland",set:s.FeatherAndFlame,levels:[{difficulty:1,fearCards:[3,3,3],effect:{effects:[{name:"Trade Hub",text:"If the number of Coastal lands with <city> is ever greater than (2 x # of boards), the Invaders win.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.TradeHub,[r.LossCondition]:()=>e.coastalLandsWithCities>=e.maxCoastalLandsWithCities?kd.TradeHub:null,[r.GlobalReminder]:()=>({icon:`<city><br>${e.coastalLandsWithCities} / ${e.maxCoastalLandsWithCities}`,ongoing:!0,adversary:gc.Scotland})})}},{name:"Stage II Escalation <escalation><br>Ports Sprawl Outward",text:"On the single board with the most Coastal <town>/<city>, add 1 <town> to the N lands with the fewest <town> (N = # of players.)",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.PortsSprawlOutward,[r.Escalation]:async({adversary:a,beforeExplore:t,beforeBuilding:n})=>!(a!==gc.Scotland||!t&&!n)&&(await e.doAdversaryAction((()=>e.inBoards().withMost((a=>a.forPiecesThatIs(e.TownOrCity).where((e=>e.location.isCoastal)).count)).pickOne((async a=>{const t=a.inLands();await te(e.spiritCount,(a=>t.copy().withLeast((a=>a.numberOf(e.Town))).pickOne((async a=>{t.remove(a),await a.add(1,e.Town)}),{prompt:`Pick land to add <town>. ${e.spiritCount-a} left.`})))})))),!0),[r.GlobalReminder]:()=>({icon:`<escalation><br>+${e.spiritCount} <town>`,ongoing:!0,visible:e.stage===(e.adversaryLeading?.adversary===gc.Scotland?2:3),adversary:gc.Scotland})})}}]}},{difficulty:3,fearCards:[3,4,3],effect:{name:"Trading Port",text:'After Setup, in Coastal lands, Explore Cards add 1 <town> instead of 1 <explorer>. "Coastal Lands" Invader Cards do this for maximum 2 lands per board.',[r.Now]:async({$:e})=>{let a=e.boards.map((()=>0));await e.addSubEffect({effectId:pe.TradingPort,[r.BeforeResolvingInvaderCard]:()=>(a=e.boards.map((()=>0)),Promise.resolve()),[r.AlterInvaderActionInLand]:async({invaderAction:t,land:n})=>{if(t===K.Explore&&n.isCoastal&&e.turn>0){const t=n.boards().where((e=>a[e.boardIndex]<2));if(t.count>0){for(const e of t.items)a[e.boardIndex]+=1;return await n.add(1,e.Town),!0}}return!1},[r.ExploreOrderMatters]:({card:a})=>e.turn>0&&_t[a].coastal||_t[a].terrains.length>1||_t[a].saltDeposits,[r.GlobalReminder]:()=>({icon:"<explorer>/<town>",ongoing:!0,adversary:gc.Scotland})})}}},{difficulty:4,fearCards:[4,4,3],effect:{name:"Seize Opportunity",effects:[{text:"During Setup, add 1 <city> to land #2.",[r.Now]:({$:e})=>e.onEachBoard((async a=>{a.ignoreInvaderAndBlightInSetup||await a.inLandNumber(2).add(1,e.City)}))},{text:'Place "Coastal Lands" as the 3rd Stage II Card, and move the two Stage II Cards above it up by one. (New Deck Order: 11-22-1-C2-33333, where C is the Stage II Coastal Lands Card.)',[r.Now]:async({$:e})=>{for(let a=1;a<=4;a+=1){1!==e.nthCardOfStage(a,2).length&&await e.insertInvaderCard(3===a?mg.CoastalLands:mg.Stage2CardExceptCoastalAndSaltDeposits,{isSpecial:3===a}).insteadOfNthCardOfStage(a,2)}await e.moveNthCardOfStageUpByOne(1,2),await e.moveNthCardOfStageUpByOne(2,2)}}]}},{difficulty:6,fearCards:[4,5,4],effect:{name:"Chart the Coastline",text:"In Coastal lands, Build Cards affect lands without Invaders, so long as there is an adjacent <city>.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.ChartTheCoastline,[r.BuildCardsAffectLandsWithoutInvaders]:({land:a})=>a.isCoastal&&!a.isIsolated&&a.piecesInAdjacentLands().hasAtLeast(1,(a=>a.isA(e.City)&&!a.location.isIsolated)),[r.GlobalReminder]:()=>({icon:"<city>",ongoing:!0,adversary:gc.Scotland})})}}},{difficulty:7,fearCards:[5,5,4],effect:{name:"Ambition of a Minor Nation",text:"During Setup, replace the bottom Stage I Card with the bottom Stage III Card. (New Deck Order: 11-22-3-C2-3333)",[r.Now]:async({$:e})=>{await e.removeBottomMostInvaderCardOfStage(3),await e.insertInvaderCard(mg.Stage3Card,{isSpecial:!0}).justBelowBottomMostOfStage(1),await e.removeBottomMostInvaderCardOfStage(1)}}},{difficulty:8,fearCards:[5,6,4],effect:{name:"Runoff and Bilgewater",text:"After a Ravage Action adds <blight> to a Coastal land, add 1 <blight> to that board's Ocean (without cascading). Treat the Ocean as a Coastal Wetland for this rule and for <blight> removal/movement.",[r.Now]:async({$:e,effect:a,...t})=>{const n={triggerId:e.nextTriggerId(),[r.Now]:async({action:a})=>{await e.sendEvent({type:T.GenericSub,text:"Runoff and Bilgewater caused a <blight> to be added to the Ocean."}),await e.doAdversaryAction((async()=>{await a.parentData.runoffOceanBoards.pickOne((async e=>{await e.ocean.addBlight(1,{mayCascade:!1})}))}))}};await e.addSubEffect({effectId:pe.RunoffAndBilgewater,effects:[{text:"After a Ravage Action adds <blight> to a Coastal land, add 1 <blight> to that board's Ocean (without cascading).",[r.AfterRavagingDamageLand]:async({blightedLands:r})=>{const i=r.filter((e=>e.isCoastal));i.length>0&&(e.action.data.runoffOceanBoards=yn.createCollection(e,W(i.flatMap((e=>e.boards().items)))),await e.addTrigger(n,a,t.action))},[r.GlobalReminder]:()=>({icon:"+1 <blight>",ongoing:!0,adversary:gc.Scotland})},{text:"Treat the Ocean as a Coastal Wetland for this rule and for <blight> removal/movement.",[r.OceanIsLandForBlight]:()=>!0}]})}}},{difficulty:10,fearCards:[6,6,4],effect:{name:"Exports Fuel Inward Growth",text:"After the Ravage Step, add 1 <town> to each Inland land that matches a Ravage Card and is within <range-1> of <town>/<city>.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.ExportsFuelInwardGrowth,[r.AfterTheNormalRavageStep]:async()=>{if(e.invaderCardsInVisibleSlot(ps.Ravage).length>0){const a=[];await e.doAdversaryActionOnEachBoard({withoutAction:!0,forEach:e=>(a.push(e),Promise.resolve())});const t=e.inInlandLands().where((t=>!t.boards().hasOneWhere((e=>!a.includes(e)))&&t.matchesInvaderCards(e.invaderCardsInVisibleSlot(ps.Ravage),K.Ravage)&&(t.has(e.TownOrCity)||!t.isIsolated)&&t.inLandsWithin(1).hasOneWhere((a=>a.has(e.TownOrCity)&&!a.isIsolated))));await e.clickToContinue({highlightLocations:t.items}),await t.forEach((a=>e.doAdversaryAction((async()=>{await a.add(1,e.Town)}),{land:a})),{noOptions:"No Inland land that matches a Ravage Card is within <range-1> of <town>/<city>."})}},[r.GlobalReminder]:()=>({icon:"<range-1><br>+1 <town>",ongoing:!0,adversary:gc.Scotland})})}}}]},Hg={name:"The Kingdom of Sweden",set:s.Base,levels:[{difficulty:1,fearCards:[3,3,3],effect:{name:"Stage II Escalation <escalation><br>Swayed by the Invaders",text:"After Invaders Explore into each land this Phase, if that land has at least as many Invaders as <dahan>, replace 1 <dahan> with <town>.",[r.Now]:async({$:e})=>{let a=null;await e.addSubEffect({effectId:pe.SwayedByTheInvaders,[r.Escalation]:async({card:t,adversary:n,afterExplore:r,beforeExplore:i,afterExploringLand:s})=>{if(n===gc.Sweden){if(i){const n=[..._t[t].terrains],r=n.length>1;r&&await e.clickToContinue({text:"If the Escalation is specific to a terrain - as with France and Sweden - choose one of the terrain randomly."}),a=n.length>1?await e.drawFrom(n,n.map((e=>qc[e].text))):n[0],r&&await e.clickToContinue({text:`If the Escalation is specific to a terrain - as with France and Sweden - choose one of the terrain randomly.<br><br>Sweden Escalates in terrain ${qc[a].text}`})}if(s&&s.terrain===a&&s.the(e.Invader).isAtLeastAsManyAs(e.Dahan)&&await e.doAdversaryAction((async()=>{await s.replaceOne({pieces:e.Dahan,withPiece:p.Town})})),r)return!0}return!1},[r.GlobalReminder]:()=>({icon:"<escalation><br><dahan>=<town>",ongoing:!0,visible:e.stage===(e.adversaryLeading?.adversary===gc.Sweden?2:3),adversary:gc.Sweden})})}}},{difficulty:2,fearCards:[3,3,3],effect:{name:"Heavy Mining",text:"If the Invaders do at least 6 Damage to the land during Ravage, add an extra <blight>. The additional <blight> does not destroy <presence> or cause cascade.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.HeavyMining,[r.ExtraBlightFromDamage]:({damageExceedingHealth:e})=>e>=4?1:0,[r.GlobalReminder]:()=>({icon:"6+ <damage><br>+1 <blight>",ongoing:!0,adversary:gc.Sweden})})}}},{difficulty:3,fearCards:[3,4,3],effect:{name:"Population Pressure at Home",text:"During Setup, on each board add 1 <city> to land #4. On boards where land #4 starts with <blight>, put that <blight> in land #5 instead.",[r.Now]:async({$:e})=>{await e.onEachBoard((async a=>{const t=a.inLandNumber(4);a.ignoreInvaderAndBlightInSetup||await t.add(1,e.City),t.has(e.Blight)&&await t.move({pieces:e.Blight,movement:q.Relocate,locations:{target:g.ToThisLocation,location:a.inLandNumber(5)}})}))}}},{difficulty:5,fearCards:[3,4,3],effect:{name:"Fine Steel for Tools and Guns",text:"<town> deal 3 Damage. <city> deal 5 Damage.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.FineSteelForToolsAndGuns,[r.AdjustDamage]:({piece:a})=>(a.isA(e.Town)?1:0)+(a.isA(e.City)?2:0),[r.GlobalReminder]:()=>({icon:"<town>=3<br><city>=5",ongoing:!0,adversary:gc.Sweden})})}}},{difficulty:6,fearCards:[3,4,4],effect:{name:"Royal Backing",text:"During Setup, after adding all other Invaders, discard the top card of the Invader Deck. On each board, add 1 <town> to the land of that terrain with the fewest Invaders.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.RoyalBacking,[r.OnSetupAfterAddingInvaders]:async()=>{await e.setPhase(Xe.RoyalBacking);const a=await e.accelerateTheInvaderDeck();await e.onEachBoard((async t=>{t.ignoreInvaderAndBlightInSetup||await t.inLandsWhere((e=>e.matchesInvaderCard(a,K.Explore))).withLeast((a=>a.numberOf(e.Invader))).pickOne((async a=>{await a.add(1,e.Town)}),{highlightBoards:[t],card:a})})),e.removeThisEffect()}})}}},{difficulty:7,fearCards:[4,4,4],effect:{name:"Mining Rush",text:"When Ravaging adds at least 1 <blight> to a land, also add 1 <town> to an adjacent land without <town>/<city>. Cascading <blight> does not cause this effect.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.MiningRush,[r.WhenAddingBlight]:async({land:a,blightedLands:t,isCascade:n,fromRavage:r})=>{r&&!n&&t.length>0&&!a.isIsolated&&a.hasAdjacentLandWhere((a=>a.doesntHave(e.TownOrCity)&&!a.isIsolated))&&await e.doAdversaryAction((()=>a.inAdjacentLandsWhere((a=>a.doesntHave(e.TownOrCity))).pickOne((async a=>{await a.add(1,e.Town)}),{noOptions:"No adjacent lands without <town>/<city>."})))},[r.GlobalReminder]:()=>({icon:"<blight><br>+1 <town>",ongoing:!0,adversary:gc.Sweden})})}}},{difficulty:8,fearCards:[4,4,5],effect:{name:"Prospecting Outpost",text:"During Setup, on each board add 1 <town> and 1 <blight> to land #8. The <blight> comes from the box, not the Blight Card.",[r.Now]:({$:e})=>e.onEachBoard((async a=>{a.ignoreInvaderAndBlightInSetup||(await a.inLandNumber(8).add(1,e.Town),await e.oneEffectActivates(r.PreventAddBlightInSetup)||await a.inLandNumber(8).add(1,e.Blight))}))}}]},Ug={[gc.BrandenburgPrussia]:$g,[gc.Sweden]:Hg,[gc.England]:Fg,[gc.France]:Rg,[gc.Scotland]:Gg,[gc.Habsburg]:Ng,[gc.Russia]:Wg,[gc.Saltburg]:Mg},qg={name:"Blitz",set:s.Base,difficulty:0,rules:[{name:"Blitz",effects:[{text:"All Powers are <fast>.",[r.Now]:async({$:e})=>{e.eventCardsInDeck.remove(uc.Outpaced),e.eventCardsInDeck.remove(uc.InvestigationOfDangers),e.eventCardsInDeck.remove(uc.SprawlContainedByTheWilds),await e.addSubEffect({effectId:pe.Blitz,[r.GlobalReminder]:()=>({text:"All Powers are <fast>.<br><br>Powers which were already <fast> (or made <fast>) cost 1 less Energy. (For Innate Powers and Power Cards costing 0, instead gain 1 Energy.)",icon:"Powers<br><fast>",ongoing:!0,scenario:Xn.Blitz}),[r.MayChangeSpeedOfPower]:({power:e})=>e.isSlow,[r.ChangeSpeedOfPower]:async({power:e})=>{await e.makeFast()},[r.PreventSlowPowers]:()=>!0,[r.AfterChangingSpeed]:async({power:a,speed:t,effect:n})=>{t===d.Fast&&"Blitz"!==n?.name&&(await e.sendEvent({type:T.GenericSub,text:`${a.owner.nameLink} gained 1 Energy for making a Power fast.`}),await a.owner.gainEnergy(1))},[r.BeforeResolvingInnate]:async({power:a})=>{a.data.speed===d.Fast&&(await e.sendEvent({type:T.GenericSub,text:`${a.owner.nameLink} gained 1 Energy for playing a fast innate.`}),await a.owner.gainEnergy(1))}})}},{text:"When Exploring, once per board, add an additional <explorer>.",[r.Now]:async({$:e})=>{let a=e.boards.map((()=>0));await e.addSubEffect({effectId:pe.Blitz,[r.GlobalReminder]:()=>({icon:"+1 <explorer>",ongoing:!0,scenario:Xn.Blitz}),[r.AfterSuccessfulExplore]:async({land:t})=>{const n=t.boards().where((e=>a[e.boardIndex]<1));if(n.count>0){for(const e of n.items)a[e.boardIndex]+=1;await t.add(1,e.Explorer)}},[r.AfterResolvingExploreCard]:()=>(a=e.boards.map((()=>0)),Promise.resolve()),[r.ExploreOrderMatters]:()=>!0})}},{text:'If the Island becomes "Blighted", put 1 less <blight> per player on the Blight Card.',[r.Now]:async({$:e})=>{e.config.blightCards&&await e.addSubEffect({effectId:pe.Blitz,[r.BeforeRevealingBlightCard]:async()=>{e.blightStatus===Td.BlightedIsland&&await e.removeBlightFromBlightCard(e.boardCount)},[r.AfterDrawingBlightCard]:()=>(e.blightStatus===Td.BlightedIsland&&e.removeThisEffect(),Promise.resolve())})}},{text:"Put an additional <blight> per player on the Blight Card.",[r.Now]:async({$:e})=>{await e.addSubEffectUntilEndOfTurn({[r.BeforeSetupPresence]:async()=>{await e.clickToContinue(),await e.addBlightToBlightCard(e.boardCount)}})}},{text:"The Invaders get an additional set of actions at the end of Setup. (So they will Explore, then Build and Explore.)",[r.Now]:async({$:e})=>{await e.addSubEffectUntilEndOfTurn({[r.OnSetupAfterAddingInvaders]:async()=>{await e.clickToContinue(),await e.build(),await e.doEffects(r.AfterTheNormalBuildStep),await e.explore(),await e.advanceInvaderCards()}})}}]}]},jg={name:"Dahan Insurrection",set:s.Base,difficulty:4,rules:[{effects:[{name:"Constant Raiding",text:"Whenever <dahan> move from one land to another, each <dahan> that moved does 1 Damage in their land. (Damage happens after fully resolving the Power or other effect which moved them. If a Power moves a <dahan> multiple times, it only does damage in the land where it ends up.)",[r.Now]:async({$:e,...a})=>{const t={triggerId:e.nextTriggerId(),[r.Now]:async({action:a})=>{const t=a.parentData.movedDahan;await An.createCollection(e,W(t.filter((e=>e.isAlive&&void 0!==e.location)).map((e=>e.location)))).selectOrder().forEach((async a=>{await e.doScenarioAction((async()=>{await a.damage(t.filter((e=>e.location===a)).length)}))}),{autoPlayOneOption:!0})}};await e.addSubEffect({effectId:pe.DahanInsurrection,[r.GlobalReminder]:()=>({icon:"<dahan><br>1 <damage>",scenario:Xn.DahanInsurrection,ongoing:!0}),[r.AfterMoving]:async n=>{n.piece.isA(e.Dahan)&&n.destination!==n.source&&n.movement!==q.Relocate&&(e.action.data.movedDahan=e.action.data.movedDahan??[],e.action.data.movedDahan.includes(n.piece)||e.action.data.movedDahan.push(n.piece),await e.addTrigger(t,a.effect,a.action,{priority:!0,movingAction:e.action}))}})}},{name:"Military Response",text:"Whenever a <city> is destroyed, add 1 <town> to the nearest land with <dahan>.<br>Whenever a <town> is destroyed, add 1 <explorer> to the nearest land with <dahan>.<br><br>(Add the new Invaders after fully resolving the Power or effect which destroyed the old one.)",[r.Now]:async({$:e,...a})=>{const t={triggerId:e.nextTriggerId(),[r.Now]:async({action:a})=>{const t=a.parentData.destroyedInvaders;await e.doScenarioAction((async()=>{for(const a of t)await e.inLandsWith(e.Dahan).withLeast((e=>e.distanceToLocation(a.location))).pickOne((async t=>{await t.add(1,a.piece.isA(e.City)?e.Town:e.Explorer)}))}))}};await e.addSubEffect({effectId:pe.DahanInsurrection,[r.GlobalReminder]:()=>({icon:"+1 <explorer>/<town>",scenario:Xn.DahanInsurrection,ongoing:!0}),[r.AfterRemovePiece]:async n=>{n.piece.isA(e.TownOrCity)&&x[n.removement].isDestroyLike&&(e.action.data.destroyedInvaders=e.action.data.destroyedInvaders??[],e.action.data.destroyedInvaders.push(n),await e.addTrigger(t,a.effect,a.action))}})}}]},{name:"Coordinated Insurrection",effects:[{text:'If you reach Terror Level "Victory", <dahan> immediately Damage Invaders in every land of the board, as if they were fighting back after a Ravage. If this doesn\'t fulfill the Victory condition on this card, you lose.',[r.Now]:async({$:e,...a})=>{const t={triggerId:e.nextTriggerId(),[r.Now]:async()=>{await e.inLandsWith(e.Dahan).selectOrder().forEach((a=>e.doScenarioAction((async()=>{const e=a.participatingDahan().sum((e=>e.strengthDuringRavage));if(e>0){const t=e+a.sumAdjustedCollectiveDahanRavageDamage;await a.damage(t,Z.Invader)}}))))}};await e.addSubEffect({effectId:pe.DahanInsurrection,[r.AfterReachingTerrorLevel]:async({terrorLevel:n})=>{4===n&&await e.addTrigger(t,a.effect,a.action)}})}}]},{name:"Victory",effects:[{text:"The normal Fear-based Victory is not available.<br><br>Terror 2 Victory: There are no lands where <town>/<city> outnumber <dahan><br>Terror 3+ Victory: There is fewer than 1 land per player where <town>/<city> outnumber <dahan>.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.DahanInsurrection,[r.GlobalReminder]:()=>({icon:`<town>/<city><br>${e.landCountWhereTownsAndCitiesOutnumberDahan} / ${e.terrorLevel<3?0:e.spiritCount-1}`,scenario:Xn.DahanInsurrection,ongoing:!0}),[r.RemoveFearBasedVictory]:()=>!0,[r.WinCondition]:()=>{if(2===e.terrorLevel){if(0===e.landCountWhereTownsAndCitiesOutnumberDahan)return Tg.DahanInsurrectionLevelTwo}else if(e.terrorLevel>=3&&e.landCountWhereTownsAndCitiesOutnumberDahan<e.spiritCount)return Tg.DahanInsurrectionLevelThree;return null},[r.LossCondition]:()=>4===e.terrorLevel&&e.landCountWhereTownsAndCitiesOutnumberDahan>=e.spiritCount?kd.DahanInsurrectionLevelThree:null})}}]},{name:"Additional Loss Condition",effects:[{name:"Dahan Insurrection",text:"Invaders win if there are ever fewer than 2 <dahan> per player left alive.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.DahanInsurrection,[r.LossCondition]:()=>e.dahanCount<2*e.spiritCount?kd.DahanInsurrectionTooFewDahan:null,[r.GlobalReminder]:()=>({icon:`<dahan><br>${e.dahanCount} / ${2*e.spiritCount-1}`,scenario:Xn.DahanInsurrection,ongoing:!0})})}}]}]},Jg={name:"Guard the Isle's Heart",set:s.Base,difficulty:0,rules:[{name:"Inner Lands",effects:[{text:"There is 1 Inner land on each board.",[r.Now]:async({$:e})=>{await e.addSubEffectUntilEndOfTurn({[r.OnSetupAfterAddingInvaders]:async()=>{await e.addSubEffect({text:"After all other Setup: Remove all <town>.",[r.Now]:async()=>{await e.clickToContinue(),await e.forPiecesThatIs(e.Town).forEach((async e=>{await e.remove(A.Silent)}))}}),await e.onEachBoard((async a=>{const t=e.spiritCount<=2?a.inLandsWhere((e=>e.hasNumber(7))):a.inInlandLands();await t.autoPickOne((async t=>{await e.addEffect({[r.LossCondition]:()=>e.turn>1&&t.has(e.TownOrCity)?kd.GuardTheIslesHeart:null,[r.Reminder]:e=>e===t?"Anytime after Turn 1: Invaders win if there is a <town>/<city> in an Inner land.":void 0,[r.StartOfSpiritPhase]:()=>(e.checkIfEnded(),Promise.resolve())}),await e.addSubEffect({effectId:pe.GuardTheIslesHeart,text:"After all other Setup: In each Inner land (see left side), add 1 <explorer> and 1 <presence> from the player starting on that board. If this is illegal, as for Ocean's Hungry Grasp, add the <presence> in the nearest legal land on that board.)",[r.Now]:async()=>{await t.add(1,e.Explorer),await e.spiritsWhich((e=>e.startingBoard===a)).forEach((async n=>{e.someEffect(r.PreventAddPresence,{spirit:n,location:t,ignoreLandType:!1})?await a.inCoastalLands().withLeast((e=>e.distanceToLocation(t))).autoPickOne((async e=>{await n.addPresence({locations:g.AnyLands,filter:a=>a===e,forcedFromTrack:!0,autoPlayOneOption:!0})})):await n.addPresence({locations:g.AnyLands,filter:e=>e===t,forcedFromTrack:!0,autoPlayOneOption:!0})}))}})}),{highlightBoards:[a],prompt:`In Board: ${a.name}: Pick inner land.`})}))}})}}]},{name:"Setup Changes",effects:[{text:"Each Spirit starts with 2 additional Power Cards by drawing a single card from each of the Power Decks.",[r.Now]:async({$:e})=>{await e.addSubEffectUntilEndOfTurn({effectId:pe.GuardTheIslesHeart,[r.OnSetupAfterAddingInvaders]:async()=>{await e.eachSpirit((async a=>{await e.doScenarioAction((async()=>{await a.gainPowerCard({powerType:o.Minor,drawAmount:1,taken:!0}),await a.gainPowerCard({powerType:o.Major,withoutForgetting:!0,drawAmount:1,taken:!0})}))}))}})}}]}]},Vg={name:"Rituals of Terror",set:s.Base,difficulty:3,rules:[{name:"Rituals of Terror",effects:[{text:"Terror Levels are not earned via <fear>, but by the Ritual of Terror.<br>Do not resolve earned Fear Cards during the Invader Phase.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.RitualsOfTerror,[r.PreventTerrorLevelAndResolveFearCards]:()=>!0,[r.GlobalReminder]:()=>({icon:"Terror<br>Levels",scenario:Xn.RitualsOfTerror,ongoing:!0})})}},{text:"During either the <fast> or <slow> Phase, the Spirits may perform the Ritual of Terror if:<br><bullet> There is a land with at least 1 <presence> from each Spirit.<br><bullet> That land has at least 3 <dahan> per player.<br><bullet> The Spirits collectively spend 3 Energy total and destroy 3 <presence> total in that land.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.RitualsOfTerror,[r.GlobalReminder]:()=>({icon:"Ritual<br>Terror",scenario:Xn.RitualsOfTerror,ongoing:!0}),[r.ExtraAction]:()=>{const a=e.inLandsWhere((a=>a.spiritsWithPresence().count===e.spiritCount&&a.numberOf(e.Presence)>=3&&a.numberOf(e.Dahan)>=3*e.spiritCount&&e.playersCanJointlyPayEnergyAidedBy({energy:3})));return(e.phase===Xe.FastPowers||e.phase===Xe.SlowPowers)&&a.count>0?{actionId:"RitualOfTerror",name:"Ritual of Terror",text:"When the Ritual of Terror is performed:<br><bullet> Earn the next Terror Level. (This may be VICTORY on your third Ritual.)<br><bullet> Resolve all earned Fear Cards (at the new Terror Level).<br><bullet> Push all <dahan> from the land where the Ritual was performed, distributing them as evenly as possible among all adjacent lands.",scenario:Xn.RitualsOfTerror,[r.Now]:async()=>{await a.pickOne((async a=>{await e.doSpiritAction((async()=>{await e.addSubEffect({effects:[{text:"The Spirits collectively spend 3 Energy total.",[r.Now]:async()=>{await e.clickToContinue(),await e.payEnergyJointlyAidedBy({energy:3*e.spiritCount})}},{text:"Destroy 3 <presence> total in that land.",[r.Now]:async()=>{await a.destroy({amount:3,pieces:Z.Presence})}},{text:"Earn the next Terror Level. (This may be VICTORY on your third Ritual.)",[r.Now]:async()=>{await e.clickToContinue(),await e.earnTerrorLevel(),e.terrorLevel<=3&&e.putAllFearCardsIntoLevel(e.terrorLevel)}},{text:"Push all <dahan> from the land where the Ritual was performed, distributing them as evenly as possible among all adjacent lands.",[r.Now]:async()=>{await a.push({pieces:e.Dahan,quantifier:w.All,evenly:!0})}}]})}))}),{prompt:"Pick a land to perform Ritual of Terror"})}}:null}})}},{text:"Resolve all earned Fear Cards (at the new Terror Level).",[r.Now]:async({$:e})=>{await e.addSubEffect({[r.AfterReachingTerrorLevel]:async()=>{await e.resolveFearCards()}})}},{text:"Put all Fear Cards into the Fear Deck. If you run out, earn no more Fear Cards.",[r.Now]:({$:e})=>(e.putAllFearCardsIntoLevel(1),Promise.resolve())}]}]},Yg={name:"Bronze Loop",actionId:"BronzeLoop",description:"A loop of twisted bronze set with deep red stones",icon:"Bronze<br>Loop",invaderBenefit:[{text:"For purposes of Explore and Build, Invaders in any Sands are considered to be in all Sands.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffect({effectId:pe.BronzeLoopInvader,[r.GlobalReminder]:()=>({icon:"<sands>",ongoing:!0,scenario:Xn.PowersLongForgotten}),[r.BuildOrderMatters]:()=>!0,[r.LandIsExploringSource]:({land:a})=>a.isSands&&e.inLandsWhere((e=>e.isSands)).hasOneWhere((a=>a.has(e.TownOrCity))),[r.BuildCardsAffectLandsWithoutInvaders]:({land:a})=>a.isSands&&e.inLandsWhere((e=>e.isSands)).hasOneWhere((e=>e.hasInvaders)),[r.AdjustBuildPlans]:({land:a})=>{if(a.isSands){return e.forPiecesThatIs(e.Town).where((e=>e.location.isSands)).count>e.forPiecesThatIs(e.City).where((e=>e.location.isSands)).count?e.City:e.Town}return!1}})}}],spiritBenefit:[{text:"Spirits may shift their <presence> from a Sands to another at any time.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.BronzeLoopSpirit,[r.GlobalReminder]:()=>({icon:"<presence><br><sands>",ongoing:!0,scenario:Xn.PowersLongForgotten}),[r.ExtraAction]:()=>({actionId:"BronzeLoop",name:"Bronze Loop",text:"Spirits may shift their <presence> from a Sands to another at any time.",scenario:Xn.PowersLongForgotten,[r.Now]:async()=>{await e.forPiecesThatIs(e.Presence).where((e=>e.location.isSands)).pickOne((async a=>{await e.doScenarioAction((async()=>{await a.move({locations:{target:g.AnyLands},destinationFilter:e=>e.isSands,movement:q.Relocate})}))}),{prompt:"Pick <presence> to Relocate."})}})})}}]},zg={name:"Glowing Ember",actionId:"GlowingEmber",description:"A fist-sized ember, glowing steadily",icon:"Glowing<br>Ember",invaderBenefit:[{text:"Whenever a <town>/<city> is added to a Jungle or Wetland without <town>/<city>, also add 1 <blight>.",[r.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffect({effectId:pe.GlowingEmberInvader,[r.GlobalReminder]:()=>({icon:"<jungles-wetlands><br>+1 <blight>",ongoing:!0,scenario:Xn.PowersLongForgotten}),[r.AfterAddingPiece]:async({land:a,additions:t})=>{a.isJungleOrWetlands&&a.hasExactly(1,e.TownOrCity)&&t.some((a=>a.piece.isA(e.TownOrCity)))&&(await e.clickToContinue({highlightLocations:[a]}),await e.doScenarioAction((async()=>{await a.addBlight(1)})))}})}}],spiritBenefit:[{text:"Spirits do not need to Forget when gaining a Major Power.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.GlowingEmberSpirit,[r.GlobalReminder]:()=>({icon:"Skip<br>Forget",ongoing:!0,scenario:Xn.PowersLongForgotten}),[r.PreventForgetPowercard]:async a=>{if(a.duringPowerGain){return!await e.may({card:a.power.power,prompt:`Forget ${a.power.powerLink}?`})}return!1}})}}]},Qg={name:"Jagged Tooth",actionId:"JaggedTooth",description:"An enormous jagged tooth, dripping water",icon:"Jagged<br>Tooth",invaderBenefit:[{text:"Whenever Invaders Explore into Wetlands they immediately Build there.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.JaggedToothInvader,[r.GlobalReminder]:()=>({icon:"<wetlands><br>Build",ongoing:!0,scenario:Xn.PowersLongForgotten}),[r.AfterSuccessfulExplore]:async({land:e})=>{e.isWetlands&&await e.doExtraBuild()}})}}],spiritBenefit:[{text:"Each Spirit gains +2 Energy during any Spirit Phase that they do not Reclaim any cards.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.JaggedToothSpirit,[r.GlobalReminder]:()=>({icon:"Extra<br>Energy",ongoing:!0,scenario:Xn.PowersLongForgotten}),[r.BeforePlayPowers]:async()=>{await e.eachSpirit((async a=>{a.hasReclaimedACardDuringSpiritPhase||(await e.sendEvent({type:T.GenericMain,text:`${a.nameLink} did not Reclaim any cards during the Spirit Phase.`}),await e.doScenarioAction((async()=>{await a.gainEnergy(2)})))}))}})}}]},Kg={name:"Leather Sack",actionId:"LeatherSack",description:"A leather sack with its mouth sewn shut",icon:"Leather<br>Sack",invaderBenefit:[{text:"Leave the token in the land where it was found. This land cannot be targeted by Powers for the rest of the game.",[r.Now]:async({$:e})=>{const a=e.forPiecesThatIs(e.HiddenLocation).where((e=>8===e.scenarioNumber)).anyOne.location;await e.clickToContinue(),await e.addSubEffect({[r.Reminder]:e=>e===a?"This land cannot be targeted by Powers for the rest of the game.":void 0,[r.PreventTargetLand]:({land:e})=>e===a})}}],spiritBenefit:[{text:"Now: Choose 1 land. Remove everything in it from the game.",[r.Now]:async({$:e})=>{await e.inLands().pickOne((async a=>{await e.doScenarioAction((async()=>{await a.remove({quantifier:w.All,pieces:Z.AllPieces,removement:A.RemoveFromGame})}))}))}}]},Xg={name:"A lizard's scale",actionId:"LizardsScale",description:"A lizard's scale, perpetually burning",icon:"Lizard's<br>Scale",invaderBenefit:[{text:"Powers granting <fire> don't Damage/Destroy Invaders unless the Spirit spends an additional Energy. (Per Power)",[r.Now]:async({$:e})=>{const a=C.sH.box(!1),t=async()=>!(void 0===e.action.power||void 0===e.action.spirit||void 0===bd[e.action.power.power].elements||!bd[e.action.power.power].elements.includes(i.Fire)||a.get())&&(0===e.action.spirit.energy||!await e.may({text:"Pay 1 Energy to Damage/Destroy Invaders using a Power granting <fire>?"})||(await e.action.spirit.payEnergy(1),a.set(!0),await e.addEffectUntilEndOfAction({[r.ActionEnds]:()=>(a.set(!1),Promise.resolve())}),!1));await e.addSubEffect({effectId:pe.LizardsScaleInvader,[r.GlobalReminder]:()=>({icon:"<fire><br>No <damage>",ongoing:!0,scenario:Xn.PowersLongForgotten}),[r.PreventRemovePiece]:({piece:e,removement:a})=>x[a].isDestroyLike&&e.isInvader?t():Promise.resolve(!1),[r.PreventDamagingPiece]:({piece:e})=>e.isInvader?t():Promise.resolve(!1)})}}],spiritBenefit:[{text:"Damage-dealing Powers granting <fire> do +1 Damage. (Total bonus per Power.)",[r.Now]:async({$:e})=>{await e.gainDamageBoost({effectId:pe.LizardScaleSpirit,amount:1,permanent:!0,scenario:Xn.PowersLongForgotten,filter:()=>void 0!==e.action?.power&&void 0!==bd[e.action.power.power].elements&&bd[e.action.power.power].elements.includes(i.Fire)})}}]},_g={name:"Pillar of Sunlight",actionId:"PillarOfSunlight",description:"A spear-like pillar of sunlight too hot to approach",icon:"Pillar<br>Sunlight",invaderBenefit:[{text:"Now: On each board, in the land with the most <town>/<city> (minimum 1): Destroy all <dahan> and Spirit tokens. Add 1 <blight>.",[r.Now]:async({$:e})=>{await e.doScenarioActionOnEachBoard((async a=>{await a.inLandsWithMostMinimumOne(e.TownOrCity).pickOne((async a=>{await e.doScenarioAction((async()=>{await a.destroyAll(e.Dahan),await a.destroyAll(e.BadlandsBeastsDiseaseOrWilds),await a.destroyAll(e.Quake),await a.destroyAll(e.Vitality),await a.destroyAll(e.Deeps),await a.removeAllStrife(),await a.addBlight(1)}))}),{noOptions:`On board ${a.name}: No lands with <town>/<city>.`})}),{selectOrder:!0})}}],spiritBenefit:[{text:"Now: Earn 2 Fear Cards. <dahan> in 1 land deal Damage.",[r.Now]:async({$:e})=>{await e.doScenarioAction((async()=>{await e.earnFearCard(),await e.earnFearCard(),await e.inLandsWithAllOf(e.Dahan,e.Invader).pickOne((async a=>{const t=a.piecesThatAre(e.Dahan).sum((e=>e.strengthOutOfRavage));await a.damage(t)}))}))}}]},Zg={1:Xg,2:Yg,3:Qg,4:{name:"Rib-bone",actionId:"RibBone",description:"A rib-bone crusted with unmelting ice",icon:"Rib<br>bone",invaderBenefit:[{text:"Next turn: Spirits get only 1 Card Play.",[r.Now]:async({$:e})=>{const a=e.turn+1;await e.addSubEffect({effectId:pe.RibBoneInvader,[r.GlobalReminder]:()=>({icon:"1 Card<br>Play",scenario:Xn.PowersLongForgotten}),[r.AdjustCardPlays]:()=>e.turn===a?1:0,[r.TimePasses]:()=>(e.turn>=a&&e.removeThisEffect(),Promise.resolve())})}}],spiritBenefit:[{text:"During the next normal Ravage: Invaders do -3 Damage per land.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.RibBoneSpirit,[r.AdjustCollectiveInvaderRavageDamage]:({normal:e})=>e?-3:0,[r.AfterResolvingRavageCard]:()=>(e.removeThisEffect(),Promise.resolve()),[r.GlobalReminder]:()=>({icon:"Ravage<br>-3 <damage>",scenario:Xn.PowersLongForgotten})})}}]},5:zg,6:{name:"Wind-woven Rope",actionId:"WindWovenRope",description:"A rope woven out of the wind",icon:"Wind<br>Rope",invaderBenefit:[{text:"Powers do not Gather/Push Invaders unless the Spirit spends an extra Energy. (Per Power)",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.WindWovenRopeInvader,[r.GlobalReminder]:()=>({icon:"Gather<br>Push",ongoing:!0,scenario:Xn.PowersLongForgotten}),[r.PreventMovePiece]:({piece:a,movement:t})=>!e.action.data.paidForPushing&&a.isInvader&&(t===q.Push||t===q.Gather),[r.AfterTargetingLands]:async()=>{!e.action.data.paidForPushing&&void 0!==e.action.spirit&&void 0!==e.action.power&&bd[e.action.power.power].hasPushOrGather&&e.action.spirit.energy>0&&await e.may({text:"Pay 1 Energy to possibly Gather/Push Invaders using this Power?"})&&(await e.action.spirit.payEnergy(1),e.action.data.paidForPushing=!0)}})}}],spiritBenefit:[{text:"All Powers have <range+1>.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.WindWovenRopeSpirit,[r.GlobalReminder]:()=>({icon:"<range+1>",ongoing:!0,scenario:Xn.PowersLongForgotten}),[r.ExtraRange]:()=>void 0!==e.action.power?1:0})}}]},7:_g,8:Kg},ef={name:"Powers Long Forgotten",set:s.BranchAndClaw,difficulty:1,rules:[{text:"Whenever a land has 3 <dahan> or more in it, the players search it.<br>Whenever a land has 2 Invaders or more, the Invaders search it.",[r.Now]:async({$:e})=>{const a=[1,2,3,4,5,6,7,8];let t=Math.min(e.boardCount+1,8),n=4*e.boardCount-t;const i=e.adversaryLeading?.adversary===gc.France||e.adversarySupporting?.adversary===gc.France?3:2,s=async s=>{s.has(e.HiddenLocation)&&await s.piecesThatAre(e.HiddenLocation).forEach((async o=>{if(void 0===o.scenarioNumber){const d=s.hasAtLeast(3,e.Dahan),c=s.hasAtLeast(i,e.Invader);if(d||c){const i=[...[...Array(n).keys()].map((()=>"Blank")),...[...Array(t).keys()].map((()=>"Number"))];if("Number"===await e.drawFrom(i,i)){t-=1;const n=await e.drawFrom(a,a.map((e=>`${e}`))),i=Zg[n];if(o.scenarioNumber=n,o.placeInGroup(),await e.clickToContinue({highlightPieces:[o],text:`The ${d?"Dahan":"Invaders"} searched the Hidden Location and found a Source of Power!<br><br>${i.description}.`}),d){const a=`${i.description}.<br><br>When used:<br>${i.spiritBenefit[0].text}<br><br>If never used:<br>+2 Points`;await e.addSubEffect({name:i.name,text:a,[r.GlobalReminder]:()=>({icon:i.icon,ongoing:!0,scenario:Xn.PowersLongForgotten}),[r.ExtraAction]:({effect:a})=>({actionId:i.actionId,name:i.name,[r.Now]:async()=>{e.removeEffect(a),await e.addSubEffect({effects:i.spiritBenefit})}}),[r.ExtraScore]:()=>2})}else await e.addSubEffect({name:i.name,effects:i.invaderBenefit});await o.remove()}else n-=1,o.scenarioNumber=0,o.placeInGroup(),await e.clickToContinue({highlightPieces:[o],text:`The ${d?"Dahan":"Invaders"} searched the Hidden Location but found no Source of Power.`}),await o.remove()}}}))};await e.addSubEffect({effectId:pe.PowersLongForgotten,[r.OnSetupAfterAddingInvaders]:async()=>{await e.onEachBoard((async a=>{await a.inLandsWhere((a=>a.doesntHave(e.Dahan))).pickMultiple({amount:4,autoplayIfPickingAll:!0,forPickedItem:async a=>{await a.add(1,e.HiddenLocation),await s(a)}})}))},[r.AfterMoving]:async({piece:a,source:t,destination:n})=>(a.isOneOf(e.Dahan,e.Invader)&&(await s(t),await s(n)),Promise.resolve()),[r.AfterAddingPiece]:async({additions:a})=>{if(a.some((a=>a.piece.isOneOf(e.Dahan,e.Invader))))for(const e of W(a.map((e=>e.location))))await s(e);return Promise.resolve()}})}}]},af=async({$:e,piece:a})=>{if(a.isInvader&&e.action.type!==en.GameAction&&!a.location.forPiecesWithin(1,null,{mayIncrease:!1}).hasOneWhere((a=>a.isA(e.FlameMarker)))&&!e.action.data.hasPaidForDestruction){if(void 0!==e.action.spirit&&e.action.spirit.energy>=2){if(!e.action.data.hasDeniedPayingForDestruction&&await e.may({highlightLocations:[a.location],prompt:"Pay 2 Energy to do Damage/Destruction in this land?"}))return await e.action.spirit.payEnergy(2),e.action.data.hasPaidForDestruction=!0,!1;e.action.data.hasDeniedPayingForDestruction=!0}else await e.clickToContinue();return!0}return!1},tf={name:"Rituals of the Destroying Flame",set:s.BranchAndClaw,difficulty:3,rules:[{name:"Invader Immunity",effects:[{text:"Whenever anything would Damage or Destroy Invaders, ignore that Damage/Destruction unless either:<br><br>There is a Flame Marker within <range-1>.<or>The Spirit using the Power or ability pays 2 Energy.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.RitualsOfTheDestroyingFlame,[r.GlobalReminder]:()=>({icon:"Invader<br>Immunity",ongoing:!0,scenario:Xn.RitualsOfTheDestroyingFlame}),[r.PreventDamagingPiece]:({piece:a})=>af({$:e,piece:a}),[r.PreventRemovePiece]:({piece:a,removement:t})=>Promise.resolve(x[t].isDestroyLike&&af({$:e,piece:a}))})}},{name:"Ritual of the Destroying Flame",text:"Each turn, after all Growth is done, one or more Spirits may perform the Ritual of the Destroying Flame.<br><br>(See Scenario Card for details.)",[r.Now]:async({$:e})=>{await e.eachSpirit((async a=>{await a.addExtraAction({actionId:`RitualOfTheDestroyingFlame${a.spirit}`,icon:"Ritual",enabled:()=>e.phase===Xe.GainEnergy&&a.powersWhere((e=>e.data.elements?.includes(i.Fire)??!1)).count>0,onActivate:async()=>{await e.addSubEffect({effects:[{text:"Each Spirit performing the Ritual Forgets a Power Card that grants <fire>.",[r.Now]:async()=>{await a.forgetPowers({filter:e=>e.data.elements?.includes(i.Fire)??!1})}},{text:"Each Spirit performing the Ritual chooses a land where they have <presence>. Add a Flame Marker and 1 <blight> to that land. (This destroys <presence> normally.)",[r.Now]:async()=>{await a.inLands().pickOne((async t=>{await a.doSpiritAction((async()=>{await t.add(1,e.FlameMarker),await t.addBlight(1),await e.addSubEffect({effects:[{text:"Gain Energy equal to the current Invader Stage.",[r.Now]:async()=>{await e.clickToContinue({noOptions:`Stage ${e.stage} = ${e.stage} Energy.`}),await a.gainEnergy(e.stage)}},{text:"If there are Invaders in that land, do <fear> equal to the current Invader Stage, and 1 Damage per <dahan> present.",[r.Now]:async()=>{t.hasInvaders?(await e.clickToContinue({noOptions:`Stage ${e.stage} = ${e.stage} <fear>.`}),await t.fear(e.stage),await t.damage(t.numberOf(e.Dahan))):await e.clickToContinue({noOptions:"No Invaders present in land."})}}]})}))}),{prompt:"Pick a land where to add a Flame Marker."})}}]})}})}))}}]}]},nf={name:"Bringer of Dreams and Nightmares",set:s.Base,aspects:[ln.Enticing,ln.Violence],specialRules:[{name:"To Dream a Thousand Deaths",text:"Your Powers never cause Damage, nor can they Destroy anything other than your own <presence>.<br><br>When a Power of yours would Destroy (or deal enough Damage to Destroy) <explorer>/<town>/<city>, generate 0/2/5 <fear> instead. The Power Pushes all <explorer>/<town> it would Destroy.<br><br>Notes: A single Power cannot Destroy a given Invader more than once. Powers which cause Damage via <dahan> are affected just like others. All effects other than Damage/Destroy work as usual.",effects:[{[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Bringer,[r.PreventRemoveBoard]:({removement:t})=>Promise.resolve(e.action.spirit===a&&t===A.DirectDestroy)})}},{text:"Your Powers never cause Damage, nor can they Destroy anything other than your own <presence>.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Bringer,[r.GlobalReminder]:()=>({icon:"Powers<br>No <damage>",ongoing:!0,spirit:a,players:[a]}),[r.PreventDamagingPiece]:async({piece:t,damage:n})=>e.action.spirit===a&&(await e.waitForAnimationsToFinish(),t.shadowDamage+=n,await e.sendEvent({type:T.PieceDamaged,amount:n,shadow:!0,location:t.location??void 0,piece:t,pieceType:t.piece}),t.isAlive||await t.destroy(),await e.addEffectUntilEndOfAction({[r.ActionEnds]:()=>(t.shadowDamage=0,Promise.resolve())}),!0)})}},{[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Bringer,text:`When a Power of yours would Destroy (or deal enough Damage to Destroy) <explorer>/<town>/<city>, generate ${a.aspect===ln.Violence?"1/3/5":"0/2/5"} <fear> instead. The Power Pushes all <explorer>/<town> it would Destroy.`,[r.GlobalReminder]:()=>({icon:"<fear><br>Push",ongoing:!0,spirit:a,players:[a]}),[r.PreventRemovePiece]:async({piece:t,removement:n})=>!(e.action.spirit!==a||!x[n].isDestroyLike||n===A.DestroyByHealthChange||t.isAPresenceOf(a))&&(t.shadowDamage=0,t.isA(e.Explorer)?(a.aspect===ln.Violence&&await(t.location?.fear(1)),await t.push()):t.isA(e.Town)?(await(t.location?.fear(a.aspect===ln.Violence?3:2)),await t.push()):t.isA(e.City)&&await(t.location?.fear(5)),!0)})}}]}],pickOptions:[[0,1,2,3]],growthOptions:[{effects:[{text:"Reclaim cards",[r.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}}]},{effects:[{text:"Reclaim One",[r.Now]:async({you:e})=>{await e.reclaim(1)}},{text:"Add a <presence> in <range-0>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(0)}}]},{effects:[{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-1>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(1)}}]},{effects:[{text:"Add a <presence> to Land with Dahan or Invaders",[r.Now]:async({you:e,$:a})=>{await e.addPresenceInRange(4,{filter:e=>e.has(a.Dahan)||e.hasInvaders})}},{text:"Gain +2 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(2)}}]}],tracks:[{energy:2,name:"Top-track: 2 Energy"},{requires:0,elements:[i.Air],name:"Top-track: Air"},{requires:1,energy:3,name:"Top-track: 3 Energy"},{requires:2,elements:[i.Moon],name:"Top-track: Moon"},{requires:3,energy:4,name:"Top-track: 4 Energy"},{requires:4,elements:[i.Any],name:"Top-track: Any"},{requires:5,energy:5,name:"Top-track: 5 Energy"},{cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:7,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:8,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:9,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:10,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:11,elements:[i.Any],name:"Bottom-track: Any"}],setup:[{text:"Put 2 <presence> on your starting board in the highest-numbered Sands.",[r.Now]:async({you:e})=>{await e.startingBoard.highestNumberedTerrain(Ft.Sands).putPresence(2,e)}}],uniquePowers:[_e.CallOnMidnightsDream,_e.DreadApparitions,_e.DreamsOfTheDahan,_e.PredatoryNightmares],innatePowers:[_e.SpiritsMayYetDream,_e.NightTerrors],lore:"When the moon is bright, and the leaves overhead are thin enough to let stray beams fall to earth, the Bringer of Dreams and Nightmares may sometimes be spied, an apparition of pale light and deep shadow. Seen this way, it will neither stop nor acknowledge attempts to communicate with it, whether by Dahan or Spirit. It might not even be there at all: perhaps it's a reflection of a self somewhere else entirely; the realm of The Pathmaker, or some strange road that borders it.<br>But beings which dream hear from the Bringer frequently, even if they rarely remember it. Certain patterns may even call its attention, if drawn with sand and scattered with breath before sleep. Since the Invaders came, it has tended towards more terrifying forms, even well before the current conflict arose.",playStyle:"With most Spirits, Terror Victories are a backup plan if the main push against the Invaders stalls out for too long, but Bringer turns Fear into a more viable primary strategy. Its transformation of damage & destruction into Fear can turn Major Powers into tremendous sources of terror and panic. However, the only real offense Bringer has is the Dahan fighting back. While it does have some defensive ability, it is fundamentally poor at clearing areas of Invaders.",complexity:"High"},rf={name:"Vital Strength of the Earth",set:s.Base,aspects:[ln.Resilience,ln.Might,ln.Nourishing],specialRules:[{name:"Earth's Vitality",text:"Defend 3 in every land where you have <sacred>.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Earth,[r.GlobalReminder]:()=>({icon:"Defend<br><sacred>",ongoing:!0,spirit:a,players:[a]}),[r.DefendFromSpirits]:({land:e})=>e.hasSacredSiteOf(a)?3:0})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[r.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Add a <presence> in <range-2>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(2)}}]},{effects:[{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-0>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(0)}}]},{effects:[{text:"Add a <presence> in <range-1>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(1)}},{text:"Gain +2 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(2)}}]}],tracks:[{energy:2,name:"Top-track: 2 Energy"},{requires:0,energy:3,name:"Top-track: 3 Energy"},{requires:1,energy:4,name:"Top-track: 4 Energy"},{requires:2,energy:6,name:"Top-track: 6 Energy"},{requires:3,energy:7,name:"Top-track: 7 Energy"},{requires:4,energy:8,name:"Top-track: 8 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:6,cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:7,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:8,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:9,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:10,cardPlays:4,name:"Bottom-track: 4 Card Plays"}],setup:[{text:"Put 3 <presence> on your starting board: 2 in the highest-numbered Mountain, 1 in the highest-numbered Jungle.",[r.Now]:async({you:e})=>{await e.startingBoard.highestNumberedTerrain(Ft.Mountains).putPresence(2,e),await e.startingBoard.highestNumberedTerrain(Ft.Jungles).putPresence(1,e)}}],uniquePowers:[_e.AYearOfPerfectStillness,_e.DrawOfTheFruitfulEarth,_e.GuardTheHealingLand,_e.RitualsOfDestruction],progression:[_e.RouseTheTreesAndStones,_e.CallToMigrate,_e.PoisonedLand,_e.DevouringAnts,_e.VigorOfTheBreakingDawn,_e.VoraciousGrowth,_e.SavageMawbeasts],innatePowers:[_e.GiftOfStrength],lore:"A spirit of great and unhurried power. The life that earth yields up to roots, the ground supporting the life that lives upon it. The patience of seasons and of stone.<br>It is not usually a direct benefactor of the Dahan - rather than giving blessings it prefers to work in concert with them, lending power to joint undertakings.<br>Currently it is trying to rouse itself to fight against the Invaders, but this swift and direct action runs somewhat counter to its nature.",playStyle:"Powerful but slow: has potent Power Cards and an excellent Energy income, but starts wtih only one card play per turn, and Growth is limited to adding one Presence per turn.<br>Also slow to change: learning new Powers carries slightly more cost than reclaiming played Power Cards.",complexity:"Low"},sf={name:"A Spread of Rampant Green",set:s.Base,aspects:[ln.Tangles,ln.Regrowth],specialRules:[{name:"Choke the Land with Green",text:"Whenever Invaders would Ravage or Build in a land with your <sacred>, you may prevent it by destroying one of your <presence> in that land.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.GreenChokeTheLandWithGreen,[r.GlobalReminder]:()=>({icon:"Skip<br><sacred>",ongoing:!0,spirit:a,players:[a]}),[r.PreventInvaderActionInLand]:async({land:t,invaderAction:n})=>{let i=!1;return n!==K.Ravage&&n!==K.Build||!t.hasSacredSiteOf(a)||await e.chooseBetween({highlightLocations:[t],effects:[{actionId:"DestroyPresence",text:"Destroy <presence> to prevent build.",[r.Now]:async()=>{i=!0,await e.sendEvent({type:T.GenericMain,text:`Choke the Land with Green used to prevent ${n} in ${t.coordinateLink}.`}),await t.destroy({pieces:e.Presence,owner:a})}},{actionId:"KeepPresence",text:"Keep <presence>."}]}),i}})}},{name:"Steady Regeneration",text:"When adding <presence> to the board via Growth, you may optionally use your destroyed <presence>. If the island is Healthy, do so freely. If the island is Blighted, doing so cost 1 Energy per destroyed <presence> you add.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.GreenSteadyRegeneration,[r.GlobalReminder]:()=>({icon:"<broken>",ongoing:!0,spirit:a,players:[a]}),[r.MayGrowWithDestroyedPresence]:async()=>{let t=!1;return await e.chooseBetween({effects:[{actionId:"Broken",label:"Use <broken>.",[r.Now]:async()=>{t=!0,await e.sendEvent({type:T.GenericMain,text:"Steady Regeneration used to add <broken>."}),e.blightStatus===Td.BlightedIsland&&await a.payEnergy(1)},condition:()=>a.destroyedPresence>0&&(a.energy>0||e.blightStatus===Td.HealthyIsland)},{actionId:"Tracks",label:"Use <presence> from tracks."}],autoPlayOneOption:!0}),t}})}}],pickOptions:[[0],[1,2,3]],growthOptions:[{effects:[{text:"Add a <presence> to Jungle or Wetland",[r.Now]:async({$:e,you:a})=>{const t=await e.oneEffectActivates(r.MayGrowWithDestroyedPresence);await a.addPresenceInRange(2,{filter:e=>e.isJungleOrWetlands,destroyed:t})}}]},{effects:[{text:"Reclaim cards",[r.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}}]},{effects:[{text:"Add a <presence> in <range-1>",[r.Now]:async({$:e,you:a})=>{const t=await e.oneEffectActivates(r.MayGrowWithDestroyedPresence);await a.addPresence({locations:g.WithinRange,range:1,destroyed:t})}},{text:"+1 Card Play This Turn",[r.Now]:async({you:e})=>{await e.gainCardPlays(1)}}]},{effects:[{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Gain +3 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(3)}}]}],tracks:[{energy:0,name:"Top-track: 0 Energy"},{requires:0,energy:1,name:"Top-track: 1 Energy"},{requires:1,elements:[i.Plant],name:"Top-track: Plant"},{requires:2,energy:2,name:"Top-track: 2 Energy"},{requires:3,energy:2,name:"Top-track: 2 Energy"},{requires:4,elements:[i.Plant],name:"Top-track: Plant"},{requires:5,energy:3,name:"Top-track: 3 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:7,cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:8,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:9,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:10,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:11,cardPlays:4,name:"Bottom-track: 4 Card Plays"}],setup:[{text:"Put 2 <presence> on your starting board: 1 in the highest-numbered Wetland, and 1 in the Jungle without any <dahan>.",[r.Now]:async({$:e,you:a})=>{await a.startingBoard.highestNumberedTerrain(Ft.Wetlands).putPresence(1,a),await a.startingBoard.inLandsFilteredByAllInPriority((e=>e.isJungle),(a=>a.doesntHave(e.Dahan))).autoPickOne((async e=>{await e.putPresence(1,a)}))}}],uniquePowers:[_e.FieldsChokedWithGrowth,_e.GiftOfProliferation,_e.OvergrowInANight,_e.StemTheFlowOfFreshWater],innatePowers:[_e.CreepersTearIntoMortar,_e.AllEnvelopingGreen],lore:"One of the older spirits on the island, though it's even more wild and exuberant these days than when it was young. Contrary to some stories, it does think things through - it's just far more concerned with the process of life than with things like 'consequences'.<br>It's not unfriendly to the Dahan, but its idea of a good time is to smother their buildings in all manner of inconvenient greenery, and its notion of \"help\" transforms careful cultivated areas into overgrown thickets. Entire villages have been known to move to fresh planting-sites years early if a spirit-speaker suspects that Rampant Green is going to stay in the area for too long.",playStyle:"Fairly good at dealing with Towns, but terrible at handling Explorers (who are unfazed by prolific foliage). Can get Presence onto the board faster than most other Spirits. Extra Presence is good for targeting and especially for 'Choke the Land with Green', which can be extremely effective at slowing down invaders. Just be careful not to destroy Sacred Sites needed for Power use.",complexity:"Moderate"},of={name:"Lightning's Swift Strike",set:s.Base,aspects:[ln.Pandemonium,ln.Wind,ln.Immense,ln.Sparking],specialRules:[{name:"Swiftness of Lightning",text:"For every <air> you have, you may use 1 <slow> Power as if it were <fast>. (Power Cards or your Innate Powers.)",[r.Now]:async({$:e,you:a})=>{const t=C.sH.box(0);await e.addSubEffect({effectId:pe.Lightning,[r.GlobalReminder]:()=>({icon:`<fast><br>${t.get()} / ${a.maxElementsWithConvert(i.Air)}`,ongoing:!0,spirit:a,players:[a]}),[r.MayChangeSpeedOfPower]:({power:e})=>e.isSlow&&e.owner===a&&a.hasElementsWithConvert({[i.Air]:t.get()+1}),[r.ChangeSpeedOfPower]:async({power:a})=>{await a.makeFast(),t.set(t.get()+1),await a.owner.convertElements({[i.Air]:t.get()}),await e.sendEvent({type:T.GenericMain,text:`Lightning's Swift Strike used Swiftness of Lightning to make ${a.powerLink} fast.`})},[r.TimePasses]:()=>(t.set(0),Promise.resolve())})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[r.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Gain +1 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(1)}}]},{effects:[{text:"Add a <presence> in <range-2>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(2)}},{text:"Add a <presence> in <range-0>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(0)}}]},{effects:[{text:"Add a <presence> in <range-1>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(1)}},{text:"Gain +3 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(3)}}]}],tracks:[{energy:1,name:"Top-track: 1 Energy"},{requires:0,energy:1,name:"Top-track: 1 Energy"},{requires:1,energy:2,name:"Top-track: 2 Energy"},{requires:2,energy:2,name:"Top-track: 2 Energy"},{requires:3,energy:3,name:"Top-track: 3 Energy"},{requires:4,energy:4,name:"Top-track: 4 Energy"},{requires:5,energy:4,name:"Top-track: 4 Energy"},{requires:6,energy:5,name:"Top-track: 5 Energy"},{cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:8,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:9,cardPlays:4,name:"Bottom-track: 4 Card Plays"},{requires:10,cardPlays:5,name:"Bottom-track: 5 Card Plays"},{requires:11,cardPlays:6,name:"Bottom-track: 6 Card Plays"}],setup:[{text:"Put 2 <presence> on your starting board in the highest-numbered Sands.",[r.Now]:async({you:e})=>{await e.startingBoard.highestNumberedTerrain(Ft.Sands).putPresence(2,e)}}],uniquePowers:[_e.HarbingersOfTheLightning,_e.LightningsBoon,_e.RagingStorm,_e.ShatterHomesteads],progression:[_e.DelusionsOfDanger,_e.CallToBloodshed,_e.Powerstorm,_e.PurifyingFlame,_e.PillarOfLivingFlame,_e.EntrancingApparitions,_e.CallToIsolation],innatePowers:[_e.ThunderingDestruction],lore:"The child of a passing storm-spirit, Lightning's Swift Strike danced off the shores of the island many ages ago, and liked it enough to stay. It spends much of its time resting and quiet, waking up to dance through the sky when the winds blow strong.<br>It only concerns itself occasionally with the Dahan, usually appearing out of nowhere to send them off on some obscure errand. The Dahan cooperate - partly out of wary respect for Lightning's power, but as much for the sake of the Thunderspeaker - Lightning's child - who is a patron and ally of their people.",playStyle:"Virtually all offense to start with: without a more defensive teammate, Blight may become a problem. Excellent at destroying buildings, less good at containing Explorers. Using Thundering Destruction tends to be a burst affair: a turn or two of position and build up Energy, followed by a really big turn.<br>Starting Powers are extremely focused on Air and Fire: good for Thundering Destruction, bad for Major Power versatility.",complexity:"Low"},df={name:"Ocean's Hungry Grasp",set:s.Base,aspects:[ln.Deeps],specialRules:[{name:"Ocean in Play",text:"You may add/move <presence> into Oceans, but may not add/move <presence> into Inland lands.<br><br>On boards with your <presence>, treat Oceans as Coastal Wetlands for Powers and <blight>.<br><br>You Drown any Invaders or <dahan> moved to those oceans.",effects:[{text:"You may add/move <presence> into Oceans, but may not add/move <presence> into Inland lands.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Ocean,[r.GlobalReminder]:()=>({text:"You may add/move <presence> into Oceans, but may not add/move <presence> into Inland lands.<br><br>On boards with your <presence>, treat Oceans as Coastal Wetlands for Powers and <blight>.<br><br>You Drown any Invaders or <dahan> moved to those oceans.",icon:"Oceans<br><wetlands>",ongoing:!0,spirit:a}),[r.PreventAddPresence]:({spirit:e,location:t,ignoreLandType:n})=>e===a&&t.isInland&&!n,[r.PreventMovePiece]:({piece:e,destination:t})=>e.isAPresenceOf(a)&&t.isInland})}},{[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Ocean,text:"On boards with your <presence>, treat Oceans as Coastal Wetlands for Powers and <blight>.",[r.OceanIsLand]:({location:t})=>e.currentActionType===en.PowerAction&&t.boardsHasPresenceOf(a),[r.OceanIsLandForBlight]:({location:e})=>e?.boardsHasPresenceOf(a)??!1,[r.LocationIsTerrain]:({location:e,terrain:a})=>a===Ft.Wetlands&&e.isOceanAndLand,[r.AfterRemovePiece]:async({piece:t,location:n})=>{e.currentActionType===en.PowerAction&&t.isAPresenceOf(a)&&!n.boardsHasPresenceOf(a)&&await e.addEffectUntilEndOfActionTree({[r.OceanIsLand]:e=>n.boards().items.map((e=>e.ocean)).includes(e.location),[r.OceanIsLandForBlight]:e=>void 0!==e.location&&n.boards().items.map((e=>e.ocean)).includes(e.location)})}})}},{text:"You Drown any Invaders or <dahan> moved to those oceans.",[r.Now]:async({$:e,...a})=>{const t={triggerId:e.nextTriggerId(),[r.Now]:async({action:e})=>{for(const a of e.parentData.invadersToDrown)a.isAlive&&a.location?.type===an.Ocean&&await a.drown()}};await e.addSubEffect({effectId:pe.Ocean,[r.AfterMoving]:async({destination:n,piece:r,movement:i})=>{n.type===an.Ocean&&r.location===n&&r.isA(e.InvaderOrDahan)&&i!==q.Relocate&&(void 0===e.action.data.invadersToDrown&&(e.action.data.invadersToDrown=[]),e.action.data.invadersToDrown.push(r),await e.addTrigger(t,a.effect,a.action,{movingAction:e.action}))}})}}]},{name:"Drowning",text:"Destroys Drowned pieces, placing Drowned Invaders on your Spirit board.<br><br>At any time you may exchange (X) Health of these Invaders for 1 Energy, where X = number of players. (Ignore modifiers to Invader Health.)",effects:[{text:"Destroys Drowned pieces, placing Drowned Invaders here.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Ocean,[r.GlobalReminder]:()=>({text:`Destroys Drowned pieces, placing Drowned Invaders on your Spirit board.<br><br>At any time you may exchange ${e.spiritCount} Health of these Invaders for 1 Energy. (Ignore modifiers to Invader Health.)`,icon:"Drowning",ongoing:!0,spirit:a,players:[a]}),[r.AfterRemovePiece]:({piece:e,removement:t})=>(t===A.Drown&&(e.piece!==p.Explorer&&e.piece!==p.Town&&e.piece!==p.City||(a.panelPieces[e.piece]+=1)),Promise.resolve())})}},{text:"At any time you may exchange (X) Health of these Invaders for 1 Energy, where X = number of players. (Ignore modifiers to Invader Health.)",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Ocean,[r.BeforePayEnergy]:async({spirit:t,amount:n})=>{let r=n;for(;t===a&&r>t.innateEnergy;){const n=Math.floor(a.healthWorthOfDrownedInvaders/e.spiritCount),i=Math.min(r-t.innateEnergy,n),s=i*e.spiritCount;for(;a.panelPieces[p.Explorer]<s;)if(a.panelPieces[p.City]>0)a.panelPieces[p.City]-=1,a.panelPieces[p.Explorer]+=3;else{if(!(a.panelPieces[p.Town]>0))throw new Error("Unable to pay for Ocean energy. This should never happen.");a.panelPieces[p.Town]-=1,a.panelPieces[p.Explorer]+=2}a.panelPieces[p.Explorer]-=s,await e.sendEvent({type:T.GenericSub,text:`Ocean consumed ${s} health worth of Invaders.`});r-=(await a.gainEnergy(i)).amount}}})}}]}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[r.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Gather 1 Presence into EACH Ocean",[r.Now]:({you:e,$:a})=>a.onEachBoard((async t=>{await t.ocean.gather({amount:1,pieces:a.Presence,owner:e,oceanIsAllowed:!0})}))},{text:"Gain +2 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(2)}}]},{effects:[{text:"Add a <presence> in any Ocean",[r.Now]:async({you:e})=>{await e.addPresenceInAnyOcean()}},{text:"Add a <presence> in any Ocean",[r.Now]:async({you:e})=>{await e.addPresenceInAnyOcean()}},{text:"Gain +1 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(1)}}]},{effects:[{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Push 1 Presence from EACH Ocean",[r.Now]:({you:e,$:a})=>a.onEachBoard((async t=>{await t.ocean.push({amount:1,pieces:a.Presence,owner:e,oceanIsAllowed:!0})}))},{text:"Add a <presence> to Coastal Land",[r.Now]:async({you:e})=>{await e.addPresenceInRange(1,{filter:e=>e.isCoastal})}}]}],tracks:[{energy:0,name:"Top-track: 0 Energy"},{requires:0,elements:[i.Moon],name:"Top-track: Moon"},{requires:1,elements:[i.Water],name:"Top-track: Water"},{requires:2,energy:1,name:"Top-track: 1 Energy"},{requires:3,elements:[i.Earth],name:"Top-track: Earth"},{requires:4,elements:[i.Water],name:"Top-track: Water"},{requires:5,energy:2,name:"Top-track: 2 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:7,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:8,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:9,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:10,cardPlays:4,name:"Bottom-track: 4 Card Plays"},{requires:11,cardPlays:5,name:"Bottom-track: 5 Card Plays"}],setup:[{text:"Put 2 <presence> on your starting board: 1 in the Ocean, and 1 in a Coastal land of your choice.",[r.Now]:async({you:e})=>{await e.startingBoard.ocean.putPresence(1,e),await e.startingBoard.inCoastalLands().pickOne((async a=>{await a.putPresence(1,e)}))}}],uniquePowers:[_e.CallOfTheDeeps,_e.GraspingTide,_e.SwallowTheLanddwellers,_e.TidalBoon],innatePowers:[_e.PoundShipsToSplinters,_e.OceanBreaksTheShore],lore:"The hunger of the ocean runs deep and powerful, sometimes patient, sometimes tempestuous and angry. It slowly wears away at rocky shores, or devours half an island during a hurricane. It lures humans out onto the water with its sire call, then consumes ship and crew alike unless the proper offerings are made.<br>The ocean's voraciousness keeps the Dahan from frequent sea travel, though they still manage a trading expedition every decade or so. These trading-trips take the cooperation of several families, and always involve at least two spirit-speakers. That way, even if one perishes abroad, the expedition will still be able to get home.",playStyle:"Extremely good at assaulting the coasts where the Invaders start out strong, but quite weak island - the ocean is not accustomed to affecting events so far ashore. Its Presence shifts in and out like the tide, which can be tricky to manage, but permits re-positioning and tactical retreats or offensives in the hands of a skillful player. Has fairly inexpensive Unique Powers, but the energy gained from drowning Invaders can be necessary in stepping up to more potent Powers.",complexity:"High"},cf={name:"River Surges in Sunlight",set:s.Base,aspects:[ln.Sunshine,ln.Travel,ln.Haven],specialRules:[{name:"River's Domain",text:"Your <presence> in Wetlands count as <sacred>.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.River,[r.GlobalReminder]:()=>({icon:"<wetlands><br><sacred>",ongoing:!0,spirit:a,players:[a]}),[r.HasSacredSiteOf]:({land:e,spirit:t,helpers:n})=>t===a&&e.hasTerrain(Ft.Wetlands,!0)&&e.hasPresenceOf(a,n)})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[r.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Gain +1 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(1)}}]},{effects:[{text:"Add a <presence> in <range-1>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(1)}},{text:"Add a <presence> in <range-1>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(1)}}]},{effects:[{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-2>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(2)}}]}],tracks:[{energy:1,name:"Top-track: 1 Energy"},{requires:0,energy:2,name:"Top-track: 2 Energy"},{requires:1,energy:2,name:"Top-track: 2 Energy"},{requires:2,energy:3,name:"Top-track: 3 Energy"},{requires:3,energy:4,name:"Top-track: 4 Energy"},{requires:4,energy:4,name:"Top-track: 4 Energy"},{requires:5,energy:5,name:"Top-track: 5 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:7,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:8,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:9,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:10,effect:{actionId:"ReclaimOne",text:"Reclaim One",[r.Now]:async({you:e})=>{await e.reclaim(1)}},effectRequires:({you:e})=>e.hasReclaimableCards,name:"Bottom-track: Reclaim One"},{requires:11,cardPlays:4,name:"Bottom-track: 4 Card Plays"},{requires:12,cardPlays:5,name:"Bottom-track: 5 Card Plays"}],setup:[{text:"Put 1 <presence> on your starting board in the highest-numbered Wetlands.",[r.Now]:async({you:e})=>{await e.startingBoard.highestNumberedTerrain(Ft.Wetlands).putPresence(1,e)}}],uniquePowers:[_e.BoonOfVigor,_e.FlashFloods,_e.RiversBounty,_e.WashAway],progression:[_e.UncannyMelting,_e.NaturesResilience,_e.PullBeneathTheHungryEarth,_e.AcceleratedRot,_e.SongOfSanctity,_e.Tsunami,_e.EncompassingWard],innatePowers:[_e.MassiveFlooding],lore:"On most of Spirit Island, the rivers run high during the rainy season, as one would expect. There is one exception: the lingering remains of an ancient curse keep a high ridge shrouded in ice, and when the sun beats down, it feeds a single river with abundant meltwater.<br>River Surges in Sunlight is a spirit of rushing water, inundation, and bounty out of season.<br>It gets along well with the Dahan who farm along its banks; they reap the benefit of good harvests, and tend to the health of the river in its drier times. Both gain.",playStyle:"While capable of some direct offense, River Surges in Sunlight is best at flooding out Explorers and Towns, displacing them from lands where they might Build or Ravage.<br>The ability to get free Sacred Sites makes a wide range of Powers more useful.",complexity:"Low"},lf={name:"Shadows Flicker like Flame",set:s.Base,aspects:[ln.Madness,ln.Reach,ln.Amorphous,ln.Foreboding,ln.DarkFire],specialRules:[{name:"Shadows of the Dahan",text:"Whenever you use a Power, you may pay 1 Energy to target a land with <dahan> regardless of the Power's range. (Power Cards or your Innate Powers.)",uses:1,[r.Now]:async({$:e,you:a})=>{const t=[];await e.addSubEffect({effectId:pe.Shadows,[r.GlobalReminder]:()=>({icon:"Ignore<br>Range",ongoing:!0,spirit:a,players:[a]}),[r.MayIgnoreRangeWhenTargetingLand]:({land:n,power:r,afterTargeting:i})=>!e.action.data.disableIgnoreRange&&(r.owner.energy>0||!0===i||t.includes(r))&&r.owner===a&&n.has(e.Dahan),[r.AfterTargetingLand]:async({targetIndex:n,land:r,power:i})=>{i.owner===a&&(e.action.data.disableIgnoreRange=!0,t.includes(i)||i.validLandTargets({targetIndex:n}).has(r)||(await e.sendEvent({type:T.GenericMain,text:`Shadows Flicker like Flame used Shadows of the Dahan to target ${r.coordinateLink}.`}),await a.payEnergy(1),t.push(i)),e.action.data.disableIgnoreRange=!1)},[r.AfterPowerLeavesPlay]:({power:e})=>(ae(t,e),Promise.resolve())})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[r.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}}]},{effects:[{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-1>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(1)}}]},{effects:[{text:"Add a <presence> in <range-3>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(3)}},{text:"Gain +3 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(3)}}]}],tracks:[{energy:0,name:"Top-track: 0 Energy"},{requires:0,energy:1,name:"Top-track: 1 Energy"},{requires:1,energy:3,name:"Top-track: 3 Energy"},{requires:2,energy:4,name:"Top-track: 4 Energy"},{requires:3,energy:5,name:"Top-track: 5 Energy"},{requires:4,energy:6,name:"Top-track: 6 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:6,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:7,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:8,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:9,cardPlays:4,name:"Bottom-track: 4 Card Plays"},{requires:10,cardPlays:5,name:"Bottom-track: 5 Card Plays"}],setup:[{text:"Put 3 <presence> on your starting board: 2 in the highest-numbered Jungle and 1 in land #5.",[r.Now]:async({you:e})=>{await e.startingBoard.highestNumberedTerrain(Ft.Jungles).putPresence(2,e),await e.startingBoard.inLandNumber(5).putPresence(1,e)}}],uniquePowers:[_e.ConcealingShadows,_e.CropsWitherAndFade,_e.FavorsCalledDue,_e.MantleOfDread],progression:[_e.DarkAndTangledWoods,_e.ShadowsOfTheBurningForest,_e.TheJungleHungers,_e.LandOfHauntsAndEmbers,_e.TerrifyingNightmares,_e.CallOfTheDahanWays,_e.VisionsOfFieryDoom],innatePowers:[_e.DarknessSwallowsTheUnwary],lore:"The Dahan say, \"If the long shadows of sunset stretching beside you begin to shift and flicker like tongues of hungry fire, do not run. That will only feed your fear, and whet the shadows' appetite.\"<br>This spirit invokes an instinctive fear in humans, perhaps because it doesn't think at all like humans do - it's more alien-minded than most. Until a few generations ago, the Dahan carefully propitiated it only at a distance, steering as clear as they could. But during the Years of The Relentless Sun, it shaded large swaths of the Island, averting catastrophe; since then, many Dahan have been willing to carefully - and cautiously - heed its words, feeling they have a debt they ought to try to repay.<br>",playStyle:"Good at causing Fear and picking off lone Explorers and Towns, containing the Invaders. Not so good at massive damage - may need to rely on allies to handle thoroughly colonized lands.<br>The ability to boost Range gives more flexibility to Range 0 Powers, and can be important in larger games.",complexity:"Low"},hf={name:"Thunderspeaker",set:s.Base,aspects:[ln.Tactician,ln.Warrior],specialRules:[{name:"Ally of the Dahan",text:"Your <presence> may move with <dahan>. (Whenever a <dahan> moves from 1 of your lands to another land, you may move 1 <presence> along with it.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Thunderspeaker,[r.GlobalReminder]:()=>({icon:"Ally<br><dahan>",ongoing:!0,spirit:a,players:[a]}),[r.BeforeMoving]:async({destination:t,source:n,piece:i,movement:s})=>{i.isA(e.Dahan)&&n.hasPresenceOf(a)&&s!==q.Relocate&&await e.chooseBetween({highlightLocations:[n],effects:[{actionId:"Move",text:"Move 1 <presence> with <dahan>.",[r.Now]:async()=>{await n.presenceOf(a).autoPickOne((async e=>{await e.move({locations:{target:g.ToThisLocation,location:t},movement:q.Bring,withoutWait:!0})}))}},{actionId:"Stay",text:"Stay with <presence>."}]})}})}},{name:"Sworn to Victory",text:"For Each <dahan> destroyed by Invaders Ravaging a land, destroy 1 of your <presence> within <range-1>. (After losing <presence> to <blight>, if relevant.)",[r.Now]:async({$:e,you:a,...t})=>{const n={triggerId:e.nextTriggerId(),[r.Now]:async({action:t})=>{await e.sendEvent({type:T.GenericMain,text:`Sworn to Victory triggered in ${t.parentData.ravagedLand.coordinateLink}.`}),t.parentData.ravagedLand.inLandsWithin(1,a).hasOneWhere((e=>e.has(Z.IncarnaWarrior)))&&(await e.may({prompt:"Count <incarna-warrior> as Presence?"})||e.dontCountAs(p.Presence)),await te(t.parentData.dahanDestroyedInRavage,(async e=>{await t.parentData.ravagedLand.forPiecesWithin(1,a).where((e=>e.isAPresenceOf(a))).pickOne((async e=>{await e.destroy()}),{noOptions:"No land within <range-1> with your <presence>.",prompt:`Pick a land to destroy a <presence>. ${t.parentData.dahanDestroyedInRavage-e} left.`})}))}};await e.addSubEffect({effectId:pe.Thunderspeaker,[r.GlobalReminder]:()=>({icon:"Sworn<br><broken>",ongoing:!0,spirit:a,players:[a]}),[r.AfterDahanDestroyedInRavage]:async({land:a,amount:r})=>{e.action.data.dahanDestroyedInRavage=e.action.data.dahanDestroyedInRavage??0+r,e.action.data.ravagedLand=a,await e.addTrigger(n,t.effect,t.action)}})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[r.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}}]},{effects:[{text:"Add a <presence> in <range-2> to Land with Dahan ",[r.Now]:async({you:e,$:a})=>{await e.addPresenceInRange(2,{filter:e=>e.has(a.Dahan)})}},{text:"Add a <presence> in <range-1> to Land with Dahan",[r.Now]:async({you:e,$:a})=>{await e.addPresenceInRange(1,{filter:e=>e.has(a.Dahan)})}}]},{effects:[{text:"Add a <presence> in <range-1>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(1)}},{text:"Gain +4 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(4)}}]}],tracks:[{energy:1,name:"Top-track: 1 Energy"},{requires:0,elements:[i.Air],name:"Top-track: Air"},{requires:1,energy:2,name:"Top-track: 2 Energy"},{requires:2,elements:[i.Fire],name:"Top-track: Fire"},{requires:3,elements:[i.Sun],name:"Top-track: Sun"},{requires:4,energy:3,name:"Top-track: 3 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:6,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:7,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:8,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:9,effect:{actionId:"ReclaimOne",text:"Reclaim One",[r.Now]:async({you:e})=>{await e.reclaim(1)}},effectRequires:({you:e})=>e.hasReclaimableCards,name:"Bottom-track: Reclaim One"},{requires:10,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:11,cardPlays:4,name:"Bottom-track: 4 Card Plays"}],setup:[{text:"Put 2 <presence> on your starting board: 1 in each of the 2 lands with the most <dahan>.",[r.Now]:async({$:e,you:a})=>{const t=a.startingBoard.inLandsWithMost((a=>a.numberOf(e.Dahan)));let n=null;2===t.count?n=t.anyOne:await t.autoPickOne((e=>(n=e,Promise.resolve()))),await n.putPresence(1,a),await a.startingBoard.inLandsWithMost((a=>a===n?0:a.numberOf(e.Dahan))).autoPickOne((async e=>{await e.putPresence(1,a)}))}}],uniquePowers:[_e.ManifestationOfPowerAndGlory,_e.SuddenAmbush,_e.VoiceOfThunder,_e.WordsOfWarning],innatePowers:[_e.GatherTheWarriors,_e.LeadTheFuriousAssault],lore:"Child of the Lightning, once known as Bright Thunder Roars in the days when it tore across the land as an avalanche of sound and chaos. It lost that form when the Stalker of Hidden Secrets imprisoned it in a canyon, binding it to echo perpetually back and forth until its thunder died out or the stones of the island wore away.<br>The Dahan freed it from that imprisonment. Weakened but grateful, Bright Thunder Roars bound itself to aid the Dahan until a generation had passed for every year of its imprisonment, and in so binding changed its nature, becoming both less and more than it had been. It often takes human form, now, and with centuries' practice wears it with ease.<br>Chiefs call on the Thunderspeaker only in times of great need; it has not been much seen since the destruction of the Servant Cults.",playStyle:"Has a keen interest in where the Dahan are - partly because so many of its starting powers work through them partly because its Presence can move along with them. When picking new Power Cards, it will often want to take good Dahan-centric Powers, but it can also branch out into other areas.",complexity:"Moderate"},gf={name:"Sharp Fangs Behind the Leaves",set:s.BranchAndClaw,aspects:[ln.Encircle,ln.Unconstrained],specialRules:[{name:"Ally of the Beasts",text:"Your <presence> may move with <beasts>. (Whenever a <beasts> moves from 1 <presence> along with it.)",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.FangsAllyOfTheBeasts,[r.GlobalReminder]:()=>({icon:"Ally<br><beasts>",ongoing:!0,spirit:a,players:[a]}),[r.BeforeMoving]:async({destination:t,source:n,piece:i,movement:s})=>{i.isA(e.Beasts)&&n.hasPresenceOf(a)&&s!==q.Relocate&&await e.chooseBetween({effects:[{actionId:"Move",text:"Move 1 <presence> with <beasts>.",[r.Now]:async()=>{await n.presenceOf(a).autoPickOne((async e=>{await e.move({locations:{target:g.ToThisLocation,location:t},withoutWait:!0})}))}},{actionId:"Stay",text:"Stay with <presence>."}]})}})}},{name:"Call Forth Predators",text:"During each Spirit Phase, you may replace 1 of your <presence> with 1 <beasts>. The replaced <presence> leaves the game. (It was not destroyed, so things which return destroyed <presence> cannot bring it back.).",[r.Now]:async({$:e,you:a})=>{await a.addExtraAction({effectId:pe.FangsCallForthPredators,actionId:"CallForthPredators",icon:"+1 <beasts>",enabled:()=>e.phase===Xe.Grow||e.phase===Xe.GainEnergy,onActivate:async()=>{await a.presence().pickOne((async a=>{const t=a.location;await a.remove(A.RemoveFromGame),await t.add(1,e.Beasts)}),{text:"Replace 1 of your <presence> with 1 <beasts>."})}})}}],pickOptions:[[0,1,2,3],[0,1,2,3]],growthOptions:[{cost:1,effects:[{text:"Reclaim cards",[r.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}}]},{effects:[{text:"Add a <presence> in <range-3>",[r.Now]:async({you:e,$:a})=>{await e.addPresenceInRange(3,{filter:e=>e.isJungle||e.has(a.Beasts)})}}]},{effects:[{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Gain +1 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(1)}}]},{effects:[{text:"Gain +3 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(3)}}]}],tracks:[{energy:1,name:"Top-track: 1 Energy"},{requires:0,elements:[i.Animal],name:"Top-track: Animal"},{requires:1,elements:[i.Plant],name:"Top-track: Plant"},{requires:2,energy:2,name:"Top-track: 2 Energy"},{requires:3,elements:[i.Animal],name:"Top-track: Animal"},{requires:4,energy:3,name:"Top-track: 3 Energy"},{requires:5,energy:4,name:"Top-track: 4 Energy"},{cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:7,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:8,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:9,effect:{actionId:"ReclaimOne1",text:"Reclaim One",[r.Now]:async({you:e})=>{await e.reclaim(1)}},effectRequires:({you:e})=>e.hasReclaimableCards,name:"Bottom-track: Reclaim One"},{requires:10,cardPlays:4,name:"Bottom-track: 4 Card Plays"},{requires:11,cardPlays:5,effect:{actionId:"ReclaimOne2",text:"Reclaim One",[r.Now]:async({you:e})=>{await e.reclaim(1)}},effectRequires:({you:e})=>e.hasReclaimableCards,name:"Bottom-track: 5 Card Plays, Reclaim One"}],setup:[{text:"Put 1 <presence> and 1 <beasts> on your starting board in the highest-numbered Jungle.",[r.Now]:async({you:e,$:a})=>{const t=e.startingBoard.highestNumberedTerrain(Ft.Jungles);await t.putPresence(1,e),await t.add(1,a.Beasts)}},{text:"Put 1 <presence> in a land of your choice with <beasts> anywhere on the island.",[r.Now]:async({you:e,$:a})=>{await a.inLandsWith(a.Beasts).autoPickOne((async a=>{await a.putPresence(1,e)}))}}],uniquePowers:[_e.PreyOnTheBuilders,_e.TeethGleamFromDarkness,_e.TerrifyingChase,_e.TooNearTheJungle],innatePowers:[_e.RangingHunt,_e.FrenziedAssault],lore:"A predator-spirit of the jungles, a stalker and hunter of animal and human alike. Wherever it lives, savage beasts emerge to hunt, and the jungle grows dark and ominous.<br>Sharp Fangs doesn't bother talking to the Dahan. Sometimes it will hunt them, or run them off, but for the most part it ignores them. The Dahan's legends tell of a time when Sharp Fangs hunted them more actively, until a pair of warriors - twins, sister and brother - drove it off with traps and guile, then turned the tables and hunted it down. Since then, it has seen the Dahan as not-entirely-prey, which, for it, is something akin to respect.",playStyle:'All about Beasts and Jungles. Can be very fast out of the gate, but doesn\'t have the late-game power that some spirits do, and is likely to have some difficulty with Blighted areas. "Ranging Hunt" is a critical Innate ability, particularly in early-game: it simultaneously gives Beasts mobility and permits picking off a stray Explorers or Towns on most turns.',complexity:"Moderate"},ff={name:"Keeper of the Forbidden Wilds",set:s.BranchAndClaw,aspects:[ln.SpreadingHostility],specialRules:[{name:"Forbidden Ground",text:"Any time you create a <sacred>, Push all <dahan> from that land.<br><br>Dahan Events never move <dahan> to your <sacred>, but Powers can do so.",effects:[{text:"Any time you create a <sacred>, Push all <dahan> from that land.",[r.Now]:async({$:e,you:a,...t})=>{const n={triggerId:e.nextTriggerId(),[r.Now]:async({action:a})=>{for(const t of a.parentData.landBecameSacredSite)await t.pushAll(e.Dahan)}};await e.addSubEffect({effectId:pe.Keeper,[r.GlobalReminder]:()=>({text:"Any time you create a <sacred>, Push all <dahan> from that land.<br><br>Dahan Events never move <dahan> to your <sacred>, but Powers can do so.",icon:"<sacred>",ongoing:!0,spirit:a,players:[a]}),[r.AfterLandChangesAmountOfPresence]:async({land:r,spirit:i,amountBefore:s,amountAfter:o})=>{o>=2&&s<2&&i===a&&(void 0===e.action.data.landBecameSacredSite&&(e.action.data.landBecameSacredSite=[]),e.action.data.landBecameSacredSite.includes(r)||e.action.data.landBecameSacredSite.push(r),await e.addTrigger(n,t.effect,t.action))}})}},{text:"Dahan Events never move <dahan> to your <sacred>, but Powers can do so.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Keeper,[r.PreventMovePiece]:({piece:t,destination:n,movement:r})=>e.action.type===en.DahanEventAction&&t.isA(e.Dahan)&&r!==q.Relocate&&n.hasSacredSiteOf(a)})}}]}],pickOptions:[[0,1,2,3],[0,1,2,3]],growthOptions:[{effects:[{text:"Reclaim cards",[r.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain +1 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(1)}}]},{effects:[{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}}]},{effects:[{text:"Add a <presence> in <range-3> to Land with Wilds or Your Presence",[r.Now]:async({you:e,$:a})=>{await e.addPresenceInRange(3,{filter:t=>t.has(a.Wilds)||t.hasPresenceOf(e)})}},{text:"Gain +1 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(1)}}]},{cost:3,effects:[{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-3> to Land without Blight",[r.Now]:async({you:e,$:a})=>{await e.addPresenceInRange(3,{filter:e=>!e.has(a.Blight)})}}]}],tracks:[{energy:2,name:"Top-track: 2 Energy"},{requires:0,elements:[i.Sun],name:"Top-track: Sun"},{requires:1,energy:4,name:"Top-track: 4 Energy"},{requires:2,energy:5,name:"Top-track: 5 Energy"},{requires:3,elements:[i.Plant],name:"Top-track: Plant"},{requires:4,energy:7,name:"Top-track: 7 Energy"},{requires:5,energy:8,name:"Top-track: 8 Energy"},{requires:6,energy:9,name:"Top-track: 9 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:8,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:9,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:10,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:11,cardPlays:4,name:"Bottom-track: 4 Card Plays"},{requires:12,cardPlays:5,effect:{actionId:"ReclaimOne",text:"Reclaim One",[r.Now]:async({you:e})=>{await e.reclaim(1)}},effectRequires:({you:e})=>e.hasReclaimableCards,name:"Bottom-track: 5 Card Plays, Reclaim One"}],setup:[{text:"Put 1 <presence> and 1 <wilds> on your starting board in the highest-numbered Jungle.",[r.Now]:async({you:e,$:a})=>{const t=e.startingBoard.highestNumberedTerrain(Ft.Jungles);await t.putPresence(1,e),await t.add(1,a.Wilds)}}],uniquePowers:[_e.BoonOfGrowingPower,_e.RegrowFromRoots,_e.SacrosanctWilderness,_e.ToweringWrath],innatePowers:[_e.PunishThoseWhoTrespass,_e.SpreadingWilds],lore:"Spread throughout Spirit Island are pockets of deep wilderness, untouched by human hands. A few have a spirit of sanctity about them. The leaves there whisper words of forbiddance, of warnings, of wrath for those who trespass. The Dahan know how to listen, and stay well away.<br>A few spirit-seekers claim that these wild-spirits (powerful as they are) are merely custodians and wardens for other more powerful, spirits of ancient trees and deep roots who wake neither frequently nor easily. Nobody much cares to test the truth of the matter.",playStyle:"A slowly growing wall - expanding can sometimes be difficult, but the Invaders will have an equally difficult time penetrating wherever the Keeper plants itself.<br>In larger games, it may be useful to spread to one of the two far-distant lands early on, to have multiple points from which to slowly grow.",complexity:"Moderate"},uf={name:"Downpour Drenches the World",set:s.FeatherAndFlame,aspects:[],specialRules:[{name:"Drench the Landscape",text:"Spirit Actions and Special Rules treat your <sacred> as Wetlands in addition to the printed terrain.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Downpour,[r.GlobalReminder]:()=>({icon:"<sacred><br>= <wetlands>",ongoing:!0,spirit:a,players:[a]}),[r.LocationIsTerrain]:({location:t,terrain:n,isSpecialRule:r})=>n===Ft.Wetlands&&t.hasSacredSiteOf(a)&&([en.SpiritAction,en.PowerAction].includes(e.action.type)||r)})}},{name:"Pour Down Power Across the Island",text:"For each 2 <water> you have: during the <fast>/<slow> phase you may either:<br><br>Gain 1 Energy<or>Repeat one of your land-targeting Power Cards by paying its cost again. (It need not target the same land.)<br><br>(Max. 5 times per turn, no matter how much <water> you have.)",[r.Now]:async({$:e,you:a})=>{await a.addExtraAction({actionId:"PourDownPower",icon:"<water>",maxUses:()=>Math.min(a.numberOfElementCombos({[i.Water]:2}),5),enabled:()=>e.phase===Xe.FastPowers||e.phase===Xe.SlowPowers,onActivate:async()=>{await e.chooseBetween({effects:[{actionId:"Energy",text:"Gain 1 Energy",[r.Now]:async()=>{await a.gainEnergy(1)}},{actionId:"Repeat",text:"Repeat one of your land-targeting Power Cards by paying its cost again.",[r.Now]:async()=>{await e.addSubEffectUntilEndOfTurn({[r.GlobalReminder]:()=>({icon:"Repeat<br>Power",players:[a]}),[r.MayRepeatPowercard]:({power:e,speed:t})=>e.owner===a&&e.costToPlay<=a.energy&&e.data.type!==o.Innate&&e.data.target===c.Land&&e.possibleToRepeatAtSpeed(t),[r.RepeatPowerCard]:async({power:a,speed:t})=>{e.removeThisEffect(),await a.payForPlay(),await a.replay(t)}})}}]})}})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[r.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Move a <presence> in <range-2>",[r.Now]:async({you:e})=>{await e.movePresence(2)}}]},{effects:[{text:"Add a <presence> in <range-2>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(2)}},{text:"Add a <presence> in <range-2>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(2)}},{text:"Gain 2 Water",[r.Now]:async({you:e})=>{await e.gainElementsUntilEndOfTurn({[i.Water]:2})}},{text:"Discard 2 Power Cards",[r.Now]:async({you:e})=>{await e.discardPowerCards(2)}}]},{effects:[{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-3>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(3)}},{text:"Gain +1 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(1)}}]}],tracks:[{energy:1,name:"Top-track: 1 Energy"},{requires:0,elements:[i.Water],name:"Top-track: Water"},{requires:1,elements:[i.Plant],name:"Top-track: Plant"},{requires:2,elements:[i.Water],name:"Top-track: Water"},{requires:3,energy:2,elements:[i.Air],name:"Top-track: 2 Energy, Air"},{requires:4,elements:[i.Water],name:"Top-track: Water"},{requires:5,elements:[i.Earth],name:"Top-track: Earth"},{requires:6,elements:[i.Water,i.Water],name:"Top-track: 2 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:8,effect:{actionId:"MovePresence1",text:"Move a <presence> 1",[r.Now]:async({you:e})=>{await e.movePresence(1)}},name:"Bottom-track: Move a Presence 1"},{requires:9,elements:[i.Water],name:"Bottom-track: Water"},{requires:10,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:11,effect:{actionId:"MovePresence2",text:"Move a <presence> 1",[r.Now]:async({you:e})=>{await e.movePresence(1)}},name:"Bottom-track: Move a Presence 1"},{requires:12,cardPlays:3,name:"Bottom-track: 3 Card Plays"}],setup:[{text:"Put 1 <presence> on your starting board in the lowest-numbered Wetland.",[r.Now]:async({you:e})=>{await e.startingBoard.lowestNumberedTerrain(Ft.Wetlands).putPresence(1,e)}}],uniquePowers:[_e.DarkSkiesLooseAStingingRain,_e.FoundationsSinkIntoMud,_e.GiftOfAbundance,_e.UnbearableDeluge],innatePowers:[_e.RainAndMudSuppressConflict,_e.WaterNourishesLifesGrowth],lore:'The deluge. As the Dahan say, "When the very air turns to water and the sound of rainfall drowns out all but the loudest of thunder, at that moment when it could not conceivably pour any more - and then suddenly, impossibly, it is raining twice as much - that is the downpour."<br>A Spirit of the high skies bridging to the earth below with a cascading torrent of water, rain blowing on the wind and soaking the ground. Flies back and forth across the boundary between water which brings life and growth, and water which overwhelms everything save the plants and soil entwined in each other\'s protection.',playStyle:'Cares about the question "How useful is this Power in the current context?" even more than most Spirits; it rarely plays all its Power Cards in any given Reclaim cycle (some get discarded to Growth), and for those it does play, it often has the option of using them multiple times.<br>Benefits even more than most Spirits from having lots of Presence on the board, both for Rain and Mud Suppress Conflict and to facilitate its Unique Powers (by making more lands Wetlands).',complexity:"High"},pf={name:"Finder of Paths Unseen",set:s.FeatherAndFlame,aspects:[],specialRules:[{name:"Responsibilities to the Dead",text:"After one of your Actions Destroys 1 or more <dahan>/Invaders, or directly triggers their Destruction by moving them, Destroy 1 of your <presence> and lose 1 Energy. If you have no Energy to lose, Destroy another <presence>.",[r.Now]:async({$:e,you:a,...t})=>{const n={triggerId:e.nextTriggerId(),[r.Now]:async()=>{await e.sendEvent({type:T.GenericMain,text:`${a.nameLink} paid responsibilities to the Dead.`}),await a.destroyPresence(1),a.energy>=1?await a.loseEnergy(1):await a.destroyPresence(1)}};await e.addSubEffect({effectId:pe.Finder,[r.GlobalReminder]:()=>({icon:"<broken>",ongoing:!0,spirit:a,players:[a]}),[r.AfterRemovePiece]:async({piece:r,removement:i})=>{r.isA(e.InvaderOrDahan)&&x[i].isDestroyLike&&(e.action.spirit===a||e.action.data.movingAction?.spirit===a)&&await e.addTrigger(n,t.effect,t.action)}})}},{name:"Open the Ways",text:"You may make up to two of your lands adjacent at a time. You may change which lands are adjacent once between Actions.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Finder,[r.GlobalReminder]:()=>({text:"Your lands are adjacent to each other, except for Invader and Adversary Actions.<br><br>(House Rule Variant)",icon:"Open<br>Ways",ongoing:!0,spirit:a,players:[a]}),[r.StartOfRavageStep]:()=>(e.setupAdjacencies(),Promise.resolve()),[r.StartOfSlowPhase]:()=>(e.setupAdjacencies(),Promise.resolve()),[r.AfterLandChangesAmountOfPresence]:async({amountBefore:t,amountAfter:n,spirit:i})=>{i===a&&e.phase!==Xe.SetupPresence&&(t>0&&0===n||0===t&&n>0)&&await e.addSubEffectUntilEndOfAction({[r.ActionEnds]:()=>(e.setupAdjacencies(),Promise.resolve())})},[r.ExtraAdjacency]:()=>{const t=[];if(![Xe.HighImmigration,Xe.Ravage,Xe.Build,Xe.Explore].includes(e.phase))for(const e of a.lands)for(const n of a.lands)e!==n&&t.push({land1:e,land2:n});return t}})}}],pickOptions:[[0,1,2,3]],growthOptions:[{effects:[{text:"Reclaim cards",[r.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"You may ignore Range this turn",[r.Now]:async({$:e,you:a})=>{await e.addSubEffectUntilEndOfTurn({[r.GlobalReminder]:()=>({icon:"Ignore<br>Range",players:[a]}),[r.ExtraRange]:e=>e.spirit===a?99:0})}}]},{effects:[{text:"Add a <presence> in <range-1>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(1)}},{text:"+1 Card Play this turn",[r.Now]:async({you:e})=>{await e.gainCardPlays(1)}}]},{effects:[{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-2>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(2)}}]},{effects:[{text:"Add a <presence> in any Land",[r.Now]:async({you:e})=>{await e.addPresence({locations:g.AnyLands})}},{text:"Gain +2 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(2)}}]}],tracks:[{energy:0,name:"Top-track: 0 Energy"},{requires:0,elements:[i.Sun],name:"Top-track: Sun"},{requiresAny:[1,3,5],energy:2,elements:[i.Water],name:"Top-track: 2 Energy, Water"},{requiresAny:[2,4,6,7],extraEnergy:2,name:"Top-track: +2 Energy"},{requiresAny:[3,7],extraEnergy:1,elements:[i.Any],name:"Top-track: +1 Energy, Any"},{requiresAny:[1,9],energy:1,elements:[i.Moon],name:"Middle-track: 1 Energy, Moon"},{requiresAny:[3,5,11],effect:{actionId:"MovePresence",text:"Move Presence 1",[r.Now]:async({you:e})=>{await e.movePresence(1)}},elements:[i.Air],name:"Middle-track: Move Presence 1, Air"},{requiresAny:[3,4,11,12],extraEnergy:1,extraRange:1,name:"Middle-track: +1 Energy, +1 Range"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:8,elements:[i.Earth],name:"Bottom-track: Earth"},{requiresAny:[9,11],extraCardPlays:1,name:"Bottom-track: +1 Card Plays"},{requiresAny:[6,7,10,12],extraCardPlays:1,name:"Bottom-track: +1 Card Plays"},{requiresAny:[7,11],effect:{actionId:"Push",text:"Push 1 <town>/<city> from 1 of your lands.",[r.Now]:({you:e,$:a})=>e.forPiecesThatIs(a.TownOrCity).pickOne((async e=>{await e.push()}),{noOptions:"None of your lands have <town>/<city>."})},name:"Bottom-track: Push 1 Town/City"}],setup:[{text:"Put 1 <presence> on your starting board in land #3.",[r.Now]:async({you:e})=>{await e.startingBoard.inLandNumber(3).putPresence(1,e)}},{text:"Put 1 <presence> on any board in land #1.",[r.Now]:async({you:e,$:a})=>{await a.inLandsWhere((e=>e.hasNumber(1))).autoPickOne((async a=>{await a.putPresence(1,e)})),a.setupAdjacencies()}}],uniquePowers:[_e.ACircuitousAndWendingJourney,_e.AidFromTheSpiritspeakers,_e.OfferPassageBetweenWorlds,_e.PathsTiedByNature,_e.TravelersBoon,_e.WaysOfShoreAndHeartland],innatePowers:[_e.LayPathsTheyCannotHelpButWalk,_e.CloseTheWays],lore:"Finder of Paths Unseen is well known to the Dahan: it traverses the island with ease, and most spirit-speakers have met it at least once or twice. It communicates more straightforwardly than most Spirits, layering thought-sendings over its high-pitched trills. And it - or its assistants - sometimes help soulforms of dead Dahan move swiftly on, eluding those Spirits that seek to devour them.<br>It is almost commonplace... but also deeply enigmatic, even to those clans who call it Pathfinder. Does it locate paths, or make them? Is the other-space it moves through a realm, or a state of being? While it is occasionally willing to answer, its thoughts do not always translate well to words.",playStyle:'All about moving the Invaders - and Dahan/Presence/Beasts from time to time. Good at creating Invader-free "safe-zones," due to its many movement Powers and its capacity to Isolate. Can\'t afford to Destroy Invaders too often without a way to re-add Destroyed Presence, so either needs a big-hammer Major Power or to rely on its teammates for offense.<br>Changes the topology of the board, which increases complexity for all players - particularly in larger games!',complexity:"Very High"},wf={name:"Serpent Slumbering Beneath the Island",set:s.FeatherAndFlame,aspects:[ln.Locus],specialRules:[{name:"Deep Slumber",text:'You start off limited to 5 <presence> on the island. Raise this with your "Absorb Essence" Power Card. Each use covers the lowest revealed number; your <presence> limit is the lowest uncovered number.<br>Numbers: 5, 7, 8, 10, 11, 12, 13.',[r.Now]:async({$:e,you:a})=>{const t=e=>[5,7,8,10,11,12,13][Math.min(e.absorbedPresence.length,6)];await e.addSubEffect({effectId:pe.Serpent,[r.GlobalReminder]:()=>({icon:`<presence><br>${Math.max(a.numberOfPresenceInLands+(null!=a.incarna?-1:0),0)}/${t(a)}`,ongoing:!0,spirit:a,players:[a]}),[r.PreventAddAnyPresence]:({spirit:e})=>e===a&&a.numberOfPresenceInLands+(null!=a.incarna?-1:0)>=t(a)})}}],pickOptions:[[0,1,2,3],[0,1,2,3]],growthOptions:[{effects:[{text:"Reclaim cards",[r.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Move a <presence>",[r.Now]:async({you:e})=>{await e.movePresence(1)}}]},{effects:[{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Gain +1 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(1)}}]},{effects:[{text:"Gain +4 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(4)}}]},{effects:[{text:"Add a <presence> in <range-3> to Land without Blight",[r.Now]:async({you:e,$:a})=>{await e.addPresenceInRange(3,{filter:e=>!e.has(a.Blight)})}}]}],tracks:[{energy:1,name:"Top-track: 1 Energy"},{requires:0,elements:[i.Fire],name:"Top-track: Fire"},{requires:1,elements:[i.Any],name:"Top-track: Any"},{requires:2,effect:{actionId:"ReclaimOne1",text:"Reclaim One",[r.Now]:async({you:e})=>{await e.reclaim(1)}},name:"Top-track: Reclaim One"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:4,elements:[i.Moon],name:"Bottom-track: Moon"},{requires:5,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:6,elements:[i.Water],name:"Bottom-track: Water"},{requiresAll:[3,7],elements:[i.Earth],name:"Middle-track: Earth"},{requires:8,energy:6,name:"Top-track: 6 Energy"},{requires:9,elements:[i.Any],name:"Top-track: Any"},{requires:10,energy:12,name:"Top-track: 12 Energy"},{requires:8,cardPlays:4,name:"Bottom-track: 4 Card Plays"},{requires:12,cardPlays:5,effect:{actionId:"ReclaimOne2",text:"Reclaim One",[r.Now]:async({you:e})=>{await e.reclaim(1)}},effectRequires:({you:e})=>e.hasReclaimableCards,name:"Bottom-track: 5 Card Plays, Reclaim One"}],setup:[{text:"Put 1 <presence> on your starting board in land #5.",[r.Now]:async({you:e})=>{await e.startingBoard.inLandNumber(5).putPresence(1,e)}}],uniquePowers:[_e.AbsorbEssence,_e.ElementalAegis,_e.GiftOfFlowingPower,_e.GiftOfThePrimordialDeeps],innatePowers:[_e.SerpentWakesInPower,_e.SerpentRousesInAnger],lore:"Long ago in an earlier age, there was only water where islands now lie. One day - for there were day and night by then, though humans did not yet exist - a great serpent grew tired of swimming and decided to rest. It drew the earth up around itself, and so the island was born. Other stories say different things - in particular, Volcano Looming High has its own account - but stories do not need to agree for them to be true. Regardless, many spirits can sense the immense serpent deep below. It is mostly asleep, and its influence on the land above is limited, but the Invaders' Blight already begins to sting it towards greater wakefulness.",playStyle:"There are several ways to play the Serpent, but all require patience: early game involves slowly building up Powers and Presence. It's not helpless during this time, but it isn't as effective as anyone else. It becomes incredibly powerful after awakening, but getting there requires a lot of time.<br>Make sure to Absorb Essence before you run up against your Presence cap - and to get other players' buy-in before using Absorb Essence on their Presence.",complexity:"High"},yf={name:"Heart of the Wildfire",set:s.FeatherAndFlame,aspects:[ln.Transforming],specialRules:[{name:"Blazing Presence",text:"After you add or move <presence> after Setup, in the land it goes to:<br><br><bullet> For each <fire> showing on your <presence> Tracks, do 1 Damage.<br><br><bullet> If 2 <fire> or more are showing on your <presence> Tracks, add 1 <blight>.<br><br><bullet> Push all <beasts> and any number of <dahan>.<br><br>If you add multiple <presence> into a land at the same time, only do the above effects once.",[r.Now]:async({$:e,you:a,...t})=>{await e.afterPiecesAreAddedOrMovedAddTrigger({reminder:!1,permanent:!0,globalReminder:()=>({icon:`<presence><br>${a.elementsFromTracks[i.Fire]} <fire>`,ongoing:!0,spirit:a,players:[a]}),trigger:{triggerId:e.nextTriggerId(),[r.Now]:async({action:t})=>{const n=t.parentData.piecesAddedOrMoved.map((e=>e.location)).filter((e=>null!==e));await An.createCollection(e,W(n)).autoPickOne((async t=>{await e.addSubEffect({effectId:pe.Wildfire,effects:[{text:"For each <fire> showing on your <presence> Tracks, do 1 Damage.",[r.Now]:async()=>{await t.damage(a.elementsFromTracks[i.Fire])}},{text:"If 2 <fire> or more are showing on your <presence> Tracks, add 1 <blight>.",[r.Now]:async()=>{a.elementsFromTracks[i.Fire]>=2&&await t.addBlight(1)}},{text:"Push all <beasts>.",[r.Now]:async()=>{await t.possiblyDontCountPiecesAs(p.Beasts),await t.pushAll(e.Beasts)}},{text:"Push any number of <dahan>.",[r.Now]:async()=>{await t.push({quantifier:w.Any,pieces:e.Dahan})}}]})}))}},pieces:e.Presence,owner:a,effect:t.effect,action:t.action})}},{name:"Destructive Nature",text:"<blight> added due to Spirit effects (Powers, Special Rules, Scenario-based Rituals, etc) does not destroy your <presence>. (This includes cascades.)",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Wildfire,[r.PreventBlightDestroyingPresence]:t=>t.spirit===a&&(e.action.type===en.PowerAction||e.action.type===en.SpiritAction)})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[r.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Gain +1 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(1)}}]},{effects:[{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-3>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(3)}}]},{effects:[{text:"Add a <presence> in <range-1>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(1)}},{text:"Gain +2 Energy and +1 more per Fire Showing",[r.Now]:async({you:e})=>{await e.gainEnergy(2+e.elementsFromTracks[i.Fire])}}]}],tracks:[{energy:0,name:"Top-track: 0 Energy"},{requires:0,elements:[i.Fire],name:"Top-track: Fire"},{requires:1,energy:1,name:"Top-track: 1 Energy"},{requires:2,energy:2,name:"Top-track: 2 Energy"},{requires:3,elements:[i.Fire,i.Plant],name:"Top-track: Fire and Plant"},{requires:4,energy:3,name:"Top-track: 3 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:6,elements:[i.Fire],name:"Bottom-track: Fire"},{requires:7,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:8,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:9,elements:[i.Fire],name:"Bottom-track: Fire"},{requires:10,cardPlays:4,name:"Bottom-track: 4 Card Plays"}],setup:[{text:"Put 3 <presence> and 2 <blight> on your starting board in the highest-numbered Sands.",[r.Now]:async({you:e,$:a})=>{const t=e.startingBoard.highestNumberedTerrain(Ft.Sands);await t.putPresence(3,e),await t.add(2,a.Blight)}}],uniquePowers:[_e.AsphyxiatingSmoke,_e.FlamesFury,_e.Flashfires,_e.ThreateningFlames],innatePowers:[_e.Firestorm,_e.TheBurnedLandRegrows],lore:"A spirit of natural destruction... and renewal after destruction, though those whose lands have been scoured by flame don't usually much appreciate the latter. Thrives near human habitations, glorying in their fires and sparks, but has existed on the island since long before the Dahan arrived, a child of the Volcano and the Green. The Wildfire is a long-standing friend of the Dahan: the early slash-and-burn agriculture which turned most Spirits against them gave it the best decades it had had in centuries. It later supported the Dahan during the Second Reckoning, backing their threats of reprisal. It doesn't interact with the Dahan often these years, but spares their villages as best it can, and fights the Invaders in large part for them.",playStyle:'Starts with good offense and gets better from there, but lays down Blight as it grows. The smaller the game, the more restraint is needed to prevent tipping the island over into being completely Blighted. The Wildfire can heal the land where it is, but may benefit from other Blight removal Powers so it can add Presence to problem lands without triggering Blight cascade. Removing Blight from its own lands limits its "Firestorm" innate power, however.',complexity:"High"},mf={name:"Eyes Watch from the Trees",set:s.HorizonsOfSpiritIsland,aspects:[],specialRules:[{name:"Dahan Trust the Watchers",text:'After one of your Powers adds Defend to a single land, Gather up to 1 <dahan> into that land.<br><br>("Power" includes both your innate Power and your Power Cards. Can be used with any number of Defend Powers each turn.)',[r.Now]:async({$:e,you:a,...t})=>{const n={triggerId:e.nextTriggerId(),[r.Now]:async({action:a})=>{await a.parentData.landWhichGotDefense.gatherUpTo(1,e.Dahan)}};await e.addSubEffect({effectId:pe.Eyes,[r.GlobalReminder]:()=>({icon:"Defend<br>Gather",ongoing:!0,spirit:a,players:[a]}),[r.AfterPowerAddsDefense]:async({land:r,spirit:i,singleLand:s})=>{i===a&&s&&(e.action.data.landWhichGotDefense=r,await e.addTrigger(n,t.effect,t.action))}})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[r.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Gain +1 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(1)}}]},{effects:[{text:"Add a <presence> in <range-2>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(2)}},{text:"Add a <presence> in <range-0>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(0)}}]},{effects:[{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-3>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(3)}},{text:"Gain +1 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(1)}}]}],tracks:[{energy:1,name:"Top-track: 1 Energy"},{requires:0,energy:1,name:"Top-track: 1 Energy"},{requires:1,energy:2,name:"Top-track: 2 Energy"},{requires:2,elements:[i.Plant],name:"Top-track: Plant"},{requires:3,energy:3,name:"Top-track: 3 Energy"},{requires:4,elements:[i.Moon],name:"Top-track: Moon"},{requires:5,energy:4,name:"Top-track: 4 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:7,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:8,elements:[i.Air],name:"Bottom-track: Air"},{requires:9,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:10,elements:[i.Plant],name:"Bottom-track: Plant"},{requires:11,cardPlays:4,name:"Bottom-track: 4 Card Plays"}],setup:[{text:"Put 2 <presence> on your starting board, in the highest-numbered Jungle.",[r.Now]:async({you:e})=>{await e.startingBoard.highestNumberedTerrain(Ft.Jungles).putPresence(2,e)}}],uniquePowers:[_e.BoonOfWatchfulGuarding,_e.EerieNoisesAndMovingTrees,_e.MysteriousAbductions,_e.WhisperedGuidanceThroughTheNight],innatePowers:[_e.MischiefAndSabotage],lore:"Even after centuries, the Dahan find many things about Eyes Watch From the Trees somewhat enigmatic. Is it a Spirit of the trees themselves, or a Spirit which inhabits trees as its home? Is it one Spirit, or many, or a sort of collective-Spirit?<br>Despite these uncertainties, most Dahan trust the Spirit: it warns of danger, helps those lost or injured in the forest, and only works mischief on aggressors and the arrogant. Back in the days of the First Reckoning, its faint whispers were a source of dread, but to current generations they're a familiar and expected part of the island.",playStyle:"Good at Defending against Ravages, and at steadily earning Fear.<br>Its ability to Gather Dahan to fight back when Defending can make a huge difference, changing a stalling tactic into a blow against the Invaders.",complexity:"Low"},vf={name:"Rising Heat of Stone and Sand",set:s.HorizonsOfSpiritIsland,aspects:[],specialRules:[{name:"Blistering Heat",text:"At your <sacred>, Invaders have -1 Health (min. 1).",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Heat,[r.GlobalReminder]:()=>({icon:"<sacred><br>-1 HP",ongoing:!0,spirit:a,players:[a]}),[r.AdjustHealth]:({piece:e})=>e.isInvader&&e.location?.hasSacredSiteOf(a)?-1:0,[r.AfterLandChangesAmountOfPresence]:async({amountBefore:e,amountAfter:t,land:n,spirit:r})=>{e<2&&t>=2&&r===a&&await n.healthCheck()}})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[r.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Gain +1 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(1)}}]},{effects:[{text:"Add a <presence> in <range-3> to Sands or Mountain",[r.Now]:async({you:e})=>{await e.addPresenceInRange(3,{filter:e=>e.isMountainsOrSands})}},{text:"Add a <presence> in <range-3> to Sands or Mountain",[r.Now]:async({you:e})=>{await e.addPresenceInRange(3,{filter:e=>e.isMountainsOrSands})}}]},{effects:[{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-1>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(1)}},{text:"Gain +2 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(2)}}]}],tracks:[{energy:1,name:"Top-track: 1 Energy"},{requires:0,elements:[i.Earth],name:"Top-track: Earth"},{requires:1,energy:2,name:"Top-track: 2 Energy"},{requires:2,energy:3,name:"Top-track: 3 Energy"},{requires:3,elements:[i.Fire],name:"Top-track: Fire"},{requires:4,energy:4,name:"Top-track: 4 Energy"},{requires:5,energy:5,name:"Top-track: 5 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:7,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:8,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:9,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:10,cardPlays:4,name:"Bottom-track: 4 Card Plays"},{requires:11,cardPlays:5,elements:[i.Fire],name:"Bottom-track: 5 Card Plays, Fire"}],setup:[{text:"Put 2 <presence> on your starting board, in the highest-numbered Sands.",[r.Now]:async({you:e})=>{await e.startingBoard.highestNumberedTerrain(Ft.Sands).putPresence(2,e)}}],uniquePowers:[_e.CallOnHerdersForAid,_e.GiftOfSearingHeat,_e.StingingSandstorm,_e.SwelteringExhaustion],innatePowers:[_e.ScorchWithWavesOfHeat],lore:"Dahan herders are very familiar with Rising Heat of Stone and Sand: the signs of its presence are passed down from generation to generation, so it can be acknowledged and thanked for safe passage across its scorching domain. Even after centuries, the Spirit remains a bit unclear on why living things get so unhappy about fatal desiccation, but the Dahan make such pleasant patterns across its sands that it's happy to forbear.<br>It is mostly found in sandy and rocky lands with sparse vegetation, but may also reside in volcanic areas, or even stretches of gravel or sand amidst wetter climates, radiating an intense and unusual heat all around.",playStyle:"Weaken-and-Destroy. Likes having Sacred Site where there's Town/City, as it makes all Spirits' Damage more effective there.<br>Has an easier time setting up Sacred Site in Sands and Mountains, but can do so in any terrain with a bit more time.",complexity:"Low"},If={name:"Fathomless Mud of the Swamp",set:s.HorizonsOfSpiritIsland,aspects:[],specialRules:[{name:"Offer no Firm Foundations",text:"At your <sacred>, Build actions add <explorer> instead of <town>/<city>.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Mud,[r.GlobalReminder]:()=>({icon:"Build<br><explorer>",ongoing:!0,spirit:a,players:[a]}),highPriority:!0,[r.AlterInvaderActionInLand]:async({invaderAction:t,land:n})=>{if(t===K.Build&&n.hasSacredSiteOf(a)){const a=await n.add(1,e.Explorer);return await e.doEffects(r.AfterSuccessfulBuild,{land:n,additions:a}),!0}return!1}})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[r.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Add a <presence> in <range-0>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(0)}}]},{effects:[{text:"Add a <presence> in <range-1>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(1)}},{text:"Add a <presence> in <range-1>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(1)}}]},{effects:[{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-2>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(2)}},{text:"Gain +2 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(2)}}]}],tracks:[{energy:1,name:"Top-track: 1 Energy"},{requires:0,elements:[i.Plant],name:"Top-track: Plant"},{requires:1,energy:2,name:"Top-track: 2 Energy"},{requires:2,energy:3,name:"Top-track: 3 Energy"},{requires:3,elements:[i.Water],name:"Top-track: Water"},{requires:4,energy:4,name:"Top-track: 4 Energy"},{requires:5,energy:5,name:"Top-track: 5 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:7,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:8,elements:[i.Earth],name:"Bottom-track: Earth"},{requires:9,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:10,elements:[i.Moon],name:"Bottom-track: Moon"},{requires:11,cardPlays:4,name:"Bottom-track: 4 Card Plays"}],setup:[{text:"Put 2 <presence> on your starting board, in the lowest-numbered Wetland.",[r.Now]:async({you:e})=>{await e.startingBoard.lowestNumberedTerrain(Ft.Wetlands).putPresence(2,e)}}],uniquePowers:[_e.ExaltationOfTangledGrowth,_e.FoulVaporsAndFetidMuck,_e.IntractableThicketsAndThorns,_e.OpenShiftingWaterways],innatePowers:[_e.SpreadingAndDreadfulMire],lore:"The Island has many swampy deltas along its coasts. Some are fairly navigatable, while others are mazes of murky water, tangled trees, and land that isn't nearly so solid as it appears. Fathomless Mud of the Swamp is one of these latter sorts, with a penchant for spreading - it likes getting everywhere, slowly turning solid ground into muck and mire.<br>Some Dahan villages have struck fruitful bargains with it: easy passage and useful plants in exchange for tasks more easily done by human hands. Most, however, will move on to new living-grounds years early should they notice the sodden signs of it moving into their area.",playStyle:"Likes having Sacred Site where Invaders will Build, but may need to re-create those Sacred Site after oozing outwards with its Innate Power. In smaller games, might be able to cut off the most Inland lands from Explore actions by Destroying Inland Town/City and stopping new ones from being built.<br>Causes a fair bit of Fear, much of which represents unpleasantness, hardship, and disgust.",complexity:"Low"},Af={name:"Devouring Teeth Lurk Underfoot",set:s.HorizonsOfSpiritIsland,aspects:[],specialRules:[{name:"Territorial Aggression",text:'Your Damage-Dealing Powers do +1 Damage.<br><br>(This adds +1 Damage total for the Power, even if the Power Damages multiple invaders or "each Invader". It can boost Minor / Major Power Cards, too, not just your Uniques + Innate.)',[r.Now]:async({you:e})=>{await e.gainDamageBoost({effectId:pe.Teeth,amount:1,source:e,permanent:!0})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[r.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Add a <presence> in <range-0>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(0)}}]},{effects:[{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-1>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(1)}}]},{effects:[{text:"Add a <presence> in <range-2>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(2)}},{text:"Gain +3 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(3)}}]}],tracks:[{energy:2,name:"Top-track: 2 Energy"},{requires:0,elements:[i.Fire],name:"Top-track: Fire"},{requires:1,energy:3,name:"Top-track: 3 Energy"},{requires:2,energy:4,name:"Top-track: 4 Energy"},{requires:3,elements:[i.Animal],name:"Top-track: Animal"},{requires:4,energy:6,name:"Top-track: 6 Energy"},{requires:5,energy:7,name:"Top-track: 7 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:7,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:8,elements:[i.Animal],name:"Bottom-track: Animal"},{requires:9,elements:[i.Fire],name:"Bottom-track: Fire"},{requires:10,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:11,elements:[i.Earth],name:"Bottom-track: Earth"},{requires:12,cardPlays:4,name:"Bottom-track: 4 Card Plays"}],setup:[{text:"Put 1 <presence> on your starting board, in land #5.",[r.Now]:async({you:e})=>{await e.startingBoard.inLandNumber(5).putPresence(1,e)}}],uniquePowers:[_e.FerociousRampage,_e.GiftOfFuriousMight,_e.HerdTowardsTheLurkingMaw,_e.MarkTerritoryWithScarsAndTeeth],innatePowers:[_e.DeathApproachesFromBeneathTheSurface],lore:"Long ago, the being which would become Devouring Teeth Lurk Underfood was a small, territorial Spirit of the sand-by-water. It waited patiently for small prey to approach, then frightened them towards its waiting maw; when fresh prey was scarce it would scavenge.<br>Most such Spirits stay tiny, but this one happened to take a bite out of Ember-Eyed Behemoth. It slowly grew larger and more mobile, slithering below the land's surface in a way impossible for normal animals.<br>It has learned to avoid conflict with the Dahan, who grew wise to its ways long ago, and has even formed a peace of sorts with them. The Invaders do not have that benefit.",playStyle:"Likes being in the same lands as Invaders, so it can use Range 0 offensive and defensive Powers. The first of its Innate Power can give some mobility, if needed.<br>Has a poor Plays track and potent but expensive Unique Powers, so can be better at handling fewer large threats than lots of little ones.",complexity:"Low"},xf={name:"Sun-Bright Whirlwind",set:s.HorizonsOfSpiritIsland,aspects:[],specialRules:[{name:"A Stiff Wind at their Backs",text:"After you Add <presence> during Growth, Push up to 1 <explorer>/<dahan> from that land.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Whirlwind,[r.GlobalReminder]:()=>({icon:"<presence><br><explorer>/<dahan>",ongoing:!0,spirit:a,players:[a]}),[r.AfterAddingPiece]:async({land:t,additions:n})=>{for(const r of n){const{piece:n}=r;e.phase===Xe.Grow&&n.isAPresenceOf(a)&&e.action.spirit===a&&await t.pushUpTo(1,e.ExplorerOrDahan)}}})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[r.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Gain +1 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(1)}}]},{effects:[{text:"Add a <presence> in <range-1>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(1)}},{text:"Gain +4 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(4)}}]},{effects:[{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-4>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(4)}}]}],tracks:[{energy:1,name:"Top-track: 1 Energy"},{requires:0,energy:2,name:"Top-track: 2 Energy"},{requires:1,elements:[i.Sun],name:"Top-track: Sun"},{requires:2,energy:3,name:"Top-track: 3 Energy"},{requires:3,energy:4,elements:[i.Air],name:"Top-track: 4 Energy, Air"},{requires:4,energy:6,name:"Top-track: 6 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:6,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:7,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:8,elements:[i.Air],name:"Bottom-track: Air"},{requires:9,cardPlays:4,name:"Bottom-track: 4 Card Plays"},{requires:10,cardPlays:5,elements:[i.Sun],name:"Bottom-track: 5 Card Plays, Sun"}],setup:[{text:"Put 3 <presence> on your starting board: 1 in the highest-numbered Sands, 2 in the lowest-numbered Mountain.",[r.Now]:async({you:e})=>{await e.startingBoard.highestNumberedTerrain(Ft.Sands).putPresence(1,e),await e.startingBoard.lowestNumberedTerrain(Ft.Mountains).putPresence(2,e)}}],uniquePowers:[_e.GiftOfTheSunlitAir,_e.GiftOfWindspedSteps,_e.ScatterToTheWinds,_e.TempestOfLeavesAndBranches],innatePowers:[_e.ViolentWindstorms],lore:"Sun-Bright Whirlwind is a Spirit of sun-warmed and gusting air. It spins leaves and dust into miniature cyclones, playfully snatches at small unsecured objects, and sometimes - when joyful, or upset, or full of the vigor of nature - howls across the island, bending trees and abrading the landscape with pebbles, twigs, shells, and the occasional bird nest.<br>Some Dahan take its appearance as a good sign for travel, and others have tried asking it to help bring messages to those far away - with mixed success, as it tends to lightly prank the recipients by mixing the messages' words all about.",playStyle:"Incredibly good at handling Explorer, clearing newly-Explored lands of Invaders so they don't Build there. Not nearly so good at dealing with Town/City.<br>Can focus on Energy and largely forego its Innate Power, focus on Plays to aim for mid-to-high Innate thresholds, or strike a more balanced path. Adds at most 1 Presence per turn, so there won't be time to do it all.",complexity:"Low"},bf={name:"Fractured Days Split the Sky",set:s.JaggedEarth,aspects:[],specialRules:[{name:"Fragments of Shattered Time",text:"Each <presence> on this ability represent 1 Time. Many of your Powers require Time as an additional cost. Spend it when you Resolve the Power. (Not when you play it.)<br><br>When you Gain 1 Time, put 1 of your <presence> here from your <presence> track (or, optionally, the island). When you Spend 1 Time, return it to a <presence> track - or if you have no free spaces, Destroy it.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Fractured,[r.GlobalReminder]:()=>({icon:"Time<br><presence>",ongoing:!0,spirit:a,players:[a]})})}},{name:"Days that Never Were",text:"Your 3rd Growth option lets you gain any one Power Card from a special set you create during Setup. When you gain a Power Card any other way, you may add one unchosen card to this set.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Fractured,[r.GlobalReminder]:()=>({icon:"Days",ongoing:!0,spirit:a,players:[a]}),[r.AfterGainingPowers]:async({powerGain:t,spirit:n})=>{if(n===a&&!t.gifted&&!t.taken){let n=Math.min(t.chosen.length,t.notChosen.length);for(;n>0;){const r=t.notChosen[await e.query({text:"Choose a Power to add to Days that Never Were.",query:tn.SelectPowerToGain,items:t.notChosen,actionIds:t.notChosen,players:[a]})];ae(t.notChosen,r),a.daysPowers.push(r),a.destinyPowers.includes(r)&&ae(a.destinyPowers,r),n-=1}}}})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Gain Air",[r.Now]:async({you:e})=>{await e.gainElementsUntilEndOfTurn({[i.Air]:1})}},{text:"Reclaim cards",[r.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain up to 2 Time",[r.Now]:async({you:e})=>{await e.gainTimeUpTo(2)}}]},{effects:[{text:"Gain Moon",[r.Now]:async({you:e})=>{await e.gainElementsUntilEndOfTurn({[i.Moon]:1})}},{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-2>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(2)}},{text:"x2: Gain 1 Time or +2 Card Plays",[r.Now]:async({$:e,you:a})=>{await te(2,(async t=>{await e.chooseBetween({text:`Gain 1 Time or +2 Card Plays. (${2-t} left.)`,effects:[{actionId:"Time",text:"Gain 1 Time",[r.Now]:async()=>{await a.gainTime(1)}},{actionId:"CardPlays",text:"+2 Card Plays",[r.Now]:async()=>{await a.gainCardPlays(2)}}]})}))}}]},{effects:[{text:"Gain Sun",[r.Now]:async({you:e})=>{await e.gainElementsUntilEndOfTurn({[i.Sun]:1})}},{text:"Move a <presence> in <range-4>.",[r.Now]:async({you:e})=>{await e.movePresence(4)}},{text:"Gain Power Card from Days That Never Were",[r.Now]:async({$:e,you:a})=>{const t=a.daysPowers[await e.query({text:"Choose a Power from Days that Never Were.",query:tn.SelectPowerToGain,items:a.daysPowers,actionIds:a.daysPowers,players:[a]})];ae(a.daysPowers,t),await a.gainPower(t),bd[t].type===o.Major&&await a.forgetPowers({duringPowerGain:!0})}},{text:"x3: Gain 1 Time or Gain 2 Energy",[r.Now]:async({$:e,you:a})=>{await te(3,(async t=>{await e.chooseBetween({text:`Gain 1 Time or Gain 2 Energy. (${3-t} left.)`,effects:[{actionId:"Time",text:"Gain 1 Time",[r.Now]:async()=>{await a.gainTime(1)}},{actionId:"Energy",text:"+2 Energy",[r.Now]:async()=>{await a.gainEnergy(2)}}]})}))}}]}],tracks:[{energy:1,name:"Top-track: 1 Energy"},{requires:0,energy:1,name:"Top-track: 1 Energy"},{requires:1,energy:2,name:"Top-track: 2 Energy"},{requires:2,energy:2,name:"Top-track: 2 Energy"},{requires:3,energy:2,name:"Top-track: 2 Energy"},{requires:4,energy:3,name:"Top-track: 3 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:6,cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:7,cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:8,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:9,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:10,cardPlays:3,name:"Bottom-track: 3 Card Plays"}],setup:[{text:"Put 3 <presence> on your starting board: 1 in the lowest-numbered land with 1 <dahan>, and 2 in the highest-numbered land without <dahan>.",[r.Now]:async({$:e,you:a})=>{await a.startingBoard.inLandsFilteredByAllInPriority((a=>a.has(e.Dahan))).withLeast((a=>a.numberOf(e.Dahan))).withLeast((e=>e.landNumber)).anyOne.putPresence(1,a),await(a.startingBoard.highestNumberedLand((a=>!a.has(e.Dahan)))??a.startingBoard.highestNumberedLand()).putPresence(2,a)}},{text:"Deal 4 Minor and 4 Major Powers face-up as your initial Days That Never Were cards; in a 1 or 2-player game, instead deal 6 of each.",[r.Now]:async({$:e,you:a})=>{const t=e.spiritCount<=2?6:4;for(const n of[o.Minor,o.Major])for(let r=0;r<t;r+=1){const t=await e.drawPower(n);t&&a.daysPowers.push(t)}}},{text:"In a 1-board game, gain 1 Time.",[r.Now]:async({$:e,you:a})=>{1===e.boardCount&&await a.gainTime(1)}}],uniquePowers:[_e.AbsoluteStasis,_e.BlurTheArcOfYears,_e.PourTimeSideways,_e.ThePastReturnsAgain],innatePowers:[_e.SlipTheFlowOfTime,_e.VisionsOfAShiftingFuture],lore:"The sun and moon are short-term timekeepers of Spirit Island, measuring days and months with their rise and set, wax and wane. When they meet in a solar eclipse, time collides with time, sending jagged pieces of Was, Will-Be, and Might-Have-Been tearing through the weave of seasons and years. Gleaming vision-shards of future or past events may shimmer across the sky, but often those futures or pasts do not match what others know.<br>Fractured Days Split the Sky exists mostly in the high reaches of the heavens, but touches the island now and then, time and possibility flowing around it like a wind-blown mantle.",playStyle:"Excellent at support and sweeping indirect effects, but starts off very limited otherwise. Several of its Unique Powers need setup to use well; it's entirely possible 1 or 2 of them may see no play in a given game.<br>Has a hard time getting lots of Presence onto the board. This can make targeting tricky, and may be quite dangerous if a Blighted Island effect Destroys Presence.",complexity:"Very High"},Tf={name:"Lure of the Deep Wilderness",set:s.JaggedEarth,aspects:[ln.Lair],specialRules:[{name:"Home of the Island's Heart",text:"Your <presence> may only be added or moved to lands that are Inland.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.LureHomeOfTheIslandsHeart,[r.GlobalReminder]:()=>({icon:"<presence><br>Inland",ongoing:!0,spirit:a,players:[a]}),[r.PreventAddPresence]:({spirit:e,location:t,ignoreLandType:n})=>e===a&&!t.isInland&&!n,[r.PreventMovePiece]:({piece:e,destination:t})=>e.isAPresenceOf(a)&&!t.isInland})}},{name:"Enthrall the Foreign Explorers",text:"For each of your <presence> in a land, ignore up to 2 <explorer> during the Ravage Step and any Ravage Actions.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.LureEnthrallTheForeignExplorers,[r.DoesNotParticipateInRavage]:async({location:t})=>{await t.doNotParticipateInRavage({quantifier:w.UpTo,amount:2*t.numberOfPresenceOf(a),pieces:e.Explorer})}})}}],pickOptions:[[0,1],[2,3]],growthOptions:[{effects:[{text:"Reclaim cards",[r.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain +1 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(1)}}]},{effects:[{text:"Add a <presence> to inland Land",[r.Now]:async({you:e})=>{await e.addPresenceInRange(4,{filter:e=>e.isInland})}}]},{effects:[{text:"Gain Moon, Air, or Plant",[r.Now]:async({you:e})=>{await e.gainElements({elements:[i.Moon,i.Air,i.Plant]})}},{text:"Gain +2 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(2)}}]},{effects:[{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}}]}],tracks:[{energy:1,name:"Top-track: 1 Energy"},{requires:0,energy:2,name:"Top-track: 2 Energy"},{requires:1,elements:[i.Moon],name:"Top-track: Moon"},{requires:2,energy:3,elements:[i.Plant],name:"Top-track: 3 Energy, Plant"},{requires:3,energy:4,elements:[i.Air],name:"Top-track: 4 Energy, Air"},{requires:4,energy:5,effect:{actionId:"ReclaimOne1",text:"Reclaim One",[r.Now]:async({you:e})=>{await e.reclaim(1)}},effectRequires:({you:e})=>e.hasReclaimableCards,name:"Top-track: 5 Energy, Reclaim One"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:6,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:7,elements:[i.Animal],name:"Bottom-track: Animal"},{requires:8,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:9,cardPlays:4,name:"Bottom-track: 4 Card Plays"},{requires:10,cardPlays:5,effect:{actionId:"ReclaimOne2",text:"Reclaim One",[r.Now]:async({you:e})=>{await e.reclaim(1)}},name:"Bottom-track: 5 Card Plays, Reclaim One"}],setup:[{text:"Put 3 <presence> on your starting board: 2 in land #8, and 1 in land #7. Add 1 <beasts> to land #8.",[r.Now]:async({you:e,$:a})=>{const t=e.startingBoard.inLandNumber(8);await t.putPresence(2,e),await t.add(1,a.Beasts),await e.startingBoard.inLandNumber(7).putPresence(1,e)}}],uniquePowers:[_e.GiftOfTheUntamedWild,_e.PerilsOfTheDeepestIsland,_e.SoftlyBeckonEverInward,_e.SwallowedByTheWilderness],innatePowers:[_e.ForsakeSocietyToChaseAfterDreams,_e.NeverHeardFromAgain],lore:"Most early Dahan settlements clustered along the coasts. From time to time, a handful of residents would get a distant look in their eyes and stride off into the heart of the island, no pleading or reason dissuading them from seeking some distant call only they could hear.<br>Many of these involuntary wanderers survived and settles together in time. This may have hastened the First Reckoning, as they relied much more on agriculture than did their fishing bretheren along the coast.<br>A few wanderers spoke of finding the Spirit which called them ever-further inward, in voices of wonder mingled with fear. But most never even saw it, only felt its distant beckoning.",playStyle:'Very focused on the interior - its best options for coastal lands are "draw the Invaders inland" or "turn Town/City into Explorer, then draw them inland". Likes the interior to be dangerous, full of Badlands, Beasts, Disease, and Wilds, ideally where its Presence is.<br>Has better-than-average potential for containing Invaders and setting up a zone safe from Explores, but the coasts may get messy while doing so.',complexity:"Moderate"},Ef={name:"Many Minds Move as One",set:s.JaggedEarth,aspects:[],specialRules:[{name:"Fly fast as thought",text:"When you Gather or Push <beasts>, they may come from or go to lands up to 2 distant (rather than adjacent only).",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.ManyMinds,[r.GlobalReminder]:()=>({icon:"<beasts><br><range-2>",ongoing:!0,spirit:a,players:[a]}),[r.ExtraBeastAdjacency]:()=>(e.action.type===en.PowerAction||e.action.type===en.SpiritAction)&&e.action.spirit===a})}},{name:"A Joining of Swarms and Flocks",text:"Your <sacred> may also count as <beasts>. (Note: You never have more than 1 <sacred> in a land, no matter how many <presence> you have there.)<br><br>(If something changes a <beasts> that is your <sacred>, it affects 2 of your <presence> there - e.g., Push 1 <beasts> will Push 2 of your <presence> together.)",[r.Now]:async({you:e})=>{await e.yourSacredSitesMayAlsoCountAs(p.Beasts)}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[r.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}}]},{effects:[{text:"Add a <presence> in <range-1>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(1)}},{text:"Add a <presence> in <range-0>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(0)}}]},{effects:[{text:"Add a <presence> and a Beasts",[r.Now]:async({you:e,$:a})=>{const t=await e.addPresenceInRange(3);t.length>0&&await t[0].location.add(1,a.Beasts)}},{text:"Gain +1 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(1)}},{text:"Gather up to 1 Beasts into a Land",[r.Now]:({you:e,$:a})=>e.inLandsWithinRange(2).optionallyPickOne((async e=>{await e.gatherUpTo(1,a.Beasts)}))}]}],tracks:[{energy:0,name:"Top-track: 0 Energy"},{requires:0,energy:1,name:"Top-track: 1 Energy"},{requires:1,elements:[i.Air],name:"Top-track: Air"},{requires:2,energy:2,name:"Top-track: 2 Energy"},{requires:3,elements:[i.Animal],name:"Top-track: Animal"},{requires:4,energy:3,name:"Top-track: 3 Energy"},{requires:5,energy:4,name:"Top-track: 4 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:7,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:8,effect:{actionId:"GainPowerCard",text:"Pay 2 to Gain Powercard",[r.Now]:async({you:e})=>{await e.payEnergy(2),await e.gainPowerCard()}},effectRequires:({you:e})=>e.energy>=2,name:"Bottom-track: Pay 2 to Gain Powercard"},{requires:9,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:10,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:11,cardPlays:4,name:"Bottom-track: 4 Card Plays"},{requires:12,cardPlays:5,name:"Bottom-track: 5 Card Plays"}],setup:[{text:"Put 1 <presence> and 1 <beasts> on your starting board, in a land with <beasts>.",[r.Now]:async({you:e,$:a})=>{await e.startingBoard.inLandsFilteredByAllInPriority((e=>e.has(a.Beasts))).autoPickOne((async t=>{await t.putPresence(1,e),await t.add(1,a.Beasts)}))}}],uniquePowers:[_e.ADreadfulTideOfScurryingFlesh,_e.BoonOfSwarmingBedevilment,_e.EvermultiplyingSwarm,_e.GuideTheWayOnFeatheredWings,_e.PursueWithScratchesPecksAndStings],innatePowers:[_e.TheTeemingHostArrives,_e.BesetAndConfoundTheInvaders],lore:"A Spirit of flocks, swarms, schools, and packs, where the whole moves together in concert to accomplish what the individuals in it could not do alone. Unlike Weaves a Web of Souls, its nature leans towards smaller and simpler creatures, and it regards other sorts of animals - including humans - as bizarrely alien in their individuality; while it will communicate with the Dahan, it has shown no ability (or inclination) to integrate them into itself.<br>While it is willing to sacrifice individuals to protect the whole, it is not a Spirit of sacrifice per se - that is a tactic it employs, not the essence of its nature.",playStyle:"Requires heavy spatial thought for Beasts movement, due to its improved Push/Gather and large numbers of Beasts.<br>Has no offense to start with, but an excellent stalling defense combined with Fear generation; outright Fear victories may be plausible in smaller games. Both Fear Cards and Beasts events are unpredictable, however, so swings of fortune are apt to be more relevant than usual.",complexity:"Moderate"},Pf={name:"Shifting Memory of Ages",set:s.JaggedEarth,aspects:[ln.Intensify,ln.Mentor],specialRules:[{name:"Long Ages of Knowledge and Forgetfulness",text:"When you would Forget a Power Card from your hand, you may instead discard it. (Max. once per Action.)",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.MemoryKnowledge,[r.GlobalReminder]:()=>({icon:"No<br>Forget",ongoing:!0,spirit:a,players:[a]}),[r.PreventForgetPowercard]:async({power:t})=>!(e.action.type===en.GameAction||e.action.data.hasUsedLongAges||!t.isInHand||t.owner!==a||!await e.may({card:t.power,prompt:"Discard power instead of Forgetting it?"}))&&(e.action.data.hasUsedLongAges=!0,await t.discard(),!0)})}},{name:"Insights into the World's Nature",text:"Some of your Actions let you Prepare Element Markers, which are kept here until used. Choose the Elements freely. (I.e., you are not limited to Elements you have at the time.)<br><br>Each Element Marker spent grants 1 of that Element for a single Action. (E.g., one Power use.)",effects:[{text:"Each Element Marker spent grants 1 of that Element for a single Action. (E.g., one Power use.)",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.MemoryInsight,[r.GlobalReminder]:()=>({icon:"Elements",ongoing:!0,spirit:a,players:[a]})})}}]}],pickOptions:[[0,1,2,3]],growthOptions:[{effects:[{text:"Reclaim cards",[r.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Add a <presence> in <range-0>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(0)}}]},{effects:[{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-2>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(2)}}]},{effects:[{text:"Add a <presence> in <range-1>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(1)}},{text:"Gain +2 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(2)}}]},{effects:[{text:"Gain +9 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(9)}}]}],tracks:[{energy:0,name:"Top-track: 0 Energy"},{requires:0,energy:1,name:"Top-track: 1 Energy"},{requires:1,energy:2,name:"Top-track: 2 Energy"},{requires:2,energy:3,effect:{actionId:"Prepare1",text:"Prepare 1 Element",[r.Now]:async({you:e})=>{await e.prepareElement()}},name:"Top-track: 3 Energy, Prepare 1"},{requires:3,energy:4,name:"Top-track: 4 Energy"},{requires:4,effect:{actionId:"ReclaimOne",text:"Reclaim One",[r.Now]:async({you:e})=>{await e.reclaim(1)}},effectRequires:({you:e})=>e.hasReclaimableCards,name:"Top-track: Reclaim One"},{requires:5,energy:5,name:"Top-track: 5 Energy"},{requires:6,energy:6,effect:{actionId:"Prepare2",text:"Prepare 1 Element",[r.Now]:async({you:e})=>{await e.prepareElement()}},name:"Top-track: 6 Energy, Prepare 1"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:8,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:9,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:10,effect:{actionId:"Discard",text:"Discard 2 Elements for +1 Card Play",[r.Now]:async({you:e})=>{await e.discardElements(2),await e.gainCardPlays(1)}},effectRequires:({you:e})=>e.numberOfPreparedElements>=2,name:"Bottom-track: Discard 2 Elements for +1 Card Play"},{requires:11,cardPlays:3,name:"Bottom-track: 3 Card Plays"}],setup:[{text:"Put 2 <presence> on your starting board in the highest-numbered land that is Sands or Mountain.",[r.Now]:async({you:e})=>{await e.startingBoard.highestNumberedLand((e=>e.isMountainsOrSands)).putPresence(2,e)}},{text:"Get out the element markers. Prepare 1 <moon>, 1 <air> and 1 <earth> marker (put them by your Special Rules).",[r.Now]:({you:e})=>(e.preparedElements[i.Moon]=1,e.preparedElements[i.Air]=1,e.preparedElements[i.Earth]=1,Promise.resolve())}],uniquePowers:[_e.BoonOfAncientMemories,_e.ElementalTeachings,_e.ShareSecretsOfSurvival,_e.StudyTheInvadersFears],innatePowers:[_e.LearnTheInvadersTactics,_e.ObserveTheEverChangingWorld],lore:"An immensely old Spirit that has ascended to great power countless times over the ages - and then destroyed that power each time, severing huge pieces of itself to become small once again. It does this in part for the thrill of learning anew, but also for the delight of perceiving the living world on the short timescales that larger Spirits grow beyond.<br>The Invaders' arrival has pushed it to grow much more quickly that it usually would, re-learning lessons and powers from its deep past in order to fight more effectively. After the fight is won, there will be time to forget, to diminish, and to renew itself once more.",playStyle:"Starts with little ability to influence the board - most of what it does in that regard will come from new Power Cards.<br>Extremely good with Major Powers and usually wants to take them early and often. Can either try sprinting towards victory with its phenomenal Energy Growth or build up towards becoming a late-game powerhouse.",complexity:"Moderate"},Sf={name:"Shroud of Silent Mist",set:s.JaggedEarth,aspects:[ln.Stranded],specialRules:[{name:"Gather Power from the Cool and Dark",text:"Once per turn, when you gain a Power Card without <fire>, gain 1 Energy.",[r.Now]:async({$:e,you:a})=>{const t=C.sH.box(0);await e.addSubEffect({effectId:pe.ShroudGatherPowerFromTheCoolAndDark,[r.GlobalReminder]:()=>({icon:`Energy<br>${t.get()}/1`,ongoing:!0,spirit:a,players:[a]}),[r.AfterGainingPowers]:async({spirit:n,powerGain:r})=>{n!==a||r.gifted||r.taken||0!==t.get()||!r.chosen.some((e=>e.owner===a&&!e.data.elements.includes(i.Fire)))||(await e.sendEvent({type:T.GenericSub,text:`${n.nameLink} gained a Power Card without <fire>.`}),t.set(t.get()+1),await a.gainEnergy(1))},[r.TimePasses]:()=>(t.set(0),Promise.resolve())})}},{name:"Mists Shift and Flow",text:"When targeting a land with a Power, you may Gather 1 of your <presence> into the target or an adjacent land. This can enable you to meet Range and targeting requirements.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.ShroudMistsShiftAndFlow,[r.GlobalReminder]:()=>({icon:"Gather<br><presence>",ongoing:!0,spirit:a,players:[a]}),[r.MayShift]:({spirit:e})=>e===a,[r.AfterTargetingSource]:async({power:a,land:t})=>{if(!a.assisted&&(e.action.data.source=t,e.action.data.shiftedPresence=[],!a.validOriginSites.has(t))){const n=t.numberOfPresenceOf(a.owner,a.helpers),r=Math.max(2-n,0);r>0&&e.action.data.shiftedPresence.push(...(await t.gather({amount:r,pieces:e.Presence,pieceFilter:e=>null!==e.owner&&a.availablePresenceForTargeting.includes(e)})).map((e=>e.piece))),2===e.action.data.shiftedPresence.length&&(e.action.data.mustTargetAdjacent=!0)}},[r.AfterTargetingLand]:async({targetIndex:a,power:t,land:n})=>{if(t.assisted)return;const r=t.range(a);void 0===e.action.data.shiftedPresence&&(e.action.data.shiftedPresence=[]);const{source:i}=e.action.data;if(t.validLandTargetsWithoutShift({targetIndex:a,source:i}).has(n)){if(e.action.data.shiftedPresence.length<a+1){const a=void 0===i?t.validOriginsGivenTargetLand(n):An.createCollection(e,[i]);let s=null,o=null;1===a.count&&(s=a.items[0],void 0!==i?2===s.numberOfPresenceOf(t.owner,t.helpers)&&(o=An.createCollection(e,[])):void 0!==t.data.sourceFilter&&t.data.sourceFilter.includes(l.SacredSite)?2===s.numberOfPresenceOf(t.owner,t.helpers)&&(o=s.inAdjacentLandsWhere((e=>e.hasPresenceOf(t.owner,t.helpers)&&(null===r||e.landsWithin(r,t.owner,{targetingLands:!0}).includes(n))))):void 0===i&&1===s.numberOfPresenceOf(t.owner,t.helpers)&&(o=s.inAdjacentLandsWhere((e=>t.sourceFilter(e)&&(null===r||e.landsWithin(r,t.owner,{targetingLands:!0}).includes(n))))));const d=a=>n=>n.isPresence&&null!==n.owner&&!e.action.data.shiftedPresence.includes(n)&&t.availablePresenceForTargeting.includes(n)&&(n.location!==s||null===o||o.has(a));await n.inThisAndAdjacentLands().where((e=>e.hasAdjacentLandWhere((e=>e.hasOnePieceWhere(d(e)))))).optionallyPickOne((async a=>{e.action.data.shiftedPresence.push(...(await a.gather({pieces:e.Presence,pieceFilter:d(a)})).map((e=>e.piece)))}),{prompt:"Pick a land to Gather <presence> into."})}}else await t.landsWhichCanBeShiftedIntoToEnableTarget({targetLocation:n,range:t.range(a)}).autoPickOne((async a=>{await a.gather({pieces:e.Presence,pieceFilter:e=>null!==e.owner&&t.availablePresenceForTargeting.includes(e)})}))}})}},{name:"Slow and Silent Death",text:"Invaders and <dahan> in your lands don't heal Damage.<br>During Time Passes: 1 <fear> (max. 5) per land of yours with Damaged Invaders. Gain 1 Energy per 3 lands of yours with Damaged Invaders.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.SlowAndSilentDeath,text:"Invaders and <dahan> in your lands don't heal Damage.",[r.PreventClearDamage]:({piece:t})=>t.isA(e.InvaderOrDahan)&&!0===t.location?.hasPresenceOf(a)}),await e.addSubEffect({effectId:pe.SlowAndSilentDeath,text:"During Time Passes: 1 <fear> (max. 5) per land of yours with Damaged Invaders. Gain 1 Energy per 3 lands of yours with Damaged Invaders.",[r.TimePasses]:async()=>{const t=a.inLandsWith(e.Invader).where((e=>e.hasOnePieceWhere((e=>e.damage>0)))).count;await e.fear(Math.min(t,5)),await a.gainEnergy(Math.floor(t/3))}})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[r.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}}]},{effects:[{text:"Add a <presence> in <range-0>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(0)}},{text:"Add a <presence> in <range-0>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(0)}}]},{effects:[{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-3> to Mountain or Wetland",[r.Now]:async({you:e})=>{await e.addPresenceInRange(3,{filter:e=>e.isMountainsOrWetlands})}}]}],tracks:[{energy:0,name:"Top-track: 0 Energy"},{requires:0,energy:1,name:"Top-track: 1 Energy"},{requires:1,elements:[i.Water],name:"Top-track: Water"},{requires:2,energy:2,name:"Top-track: 2 Energy"},{requires:3,elements:[i.Air],name:"Top-track: Air"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:5,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:6,effect:{actionId:"MovePresence",text:"Move a <presence> 1",[r.Now]:async({you:e})=>{await e.movePresence(1)}},name:"Bottom-track: Move a Presence 1"},{requires:7,elements:[i.Moon],name:"Bottom-track: Moon"},{requires:8,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:9,cardPlays:4,name:"Bottom-track: 4 Card Plays"},{requires:10,effect:{actionId:"ReclaimOne",text:"Reclaim One",[r.Now]:async({you:e})=>{await e.reclaim(1)}},effectRequires:({you:e})=>e.hasReclaimableCards,name:"Bottom-track: Reclaim One"},{requires:11,cardPlays:5,name:"Bottom-track: 5 Card Plays"}],setup:[{text:"Put 2 <presence> on your starting board: 1 in the highest-numbered Wetland and 1 in the highest-numbered Mountain.",[r.Now]:async({you:e})=>{await e.startingBoard.highestNumberedTerrain(Ft.Wetlands).putPresence(1,e),await e.startingBoard.highestNumberedTerrain(Ft.Mountains).putPresence(1,e)}}],uniquePowers:[_e.DissolvingVapors,_e.FlowingAndSilentFormsDartBy,_e.TheFogClosesIn,_e.UnnervingPall],innatePowers:[_e.SuffocatingShroud,_e.LostInTheSwirlingHaze],lore:"A spirit of dissolution and the cold silence of death, creeping quietly down from the hills and across the open waters. Its trail is adorned with dew-covered leaves and the bones of small animals.<br>Some legends say Shroud of Silent Mist came from the final breath of a Dahan spirit-speaker who spoke too freely of secrets entrusted to him, for which his soulform was afflicted with a death-bringing curse. Others claim it was born from the legends and tales rather than from any actual person, for the story of Kadura shows that human and Spirit do not so readily transform into each other.",playStyle:"Constantly shifting and moving its Presence around the board. Hurt more than most by Presence loss due to its desire to surround and envelop the Invaders.<br>Can (slowly) clear the most built-up of lands, but its real strength is the free Fear from Slow and Silent Death.<br>Extremely limited Energy income, but can stretch to Major Powers if it manages to gather enough Energy from its Special Rules.",complexity:"High"};var Of;!function(e){e.Available="Available",e.Chosen="Chosen",e.NotChosen="NotChosen",e.Unavailable="Unavailable",e.Inactive="Inactive"}(Of||(Of={}));const Cf=(e,a)=>({[r.Now]:({you:t})=>(e.forEach((e=>{t.growthStatus[e]=Of.Available})),a.forEach((e=>{t.growthStatus[e]=Of.Unavailable})),Promise.resolve())}),Df={name:"Starlight Seeks Its Form",set:s.JaggedEarth,aspects:[],specialRules:[{name:"Growth Begets Growth",text:"You have 6 <presence> tracks. (As usual, you may add <presence> from any track.) 4 of the <presence> tracks are next to rows of Growth choices: these choices start unavailable.<br><br>Upon emptying a Growth track, pick one of its two Growth choices to be immediately available. The other stays unavailable for the rest of the game (cover with a spare piece).<br>After you add <presence> from a space marked +1, gain 1 Energy.",effects:[{text:"You have 6 <presence> tracks. (As usual, you may add <presence> from any track.) 4 of the <presence> tracks are next to rows of Growth choices: these choices start unavailable.<br><br>Upon emptying a Growth track, pick one of its two Growth choices to be immediately available. The other stays unavailable for the rest of the game.",[r.Now]:async({$:e,you:a})=>{a.growthStatus.forEach(((e,t)=>{a.growthStatus[t]=t>3?Of.Inactive:Of.Available})),await e.addSubEffect({effectId:pe.Starlight,[r.GlobalReminder]:()=>({icon:"Tracks",ongoing:!0,spirit:a,players:[a]})})}}]},{name:"Slowly Coalescing Nature",text:"After revealing an star, place 1 Element Marker of your choice on it. The Element is permanent and is constantly available (as if pre-printed on the <presence> track)."}],pickOptions:[[0,1,2,3,4,5,6,7,8,9,10,11],[0,1,2,3,4,5,6,7,8,9,10,11],[0,1,2,3,4,5,6,7,8,9,10,11]],growthOptions:[{effects:[{text:"Reclaim One",[r.Now]:async({you:e})=>{await e.reclaim(1)}}]},{effects:[{text:"Add a <presence> in <range-0>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(0)}}]},{effects:[{text:"Gain +1 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(1)}}]},{effects:[{text:"Move a <presence> in <range-3>",[r.Now]:async({you:e})=>{await e.movePresence(3)}}]},{requiresTrackSpot:0,effects:[{text:"Reclaim half (round up)",[r.Now]:async({you:e})=>{await e.reclaim(Math.ceil(e.powersWhere((e=>e.isInDiscard)).count/2))}}]},{requiresTrackSpot:0,effects:[{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Move a <presence> in <range-1>",[r.Now]:async({you:e})=>{await e.movePresence(1)}}]},{requiresTrackSpot:1,effects:[{text:"Gain +3 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(3)}}]},{requiresTrackSpot:1,effects:[{text:"+1 Card Play this turn",[r.Now]:async({you:e})=>{await e.gainCardPlays(1)}},{text:"Move a <presence> in <range-2>",[r.Now]:async({you:e})=>{await e.movePresence(2)}}]},{requiresTrackSpot:3,effects:[{text:"Reclaim cards",[r.Now]:async({you:e})=>{await e.reclaimCards()}}]},{requiresTrackSpot:3,effects:[{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Gain +1 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(1)}}]},{requiresTrackSpot:5,effects:[{text:"2 Damage at <range-0>",[r.Now]:async({you:e})=>{await e.inLandsWithinRange(0).pickOne((async e=>{await e.damage(2)}))}}]},{requiresTrackSpot:5,effects:[{text:"+1 Card Play this turn",[r.Now]:async({you:e})=>{await e.gainCardPlays(1)}},{text:"One of your Powers is Fast",[r.Now]:async({you:e})=>{await e.gainMakeFastBuff()}}]},{effects:[Cf([4],[5,6]),Cf([5,6],[4]),Cf([7],[8,9]),Cf([8,9],[7]),Cf([10],[11,12]),Cf([11,12],[10]),Cf([13],[14,15]),Cf([14,15],[13])]}],tracks:[{name:"Track 1: Unlocks Growth Options 5 or 6.",covered:!0,uncoverEffect:{text:"Upon emptying a Growth track, pick on of its two Growth choices to be immediately available",[r.Now]:async({you:e})=>{e.growthStatus[4]===Of.Inactive&&await e.selectBetweenGrowthOptions(16,17)}}},{name:"Track 2: Unlocks Growth Options 7 or 8.",covered:!0,uncoverEffect:{text:"Upon emptying a Growth track, pick on of its two Growth choices to be immediately available",[r.Now]:async({you:e})=>{e.growthStatus[7]===Of.Inactive&&await e.selectBetweenGrowthOptions(18,19)}}},{name:"Track 3: Gain 1 Energy",covered:!0,uncoverEffect:{[r.Now]:async({you:e})=>{await e.gainEnergy(1)}}},{requires:2,name:"Track 3: Gain 1 Energy, Element. Unlocks Growth Options 9 or 10.",uncoverEffect:{text:"Upon emptying a Growth track, pick on of its two Growth choices to be immediately available",[r.Now]:async({you:e})=>{await e.gainEnergy(1),e.growthStatus[10]===Of.Inactive&&await e.selectBetweenGrowthOptions(20,21),await e.addExtraTrackElement(3)}}},{name:"Track 4: Gain 1 Energy",covered:!0,uncoverEffect:{[r.Now]:async({you:e})=>{await e.gainEnergy(1)}}},{requires:4,name:"Track 4: Gain 1 Energy. Unlocks Growth Options 11 or 12.",uncoverEffect:{text:"Upon emptying a Growth track, pick on of its two Growth choices to be immediately available",[r.Now]:async({you:e})=>{await e.gainEnergy(1),e.growthStatus[13]===Of.Inactive&&await e.selectBetweenGrowthOptions(22,23)}}},{energy:1,name:"Track 5: 1 Energy"},{requires:6,energy:2,name:"Track 5: 2 Energy"},{requires:7,name:"Track 5: Element",uncoverEffect:{text:"After revealing an star, place 1 Element Marker of your choice on it. The Element is permanent and is constantly available",[r.Now]:async({you:e})=>{await e.addExtraTrackElement(8)}}},{requires:8,energy:4,name:"Track 5: 4 Energy"},{cardPlays:2,name:"Track 6: 2 Card Plays"},{requires:10,name:"Track 6: Element",uncoverEffect:{text:"After revealing an star, place 1 Element Marker of your choice on it. The Element is permanent and is constantly available",[r.Now]:async({you:e})=>{await e.addExtraTrackElement(11)}}},{requires:11,name:"Track 6: Element",uncoverEffect:{text:"After revealing an star, place 1 Element Marker of your choice on it. The Element is permanent and is constantly available",[r.Now]:async({you:e})=>{await e.addExtraTrackElement(12)}}},{requires:12,cardPlays:3,name:"Track 6: 3 Card Plays"}],setup:[{text:"Put 1 <presence> on your starting board, in a land with <blight>.",[r.Now]:async({you:e,$:a})=>{await e.startingBoard.inLandsFilteredByAllInPriority((e=>e.has(a.Blight))).autoPickOne((async a=>{await a.putPresence(1,e)}))}}],uniquePowers:[_e.BoonOfReimagining,_e.GatherTheScatteredLightOfStars,_e.PeaceOfTheNighttimeSky,_e.ShapeTheSelfAnew],innatePowers:[_e.AirMovesEarthEndures,_e.FireBurnsWaterSoothes,_e.WoodSeeksGrowthHumansSeekFreedom,_e.SiderealGuidance,_e.StarsBlazeInTheDaytimeSky],lore:"Every once and again, where starlight falls to ground there arises a new Spirit. Its essence is initially that of the stars and nighttime sky, but from the moment it touches the island it begins to change, adapting and reimagining itself for its new home. Only a few of the island's Spirits came to be in this fashion, but many of them have been memorable.<br>This one arrived after the Invaders started to spread, striking the earth where they had cleared land for farming. Fragile and new, it was saved from dissolution by Stone's Unyielding Defiance, and in gratitude fights the Invaders even as it seeks to define itself.",playStyle:"A build-your-own-Spirit, capable of going in many different directions based on Elements picked, Growth choices selected, and Power Cards kept. Has a very high personal/visual complexity and a huge number of early-game options, but doesn't alter play much for other players at the table.<br>As it commits to choices, it loses versatility - not all paths will be good (or even possible) at all things. It especially wants a measure of adaptation to early Power Cards, rather than trying to pre-select a strategy.",complexity:"Very High"},Bf={name:"Stone's Unyielding Defiance",set:s.JaggedEarth,aspects:[],specialRules:[{name:"Bestow the Endurance of Bedrock",text:"When <blight> is added to one of your lands, unless the <blight> then outnumbers your <presence>, it does not cascade or Destroy <presence> (yours or others').",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Stone,[r.GlobalReminder]:()=>({icon:"<blight><br><presence>",ongoing:!0,spirit:a,players:[a]}),[r.PreventBlightDestroyingPresence]:({location:t})=>t.numberOf(e.Blight)<=t.numberOfPresenceOf(a),[r.PreventCascade]:({location:t})=>Promise.resolve(t.numberOf(e.Blight)<=t.numberOfPresenceOf(a))})}},{name:"Deep Layers Exposed to the Surface",text:'The first time you uncover each of your "+1 Card Play" <presence> spaces gain a Minor Power.',[r.Now]:async({$:e,you:a,...t})=>{const n=[],i={triggerId:e.nextTriggerId(),[r.Now]:async()=>{await e.doSpiritAction((async()=>{await a.gainPowerCard({powerType:o.Minor})}),{spirit:a})}};await e.addSubEffect({effectId:pe.Stone,[r.AfterUncoveringTrack]:async({spirit:r,trackIndex:s})=>{r===a&&!n.includes(s)&&[2,4,6].includes(s)&&(n.push(s),await e.addTrigger(i,t.effect,t.action))}})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[r.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain 2 Earth",[r.Now]:async({you:e})=>{await e.gainElementsUntilEndOfTurn({[i.Earth]:2})}},{text:"Add a <presence> in <range-3>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(3,{filter:a=>a.isMountains||a.hasPresenceOf(e)})}}]},{effects:[{text:"Add a <presence> in <range-2>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(2)}},{text:"Gain +3 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(3)}}]},{effects:[{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-1>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(1)}}]}],tracks:[{energy:2,name:"Top-track: 2 Energy"},{requires:0,energy:3,name:"Top-track: 3 Energy"},{requires:1,extraCardPlays:1,name:"Top-track: +1 Card Play"},{requires:2,energy:4,name:"Top-track: 4 Energy"},{requires:3,extraCardPlays:1,name:"Top-track: +1 Card Play"},{requires:4,energy:6,name:"Top-track: 6 Energy"},{requires:5,extraCardPlays:1,name:"Top-track: +1 Card Play"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:7,elements:[i.Earth],name:"Bottom-track: Earth"},{requires:8,elements:[i.Earth],name:"Bottom-track: Earth"},{requires:9,elements:[i.Earth],effect:{actionId:"ReclaimOne",text:"Reclaim One",[r.Now]:async({you:e})=>{await e.reclaim(1)}},effectRequires:({you:e})=>e.hasReclaimableCards,name:"Bottom-track: Earth, Reclaim One"},{requires:10,elements:[i.Earth,i.Any],name:"Bottom-track: Earth, Any"},{requires:11,cardPlays:2,elements:[i.Earth],name:"Bottom-track: 2 Card Plays, Earth"}],setup:[{text:"Put 2 <presence> on your starting board: 1 in the lowest-numbered Mountain without <dahan>; 1 in an adjacent land that has <blight> (if possible) or is Sands (if not).",[r.Now]:async({you:e,$:a})=>{const t=e.startingBoard.inLandsFilteredByAllInPriority((e=>e.isMountains),(e=>!e.has(a.Dahan))).withLeast((e=>e.landNumber)).anyOne;await t.putPresence(1,e),await t.inAdjacentLandsWhere((a=>a.board===e.startingBoard)).filteredByAnyInPriority((e=>e.has(a.Blight)),(e=>e.isSands)).autoPickOne((async a=>{await a.putPresence(1,e)}))}}],uniquePowers:[_e.JaggedShardsPushFromTheEarth,_e.PlowsShatterOnRockyGround,_e.ScarredAndStonyLand,_e.StubbornSolidity],innatePowers:[_e.HoldTheIslandFastWithABulwarkOfWill,_e.LetThemBreakThemselvesAgainstTheStone],lore:"Some things refuse to break.<br>Underneath the soil and sand of the island lies rock, layer upon layer built up over the ages. Some stones weather quickly once exposed to the elements, while others are sterner and harder. Stone's Unyielding Defiance is a Spirit of that stone which resists being shattered, moved, or shaped to the will of another.<br>It is capable of tremendous feats of resilience and obstinacy, particularly when confronted head-on in a belligerent fashion. It's not unfriendly to other Spirits or the Dahan, but it works with them on its own terms.",playStyle:"Most of its special rules and innates require being where the Invaders are - particularly in the worst, most-overrun lands, so it can mitigate incoming Blight and (eventually) destroy the Invaders with their own Ravages.<br>Does best with the patience to build up a position over time, and the temperance to hold some Energy in reserve so it can take advantage of Hold the Island Fast With a Bulwark of Will.",complexity:"Moderate"},kf={name:"Grinning Trickster Stirs Up Trouble",set:s.JaggedEarth,aspects:[],specialRules:[{name:"A Real Flair for Discord",text:"After one of your Powers add <strife> in a land, you may pay 1 Energy to add <strife> within <range-1> of that land.",[r.Now]:async({$:e,you:a,...t})=>{const n={triggerId:e.nextTriggerId(),[r.Now]:async({action:t})=>{a.energy>=1&&await e.inLandsWhere((e=>{for(const n of t.parentData.landsWithAddedStrife)if(n.landsWithin(1,a).includes(e))return!0;return!1})).optionallyPickOne((async e=>{await a.payEnergy(1),await e.addStrife(1)}),{prompt:"Pick a land to pay 1 energy to add <strife>."})}};await e.addSubEffect({effectId:pe.Trickster,[r.GlobalReminder]:()=>({icon:"<range-1><br><strife>",ongoing:!0,spirit:a,players:[a]}),[r.AfterAddingStrife]:async({piece:r})=>{e.action.type===en.PowerAction&&e.action.spirit===a&&(void 0===e.action.data.landsWithAddedStrife&&(e.action.data.landsWithAddedStrife=[]),e.action.data.landsWithAddedStrife.push(r.location),await e.addTrigger(n,t.effect,t.action))}})}},{name:"Cleaning up Messes is a Drag",text:"After one of your Power Removes <blight>, Destroy 1 of your <presence>. Ignore this rule for Let's See What Happens.",[r.Now]:async({$:e,you:a,...t})=>{const n={triggerId:e.nextTriggerId(),[r.Now]:async()=>{await a.destroyPresence(1)}};await e.addSubEffect({effectId:pe.Trickster,[r.GlobalReminder]:()=>({icon:"<broken>",ongoing:!0,spirit:a,players:[a]}),[r.AfterRemovePiece]:async({piece:r,removement:i})=>{r.isA(e.Blight)&&e.action.type===en.PowerAction&&e.action.power.power!==_e.LetsSeeWhatHappens&&e.action.spirit===a&&i===A.Remove&&await e.addTrigger(n,t.effect,t.action)}})}}],pickOptions:[[0,1,2,3],[0,1,2,3]],growthOptions:[{cost:1,effects:[{text:"Reclaim cards",[r.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Move a <presence> in <range-1>",[r.Now]:async({you:e})=>{await e.movePresence(1)}}]},{effects:[{text:"Add a <presence> in <range-2>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(2)}}]},{effects:[{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}}]},{effects:[{text:"Gain Energy equal to Card Plays",[r.Now]:async({you:e})=>{await e.gainEnergy(e.baseCardPlays)}}]}],tracks:[{energy:1,name:"Top-track: 1 Energy"},{requires:0,elements:[i.Moon],name:"Top-track: Moon"},{requires:1,energy:2,name:"Top-track: 2 Energy"},{requires:2,elements:[i.Any],name:"Top-track: Any"},{requires:3,elements:[i.Fire],name:"Top-track: Fire"},{requires:4,energy:3,name:"Top-track: 3 Energy"},{cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:6,effect:{actionId:"PushDahan",text:"Push 1 Dahan from one of your Lands",[r.Now]:({you:e,$:a})=>e.forPiecesThatIs(a.Dahan).pickOne((async e=>{await e.push()}))},name:"Bottom-track: Push 1 Dahan"},{requires:7,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:8,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:9,cardPlays:4,name:"Bottom-track: 4 Card Plays"},{requires:10,elements:[i.Air],name:"Bottom-track: Air"},{requires:11,cardPlays:5,name:"Bottom-track: 5 Card Plays"}],setup:[{text:"Put 2 <presence> on your starting board: 1 in the highest-numbered land with <dahan>, and 1 in land #4.",[r.Now]:async({you:e,$:a})=>{await e.startingBoard.inLandsFilteredByAllInPriority((e=>e.has(a.Dahan))).withMost((e=>e.landNumber)).anyOne.putPresence(1,e),await e.startingBoard.inLandNumber(4).putPresence(1,e)}}],uniquePowers:[_e.ImpersonateAuthority,_e.InciteTheMob,_e.OverenthusiasticArson,_e.UnexpectedTigers],innatePowers:[_e.LetsSeeWhatHappens,_e.WhyDontYouAndThemFight],lore:"There are many trickster Spirits, but this one is the most infamous due to its part in instigating the Second Great Reckoning between the Dahan and the Spirits. It wears any form it pleases - perhaps a tree, perhaps a canoe, perhaps a prominent clan-chief - but can always be distinguished by its multitude of eyes, though they may be subtle or concealed.<br>Despite its knack for stirring up trouble, it's neither unfriendly nor motivated by malice - it just has a driving curiosity to see what will happen when it messes around with things. Of course, this may involve putting Spirits, people, and animals alike into suddenly precarious situations, so the Dahan appreciate its shenanigans best at a healthy distance.",playStyle:"Requires some comfort with risk: both Overenthusiastic Arson and Let's See What Will Happen involve uncertainty about how the Fast Powers phase will pan out.<br>Can be effective from the get-go, but benefits greatly from not working too hard, instead improving its capacity for mischief by adding Presence and gaining Power Cards. Bonus Energy from Let's See What Will Happen can be extremely helpful in avoiding the distraction of gaining Energy elsewhere.",complexity:"Moderate"},Lf={name:"Vengeance as a Burning Plague",set:s.JaggedEarth,aspects:[],specialRules:[{name:"The Terror of a Slowly Unfolding Plague",text:"When <disease> would prevent a Build on a board with your <presence>, you may let the Build happen (Removing no <disease>). If you do, 1 <fear>.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Vengeance,[r.GlobalReminder]:()=>({icon:"<disease><br>= <fear>",ongoing:!0,spirit:a,players:[a]}),[r.PreventDiseasePreventingBuilds]:async({location:t})=>!(!t.boards().hasOneWhere((e=>e.hasOneLandWhere((e=>e.hasPresenceOf(a)))))||!await e.may({prompt:"Let the Build happen? (Removing no <disease>). If you do, 1 <fear>.",highlightLocations:[t]}))&&(await t.fear(1),!0)})}},{name:"Lingering Pestilence",text:"When your <presence> is Destroyed by anything except a Spirit Action, add 1 <disease> where each Destroyed <presence> was.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Vengeance,[r.GlobalReminder]:()=>({icon:"<broken><br>= <disease>",ongoing:!0,spirit:a,players:[a]}),[r.AfterRemovePiece]:async({piece:t,location:n,removement:r})=>{t.isAPresenceOf(a)&&x[r].isDestroyLike&&e.action.type!==en.SpiritAction&&e.action.type!==en.PowerAction&&await n.add(1,e.Disease)}})}},{name:"Wreak Vengeance for the Land's Corruption",text:"Your Actions treat <blight> on the island as also being <badlands>.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Vengeance,[r.GlobalReminder]:()=>({icon:"<blight><br>= <badlands>",ongoing:!0,spirit:a,players:[a]})})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[r.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Gain +1 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(1)}}]},{effects:[{text:"Add a <presence> in <range-2> to a Land with Town/City/Blight",[r.Now]:async({you:e,$:a})=>{await e.addPresenceInRange(2,{filter:e=>e.has(a.TownOrCity)||e.has(a.Blight)})}},{text:"Add a <presence> in <range-2> to a Land with Town/City/Blight",[r.Now]:async({you:e,$:a})=>{await e.addPresenceInRange(2,{filter:e=>e.has(a.TownOrCity)||e.has(a.Blight)})}}]},{effects:[{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> or Disease in <range-1>",[r.Now]:async({you:e,$:a})=>{await a.chooseBetween({effects:[{actionId:"Presence",text:"Add a <presence>.",[r.Now]:async()=>{await e.addPresenceInRange(1)}},{actionId:"Disease",text:"Add a <disease>.",[r.Now]:()=>e.inLandsWithinRange(1).pickOne((async e=>{await e.add(1,a.Disease)}))}]})}},{text:"Gain +1 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(1)}}]}],tracks:[{energy:1,name:"Top-track: 1 Energy"},{requires:0,energy:2,name:"Top-track: 2 Energy"},{requires:1,elements:[i.Animal],name:"Top-track: Animal"},{requires:2,energy:3,name:"Top-track: 3 Energy"},{requires:3,energy:4,name:"Top-track: 4 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:5,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:6,elements:[i.Fire],name:"Bottom-track: Fire"},{requires:7,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:8,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:9,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:10,cardPlays:4,name:"Bottom-track: 4 Card Plays"}],setup:[{text:"1 of your <presence> starts the game already destroyed.",[r.Now]:({you:e})=>(e.destroyedPresence=1,Promise.resolve())},{text:"Put 2 <presence> on your starting board: 1 in a land with <blight>, 1 in a Wetland without <dahan>.",[r.Now]:async({you:e,$:a})=>{await e.startingBoard.inLandsFilteredByAllInPriority((e=>e.has(a.Blight))).autoPickOne((async a=>{await a.putPresence(1,e)}),{prompt:"Pick a land with <blight>."}),await e.startingBoard.inLandsFilteredByAllInPriority((e=>e.isWetlands),(e=>!e.has(a.Dahan))).autoPickOne((async a=>{await a.putPresence(1,e)}),{prompt:"Pick a <wetlands>."})}}],uniquePowers:[_e.FetidBreathSpreadsInfection,_e.FieryVengeance,_e.Plaguebearers,_e.StrikeLowWithSuddenFevers],innatePowers:[_e.EpidemicsRunRampant,_e.SavageRevenge],lore:"A Spirit of vengeance, anger, and retribution. In its incarnation as a Burning Plague, it slumbers in a simmering volcanic pool, awakening at unpredictable intervals.... or when roused through supplication by one wronged. Most Dahan consider this foolhardy, for it vents its wrath on entire communities, and its pestilence may spread anywhere. Clans with a close relationship to Hearth-Vigil have less to fear, but still deem it wise - and humane - not to push their luck.<br>It is unclear whether its recent waking is due directly to the ravaging of the Invaders or to some Spirit's pleas.",playStyle:"Not so powerful early, but can be a late-game juggernaut, especially if things are going badly: Blight adds to its Damage and its Presence being Destroyed adds Disease. It may even want to engineer these situations, which can make other Spirits nervous (and be risky if things go poorly).",complexity:"High"},Ff={name:"Volcano Looming High",set:s.JaggedEarth,aspects:[],specialRules:[{name:"Mountain Home",text:"Your <presence> may only be added or moved into Mountains.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Volcano,[r.GlobalReminder]:()=>({icon:"<presence><br><mountains>",ongoing:!0,spirit:a,players:[a]}),[r.PreventAddPresence]:({spirit:e,location:t,ignoreLandType:n})=>e===a&&!t.isMountains&&!n,[r.PreventMovePiece]:({piece:e,destination:t})=>e.isAPresenceOf(a)&&!t.isMountains})}},{name:"Collapse in a blast of Lava and Steam",text:"When your <presence> is Destroyed, in that land, deal 1 Damage per Destroyed <presence> to both Invaders and to <dahan>.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Volcano,[r.GlobalReminder]:()=>({icon:"<broken><br>= 1 <damage>",ongoing:!0,spirit:a,players:[a]}),[r.AfterRemovePiece]:async({piece:t,location:n,removement:r})=>{t.isAPresenceOf(a)&&x[r].isDestroyLike&&(await n.damage(1,e.Invader),await n.damage(1,e.Dahan))}})}},{name:"Volcanic Peaks Tower over the Landscape",text:"Your Power Cards gain <range+1> if you have 3 or more <presence> in the origin land.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Volcano,[r.ExtraRange]:({spirit:t,location:n})=>t===a&&n.numberOfPresenceOf(a)>=3&&e.action.power?.isA(ye.AnyCard)?1:0})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[r.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Gain +3 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(3)}}]},{effects:[{text:"Add a <presence> in <range-0>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(0)}},{text:"Add a <presence> in <range-0>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(0)}}]},{effects:[{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-4>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(4)}},{text:"+1 Card Play this turn",[r.Now]:async({you:e})=>{await e.gainCardPlays(1)}},{text:"Gain +2 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(2)}}]}],tracks:[{energy:1,name:"Top-track: 1 Energy"},{requires:0,energy:2,name:"Top-track: 2 Energy"},{requires:1,elements:[i.Earth],name:"Top-track: Earth"},{requires:2,energy:3,name:"Top-track: 3 Energy"},{requires:3,energy:4,name:"Top-track: 4 Energy"},{requires:4,energy:5,name:"Top-track: 5 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:6,elements:[i.Fire],name:"Bottom-track: Fire"},{requires:7,elements:[i.Earth],name:"Bottom-track: Earth"},{requires:8,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:9,elements:[i.Air],name:"Bottom-track: Air"},{requires:10,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:11,elements:[i.Fire],name:"Bottom-track: Fire"},{requires:12,cardPlays:4,name:"Bottom-track: 4 Card Plays"}],setup:[{text:"Put 1 <presence> and 1 <badlands> on your starting board in a Mountain of your choice. Push all <dahan> from that land.",[r.Now]:async({you:e,$:a})=>{await e.startingBoard.inMountains().pickOne((async t=>{await t.putPresence(1,e),await t.add(1,a.Badlands),await t.pushAll(a.Dahan)}))}}],uniquePowers:[_e.ExaltationOfMoltenStone,_e.LavaFlows,_e.PyroclasticBombardment,_e.RainOfAsh],innatePowers:[_e.ExplosiveEruption,_e.PoweredByTheFurnaceOfTheEarth],lore:"A spirit of fire and earth stretching upwards to the sky, casting a long and dangerous shadow across the land. The deeper Spirits of vulcanism are too powerful and slow, too removed to respond to the Invaders - but not so this one.<br>It doesn't dislike humans per se, but neither does it have much use for them, so the Dahan tend to keep away from it as much as possible and will not quarry stone in its shadow. Of course, larger eruptions can impact a good chunk of the island, so they sometimes end up dealing with its temper whether they want to or not.",playStyle:"Benefits more than most Spirits from getting Presence onto the board; in addition to the usual benefits, it can fuel an Explosive Eruption. This can result in a huge turn, but if overdone the following turn or two may be very constrained.<br>Bigger eruptions are extremely powerful, but cause Blight, and the Invaders may not provide the luxury of enough time to build up the desired pressure - judging the timing of when to erupt and for how much is a key part of playing this Spirit.",complexity:"Moderate"},Rf={name:"Ember-Eyed Behemoth",set:s.NatureIncarnate,aspects:[],specialRules:[{name:"The Behemoth Rises",text:"You have an Incarna. Once per turn, during the Spirit, <fast>, or <slow> phase, you may either: <br><bullet> Push <incarna-behemoth>; or<br><bullet> Add or Move <incarna-behemoth> to any of your <sacred> on the island.",[r.Now]:async({$:e,you:a})=>{await a.addExtraAction({actionId:"TheBehemothRises",icon:"<incarna-behemoth>",maxUses:()=>e.hasEffectNamed("Extra Behemoth Rises")?2:1,enabled:()=>[Xe.Grow,Xe.GainEnergy,Xe.FastPowers,Xe.SlowPowers].includes(e.phase),onActivate:async()=>{await e.chooseBetween({text:"You may:<br>Push <incarna-behemoth>.<or>Add or Move <incarna-behemoth> to any of your <sacred> on the island.",effects:[{actionId:"Push",text:"Push <incarna-behemoth>",[r.Now]:async()=>{await a.incarna.push()},condition:()=>a.hasIncarna},{actionId:"Add",text:"Add <incarna-behemoth> to any of your <sacred> on the island.",label:"Add <incarna-behemoth>.",[r.Now]:async()=>{await a.addIncarna(p.IncarnaBehemoth,(e=>e.hasSacredSiteOf(a)))},condition:()=>!a.hasIncarna},{actionId:"Move",text:"Move <incarna-behemoth> to any of your <sacred> on the island.",label:"Move <incarna-behemoth>.",[r.Now]:async()=>{await a.incarna.move({locations:{target:g.AnyLands},destinationFilter:e=>e.hasSacredSiteOf(a)})},condition:()=>a.hasIncarna}]},{orChoice:!1})}})}},{name:"Unrelenting Strides",text:"On any turn that you don't use Innate Powers, you may use the Behemoth Rises an additional time.",[r.Now]:async({$:e,you:a})=>{await a.addExtraAction({actionId:"UnrelentingStrides",icon:"Strides",enabled:()=>[Xe.Grow,Xe.GainEnergy,Xe.FastPowers,Xe.SlowPowers].includes(e.phase)&&!a.innatePowers.some((e=>e.isResolved)),onActivate:async()=>{for(const e of a.innatePowers)await e.setResolved();await e.addSubEffectUntilEndOfTurn({name:"Extra Behemoth Rises"})}})}},{name:"Incarna",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Behemoth,text:"<incarna-behemoth> may count as <presence>.<br><br>When empowered it may also count as <sacred>.",[r.GlobalReminder]:()=>({icon:"<incarna-behemoth> =<br><presence>"+(a.hasEmpoweredIncarna?"/<sacred>":""),ongoing:!0,spirit:a,players:[a]}),[r.HasSacredSiteOf]:({land:e,spirit:t})=>t===a&&a.hasEmpoweredIncarna&&e.pieces.some((e=>e.piece===p.IncarnaBehemoth))})}}],pickOptions:[[0,1,2,3]],growthOptions:[{effects:[{text:"Reclaim cards",[r.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}}]},{effects:[{text:"Add a <presence> in <range-3>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(3,{filter:a=>a.isJungle||a.hasPresenceOf(e)})}},{text:"Add a <presence> in <range-0>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(0)}}]},{effects:[{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-1>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(1)}},{text:"Gain +3 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(3)}},{text:"Discard a Power Card with <fire>",[r.Now]:async({you:e})=>{await e.discardPowerCards(1,(e=>bd[e.power].elements.includes(i.Fire)))}}]},{oncePerGame:!0,effects:[{text:"Reclaim All Cards with Fire",[r.Now]:async({you:e})=>{await e.reclaimCards({filter:e=>e.isInDiscard&&bd[e.power].elements.includes(i.Fire)})}},{text:"Empower Incarna",[r.Now]:async({you:e})=>{await e.empowerIncarna()}},{text:"Move Incarna",[r.Now]:async({you:e})=>{await(e.incarna?.move({owner:e,locations:{target:g.WithinRange,range:1,spirit:e}}))}}]}],tracks:[{energy:0,name:"Top-track: 0 Energy"},{requires:0,energy:1,name:"Top-track: 1 Energy"},{requires:1,energy:2,elements:[i.Fire],name:"Top-track: 2 Energy, Fire"},{requires:2,energy:3,name:"Top-track: 3 Energy"},{requires:3,elements:[i.Earth],name:"Top-track: Earth"},{requires:4,energy:4,elements:[i.Plant],name:"Top-track: 4 Energy, Plant"},{requires:5,energy:5,elements:[i.Fire],name:"Top-track: 5 Energy, Fire"},{cardPlays:1,name:"Bottom-track: 1 Card Plays"},{requires:7,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:8,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:9,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:10,elements:[i.Fire],name:"Bottom-track: Fire"},{requires:11,cardPlays:4,name:"Bottom-track: 4 Card Plays"}],setup:[{text:"Put 2 <presence> and <incarna-behemoth> in the highest-numbered Wetland on your starting board that is adjacent to any Jungle.",[r.Now]:async({you:e})=>{await e.startingBoard.inLandsFilteredByAllInPriority((e=>e.isWetlands),(e=>e.hasAdjacentLandWhere((e=>e.isJungle)))).withMost((e=>e.landNumber)).autoPickOne((async a=>{await a.putPresence(2,e),await a.putIncarna(p.IncarnaBehemoth,e)}))}}],uniquePowers:[_e.BlazingIntimidation,_e.ExaltationOfGraspingRoots,_e.SurgingLahar,_e.TerrifyingRampage],innatePowers:[_e.SmashStompAndFlatten],lore:"Amidst the boggier jungles, one might find a tree-covered hill - somewhat rocky - rising upwards from the dank and the damp. One might climb it to scout the lay of the land, or camp there for respite from the water-snakes and warm muck below.<br>But do not settle there, nor quarry that stone, for the hill is a Spirit, immense and incarnate. It might be a living scale of the great Serpent; or a dream given waking form; or a Spirit wrapped around a great curse, enfolding it and containing it from spilling outwards. If you bother it, fire will kindle in its eyes, and it will rise and smash its way across the landscape.",playStyle:"Slowly but consistently stomps its Incarna around the island, smashing Invaders. (Dahan can keep clear, unless it really gets going.)<br>Benefits from spread-out Sacred Site, both for targeting Powers and for moving its Incarna long distances. Adding Presence at its Incarna (which can count as Presence) can make it easier to get Presence into new lands, particularly non-Jungles.",complexity:"Moderate"},Nf={name:"Breath of Darkness Down your Spine",set:s.NatureIncarnate,aspects:[],specialRules:[{name:"Terror Stalks the Land",text:"You have an Incarna (<incarna-darkness>). Empower <incarna-darkness> after uncovering the Empower Incarna Presence space.<br>You may Abduct 1 <explorer>/<town> at empowered <incarna-darkness> each <fast> Phase.<br>To Abduct a piece, Move it to The Endless Dark (<endless-dark>). When pieces Escape, Move them to non-Ocean lands with your <presence>/<incarna-darkness>; if they have no legal land to move to, you lose.<br>When your Powers would directly damage or directly destroy the only Invader in a land, instead Abduct it.<br><br>(Check if it is alone at the start of the damage/destroy instruction. <endless-dark> is not a land.)",effects:[{text:"You may Abduct 1 <explorer>/<town> at empowered <incarna-darkness> each <fast> Phase.",[r.Now]:async({$:e,you:a})=>{await a.addExtraAction({actionId:"TerrorStalks",icon:"Abduct",visible:()=>a.hasEmpoweredIncarna&&null!=a.incarna,enabled:()=>null!=a.incarna&&a.hasEmpoweredIncarna&&e.phase===Xe.FastPowers,onActivate:async()=>{await(a.incarna.location?.abduct(1,e.ExplorerOrTown))}})}},{text:"To Abduct a piece, Move it to The Endless Dark (<endless-dark>). When pieces Escape, Move them to non-Ocean lands with your <presence>/<incarna-darkness>; if they have no legal land to move to, you lose.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Darkness,[r.GlobalReminder]:()=>({icon:"Abduct<br>Escape",ongoing:!0,spirit:a,players:[a]})})}},{text:"When your Powers would directly damage or directly destroy the only Invader in a land, instead Abduct it.<br><br>(Check if it is alone at the start of the damage/destroy instruction. <endless-dark> is not a land.)",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Darkness,[r.GlobalReminder]:()=>({icon:"<damage> =<br>Abduct",ongoing:!0,spirit:a,players:[a]}),[r.PreventDamagingPiece]:async({piece:t})=>!(e.hasAttemptedDamagingInvaderThisInstruction||e.action.spirit!==a||!t.isInvader||!t.location.isLand||1!==t.location.numberOf(e.Invader))&&(await t.abduct(),!0),[r.PreventRemovePiece]:async({piece:t,removement:n})=>!(e.hasAttemptedDestroyingInvaderThisInstruction||e.action.spirit!==a||!x[n].isDestroyLike||n===A.DestroyByHealthChange||!t.isInvader||!t.location.isLand||1!==t.location.numberOf(e.Invader))&&(await t.abduct(),!0)})}}]},{name:"Shadow-Touched Realm",text:"Your land-targeting Powers can target <endless-dark> as if it were a land, ignoring Range. (<endless-dark> is Inland and has no terrain.)",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Darkness,[r.GlobalReminder]:()=>({icon:"Target<br>ED",ongoing:!0,spirit:a,players:[a]}),[r.MayTargetTheEndlessDark]:()=>e.currentActionType===en.PowerAction&&e.action.spirit===a,[r.MayIgnoreRangeWhenTargetingLand]:({power:t,land:n})=>t.owner===a&&n===e.theEndlessDark})}},{name:"Trapped in The Endless Dark",text:"Fear Cards and Token Events affect pieces here as if this were an Inland land but can't remove Invaders here - when they would, instead 1 <fear> per Invader they would have removed.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Darkness,[r.GlobalReminder]:()=>({icon:"Fear<br>Events",ongoing:!0,spirit:a,players:[a]}),[r.PreventRemovePiece]:async({piece:a,removement:t})=>!(e.action.type!==en.FearAction&&e.action.type!==en.TokenEventAction||!a.isInvader||!a.location.isTheEndlessDark||t!==A.Remove)&&(await a.location.fear(1),!0)})}},{name:"A Space of Strange and Infinite Darkness",text:"The Endless Dark (<endless-dark>) is on the island, but isn't a land and isn't on any board.<br><br><bullet> This can't be a <sacred>.<br><bullet> Spirits can't target this even if they have <presence> here.<br><bullet> Adding <blight> here doesn't destroy <presence>.<br><bullet> Special rules that affect lands do nothing here.<br><bullet> Invaders can't take Actions here.<br><bullet> Pieces here are on the island when checking for Victory/Defeat.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Darkness,[r.GlobalReminder]:()=>({icon:"<endless-dark>",ongoing:!0,spirit:a,players:[a]})})}},{name:"Incarna",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Darkness,text:"<incarna-darkness> may count as <presence>/<beasts>.",[r.GlobalReminder]:()=>({icon:"<incarna-darkness> =<br><presence>/<beasts>",ongoing:!0,spirit:a,players:[a]})})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[r.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Move Incarna to Any Land",[r.Now]:async({you:e})=>{await(e.incarna?.location.move({pieces:Z.IncarnaDarkness,owner:e,locations:{target:g.AnyLands}}))}},{text:"All Pieces Escape",[r.Now]:async({you:e})=>{await e.escapePieces()}}]},{effects:[{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-3>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(3)}},{text:"Two Pieces Escape",[r.Now]:async({you:e})=>{await e.escapePieces(2)}}]},{effects:[{text:"Add a <presence> in <range-1>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(1)}},{text:"Add/Move <incarna-darkness> to Land with Your Presence",[r.Now]:async({you:e})=>{await e.addOrMoveIncarnaToLandWithPresence(p.IncarnaDarkness)}},{text:"One Piece Escapes",[r.Now]:async({you:e})=>{await e.escapePieces(1)}},{text:"Gain Energy equal to Card Plays",[r.Now]:async({you:e})=>{await e.gainEnergy(e.baseCardPlays)}}]}],tracks:[{energy:1,name:"Top-track: 1 Energy"},{requires:0,energy:2,name:"Top-track: 2 Energy"},{requires:1,elements:[i.Moon],name:"Top-track: Moon"},{requires:2,energy:3,name:"Top-track: 3 Energy"},{requires:3,name:"Empower Incarna",uncoverEffect:{text:"Empower Incarna",[r.Now]:async({you:e})=>{await e.empowerIncarna()}}},{requires:4,energy:4,elements:[i.Animal],name:"Top-track: 4 Energy, Animal"},{requires:5,energy:5,elements:[i.Air],name:"Top-track: 5 Energy, Air"},{cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:7,effect:{actionId:"MovePresence",text:"Move a <presence> 1",[r.Now]:async({you:e})=>{await e.movePresence(1)}},name:"Bottom-track: Move a Presence 1"},{requires:8,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:9,elements:[i.Moon],name:"Bottom-track: Moon"},{requires:10,effect:{actionId:"ReclaimOne",text:"Reclaim One",[r.Now]:async({you:e})=>{await e.reclaim(1)}},effectRequires:({you:e})=>e.hasReclaimableCards,name:"Bottom-track: Reclaim One"},{requires:11,cardPlays:4,elements:[i.Air],name:"Bottom-track: 4 Card Plays, Air"}],setup:[{text:"Put 2 <presence> and your Incarna (<incarna-darkness>) on your starting board: 1 <presence> and <incarna-darkness> in the lowest-numbered Jungle and 1 in the highest-numbered Jungle.",[r.Now]:async({you:e})=>{const a=e.startingBoard.lowestNumberedTerrain(Ft.Jungles);await a.putPresence(1,e),await a.putIncarna(p.IncarnaDarkness,e),await e.startingBoard.highestNumberedTerrain(Ft.Jungles).putPresence(1,e)}},{text:"Set The Endless Dark (<endless-dark>) tile next to the island with 1 <explorer> on it.",[r.Now]:async({$:e})=>{await e.theEndlessDark.add(1,e.Explorer)}}],uniquePowers:[_e.EmergeFromTheDreadNightWind,_e.ReachFromTheInfiniteDarkness,_e.SwallowedByTheEndlessDark,_e.TerrorOfTheHunted],innatePowers:[_e.LeaveATrailOfDeathlySilence,_e.LostInTheEndlessDark],lore:"In the open spaces of Spirit Island, the night sky, when clear, blazes with light from the moon and stars - but not all of this light reaches the earth. From time to time an ever-shifting shadow writhes across the land, bringing a darkness deeper than found under any jungle canopy. It seeks out those who are isolated and alone, and swallows compatriots and communities alike into its lightless void. Some return, others do not.<br>Many Dahan suspect this may be another form of Shadows Flicker Like Flame - its whispery voice crackles like fire, among other signs - but keep cautiously clear of it, as it has made no requests of them.",playStyle:"Abducts lone Invaders to gain Fear and keep them off the board for a time; its mobile Incarna is particularly useful for this. Reclaiming permits the Invaders to escape its void en masse, so can be quite painful.<br>Has trouble with built-up lands, and may need to scatter Invaders or take a Major Power to deal with them.",complexity:"High"},$f={name:"Dances Up Earthquakes",set:s.NatureIncarnate,aspects:[],specialRules:[{name:"Begin a Dance of Decades",text:"Whenever you would play a Power Card, you may instead pay any amount of Energy onto the card to make it an impending card (<impending>), setting it aside out of play for use on a future turn. (It doesn't provide Elements. It's still your Power Card, so it can be Forgotten while it's impending.)",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Earthquakes,[r.GlobalReminder]:()=>({icon:"Dance<br>Decades",ongoing:!0,spirit:a,players:[a]}),[r.CanPlayCardsWithoutCost]:({spirit:e})=>e===a,[r.AdjustPlayPower]:async({power:t})=>{let n=!1;return t.owner===a&&t.isA(ye.AnyCard)&&await e.chooseBetween({effects:[{actionId:`Play${t.power}`,text:"Play Power.",[r.Now]:()=>Promise.resolve(),condition:()=>a.energy>=t.costToPlay&&a.usedCardPlays-a.cardsMadeImpendingThisTurn.length<=a.cardPlays-a.impendingCardPlays},...[...Array(Math.max(t.data.energy??0,1)).keys()].map((i=>({actionId:`Impend${i}${t.power}`,text:`Impend with ${i} energy.`,[r.Now]:async()=>{n=!0,await e.sendEvent({type:T.PowerCardImpended,spirit:t.owner,power:t,energy:i}),await t.setImpending(i),await a.payEnergy(i)},condition:()=>a.energy>=i})))]}),n}})}},{name:"Rhythmic Power Builds to a Cataclysmic Crescendo",text:"When you gain Energy from your Presence Track, also gain Energy onto each Power Card made <impending> on a previous turn. If any <impending> now have Energy on them at least equal to their cost, discard that Energy and play them. (This cost no card plays.)",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Earthquakes,[r.GlobalReminder]:()=>({icon:"Rhythmic<br>Power",ongoing:!0,spirit:a,players:[a]}),[r.AfterGainingEnergyFromTracks]:async()=>{for(const e of a.powers)e.isImpending&&(e.impendingEnergy+=a.impendingEnergy,e.impendingEnergy>=(e.data.energy??0)&&(e.impendingEnergy=0,await e.play({withoutPaying:!0,withoutUsingCardPlays:!0,withoutImpending:!0})))}})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[r.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Add a <presence>.<or>Gain Major Power without Forgetting.",[r.Now]:({you:e,$:a})=>a.chooseBetween({effects:[{actionId:"Presence",text:"Add a <presence> in <range-2>.",[r.Now]:async()=>{await e.addPresenceInRange(2)}},{actionId:"MajorPower",text:"Gain Major Power without Forgetting.",[r.Now]:async()=>{await e.gainPowerCard({powerType:o.Major,withoutForgetting:!0})}}]})}]},{effects:[{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-1>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(1)}}]},{effects:[{text:"Add a <presence> in <range-3>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(3)}},{text:"This Turn, Gain +1/-1 Energy on up to 2 Impending Power Cards",[r.Now]:async({$:e,you:a})=>{await a.powersWhere((e=>e.isImpending)).pickMultiple({amount:2,optional:!0,forPickedItem:async a=>{await e.chooseBetween({highlightPowers:[a],effects:[{actionId:"AddEnergy",text:"Add 1 Impending Energy",[r.Now]:()=>(a.impendingEnergy+=1,Promise.resolve())},{actionId:"RemoveEnergy",text:"Remove 1 Impending Energy",[r.Now]:()=>(a.impendingEnergy-=1,Promise.resolve())}]})}})}},{text:"Reclaim One",[r.Now]:async({you:e})=>{await e.reclaim(1)}}]}],tracks:[{energy:1,impendingEnergy:1,name:"Top-track: 1 Energy, 1 Energy on each impending card"},{requires:0,effect:{actionId:"MovePresence",text:"Move a <presence> 1",[r.Now]:async({you:e})=>{await e.movePresence(1)}},name:"Top-track: Move a Presence 1"},{requires:1,energy:2,name:"Top-track: 2 Energy"},{requires:2,impendingCardPlays:1,name:"Top-track: +1 Play for Impending Only"},{requires:3,energy:3,name:"Top-track: 3 Energy"},{requires:4,impendingEnergy:1,name:"Top-track: 2 Energy/Turn on Impending card"},{requires:5,energy:4,elements:[i.Any],name:"Top-track: 4 Energy, Any"},{cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:7,effect:{actionId:"GatherDahan",text:"Gather 1 Dahan into 1 of your Lands",[r.Now]:({you:e,$:a})=>e.inLandsWhere((e=>e.hasAdjacentLandWithPiece(a.Dahan))).pickOne((async e=>{await e.gatherOne(a.Dahan)}),{noOptions:"None of your lands have an adjacent <dahan>."})},name:"Bottom-track: Gather 1 Dahan into 1 of your Lands"},{requires:8,elements:[i.Moon,i.Fire],name:"Bottom-track: Moon, Fire"},{requires:9,impendingCardPlays:1,name:"Bottom-track: +1 Play for Impending Only"},{requires:10,elements:[i.Earth],name:"Bottom-track: Earth"},{requires:11,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:12,cardPlays:4,name:"Bottom-track: 4 Card Plays"}],setup:[{text:"Put 1 <presence> on your starting board in the highest-numbered land with <dahan>.",[r.Now]:async({you:e,$:a})=>{await e.startingBoard.inLandsFilteredByAllInPriority((e=>e.has(a.Dahan))).withMost((e=>e.landNumber)).autoPickOne((async a=>{await a.putPresence(1,e)}))}}],uniquePowers:[_e.ExaltationOfEchoedSteps,_e.GiftOfSeismicEnergy,_e.InspireAWindingDance,_e.RadiatingTremors,_e.ResoundingFootfallsSowDismay,_e.RumblingsPortendAGreaterQuake],innatePowers:[_e.LandCreaksWithTension,_e.EarthShuddersBuildingsFall],lore:"A traveling Spirit of movement and movement's deep power, circling a bright leap of flame, dancing atop dark mysteries of night and earth. It roams the island as its visions and will to motion bid, dancing with and among whomever it finds: the waves on the shore, the animals of the jungle, the Spirits, the trees, the Dahan, and - especially - the earth itself.<br>The Dahan learned long ago that if the land-dancer was aware of them, village-wrecking earthquakes became much rarer. Through this, they found that many Spirits appreciate - and gain power from - various patterns of dance and rhythm, in addition to those of line, shape, and word.",playStyle:"Very much about tempo and timing: Can play high-cost Powers extremely easily, but they won't take effect until later in the game. Faces a constant tension between solving problems now and carefully planning ahead for big turns in the future - neglecting either one can be disastrous.<br>Despite starting with 6 Unique Powers, benefits greatly from gaining more.",complexity:"Very High"},Wf={name:"Relentless Gaze of the Sun",set:s.NatureIncarnate,aspects:[],specialRules:[{name:"Relentless Punishment",text:"After using a Power Card, if you had at least 3 <presence> in the origin land, you may Repeat it any number of times on the same target land(s) (ignoring origin, Range, and target requirements) by paying both:<br><br><bullet> the Energy cost of the Power, and<br><br><bullet> 1 Energy per previous use of the Power this turn each time you repeat the Power.<br><br>(You may repeat each Power Card multiple times, but its 1st repeat costs 1 extra, its 2nd repeat costs 2 extra, etc. Check if the origin has at least 3 <presence> when you target it the first time.)",[r.Now]:async({$:e,you:a,...t})=>{const n={triggerId:e.nextTriggerId(),[r.Now]:async({action:t})=>{const{gazePower:n,gazeLands:r}=t.parentData;let i=n.costToPlay+1;for(;a.energy>=i&&await e.may({prompt:`Repeat ${n.data.name} by paying ${i} energy?`});)await a.payEnergy(i),await n.repeatInLocations(r,!1),i+=1}};await e.addSubEffect({effectId:pe.Gaze,[r.GlobalReminder]:()=>({icon:"Repeat<br>3 <presence>",ongoing:!0,spirit:a,players:[a]}),[r.AfterTargetingLands]:async({power:r,lands:i,isRepeat:s})=>{r.owner===a&&!s&&r.isA(ye.AnyCard)&&r.validOriginSites.hasOneWhere((e=>e.numberOfPresenceOf(a)>=3))&&(e.action.data.gazeLands=i,e.action.data.gazePower=r,await e.addTrigger(n,t.effect,t.action))}})}}],pickOptions:[[0],[1,2,3]],growthOptions:[{effects:[{text:"Add a <presence> in <range-2>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(2)}}]},{effects:[{text:"Reclaim cards",[r.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Add up to 3 <broken> together",[r.Now]:async({you:e,$:a})=>{e.destroyedPresence>0&&await e.inLandsWithinRange(1).optionallyPickOne((async t=>{await a.chooseBetween({prompt:"How many <broken> do you want to add?",effects:[1,2,3].map((a=>({actionId:`BrokenAmount${a}`,text:`${a} <broken>`,[r.Now]:async()=>{for(let n=0;n<a;n+=1)await t.addPresence(e,{destroyed:!0})},condition:()=>e.destroyedPresence>=a})))})}))}}]},{effects:[{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}}]},{effects:[{text:"Gain Energy an Additional Time",[r.Now]:async({$:e,you:a})=>{await e.addSubEffectUntilEndOfTurn({[r.AfterGainingEnergyFromTracks]:async()=>{await a.gainEnergyFromTracks()}})}},{text:"Move up to 3 Presence Together in <range-3>",[r.Now]:async({you:e,$:a})=>{await e.inLands().pickOne((async t=>{await t.move({quantifier:w.UpTo,amount:3,together:!0,pieces:a.Presence,owner:e,locations:{target:g.WithinRange,range:3,spirit:e}})}),{prompt:"Pick a land with your <presence>."})}}]}],tracks:[{energy:1,name:"Top-track: 1 Energy"},{requires:0,energy:2,elements:[i.Sun],name:"Top-track: 2 Energy, Sun"},{requires:1,energy:3,elements:[i.Fire],name:"Top-track: 3 Energy, Fire"},{requires:2,elements:[i.Sun],name:"Top-track: Sun"},{requires:3,energy:4,elements:[i.Any],name:"Top-track: 4 Energy, Any"},{requires:4,energy:5,name:"Top-track: 5 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:6,cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:7,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:8,elements:[i.Sun],name:"Bottom-track: Sun"},{requires:9,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:10,effect:{actionId:"ReclaimOne",text:"Reclaim One",[r.Now]:async({you:e})=>{await e.reclaim(1)}},effectRequires:({you:e})=>e.hasReclaimableCards,name:"Bottom-track: Reclaim One"},{requires:11,cardPlays:4,name:"Bottom-track: 4 Card Plays"}],setup:[{text:"Put 2 <presence> and 1 <badlands> on your starting board, in the lowest-numbered Sands.",[r.Now]:async({you:e,$:a})=>{const t=e.startingBoard.lowestNumberedTerrain(Ft.Sands);await t.putPresence(2,e),await t.add(1,a.Badlands)}}],uniquePowers:[_e.BlindingGlare,_e.FocusTheSunsRays,_e.UnbearableGaze,_e.WitherBodiesScarStones],innatePowers:[_e.ScorchingConvergence,_e.ConsiderAHarmoniousNature],lore:"Relentless Gaze of the Sun is an imperious Spirit, brimming with wrathful power that scorches the land barren beneath its focused regard. For long centuries, it viewed all others as beneath it, unworthy of consideration.<br>Yet since being thwarted during the Years of the Relentless Sun, it wonders if its pride deceives it - perhaps it should work with some Spirits and humans, rather than indulging in indiscriminate destruction?<br>It is still considering this idea. Regardless, the Invaders offend it by making the land fragile, forcing it into the intolerable choice between dimming its majesty and unintentionally scorching the land.",playStyle:"Uses stacks of 3 Presence and high Energy income to hammer the same lands with repeated Power Cards. Because of its single-mindedness, is better at dealing with large problems than smaller ones.<br>Harms the land and Dahan while smiting Invaders unless it successfully changes its nature (by expanding into new Elements), which may mean partially foregoing the Sun and Fire that form the core of its initial strength.",complexity:"High"},Mf={name:"Hearth-Vigil",set:s.NatureIncarnate,aspects:[],specialRules:[{name:"Rooted in the Community",text:"<blight> added in your lands does not destroy your <presence> if <dahan> are present. (Ravage Actions destroy <dahan> before added <blight> destroys <presence> and cascades.)",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.HearthVigil,[r.GlobalReminder]:()=>({icon:"<blight><br><broken>",ongoing:!0,spirit:a,players:[a]}),[r.PreventBlightDestroyingPresence]:({location:t,spirit:n})=>t.has(e.Dahan)&&n===a})}},{name:"Fortify Heart and Hearth",text:"<dahan> have +4 Health (each) while in your lands. Event and Blight Card Actions don't damage, destroy, or replace <dahan> in your lands.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.HearthVigil,[r.GlobalReminder]:()=>({icon:"<dahan><br>+4 HP",ongoing:!0,spirit:a,players:[a]}),[r.AdjustHealth]:({piece:t})=>t.isA(e.Dahan)&&void 0!==t.location&&t.location?.hasPresenceOf(a)?4:0,[r.AfterRemovePiece]:async({location:t,piece:n})=>{n.owner===a&&t.has(e.Dahan)&&await t.healthCheck()},[r.PreventRemovePiece]:async({piece:t,location:n,removement:r})=>!(!(t.isA(e.Dahan)&&n.hasPresenceOf(a)&&[en.MainEventAction,en.BlightCardAction,en.DahanEventAction,en.TokenEventAction].includes(e.action.type))||!x[r].isDestroyLike&&r!==A.Replace)&&(await e.sendEvent({type:T.GenericSub,text:`Fortify Heart and Hearth prevented Dahan from being ${x[r].textPast}.`}),!0),[r.PreventDamagingPiece]:async({piece:t})=>!!(t.isA(e.Dahan)&&void 0!==t.location&&t.location.hasPresenceOf(a)&&[en.MainEventAction,en.BlightCardAction,en.DahanEventAction,en.TokenEventAction].includes(e.action.type))&&(await e.sendEvent({type:T.GenericSub,text:"Fortify Heart and Hearth prevented Dahan from being damaged."}),!0)})}},{name:"Loyal Guardian",text:"When all <dahan> leave one of your lands, your <presence> may Move with those <dahan>. (Each <dahan> can Bring any number of <presence>.)",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.HearthVigil,[r.AfterMoving]:async({movement:t,source:n,piece:r})=>{if((e.movedDahanThisInstruction.length??0)>0&&t!==q.Relocate&&n.hasPresenceOf(a)&&r.isA(e.Dahan)){const t=e.movedDahanThisInstruction.filter((a=>a.source===n&&0===a.source.piecesThatAre(e.Dahan).where((a=>!e.movedDahanThisInstruction.some((e=>e.piece===a)))).count));if(t.length>0){const n=t[0].source,r=W(t.map((e=>e.destination)));await n.move({quantifier:w.Any,pieces:e.Presence,pieceFilter:a=>!(e.movedPresenceThisInstruction??[]).some((e=>e.piece===a)),owner:a,movement:q.Bring,locations:{target:g.AnyLocations},pickPiecesEffect:{highlightLocations:r},pickDestinationEffect:{autoPlayOneOption:!0},destinationFilter:e=>r.includes(e)})}}}})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[r.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Add a <presence> in <range-0>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(0)}}]},{effects:[{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-3> to a land with <dahan>.",[r.Now]:async({you:e,$:a})=>{await e.addPresenceInRange(3,{filter:e=>e.has(a.Dahan)})}}]},{effects:[{text:"Add a <presence> in <range-2>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(2)}},{text:"Gain +3 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(3)}}]}],tracks:[{effect:{actionId:"GatherDahan",text:"Gather 1 Dahan into 1 of your Lands",[r.Now]:({you:e,$:a})=>e.inLandsWhere((e=>e.hasAdjacentLandWithPiece(a.Dahan))).pickOne((async e=>{await e.gatherOne(a.Dahan)}),{noOptions:"None of your lands have an adjacent <dahan>."})},name:"Bonus: Gather 1 Dahan into 1 of your Lands"},{energy:0,name:"Top-track: 0 Energy"},{requires:1,energy:1,elements:[i.Sun],name:"Top-track: 1 Energy, Sun"},{requires:2,energy:2,name:"Top-track: 2 Energy"},{requires:3,energy:3,elements:[i.Animal],name:"Top-track: 3 Energy, Animal"},{requires:4,energy:4,name:"Top-track: 4 Energy"},{requires:5,energy:5,elements:[i.Sun],name:"Top-track: 5 Energy, Sun"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:7,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:8,elements:[i.Air],name:"Bottom-track: Air"},{requires:9,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:10,elements:[i.Animal],name:"Bottom-track: Animal"},{requires:11,cardPlays:4,name:"Bottom-track: 4 Card Plays"}],setup:[{text:"Put 3 <presence> on your starting board: 1 in the highest-numbered land with <dahan> and 2 in the lowest-numbered land with at least 2 <dahan>. Add 1 <dahan> in each of those lands.",[r.Now]:async({you:e,$:a})=>{const t=[];await e.startingBoard.inLandsFilteredByAllInPriority((e=>e.has(a.Dahan))).withMost((e=>e.landNumber)).autoPickOne((async a=>{t.push(a),await a.putPresence(1,e)})),await e.startingBoard.inLandsFilteredByAnyInPriority((e=>e.hasAtLeast(2,a.Dahan)),(e=>e.has(a.Dahan))).withLeast((e=>e.landNumber)).autoPickOne((async a=>{t.push(a),await a.putPresence(2,e)}));for(const e of t)await e.add(1,a.Dahan)}},{text:"You start with your 4 unique Power Cards and 1 Energy.",[r.Now]:async({you:e})=>{await e.gainEnergy(1)}}],uniquePowers:[_e.CallToVigilance,_e.CoordinatedRaid,_e.FavorsOfStoryAndSeason,_e.SurroundedByTheDahan],innatePowers:[_e.WarnOfImpendingConflict,_e.KeepWatchForNewIncursions],lore:"Hearth-Vigil is a Spirit of neither fire nor cooking - it is a watcher and guardian, a protector who keeps vigil over common-hearths. In the dry season, it smothers rogue blazes; in the wet season, it fortifies the health of older Dahan suffering from wheezelung; in all season, it intensifies the hearth's powers of wellness and community-strength. It's friendly to speak to, though most grown Dahan don't usually distract it without cause.<br>Historically, its aid was first sought during the bloody conflicts of the Servant Cults, due to the threat of mass poisonings. As those agreements affected its nature, it became able to offer more than simple vigilance.",playStyle:"Very good at protecting Dahan in its lands, not so great at stopping Blight. In keeping with its nature, largely brings Dahan to its Presence (or vice versa); getting Dahan elsewhere may require a bit of forethought with Keep Watch for New Incursions.<br>Very reactive, with reliable ways to deal with Invaders as they Ravage and Build, but has trouble handling established City that aren't Ravaging.",complexity:"Moderate"},Gf={name:"Towering Roots of the Jungle",set:s.NatureIncarnate,aspects:[],specialRules:[{name:"Enduring Vitality",text:"Some of your Actions Add Vitality Tokens (<vitality>). (Each <vitality> in a land with no <blight> prevents 1 <blight> from being added, then is Removed.)",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Roots,[r.GlobalReminder]:()=>({icon:"<vitality>",ongoing:!0,spirit:a,players:[a]})})}},{name:"Heart-tree Guards the Land",text:"You have an Incarna.<br><bullet> Your Powers get <range+1> if <incarna-roots> is in the origin land.<br><bullet> Invaders/<dahan>/<beasts> can't be damaged or destroyed at <incarna-roots>.<br><bullet> Empower <incarna-roots> the first time it's in a land with 3 or more <vitality>.<br><bullet> Skip all Build Actions at Empowered <incarna-roots>.",effects:[{text:"Your Powers get <range+1> if <incarna-roots> is in the origin land.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Roots,[r.GlobalReminder]:()=>({icon:"<range+1><br><incarna-roots>",ongoing:!0,spirit:a,players:[a]}),[r.ExtraRange]:({spirit:t,location:n})=>t===a&&n.has(e.IncarnaRoots)&&void 0!==e.action.power?1:0})}},{text:"Invaders/<dahan>/<beasts> can't be damaged or destroyed at <incarna-roots>.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Roots,[r.GlobalReminder]:()=>({icon:"<incarna-roots><br>No <damage>",ongoing:!0,spirit:a,players:[a]}),[r.PreventRemovePiece]:({piece:a,location:t,removement:n})=>Promise.resolve(a.isOneOf(e.Invader,e.Dahan,e.Beasts)&&t.has(e.IncarnaRoots)&&x[n].isDestroyLike),[r.PreventDamagingPiece]:({piece:a})=>Promise.resolve(a.isOneOf(e.Invader,e.Dahan,e.Beasts)&&!0===a.location?.has(e.IncarnaRoots))})}},{text:"Empower <incarna-roots> the first time it's in a land with 3 or more <vitality>.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Roots,[r.GlobalReminder]:()=>({icon:"Empower<br>3 <vitality>",ongoing:!0,visible:!a.hasEmpoweredIncarna,spirit:a,players:[a]}),[r.AfterAddingPiece]:async({land:t})=>{t.hasAtLeast(3,e.Vitality)&&t.has(e.IncarnaRoots)&&await a.empowerIncarna()},[r.AfterMoving]:async({destination:t})=>{t.hasAtLeast(3,e.Vitality)&&t.has(e.IncarnaRoots)&&await a.empowerIncarna()}})}},{text:"Skip all Build Actions at Empowered <incarna-roots>.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Roots,[r.GlobalReminder]:()=>({icon:"Skip<br>Build",ongoing:!0,visible:a.hasEmpoweredIncarna,spirit:a,players:[a]}),[r.PreventInvaderActionInLand]:({land:t,invaderAction:n})=>Promise.resolve(n===K.Build&&t.has(e.IncarnaRoots)&&a.hasEmpoweredIncarna)})}}]},{name:"Incarna",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Roots,text:"<incarna-roots> may count as <presence>.",[r.GlobalReminder]:()=>({icon:"<incarna-roots> =<br><presence>",ongoing:!0,spirit:a,players:[a]})})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[r.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Add a <presence> in <range-0>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(0)}}]},{effects:[{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-1>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(1)}},{text:"Add a Vitality at your Incarna",[r.Now]:async({you:e,$:a})=>{await(e.incarna?.location?.add(1,a.Vitality))}}]},{effects:[{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-3>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(3)}},{text:"You may Replace 1 Presence with Your Incarna",[r.Now]:async({you:e})=>{await e.presence().optionallyPickOne((async a=>{const t=a.location;await a.remove(A.Replace),e.hasIncarna?await e.incarna.moveTo({location:t,movement:q.Relocate,pieceFilter:Z.IncarnaRoots}):await e.addIncarna(p.IncarnaRoots,(e=>e===t))}))}},{text:"Gain +1 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(1)}}]}],tracks:[{energy:1,name:"Top-track: 1 Energy"},{requires:0,energy:2,name:"Top-track: 2 Energy"},{requires:1,elements:[i.Earth],name:"Top-track: Earth"},{requires:2,energy:4,name:"Top-track: 4 Energy"},{requires:3,elements:[i.Plant],name:"Top-track: Plant"},{requires:4,energy:6,name:"Top-track: 6 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:6,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:7,elements:[i.Sun],name:"Bottom-track: Sun"},{requires:8,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:9,elements:[i.Plant],name:"Bottom-track: Plant"},{requires:10,cardPlays:4,name:"Bottom-track: 4 Card Plays"}],setup:[{text:"Put 3 <presence> on your starting board: 1 in the highest-numbered Jungle without <blight>, 1 in the highest-numbered Mountain, and 1 in the highest-numbered Wetland. Put <incarna-roots> in the Jungle with your <presence>.",[r.Now]:async({you:e,$:a})=>{await e.startingBoard.inLandsFilteredByAllInPriority((e=>e.isJungle),(e=>!e.has(a.Blight))).withMost((e=>e.landNumber)).autoPickOne((async a=>{await a.putPresence(1,e),await a.putIncarna(p.IncarnaRoots,e)})),await e.startingBoard.highestNumberedTerrain(Ft.Mountains).putPresence(1,e),await e.startingBoard.highestNumberedTerrain(Ft.Wetlands).putPresence(1,e)}}],uniquePowers:[_e.BloomingOfTheRocksAndTrees,_e.BoonOfResilientPower,_e.EntwineTheFatesOfAll,_e.RadiantAndHallowedGrove],innatePowers:[_e.ShelterUnderToweringBranches,_e.RevokeSanctuaryAndCastOut],lore:"Towering Roots of the Jungle is a massive, sprawling tree, mighty and ancient. It predates the Dahan, but its history has entwined with theirs ever since they arrived: as part of the terms of the First Reckoning, it served as one place where Dahan might settle freely. It protected the land from any accidental damage done by the Dahan, and the Dahan from Spirits that wished them ill.<br>It has never before felt the need to reach out through its offshoots and descendants around the island, but the threat of the Invaders and their heedless destruction has motivated it to grow and change in this new way.",playStyle:"Incredibly good at protecting everything at its Towering Roots of the Jungle - and can draw Invaders towards there - but is constrained in when and where it can move its Towering Roots of the Jungle. Has some ability to Remove Invaders (driving them from the island), but starts off vastly better at guarding the land than at smashing things.",complexity:"Moderate"},Hf={name:"Wandering Voice Keens Delirium",set:s.NatureIncarnate,aspects:[],specialRules:[{name:"A Clarion Voice Given Form",text:"You have an Incarna (<incarna-voice>). If empowered, it Isolates its land.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Voice,[r.GlobalReminder]:()=>({icon:"Isolate<br><incarna-voice>",ongoing:!0,visible:a.hasEmpoweredIncarna,spirit:a,players:[a]}),[r.Isolated]:({land:t})=>t.has(e.IncarnaVoice)&&a.hasEmpoweredIncarna})}},{name:"Spread Tumult and Delusion",text:"When your Actions add/move <incarna-voice> to a land with Invaders, Add 1 <strife> in the destination land.<br>In lands with or adjacent to <incarna-voice>, if <strife> is present, <dahan> do not participate in Ravage. (They do not take Damage or counterattack. Isolate has no effect on <incarna-voice> and <dahan> being adjacent.)",effects:[{text:"When your Actions add/move <incarna-voice> to a land with Invaders, Add 1 <strife> in the destination land.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Voice,[r.GlobalReminder]:()=>({icon:"Move<br>= <strife>",ongoing:!0,spirit:a,players:[a]}),[r.AfterAddingPiece]:async({land:t,additions:n})=>{e.action.spirit===a&&n.some((({piece:t})=>t.isA(e.IncarnaVoice)&&t.owner===a))&&await t.addStrife(1)},[r.AfterMoving]:async({piece:t,destination:n})=>{e.action.spirit===a&&t.isA(e.IncarnaVoice)&&t.owner===a&&await n.addStrife(1)}})}},{text:"In lands with or adjacent to <incarna-voice>, if <strife> is present, <dahan> do not participate in Ravage. (They do not take Damage or counterattack. Isolate has no effect on <incarna-voice> and <dahan> being adjacent.)",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Voice,[r.GlobalReminder]:()=>({icon:"<dahan><br>DNPIR",ongoing:!0,spirit:a,players:[a]}),[r.DoesNotParticipateInRavage]:async({location:t})=>{t.numberOfPiecesInThisOrAdjacentLands(e.IncarnaVoice,a)>=1&&t.has(e.Strife)&&await t.doNotParticipateInRavage({pieces:e.Dahan})}})}}]},{name:"Senseless Roaming",text:"When your Actions Add <strife> to an <explorer>/<town>, you may Push it.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Voice,[r.GlobalReminder]:()=>({icon:"<strife> =<br>Push",ongoing:!0,spirit:a,players:[a]}),[r.AfterAddingStrife]:async({piece:t})=>{e.action.type!==en.SpiritAction&&e.action.type!==en.PowerAction||e.action.spirit!==a||!t.isA(e.ExplorerOrTown)||await t.push({quantifier:w.May})}})}},{name:"Incarna",[r.Now]:async({you:e,$:a})=>{await a.addSubEffect({effectId:pe.Voice,text:"<incarna-voice> may count as <presence>/<sacred>.",[r.GlobalReminder]:()=>({icon:"<incarna-voice> =<br><presence>/<sacred>",ongoing:!0,spirit:e,players:[e]}),[r.HasSacredSiteOf]:({land:a,spirit:t})=>t===e&&a.pieces.some((e=>e.piece===p.IncarnaVoice))})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[r.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Add/Move <incarna-voice> to Land with Your Presence",[r.Now]:async({you:e})=>{await e.addOrMoveIncarnaToLandWithPresence(p.IncarnaVoice)}},{text:"Gain +1 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(1)}}]},{effects:[{text:"Add a <presence> in <range-3>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(3)}},{text:"Add a <presence> in <range-1>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(1)}}]},{effects:[{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-2>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(2)}},{text:"Gain +1 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(1)}},{text:"Gain Air",[r.Now]:async({you:e})=>{await e.gainElementsUntilEndOfTurn({[i.Air]:1})}}]}],tracks:[{energy:0,name:"Top-track: 0 Energy"},{requires:0,energy:1,name:"Top-track: 1 Energy"},{requires:1,elements:[i.SunOrMoon],name:"Top-track: Sun OR Moon"},{requires:2,energy:2,name:"Top-track: 2 Energy"},{requires:3,elements:[i.Air],name:"Top-track: Air"},{requires:4,energy:4,name:"Top-track: 4 Energy"},{requires:5,effect:{actionId:"PushIncarna",text:"Push Your Incarna",[r.Now]:async({you:e})=>{await e.incarna.location.push({pieces:Z.IncarnaVoice,owner:e})}},effectRequires:({you:e})=>e.hasIncarna,name:"Top-track: Push your Incarna"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:7,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:8,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:9,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:10,effect:{actionId:"ReclaimOne",text:"Reclaim One",[r.Now]:async({you:e})=>{await e.reclaim(1)}},effectRequires:({you:e})=>e.hasReclaimableCards,name:"Bottom-track: Reclaim One"},{requires:11,cardPlays:4,name:"Bottom-track: 4 Card Plays"}],setup:[{text:"Put 2 <presence> on your starting board: 1 in land #6 and 1 in land #7. Put <incarna-voice> on your starting board in land #6.",[r.Now]:async({you:e})=>{const a=e.startingBoard.inLandNumber(6);await a.putPresence(1,e),await a.putIncarna(p.IncarnaVoice,e),await e.startingBoard.inLandNumber(7).putPresence(1,e)}}],uniquePowers:[_e.ExhaleConfusionAndDelirium,_e.FrightfulKeening,_e.TurmoilsTouch,_e.TwistPerceptions],innatePowers:[_e.InscrutableJourneying,_e.MindShatteringSong],lore:"Ages ago, Calls All Living Things to Die was a great and respected Spirit, until it decided to test the limits of its power - accounts disagree as to why - and devastated a portion of the island with a vast swath of death. Matters would have gone even worse but for three Spirits who cleverly sundered the great Spirit's voice and bound it to wander, never returning to its owner.<br>Wandering Voice Keens Delirium only occasionally brings death with its song, now, more usually causing derangement, obsession and folly in those it touches. The Dahan have learned a variety of tricks to avoid the worst of its influence, but are occasionally affected nonetheless.",playStyle:"Very positional; has a highly mobile Incarna (particularly with lots of Air) that adds Strife and chases Explorer/Town around as it roams the island.<br>Has a harder time setting up Dahan counterattacks, but can use Mind-Shattering Song to more directly harm Invaders with Strife - and earn a fair bit of Fear in the process.",complexity:"High"},Uf={[i.Sun]:{name:"Sun",text:"<sun>",elements:[i.Sun]},[i.Moon]:{name:"Moon",text:"<moon>",elements:[i.Moon]},[i.Fire]:{name:"Fire",text:"<fire>",elements:[i.Fire]},[i.DarkFire]:{name:"Dark Fire",text:"<darkfire>",elements:[i.DarkFire]},[i.Air]:{name:"Air",text:"<air>",elements:[i.Air]},[i.Water]:{name:"Water",text:"<water>",elements:[i.Water]},[i.Earth]:{name:"Earth",text:"<earth>",elements:[i.Earth]},[i.Plant]:{name:"Plant",text:"<plant>",elements:[i.Plant]},[i.Animal]:{name:"Animal",text:"<animal>",elements:[i.Animal]},[i.Any]:{name:"Any",text:"<any>",elements:qn},[i.SunOrMoon]:{name:"Sun OR Moon",text:"<sun-moon>",elements:[i.Sun,i.Moon]},[i.WaterOrAnimal]:{name:"Water OR Animal",text:"<water-animal>",elements:[i.Water,i.Animal]},[i.FireOrPlant]:{name:"Fire OR Plant",text:"<fire-plant>",elements:[i.Fire,i.Plant]}};var qf;!function(e){e.RoilingWaters="RoilingWater",e.SereneWaters="SereneWaters",e.WatersRenew="WatersRenew",e.WatersTasteOfRuin="WatersTasteOfRuin"}(qf||(qf={}));const jf={name:"Roiling Waters",set:s.NatureIncarnate,effects:[{name:"Lands of Blood and Savagery",text:"When your Powers add or move <beasts> into a land, you may do 1 Damage there per added or moved <beasts>.<br><br>When your Powers add or move any number of <dahan> into a land, you may do 1 Damage there (max. once per Power).",card:qf.RoilingWaters,textArea:[.201,.477],[r.Now]:async({$:e,you:a})=>{await e.clickToContinue(),await e.addSubEffect({effectId:pe.RoilingWaters,effects:[{[r.GlobalReminder]:()=>({icon:"<beasts><br>1 <damage>",ongoing:!0,spirit:a,players:[a]}),textArea:[.204,.324],text:"When your Powers add or move <beasts> into a land, you may do 1 Damage there per added or moved <beasts>.",[r.AfterAddingPiece]:async({additions:t})=>{if(e.action.power&&e.action.spirit===a){const a=W(t.filter((a=>a.piece.isA(e.Beasts))).map((e=>e.location)));for(const n of a){const a=t.filter((a=>a.piece.isA(e.Beasts)&&a.location===n)).length;await n.damage(a)}}},[r.AfterMoving]:async({piece:t,destination:n,movement:r})=>{e.action.power&&e.action.spirit===a&&t.isA(e.Beasts)&&r!==q.Relocate&&await n.damage(1)}},{[r.GlobalReminder]:()=>({icon:"<dahan><br>1 <damage>",ongoing:!0,spirit:a,players:[a]}),textArea:[.342,.471],text:"When your Powers add or move any number of <dahan> into a land, you may do 1 Damage there (max. once per Power).",[r.AfterAddingPiece]:async({additions:t})=>{if(e.action.power&&e.action.spirit===a&&!e.action.data.hasUsedRoilingWaters){const a=W(t.filter((a=>a.piece.isA(e.Dahan))).map((e=>e.location)));await An.createCollection(e,a).autoPickOne((async a=>{e.action.data.hasUsedRoilingWaters=!0,await a.damage(1)}))}},[r.AfterMoving]:async({piece:t,destination:n,movement:r})=>{!e.action.data.hasUsedRoilingWaters&&e.action.power&&e.action.spirit===a&&t.isA(e.Dahan)&&r!==q.Relocate&&(e.action.data.hasUsedRoilingWaters=!0,await n.damage(1))}}]})}}],requirement:({spirit:e})=>e.numberOfHealingMarkers>=3&&e.numberOfHealingAnimalMarkers>=2&&0===e.healingCards.length,requirementText:"\n    <div><bullet> Claim at least 3 total Healing Markers.</div>\n    <div><bullet> Claim at least 2 <animal> Healing Markers.</div>\n    <div><bullet> No other Healing cards claimed.</div>\n  "},Jf={name:"Serene Waters",set:s.NatureIncarnate,effects:[{name:"Lands of Peace and Harmony",text:"When your Powers move any number of Invaders into your lands, you may Downgrade 1 of those Invaders (max. once per Power).<br><br>When your Powers add or move any number of <dahan> into one of your lands, you may Downgrade 1 Invader there (max. once per Power).<br><br>(If you do both, you can pick the same Invader twice.)",textArea:[.198,.609],card:qf.SereneWaters,[r.Now]:async({$:e,you:a})=>{await e.clickToContinue(),await e.addSubEffect({effectId:pe.SereneWaters,textArea:[.192,.606],effects:[{[r.GlobalReminder]:()=>({icon:"Move<br><explorer><town><city>",ongoing:!0,spirit:a,players:[a]}),textArea:[.195,.31],text:"When your Powers move any number of Invaders into your lands, you may Downgrade 1 of those Invaders (max. once per Power).",[r.AfterAddingPiece]:async({additions:t})=>{if(e.action.power&&e.action.spirit===a&&!e.action.data.hasUsedSereneWatersFirst){const n=W(t.filter((e=>e.piece.isInvader&&e.location.hasPresenceOf(a))).map((e=>e.piece)));await wn.createCollection(e,n).optionallyPickOne((async a=>{e.action.data.hasUsedSereneWatersFirst=!0,await a.downgrade()}))}},[r.AfterMoving]:async({piece:t,destination:n,movement:r})=>{e.action.power&&e.action.spirit===a&&t.isInvader&&n.hasPresenceOf(a)&&!e.action.data.hasUsedSereneWatersFirst&&r!==q.Relocate&&await e.may({prompt:`Downgrade ${ee[t.piece].text}?`})&&(e.action.data.hasUsedSereneWatersFirst=!0,await t.downgrade())}},{textArea:[.333,.503],text:"When your Powers add or move any number of <dahan> into one of your lands, you may Downgrade 1 Invader there (max. once per Power).",[r.GlobalReminder]:()=>({icon:"Move<br><dahan>",ongoing:!0,spirit:a,players:[a]}),[r.AfterAddingPiece]:async({additions:t})=>{if(!e.action.data.hasUsedSereneWatersSecond&&e.action.power&&e.action.spirit===a){const n=W(t.filter((t=>t.piece.isA(e.Dahan)&&t.location.hasPresenceOf(a))).map((e=>e.location)));await a.forPiecesThatIs(e.Invader).where((e=>n.includes(e.location))).optionallyPickOne((async a=>{e.action.data.hasUsedSereneWatersSecond=!0,await a.downgrade()}))}},[r.AfterMoving]:async({piece:t,movement:n,destination:r})=>{!e.action.data.hasUsedSereneWatersSecond&&e.action.power&&e.action.spirit===a&&t.isA(e.Dahan)&&r.hasPresenceOf(a)&&n!==q.Relocate&&await r.piecesThatAre(e.Invader).optionallyPickOne((async a=>{e.action.data.hasUsedSereneWatersSecond=!0,await a.downgrade()}))}}]})}}],requirement:({spirit:e})=>e.numberOfHealingMarkers>=3&&e.numberOfHealingWaterMarkers>=2&&0===e.healingCards.length,requirementText:"\n    <div><bullet> Claim at least 3 total Healing Markers.</div>\n    <div><bullet> Claim at least 2 <water> Healing Markers.</div>\n    <div><bullet> No other Healing cards claimed.</div>\n  "},Vf={name:"Waters Renew",set:s.NatureIncarnate,effects:[{text:"Lose Innate Power: Sanguinary Taint.",[r.Now]:async({you:e})=>{await e.forgetPower(_e.SanguinaryTaint)}},{text:"Lose Special Rule: Seeking a Path towards Healing.",[r.Now]:({$:e})=>(e.removeEffectsWithId(pe.WoundedSeekingAPathTowardsHealing),Promise.resolve())},{text:"Gain Call to Fastness of Renewal",[r.Now]:async({you:e})=>{const a=await e.gainPower(_e.CallToAFastnessOfRenewal);await a.play()}}],requirement:({spirit:e})=>e.numberOfHealingMarkers>=5&&e.numberOfHealingWaterMarkers>=3,requirementText:"\n    <div><bullet> Claim at least 5 total Healing Markers.</div>\n    <div><bullet> Claim at least 3 <water> Healing Markers.</div>\n  "},Yf={name:"Waters Taste Of Ruin",set:s.NatureIncarnate,effects:[{text:"Lose Innate Power: Swirl And Spill.",[r.Now]:async({you:e})=>{await e.forgetPower(_e.SwirlAndSpill)}},{text:"Lose Special Rule: Seeking a Path towards Healing.",[r.Now]:({$:e})=>(e.removeEffectsWithId(pe.WoundedSeekingAPathTowardsHealing),Promise.resolve())},{text:"Gain Afflict With Bloodthirst",[r.Now]:async({you:e})=>{const a=await e.gainPower(_e.AfflictWithBloodthirst);await a.play()}}],requirement:({spirit:e})=>e.numberOfHealingMarkers>=5&&e.numberOfHealingAnimalMarkers>=3,requirementText:"\n    <div><bullet> Claim at least 5 total Healing Markers.</div>\n    <div><bullet> Claim at least 3 <animal> Healing Markers.</div>\n  "},zf={[qf.RoilingWaters]:jf,[qf.SereneWaters]:Jf,[qf.WatersRenew]:Vf,[qf.WatersTasteOfRuin]:Yf},Qf={name:"Wounded Waters Bleeding",set:s.NatureIncarnate,aspects:[],specialRules:[{name:"Seeking a Path towards Healing",text:"After playing cards each Spirit Phase:<br><br><bullet> Claim a Healing Marker (Element Marker) matching whichever of <water> or <animal> you have more of. (You break ties.)<br><br><bullet> You may then Claim a Healing Card if you meet its requirements.<br><br><bullet> Then Destroy 1 <presence> or Forget a Power Card (unless a Healing Card just removed this rule).",effects:[{text:"After playing cards each Spirit Phase:<br><br>Claim a Healing Marker (Element Marker) matching whichever of <water> or <animal> you have more of. (You break ties.)<br><br>You may then Claim a Healing Card if you meet its requirements.<br><br>Then Destroy 1 <presence> or Forget a Power Card (unless a Healing Card just removed this rule).",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.WoundedSeekingAPathTowardsHealing,[r.GlobalReminder]:()=>({icon:"Healing<br>Cards",ongoing:!0,spirit:a,players:[a],previewPowers:()=>({powers:[qf.WatersTasteOfRuin,qf.RoilingWaters,qf.WatersRenew,qf.SereneWaters],selected:[]})})}),await e.addSubEffect({effectId:pe.WoundedSeekingAPathTowardsHealing,[r.GlobalReminder]:()=>({icon:"<water><animal>",ongoing:!0,spirit:a,players:[a]}),[r.AfterPlayPowers]:async()=>{await e.addSubEffect({effects:[{text:"After playing cards each Spirit Phase:<br><br>Claim a Healing Marker (Element Marker) matching whichever of <water> or <animal> you have more of. (You break ties.)",[r.Now]:async()=>{await e.chooseBetween({effects:[i.Water,i.Animal].map((e=>({actionId:e,text:Uf[e].text,[r.Now]:async()=>{await a.convertElements({[e]:a.elements[e===i.Water?i.Animal:i.Water]}),await a.gainHealingMarker(e)},condition:()=>a.maxElementsWithConvert(e)>=a.elements[e===i.Water?i.Animal:i.Water]})))})}},{text:"You may then Claim a Healing Card if you meet its requirements. (You can claim your first Healing Card on Turn 3.)",[r.Now]:async()=>{const t=Object.keys(zf).filter((e=>zf[e].requirement({spirit:a})&&!a.healingCards.includes(e))),n=await e.queryOptional({query:tn.SelectHealingCard,items:t,actionIds:t});if(null!==n){const r=t[n];a.healingCards.push(r);for(const t of zf[r].effects)await e.doSpiritAction((()=>e.addEffect({...t,spirit:a,players:[a]})))}}}]})}})}},{text:"Then Destroy 1 <presence> or Forget a Power Card (unless a Healing Card just removed this rule).",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.WoundedSeekingAPathTowardsHealing,[r.AfterPlayPowers]:async()=>{e.hasEffectNamed("Seeking a Path towards Healing")&&await e.chooseBetween({effects:[{actionId:"DestroyPresence",text:"Destroy 1 <presence>",[r.Now]:async()=>{await a.destroyPresence(1)}},{actionId:"ForgetPowerCard",text:"Forget a Power Card",[r.Now]:async()=>{await a.forgetPowers()}}]})}})}}]}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[r.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Gain +1 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(1)}}]},{effects:[{text:"Gain Power Card",[r.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-2>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(2)}}]},{requiresHealingCard:!0,effects:[{text:"Add a <presence> in <range-3>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(3)}},{text:"Gain +3 Energy",[r.Now]:async({you:e})=>{await e.gainEnergy(3)}},{text:"Add a Destroyed Presence in <range-1>",[r.Now]:async({you:e})=>{await e.addPresenceInRange(1,{destroyed:!0})}}]}],tracks:[{energy:0,cardPlays:1,name:"Middle-track: 0 Energy, 1 Card Play"},{requires:0,elements:[i.WaterOrAnimal],name:"Middle-track: Water OR Animal"},{requires:1,effect:{actionId:"GatherBlight",text:"Gather 1 <blight> into 1 of Your Lands",[r.Now]:({you:e,$:a})=>e.inLandsWhere((e=>e.hasAdjacentLocationWhere((e=>e.isLandForBlight&&e.has(a.Blight))))).pickOne((async e=>{await e.gatherOne(a.Blight)}),{noOptions:"None of your lands have an adjacent <blight>."})},name:"Middle-track: Gather 1 Blight into 1 of Your Lands"},{requires:2,energy:1,cardPlays:2,name:"Middle-track: 1 Energy, 2 Card Plays"},{requires:3,energy:3,name:"Top-track: 3 Energy"},{requires:4,energy:4,elements:[i.FireOrPlant],name:"Top-track: 4 Energy, Fire OR Plant"},{requires:5,energy:5,elements:[i.Any],name:"Top-track: 5 Energy, Any"},{requires:3,cardPlays:3,name:"Bottom-track: 3 Card Play"},{requires:7,effect:{actionId:"ReclaimOne",text:"Reclaim One",[r.Now]:async({you:e})=>{await e.reclaim(1)}},name:"Bottom-track: Reclaim One"},{requires:8,cardPlays:4,name:"Bottom-track: 4 Card Plays"}],setup:[{text:"On your starting board, put 2 <presence> in a land with <blight>, then put 2 <presence> and 1 <blight> (from the box) in the highest-numbered land with a <town> Setup symbol.",[r.Now]:async({you:e,$:a})=>{await e.startingBoard.inLandsFilteredByAllInPriority((e=>e.has(a.Blight))).autoPickOne((async a=>{await a.putPresence(2,e)})),await e.startingBoard.inLandsFilteredByAllInPriority((e=>e.setupSymbols.includes(p.Town))).withMost((e=>e.landNumber)).autoPickOne((async t=>{await t.putPresence(2,e),await t.add(1,a.Blight)}))}},{text:"You start with your 4 Unique Power Cards and 4 Energy. Set your 4 Healing Cards nearby.",[r.Now]:async({you:e})=>{await e.gainEnergy(4)}}],uniquePowers:[_e.BloodWaterAndBloodlust,_e.BoonOfCorruptedBlood,_e.DrawToTheWatersEdge,_e.WrackWithPainAndGrief],innatePowers:[_e.SwirlAndSpill,_e.SanguinaryTaint],lore:"In years past, Peace-Waters was a woodland pond, fed by a small river: a Spirit of contended coexistence and the gift of water. Humans and animals would drink in peace, then move on.<br>The Invaders, too, found Peace-Waters, drank, and moved on. Upriver, they built slaughterhouses and tanneries, pouring charnel-blood through the pool day after day, year after year.<br>The Spirit which used to be Peace-Waters has barely survived. It is no longer a Spirit of peace - but it has not yet found coherence in a new nature, and until it does, it is at risk of unraveling altogether.",playStyle:"Starts off wounded, losing a Presence or a Power Card every turn. Heals over the course of the game, finding a new nature - while some choices may be a touch better or worse due to Adversary, Power Card picks, teammates, etc., most combinations are viable in most games.<br>Benefits from careful Presence placement, both due to losing Presence and because some if its Unique Powers must target from lands with Blight.",complexity:"High"},Kf={[hn.Lightning]:of,[hn.River]:cf,[hn.Earth]:rf,[hn.Shadows]:lf,[hn.Thunderspeaker]:hf,[hn.Green]:sf,[hn.Ocean]:df,[hn.Bringer]:nf,[hn.Fangs]:gf,[hn.Keeper]:ff,[hn.Wildfire]:yf,[hn.Serpent]:wf,[hn.Stone]:Bf,[hn.Memory]:Pf,[hn.Trickster]:kf,[hn.Lure]:Tf,[hn.ManyMinds]:Ef,[hn.Volcano]:Ff,[hn.Shroud]:Sf,[hn.Vengeance]:Lf,[hn.Starlight]:Df,[hn.Fractured]:bf,[hn.Downpour]:uf,[hn.Finder]:pf,[hn.Teeth]:Af,[hn.Eyes]:mf,[hn.Mud]:If,[hn.Heat]:vf,[hn.Whirlwind]:xf,[hn.Behemoth]:Rf,[hn.HearthVigil]:Mf,[hn.Darkness]:Nf,[hn.Gaze]:Wf,[hn.Roots]:Gf,[hn.Earthquakes]:$f,[hn.Voice]:Hf,[hn.Wounded]:Qf},Xf={name:"Second Wave",set:s.BranchAndClaw,difficulty:0,configurationError:e=>{const a=e.boards.map((e=>e.spirit?.spirit)).find((a=>void 0!==a&&e.startWaveHistory?.usedSpirits.includes(a)));if(void 0!==a)return`${Kf[a].name} has been used in a previous wave and cannot be chosen again.`},rules:[{[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.SecondWave,[r.AfterGameEnds]:async({winReason:a})=>{if(void 0!==a){const a=[],t=[],n=[...e.config.startWaveHistory?.usedSpirits??[],...e.spirits.map((e=>e.spirit))],i=W([...e.config.startWaveHistory?.revealedBlightCards??[],...e.blightCardsDiscarded,...e.blightCardActive?[e.blightCardActive]:[]]),s=e.config.startWaveHistory?.wave??1,o=Math.min(s+1,7);await e.addSubEffect({name:1===s?"After the First Game":"After each Wave",scenario:Xn.SecondWave,effects:[{text:"Each Spirit sets aside one Power Card to assist with the next Game.",[r.Now]:async()=>{await e.eachSpirit((async e=>{await e.powersWhere((e=>e.isA(ye.AnyCard)&&!e.isBlessed&&!e.assisted)).pickOne((t=>(a.push({power:t.power,boardIndex:e.startingBoardIndex}),Promise.resolve())),{players:[e]})}))}},{text:"Remove all <presence> and Invaders.",[r.Now]:async()=>{await e.clickToContinue(),await e.forPiecesWhere((e=>e.isPresence||e.isInvader)).forEach((async e=>{await e.remove(A.Silent)}))}},{text:`Leave on the island one of each token-type per player:<br><br>${e.boardCount} <beasts>, ${e.boardCount} <wilds>, ${e.boardCount} <disease>, ${e.boardCount} <badlands>`,[r.Now]:async()=>{await e.clickToContinue(),await e.inBoardsWhere((a=>a.boardIndex>=e.boardCount)).forEach((async a=>{for(const t of a.pieces)t.isA(e.Blight)?await t.location.removeBlight():await t.remove(A.Silent)}));for(const a of[e.Beasts,e.Wilds,e.Disease,e.Badlands]){const t=Math.max(e.pieceCountIncludingStasis(a)-e.boardCount,0);t>0&&await e.forPiecesThatIs(a).pickMultiple({amount:t,forPickedItem:async e=>{await e.remove(A.Silent)},effect:{prompt:`Pick ${ee[a].text} to remove.`}})}}},{text:`Leave ${o} <blight> per player. Return the rest to the Blight Card.`,[r.Now]:async()=>{await e.clickToContinue();const a=Math.max(e.pieceCountIncludingStasis(e.Blight)-o*e.boardCount,0);a>0&&await e.forPiecesThatIs(e.Blight).pickMultiple({amount:a,forPickedItem:async e=>{await(e.location?.removeBlight())}})}},{text:"In lands with 3 <dahan> or more, Push 1 <dahan> to adjacent lands until there are 2 or fewer.",[r.Now]:async()=>{await e.inLandsWhere((a=>a.hasAtLeast(3,e.Dahan))).selectOrder().forEach((async a=>{await a.push({pieces:e.Dahan,amount:Math.max(a.numberOf(e.Dahan)-2,0)})}),{noOptions:"No lands with 3 <dahan> or more"})}},{text:"Then, on each board with 2-4 <dahan>, add 1 <dahan> to the lowest-numbered land with <dahan>.",[r.Now]:async()=>{await e.inBoardsWhere((a=>a.numberOf(e.Dahan)>=2&&a.numberOf(e.Dahan)<=4)).forEach((async a=>{const t=a.lowestNumberedLand((a=>a.has(e.Dahan)));void 0!==t&&await t.add(1,e.Dahan)}),{noOptions:"No boards with 2-4 <dahan>."})}},{text:"Then, on each board with 9 <dahan> or more, remove <dahan> until there are 8 or fewer.",[r.Now]:async()=>{await e.inBoardsWhere((a=>a.numberOf(e.Dahan)>=9)).forEach((async a=>{await a.forPiecesThatIs(e.Dahan).pickMultiple({amount:Math.max(a.numberOf(e.Dahan)-8,0),forPickedItem:async e=>{await e.remove(A.Silent)}})}),{noOptions:"No boards with 9 <dahan> or more."})}}]}),await e.forPiecesWhere((a=>a.isOneOfIgnoringCountAs(e.Beasts,e.Wilds,e.Disease,e.Badlands,e.Blight,e.Dahan))).forEach((e=>(t.push({piece:e.piece,landIndex:e.location.landIndex,boardIndex:e.location.boardIndex}),Promise.resolve()))),await e.addBlightToBlightCard(e.slowHealingBlight);const d=void 0!==e.blightCardActive?Math.max(e.blightOnBlightCard-(2*e.boardCount+1),0):0;e.config.finishWaveHistory={pieces:t,wave:e.config.startWaveHistory?.wave??1,usedSpirits:n,revealedBlightCards:i,blightPool:e.blightPool+d,blightOnBlightCard:e.blightOnBlightCard-d,assistance:a,blightStatus:e.blightStatus},await e.clickToContinue({text:"Post Game Setup finished."}),await e.sendEvent({type:T.GameEnd})}}})}},{[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.SecondWave,[r.PreventAddBlightInSetup]:async()=>{if((e.config.startWaveHistory?.wave??1)>1){if(!(e.blightPool>0))return!0;await e.removeBlightFromBlightPool(1)}return!1}})}},{[r.Now]:async({$:e})=>{if(void 0!==e.config.startWaveHistory){const{pieces:t,wave:n,revealedBlightCards:i,blightPool:s,blightOnBlightCard:o,assistance:d}=e.config.startWaveHistory,c=i.length>0?i[i.length-1]:void 0;for(const t of(a=i,[...a].reverse()))rc[t].stillHealthy||t===c?(e.blightCardsInDeck.remove(t),e.blightCardsInDeck.insert(t),e.addRevealedBlightCard()):await e.discardBlightCard(t);await e.addBlightToBlightPool(s),e.blightOnBlightCard<o?await e.addBlightToBlightCard(o-e.blightOnBlightCard):e.blightOnBlightCard>o&&await e.removeBlightFromBlightCard(e.blightOnBlightCard-o);const l=5-n;await e.forPieces().forEach((async e=>{e.isInvader?e.location.landNumber>=6&&l>0&&null!==e.location.board&&await e.moveTo({location:e.location.board.inLandNumber(e.location.landNumber-l),pieceFilter:Z.Invader,movement:q.Relocate,withoutWait:!0}):await e.remove(A.Silent)}));for(const a of t)a.boardIndex<e.boardCount&&await e.boards[a.boardIndex].locations[a.landIndex].add(1,Z[a.piece]);const h=[[],[],[5],[4,5],[3,4,5],[2,3,4,5],[1,2,3,4,5],[1,2,3,4,5,6]][Math.min(n,7)];await e.onEachBoard((async a=>{for(const t of h)await a.inLandNumber(t).add(1,e.Town)}));for(const a of d)e.removePowerCardFromDecks(a.power);await e.addSubEffect({text:'Once Stage III begins, the Power Cards set aside from the first game may be "played" (during a Spirit Phase as usual). They cost nobody any Energy or Card Plays, grant no Elements, and may target any land. Thresholds trigger if they require 10 or fewer Elements. Each one is discarded after one use (or at the end of the game, if playing further waves)',[r.Now]:async()=>{await e.addSubEffect({effectId:pe.SecondWave,[r.AfterChangingInvaderDeck]:async()=>(3===e.stage&&(e.removeThisEffect(),await e.eachSpirit((async e=>{const a=d.find((a=>a.boardIndex===e.startingBoardIndex));void 0!==a&&await e.gainPower(a.power,{assisted:!0})}))),Promise.resolve())})}})}var a}}]},_f={name:"Ward the Shores",set:s.BranchAndClaw,difficulty:2,rules:[{name:"Ward the Shores",effects:[{text:"Once per turn, each Spirit may play a Power Card as Ward the Shores.<br><br>(See Scenario Card for details.)",[r.Now]:async({$:e})=>{await e.eachSpirit((async a=>{let t=null;await a.addExtraAction({effectId:pe.WardTheShores,actionId:`WardTheShores${a.spirit}`,icon:"Ward",scenario:Xn.WardTheShores,enabled:()=>e.phase===Xe.GainEnergy&&null===t&&a.powersWhere((e=>e.isA(ye.AnyCard)&&e.isInHand&&!e.isBlessed)).count>0,onActivate:async()=>{await e.addSubEffect({effects:[{scenario:Xn.WardTheShores,text:"Once per turn, each Spirit may play a Power Card as Ward the Shores.",prompt:"Pick Power to play as Ward the Shores.",[r.Now]:async()=>{await a.powersWhere((e=>e.isA(ye.AnyCard)&&e.isInHand)).pickOne((async e=>{t=e.power;const n=a.powers.indexOf(e);await a.forgetPower(e.power,{silent:!0});const r=await a.gainPower(_e.WardTheShores,{silent:!0,index:n});await r.play()}))}}]})}}),await e.addSubEffect({effectId:pe.WardTheShores,[r.TimePasses]:async()=>{await e.eachSpirit((async()=>{const e=a.powers.findIndex((e=>e.power===_e.WardTheShores));if(e>=-1&&await a.forgetPower(_e.WardTheShores,{silent:!0}),null!==t){const n=await a.gainPower(t,{silent:!0,index:e>=-1?e:void 0});await n.setStatus(Kn.Discarded),t=null}}))}})}))}},{text:"Once placed, each Warding Pattern grants Defend 3 in its land. They are destroyed any time <blight> is added to their land.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.WardTheShores,[r.DefendFromSpirits]:({land:a})=>3*a.numberOf(e.WardingPattern)})}},{text:"They are destroyed any time <blight> is added to their land.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.WardTheShores,[r.WhenAddingBlight]:async({blightedLands:a})=>{for(const t of a)t.has(e.WardingPattern)&&(await e.clickToContinue({highlightPieces:[t.piecesThatAre(e.WardingPattern).anyOne],highlightLocations:[t]}),await t.destroyAll(e.WardingPattern))}})}},{text:"Get out 4 Scenario Markers per player; these represent Warding Patterns. (If you run out of tokens, you can re-use destroyed / already-placed ones.)",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.WardTheShores,[r.AfterAddingPiece]:async()=>{for(;e.forPiecesThatIs(e.WardingPattern).count>4*e.boardCount;)await e.forPiecesThatIs(e.WardingPattern).pickOne((async e=>{await e.remove()}),{prompt:"Pick a Warding Pattern to remove"})}})}},{text:"The normal Fear-based Victory is not available. Instead: Terror 2+ There is a Warding Pattern in every Coastal land.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.WardTheShores,[r.GlobalReminder]:()=>({icon:`Patterns<br>${e.coastalLandsWithWardingPatterns} / ${e.coastalLands}`,scenario:Xn.WardTheShores,ongoing:!0}),[r.RemoveFearBasedVictory]:()=>!0,[r.WinCondition]:()=>e.terrorLevel>=2&&e.coastalLandsWithWardingPatterns===e.coastalLands?Tg.WardTheShores:null})}},{text:"After making the Fear Deck, put all remaining Fear Cards on the bottom.",[r.Now]:({$:e})=>(e.putAllFearCardsInDeckIntoLevel(3),Promise.resolve())},{text:"If they run out, reshuffle the deck.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.WardTheShores,[r.AfterFearDeckIsDecreasing]:async()=>{3===e.terrorLevel&&0===e.fearCardsInLevelCount[2]&&(await e.clickToContinue(),await e.reshuffleFearDeck(),e.putAllFearCardsInDeckIntoLevel(3))}})}},{name:"Stage III Surge",text:"During Stage III, Explore adds 1 <town> in addition to the usual 1 <explorer>.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.WardTheShores,[r.GlobalReminder]:()=>({icon:"+1 <town>",scenario:Xn.WardTheShores,ongoing:!0,visible:3===e.stage}),[r.AfterSuccessfulExplore]:async({land:a})=>{3===e.stage&&await a.add(1,e.Town)}})}}]}]},Zf={name:"A Diversity of Spirits",set:s.FeatherAndFlame,difficulty:0,rules:[{name:"Strength in Diversity",effects:[{text:"After Growth, if you added 1 or more <presence> to lands with other Spirit's <presence>: Gain 1 Energy or Reclaim 1 non-Major Power Card.",[r.Now]:async({$:e})=>{const a=[];await e.addSubEffect({effectId:pe.ADiversityOfSpirits,[r.AfterAddingPiece]:({land:t,additions:n})=>{if(e.phase===Xe.Grow&&t.hasPresenceFromTwoDifferentSpirits)for(const e of n)e.piece.isPresence&&!a.includes(e.piece.owner)&&a.push(e.piece.owner);return Promise.resolve()},[r.AfterGrowth]:async()=>{for(const t of a)await t.doSpiritAction((async()=>{await e.chooseBetween({players:[t],effects:[{actionId:"Energy",text:"Gain 1 Energy.",[r.Now]:async()=>{await t.gainEnergy(1)}},{actionId:"Reclaim",text:"Reclaim 1 non-Major Power Card.",[r.Now]:async()=>{await t.reclaimCards({amount:1,filter:e=>e.isInDiscard&&e.isA(ye.NonMajorCard)})}}]})}))}})}}]}]},eu={name:"Varied Terrain",set:s.FeatherAndFlame,difficulty:2,rules:[{name:"Mountains May Hide Gold",text:"Add +1 <explorer> when Exploring Mountains. (Including during Setup, if appropriate.)",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.VariedTerrain,[r.AfterSuccessfulExplore]:async({land:a})=>{a.isMountains&&(await e.sendEvent({type:T.GenericMain,text:"Invaders Explored into a <mountains>."}),await a.add(1,e.Explorer))},[r.GlobalReminder]:()=>({icon:"<mountains><br>+1 <explorer>",ongoing:!0})})}},{name:"Jungles Clear-Cut for Land",text:"After Invader Build 1 or More <city> in a Jungle, add 1 <blight> there.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.VariedTerrain,[r.AfterSuccessfulBuild]:async({land:a,additions:t})=>{a.isJungle&&t.some((a=>a.piece.isA(e.City)))&&(await e.sendEvent({type:T.GenericMain,text:"Invaders Built a <city> in a <jungles>."}),await a.addBlight(1))},[r.BuildOrderMatters]:()=>!0,[r.GlobalReminder]:()=>({icon:"<jungles><br><city>=<blight>",ongoing:!0})})}},{name:"Fragile Sands",text:"After Setup: <blight> added to Sands cascades as if <blight> were already present, even when it is not.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.VariedTerrain,[r.BlightAlwaysCascadesInLand]:({land:e})=>e.isSands,[r.GlobalReminder]:()=>({icon:"<sands><br>Cascade",ongoing:!0})})}},{name:"Fertile Wetlands",text:"After Invaders successfully Build in a Wetland, they Build there a second time.",[r.Now]:async({$:e,...a})=>{const t={triggerId:e.nextTriggerId(),[r.Now]:async({action:a})=>{await e.sendEvent({type:T.GenericMain,text:"Invaders Built in <wetlands>."}),await a.parentData.builtLand.doExtraBuild()}};await e.addSubEffect({effectId:pe.VariedTerrain,[r.AfterSuccessfulBuild]:async n=>{n.land.isWetlands&&(e.action.data.builtLand=n.land,await e.addTrigger(t,a.effect,a.action))},[r.GlobalReminder]:()=>({icon:"<wetlands><br>Build",ongoing:!0})})}}]},au={name:"Despicable Theft",set:s.JaggedEarth,difficulty:2,rules:[{name:"Setup Changes",text:"Make a pool of 18 Scenario Markers: 12 blank ones and (1, 1, 1, 2, 2, 3). They represent small groups of Thieves trying to escape with knowledge of treasure. Mix them to form a face-down supply.",[r.Now]:async({$:e,...a})=>{let t=[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,2,2,3];const n=[],i=a=>{if(null!==a){if(a.numberOf(e.Thief)>=2&&a.numberOf(e.Dahan)<2&&!e.config.controlledFate){const t=a.piecesThatAre(e.Thief).items.map((e=>e.scenarioNumber));e.shuffle(t),a.piecesThatAre(e.Thief).items.forEach((e=>{e.scenarioNumber=t.pop()}))}a.piecesThatAre(e.Thief).items.forEach((e=>{e.placeInGroup()}))}},s={triggerId:e.nextTriggerId(),text:"Thieves can only be Destroyed/Removed/Replaced in lands with no <town>/<city> and 2 or more <dahan>. Otherwise, they elude you, and are instead Pushed.",[r.Now]:async({action:a})=>{for(const{piece:t,location:i,removement:s}of a.parentData.possiblyRemoveThieves??[])if(void 0!==i&&(e.someEffect(r.PreventRemovalEffects)||((a.parentData.landsWithoutTownOrCity??[]).includes(i)||i.doesntHave(e.TownOrCity))&&((a.parentData.landsWithAtLeast2Dahan??[]).includes(i)||i.hasAtLeast(2,e.Dahan))))n.push(t.thiefNumber),s!==A.Replace&&t.remove(A.Silent),await e.sendEvent({type:T.GenericSub,text:`A thief was ${x[s].textPast} in ${i.coordinateLink}.`}),x[s].isDestroyLike&&await e.generateFear({amount:1,location:void 0,fromDestroyingBuildings:!1});else if(s===A.Replace&&void 0!==t.location){const e=await t.replace([p.Thief]);e.added.length>0&&await e.added[0].piece.push()}else{const[{piece:e}]=await i.createPiece(1,p.Thief);e.scenarioNumber=t.thiefNumber,await e.push()}}};await e.addSubEffect({effects:[{effectId:pe.DespicableTheft,name:"Arrive with <explorer>",text:"After Setup, when Invaders successfully Explore into a land numbered 6 or higher, also add 1 Thief there from the pool.",[r.GlobalReminder]:()=>({icon:`Thieves<br>${e.forPiecesThatIs(e.Thief).count}`,scenario:Xn.DespicableTheft,ongoing:!0}),[r.AfterSuccessfulExplore]:async({land:a})=>{if(!a.landNumbers.some((e=>e<6))&&t.length>0){const n=await a.add(1,e.Thief);if(n.length>0){const a=await e.drawFrom(t,t.map((e=>`${e}`)));n[0].piece.scenarioNumber=a}}}},{effectId:pe.DespicableTheft,name:"Seek to Escape by Ship",text:"Before the Ravage Step, all Thieves on the island move 1 land towards their board's Ocean.",[r.BeforeRavageStep]:async()=>{await e.inLandsWith(e.Thief).forEach((async a=>{await e.doScenarioAction((async()=>{await a.piecesThatAre(e.Thief).forEach((async a=>{const t=a.location,r=t.inAdjacentLocations().where((e=>e.board===t.board&&e.distanceToThisBoardsOcean<t.distanceToThisBoardsOcean)),i=r.copy().where((e=>!t.isIsolated&&!e.isIsolated));if(r.count>0&&await r.pickOne((async e=>{await a.move({locations:{target:g.ToThisLocation,location:e},pickDestinationEffect:{autoPlayOneOption:!0}})}),{highlightPieces:[a],highlightLocations:[a.location],noOptions:""},0===i.count),a.location?.isOcean){const t=a.scenarioNumber;await e.clickToContinue({noOptions:`A Thief ${t>0?`with number ${t}`:"without number "} escaped!`}),n.push(t),await a.remove(A.Silent),await e.loseFear(4);for(let a=0;a<t;a+=1)await e.accelerateTheInvaderDeck()}}))}))}))}},{effectId:pe.DespicableTheft,text:"Thieves are face-down by default, but face-up while in lands with 2 or more <dahan>. If multiple face-down Thieves are in a single land, mix them up.",[r.AfterMoving]:({piece:a,source:t,destination:n})=>(a.isOneOf(e.Thief,e.Dahan)&&(i(t),i(n)),Promise.resolve()),[r.AfterAddingPiece]:({additions:a})=>{if(a.some((a=>a.piece.isOneOf(e.Thief,e.Dahan))))for(const e of W(a.map((e=>e.location))))i(e);return Promise.resolve()},[r.AnyActionStarts]:()=>(e.action.data.landsWithoutTownOrCity=e.inLocationsWhere((a=>a.doesntHave(e.TownOrCity))).items,e.action.data.landsWithAtLeast2Dahan=e.inLocationsWhere((a=>a.hasAtLeast(2,e.Dahan))).items,Promise.resolve()),[r.PreventRemovePiece]:async({piece:t,removement:n})=>!(!t.isA(e.Thief)||[A.Silent,A.Relocate].includes(n))&&(void 0===e.action.data.possiblyRemoveThieves&&(e.action.data.possiblyRemoveThieves=[]),e.action.data.possiblyRemoveThieves.push({piece:t,location:t.location,removement:n}),e.action.data.landsWithoutTownOrCity=[...e.action.data.landsWithoutTownOrCity??[],...e.action.parentData.landsWithoutTownOrCity??[]],e.action.data.landsWithAtLeast2Dahan=[...e.action.data.landsWithAtLeast2Dahan??[],...e.action.parentData.landsWithAtLeast2Dahan??[]],n!==A.Replace&&await t.remove(A.Silent),await e.addTrigger(s,a.effect,a.action,{priority:!0}),n!==A.Replace),[r.AfterRemovePiece]:({piece:a,location:t})=>(a.isOneOf(e.Thief,e.Dahan)&&i(t),Promise.resolve())},{effectId:pe.DespicableTheft,text:"Mix Thieves no longer on the island into the supply at end of turn.",[r.TimePasses]:()=>(t=[...t,...n].sort(),Promise.resolve())}]})}}]},tu={name:"Elemental Invocation",set:s.JaggedEarth,difficulty:1,rules:[{text:"On each board, add 1 <town> to land #6. Add 1 Fear Card to Terror Level 1. Accelerate the Invader Deck.",[r.Now]:async({$:e})=>{await e.addSubEffectUntilEndOfTurn({[r.BeforeSetupPresence]:async()=>{await e.clickToContinue(),await e.onEachBoard((async a=>{a.ignoreInvaderAndBlightInSetup||await a.inLandNumber(6).add(1,e.Town)})),await e.addFearCards(1).toLevel(1),await e.accelerateTheInvaderDeck()}})}},{text:"Once per Spirit Phase, each Spirit may pay Energy to place 1 Element Marker on a corner of one of their lands.<br><br>(See Scenario Card for details.)",[r.Now]:async({$:e})=>{await e.eachSpirit((async a=>{await a.addExtraAction({effectId:pe.ElementalInvocation,actionId:`ElementalInvocation${a.spirit}`,icon:"Element",enabled:()=>e.phase===Xe.GainEnergy||e.phase===Xe.Grow,onActivate:async()=>{await e.addSubEffect({effects:[{[r.Now]:async()=>{const t=[...qn].filter((e=>a.elementsFromCards[e]>0)).map((e=>({actionId:e,text:`${Uf[e].text}`,[r.Now]:async()=>{await a.inCornersWhere((e=>void 0===e.element&&1+e.inAdjacentCorners().where((e=>void 0!==e.element)).count<=a.energy)).pickOne((async t=>{await a.payEnergy(1+t.inAdjacentCorners().where((e=>void 0!==e.element)).count),await t.setElement(e)}),{scenario:Xn.ElementalInvocation,prompt:"Pick a Corner",noOptions:"Cannot afford to add Element to any Corner.",text:'The cost is 1 Energy, +1 Energy per adjacent corner that already has an Element Marker. ("Adjacent" means "along land boundaries"'})}})));await e.chooseBetween({scenario:Xn.ElementalInvocation,text:"Spirit may only place Element Markers which they have on a Power Card in hand, play, or discard.",prompt:"Choose Element:",effects:t})}}]})}})}))}},{name:"Benefits of Elements",text:"When using a land-targeting Power, the Power gains all Elements on the target land's corners, so elemental thresholds can be reached more easily when targeting certain lands.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.ElementalInvocation,[r.AfterTargetingLands]:async({lands:a,owner:t})=>{if(e.config.scenario===Xn.ElementalInvocation){const e=W(a.map((e=>e.corners)).flat()),n={};let r=!1;for(const a of e)a.element&&(n[a.element]=(n[a.element]??0)+1,r=!0);r&&await t.gainElementsUntilEndOfAction(n)}}})}}]},nu=(e,a)=>(e%a+a)%a,ru={name:"The Great River",set:s.JaggedEarth,difficulty:3,configurationError:e=>1===W(e.boards.map((e=>nu(e.rotation,6)))).length?void 0:"Invalid scenario Layout",rules:[{name:"Population Spills Across the River",text:"After the Build Step, Invaders Build in all Coastal land without <town>/<city> but with <explorer>.<br><br>After the Explore Step, Invaders Explore into all Coastal lands without <town>/<city>.",[r.GlobalReminder]:()=>({icon:"River",scenario:Xn.TheGreatRiver,ongoing:!0})},{name:"Population Spills Across the River",text:"After the Build Step, Invaders Build in all Coastal land without <town>/<city> but with <explorer>.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.TheGreatRiver,[r.AfterTheNormalBuildStep]:async()=>{await e.inCoastalLands().where((a=>a.doesntHave(e.TownOrCity)&&a.has(e.Explorer))).selectOrder().forEach((a=>e.doScenarioAction((async()=>{await a.doExtraBuild()}))),{noOptions:"No Coastal lands without <town>/<city> but with <explorer>."})}})}},{name:"Population Spills Across the River",text:"After the Explore Step, Invaders Explore into all Coastal lands without <town>/<city>.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.TheGreatRiver,[r.AfterTheNormalExploreStep]:async()=>{await e.inCoastalLands().where((a=>a.doesntHave(e.TownOrCity))).selectOrder().forEach((a=>e.doScenarioAction((async()=>{await a.doExtraExplore()}))),{noOptions:"No Coastal lands without <town>/<city>."})}})}},{name:"Additional Loss Condition",text:"If more than 3 <town> per player escape off the edge of the map, the Invaders win.<br><br>(See Scenario Card for details.)",[r.Now]:async({$:e})=>{const a=3*e.boardCount+1,t=C.sH.box(0);await e.addSubEffect({effectId:pe.TheGreatRiver,effects:[{[r.LossCondition]:()=>t.get()>=a?kd.GreatRiver:null,[r.GlobalReminder]:()=>({icon:`Escaped<br>${t.get()} / ${3*e.boardCount+1}`,ongoing:!0,scenario:Xn.TheGreatRiver})},{name:"Relentless Migration Eastwards",text:"At the end of the <slow> phase, move each <town> one land Inland (farther away from the Ocean). Start with the most-Inland lands and work your way to the least-Inland.",[r.AfterSlowPhase]:async()=>{const a=[];for(;!e.gameEnded;){const n=e.inLands().where((t=>t.piecesThatAre(e.Town).hasOneWhere((e=>!a.includes(e))))).withMost((e=>e.distanceToNearestOcean)).selectOrder();if(0===n.count)break;await n.forEach((async n=>{await e.doScenarioAction((async()=>{const r=n.adjacentLandsSortedByNorthernmost(),i=r.copy().where((e=>e.distanceToNearestOcean>n.distanceToNearestOcean)),s=r.copy().where((e=>e.distanceToNearestOcean===n.distanceToNearestOcean));let o=0;await n.piecesThatAre(e.Town).where((e=>!a.includes(e))).selectOrder().forEach((async r=>{let d=null,c=!1;i.count>0?(d=i.items[o],o=(o+1)%i.count):n.isEastern||(d=s.items[o],o=(o+1)%s.count),(n.isIsolated||null!==d&&d.isIsolated)&&await e.may({highlightLocations:[n,...null!==d?[d]:[]],text:"Pay 1 Energy to use Isolation to prevent <town> from moving?"})&&(c=!0),c||(null===d?(t.set(t.get()+1),await r.remove(A.Silent),await e.sendEvent({type:T.GenericSub,text:"A <town> escaped over the eastern edge of its board!"})):await r.move({locations:{target:g.ToThisLocation,location:d},pickDestinationEffect:{autoPlayOneOption:!0}})),a.push(r)}),{autoPlayOneOption:!0})}))}))}}}]})}}]},iu={name:"Destiny Unfold",set:s.NatureIncarnate,difficulty:-1,configurationError:e=>e.boards.filter((e=>void 0!==e.spirit)).length>=2?void 0:"Destiny Unfold requires at least 2 Players.",rules:[{name:"Setup Changes",text:"Before the initial Explore, each Spirit drafts Power Cards into their Destiny, in two rounds.<br><br>(See Scenario Card for details.)",[r.Now]:async({$:e})=>{await e.addSubEffectUntilEndOfTurn({[r.BeforeInitialExplore]:async()=>{if(!(e.spiritCount<3))for(let a=1;a<=2;a+=1){const t=3+a,n=3-a,r=2===a?1:-1,i=[];for(let a=0;a<e.spiritCount;a+=1){const a=[];i.push(a);for(const r of[o.Major,o.Minor])for(let i=0;i<(r===o.Minor?t:n);i+=1){const t=await e.drawPower(r,{silent:!0});void 0!==t&&a.push(t)}}for(let a=0;a<5;a+=1){const a=[...i.map((e=>[...e]))];for(const e of i)e.length=0;for(let t=0;t<e.spiritCount;t+=1){const n=e.spirits[t],s=a[t];for(const a of s)await n.addExtraAction({actionId:`Draft${a}`,name:bd[a].name,required:!0,icon:"",text:"Pick this power card.",power:a,previewPowers:()=>({powers:s,selected:[s.indexOf(a)]}),onActivate:()=>{for(const a of s)e.removeEffectsWithName(bd[a].name);const o=s.filter((e=>e!==a));for(const a of o)i[(t+r+e.spiritCount)%e.spiritCount].push(a);return n.destinyPowers.push(a),Promise.resolve()}})}await e.playDraftActions((()=>"Each Spirit picks 1 Power Card and puts it in their Destiny face-down. When all Spirits have picked a Power Card, each Spirit passes their remaining Power Cards to the Spirit in the pass direction for that round."),(()=>"Pick Power Card"))}for(const a of i.flat())await e.discardPowerToDeckDiscard(a)}}})}},{name:"Destinies of Power",text:"Each Spirit has a Destiny (a supply of drafter Power Cards.). When a Spirit would gain a Power Card of their choice from their Destiny (following restrictions on the type of card gained.) If this is not possible, gain from a deck as normal.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.DestinyUnfold,[r.GlobalReminder]:()=>({icon:"Destiny",ongoing:!0}),[r.AdjustGainingPowers]:({spirit:e,powerType:a})=>{const t=e.destinyPowers.filter((e=>void 0===a||bd[e].type===a));return t.length>0?t:null}})}},{name:"Two-Player Variant",text:"Choose which Spirit will act first.",[r.Now]:async({$:e})=>{await e.addSubEffectUntilEndOfTurn({[r.BeforeInitialExplore]:async()=>{if(2!==e.spiritCount)return;const a=[...e.spirits];await e.fromAllSpirits().pickOne((e=>(e!==a[0]&&a.reverse(),Promise.resolve())));for(let t=1;t<=2;t+=1){const n=3+t,r=3-t,i=[[],[],[],[],[],[]];for(let a=0;a<e.spiritCount;a+=1){const t=[];for(const a of[o.Major,o.Minor])for(let i=0;i<(a===o.Minor?n:r);i+=1){const n=await e.drawPower(a,{silent:!0});void 0!==n&&t.push(n)}const s=e.spirits[a];for(const n of t)await s.addExtraAction({actionId:`Draft${n}`,name:bd[n].name,required:!0,icon:"",text:"Pick this power card.",power:n,previewPowers:()=>({powers:t,selected:[t.indexOf(n)]}),onActivate:()=>{e.removeEffectsWithName(bd[n].name);const r=Math.floor((6-t.length)/2);return ae(t,n),i[3*a+r].push(n),Promise.resolve()}})}await e.playDraftActions((()=>`Each Spirit splits their Power Cards into three face-down piles of 2 cards each. Once all six piles are ready, flip them all face-up.<br><br>${e.spirits[0].nameLink}: ${i[0].length}/2 - ${i[1].length}/2 - ${i[2].length}/2<br>${e.spirits[1].nameLink}: ${i[3].length}/2 - ${i[4].length}/2 - ${i[5].length}/2`),(()=>"Split Power Cards into piles.")),i.reverse();const s=[!1,!1],d=()=>{for(let a=0;a<6;a+=1)e.removeEffectsWithName(`Pile${a+1}`);e.removeEffectsWithName("Skip on last Piles")};for(const t of e.spirits){if(t.destinyPowers.length<10)for(let n=0;n<6;n+=1){const r=i[n];await t.addExtraAction({name:`${r.map((e=>bd[e].name)).join(", ")}`,actionId:"Pile"+(6-n),required:!0,icon:"Pile<br>"+(6-n),text:"Pick this pile.",enabled:()=>i.length>2?a[[0,0,1,1][6-i.length]]===t:s[0]?a[1]===t&&t.destinyPowers.length<10:a[0]===t&&t.destinyPowers.length<10,previewPowers:()=>({powers:i.flat(),selected:[2*i.indexOf(r),2*i.indexOf(r)+1]}),onActivate:()=>{e.removeEffectsWithName("Pile"+(6-n));for(const e of r)t.destinyPowers.push(e);return i.length<=2&&(s[a[0]===t?0:1]=!0,s[0]&&s[1]&&d()),ae(i,r),Promise.resolve()}})}await t.addExtraAction({name:"Skip on last Piles",text:"In order, each Spirit may take a third pile.",actionId:`PileSkip${t.spirit}`,required:!0,enabled:()=>i.length<=2&&8!==t.destinyPowers.length&&(!s[0]&&a[0]===t||s[0]&&a[1]===t),icon:"Skip",onActivate:()=>(s[a[0]===t?0:1]=!0,s[0]&&s[1]&&d(),Promise.resolve())})}await e.playDraftActions((()=>"The first Spirit puts two piles into their Destiny, then the second Spirit puts two piles into their Destiny.<br>In order, each Spirit may take a third pile. Discard the unpicked Power cards to the Minor/Major discard piles."),(()=>" ."));for(const a of i.flat())await e.discardPowerToDeckDiscard(a);a.reverse()}}})}}]},su={name:"Surges of Colonization",set:s.NatureIncarnate,difficulty:2,rules:[{name:"Setup Changes",text:"Resolve one extra Explore Card during the Initial Explore. (The game will start with two cards in the Build space.)",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.SurgesOfColonization,[r.AdjustNumberOfExploreCards]:()=>1,[r.AfterInitialExplore]:async()=>{e.removeThisEffect(),await e.explore()}})}},{name:"Distant Expeditions",text:"<explorer> are a source of Invaders for Explore Cards.",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.SurgesOfColonization,[r.GlobalReminder]:()=>({icon:"<explorer><br>Source"}),[r.LandIsExploringSource]:({land:a})=>a.has(e.Explorer)})}},{name:"Surges and Ebbs",text:"On even-numbered turns, resolve one extra Explore Card during the Explore step (usually 2 Explore Cards. On odd-numbered turns, skip the first normal Explore.",[r.Now]:async({$:e})=>{const a=new Set;await e.addSubEffect({effectId:pe.SurgesOfColonization,[r.AdjustNumberOfExploreCards]:()=>e.turn>0&&e.turn%2==0?1:0,[r.AfterTheNormalExploreStep]:async()=>{e.turn>0&&e.turn%2==0&&!a.has(e.turn)&&(a.add(e.turn),0===e.invaderCardsInExploreDeck.length&&await e.addSubEffect({name:"Final Surge",text:"If there are not enough Invader Cards for the final Surges and Ebbs, use unused Stage III Invader Cards. If none are left, use the highest-Stage Invader Cards in the discard (chosen randomly). (You only lose when you need to reveal the normal Explore Card and can't.)",[r.Now]:async()=>{const a=e.unusedInvaderCardOfStage(3);let t=!1;if(0===a.length){const n=W(e.invaderDeckInSlot(ps.Discard).possibleCards.flat()),r=rn(n,(e=>_t[e].stage));a.push(...n.filter((e=>_t[e].stage===r))),t=!0}if(a.length>0){const n=e.randomFromArray(a);await e.addExploreCardToTop([n]),t&&e.invaderDeckInSlot(ps.Discard).removeCard(e.invaderDeckInSlot(ps.Discard).cards.indexOf(n))}}}),await e.explore())}})}},{name:"Surges and Ebbs",text:"On even-numbered turns, resolve one extra Explore Card during the Explore step (usually 2 Explore Cards. On odd-numbered turns, skip the first normal Explore.",[r.Now]:async({$:e})=>{const a=new Set;await e.addSubEffect({effectId:pe.SurgesOfColonization,[r.GlobalReminder]:()=>({icon:"Surges<br>Ebbs"}),[r.AdjustNumberOfExploreCards]:()=>e.turn%2==0?0:-1,[r.SkipNextExploreCard]:()=>e.turn%2!=1||a.has(e.turn)?Promise.resolve(!1):(a.add(e.turn),Promise.resolve(!0))})}}]},ou={name:"Larger Surges",set:s.NatureIncarnate,difficulty:7,rules:[...su.rules,{name:"Larger Surges (Higher Difficulty)",effects:[{text:"Add a Fear Card to each Terror Level during Setup.",[r.Now]:async({$:e})=>{for(let a=1;a<=3;a+=1)await e.addFearCards(1).toLevel(a)}},{text:"Surges and Ebbs resolves another extra Explore Card during the Explore Step on even-numbered turns. (Usually 3 Explore Cards).",[r.Now]:async e=>{await su.rules[2][r.Now](e)}}]}]},du={[Xn.Blitz]:qg,[Xn.GuardTheIslesHeart]:Jg,[Xn.RitualsOfTerror]:Vg,[Xn.DahanInsurrection]:jg,[Xn.SecondWave]:Xf,[Xn.PowersLongForgotten]:ef,[Xn.WardTheShores]:_f,[Xn.RitualsOfTheDestroyingFlame]:tf,[Xn.ElementalInvocation]:tu,[Xn.DespicableTheft]:au,[Xn.TheGreatRiver]:ru,[Xn.ADiversityOfSpirits]:Zf,[Xn.VariedTerrain]:eu,[Xn.DestinyUnfold]:iu,[Xn.SurgesOfColonization]:su,[Xn.LargerSurges]:ou};class cu{$;constructor(e){this.$=e}get difficulty(){return cu.difficulty(this.$.config)}static difficulty(e){let a=0;if(void 0!==e.adversaryLeading&&(a=Ug[e.adversaryLeading.adversary].levels[e.adversaryLeading.level].difficulty,void 0!==e.adversarySupporting)){const t=Ug[e.adversarySupporting.adversary].levels[e.adversarySupporting.level].difficulty;a=Math.max(a,t)+.5*Math.min(a,t)}void 0!==e.scenario&&(a+=du[e.scenario]?.difficulty??0),e.thematic&&(a+=1,e.sets&&1===e.sets.length&&(a+=2)),e.archipelagos&&(a+=1);const t=e.boards.some((e=>e.spirit));if(e.boards.filter((e=>void 0===e.spirit&&(e.lockedEmpty||t))).length>0){const t=Math.floor(a/3)+2;a+=t,e.thematic&&(a-=t/2)}return a}static practiceGame(e){return e.boards.some((e=>!0===e.spirit?.progression))||e.skipInitialExplore||e.extraGrowth||e.controlledFate||!e.blightCards}toString(){return Ic({difficulty:this.difficulty},2)}}class lu{promise;rejecter;resolver;constructor(){this.promise=new Promise(((e,a)=>{this.resolver=e,this.rejecter=a}))}reject(e){this.rejecter?.(e)}resolve(e){this.resolver?.(e)}}var hu=function(e,a,t,n){var r,i=arguments.length,s=i<3?a:null===n?n=Object.getOwnPropertyDescriptor(a,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,a,t,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(i<3?r(s):i>3?r(a,t,s):r(a,t))||s);return i>3&&s&&Object.defineProperty(a,t,s),s};class gu{cursorAtPlayPower=null;$;abortAtTurn;client;cursor=0;history=[];historyFinished;nextEventId=0;constructor(e,a){this.$=e,this.client=a}get currentHistory(){return this.history}get defaultPromptForQueryType(){return e=>{switch(e){case tn.SelectLand:return"Pick a land.";case tn.SelectGrowthOption:return;case tn.SelectPowerType:return"Pick a Power type.";case tn.SelectPowerToGain:return"Pick a Power Card to keep.";case tn.SelectCard:return"Pick a Card.";case tn.SelectHealingCard:return"Pick a Healing Card.";case tn.SelectPower:return"Pick a Power.";case tn.SelectTerrain:return"Pick a Terrain.";case tn.PlayPower:return;case tn.ChooseBetween:case tn.PayJointly:return"Choose between:";case tn.SelectSpirit:return"Pick a Spirit.";case tn.SelectBoard:return"Pick a Board.";case tn.SelectFearCard:return"Pick a Fear Card.";case tn.SelectPiece:return"Pick a Piece.";case tn.SelectCorner:return"Pick a Corner.";default:return"I'm not sure what you should do now..."}}}async chooseBetween(e,a){await this.$.addSubEffect({...e,effects:void 0,[r.Now]:async()=>{const t=void 0!==e.effects?e.effects.filter((({condition:e})=>void 0===e||e())):[];if(t.length>0)if(this.$.treatingAllOrsAsAnds&&a.orChoice)for(const e of t)await this.$.addSubEffectUntilEndOfTurn(e);else{const n=await this.query({query:a.payJointly?tn.PayJointly:tn.ChooseBetween,chooseBetween:e.effects,items:t,actionIds:t.map((e=>e.actionId)),...e});await this.$.addSubEffectUntilEndOfTurn(t[n])}else e.noOptions&&await this.$.clickToContinue({noOptions:e.noOptions})}})}async chooseFrom(e,a){let t=null;return await this.$.chooseBetween({name:"Controlled Fate",text:"Choose Option",effects:e.map(((n,i)=>({text:a[i],actionId:`Fate-Option-${i}`,[r.Now]:()=>(t=n,e.splice(i,1),Promise.resolve())})))}),t}closeDown(){this.client=void 0}async may(e,a=!1){let t=!0;return await this.chooseBetween({...e,effects:["No","Yes"].map((e=>({actionId:(a?"Fate-":"")+e,text:e,[r.Now]:()=>(t="Yes"===e,Promise.resolve())})))},{orChoice:!1,payJointly:!1}),t}possiblyResolveHistoryFinished(){return void 0!==this.abortAtTurn&&this.$.turn===this.abortAtTurn&&(this.history.length=this.cursor),this.cursor!==this.history.length&&!this.$.gameEnded||void 0===this.historyFinished||(this.historyFinished.resolve(this.history),this.historyFinished=void 0,this.abortAtTurn=void 0),Promise.resolve()}async query(e){return await this.queryInternal(e)}async queryOptional(e){return await this.queryInternal({...e,optional:!0})}async selectX(e,a,t={}){const{text:n,prompt:i,players:s}=t;let o=e;return await this.chooseBetween({prompt:i??"Select X.",effects:[...Array(a-e+1).keys()].map((a=>({actionId:`Select${e+a}`,text:`${e+a}`,[r.Now]:()=>(o=e+a,Promise.resolve())}))),text:n,players:s},{orChoice:!1}),o}async send(e){await this.possiblySendPhase(),await this.sendEvent(e)}setHistory(e,a){return this.history=[...e],this.abortAtTurn=a,this.cursor=0,this.historyFinished=new lu,this.historyFinished.promise}async waitForAnimationsToFinish(){await(this.client?.waitForAnimations())}async possiblySendPhase(){this.$.reportedPhase!==this.$.phase&&(this.$.updateReportedPhase(),await this.sendEvent({type:T.Phase,phase:this.$.phase,turn:this.$.turn}),this.$.phase===Xe.PlayPowers&&(this.cursorAtPlayPower=this.cursor))}async queryInternal(e){const a=!0===e.optional;if(this.$.gameEnded)return a?null:0;await this.possiblySendPhase();const{items:t,query:n,actionIds:r}=e;if(0===t.length){if(a)return null;throw new Error(`Non-optional query ${tn[n]} without options.`)}if(1===t.length&&!a&&(e.autoPlayOneOption||void 0===e.autoPlayOneOption&&n===tn.SelectBoard))return 0;let i;for(;i=await this.queryOrUseHistory(e,r,a),"Admin"===i;)await this.$.enterAdminMode();return"Skip"===i?null:r.includes(i)?r.indexOf(i):(await this.sendEvent({type:T.Error,text:`Invalid input: ${i}.`}),this.$.logErrors&&console.error(`Invalid response [2] ${i} to query: ${tn[n]}. Valid options: [${a?"Skip, ":""}${r.join(", ")}]`),a?null:0)}async queryOrUseHistory(e,a,t){if(void 0===this.client)return new Promise((()=>{}));if(await this.possiblyResolveHistoryFinished(),this.cursor<this.history.length){const n=this.history[this.cursor];if("Admin"===n||t&&"Skip"===n||a.includes(n))return this.cursor+=1,n;this.history.length=this.cursor,await this.sendEvent({type:T.Error,text:`History doesn't match current client. Skipping rest of input: [${n}].`}),this.$.logErrors&&console.error(`Invalid response [1] ${n} to query: ${tn[e.query]}. Valid options: [${t?"Skip, ":""}${a.join(", ")}]`),this.historyFinished?.resolve(this.history),this.historyFinished=void 0}const n={...this.$.currentStackEffect,...e};n.prompt=n.prompt??this.defaultPromptForQueryType(n.query),n.optional&&(n.cancel=n.cancel??"Skip"),n.cursor=this.cursor;const r=await this.client.query(n);return this.history.push(r),this.cursor+=1,r}async sendEvent(e){await(this.client?.send({id:this.nextEventId,time:this.cursor,data:e})),this.nextEventId+=1}}hu([C.sH],gu.prototype,"cursorAtPlayPower",void 0);class fu{bringingWarrior=!1;hasAttemptedDamagingInvader=!1;hasAttemptedDestroyingInvader=!1;movedDahan=[];movedPresence=[];inInstruction=!1;async doInstruction(e){if(this.inInstruction)return e();{this.inInstruction=!0,this.hasAttemptedDamagingInvader=!1,this.hasAttemptedDestroyingInvader=!1,this.bringingWarrior=!1,this.movedDahan.length=0,this.movedPresence.length=0;const a=await e();return this.inInstruction=!1,a}}reportMovement(e){e.piece.isDahan&&this.movedDahan.push(e),e.piece.isPresence&&this.movedPresence.push(e),e.piece.piece===p.IncarnaWarrior&&e.movement===q.Bring&&(this.bringingWarrior=!0)}}class uu{nextPieceId=0;nextRandom=0;seed=0;constructor(e){this.seed=e??this.setRandomSeed()}drawFrom(e){const a=e.length>1?this.randomFromArray(e):e[0];return e.splice(e.indexOf(a),1),a}generatePieceId(){const e=this.nextPieceId;return this.nextPieceId+=1,e}random(){let e=2654435769,a=608135816,t=this.nextRandom;this.nextRandom=t+1;let n=this.seed,r=0;for(let i=0;i<15;i+=1){e>>>=0,a>>>=0,t>>>=0,n>>>=0;let i=e+a|0;e=a^a>>>9,a=t+(t<<3)|0,t=t<<21|t>>>11,n=n+1|0,i=i+n|0,t=t+i|0,r=(i>>>0)/4294967296}return r}randomFromArray(e){return e[Math.floor(this.random()*e.length)]}setRandomSeed(){return this.seed=Math.floor(9999999*Math.random()),this.seed}setSeed(e){this.seed=e}shuffle(e){return((e,a=Math.random)=>{const t=e.slice();for(let e=t.length-1;e>0;e-=1){const n=Math.floor(a()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t})(e,(()=>this.random()))}toString(){return Ic({seed:this.seed,nextRandom:this.nextRandom},2)}}var pu=function(e,a,t,n){var r,i=arguments.length,s=i<3?a:null===n?n=Object.getOwnPropertyDescriptor(a,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,a,t,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(i<3?r(s):i>3?r(a,t,s):r(a,t))||s);return i>3&&s&&Object.defineProperty(a,t,s),s};class wu{name;element;$;boardIndex;landIndex;constructor({$:e,boardIndex:a,landIndex:t,name:n}){un.makeObservable(this),this.$=e,this.boardIndex=a,this.landIndex=t,this.name=n}get board(){return this.$.boards[this.boardIndex]}get index(){return Pd(this.landIndex)}get isBoardCorner(){return 1===this.principleLocations.length}get isOnEdge(){return 2===this.touchingLocations.length}get principleLocations(){return this.landIndex.map((e=>this.$.boards[this.boardIndex].locations[e]))}get serialized(){return this.name}static createCollection(e,a){return new cn(e,tn.SelectCorner,a)}inAdjacentCorners(){return wu.createCollection(this.$,this.adjacentCorners)}inAdjacentLands(){return An.createCollection(this.$,this.touchingLands)}inAdjacentLocations(){return An.createCollection(this.$,this.touchingLocations)}setElement(e){return this.element=e,Promise.resolve()}get adjacentCorners(){return this.$.corners.filter((e=>{if(e!==this){const a=((e,a)=>{const t=new Set(e),n=[];for(const e of a)t.has(e)&&n.push(e);return n})(e.touchingLocations,this.touchingLocations);return(1!==a.length||a[0].type!==an.Ocean)&&a.length>=((this.isOnEdge||this.isBoardCorner)&&(e.isOnEdge||e.isBoardCorner)?1:2)}return!1}))}get touchingLands(){return this.touchingLocations.filter((e=>e.type===an.Land))}get touchingLocations(){const e=[...this.principleLocations];for(const a of this.principleLocations)for(const t of a.adjacentLands)e.includes(t)||this.isBoardCorner&&!t.sharesCornerWith(this.principleLocations[0])||t.boardIndex===this.boardIndex||this.principleLocations.some((e=>!t.isAdjacentTo(e)))||"NE_6_7_N"===this.name&&!this.board.locations[3].adjacentLands.some((e=>e.boardIndex===t.boardIndex))||"NE_6_7_E"===this.name&&!this.board.locations[7].adjacentLands.some((e=>e.boardIndex===t.boardIndex))||e.push(t);return e}}pu([C.sH],wu.prototype,"element",void 0);function yu(){return function(e,a,t){if(void 0===t.get)throw new Error("@memoize decorator can only be applied to getter methods.");const n=`_memoized_${a}`,r=`_memoized_reactive_${a}`,i=t.get;t.get=function(){if(un.reactivity){const e=this[r];if(void 0===e){const e=i.call(this);return this[r]=C.sH.box(e),e}const a=e.get();if(void 0===a){const a=i.call(this);return e.set(a),a}return a}{const e=this[n];if(void 0===e){const e=i.call(this);return this[n]=e,e}return e}}}}function mu(e,...a){for(const t of a)if(un.reactivity){const a=e[`_memoized_reactive_${t}`];void 0!==a&&a.set(void 0)}else e[`_memoized_${t}`]=void 0}var vu=function(e,a,t,n){var r,i=arguments.length,s=i<3?a:null===n?n=Object.getOwnPropertyDescriptor(a,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,a,t,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(i<3?r(s):i>3?r(a,t,s):r(a,t))||s);return i>3&&s&&Object.defineProperty(a,t,s),s};class Iu{boardCount;boards;boardsUnused=[];theEndlessDark;corners;oceanIsAllowedForBlight=!1;$;elementsToMigrate=[];constructor(e){un.makeObservable(this),this.$=e,this.boards=[],this.boardCount=this.$.config.boards.length,this.$.config.boards.forEach((({x:e,y:a,rotation:t,boardId:n})=>{this.boards.push(new yn(this.$,this.boards.length,e,a,t,n))})),this.corners=[],this.theEndlessDark=new An({$:e,boardIndex:-1,board:null,landIndex:-1,type:an.EndlessDark})}get capitalSize(){return rn(this.lands,(e=>e.numberOfBuildings))}get coastalLands(){return on(this.locationsIncludingNonExisting,(e=>e.isCoastal&&!e.isOcean))}get coastalLandsWithCities(){return on(this.locationsIncludingNonExisting,(e=>e.isCoastal&&e.hasCity))}get coastalLandsWithWardingPatterns(){return on(this.locationsIncludingNonExisting,(e=>e.isCoastal&&!e.isOcean&&e.has(this.$.WardingPattern)))}get destroyedBoards(){return this.boards.filter((e=>e.destroyed))}get landElements(){const e={};return this.corners.forEach((a=>{a.element&&(e[a.element]=(e[a.element]??0)+1)})),e}get lands(){const e=[];return this.nonDestroyedBoards.forEach((a=>{e.push(...a.landsExcludingExtraLocations)})),this.theEndlessDark.exists&&this.theEndlessDark.isLand&&e.push(this.theEndlessDark),e}get locations(){const e=[];return this.nonDestroyedBoards.forEach((a=>{e.push(...a.existingLocations)})),this.theEndlessDark.exists&&e.push(this.theEndlessDark),e}get locationsIncludingNonExisting(){const e=[];return this.nonDestroyedBoards.forEach((a=>{e.push(...a.locations,this.theEndlessDark)})),e}get mayTargetTheEndlessDark(){return this.$.someEffect(r.MayTargetTheEndlessDark)}get nonDestroyedBoards(){return this.boards.filter((e=>!e.destroyed))}get pieceCountIncludingStasis(){return e=>nn(this.locationsIncludingNonExisting,(a=>a.numberOf(e)))}get pieces(){const e=[];return this.locations.forEach((a=>{e.push(...a.pieces)})),e.sort(((e,a)=>e.id-a.id)),e}get strippedLandSize(){return rn(this.lands,(e=>e.numberOfBlight+e.numberOfInvaders))}get targetableLands(){const e=[];return this.nonDestroyedBoards.forEach((a=>{e.push(...a.landsExcludingExtraLocations,...this.theEndlessDark.exists&&this.mayTargetTheEndlessDark?[this.theEndlessDark]:[])})),e}async addBoard(e){const a=await this.randomUnusedBoard();if(null===a)return null;const t=new yn(this.$,this.boards.length,e.x,e.y,e.rotation,a);return this.boards.push(t),t}async afterPiecesAreAddedOrMovedAddTrigger(e){const{reminder:a=!0,permanent:t=!1,globalReminder:n,locationFilter:i=(()=>!0),pieces:s=Z.AllPieces,trigger:o,effect:d,action:c,owner:l,removeAfterTrigger:h=!1}=e;await this.$.addSubEffect({expireAtEndOfTurn:!t,[r.Reminder]:a?e=>i(e)&&d.text?d.text:void 0:void 0,[r.GlobalReminder]:n,[r.AfterAddingPiece]:async e=>{const a=e.additions.map((e=>e.piece)).filter((e=>e.isA(s)&&(void 0===l||e.owner===l)));i(e.land)&&a.length>0&&(void 0===this.$.action.data.piecesAddedOrMoved&&(this.$.action.data.piecesAddedOrMoved=[]),this.$.action.data.piecesAddedOrMoved=W([...this.$.action.data.piecesAddedOrMoved,...a]),await this.$.addTrigger(o,d,c),h&&this.$.removeThisEffect())},[r.AfterMoving]:async e=>{i(e.destination)&&e.piece.isA(s)&&e.movement!==q.Relocate&&(void 0===this.$.action.data.piecesAddedOrMoved&&(this.$.action.data.piecesAddedOrMoved=[]),this.$.action.data.piecesAddedOrMoved.push(e.piece),await this.$.addTrigger(o,d,c,{movingAction:this.$.action}))}})}async build(e=ps.Build){await this.forEachCardInSlot(e,(async a=>{await this.buildFromCard(a,e)}))}async buildFromCard(e,a,t={}){const{noIntro:n=!1}=t;await this.$.oneEffectActivates(r.SkipNextBuildCard)?await this.$.clickToContinue({name:"Build",text:`The Build in ${_t[e].text} is skipped.`,card:e}):await this.$.addEffect({name:"Build",text:`The Invaders Build in ${_t[e].text}.`,card:e,[r.Now]:async()=>{await this.$.sendEvent({type:T.InvadersBuild,cardSlot:a===ps.Ravage?ps.Build:a,invaderCard:e}),n||await this.$.clickToContinue(),await this.$.escalate(e,{beforeBuilding:!0}),await this.$.doEffects(r.BeforeResolvingInvaderCard,{card:e,invaderAction:K.Build,normal:a===ps.Build});const t=this.inLandsWhere((a=>a.matchesInvaderCard(e,K.Build)&&(a.has(Z.Invader)||a.buildCardsAffectLandsWithoutInvaders)));this.$.buildOrderMatters&&t.selectOrder(),await t.forEach((async t=>{a===ps.Build?t.isMiningLand&&this.$.miningLandsCauseRavageActions?await t.ravage({normal:!0,card:e,calculateDoNotParticipateInRavage:!0}):await t.doNormalBuild(e):await t.doExtraBuild(e)}),{noOptions:"No lands to build in."}),await this.$.doEffects(r.AfterResolvingBuildCard,{card:e,normal:a===ps.Build})}})}async doAdversaryActionOnEachBoard(e){const{forEach:a,where:t=(()=>!0),effect:n,withoutAction:i=!1}=e;await this.$.doEffects(r.BeforeAdversaryActionsOnEachBoard),await this.$.inBoardsWhere(t).forEach((async e=>{e.preventAdversaryActions||(i?await a(e):await this.$.doAdversaryAction((async()=>{await a(e)}),{board:e}))}),n),await this.$.doEffects(r.AfterAdversaryActionsOnEachBoard)}async doExtraBuildInTerrain(e){await this.$.addEffect({name:"Build",text:`The Invaders Build in ${qc[e].text}.`,card:e,[r.Now]:async()=>{await this.$.sendEvent({type:T.InvadersBuildInTerrain,terrain:e}),await this.$.clickToContinue();const a=this.inLandsWhere((a=>a.hasTerrain(e)&&(a.has(Z.Invader)||a.buildCardsAffectLandsWithoutInvaders)));await a.forEach((e=>e.doExtraBuild()),{noOptions:"No lands to build in."})}})}async doExtraRavageInTerrain(e){await this.$.addEffect({name:"Ravage",text:`Ravage in ${qc[e].text}.`,[r.Now]:async()=>{await this.$.sendEvent({type:T.InvadersRavageInTerrain,terrain:e});const a=this.inLandsWhere((a=>a.hasTerrain(e)&&a.has(Z.Invader)));await a.forEach((async e=>{await e.calculateDoNotParticipateInRavage()}));const t=a.where((e=>e.participatingInvaders().count>0));for(const e of a.items)t.has(e)||await e.resetDoNotParticipateInRavage();await t.selectOrder().forEach((e=>e.doExtraRavage({calculateDoNotParticipateInRavage:!1})),{noOptions:"No lands to ravage in."})}})}existLandWhere(e){return this.lands.some(e)}existLocationIncludingNonExistingWhere(e){return this.locationsIncludingNonExisting.some(e)}async explore(){if(await this.$.oneEffectActivates(r.SkipNextExploreCard))return;const e=await this.$.drawNextExploreCard();if(!this.$.gameEnded&&null!==e){const a=_t[e];await this.$.addEffect({name:0===this.$.turn?"Initial Explore":"Explore",text:`The Invaders Explore in ${a.text}.`,card:e,[r.Now]:async()=>{await this.$.clickToContinue(),await this.$.escalate(e,{beforeExplore:!0}),await this.$.doEffects(r.BeforeResolvingInvaderCard,{card:e,invaderAction:K.Explore,normal:!0});const a=this.inLandsWhere((a=>a.matchesInvaderCard(e,K.Explore)&&a.hasExploringSource));this.exploreOrderMatters(e)&&a.selectOrder(),await a.forEach((async a=>{await a.doNormalExplore(e)}),{noOptions:"No lands to explore into."}),await this.$.escalate(e,{afterExplore:!0}),await this.$.doEffects(r.AfterResolvingExploreCard,{card:e,normal:!0})}})}}exploreOrderMatters(e){return this.$.someEffect(r.ExploreOrderMatters,{card:e})}async forEachLand(e){for(const a of this.lands)await e(a)}forPieces(){return wn.createCollection(this.$,this.pieces)}forPiecesWhere(e){return this.forPieces().where(e)}async globalHealthCheck(){await this.forEachLand((async e=>{await e.healthCheck()}))}inBoards(){return yn.createCollection(this.$,this.nonDestroyedBoards)}inBoardsWhere(e){return this.inBoards().where(e)}inBoardsWith(e){return this.inBoardsWhere((a=>a.hasOneLandWith(e)))}inBoardsWithout(e){return this.inBoardsWhere((a=>!a.hasOneLandWith(e)))}inCorners(){return wu.createCollection(this.$,this.corners)}inCornersWhere(e){return this.inCorners().where(e)}inLands(){return An.createCollection(this.$,this.lands)}inLandsWhere(e){return this.inLands().where(e)}inLandsWith(e){return this.inLands().where((a=>a.has(e)))}inLandsWithAllOf(...e){return this.inLands().where((a=>a.hasAllOf(...e)))}inLandsWithOneOf(...e){return this.inLands().where((a=>a.hasOneOf(...e)))}inLandsWithOrAdjacentTo(e){return this.inLandsWhere((a=>a.hasOrIsAdjacentToLandsWith(e)))}inLandsWithStrife(){return this.inLands().where((e=>e.hasStrife))}inLandsWithout(e){return this.inLands().where((a=>a.doesntHave(e)))}inLocations(){return An.createCollection(this.$,this.locations)}inLocationsWhere(e){return this.inLocations().where(e)}inTargetableLands(){return An.createCollection(this.$,this.targetableLands)}inTargetableLandsWhere(e){return this.inTargetableLands().where(e)}invaders(){return this.forPieces().where((e=>e.isInvader))}async invadersHaveMinusOneHealthPerStrife(){await this.$.addSubEffectUntilEndOfTurn({[r.GlobalReminder]:()=>({icon:"-1 HP<br>per <strife>"}),[r.AdjustHealth]:({piece:e})=>e.isInvader?-e.strife:0,[r.AfterAddingStrife]:async({piece:e})=>{await e.location.healthCheck()}}),await this.$.globalHealthCheck()}invalidateBoardCache(){mu(this,"locations","locationsIncludingNonExisting","nonDestroyedBoards")}migrateCornerCornersFromBoard(e){this.elementsToMigrate=[];for(const a of this.corners)if(a.board===e&&a.isBoardCorner&&void 0!==a.element){const t=a.inAdjacentLocations().where((a=>a.board!==e)).items;t.length>0&&this.elementsToMigrate.push({land:t[0],element:a.element})}}async onEachBoard(e,a={}){const{selectOrder:t=!1}=a;if(t&&this.nonDestroyedBoards.length>1)await this.inBoards().selectOrder().forEach(e,{autoPlayOneOption:!0});else for(const a of this.nonDestroyedBoards)await e(a)}async pickTerrainsWhere(e,a){const t=[Ft.Jungles,Ft.Mountains,Ft.Sands,Ft.Wetlands].filter(e);if(0===t.length)return a?.noOptions&&await this.$.clickToContinue(a),null;return t[await this.$.query({query:tn.SelectTerrain,items:t,actionIds:t,...a})]}piecesThatAre(e){return this.forPiecesWhere((a=>a.isA(e)))}randomUnusedBoard(){const e=Object.keys(Kt).filter((e=>Kt[e].thematic===!!this.$.config.thematic&&!this.boards.some((a=>a.board===e))));return 0===e.length?Promise.resolve(null):this.$.drawFrom(e,e.map((e=>Kt[e].name)))}async ravage(){await this.forEachCardInSlot(ps.Ravage,(async e=>{await this.$.oneEffectActivates(r.SkipNextRavageCard,{card:e})||await this.$.addEffect({name:"Ravage",text:`The Invaders Ravage in ${_t[e].text}.`,card:e,[r.Now]:async()=>{await this.$.sendEvent({type:T.InvadersRavage,invaderCard:e}),await this.$.clickToContinue(),await this.$.doEffects(r.BeforeResolvingInvaderCard,{card:e,invaderAction:K.Ravage,normal:!0});const a=this.inLandsWhere((a=>a.matchesInvaderCard(e,K.Ravage)&&a.has(this.$.Invader)));await a.forEach((async e=>{await e.calculateDoNotParticipateInRavage()}));const t=this.inLandsWhere((a=>a.matchesInvaderCard(e,K.Ravage)&&a.participatingInvaders().count>0));for(const e of a.items)t.has(e)||await e.resetDoNotParticipateInRavage();await t.selectOrder().forEach((a=>a.ravage({normal:!0,card:e,calculateDoNotParticipateInRavage:!1})),{noOptions:"No lands to ravage in."}),await this.$.doEffects(r.AfterResolvingRavageCard,{card:e,normal:!0})}})}))}async removeInvadersWorthOfHealthUpTo(e){const a=[],t=this.invaders().where((a=>a.health<=e&&a.targetable));return await t.optionallyPickOne((async t=>{a.push(...await t.remove()),a.push(...await this.removeInvadersWorthOfHealthUpTo(e-t.health))}),{prompt:`${e} health left to remove.`}),a}setCorners(e){const a=[...this.corners];this.corners=e;for(const t of a)if(void 0!==t.element){const a=this.corners.find((e=>e.name===t.name));if(void 0!==a)a.element=t.element;else if(t.isBoardCorner){const a=e.find((e=>e.isBoardCorner&&t.inAdjacentLocations().has(e.principleLocations[0])));void 0!==a&&(a.element=t.element)}}this.elementsToMigrate.forEach((({land:e,element:a})=>{const t=e.corners.find((e=>e.isBoardCorner));void 0!==t&&(t.element=a)}))}async setupStartingTokens(){!this.$.config.sets.includes(s.BranchAndClaw)&&!this.$.config.sets.includes(s.JaggedEarth)||this.$.config.thematic||await this.onEachBoard((async e=>{await(e.lowestNumberedLand((e=>!e.hasSetupSymbols))??e.lowestNumberedLand()).add(1,this.$.Beasts),await e.inLandNumber(2).add(1,this.$.Disease)}))}async splittedDamage(e){const{amount:a,lands:t,effect:n}=e;await this.forPiecesWhere((e=>e.isInvader&&null!==e.location&&t.includes(e.location))).pickMultiple({amount:a,where:e=>e.isAlive,forPickedItem:async e=>{await e.damageOnlyThis(1,this.$.Invader)},repeatSame:!0,effect:n})}toString(){return Ic({boards:this.boards,boardsUnused:dn(this.boardsUnused,(e=>Kt[e].name)),boardCount:this.boardCount},2)}async forEachCardInSlot(e,a){for(const t of this.$.invaderCardsInSlot(e))await a(t)}}vu([C.sH],Iu.prototype,"boards",void 0),vu([C.sH],Iu.prototype,"corners",void 0),vu([yu()],Iu.prototype,"destroyedBoards",null),vu([yu()],Iu.prototype,"locations",null),vu([yu()],Iu.prototype,"locationsIncludingNonExisting",null),vu([yu()],Iu.prototype,"nonDestroyedBoards",null);const Au=[[1,-1],[1,0],[0,1],[-1,1],[-1,0],[0,-1]],xu=[[[2,0,3],[2,-1,1],[2,0,0]],[[-1,2,5],[0,2,3],[-1,2,2]],[[-2,0,0],[-2,1,4],[-2,0,3]]],bu=[[[-2,2,3],[-2,1,5],[-2,2,0]],[[1,1,1],[0,2,3],[1,1,4]],[[2,-2,0],[2,-1,2],[2,-2,3]]],Tu=[[1,-1],[1,1],[-1,1],[-1,-1]],Eu=[[-1,0],[-1,2],[1,0],[1,-2]];class Pu{$;constructor(e){this.$=e,this.setupAdjacencies(),this.setupCorners()}static archipelagoConnections(e){return e.boards.map((a=>{if(!e.archipelagos)return null;const t=a.x,n=a.y,r=a.rotation,i=Au[nu(r,6)],s=Au[nu(r+1,6)],o=e.boards.findIndex((r=>{if(r!==a){const a=r.x,o=r.y,d=r.rotation,c=Au[nu(d,6)],l=Au[nu(d+1,6)],h=[[0,-1,0,-2],[0,-2,0,-1],e.thematic?[-1,0,0,-2]:[1,-1,0,-2],e.thematic?[0,-2,-1,0]:[0,-2,1,-1]].map((([e,r,d,h])=>{const g=t+e*i[0]+r*s[0],f=n+e*i[1]+r*s[1],u=a+d*c[0]+h*l[0],p=o+d*c[1]+h*l[1];return g===u&&f===p}));return h[0]&&h[1]||h[2]&&h[3]||h[4]&&h[5]}return!1}));return o>=0?o:null}))}static isPositionValidForBoard(e,a,t){const{boards:n,thematic:r}=e,i=Math.round(a.x),s=Math.round(a.y),o=a.rotation,d=Au[nu(o,6)],c=Au[nu(o+1,6)],l=[[0,0],r?[1,0]:[1,1],r?[1,-2]:[1,-1],[0,-1],r?[-1,0]:[-1,-1],r?[-1,2]:[-1,1]],h=[r?[1,-1]:[1,0],[0,1],r?[-1,1]:[-1,0],[0,-1]];return!n.some(((e,a)=>{if(a===t)return!1;const n=e.x,g=e.y,f=e.rotation,u=Au[nu(f,6)],p=Au[nu(f+1,6)];for(let e=0;e<2;e+=1)for(const[a,t]of 0===e?l:h){const r=i+a*d[0]+t*c[0],o=s+a*d[1]+t*c[1];for(const[a,t]of 0===e?h:l){const e=n+a*u[0]+t*p[0],i=g+a*u[1]+t*p[1];if(r===e&&o===i)return!0}}const w=Math.abs(nu(o,6)-nu(f,6));if(0!==w&&1!==w&&5!==w){const e=[r?[-1,0,1,-2]:[1,-1,-1,-1],r?[1,-2,-1,0]:[-1,-1,1,-1]].map((([e,a,t,r])=>{const o=i+e*d[0]+a*c[0],l=s+e*d[1]+a*c[1],h=n+t*u[0]+r*p[0],f=g+t*u[1]+r*p[1];return o===h&&l===f}));if(e[0]||e[1])return!0}return!1}))}static randomizeLayout(e){const a=e.boards.length,t=e.boards,n=e.thematic?bu:xu,r=a>=4?4:3,i=a>=5?3:2,s=(a,t,n,s,o,d)=>{const c={x:a+s*Au[nu(n,6)][0]+o*Au[nu(n+1,6)][0],y:t+s*Au[nu(n,6)][1]+o*Au[nu(n+1,6)][1],rotation:nu(n+d,6)};return Pu.isPositionValidForBoard(e,c,-1)&&c.x>=-r&&c.x<=r&&c.y>=-i&&c.y<=i?c:null};for(let r=0;r<1e4;r+=1){e.boards=[{...t[0],x:0,y:0,rotation:a>1?Math.floor(6*Math.random()):0}];for(let r=1;r<a;r+=1){const a=[];for(let t=0;t<r;t+=1){const{x:r,y:i,rotation:o}=e.boards[t];for(let e=0;e<3;e+=1)for(let t=0;t<3;t+=1){const[d,c,l]=n[e][t],h=s(r,i,o,d,c,l);null!==h&&a.push(h)}e.archipelagos&&[[0,-3],e.thematic?[-1,-2]:[1,-3]].forEach((([e,t])=>{const n=s(r,i,o,e,t,3);null!==n&&(a.push(n),a.push(n),a.push(n))}))}if(!(a.length>0))break;e.boards.push({...t[e.boards.length],...a[Math.floor(Math.random()*a.length)]})}if(e.boards.length===a&&(!e.archipelagos||1===a||Pu.archipelagoConnections(e).filter((e=>null!==e)).length>(a>=4?2:1)))break}}randomFreePositionFromBoard(e){const a=this.$.config.thematic?bu:xu,{x:t,y:n,r}=e.position,i=[];for(let e=0;e<3;e+=1)for(let s=0;s<3;s+=1){const[o,d,c]=a[e][s],l={x:t+o*Au[nu(r,6)][0]+d*Au[nu(r+1,6)][0],y:n+o*Au[nu(r,6)][1]+d*Au[nu(r+1,6)][1],rotation:nu(r+c,6)};Pu.isPositionValidForBoard(this.$.config,l,-1)&&i.push(l)}return i.length>0?this.$.drawFrom(i,i.map(((e,a)=>`${a}`))):Promise.resolve(null)}setupAdjacencies(){this.$.locations.forEach((e=>{e.adjacentLocations.length=0,e.locationsWithinBase.length=0,e.exists&&e.boardData&&e.boardData.adjacency[e.landIndex].forEach((a=>{const t=this.$.boards[e.boardIndex].locations[a];t.exists&&e.adjacentLocations.push(t)}))})),this.$.boards.forEach((e=>{e.boardDistance=this.$.boards.map((a=>a===e?0:null))}));for(const e of this.$.effectsMappedWithFilter(r.ExtraAdjacency))for(const{land1:a,land2:t}of e)a.exists&&t.exists&&(a.adjacentLocations.push(t),t.adjacentLocations.push(a),a.boardIndex!==t.boardIndex&&(a.board.boardDistance[t.boardIndex]=0,t.board.boardDistance[a.boardIndex]=0));const e=this.$.config.thematic?bu:xu;this.$.nonDestroyedBoards.forEach((a=>{const{x:t,y:n,r}=a.position;for(let i=0;i<3;i+=1)for(let s=0;s<3;s+=1){const[o,d,c]=e[i][s],l=t+o*Au[nu(r,6)][0]+d*Au[nu(r+1,6)][0],h=n+o*Au[nu(r,6)][1]+d*Au[nu(r+1,6)][1],g=nu(r+c,6),f=this.$.nonDestroyedBoards.find((e=>{const{x:a,y:t,r:n}=e.position;return a===l&&t===h&&nu(n,6)===nu(g,6)}));if(f){const e=a.data.outerBorders[i],t=f.data.outerBorders[s];a.boardDistance[f.boardIndex]=0;const n=a.data.terrain.map((()=>new Set));for(let a=0;a<7;a+=1)a>0&&n[e[a]].add(t[7-a]),n[e[a]].add(t[6-a]);n.forEach(((e,t)=>{a.locations[t].adjacentLocations.push(...Array.from(e).map((e=>f.locations[e])).filter((e=>e.exists)))}))}}}));const a=this.$.config.thematic?Eu:Tu,t=[];this.$.nonDestroyedBoards.forEach((e=>{a.forEach((([a,n],r)=>{const{x:i,y:s,r:o}=e.position,d=Au[nu(o,6)],c=Au[nu(o+1,6)],l=i+d[0]*a+c[0]*n,h=s+d[1]*a+c[1]*n,g=e.data.outerBorders[r<3?r:2][r<3?0:e.data.outerBorders[2].length-1],f=e.locations[g];t.push({x:l,y:h,land:f})}))}));for(const e of t)for(const a of t)e!==a&&e.x===a.x&&e.y===a.y&&(e.land.isAdjacentTo(a.land)||e.land.exists&&a.land.exists&&(e.land.adjacentLocations.push(a.land),e.land.board.boardDistance[a.land.board.boardIndex]=0));const n=Pu.archipelagoConnections(this.$.config);this.$.locations.forEach((e=>{const{locationsWithinBase:a}=e;let t=new Set([e]);for(;0===a.length||t.size>a[a.length-1].length;){a.push(Array.from(t));const e=new Set;a[a.length-1].forEach((a=>{[a,...a.adjacentLocations].forEach((a=>e.add(a)))})),this.$.config.archipelagos&&a.length>=2&&a[a.length-2].forEach((a=>{if(a.isCoastal){let t=n[a.boardIndex];if(null===t&&(t=n.findIndex((e=>e===a.boardIndex))),null!==t&&t>=0)for(const n of this.$.boards[t].lands)n.isCoastal&&(0!==a.board.boardDistance[n.board.boardIndex]&&(a.board.boardDistance[n.board.boardIndex]=1),e.add(n))}})),t=e}}));const i=(e=>{const a=e.length,t=[...e];for(let e=0;e<a;e+=1)for(let n=0;n<a;n+=1)for(let r=0;r<a;r+=1)if(null!==t[n][e]&&null!==t[e][r]){const a=t[n][e]+t[e][r];(null===t[n][r]||a<t[n][r])&&(t[n][r]=a)}return t})(this.$.boards.map((e=>e.boardDistance)));this.$.boards.forEach(((e,a)=>{e.boardDistance=i[a]}))}setupCorners(){const e={},a=(a,...t)=>{const n=`${t[0].board.name}_${t.map((e=>e.landNumber)).sort().join("_")}${a}`;void 0===e[n]&&(e[n]=new wu({$:this.$,boardIndex:t[0].boardIndex,landIndex:t.map((e=>e.landIndex)),name:n}))};for(const e of this.$.locations)if(e.exists)for(const t of e.adjacentLocations)if(t.board===e.board){for(const n of e.adjacentLocations)n.board===e.board&&t!==n&&t.isAdjacentTo(n)&&a("",e,t,n);e.isNorthern&&t.isNorthern&&a("_N",e,t),e.isEastern&&t.isEastern&&a("_E",e,t),e.isSouthern&&t.isSouthern&&a("_S",e,t),e.isWestern&&t.isWestern&&a("_W",e,t)}for(const e of this.$.nonDestroyedBoards)for(const t of e.inCornerLands().items){const n=t.inAdjacentLocations().where((a=>a.exists&&a.board!==e));if(n.count>0){const e=[t,...n.items.filter((e=>e.isCornerLand&&e.sharesCornerWith(t)))].sort(((e,a)=>e.coordinate.localeCompare(a.coordinate)))[0];let r="";e.isNorthern&&(r+="_N"),e.isEastern&&(r+="_E"),e.isSouthern&&(r+="_S"),e.isWestern&&(r+="_W"),a(r,e)}}this.$.setCorners(Object.values(e))}}var Su,Ou=function(e,a,t,n){var r,i=arguments.length,s=i<3?a:null===n?n=Object.getOwnPropertyDescriptor(a,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,a,t,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(i<3?r(s):i>3?r(a,t,s):r(a,t))||s);return i>3&&s&&Object.defineProperty(a,t,s),s};class Cu{isInAdmin=!1;$;constructor(e){un.makeObservable(this),this.$=e}async enterAdminMode(){const e=this.$,a={c:!0};await this.$.addEffect({name:"Admin Mode",text:"Note: Using Admin Mode will disable achievements.",[r.Now]:async()=>{this.isInAdmin=!0,await e.doGameAction((async()=>{for(;a.c;)await e.chooseBetween({effects:[...[e.Badlands,e.Beasts,e.Disease,e.Wilds,e.Dahan,e.Explorer,e.Town,e.City,e.Blight].map((a=>({actionId:a,label:ee[a].text,[r.Now]:async()=>{await e.inLands().pickMultiple({optional:!0,repeatSame:!0,forPickedItem:async t=>{a===e.Blight?await t.addBlight(1):await t.add(1,a)},effect:{text:`Add any ${ee[a].text}.`}})}}))),{actionId:"Strife",label:"<strife>",text:"Add any <strife>.",[r.Now]:async()=>{await e.forPiecesThatIs(e.Invader).pickMultiple({optional:!0,repeatSame:!0,forPickedItem:async e=>{await e.addStrife()}})}},{actionId:"Presence",label:"<presence>",text:"Add any <presence>.",[r.Now]:async()=>{await e.fromAllSpirits().pickMultiple({optional:!0,repeatSame:!0,forPickedItem:async e=>{await e.addPresence({locations:g.AnyLands})}})}},{actionId:"Move",label:"Move pieces",text:"Move any pieces.",[r.Now]:async()=>{await e.forPieces().pickMultiple({optional:!0,repeatSame:!0,forPickedItem:async e=>{await e.move({locations:{target:g.AnyLocations}})}})}},{actionId:"Damage",label:"Damage pieces",text:"Damage any pieces",[r.Now]:async()=>{await e.forPiecesThatIs(e.InvaderOrDahan).pickMultiple({optional:!0,repeatSame:!0,forPickedItem:async e=>{await e.damageOnlyThis(1)}})}},{actionId:"Remove",label:"Remove pieces",text:"Remove any pieces",[r.Now]:async()=>{await e.forPieces().pickMultiple({optional:!0,forPickedItem:async e=>{await e.remove()}})}},{actionId:"EarnFearCard",text:"Earn Fear Card",[r.Now]:async()=>{await e.earnFearCard()}},{actionId:"AddFearCard",text:"Add Fear Card",[r.Now]:async()=>{await e.addFearCards(1).toLevel(e.terrorLevel)}},{actionId:"DiscardFearCard",text:"Discard Fear Card",[r.Now]:async()=>{await e.discardTopFearCard()}},{actionId:"GainEnergy",text:"Gain Energy",[r.Now]:async()=>{await e.fromAllSpirits().pickMultiple({optional:!0,repeatSame:!0,forPickedItem:async e=>{await e.gainEnergy(1)}})}},{actionId:"PayEnergy",text:"Pay Energy",[r.Now]:async()=>{await e.fromAllSpirits().pickMultiple({optional:!0,repeatSame:!0,forPickedItem:async e=>{e.energy>0&&await e.payEnergy(1)}})}},{actionId:"GainFear",text:"Gain <fear>",[r.Now]:async()=>{await e.fear(1)}},{actionId:"LoseFear",text:"Lose <fear>",[r.Now]:async()=>{await e.loseFear(1)}},{actionId:"DiscardTopInvaderCard",text:"Discard Top Invader Card",[r.Now]:async()=>{await e.removeInvaderCard(0,{allCards:!0})}},{actionId:"AdvanceInvaderCards",text:"Advance Invader Cards",[r.Now]:async()=>{await e.explore(),await e.advanceInvaderCards()}},{actionId:"Elements",text:"Elements",[r.Now]:async()=>{await e.fromAllSpirits().pickOne((async e=>{await e.gainElements({anyAmount:!0})}))}},{actionId:"AllElements",text:"<any>",[r.Now]:async()=>{await e.fromAllSpirits().pickOne((async e=>{await e.gainElementsForTheRestOfTheGame({[i.Sun]:5,[i.Moon]:5,[i.Fire]:5,[i.Air]:5,[i.Water]:5,[i.Earth]:5,[i.Plant]:5,[i.Animal]:5})}))}},{actionId:"AddBlightToBlightCard",text:"Add <blight> to Blight Card",[r.Now]:async()=>{await e.addBlightToBlightCard(1)}},{actionId:"RemoveBlightFromBlightCard",text:"Remove <blight> from Blight Card",[r.Now]:async()=>{await e.removeBlightFromBlightCard(1)}},{actionId:"SelectBlightCard",text:"Select Blight Card",[r.Now]:async()=>{const a=await e.queryOptional({text:"Select Blight Card to put on top.",query:tn.SelectCard,items:e.blightCardsInDeck.unusedCards,actionIds:e.blightCardsInDeck.unusedCards});if(null!=a){const t=e.blightCardsInDeck.unusedCards[a];e.blightCardsInDeck.addStackedCard(t)}}},{actionId:"SelectFearcard",text:"Select Fear Card",[r.Now]:async()=>{const a=await e.queryOptional({text:"Select Fear Card to put on top.",query:tn.SelectCard,optional:!0,items:e.fearCardsInDeck.unusedCards,actionIds:e.fearCardsInDeck.unusedCards});if(null!=a){const t=e.fearCardsInDeck.unusedCards[a];e.fearCardsInDeck.addStackedCard(t)}}},{actionId:"SelectEventCard",text:"Select Event Card",[r.Now]:async()=>{const a=await e.queryOptional({text:"Select Event Card to put on top.",query:tn.SelectCard,optional:!0,items:e.eventCardsInDeck.unusedCards,actionIds:e.eventCardsInDeck.unusedCards});if(null!=a){const t=e.eventCardsInDeck.unusedCards[a];e.eventCardsInDeck.addStackedCard(t)}}},{actionId:"SelectInvaderCard",text:"Select Invader Card",[r.Now]:async()=>{const a=e.exploreDeck.possibleCardsAt(0),t=await e.queryOptional({text:"Select Next Invader Card.",query:tn.SelectCard,optional:!0,items:a,actionIds:a});if(null!=t){const n=a[t];e.exploreDeck.addStackedCard(n)}}},{actionId:"SelectPowerCard",text:"Select Power Card",[r.Now]:async()=>{const a=[o.Minor,o.Major],t=await e.queryOptional({query:tn.SelectPowerType,items:a,actionIds:a,autoPlayOneOption:!0});if(null!==t){const n=a[t],r=n===o.Minor?e.powercardsInMinorDeck:e.powercardsInMajorDeck,i=await e.queryOptional({text:`Select ${n} Card to put on top.`,query:tn.SelectCard,optional:!0,items:r.unusedCards,actionIds:r.unusedCards});if(null!=i){const e=r.unusedCards[i];r.addStackedCard(e)}}}},{actionId:"GainPower",text:"Gain Power",[r.Now]:async()=>{const a=[o.Minor,o.Major];await e.fromAllSpirits().optionallyPickOne((async t=>{const n=await e.queryOptional({query:tn.SelectPowerType,items:a,actionIds:a,autoPlayOneOption:!0});if(null!==n){const r=a[n],i=r===o.Minor?e.powercardsInMinorDeck:e.powercardsInMajorDeck,s=await e.queryOptional({text:`Pick ${r} Power.`,query:tn.SelectCard,items:i.unusedCards,actionIds:i.unusedCards});if(null!=s){const e=i.unusedCards[s];i.remove(e),await t.gainPower(e)}}}))}},{actionId:"PlayPower",text:"Play Power",[r.Now]:async()=>{await e.fromAllSpirits().optionallyPickOne((async e=>{await e.playAPowerCardByPayingItsCost()}))}},{actionId:"DiscardPower",text:"Discard Power",[r.Now]:async()=>{await e.fromAllSpirits().optionallyPickOne((async e=>{await e.discardPowerCards(1)}))}},{actionId:"ForgetPower",text:"Forget Power",[r.Now]:async()=>{await e.fromAllSpirits().optionallyPickOne((async e=>{await e.forgetPowers()}))}},{actionId:"ReclaimCards",text:"Reclaim Cards",[r.Now]:async()=>{await e.fromAllSpirits().optionallyPickOne((async e=>{await e.reclaimCards({filter:e=>e.isInPlay||e.isInDiscard,optional:!0})}))}},{actionId:"CloseAdmin",text:"Close",[r.Now]:()=>(a.c=!1,Promise.resolve())}]},{orChoice:!1})})),this.isInAdmin=!1}})}}Ou([C.sH],Cu.prototype,"isInAdmin",void 0);class Du{adversary;leading;level;$;constructor(e,a,t,n){this.$=e,this.adversary=a,this.level=t,this.leading=n}get data(){return Ug[this.adversary]}get levelData(){return this.data.levels[this.level]}get name(){return`${this.data.name} ${this.level}`}async setup(){const{data:e}=this;await this.$.sendEvent({type:T.SetupAdversary,adversary:this});for(let a=0;a<=this.level;a+=1)await this.$.addEffect({...e.levels[a].effect,adversary:this.adversary,adversaryLevel:a})}toString(){return this.name}}class Bu{adversaryLeading=null;adversarySupporting=null;$;constructor(e){this.$=e;const{adversaryLeading:a,adversarySupporting:t}=this.$.config;[this.adversaryLeading,this.adversarySupporting]=[a,t].map((e=>e?new Du(this.$,e.adversary,e.level,e===a):null))}get maxTownsAllowed(){let e=0;return null!==this.adversarySupporting&&(this.adversaryLeading?.adversary===gc.France&&this.adversaryLeading?.level>=2?e=this.adversarySupporting.level*this.$.boardCount:this.adversarySupporting?.adversary===gc.France&&this.adversarySupporting?.level>=2&&(e=this.adversaryLeading.level*this.$.boardCount)),7*this.$.boardCount+e}async setup(){await(this.adversarySupporting?.setup()),await(this.adversaryLeading?.setup())}toString(){return Ic({adversaryLeading:this.adversaryLeading,adversarySupporting:this.adversarySupporting},2)}}class ku{$;constructor(e){this.$=e}async setup(){if(this.$.playingWithCommandBeasts){await this.$.addFearCards(1).toLevel(2);const e=C.sH.box(2===this.$.stage?1:0),a=C.sH.box(3===this.$.stage?1:0),t=C.sH.box(0);await this.$.addSubEffect({[r.GlobalReminder]:()=>({name:"Command Beast",text:"When reaching Invader Stage II and Invader Stage III, the Spirits earn the ability to command all Beasts on the island once.<br><br>During the <fast> phase: For each <beasts>, choose one of the following:<br><br>1 Damage<or>Push the <beasts>.<or>If Invaders are present, 1 <fear>.<br><br>You can use both Commands in the same <fast> Power Phase if you have both available.",icon:`<beasts><br>${t.get()} / ${e.get()+a.get()}`,ongoing:!0}),[r.ExtraAction]:()=>this.$.phase!==Xe.FastPowers||t.get()>=e.get()+a.get()?null:{actionId:"CommandBeast",name:"Command Beast",text:"For each <beasts>, choose one of the following:<br><br>1 Damage.<or>Push the <beasts>.<or>If Invaders are present, 1 <fear>.",[r.Now]:async()=>{t.set(t.get()+1);const e=[];await this.$.inLandsWith(this.$.Beasts).selectOrder().forEach((a=>this.$.doTokenEventAction((async()=>{const t=a.piecesWhere((a=>a.isBeasts&&!e.includes(a)));await t.pickMultiple({amount:t.count,forPickedItem:async t=>{e.push(t),await this.$.chooseBetween({effects:[{actionId:"Damage",text:"1 Damage.",[r.Now]:async()=>{await a.damage(1)}},{actionId:"Push",text:"Push the <beasts>.",[r.Now]:async()=>{await t.push()}},{actionId:"Fear",text:"If Invaders are present, 1 <fear>.",[r.Now]:async()=>{await a.fear(1)},condition:()=>a.hasInvaders}]})}})}))),{noOptions:"No lands with <beasts>."})}},[r.AfterChangingInvaderDeck]:()=>(this.$.phase!==Xe.Setup&&(2===this.$.stage?e.set(1):3===this.$.stage&&a.set(1)),Promise.resolve())})}}}class Lu{randomEventsEnabled=!0;resolvableCardsLeft=void 0;spiritSimulation=!1;alwaysPushToSameDestination=!1;disableRandomEvents(){this.randomEventsEnabled=!1}resolveMaximimumPowers(e){this.resolvableCardsLeft=e}simulateSpiritBoardOnly(){this.spiritSimulation=!0}simplifyMultiPush(){this.alwaysPushToSameDestination=!0}}class Fu{scenario=null;wave=0;$;constructor(e){this.$=e,this.scenario=this.$.config.scenario??null}get data(){return du[this.scenario]}async setup(){if(null!==this.scenario){await this.$.sendEvent({type:T.SetupScenario,scenario:this.data});const e=du[this.scenario];await this.$.addEffect({name:e.name,effects:e.rules,scenario:this.scenario})}}toString(){return Ic({scenario:this.scenario?Xn[this.scenario]:null,wave:this.wave},2)}}!function(e){e.PayEnergy="PayEnergy",e.ConvertElements="ConvertElements",e.DiscardPowerFromHand="DiscardPowerFromHand",e.ForgetPower="ForgetPower"}(Su||(Su={}));const Ru={name:"Amorphous",set:s.FeatherAndFlame,effects:[{name:"Setup Changes",text:"Lose Special Rule: Shadows of the Dahan",[r.Now]:({$:e})=>(e.removeEffectsWithId(pe.Shadows),Promise.resolve())},{name:"Shadows Partake of Amorphous Space",effects:[{text:"During each <fast> phase, you may move 1 of your <presence> to an adjacent land, or to a land with <dahan> anywhere on the island.",[r.Now]:async({$:e,you:a})=>{await a.addExtraAction({effectId:pe.ShadowsPartake,actionId:"ShadowsPartakeFast",icon:"<fast>",enabled:()=>e.phase===Xe.FastPowers,onActivate:async()=>{await a.presence().pickOne((async a=>{await a.move({destinationFilter:t=>t.isAdjacentTo(a.location)||t.has(e.Dahan),locations:{target:g.AnyLands}})}))}})}},{text:"During each <slow> phase, you may move 1 of your <presence> to an adjacent land, or to a land with <dahan> anywhere on the island.",[r.Now]:async({$:e,you:a})=>{await a.addExtraAction({effectId:pe.ShadowsPartake,actionId:"ShadowsPartakeSlow",icon:"<slow>",enabled:()=>e.phase===Xe.SlowPowers,onActivate:async()=>{await a.presence().pickOne((async a=>{await a.move({destinationFilter:t=>t.isAdjacentTo(a.location)||t.has(e.Dahan),locations:{target:g.AnyLands}})}))}})}}]}]},Nu={name:"Foreboding",set:s.FeatherAndFlame,innatePowers:[_e.StretchOutCoilsOfForebodingDread],effects:[{name:"Setup Changes",effects:[{text:"Lose Special Rule: Shadows of the Dahan",[r.Now]:({$:e})=>(e.removeEffectsWithId(pe.Shadows),Promise.resolve())},{text:"Gain Stretch Out Coils of Foreboding Dread",[r.Now]:async({you:e})=>{await e.gainPower(_e.StretchOutCoilsOfForebodingDread)}}]}]},$u={name:"Immense",set:s.FeatherAndFlame,effects:[{name:"An Immense Spirit, Towering and Slow",effects:[{text:"Your top Presence track grants you twice as much Energy during the Spirit Phase. Any ongoing modifiers are counted after doubling.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Immense,[r.GlobalReminder]:()=>({icon:"x2<br>Energy",spirit:a,players:[a]}),[r.AfterGainingEnergyFromTracks]:async()=>{await a.gainEnergyFromTracks()}})}},{text:"Playing Power Cards during the Spirit Phase costs 2 Card Plays instead of 1. (So if you have 3 Card Plays, you will only be able to play 1 Power Card.)",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Immense,[r.GlobalReminder]:()=>({icon:"Card<br>Plays",spirit:a,players:[a]}),[r.ExtraCardPlaysCost]:({spirit:e})=>e===a?1:0})}},{text:"If you have any unused Card Plays at the end of the Spirit Phase, gain 1 Element of your choice.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Immense,[r.GlobalReminder]:()=>({icon:"Unused<br>=1 <any>",spirit:a,players:[a]}),[r.AfterPlayPowers]:async()=>{a.usedCardPlays<a.cardPlays&&await a.gainElements()}})}},{text:"For each Major Power you play, gain 2 different Elements of your choice.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({[r.GlobalReminder]:()=>({icon:"Major<br>=2 <any>",spirit:a,players:[a]}),[r.AfterPlayPowers]:async()=>{const e=a.powersWhere((e=>e.isInPlay&&e.isA(ye.Major))).count;e>0&&await te(e,(async()=>{await a.gainElements({amount:2,different:!0})}))}})}}]}]},Wu={name:"Might",set:s.FeatherAndFlame,innatePowers:[_e.EarthMovesWithVigorAndMight],effects:[{name:"Setup Changes",effects:[{text:"Lose Special Rule: Earth's Vitality.",[r.Now]:({$:e})=>(e.removeEffectsWithId(pe.Earth),Promise.resolve())},{text:"Gain Earth Moves with Vigor and Might.",[r.Now]:async({you:e})=>{await e.gainPower(_e.EarthMovesWithVigorAndMight)}}]}]},Mu={name:"Travel",set:s.FeatherAndFlame,effects:[{name:"Setup Changes",text:"Lose Special Rule: River's Domain",[r.Now]:({$:e})=>(e.removeEffectsWithId(pe.River),Promise.resolve())},{name:"Travel on the River's Back",text:"After Growth, choose up to 2 <dahan> among your lands. Move each of them to any land contiguously connected by your <presence>.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Travel,[r.GlobalReminder]:()=>({icon:"Move<br>2 <dahan>",spirit:a,players:[a]}),[r.AfterGrowth]:async()=>{await a.forPiecesThatIs(e.Dahan).pickMultiple({amount:2,optional:!0,forPickedItem:async e=>{const t=e.location.landsContiguouslyConnectedBy(a);await e.move({locations:{target:g.AnyLands},destinationFilter:e=>t.includes(e)})},effect:{prompt:"Pick a <dahan> among your lands.",noOptions:"No <dahan> among your lands."}})}})}},{name:"People tend to the River, River tends to the People",text:"Your lands with 4 or more <dahan> are considered <sacred>, and have Defend 1.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Travel,[r.GlobalReminder]:()=>({icon:"4 <dahan><br>= <sacred>",spirit:a,players:[a]}),[r.HasSacredSiteOf]:({land:t,spirit:n,helpers:r})=>n===a&&t.hasPresenceOf(a,r)&&t.numberOf(e.Dahan)>=4,[r.DefendFromSpirits]:({land:t})=>t.hasPresenceOf(a)&&t.numberOf(e.Dahan)>=4?1:0})}}]},Gu={name:"Madness",set:s.JaggedEarth,effects:[{name:"Setup Changes",text:"Lose Special Rule: Shadows of the Dahan",[r.Now]:({$:e})=>(e.removeEffectsWithId(pe.Shadows),Promise.resolve())},{name:"Shadows cast a Subtle Madness",text:"When you add <presence> during Growth, you may also add 1 <strife> in that land.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Madness,[r.GlobalReminder]:()=>({icon:"<presence><br>+1 <strife>",ongoing:!0,spirit:a,players:[a]}),[r.AfterAddingPiece]:async({additions:t})=>{e.phase===Xe.Grow&&t.length>0&&t[0].piece.isAPresenceOf(a)&&t[0].location.hasInvaders&&await t[0].location.addStrife(1,e.Invader,!0)}})}},{name:"Glimpse of the Shadowed Void",text:"When your <presence> is destroyed, if Invaders are present, 1 <fear> per <presence> destroyed there.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Madness,[r.GlobalReminder]:()=>({icon:"<broken><br>1 <fear>",ongoing:!0,spirit:a,players:[a]}),[r.AfterRemovePiece]:async({piece:t,location:n,removement:r})=>{t.isAPresenceOf(a)&&n.hasInvaders&&x[r].isDestroyLike&&(await e.sendEvent({type:T.GenericSub,text:"1 <presence> was destroyed while Invaders were present."}),await n.fear(1))}})}}]},Hu={name:"Pandemonium",set:s.JaggedEarth,innatePowers:[_e.LightningTornSkiesIncitePandemonium],effects:[{name:"Setup Changes",effects:[{text:"Lose Innate Power: Thundering Destruction.",[r.Now]:async({you:e})=>{await e.forgetPower(_e.ThunderingDestruction)}},{text:"Gain Lightning-Torn Skies Incite Pandemonium.",[r.Now]:async({you:e})=>{await e.gainPower(_e.LightningTornSkiesIncitePandemonium)}}]}]},Uu={name:"Reach",set:s.JaggedEarth,effects:[{name:"Setup Changes",text:"Lose Special Rule: Shadows of the Dahan",[r.Now]:({$:e})=>(e.removeEffectsWithId(pe.Shadows),Promise.resolve())},{name:"Reach Through Ephemeral Distance",text:'Once per turn, you may ignore Range.<br><br>(This can be during Growth or for a Power - anything for which there\'s a Range arrow or the word "Range" is used. It affects a single action of yours.',[r.Now]:async({$:e,you:a})=>{await a.addExtraAction({effectId:pe.Reach,actionId:"Reach",icon:"Range",enabled:()=>[Xe.Grow,Xe.GainEnergy,Xe.FastPowers,Xe.SlowPowers].includes(e.phase),onActivate:async()=>{let t=!0;await e.addEffectUntilEndOfTurn({[r.GlobalReminder]:()=>({text:"Ignore Range for the next Action.",icon:"Ignore<br>Range",spirit:a,players:[a]}),[r.ExtraRange]:e=>e.spirit===a?99:0,[r.AnyActionEnds]:()=>(t?t=!1:e.removeThisEffect(),Promise.resolve())})}})}}]},qu={name:"Resilience",set:s.JaggedEarth,effects:[{name:"Setup Changes",text:"Lose Special Rule: Earth's Vitality",[r.Now]:({$:e})=>(e.removeEffectsWithId(pe.Earth),Promise.resolve())},{name:"Anchor the Land's Resilience",text:"In lands with your <sacred>, it takes 8 additional Damage to add <blight> to the land.<br><br>(So, usually, 10 Damage will add <blight>. This does not protect <dahan> at all; Damage to them is unaffected.)",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Resilience,[r.GlobalReminder]:()=>({icon:"<sacred><br>+8 HP",ongoing:!0,spirit:a,players:[a]}),[r.AdjustLandHealth]:({land:e})=>e.hasSacredSiteOf(a)?8:0})}}]},ju={name:"Sunshine",set:s.JaggedEarth,innatePowers:[_e.BoonOfSunshinesPromise],effects:[{name:"Setup Changes",effects:[{text:"Forget Boon of Vigor.",[r.Now]:async({you:e})=>{await e.forgetPower(_e.BoonOfVigor,{canRegain:!1})}},{text:"Gain 1 Energy.",[r.Now]:async({you:e})=>{await e.gainEnergy(1)}},{text:"Gain Boon of Sunshine's Promise.",[r.Now]:async({you:e})=>{await e.gainPower(_e.BoonOfSunshinesPromise)}}]}]},Ju={name:"Wind",set:s.JaggedEarth,innatePowers:[_e.ExaltationOfTheStormWind],effects:[{name:"Setup Changes",effects:[{text:"Lose Special Rule: Swiftness of Lightning.",[r.Now]:({$:e})=>(e.removeEffectsWithId(pe.Lightning),Promise.resolve())},{text:"Gain Exaltation of the Storm-Wind.",[r.Now]:async({you:e})=>{await e.gainPower(_e.ExaltationOfTheStormWind)}}]}]},Vu={name:"Dark Fire",set:s.NatureIncarnate,effects:[{name:"Setup Changes",effects:[{text:"Lose Special Rule: Shadows of the Dahan.",[r.Now]:({$:e})=>(e.removeEffectsWithId(pe.Shadows),Promise.resolve())},{text:"Gain Minor Power: Unquenchable Flames.",[r.Now]:async({you:e})=>{await e.gainPower(_e.UnquenchableFlames)}}]},{name:"Dark and Fire as One",effects:[{text:"You may treat each <moon> available to you as being <fire>, or vice versa. (Choose during each Action for each <moon>/<fire> you have.) You may discard or Forget Powers that grant <moon> to pay for <fire> Choice Events, and vice versa.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.DarkFire,[r.GlobalReminder]:()=>({icon:"<darkfire>",ongoing:!0,spirit:a,players:[a]}),[r.TreatElementAsElement]:({spirit:e,element:t})=>e!==a||t!==i.Fire&&t!==i.Moon?t:i.DarkFire,[r.TreatElementsAsElements]:({spirit:e,elements:t})=>{if(e===a){const e={...t};return delete e[i.Fire],delete e[i.Moon],void 0===t[i.DarkFire]&&void 0===t[i.Fire]&&void 0===t[i.Moon]||(e[i.DarkFire]=(t[i.DarkFire]??0)+(t[i.Fire]??0)+(t[i.Moon]??0)),e}return t}})}}]},{name:"Frightful Shadows Elude Destruction",effects:[{text:"The first time each Action would destroy your <presence>, you may Push 1 of those <presence> instead of destroying it.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({[r.PreventRemovePiece]:async({piece:t,removement:n})=>!(!t.isAPresenceOf(a)||!x[n].isDestroyLike||e.action.type===en.GameAction||e.action.data.hasDestroyedPresence||(e.action.data.hasDestroyedPresence=!0,!await e.may({prompt:"Push 1 of those <presence> instead of destroying it?"})))&&(await t.push({pieces:e.Presence}),!0),[r.GlobalReminder]:()=>({icon:"Push <presence>",ongoing:!0})})}}]},{name:"Bonus Track Action",effects:[{text:"Fire (or Moon).",[r.Now]:async({you:e})=>{await e.gainElementsForTheRestOfTheGame({[i.DarkFire]:1})}}]}]},Yu={name:"Deeps",set:s.NatureIncarnate,innatePowers:[_e.WaterEatsAwayTheDeepRootsOfEarth,_e.ReclaimedByTheDeeps],effects:[{name:"Setup Changes",effects:[{text:"Replace Innate Power: 'Ocean Breaks The Shore' with 'Water Eats Away The Deep Roots Of Earth'.",[r.Now]:async({you:e})=>{await e.replacePower(_e.OceanBreaksTheShore,{withPower:_e.WaterEatsAwayTheDeepRootsOfEarth})}},{text:"Replace Innate Power: 'Pound Ships To Splinters' with 'Reclaimed By The Deeps'.",[r.Now]:async({you:e})=>{await e.replacePower(_e.PoundShipsToSplinters,{withPower:_e.ReclaimedByTheDeeps})}}]}]},zu={name:"Encircle",set:s.NatureIncarnate,innatePowers:[_e.EncircleTheUnsuspectingPrey],effects:[{name:"Setup Changes",effects:[{text:"Lose Special Rule: Ally of the Beasts.",[r.Now]:({$:e})=>(e.removeEffectsWithId(pe.FangsAllyOfTheBeasts),Promise.resolve())},{text:"Replace Innate Power: 'Ranging Hunt' with 'Encircle The Unsuspecting Prey'.",[r.Now]:async({you:e})=>{await e.replacePower(_e.RangingHunt,{withPower:_e.EncircleTheUnsuspectingPrey})}}]},{name:"Pack Hunting",effects:[{text:"Your Powers get <range+1> for targeting lands with <beasts>.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Encircle,[r.GlobalReminder]:()=>({icon:"<beasts><br><range+1>",ongoing:!0,players:[a]}),[r.ExtraRangeToLand]:t=>({extraRangeToLand:t.spirit===a&&void 0!==e.action.power&&t.targetingLands?1:0,landFilter:a=>a.has(e.Beasts)})})}}]}]},Qu={name:"Enticing",set:s.NatureIncarnate,innatePowers:[_e.EnticingAndLullingDreams],effects:[{name:"Setup Changes",effects:[{text:"Replace Innate Power: 'Night Terrors' with 'Enticing And Lulling Dreams'.",[r.Now]:async({you:e})=>{await e.replacePower(_e.NightTerrors,{withPower:_e.EnticingAndLullingDreams})}}]}]},Ku={name:"Haven",set:s.NatureIncarnate,innatePowers:[_e.CallToASunlitHaven],effects:[{name:"Setup Changes",effects:[{text:"Replace Innate Power: 'Massive Flooding' with 'Call To A Sunlit Haven'.",[r.Now]:async({you:e})=>{await e.replacePower(_e.MassiveFlooding,{withPower:_e.CallToASunlitHaven})}}]}]},Xu={name:"Intensify",set:s.NatureIncarnate,effects:[{name:"Setup Changes",effects:[{text:"Lose Special Rule: Insights into the World's Nature.",[r.Now]:({$:e})=>(e.removeEffectsWithId(pe.MemoryInsight),Promise.resolve())}]},{name:"Intensify Through Understanding",effects:[{text:"You may spend Element Markers to modify your Actions (max. 1 of each Marker per Action):<br><sun>: Add +1 <strife> or +1 <badlands>.<br><moon>: Remove/Replace +1 piece<br><fire>: +1 Damage<br><air>: Use Minor Power <fast><br><water>: Move +1 piece<br><earth>: Defend +2<br><plant>: Add +2 <wilds> or 2 <broken><br><animal>: Add +1 <disease> or +1 <beasts><br>Except for <air>, each modifier applies to 1 land. (The Action must already do that effect there.)",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Intensify,spirit:a,[r.AfterAddingStrife]:async({piece:t,pieceFilter:n})=>{void 0===e.action.data.usedElement&&(e.action.data.usedElement=[]),e.action.spirit===a&&!e.action.data.usedElement.includes(i.Sun)&&a.preparedElements[i.Sun]>0&&await e.may({prompt:"Spend 1 prepared <sun> to add +1 <strife>?"})&&(a.preparedElements[i.Sun]-=1,e.action.data.usedElement.push(i.Sun),await t.location.addStrife(1,n))},[r.DamageBoost]:async({filter:t,onUse:n})=>{void 0===e.action.data.usedElement&&(e.action.data.usedElement=[]),e.action.spirit===a&&!e.action.data.usedElement.includes(i.Fire)&&a.preparedElements[i.Fire]>0&&await e.may({prompt:`Spend 1 prepared <fire> to add +1 <damage> to ${ee[t].text}?`})&&(a.preparedElements[i.Fire]-=1,e.action.data.usedElement.push(i.Fire),await n())},[r.ExtraDefense]:async({location:t})=>(void 0===e.action.data.usedElement&&(e.action.data.usedElement=[]),!!(e.action.spirit===a&&!e.action.data.usedElement.includes(i.Earth)&&a.preparedElements[i.Earth]>0&&await e.may({prompt:"Spend 1 prepared <earth> to Defend +2?",highlightLocations:[t]}))&&(a.preparedElements[i.Earth]-=1,e.action.data.usedElement.push(i.Earth),!0)),[r.ExtraMove]:async({movement:t,pieces:n,location:r,possiblePieces:s})=>(void 0===e.action.data.usedElement&&(e.action.data.usedElement=[]),!!(e.action.spirit===a&&t!==q.Relocate&&!e.action.data.usedElement.includes(i.Water)&&a.preparedElements[i.Water]>0&&await e.may({prompt:`Spend 1 prepared <water> to ${Zt[t].verb} +1 ${ee[n].text}?`,highlightLocations:[r],highlightPieces:s}))&&(a.preparedElements[i.Water]-=1,e.action.data.usedElement.push(i.Water),!0)),[r.ExtraRemove]:async({removement:t,pieces:n,location:r,possiblePieces:s})=>(void 0===e.action.data.usedElement&&(e.action.data.usedElement=[]),!(e.action.spirit!==a||t!==A.Remove&&t!==A.RemoveFromGame&&t!==A.Replace||e.action.data.usedElement.includes(i.Moon)||!(a.preparedElements[i.Moon]>0)||!await e.may({prompt:`Spend 1 prepared <moon> to ${x[t].verb} +1 ${ee[n].text}?`,highlightLocations:[r],highlightPieces:s}))&&(a.preparedElements[i.Moon]-=1,e.action.data.usedElement.push(i.Moon),!0)),[r.AddTwoExtraBroken]:async({land:t})=>(void 0===e.action.data.usedElement&&(e.action.data.usedElement=[]),e.action.spirit===a&&!e.action.data.usedElement.includes(i.Plant)&&a.preparedElements[i.Plant]>0&&await e.may({highlightLocations:[t],prompt:"Spend 1 prepared <plant> to add +2 <broken>?"})?(a.preparedElements[i.Plant]-=1,e.action.data.usedElement.push(i.Plant),Promise.resolve(!0)):Promise.resolve(!1)),[r.AfterAddingPiece]:async({additions:t,land:n})=>{void 0===e.action.data.usedElement&&(e.action.data.usedElement=[]);for(let r=0;r<4;r+=1){const s=[p.Badlands,p.Wilds,p.Disease,p.Beasts][r],o=[i.Sun,i.Plant,i.Animal,i.Animal][r];e.action.spirit===a&&!e.action.data.usedElement.includes(o)&&a.preparedElements[o]>0&&t.some((e=>e.piece.piece===s))&&await e.may({prompt:`Spend 1 prepared ${Uf[o].text} to add +1 ${ee[s].text}?`})&&(a.preparedElements[o]-=1,e.action.data.usedElement.push(o),await n.add(s===p.Wilds?2:1,Z[s]))}},[r.MayChangeSpeedOfPower]:({power:e})=>e.isSlow&&e.owner===a&&e.isA(ye.Minor)&&a.preparedElements[i.Air]>0,[r.ChangeSpeedOfPower]:async({power:t})=>{await t.makeFast(),a.preparedElements[i.Air]-=1,await e.sendEvent({type:T.GenericMain,text:`Intensify used Intensify Through Understanding to make ${t.powerLink} fast.`})}})}}]},{name:"Bonus Track Action",effects:[{text:"Moon, Any.",[r.Now]:async({you:e})=>{await e.gainElementsForTheRestOfTheGame({[i.Moon]:1,[i.Any]:1})}}]}]},_u={name:"Lair",set:s.NatureIncarnate,innatePowers:[_e.SocietyDissolvesAtTheBeckoningHeart],effects:[{name:"Setup Changes",effects:[{text:"Put your Incarna (<incarna-lair>) in an Inland land on your starting board. Remove 3 <presence>.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Lair,[r.AdjustSetupPresence]:async({spirit:t})=>{if(t===a){const t=a.startingBoard.inLandNumber(8);return await t.add(1,e.Beasts),await a.startingBoard.inInlandLands().pickOne((async e=>{await e.addIncarna(p.IncarnaLair,a)})),e.removeThisEffect(),!0}return!1}})}},{text:"Lose Special Rule: Enthrall the Foreign Explorers.",[r.Now]:({$:e})=>(e.removeEffectsWithId(pe.LureEnthrallTheForeignExplorers),Promise.resolve())},{text:"Replace Innate Power: 'Forsake Society To Chase After Dreams' with 'Society Dissolves At The Beckoning Heart'.",[r.Now]:async({you:e})=>{await e.replacePower(_e.ForsakeSocietyToChaseAfterDreams,{withPower:_e.SocietyDissolvesAtTheBeckoningHeart})}}]},{name:"A Single Alluring Lair",effects:[{text:"Invaders/<dahan>/<beasts>/<presence> (of any Spirit) at <incarna-lair> can't move. (You can reposition <incarna-lair> by adding it with your second Growth option instead of adding <presence>.)",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Lair,[r.GlobalReminder]:()=>({icon:"<incarna-lair>",text:"Invaders/<dahan>/<beasts>/<presence> (of any Spirit) at <incarna-lair> can't move. (You can reposition <incarna-lair> by adding it with your second Growth option instead of adding <presence>.)<br><br>6 <explorer> and 3 <dahan> at <incarna-lair> don't participate in Ravage. (They don't deal Damage or take Damage.)",ongoing:!0,spirit:a,players:[a]}),[r.PreventMovePiece]:({piece:a,movement:t,source:n})=>n.has(e.IncarnaLair)&&a.isOneOfIgnoringCountAs(e.Invader,e.Dahan,e.Beasts,e.Presence)&&t!==q.Relocate})}},{text:"6 <explorer> and 3 <dahan> at <incarna-lair> don't participate in Ravage. (They don't deal Damage or take Damage.)",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.Lair,[r.DoesNotParticipateInRavage]:async({location:a})=>{a.has(e.IncarnaLair)&&(await a.doNotParticipateInRavage({quantifier:w.Exactly,amount:6,pieces:e.Explorer}),await a.doNotParticipateInRavage({quantifier:w.Exactly,amount:3,pieces:e.Dahan}))}})}}]},{name:"Incarna",text:"<incarna-lair> may count as <presence>/<sacred>.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Lair,text:"<incarna-lair> may count as <presence>/<sacred>.",[r.GlobalReminder]:()=>({icon:"<incarna-lair> =<br><presence>/<sacred>",ongoing:!0,spirit:a,players:[a]}),[r.HasSacredSiteOf]:({land:e,spirit:t})=>t===a&&e.pieces.some((e=>e.piece===p.IncarnaLair))})}}]},Zu={name:"Locus",set:s.NatureIncarnate,innatePowers:[_e.StrengthOfTheWakingIsland],effects:[{name:"Setup Changes",effects:[{text:"Replace Unique Power: 'Elemental Aegis' with 'Pull Beneath The Hungry Earth'.",[r.Now]:async({you:e})=>{await e.replacePower(_e.ElementalAegis,{withPower:_e.PullBeneathTheHungryEarth})}},{text:"Put your Incarna (<incarna-locus>) and the <presence> from the <fire> space of your <presence> track on your starting board in land #5.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Locus,[r.AfterSetupPresence]:async()=>{await a.removePresenceFromTrack(1),await a.startingBoard.inLandNumber(5).addIncarna(p.IncarnaLocus,a),await a.startingBoard.inLandNumber(5).createPiece(1,p.Presence,a.spiritNumber),e.removeThisEffect()}})}},{text:"Replace Innate Power: 'Serpent Wakes In Power' with 'Strength Of The Waking Island'.",[r.Now]:async({you:e})=>{await e.replacePower(_e.SerpentWakesInPower,{withPower:_e.StrengthOfTheWakingIsland})}}]},{name:"Locus of the Serpent's Regard",effects:[{text:"Spirits with absorbed <presence> can use your <presence> at <incarna-locus> for targeting.<br><incarna-locus> doesn't count towards your Deep Slumber limit.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Locus,[r.GlobalReminder]:()=>({icon:"<incarna-locus><br><presence>",ongoing:!0,spirit:a,players:[a]}),[r.MayUseOtherSpiritPresenceForTargeting]:({spirit:e})=>e!==a&&null!=a.incarna?a.incarna.location.pieces.filter((e=>e.isPresence&&e.owner===a)):[]})}},{text:"After uncovering the <earth> space of your <presence> track, Empower <incarna-locus>.",[r.Now]:async({$:e,you:a,effect:t,...n})=>{const i={triggerId:e.nextTriggerId(),[r.Now]:async()=>{await e.doSpiritAction((async()=>{await a.empowerIncarna()}),{spirit:a})}};await e.addSubEffect({effectId:pe.Locus,[r.AfterUncoveringTrack]:async({spirit:r,trackIndex:s})=>{r===a&&8===s&&await e.addTrigger(i,t,n.action)}})}}]},{name:"Bonus Track Action",effects:[{text:"Add/Move <incarna-locus> to Land with Your Presence.",[r.Now]:async({$:e,you:a})=>{await a.addExtraAction({effectId:pe.Locus,actionId:"LocusBonusAction",icon:"<incarna-locus>",maxUses:()=>1,enabled:()=>[Xe.Grow,Xe.GainEnergy].includes(e.phase),onActivate:async()=>{await e.addSubEffect({highlightPieces:null!=a.incarna?[a.incarna]:[],[r.Now]:async()=>{await a.inLands().pickOne((async e=>{null==a.incarna?await e.addIncarna(p.IncarnaLocus,a):await a.incarna.move({locations:{target:g.ToThisLocation,location:e}})}))}})}})}}]},{name:"Incarna",text:"<incarna-locus> may count as <presence>.<br><br>When empowered it may also count as <badlands>.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Locus,text:"<incarna-locus> may count as <presence>.<br><br>When empowered it may also count as <badlands>.",[r.GlobalReminder]:()=>({icon:"<incarna-locus> =<br><presence>"+(a.hasEmpoweredIncarna?"/<badlands>":""),ongoing:!0,spirit:a,players:[a]})})}}]},ep={name:"Mentor",set:s.NatureIncarnate,innatePowers:[_e.ShareMentorshipAndExpertise],effects:[{name:"Setup Changes",effects:[{text:"Lose Special Rule: Long Ages of Knowledge and Forgetfulness.",[r.Now]:({$:e})=>(e.removeEffectsWithId(pe.MemoryKnowledge),Promise.resolve())},{text:"Replace Innate Power: 'Observe The Ever Changing World' with 'Share Mentorship And Expertise'.",[r.Now]:async({you:e})=>{await e.replacePower(_e.ObserveTheEverChangingWorld,{withPower:_e.ShareMentorshipAndExpertise})}}]},{name:"Past Teaching Spring Forth Unbidden",effects:[{text:"When you gain Power Cards, draw 2 fewer cards (min. 2) and gain 1 more of them (normally draw 2 cards and gain both). (Forget only one Power Card when gaining Major Powers.)",[r.Now]:async({you:e,$:a})=>{await a.addSubEffect({effectId:pe.Mentor,[r.ExtraCardDrawAmount]:({spirit:a})=>a===e?-2:0,[r.ExtraCardKeepAmount]:({spirit:a})=>a===e?1:0})}}]}]},ap={name:"Nourishing",set:s.NatureIncarnate,innatePowers:[_e.ImbueWithNourishingVitality],effects:[{name:"Setup Changes",effects:[{text:"Lose Special Rule: Earth's Vitality.",[r.Now]:({$:e})=>(e.removeEffectsWithId(pe.Earth),Promise.resolve())},{text:"Replace Unique Power: 'A Year Of Perfect Stillness' with 'Voracious Growth'.",[r.Now]:async({you:e})=>{await e.replacePower(_e.AYearOfPerfectStillness,{withPower:_e.VoraciousGrowth})}},{text:"Gain Innate Power: Imbue With Nourishing Vitality.",[r.Now]:async({you:e})=>{await e.gainPower(_e.ImbueWithNourishingVitality)}}]},{name:"Flourish with Nature's Strength",effects:[{text:"After you gain a Major Power, gain a Minor Power.",[r.Now]:async({you:e,$:a})=>{await a.addSubEffect({effectId:pe.Nourishing,[r.GlobalReminder]:()=>({icon:"Major<br>Power",ongoing:!0,spirit:e,players:[e]}),[r.AfterGainingPowers]:async({powerGain:a,spirit:t})=>{t===e&&!a.gifted&&!a.taken&&a.chosen.length>0&&a.chosen[0].data.type===o.Major&&await e.gainPowerCard({powerType:o.Minor})}})}}]}]},tp={name:"Regrowth",set:s.NatureIncarnate,innatePowers:[_e.UnbelievableRegrowth],effects:[{name:"Setup Changes",effects:[{text:"Lose Special Rule: Steady Regeneration.",[r.Now]:({$:e})=>(e.removeEffectsWithId(pe.GreenSteadyRegeneration),Promise.resolve())},{text:"Replace Innate Power: 'All-Enveloping Green' with 'Unbelievable Regrowth'.",[r.Now]:async({$:e,you:a})=>{await a.replacePower(_e.AllEnvelopingGreen,{withPower:_e.UnbelievableRegrowth}),await e.addSubEffect({effectId:pe.Regrowth,[r.MayIgnoreTargetFilterWhenTargetingLand]:({power:e})=>e.power===_e.UnbelievableRegrowth&&e.owner.hasElementsWithConvert({[i.Water]:2,[i.Plant]:3})})}},{text:"Take 13 <broken>.",[r.Now]:({you:e})=>(e.destroyedPresence+=13,Promise.resolve())}]}]},np={name:"Sparking",set:s.NatureIncarnate,innatePowers:[_e.GiftOfTheSparkingSky],effects:[{name:"Setup Changes",effects:[{text:"Replace Innate Power: 'Thundering Destruction' with 'Gift Of The Sparking Sky'.",[r.Now]:async({you:e})=>{await e.replacePower(_e.ThunderingDestruction,{withPower:_e.GiftOfTheSparkingSky})}},{text:"Replace Unique Power: 'Raging Storm' with 'Smite The Land With Fulmination'.",[r.Now]:async({you:e})=>{await e.replacePower(_e.RagingStorm,{withPower:_e.SmiteTheLandWithFulmination})}}]}]},rp={name:"Spreading Hostility",set:s.NatureIncarnate,effects:[{name:"Setup Changes",effects:[{text:"Lose rightmost Growth option.",[r.Now]:({you:e})=>(e.disabledGrowthOptions.push(3),Promise.resolve())},{text:"Gain 1 Energy.",[r.Now]:async({you:e})=>{await(e?.gainEnergy(1))}}]},{name:"Lands Hostile to Humanity",effects:[{text:"Your <sacred> may also count as <badlands>. (Choose for each Action.)",[r.Now]:async({you:e})=>{await e.yourSacredSitesMayAlsoCountAs(p.Badlands)}}]},{name:"Seeds of Teaching Sprout and Grow",effects:[{text:"Energy numbers on your top <presence> track are halved (round up).",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.SpreadingHostility,[r.GlobalReminder]:()=>({icon:"1/2<br>Energy",spirit:a,players:[a]}),[r.AfterGainingEnergyFromTracks]:async()=>{await a.loseEnergy(Math.floor(a.trackEnergy/2))}})}}]},{name:"Implacable and Spreading Enmity",effects:[{text:"Your rightmost (4th) Growth option is replaced with:<br><bullet> Gain Fire<br><bullet> Move a <presence> in <range-1><br><bullet> Move a Presence in <range-1><br><bullet> 1 Damage at Range 0<br>(This option does not have an Energy cost.)",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.SpreadingHostility,[r.SpiritHasExtraGrowthOptions]:({spirit:e})=>e===a?{effects:[{text:"Gain Fire",[r.Now]:async()=>{await a.gainElementsUntilEndOfTurn({[i.Fire]:1})}},{text:"Move a <presence> in <range-1>",[r.Now]:async()=>{await a.movePresence(1)}},{text:"Move a Presence in <range-1>",[r.Now]:async()=>{await a.movePresence(1)}},{text:"1 Damage at Range 0",[r.Now]:async()=>{await a.inLandsWithinRange(0).pickOne((async e=>{await e.damage(1)}))}}]}:null}),mu(a,"growthOptions"),a.growthStatus=a.growthOptions.map((()=>Of.Available))}}]}]},ip={name:"Stranded",set:s.NatureIncarnate,effects:[{name:"Setup Changes",effects:[{text:"Lose Special Rule: Mists Shift and Flow.",[r.Now]:({$:e})=>(e.removeEffectsWithId(pe.ShroudMistsShiftAndFlow),Promise.resolve())}]},{name:"Mists Steadily Drift",effects:[{text:"Up to twice during the <fast> phase and up to twice during the <slow> phase, Push 1 of your <presence>. (If helpful, use Scenario Markers to track uses.)",[r.Now]:async({$:e,you:a})=>{for(const t of[Xe.FastPowers,Xe.SlowPowers])await a.addExtraAction({effectId:pe.Stranded,actionId:`MistsSteadilyDrift${t}`,icon:"<presence>",maxUses:()=>2,enabled:()=>e.phase===t,visible:()=>e.phase===t,onActivate:async()=>{await a.presence().pickOne((async e=>{await e.push()}))}})}}]},{name:"Stranded In the Shifting Mist",effects:[{text:"Once each <fast> phase, Isolate one of your lands.",[r.Now]:async({$:e,you:a})=>{await a.addExtraAction({effectId:pe.Stranded,actionId:"StrandedInTheShiftingMist",icon:"Isolate",enabled:()=>e.phase===Xe.FastPowers,onActivate:async()=>{await a.inLands().pickOne((async e=>{await e.isolate()}))}})}}]}]},sp={name:"Tactician",set:s.NatureIncarnate,effects:[{name:"Setup Changes",effects:[{text:"Lose rightmost Growth option.",[r.Now]:({you:e})=>(e.disabledGrowthOptions.push(2),Promise.resolve())}]},{name:"Adaptable Tactician",effects:[{text:"Your 3rd Growth option is replaced by:<br><bullet> Gain Power Card<br><bullet> Add a Presence<br><bullet> Gain +1 Energy<br><bullet> Gain Sun OR Fire",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Tactician,[r.SpiritHasExtraGrowthOptions]:({spirit:e})=>e===a?{effects:[{text:"Gain Power Card",[r.Now]:async()=>{await a.gainPowerCard()}},{text:"Add a Presence",[r.Now]:async()=>{await a.addPresenceInRange(0)}},{text:"Gain +1 Energy",[r.Now]:async()=>{await a.gainEnergy(1)}},{text:"Gain Sun OR Fire",[r.Now]:async()=>{await a.gainElements({elements:[i.Sun,i.Fire]})}}]}:null}),mu(a,"growthOptions"),a.growthStatus=a.growthOptions.map((()=>Of.Available))}}]}]},op={name:"Tangles",set:s.NatureIncarnate,innatePowers:[_e.ImpenetrableTanglesOfGreenery],effects:[{name:"Setup Changes",effects:[{text:"Replace Innate Power: 'Creepers Tear Into Mortar' with 'Impenetrable Tangles Of Greenery'.",[r.Now]:async({you:e})=>{await e.replacePower(_e.CreepersTearIntoMortar,{withPower:_e.ImpenetrableTanglesOfGreenery})}},{text:"Replace Unique Power: 'Gift Of Proliferation' with 'Belligerent And Aggressive Crops'.",[r.Now]:async({you:e})=>{await e.replacePower(_e.GiftOfProliferation,{withPower:_e.BelligerentAndAggressiveCrops})}}]}]},dp={name:"Transforming",set:s.NatureIncarnate,innatePowers:[_e.ExaltationOfTheTransformingFlame],effects:[{name:"Setup Changes",effects:[{text:"Replace Innate Power: 'The Burned Land Regrows' with 'Exaltation Of The Transforming Flame'.",[r.Now]:async({you:e})=>{await e.replacePower(_e.TheBurnedLandRegrows,{withPower:_e.ExaltationOfTheTransformingFlame})}}]},{name:"Transform Rather Than Consume",effects:[{text:"When your Actions would Destroy <city> (including by Damage), instead:<br>2 <fear>. Replace that <city> with <town> and 1 <explorer>. Push both Invaders.<br><br>When your Actions would Destroy <town> (including by Damage), instead: 1 <fear>. Replace that <town> with <explorer>. Push both Invaders.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Transforming,[r.GlobalReminder]:()=>({icon:"Transform",ongoing:!0,spirit:a,players:[a]}),[r.PreventRemovePiece]:async({piece:t,removement:n})=>{if(e.action.spirit===a&&x[n].isDestroyLike&&t.isA(e.TownOrCity)){const a=t.isA(e.City);return await e.addSubEffect({text:a?"When your Actions would Destroy <city> (including by Damage), instead:<br>2 <fear>. Replace that <city> with <town> and 1 <explorer>. Push both Invaders.":"When your Actions would Destroy <town> (including by Damage), instead: 1 <fear>. Replace that <town> with <explorer>. Push both Invaders.",[r.Now]:async()=>{await t.location.fear(a?2:1),t.damage=0;const e=[];e.push(...(await t.replace([a?p.Town:p.Explorer,p.Explorer])).added);for(const a of e)await a.piece.push()}}),!0}return!1}})}}]}]},cp={name:"Unconstrained",set:s.NatureIncarnate,effects:[{name:"Setup Changes",effects:[{text:"Lose Special Rule: Call Forth Predators.",[r.Now]:({$:e})=>(e.removeEffectsWithId(pe.FangsCallForthPredators),Promise.resolve())},{text:"Do not Add a <beasts> as part of Spirit Setup.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Unconstrained,[r.PreventAddPiece]:({piece:t,location:n})=>Promise.resolve(e.phase===Xe.SetupPresence&&t===p.Beasts&&n.hasPresenceOf(a)),[r.AfterSetupPresence]:()=>(e.removeThisEffect(),Promise.resolve())})}}]},{name:"Unconstrained by Ravaged Lands",text:"Ranging Hunt (your left Innate Power) may target lands with <blight>.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Unconstrained,[r.GlobalReminder]:()=>({icon:"Target<br><blight>",ongoing:!0,spirit:a,players:[a]}),[r.MayIgnoreTargetFilterWhenTargetingLand]:({power:e})=>e.power===_e.RangingHunt})}},{name:"Predators Arise",text:"Each Spirit Phase, either Prepare 1 <beasts> (storing it next to your Spirit Panel) or Add any number of your prepared <beasts> to one of your lands.",[r.Now]:async({$:e,you:a})=>{await a.addExtraAction({effectId:pe.Unconstrained,actionId:"PredatorsArise",icon:"+1 <beasts>",text:"Either Prepare 1 <beasts> (storing it next to your Spirit Panel) or Add any number of your prepared <beasts> to one of your lands.",enabled:()=>e.phase===Xe.Grow||e.phase===Xe.GainEnergy,onActivate:async()=>{await e.addSubEffect({[r.Now]:async()=>{await e.chooseBetween({effects:[{actionId:"PrepareBeast",text:"Prepare 1 <beasts>",[r.Now]:async()=>{await a.addPrepareBeast(1)}},{actionId:"AddBeasts",text:"Add any number of your prepared <beasts> to one of your lands.",condition:()=>a.panelPieces[e.Beasts]>0,[r.Now]:async()=>{await a.inLands().pickMultiple({optional:!0,amount:a.panelPieces[e.Beasts],forPickedItem:async t=>{await t.add(1,e.Beasts),await a.addPrepareBeast(-1)},together:!0})}}]})}})}})}}]},lp={name:"Violence",set:s.NatureIncarnate,effects:[{name:"Setup Changes",effects:[{text:"Lose Innate Power: Spirits May Yet Dream.",[r.Now]:async({you:e})=>{await e.forgetPower(_e.SpiritsMayYetDream)}},{text:"Gain 1 Energy.",[r.Now]:async({you:e})=>{await e.gainEnergy(1)}},{text:"Replace Unique Power: 'Dreams of the Dahan' with 'Bats Scout For Raids By Darkness'.",[r.Now]:async({you:e})=>{await e.replacePower(_e.DreamsOfTheDahan,{withPower:_e.BatsScoutForRaidsByDarkness})}}]},{name:"Nightmares of Violence and Death",effects:[{text:"Card Plays on your bottom <presence> track grant twice as many Plays during the Spirit Phase. These extra Card Plays can only be used for Power Cards with Damage or Destroy instructions.<br>When To Dream A Thousand Deaths generates <fear>, generate +1 <fear> per affected <explorer>/<town> (to 1/3/5 <fear> for <explorer>/<town>/<city>, respectively).",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Violence,[r.ExtraCardPlaysForDamageAndDestroy]:({spirit:e})=>e===a})}}]}]},hp={name:"Warrior",set:s.NatureIncarnate,innatePowers:[_e.LeadTheWarriorsToBattle],effects:[{name:"Setup Changes",effects:[{text:"Replace Innate Power: 'Lead The Furious Assault' with 'Lead The Warriors To Battle'.",[r.Now]:async({you:e})=>{await e.replacePower(_e.LeadTheFuriousAssault,{withPower:_e.LeadTheWarriorsToBattle})}},{text:"Replace 1 of your <presence> with your Incarna (<incarna-warrior>) and 1 <dahan>.",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({[r.AfterSetupPresence]:async()=>{await a.presence().pickOne((async t=>{const n=t.location;await t.remove(A.RemoveFromGame),await n.addIncarna(p.IncarnaWarrior,a),await n.add(1,e.Dahan)}),{noOptions:"No presence?"})}})}},{text:"Replace Unique Power: 'Manifestation Of Power And Glory' with 'Call To Bloodshed'.",[r.Now]:async({you:e})=>{await e.replacePower(_e.ManifestationOfPowerAndGlory,{withPower:_e.CallToBloodshed})}}]},{name:"Warrior-Spirit's Raiding Party",effects:[{text:"When your Actions move <dahan> and they bring <incarna-warrior>, you may deal 1 Damage at <incarna-warrior> (max. 1 Damage per Action).",[r.Now]:async({$:e})=>{await e.addSubEffect({effectId:pe.Warrior,[r.AfterMoving]:async({piece:a,destination:t})=>{a.isA(e.Dahan)&&e.bringingWarriorThisInstruction&&!e.action.data.hasRaided&&await e.may({text:"Deal 1 Damage at <incarna-warrior>?"})&&(e.action.data.hasRaided=!0,await t.damage(1))}})}}]},{name:"Incarna",[r.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:pe.Warrior,text:"<incarna-warrior> may count as <presence>.",[r.GlobalReminder]:()=>({icon:"<incarna-warrior> =<br><presence>",ongoing:!0,spirit:a,players:[a]})})}}]},gp={[ln.Amorphous]:Ru,[ln.DarkFire]:Vu,[ln.Deeps]:Yu,[ln.Encircle]:zu,[ln.Enticing]:Qu,[ln.Foreboding]:Nu,[ln.Haven]:Ku,[ln.Immense]:$u,[ln.Intensify]:Xu,[ln.Lair]:_u,[ln.Locus]:Zu,[ln.Madness]:Gu,[ln.Mentor]:ep,[ln.Might]:Wu,[ln.Nourishing]:ap,[ln.Pandemonium]:Hu,[ln.Reach]:Uu,[ln.Regrowth]:tp,[ln.Resilience]:qu,[ln.Sparking]:np,[ln.SpreadingHostility]:rp,[ln.Stranded]:ip,[ln.Sunshine]:ju,[ln.Tactician]:sp,[ln.Tangles]:op,[ln.Transforming]:dp,[ln.Travel]:Mu,[ln.Unconstrained]:cp,[ln.Violence]:lp,[ln.Warrior]:hp,[ln.Wind]:Ju},fp=(e,a)=>(e=>Array.from(Array(e.length).keys()))(e).filter(((t,n)=>a(e[t],n))),up=e=>1===Object.keys(e).filter((a=>0!==e[a])).length,pp=(e,a)=>{let t="";return Object.keys(Uf).filter((a=>void 0!==e[a]&&0!==e[a])).forEach((n=>{t+=`${e[n]} ${a?Uf[n].name:Uf[n].text} `})),t},wp=(e,...a)=>{const t={...e};for(const e of a)for(const a of Object.keys(t))t[a]=Math.max(t[a]-(e[a]??0),0);return t};var yp=function(e,a,t,n){var r,i=arguments.length,s=i<3?a:null===n?n=Object.getOwnPropertyDescriptor(a,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,a,t,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(i<3?r(s):i>3?r(a,t,s):r(a,t))||s);return i>3&&s&&Object.defineProperty(a,t,s),s};class mp{data;absorbedPresence=[];aspect;cardsMadeImpendingThisTurn=[];cardsPlayedThisTurn=[];daysPowers=[];destinyPowers=[];destroyedIncarna=null;destroyedPresence=0;didNotWantToReachThreshold=[];disabledGrowthOptions=[];growthStatus=[];hasEmpoweredIncarna=!1;hasPlayedPowers=!1;hasReclaimedACardDuringSpiritPhase=!1;healingCards=[];healingMarkers=[];innateEnergy=0;landsIncludingNonExisting=[];panelPieces={[p.Explorer]:0,[p.Town]:0,[p.City]:0,[p.Beasts]:0};powers=[];powersInProgressionDeck=[];preparedElements=vn();rememberedUniques=[];score=0;spirit;spiritNumber;startingBoardIndex;time=0;trackElements=[];usedCardPlaysForNonDamageAndDestroy=0;$;trackStatusInternal=[];constructor({$:e,spiritNumber:a,spirit:t,aspect:n,boardIndex:r,progression:i=!1}){un.makeObservable(this),this.$=e,this.spiritNumber=a,this.spirit=t,this.aspect=n,this.startingBoardIndex=r,this.data=Kf[this.spirit],i&&this.data.progression&&this.data.progression.forEach((e=>{this.$.removePowerCardFromDecks(e),this.powersInProgressionDeck.push(e)}))}get availablePowersForPlay(){if(this.$.allSpiritsHavePlayedPowers)return[];let e;const a=this.cardPlaysCostToPlayPowerCard,t=this.cardPlays;if(this.hasExtraCardPlaysForDamageAndDestroy){const n=this.usedCardPlaysForNonDamageAndDestroy+a>t;e=this.usedCardPlays+a>2*t?this.powers.filter((e=>e.assisted&&e.isPlayable)):this.powers.filter((e=>e.isPlayable&&(!n||e.isCardWithDamageAndDestroy)))}else e=this.usedCardPlays+a>t?this.powers.filter((e=>e.assisted&&e.isPlayable)):this.powers.filter((e=>e.isPlayable));const n=e.map((e=>({power:e,spirit:this})));return this.hasPlayedPowers||n.push({power:void 0,spirit:this}),n}get availablePresenceForTargeting(){return this.presence().items.concat(this.extraPresenceAvailableForTargeting)}get availableRememberedUniques(){return this.rememberedUniques.filter((e=>0===this.$.spiritsWhich((a=>a.hasPower(e))).count))}get averageEnergyCost(){if(0===this.powers.length)return 0;let e=0;for(const a of this.powers)e+=a.costToPlay;return e/this.powers.length}get baseCardPlays(){let e=0,a=0;return this.data.tracks.forEach((({cardPlays:t,extraCardPlays:n},r)=>{this.trackStatus[r]!==fc.Covered&&(e=Math.max(e,t??0),a+=n??0)})),e+a}get canPlayCardsWithoutCost(){return this.$.someEffect(r.CanPlayCardsWithoutCost,{spirit:this})}get cardPlays(){const e=this.$.adjustedCardPlays;return e>0?e:this.baseCardPlays+this.extraCardPlays+this.impendingCardPlays}get cardPlaysCostToPlayPowerCard(){return 1+this.$.sumEffects(r.ExtraCardPlaysCost,{spirit:this})}get corners(){const e=new Set;for(const a of this.lands)for(const t of a.corners)e.add(t);return Array.from(e)}get elements(){return vn(this.elementsFromPowers,this.elementsFromTracks,this.elementsFromEffects)}get elementsFromCards(){return this.elementsWithStatus((()=>!0))}get elementsFromDiscard(){return this.elementsWithStatus((e=>e.isInDiscard))}get elementsFromEffects(){return vn(...this.$.effectsMappedWithFilter(r.Elements,{spirit:this}))}get elementsFromHand(){return this.elementsWithStatus((e=>e.isInHand))}get elementsFromNonBlessedPowers(){return this.elementsWithStatus((e=>e.isInPlay),!1)}get elementsFromPowers(){return this.elementsWithStatus((e=>e.isInPlay))}get elementsFromTracks(){const e=vn();return this.trackStatus.forEach(((a,t)=>{if(a!==fc.Covered){const a=this.data.tracks[t].elements;if(a)for(const t of a)e[t]+=1;null!==this.trackElements[t]&&(e[this.trackElements[t]]+=1)}})),e}get energy(){return this.innateEnergy+(this.spirit===hn.Ocean?Math.floor(this.healthWorthOfDrownedInvaders/this.$.spiritCount)-this.energyDebt:0)}get extraCardPlays(){return this.$.sumEffects(r.ExtraCardPlays,{spirit:this})}get extraPresenceAvailableForTargeting(){const e=[];for(const a of this.$.effectsMappedWithFilter(r.MayUseOtherSpiritPresenceForTargeting,{spirit:this}))e.push(...a);return e}get growthOptionEnergy(){const e=this.growthOptions.find((e=>e.status===Of.Available&&e.effect.text?.startsWith("Gain")&&e.effect.text?.endsWith("Energy")));return e?Number.parseInt(e.effect.text[6],10):0}get growthOptionGroups(){const e=[...this.data.growthOptions];for(const a of this.$.effectsMappedWithFilter(r.SpiritHasExtraGrowthOptions,{spirit:this}))e.push(a);return e}get growthOptions(){const e=[];let a=0;return this.growthOptionGroups.forEach((({cost:t,effects:n,requiresTrackSpot:r,requiresHealingCard:i})=>{n.forEach(((n,s)=>{e.push({effect:{...n,card:this.data.innatePowers[0]},spirit:this,option:a,subOption:s,index:e.length,cost:t,status:this.growthStatus[e.length],requiresTrackSpot:r,requiresHealingCard:i})})),a+=1})),e}get hasExtraCardPlaysForDamageAndDestroy(){return this.$.someEffect(r.ExtraCardPlaysForDamageAndDestroy,{spirit:this})}get hasIncarna(){return null!=this.incarna}get hasReclaimableCards(){return this.powers.some((e=>e.isA(ye.AnyCard)&&e.isInDiscard))}get healthWorthOfDrownedInvaders(){return this.panelPieces[p.Explorer]+2*this.panelPieces[p.Town]+3*this.panelPieces[p.City]}get impendingCardPlays(){let e=0;return this.data.tracks.forEach((({impendingCardPlays:a},t)=>{this.trackStatus[t]!==fc.Covered&&(e+=a??0)})),e}get impendingEnergy(){let e=0;return this.data.tracks.forEach((({impendingEnergy:a},t)=>{this.trackStatus[t]!==fc.Covered&&(e+=a??0)})),e}get incarna(){return this.pieces.find((e=>e.isIncarna&&e.owner===this))??null}get innatePowers(){return this.powers.filter((e=>e.data.type===o.Innate))}get lands(){return this.landsIncludingNonExisting.filter((e=>e.exists))}get mayShift(){return this.$.someEffect(r.MayShift,{spirit:this})}get mayUsePreparedElementsToEnhanceActions(){return this.$.hasEffectNamed("Insights into the World's Nature")}get name(){return this.data.name}get nameLink(){return`<spirit-${this.spirit.toLowerCase()}>`}get nonBlessedPowerCards(){return this.powers.filter((e=>e.isA(ye.AnyCard)&&!e.isBlessed&&!e.assisted))}get nonInnatePowers(){return this.powers.filter((e=>e.data.type!==o.Innate))}get numberOfHealingAnimalMarkers(){return this.healingMarkers.filter((e=>e===i.Animal)).length}get numberOfHealingMarkers(){return this.healingMarkers.length}get numberOfHealingWaterMarkers(){return this.healingMarkers.filter((e=>e===i.Water)).length}get numberOfImpendingCards(){return this.powers.filter((e=>e.isImpending)).length}get numberOfPowerCards(){return this.nonBlessedPowerCards.length}get numberOfPowerCardsInHand(){return this.nonBlessedPowerCards.filter((e=>e.isInHand)).length}get numberOfPowerCardsInPlay(){return this.powerCardsInPlay.length}get numberOfPreparedElements(){return Pd(Object.values(this.preparedElements))}get numberOfPresenceInLands(){return this.presence().count}get numberOfPresenceInTracks(){return on(this.trackStatus,(e=>e===fc.Covered))}get numberOfSacredSites(){return this.inSacredSites().count}get pickOptions(){const e=[...this.data.pickOptions.map((e=>[...e]))];return this.$.firstEffectOfType(r.SpiritHasExtraGrowthOptions,{spirit:this})&&e.forEach((e=>{e.push(e[e.length-1]+1)})),e}get pieces(){const e=[];for(const a of this.lands)e.push(...a.pieces);return e}get powerCardsInPlay(){return this.powers.filter((e=>e.isA(ye.AnyCard)&&e.isInPlay))}get powerCardsInPlayNotBlessed(){return this.powers.filter((e=>e.isA(ye.AnyCard)&&e.isInPlay&&!e.isBlessed&&!e.assisted))}get preparedElementsForGainingElements(){return this.mayUsePreparedElementsToEnhanceActions?this.preparedElements:vn()}get presenceMayCountAsBadlandsOrBeasts(){return this.$.someEffect(r.PresenceCountsAsBadlandsOrBeasts,{spirit:this})}get preventAddAnyPresence(){return this.$.someEffect(r.PreventAddAnyPresence,{spirit:this})}get primaryElements(){const e=vn();for(const a of this.data.uniquePowers)for(const t of bd[a].elements)e[t]+=1;return Object.keys(e).sort(((a,t)=>e[t]-e[a])).slice(0,3)}get serialized(){return this.spirit}get shortName(){return this.aspect?gp[this.aspect].name:this.spirit.replace(/([A-Z]+)([A-Z][a-z]+)/g,"$1 $2").replace(/([a-z\d])([A-Z])/g,"$1 $2")}get startingBoard(){return this.$.boards[this.startingBoardIndex]}get trackActions(){return this.data.tracks.map((({effect:e,effectRequires:a},t)=>({effect:e,effectRequires:a,trackIndex:t,spirit:this,status:this.trackStatus[t]}))).filter((({effect:e,effectRequires:a})=>void 0!==e&&(void 0===a||a({you:this,$:this.$}))))}get trackEnergy(){let e=0,a=0;return this.data.tracks.forEach((({energy:t,extraEnergy:n},r)=>{this.trackStatus[r]!==fc.Covered&&(e=Math.max(e,t??0),a+=n??0)})),e+a}get trackStatus(){return this.trackStatusInternal}get unlockedTrackPresence(){return fp(this.data.tracks,((e,a)=>this.trackStatus[a]===fc.Covered&&(void 0===e.requires||this.trackStatus[e.requires]!==fc.Covered)&&(void 0===e.requiresAll||!e.requiresAll.some((e=>this.trackStatus[e]===fc.Covered)))&&(void 0===e.requiresAny||e.requiresAny.some((e=>this.trackStatus[e]!==fc.Covered)))))}get usedCardPlays(){return this.cardsPlayedThisTurn.length*this.cardPlaysCostToPlayPowerCard}get validTrackSpotsToReturnPresence(){return fp(this.data.tracks,((e,a)=>this.trackStatus[a]!==fc.Covered&&(this.data.tracks[a].covered||void 0!==this.data.tracks[a].requires||void 0!==this.data.tracks[a].requiresAll||void 0!==this.data.tracks[a].requiresAny)&&this.trackPlacementIsValidGivenIndexIsCovered(a)))}static createCollection(e,a){return new cn(e,tn.SelectSpirit,a)}async absorb(e){this.absorbedPresence.push(e.spiritNumber),await this.$.sendEvent({type:T.AbsorbedPresence,spirit:this,targetSpirit:e})}addExtraAction(e){const{actionId:a,icon:t,enabled:n=(()=>!0),visible:i=(()=>!0),maxUses:s=(()=>1),text:o=this.$.currentStackEffect?.text,name:d=this.$.currentStackEffect?.name,onActivate:c,unlimited:l=!1,power:h,previewPowers:g,required:f=!1,scenario:u,effectId:p}=e,w=C.sH.box(0);return this.$.addSubEffect({name:d,text:o,effectId:p,[r.GlobalReminder]:()=>({icon:l||f?t:`${t}<br>${w.get()} / ${s()}`,ongoing:!0,unlimited:l,spirit:l||f?void 0:this,players:[this],visible:i(),scenario:u,power:h,previewPowers:g}),[r.ExtraAction]:()=>l||!(w.get()>=s())&&n()?{actionId:a,players:[this],spirit:this,required:f,name:d,text:o,[r.Now]:async e=>{w.set(w.get()+1),await c(e)}}:null,[r.TimePasses]:()=>(w.set(0),Promise.resolve())})}async addExtraTrackElement(e){null===this.trackElements[e]&&await this.$.chooseBetween({prompt:"Select Element.",effects:[...qn].map((a=>({actionId:a,text:`${Uf[a].text}`,[r.Now]:()=>(this.trackElements[e]=a,Promise.resolve())})))})}async addIncarna(e,a=(()=>!0)){const t=[];return await this.inLandsWhere(a).pickOne((async a=>{t.push(await a.putIncarna(e,this))}),{players:[this],prompt:"Pick a land to add Incarna."}),t}addLand(e){this.landsIncludingNonExisting.includes(e)||e.isEndlessDark||this.landsIncludingNonExisting.push(e)}async addOrMoveIncarnaToLandWithPresence(e){this.hasIncarna?await(this.incarna?.location.move({pieces:Z.Incarna,owner:this,destinationFilter:e=>e.hasPresenceOf(this),locations:{target:g.AnyLands}})):await this.addIncarna(e)}addPrepareBeast(e){return this.panelPieces[this.$.Beasts]+=e,Promise.resolve()}async addPresence(e={}){const{range:a=0,locations:t=g.ToOneOfYourLands,filter:n=(()=>!0),destroyed:i=!1,together:s=!1,ignoreLandType:o=!1,forcedFromTrack:d=!1,amount:c=1,autoPlayOneOption:l=!1}=e,h=t===g.Remove||t===g.RemoveFromGame||t===g.Time,f=[];for(;f.length<c;){let u;const w=!h&&this.preventAddAnyPresence,y=f.length,m=this.unlockedTrackPresence;let v,I;if(i){if(0===this.destroyedPresence){await this.$.clickToContinue({text:"No <broken> to add."});break}}else{let e=null;if(m.length>0&&(d?e=await this.$.query({query:tn.SelectTrack,prompt:"Select <presence> from tracks",players:[this],spirit:this,items:m,actionIds:m.map((e=>`Track-${this.spirit}-${e}`))}):w||(e=await this.$.queryOptional({query:tn.SelectTrack,prompt:"Select <presence> from tracks",cancel:h?"Remove <presence> from island":"Reposition <presence>",players:[this],spirit:this,items:m,actionIds:m.map((e=>`Track-${this.spirit}-${e}`))}))),null!==e)u=m[e];else{let e="Select which <presence> to relocate.";w?e=`No more <presence> may be added to the island.<br>${e}`:h&&(e="Select which <presence> to remove."),await this.presence().pickOne((e=>(v=e,Promise.resolve())),{players:[this],prompt:e})}}switch(t){case g.RemoveFromGame:void 0!==v&&await v.remove(A.RemoveFromGame);break;case g.Remove:void 0!==v&&await v.remove(A.Remove),this.destroyedPresence+=1;break;case g.Time:if(this.time+=1,void 0!==v&&await v.remove(A.Silent),c>1)return void 0!==u&&await this.removePresenceFromTrack(u),this.addPresence({...e,amount:c-1});break;case g.ToAnyOcean:I=this.$.inOceans().where(n);break;case g.WithinRange:I=this.inLandsWithinRange(a,n);break;case g.ToOneOfYourLands:I=this.inLandsWhere(void 0!==n?n:()=>!0);break;case g.AnyLands:I=this.$.inLandsWhere(void 0!==n?n:()=>!0)}if(void 0!==I&&await I.where((e=>!this.preventAddPresence(e,o)&&(!s||0===f.length||f.some((a=>a.location===e))))).autoPickOne((async e=>{void 0!==v&&await v.remove(A.Relocate);let a=1;i&&this.destroyedPresence>0&&await this.$.oneEffectActivates(r.AddTwoExtraBroken,{spirit:this,land:e})&&(a=Math.min(this.destroyedPresence,3)),f.push(...await e.createPiece(a,v?.piece??p.Presence,this.spiritNumber)),i&&(this.destroyedPresence-=a)}),{players:[this],autoPlayOneOption:l}),void 0!==u&&await this.removePresenceFromTrack(u),f.length===y)break}return f}addPresenceInAnyOcean(){return this.addPresence({locations:g.ToAnyOcean})}addPresenceInRange(e,a){return this.addPresence({locations:g.WithinRange,range:e,...a})}async andAnotherSpirit(e,a){for(const t of[0,1]){const n=[this,e][t];await this.$.addSubEffect({text:a.text?.(0===t),players:[n],[r.Now]:()=>a.now(n,0===t)})}}async askToConvertElements(e,a={}){const t=this.elementsTreatedAsElements(e);if(this.$.action.power?.assisted)return Pd(Object.values(t))<=10;const{optionalUpgrade:n=!0,optionalThreshold:s=!0}=a;if(this.hasElements(t))return!(s&&!this.$.currentActionHasAllThresholds)||this.$.may({prompt:"Resolve threshold?"});if(this.hasElementsWithConvert(t)){const a=wp(t,this.elements);if(!n||await this.$.may({prompt:`Convert Elements to reach threshold:<br>${pp(t)}?`})){for(;Pd(Object.values(a))>0;){const e=Object.keys(a).filter((e=>(a[e]??0)>0))[0],t=[];this.preparedElementsForGainingElements[e]>0&&t.push({actionId:`Prepared${e}`,text:`Use prepared ${Uf[e].text}`,[r.Now]:async()=>{this.preparedElements[e]-=1,await this.$.sendEvent({text:`${this.nameLink} spent 1 ${Uf[e].text}.`,type:T.GenericSub}),await this.gainElementsUntilEndOfAction({[e]:1})},condition:()=>this.preparedElementsForGainingElements[e]>0});const n=[i.SunOrMoon,i.WaterOrAnimal,i.FireOrPlant].find((a=>Uf[a].elements.includes(e)));void 0!==n&&1===this.elements[n]&&t.push({actionId:`Dual${n}`,text:void 0!==`Use ${n}`?Uf[n].text:0,[r.Now]:async()=>{await this.$.sendEvent({text:`${this.nameLink} converted ${Uf[n].text} to ${Uf[e].text}.`,type:T.GenericSub}),await this.gainElementsUntilEndOfTurn({[e]:1,[n]:-1},{subEffect:!1})}}),this.elements[i.Any]>0&&t.push({actionId:"Any",text:"Use <any>.",[r.Now]:async()=>{await this.$.sendEvent({text:`${this.nameLink} converted <any> to ${Uf[e].text}.`,type:T.GenericSub}),await this.gainElementsUntilEndOfTurn({[e]:1,[i.Any]:-1},{subEffect:!1})},condition:()=>this.elements[i.Any]>0}),await this.$.chooseBetween({text:`How to convert to ${Uf[e].text}?`,autoPlayOneOption:!1,effects:t},{orChoice:!1}),a[e]-=1}return this.$.action.data.upgraded=!0,!0}return this.didNotWantToReachThreshold.push(e),!1}return!1}async askToConvertElementsToCombo(e){const a=this.elementsTreatedAsElements(e),t=this.numberOfElementCombos(a);let n=vn();for(let e=0;e<t+1;e+=1)n=vn(n,a);for(;this.hasElementsWithConvert(n)&&await this.askToConvertElements(n,{optionalThreshold:!1});)n=vn(n,a)}boardDistanceToSpirit(e){let a=null;for(const t of this.boards(this.extraPresenceAvailableForTargeting))for(const n of e.boards(e.extraPresenceAvailableForTargeting))if(null!==t.boardDistance[n.boardIndex]&&(a=null===a?t.boardDistance[n.boardIndex]:Math.min(a,t.boardDistance[n.boardIndex]),0===a))return 0;return a}boards(e=[]){return this.$.boards.filter((a=>a.existingLocations.some((a=>a.hasPresenceOf(this,e)))))}canAffordGrowthOption(e){return(void 0===e.requiresTrackSpot||this.trackStatus[e.requiresTrackSpot]!==fc.Covered)&&(void 0===e.requiresHealingCard||this.healingCards.length>0)&&(void 0===e.cost||this.energy>=e.cost||this.hasPaidForGrowthOption(e))&&!this.disabledGrowthOptions.includes(e.option)}convertElements(e){return this.askToConvertElements(e,{optionalUpgrade:!1,optionalThreshold:!1})}async destroyPresence(e,a=A.DirectDestroy,t=!1){const n=[];return await this.presence().pickMultiple({amount:e,forPickedItem:async e=>{n.push(...await e.remove(a))},repeatSame:!0,optional:t,effect:{prompt:"Pick presence."}}),n}async discardAllPowerCards(){await this.powersWhere((e=>e.isA(ye.AnyCard)&&e.isInHand)).forEach((async e=>{await e.discard()}))}async discardElements(e,{optional:a}={optional:!1}){const t={};for(let n=0;n<e;n+=1){const i=[...qn].map((e=>({actionId:e,text:`${Uf[e].text}`,condition:()=>this.preparedElements[e]>0,[r.Now]:()=>(t[e]=(t[e]??0)+1,this.preparedElements[e]-=1,Promise.resolve())})));a&&i.push({actionId:"SkipDiscard",text:"Skip",[r.Now]:()=>(n=e,Promise.resolve())}),await this.$.chooseBetween({prompt:`Select Element to discard. (${e-n} left.)`,effects:i,autoPlayOneOption:!0})}return Promise.resolve(t)}async discardPowerCards(e,a){const t=this.powersWhere((e=>e.isA(ye.AnyCard)&&e.status===Kn.InHand&&(void 0===a||a(e))));await t.pickMultiple({amount:e,forPickedItem:async e=>{await e.discard()},effect:{prompt:"Pick a Power Card to discard."}})}doPowerAction(e,a){return this.$.doPowerAction(this,e,a)}doSpiritAction(e){return this.$.doSpiritAction(e,{spirit:this})}async doTrackAction(e){const a=this.data.tracks[e];await this.doSpiritAction((()=>this.$.addEffect({name:a.name,spirit:this,...a.effect}))),this.setTrackStatusForIndex(fc.UncoveredPlayed,e)}elementTreatedAsElement(e){if(this.mayTreatElementsAsOther){const a=this.$.resultFromFirstEffectOfType(r.TreatElementAsElement,{spirit:this,element:e});if(void 0!==a)return a}return e}elementsTreatedAsElements(e){if(this.mayTreatElementsAsOther){const a=this.$.resultFromFirstEffectOfType(r.TreatElementsAsElements,{spirit:this,elements:e});if(void 0!==a)return a}return e}elementsWithStatus(e,a=!0){const t=vn();return this.powers.forEach((n=>{!n.data.elements||n.assisted||!e(n)||!a&&n.isBlessed||n.data.elements.forEach((e=>{t[e]=(t[e]??0)+1}))})),vn(this.elementsTreatedAsElements(t))}empowerIncarna(){return this.hasEmpoweredIncarna=!0,Promise.resolve()}async escapePieces(e){const a=Math.min(e??this.$.theEndlessDark.pieces.length,this.$.theEndlessDark.pieces.length),t=await this.$.theEndlessDark.move({amount:a,destinationFilter:e=>e.isLand&&!e.isOcean&&e.hasPresenceOf(this),locations:{target:g.AnyLands},pickPiecesEffect:{prompt:"Pick Piece to Escape."},pickDestinationEffect:{prompt:"Pick Land to Escape to."}});return t.length!==a&&this.$.loseGame(kd.TheEndlessDark),t}extraRange(e){let a=0;return this.data.tracks.forEach((({extraRange:e},t)=>{this.trackStatus[t]!==fc.Covered&&(a+=e??0)})),a+=this.$.sumEffects(r.ExtraRange,{spirit:this,location:e}),a}forPieces(){return wn.createCollection(this.$,this.pieces)}forPiecesThatIs(e){return this.forPieces().where((a=>a.isA(e)))}forPiecesWhere(e){return this.forPieces().where(e)}async forgetPower(e,a={}){const t=this.powers.find((a=>a.power===e));void 0!==t&&await this.forgetPowerState(t,a)}async forgetPowerState(e,a={}){const{canRegain:t=!0,silent:n=!1,duringPowerGain:i=!1}=a;if(e.owner!==this||!n&&await this.$.oneEffectActivates(r.PreventForgetPowercard,{power:e,duringPowerGain:i}))return null;const s=ae(this.powers,(a=>a.power===e.power));return this.invalidatePowerElementCache(),s&&(s.isA(ye.Unique)?t&&(this.rememberedUniques.includes(s.power)||this.rememberedUniques.push(s.power)):await this.$.discardPowerToDeckDiscard(s.power),n||await this.$.sendEvent({type:T.PowerCardForgotten,spirit:this,power:s})),s}async forgetPowers(e={}){const{amount:a=1,powerFilter:t=ye.AnyCard,filter:n=(()=>!0),optional:r=!1,duringPowerGain:i=!1}=e,s=[],o=this.powersWhere((e=>e.isA(t)&&!e.isBlessed&&!e.assisted&&n(e)));return await o.pickMultiple({amount:a,forPickedItem:async e=>{const a=await this.forgetPowerState(e,{duringPowerGain:i});a&&s.push(a)},optional:r,effect:{players:[this],prompt:`Pick ${zn[t].text} to forget.`}}),s}async gainCardPlays(e){await this.$.addSubEffectUntilEndOfTurn({[r.ExtraCardPlays]:({spirit:a})=>a===this?e:0})}gainDamageBoost(e){return this.$.gainDamageBoost({...e,spirit:this})}async gainElements(e={}){const{elements:a=[...qn],amount:t=1,forTheRestOfTheGame:n=!1,different:i=!1,same:s=!1,possiblyWithConvert:o=!1,anyAmount:d=!1}=e,c={},l={close:!1};for(;Pd(Object.values(c))<t&&!d||d&&!l.close;){const e=a.filter((e=>!1===i||!c[e])).map((e=>({actionId:e,text:`${Uf[e].text}`,[r.Now]:async()=>{const a=s?t:1;o&&!d&&await this.askToConvertElements({[e]:a},{optionalUpgrade:!1}),c[e]||(c[e]=0),c[e]+=a}})));if(d&&e.push({actionId:"Close",text:"Close",[r.Now]:()=>(l.close=!0,Promise.resolve())}),await this.$.chooseBetween({prompt:`Choose Element:<br>${pp(c)}`,autoPlayOneOption:!0,effects:e}),0===e.length)break}return Object.keys(c).length>0&&(n?n&&await this.gainElementsForTheRestOfTheGame(c):await this.gainElementsUntilEndOfTurn(c)),c}async gainElementsForTheRestOfTheGame(e){const a=this.elementsTreatedAsElements(e);await this.$.addSubEffect({[r.GlobalReminder]:()=>({text:`Extra elements:<br>${pp(a)}<br><br>(permanent)`,icon:up(a)?pp(a):"Extra<br>Elements",ongoing:!0,spirit:this,players:[this]}),[r.Elements]:({spirit:e})=>e===this?a:{}}),mu(this,"elementsFromEffects","elements")}async gainElementsUntilEndOfAction(e,a){const t=this.elementsTreatedAsElements(e);await this.$.addEffectUntilEndOfAction({effectId:a?pe.Downgrade:void 0,name:a?"Downgrade":void 0,[r.GlobalReminder]:()=>({text:`${a?"Lose":"Extra"} elements:<br>${pp(t)}<br><br>(until end of action)`,icon:up(t)?pp(t):(a?"Lose":"Extra")+"<br>Elements",spirit:this,players:[this]}),[r.Elements]:({spirit:e})=>e===this?t:{}}),mu(this,"elementsFromEffects","elements")}async gainElementsUntilEndOfTurn(e,a={}){const{subEffect:t=!0}=a,n=this.elementsTreatedAsElements(e);await this.$.sendEvent({type:T.GenericSub,text:`${this.nameLink} gained ${pp(n)}.`});const i={[r.GlobalReminder]:()=>({text:`Extra elements:<br>${pp(n)}<br><br>(until end of turn)`,icon:up(n)?pp(n):"Extra<br>Elements",spirit:this,players:[this]}),[r.Elements]:({spirit:e})=>e===this?n:{}};t?await this.$.addSubEffectUntilEndOfTurn(i):await this.$.addEffectUntilEndOfTurn(i),mu(this,"elementsFromEffects","elements")}async gainEnergy(e){for(;e>0&&await this.$.oneEffectActivates(r.PreventGainEnergy,{spirit:this});)e-=1;const a={amount:e,spirit:this};return e>0&&(await this.$.waitForAnimationsToFinish(),this.innateEnergy+=e,await this.$.sendEvent({type:T.EnergyGained,spirit:this,amount:e})),a}gainEnergyFromTracks(){return this.gainEnergy(this.trackEnergy)}gainHealingMarker(e){return this.healingMarkers.push(e),Promise.resolve()}async gainMakeFastBuff(e={}){const{amount:a=1,filter:t=(()=>!0),alsoMakeSlow:n=!1}=e,i=C.sH.box(0);await this.$.addSubEffectUntilEndOfTurn({[r.GlobalReminder]:()=>({icon:`<fast><br>${i.get()} / ${a}`,spirit:this,players:[this]}),[r.MayChangeSpeedOfPower]:({power:e})=>(e.isSlow||n)&&t(e)&&this===e.owner&&i.get()<a,[r.ChangeSpeedOfPower]:async({power:e})=>{e.data.speed===d.Slow?await e.makeFast():await e.makeSlow(),i.set(i.get()+1),i.get()===a&&this.$.removeThisEffect()}})}async gainPower(e,a={}){await this.$.removePowerCardFromDecks(e);const{silent:t=!1,index:n,assisted:r}=a,i=new Zn(this.$,e,Kn.InHand);return r&&(i.assisted=!0),void 0!==n?this.powers.splice(n,0,i):this.powers.push(i),t||await this.$.sendEvent({type:T.PowerCardGained,spirit:this,power:i}),i}async gainPowerCard(e={}){const{powerType:a,withoutForgetting:t=!1,forgetOptional:n=!1,gifted:i=!1,taken:s=!1}=e;let{fromSelection:d,discardAfter:c=!0}=e,l=null;const h={chosen:[],notChosen:[],forgotten:[],gifted:i,taken:s};let g=1;g=!(void 0===e.drawAmount||e.drawAmount>1)||s||i?e.drawAmount??4:Math.max((e.drawAmount??4)+this.extraCardDrawAmount,2);const f=(e.keepAmount??1)+this.extraCardKeepAmount;if(!i&&!s&&!d){const e=this.$.resultFromFirstEffectOfType(r.AdjustGainingPowers,{spirit:this,powerType:a});e&&(d=e,c=!1)}const u=void 0===d&&4===g&&1===f&&this.powersInProgressionDeck.length>0;if(d)h.notChosen=[...d];else if(!u){const e=void 0!==a?[a]:[o.Minor,o.Major],t=e[await this.$.query({query:tn.SelectPowerType,items:e,actionIds:e,autoPlayOneOption:!0})];await te(g,(async()=>{const e=await this.$.drawPower(t);e&&h.notChosen.push(e)}))}for(let e=0;e<f;e+=1){if(u)void 0===a?l=this.powersInProgressionDeck.shift()??null:(l=this.powersInProgressionDeck.find((e=>bd[e].type===a))??null,null!==l&&ae(this.powersInProgressionDeck,l));else if(h.notChosen.length>0){if(this.$.phase===Xe.Grow&&4===g)return await this.gainPowerCardBuffs(h.notChosen.reverse(),{discardAfter:c,withoutForgetting:t,forgetOptional:n}),h;if(l=h.notChosen[await this.$.query({query:tn.SelectPowerToGain,items:h.notChosen,actionIds:h.notChosen,players:[this]})],ae(h.notChosen,l),c)for(const e of h.notChosen)await this.$.discardPowerToDeckDiscard(e)}if(null!=l){const a=await this.gainPower(l);bd[l].type!==o.Major||t||e!==f-1||await this.$.addSubEffect({text:"After you gain a Major Power, you must Forget one of your Power Cards.",[r.Now]:async()=>{const e=await this.forgetPowers({optional:n,duringPowerGain:!0});h.forgotten.push(...e)}}),h.chosen.push(a)}}return await this.$.doEffects(r.AfterGainingPowers,{spirit:this,powerGain:h}),h}async gainTime(e){await this.addPresence({amount:e,locations:g.Time})}async gainTimeUpTo(e){await this.$.chooseBetween({text:"Gain how much Time?",effects:[...Array(e+1).keys()].map((e=>({actionId:`Gain${e}Time`,text:`Gain ${e} Time.`,label:`${e}`,[r.Now]:async()=>{await this.addPresence({amount:e,locations:g.Time})}})))})}async givePower(e){const a=e.owner;ae(a.powers,e),!a.rememberedUniques.includes(e.power)&&e.isA(ye.Unique)&&a.rememberedUniques.push(e.power),this.powers.push(e),await this.$.sendEvent({type:T.PowerCardGiven,source:a,destination:this,power:e})}async grow(e){const a=this.growthOptions[e];if(a.cost&&!this.hasPaidForGrowthOption(a)&&await this.payEnergy(a.cost),this.growthStatus[e]=Of.Chosen,mu(this,"growthOptions"),await this.$.sendEvent({type:T.Grow,spirit:this,option:a.option,subOption:a.subOption,text:a.effect.text}),await this.$.doSpiritAction((()=>this.$.addEffect({name:`Growth ${a.option+1}`,spirit:this,players:[this],...a.effect})),{spirit:this}),void 0!==this.unfinishedGrowthOption)this.growthOptions.forEach((({option:e,status:t},n)=>{e!==a.option&&t===Of.Available&&(this.growthStatus[n]=Of.NotChosen)}));else{this.growthOptions.forEach((({option:e,status:a},t)=>{if(a===Of.NotChosen||a===Of.Available){const a=this.pickOptions.filter((a=>a.includes(e)));if(a.length>0){a[0].filter((e=>this.chosenGrowthOption[e])).length<a.length?this.growthStatus[t]=Of.Available:this.growthStatus[t]=Of.NotChosen}}}));this.growthOptionGroups[a.option].oncePerGame&&this.growthOptions.filter((e=>e.option===a.option)).forEach((e=>{this.growthStatus[e.index]=Of.Unavailable}))}mu(this,"growthOptions")}hasAtLeastNonBlessed(e,a){return on(this.powers,(e=>e.isA(a)&&!e.isBlessed&&!e.assisted))>=e}hasElements(e,a=!1){if(this.$.currentActionHasAllThresholds)return!0;const t=this.elementsTreatedAsElements(e);if(this.$.action.power?.assisted)return Pd(Object.values(t))<=10;if(a)return this.hasElementsWithConvert(t);const n=this.elements;return!Object.keys(t).some((e=>n[e]<t[e]))}hasElementsWithConvert(e,a){const t=this.elements,n=this.elementsTreatedAsElements(e),r=void 0!==a?this.elementsTreatedAsElements(a):void 0,s=wp(n,t,this.preparedElementsForGainingElements,r??{});for(const e of[i.SunOrMoon,i.WaterOrAnimal,i.FireOrPlant])1===t[e]&&Uf[e].elements.some((e=>(s[e]??0)>0&&(s[e]-=1,!0)));return Pd(Object.values(s))<=t[i.Any]}hasPaidForGrowthOption(e){return this.growthOptions.some((a=>a.option===e.option&&a.status===Of.Chosen))}hasPieceInLands(e){return this.pieces.some((a=>a.isA(e)))}hasPower(e){return this.powers.some((a=>a.power===e))}hasUncovered(e){return this.trackStatus[e]!==fc.Covered}inCorners(){return wu.createCollection(this.$,this.corners)}inCornersWhere(e){return this.inCorners().where(e)}inLands(){return An.createCollection(this.$,this.lands)}inLandsWhere(e){return this.inLands().where(e)}inLandsWith(e){return this.inLands().where((a=>a.has(e)))}inLandsWithAllOf(...e){return this.inLands().where((a=>a.hasAllOf(...e)))}inLandsWithinRange(e,a){const t=new Set;return this.lands.forEach((n=>{n.landsWithin(e,this).forEach((e=>{(void 0===a||a(e))&&t.add(e)}))})),An.createCollection(this.$,Array.from(t))}inSacredSites(){return this.inLandsWhere((e=>e.hasSacredSiteOf(this)))}invalidateEffectElementCache(){mu(this,"elementsFromEffects","elements")}invalidatePowerElementCache(){mu(this,"elementsFromPowers","elements")}async loseEnergy(e){const a=Math.min(this.innateEnergy,e);a>0&&(this.innateEnergy-=a,await this.$.sendEvent({type:T.EnergyLost,spirit:this,amount:a}))}maxElementsWithConvert(e){const a=this.elements;return a[e]+this.preparedElementsForGainingElements[e]+[i.SunOrMoon,i.WaterOrAnimal,i.FireOrPlant].filter((t=>1===a[t]&&Uf[t].elements.some((a=>a===e)))).length+a[i.Any]}async mayReclaimPowerCardInsteadOfDiscarding(e){await this.$.addSubEffectUntilEndOfTurn({[r.GlobalReminder]:()=>({power:e.power,players:[this]}),[r.AtTimePassesBegin]:()=>this.powersWhere((e=>e.isA(ye.AnyCard)&&e.isInPlay&&!e.isBlessed)).optionallyPickOne((e=>e.reclaim()),{noOptions:`${this.nameLink} has no Powers in play.`,card:e.power,players:[this]})})}async movePresence(e){const a=[];return await this.presence().pickOne((async t=>{a.push(...await t.move({amount:1,pieces:this.$.Presence,owner:this,locations:{target:g.WithinRange,range:e,spirit:this}}))}),{prompt:"Pick <presence> to move."}),a}numberOfAbsorbedPresenceOf(e){return this.absorbedPresence.filter((a=>a===e.spiritNumber)).length}numberOfElementCombos(e){const a=this.elementsTreatedAsElements(e),t=Object.keys(a),n={...this.elements};let r=0;for(;!t.some((e=>n[e]<a[e]));)r+=1,t.forEach((e=>{n[e]-=a[e]}));return r}numberOfPiecesInLands(e){return this.pieces.filter((a=>a.isA(e))).length}async payEnergy(e){if(e>0){if(await this.$.doEffects(r.BeforePayEnergy,{spirit:this,amount:e}),this.innateEnergy<e)throw new Error("Not enough energy to pay for amount.");this.innateEnergy-=e,await this.$.sendEvent({type:T.EnergyLost,spirit:this,amount:e})}}async playAPowerCardByPayingItsCost(e=(()=>!0)){await this.powersWhere((a=>e(a)&&a.isPlayable)).optionallyPickOne((async e=>{await e.play({withoutUsingCardPlays:!0})}),{players:[this],noOptions:`${this.nameLink} has no Power Cards in hand that can be played.`})}async playInnates(){for(const e of this.innatePowers)await e.play()}async possiblyDowngradeElements(e){const a=e.status===Kn.PlayedFast?d.Fast:d.Slow,t=e.data,n=new Set;for(const e of t.effects)if(void 0!==e.threshold&&!e.noConvertToThreshold&&this.hasElementsWithConvert(e.threshold))for(const a of Object.keys(e.threshold))n.add(a);const i=Array.from(n),s={skip:!1},o={};for(;!s.skip&&(t.mayAlwaysDowngrade||t.effects.filter((e=>void 0!==e.threshold&&!e.noConvertToThreshold&&this.hasElementsWithConvert(e.threshold))).length>1)&&i.some((e=>this.elements[e]>0));){const n=i.filter((e=>this.elements[e]>0)).map((e=>({actionId:e,text:`${Uf[e].text}`,[r.Now]:async()=>{this.$.removeEffectsWithName(pe.Downgrade),o[e]=(o[e]??0)-1,await this.gainElementsUntilEndOfAction(o,!0)},condition:()=>t.effects.filter((a=>{if(void 0===a.threshold||a.dontResolveAlone)return!1;const t={...a.threshold,[e]:(a.threshold[e]??0)+1};return this.hasElementsWithConvert(t)})).length>0&&!t.mayBeSpeed?.noDowngrade?.({speed:a,element:e,spirit:this})})));n.push({actionId:"SkipDowngrade",text:"Continue",[r.Now]:()=>(s.skip=!0,Promise.resolve()),condition:()=>!0});const d={};i.forEach((e=>{d[e]=this.elements[e]})),await this.$.chooseBetween({text:`Resolve Power as if you had fewer elements?<br><br>${pp(d)}`,prompt:"Choose element to downgrade<or>Continue:",name:t.name,card:e.power,effects:n,autoPlayOneOption:!0,highlightPowers:[e],players:[this]})}}powersWhere(e){return Zn.createCollection(this.$,this.powers.filter(e))}async prepareElement(e=[...qn]){await this.$.chooseBetween({prompt:"Select Element to Prepare.",effects:e.map((e=>({actionId:e,text:`${Uf[e].text}`,[r.Now]:()=>(this.preparedElements[e]+=1,Promise.resolve())})))})}presence(){return this.forPiecesWhere((e=>e.isPresence&&e.owner===this))}preventAddPresence(e,a){return this.$.someEffect(r.PreventAddPresence,{spirit:this,location:e,ignoreLandType:a})}reclaim(e){return this.reclaimCards({amount:e})}async reclaimCards(e={}){const{amount:a,filter:t=(e=>e.isInDiscard),optional:n=!1}=e,r=this.powersWhere((e=>e.isA(ye.AnyCard)&&t(e)&&!e.isBlessed)),i=[];return await r.pickMultiple({amount:a??r.count,forPickedItem:async e=>{i.push(e),await e.reclaim()},optional:n,autoplayIfPickingAll:!n,effect:{autoPlayOneOption:!0,prompt:"Pick a Power Card to Reclaim."}}),i}removeLand(e){ae(this.landsIncludingNonExisting,e)}async removePresenceFromTrack(e){this.setTrackStatusForIndex(fc.Uncovered,e),await this.$.sendEvent({type:T.TrackUncovered,spirit:this,trackSpot:this.data.tracks[e]}),void 0!==this.data.tracks[e].uncoverEffect&&await this.$.addEffect({spirit:this,...this.data.tracks[e].uncoverEffect}),await this.$.doEffects(r.AfterUncoveringTrack,{spirit:this,trackIndex:e})}async replacePower(e,a){const t=this.powers.findIndex((a=>a.power===e));t>=0&&await this.forgetPowerState(this.powers[t],{canRegain:!1,silent:!0}),await this.gainPower(a.withPower,{silent:!0,index:t})}resolvableCardsWithSpeed(e,a=!1){return e===d.Slow&&this.$.preventSlowPowers?[]:this.powers.filter((t=>{if(void 0!==t.data.mayUse&&!t.data.mayUse({$:this.$,power:t,spirit:this}))return!1;let n=t.status===(e===d.Fast?Kn.PlayedFast:Kn.PlayedSlow),i=t.status===(e===d.Fast?Kn.PlayedSlow:Kn.PlayedFast);return a&&(n=e===d.Fast?t.isFast:t.isSlow,i=e===d.Fast?t.isSlow:t.isFast),!!(n||i&&t.mayChangeSpeed&&!t.assisted||!a&&!t.assisted&&this.$.someEffect(r.MayRepeatPowercard,{power:t,speed:e}))&&!!t.ownerHasEnoughElementsToCastPower}))}async resolvePowerInLocations(e,a,t=!1,n=!1,i=void 0){const s=e.data;if(!n)for(let t=0;t<a.length;t+=1){const n=a[t];for(;void 0!==bd[e.power].payForRange&&!e.validLandTargets({targetIndex:t,ignorePowerModifiesRange:!0}).has(n);)await bd[e.power].payForRange({$:this.$,spirit:this})}await this.$.doEffects(r.AfterTargetingLands,{power:e,isRepeat:t,lands:a,owner:this});const o=await e.maximizedThresholdsForPower(c.Land,a[0]),d=mn(o,(e=>void 0!==e.threshold&&this.hasElements(e.threshold))),l=d>=0?o[d].threshold:void 0;await this.$.sendEvent({type:T.PowerResolvedInLands,spirit:this,power:e,targetLands:a,threshold:l});for(const n of o)await e.fulfillsThreshold(n,a[0],c.Land)&&(await this.$.addEffect({name:s.name,effects:[n],card:e.power,highlightPowers:[e],highlightLocations:a,players:[this],spirit:this}),await this.$.doEffectsWithContext(r.InTargetLand,{power:e,land:a[0],lands:a,owner:this,isRepeat:t,origin:i},(a=>a.card===e.power)));await this.$.doEffects(r.AfterResolvingLandTargetingPower,{power:e,isRepeat:t})}async resolvePowerOnSpirit(e,a,t=!1){const n=e.data,i=await e.maximizedThresholdsForPower(c.Spirit,a),s=mn(i,(e=>void 0!==e.threshold&&this.hasElements(e.threshold))),o=s>=0?i[s].threshold:void 0;await this.$.sendEvent({type:T.PowerResolvedOnSpirit,spirit:this,power:e,targetSpirit:a,threshold:o});for(const s of i)await e.fulfillsThreshold(s,a,c.Spirit)&&(await this.$.addEffect({name:n.name,effects:[s],spirit:this,players:[this],card:e.power,highlightPowers:[e]}),await this.$.doEffectsWithContext(r.TargetSpirit,{power:e,spirit:a,owner:this,isRepeat:t},(a=>a.card===e.power)))}async returnPresenceToTracks(e,a={}){await te(e,(async()=>{const e=this.validTrackSpotsToReturnPresence;if(e.length>0&&(!a.time||this.time>0)&&(!a.destroyed||this.destroyedPresence>0)){const t=await this.$.query({query:tn.SelectTrack,prompt:"Select track spot to return to",players:[this],spirit:this,items:e,actionIds:e.map((e=>`TrackSpot-${e}`)),optional:a.optional});null!==t&&(this.setTrackStatusForIndex(fc.Covered,e[t]),a.time?this.time-=1:a.destroyed&&(this.destroyedPresence-=1))}else a.time&&(this.time-=1,this.destroyedPresence+=1),await this.$.clickToContinue({noOptions:"No valid track spot to return to."})}))}async scoreFromPowers(){for(const e of this.powerCardsInPlay){const a=(e.data.energy||0)+2;this.score+=a,await this.$.sendEvent({type:T.ScoreFromPower,score:a,power:e})}for(const e of this.innatePowers){const a=e.estimatedValueOfPower;this.score+=Pd(a),await this.$.sendEvent({type:T.ScoreFromInnate,scores:a,power:e})}}async selectBetweenGrowthOptions(e,a){if(this.growthStatus[e]===Of.Unavailable||this.growthStatus[a]===Of.Unavailable)return;this.growthStatus[e]=Of.Available,this.growthStatus[a]=Of.Available;const t=this.growthOptions,n=[t[e],t[a]],r=t[0===await this.$.query({name:"Growths Begets Growth",text:"Pick unlock option",query:tn.SelectGrowthOption,items:n,actionIds:n.map((e=>`Growth-${e.spirit.spirit}-${e.option}-${e.subOption}`)),players:[this]})?e:a];this.growthStatus[e]=Of.Inactive,this.growthStatus[a]=Of.Inactive,await this.$.addEffect({...r.effect,spirit:this,players:[this]}),mu(this,"growthOptions")}async setup(){const{data:e}=this;this.setTrackStatus(e.tracks.map((e=>void 0!==e.requires||void 0!==e.requiresAll||void 0!==e.requiresAny||e.covered?fc.Covered:fc.Uncovered))),this.trackElements=e.tracks.map((()=>null)),this.growthStatus=this.growthOptions.map((()=>Of.Available)),await this.$.sendEvent({type:T.SetupSpirit,spirit:this});for(const a of e.uniquePowers)await this.gainPower(a);for(const a of e.innatePowers)await this.gainPower(a);for(const a of e.specialRules)await this.doSpiritAction((()=>this.$.addEffect({...a,card:e.innatePowers[0],spirit:this,players:[this]})));if(this.aspect)for(const a of gp[this.aspect].effects)await this.doSpiritAction((()=>this.$.addEffect({...a,card:e.innatePowers[0],spirit:this,players:[this]})));mu(this,"growthOptions")}async setupPresence(){const{data:e,name:a}=this;await this.$.oneEffectActivates(r.AdjustSetupPresence,{spirit:this})||await this.$.addEffect({name:`${a}: Setup`,effects:e.setup,spirit:this,players:[this]})}async spendTime(e){if(this.time<e)throw new Error("Not enough time to pay for amount.");await this.returnPresenceToTracks(e,{time:!0}),await this.$.sendEvent({type:T.TimeLost,spirit:this,amount:e})}async targetAndResolvePower(e,a=!1){await this.doPowerAction((async()=>{const t=e.data;if(e.status===Kn.ResolvedFast||e.status===Kn.ResolvedSlow){const t=e.status===Kn.ResolvedFast?d.Fast:d.Slow,n=this.$.firstEffectOfType(r.MayRepeatPowercard,{power:e,speed:t});n&&(await this.$.doEffect(n,r.RepeatPowerCard,{power:e,speed:t}),a=!0)}if(t.type===o.Innate&&(await this.$.doEffects(r.BeforeResolvingInnate,{power:e}),await this.possiblyDowngradeElements(e)),t.target===c.Land)await this.$.addEffect({name:t.name,text:a?"Repeat this Power":"Pick Target Land",card:e.power,highlightPowers:[e],players:[this],[r.Now]:async()=>{t.blightWhiteListedPower&&this.$.startAllowOceanForBlight();const n=e.data.specifyOrigin?await e.pickValidOriginTarget():void 0,i=void 0!==e.data.ranges?e.data.ranges.length:1,s=[];for(let o=0;o<i;o+=1){const d=this.$.action.data.mustTargetAdjacent,c=e.validLandTargets({targetIndex:o,origin:n,mustTargetAdjacent:d}).where((e=>!s.includes(e)));let l=a?"Repeat this Power":"Pick Target Land";i>1&&(l+=` at <range-${e.data.ranges[o]}>`),d&&(l+=" adjacent to Source"),await c.pickOne((async a=>{s.push(a),await this.$.doEffects(r.AfterTargetingLand,{targetIndex:o,power:e,land:a,owner:this})}),{text:l,noOptions:`No valid Target Lands for ${t.name}.`})}this.$.stopAllowOceanForBlight(),s.length>0&&await this.resolvePowerInLocations(e,s,a,!1,null!==n?n:void 0)}});else{const n=e.validSpiritTargets();await this.$.addEffect({name:t.name,text:"Pick Target Spirit",card:e.power,highlightPowers:[e],players:[this],[r.Now]:async()=>{await n.autoPickOne((async t=>{if(this!==t&&this.$.config.archipelagos){const e=this.boardDistanceToSpirit(t);null!==e&&e>0&&(await this.$.sendEvent({type:T.TargetedAcrossIslets,spirit:this,targetSpirit:t,distance:e}),await this.payEnergy(e))}await this.resolvePowerOnSpirit(e,t,a)}),{noOptions:`No valid Target Spirits for ${t.name}.`})}})}await e.setStatus(e.status===Kn.PlayedFast?Kn.ResolvedFast:Kn.ResolvedSlow)}),e)}async timePasses(){this.growthStatus=this.growthStatus.map((e=>e===Of.Chosen||e===Of.NotChosen?Of.Available:e)),this.setTrackStatus(this.trackStatus.map((e=>e===fc.UncoveredPlayed?fc.Uncovered:e))),this.hasPlayedPowers=!1,this.cardsPlayedThisTurn=[],this.usedCardPlaysForNonDamageAndDestroy=0,this.cardsMadeImpendingThisTurn=[];for(const e of this.powers)await e.timePasses();this.hasReclaimedACardDuringSpiritPhase=!1,mu(this,"growthOptions")}toString(){return Ic({[Kf[this.spirit].name]:Ic({aspect:null!==this.aspect?gp[this.aspect].name:"None",cards:dn(this.powers,(e=>`${e.power}[${e.status}]`)),energy:this.energy},4)},3)}trackPlacementIsValidGivenIndexIsCovered(e){const a=this.trackStatus.filter(((a,t)=>a!==fc.Covered&&t!==e)).length,t=this.data.tracks.map((e=>void 0===e.requires&&void 0===e.requiresAny&&void 0===e.requiresAll));for(;t.filter((e=>!0===e)).length<a;){let a=!1;if(this.data.tracks.forEach(((n,r)=>{t[r]||r===e||this.trackStatus[r]===fc.Covered||void 0!==n.requires&&!t[n.requires]||void 0!==n.requiresAll&&n.requiresAll.some((e=>!t[e]))||void 0!==n.requiresAny&&!n.requiresAny.some((e=>t[e]))||(t[r]=!0,a=!0)})),!a)return!1}return!0}async yourSacredSitesMayAlsoCountAs(e){await this.$.addSubEffect({[r.GlobalReminder]:()=>({icon:`<sacred><br>= ${ee[e].text}`,ongoing:!0,spirit:this,players:[this]}),[r.MoveWithoutWaiting]:({piece:e,source:a,pieceFilter:t})=>e.isAPresenceOf(this)&&a.numberOfPresenceOf(this)>=2&&!ee[t].pieces.includes(p.Presence),[r.AfterMoving]:async({piece:e,source:a,destination:t,pieceFilter:n,movement:r})=>{e.isAPresenceOf(this)&&!ee[n].pieces.includes(p.Presence)&&await a.move({pieces:this.$.Presence,locations:{target:g.ToThisLocation,location:t},owner:this,movement:r})},[r.AfterRemovePiece]:async({piece:e,location:a,removement:t,pieceFilter:n})=>{e.isAPresenceOf(this)&&!ee[n].pieces.includes(p.Presence)&&await a.remove({owner:this,pieces:this.$.Presence,removement:t})}})}get chosenGrowthOption(){return W(this.growthOptions.map((({option:e})=>e))).map((e=>this.growthOptions.some((({status:a,option:t})=>e===t&&a===Of.Chosen))))}get energyDebt(){return this.$.sumEffects(r.EnergyDebt,{spirit:this})}get extraCardDrawAmount(){return this.$.sumEffects(r.ExtraCardDrawAmount,{spirit:this})}get extraCardKeepAmount(){return this.$.sumEffects(r.ExtraCardKeepAmount,{spirit:this})}get mayTreatElementsAsOther(){return this.aspect===ln.DarkFire}get unfinishedGrowthOption(){return this.growthOptions.find((e=>e.status===Of.Chosen&&this.growthOptions.some((a=>e!==a&&e.option===a.option&&a.status===Of.Available))))?.option}async gainPowerCardBuffs(e,a={}){const{discardAfter:t=!0,withoutForgetting:n=!1,forgetOptional:i=!1}=a;for(const a of e)await this.addExtraAction({actionId:`Gain${a}`,name:bd[a].name,required:!0,icon:"",text:"Gain this power card.",power:a,previewPowers:()=>({powers:e,selected:[e.indexOf(a)]}),enabled:()=>this.$.phase===Xe.Grow,onActivate:async()=>{for(const a of e)this.$.removeEffectsWithName(bd[a].name);const s=e.filter((e=>e!==a)),d={chosen:[],notChosen:s,forgotten:[],gifted:!1,taken:!1};if(t)for(const e of s)await this.$.discardPowerToDeckDiscard(e);this.destinyPowers.includes(a)&&ae(this.destinyPowers,a);const c=await this.gainPower(a);bd[a].type!==o.Major||n||await this.$.addSubEffect({text:"After you gain a Major Power, you must Forget one of your Power Cards.",[r.Now]:async()=>{const e=await this.forgetPowers({optional:i,duringPowerGain:!0});d.forgotten.push(...e)}}),d.chosen.push(c),await this.$.doEffects(r.AfterGainingPowers,{spirit:this,powerGain:d})}})}setTrackStatus(e){this.trackStatusInternal=e,mu(this,"elementsFromTracks","elements")}setTrackStatusForIndex(e,a){this.trackStatusInternal=this.trackStatusInternal.map(((t,n)=>n===a?e:t)),mu(this,"elementsFromTracks","elements")}}yp([C.sH],mp.prototype,"absorbedPresence",void 0),yp([C.sH],mp.prototype,"aspect",void 0),yp([C.sH],mp.prototype,"cardsMadeImpendingThisTurn",void 0),yp([C.sH],mp.prototype,"cardsPlayedThisTurn",void 0),yp([C.sH],mp.prototype,"daysPowers",void 0),yp([C.sH],mp.prototype,"destinyPowers",void 0),yp([C.sH],mp.prototype,"destroyedIncarna",void 0),yp([C.sH],mp.prototype,"destroyedPresence",void 0),yp([C.sH],mp.prototype,"didNotWantToReachThreshold",void 0),yp([C.sH],mp.prototype,"disabledGrowthOptions",void 0),yp([C.sH],mp.prototype,"growthStatus",void 0),yp([C.sH],mp.prototype,"hasEmpoweredIncarna",void 0),yp([C.sH],mp.prototype,"hasPlayedPowers",void 0),yp([C.sH],mp.prototype,"hasReclaimedACardDuringSpiritPhase",void 0),yp([C.sH],mp.prototype,"healingCards",void 0),yp([C.sH],mp.prototype,"healingMarkers",void 0),yp([C.sH],mp.prototype,"innateEnergy",void 0),yp([C.sH],mp.prototype,"landsIncludingNonExisting",void 0),yp([C.sH],mp.prototype,"panelPieces",void 0),yp([C.sH],mp.prototype,"powers",void 0),yp([C.sH],mp.prototype,"powersInProgressionDeck",void 0),yp([C.sH],mp.prototype,"preparedElements",void 0),yp([C.sH],mp.prototype,"rememberedUniques",void 0),yp([C.sH],mp.prototype,"spirit",void 0),yp([C.sH],mp.prototype,"spiritNumber",void 0),yp([C.sH],mp.prototype,"startingBoardIndex",void 0),yp([C.sH],mp.prototype,"time",void 0),yp([C.sH],mp.prototype,"trackElements",void 0),yp([C.sH],mp.prototype,"usedCardPlaysForNonDamageAndDestroy",void 0),yp([C.sH],mp.prototype,"trackStatusInternal",void 0),yp([C.EW],mp.prototype,"cardPlaysCostToPlayPowerCard",null),yp([yu()],mp.prototype,"elements",null),yp([yu()],mp.prototype,"elementsFromEffects",null),yp([yu()],mp.prototype,"elementsFromPowers",null),yp([yu()],mp.prototype,"elementsFromTracks",null),yp([C.EW],mp.prototype,"extraPresenceAvailableForTargeting",null),yp([C.EW],mp.prototype,"growthOptionGroups",null),yp([yu()],mp.prototype,"growthOptions",null),yp([C.EW],mp.prototype,"pickOptions",null);class vp{spiritCount;spirits;$;constructor(e){this.$=e,this.spirits=[],this.spiritCount=0,this.$.config.boards.forEach(((e,a)=>{e.spirit&&(this.spirits.push(new mp({$:this.$,spiritNumber:this.spiritCount,spirit:e.spirit.spirit,aspect:e.spirit.aspect,boardIndex:a,progression:e.spirit.progression})),this.spiritCount+=1)}))}get adjustedCardPlays(){return this.$.sumEffects(r.AdjustCardPlays)}get allSpiritsHavePlayedPowers(){return!this.spirits.some((e=>!e.hasPlayedPowers))}get availableExtraActions(){const e=[];for(const a of this.$.effectsOfType(r.ExtraAction)){const t=a[r.ExtraAction]?.({effect:a});t&&e.push({effect:t,spirit:a.spirit,extraIndex:this.$.globalReminders.findIndex((e=>e.id===a.id))})}return e}get availableGrowthOptions(){return this.growthOptions.filter((e=>e.status===Of.Available&&e.spirit.canAffordGrowthOption(e)))}get availablePowersForPlay(){const e=[];return this.spirits.forEach((a=>{e.push(...a.availablePowersForPlay)})),e}get availableTrackActions(){return this.trackActions.filter((({status:e})=>e===fc.Uncovered))}get growthOptions(){const e=[];return this.spirits.forEach((a=>{e.push(...a.growthOptions)})),e}get growthStatus(){const e=[];return this.spirits.forEach((a=>{e.push(...a.growthStatus)})),e}get playersCanJointlyPayEnergyAidedBy(){return e=>this.spareEnergyWhenJointlyPayEnergyAidedBy(e)>=0}get powerCardsPlayedThisTurn(){const e=[];return this.spirits.forEach((a=>{e.push(...a.cardsPlayedThisTurn)})),e}get requiredExtraActions(){return this.availableExtraActions.filter((e=>e.effect.required))}get resolvablePowers(){return(e,a=!1)=>{const t=[];return this.spirits.forEach((n=>{t.push(...n.resolvableCardsWithSpeed(e,a))})),t}}get spiritsWithAvailablePowersForPlay(){return this.spirits.filter((e=>!e.hasPlayedPowers))}get spiritsWithExtraActions(){const e=this.availableExtraActions;return this.spirits.filter((a=>e.some((({effect:e})=>void 0===e.players||e.players?.includes(a)))))}get trackActions(){const e=[];return this.spirits.forEach((a=>{e.push(...a.trackActions)})),e}async eachSpirit(e){for(const a of this.spirits)await this.$.addSubEffect({players:[a],[r.Now]:async()=>{await e(a)}})}fromAllSpirits(){return mp.createCollection(this.$,this.spirits)}async gainDamageBoost(e){const{amount:a,once:t=!1,source:n,permanent:i=!1,spirit:s,scenario:o,filter:d,effectId:c}=e,l=C.sH.box(0);await this.$.addSubEffect({effectId:c,expireAtEndOfTurn:!i,[r.GlobalReminder]:()=>({icon:`+${a} <damage><br>${l}/${a}`,ongoing:i,spirit:n,scenario:o,players:void 0!==s?[s]:void 0}),[r.DamageBoost]:async e=>{const n=this.$.currentStackEffect;for(;l.get()<a&&(e.spirit===s||void 0===s)&&a>0&&(void 0===d||d())&&await e.onUse();)l.set(l.get()+1);l.get()>0&&await this.$.addEffectUntilEndOfAction({[r.ActionEnds]:()=>(t?this.$.removeEffect(n):l.set(0),Promise.resolve())})}})}async gainEnergyDividedEvenly(e){const a=Math.floor(e/this.spiritCount),t=e-a*this.spiritCount,n=this.fromAllSpirits();await n.pickMultiple({amount:t,forPickedItem:async e=>{n.remove(e),await e.gainEnergy(a+1)},effect:{prompt:`Pick spirit to gain ${a} energy.`}}),await n.forEach((async e=>{await e.gainEnergy(a)}))}async gainEnergyFromTracks(){await this.eachSpirit((async e=>{await e.gainEnergyFromTracks()}))}async growAndPlayTrackActions(){for(;;){const e=this.availableGrowthOptions;if(!(e.length>0||this.requiredExtraActions.length>0)||this.$.gameEnded)break;let a=this.availableTrackActions;const t=this.availableExtraActions,n=await this.$.query({name:"Grow",text:e.length>0?"Pick Growth Option":"Pick Power Card",query:tn.SelectGrowthOption,items:[...e,...a,...t],actionIds:[...e.map((e=>`Growth-${e.spirit.spirit}-${e.option}-${e.subOption}`)),...a.map((e=>`TrackAction-${e.spirit.spirit}-${e.effect.actionId}`)),...t.map((e=>`ExtraAction-${void 0!==e.spirit?e.spirit.spirit:"Global"}-${e.effect.actionId}`))],players:this.spiritsWithGrowthOptions(t)});if(n<e.length){const a=e[n];await a.spirit.grow(a.index)}else if(a=this.availableTrackActions,n<e.length+a.length){const t=a[n-e.length];await t.spirit.doTrackAction(t.trackIndex)}else{const r=t[n-e.length-a.length];await this.$.doExtraAction(r)}}}async payEnergyJointlyAidedBy(e){const{energy:a,element:t,aidedByRemovingDisease:n}=e;let s=0;if(n)for(;!this.$.playersCanJointlyPayEnergyAidedBy({energy:a-3*s,aidedByRemovingDisease:!1});)s+=1;const o={amount:this.spareEnergyWhenJointlyPayEnergyAidedBy(e)};if(1===this.$.spiritCount&&void 0===t&&!n)return void await this.$.spirits[0].payEnergy(a);const d={amount:0};for(const e of this.spirits)if(t){const a=e.elementTreatedAsElement(t);d.amount+=e.elements[a]}if(t&&(d.amount+=2*(this.$.landElements[t]??0)),d.amount>=a){let e="Jointly pay Energy";void 0!==t&&(e+=` aided by ${Uf[t].text}.`),e+=`<br>Paid: ${a} / ${a}.`,await this.$.clickToContinue({text:e})}n&&(s>0&&await this.$.forPiecesThatIs(this.$.Disease).pickMultiple({effect:{text:"Remove <disease> from the island for 3 Energy. (required)"},forPickedItem:async e=>{await e.remove(),d.amount+=3}}),await this.$.forPiecesThatIs(this.$.Disease).pickMultiple({effect:{text:"Remove <disease> from the island for 3 Energy each? (optional)"},optional:!0,forPickedItem:async e=>{await e.remove(),d.amount+=3}}));const c=[];for(;d.amount<a;){const e=[];for(const a of this.spirits)if(a.energy>0&&e.push({actionId:`${a.spirit}-PayEnergy`,text:"Pay 1 Energy. (+1)",category:Su.PayEnergy,spirit:a,[r.Now]:async()=>{d.amount+=1,await a.payEnergy(1)}}),void 0!==t){const n=a.elementTreatedAsElement(t);a.elements[n]<a.maxElementsWithConvert(n)&&e.push({actionId:`${a.spirit}-Convert`,text:`Convert to ${Uf[n].text}`,category:Su.ConvertElements,spirit:a,[r.Now]:async()=>{d.amount+=1,await a.convertElements({[n]:a.elements[n]+1})}});const s=n===i.DarkFire?[i.Moon,i.Fire]:[n],l=a.powersWhere((e=>e.isInHand&&!e.assisted&&(s.some((a=>e.data.elements?.includes(a)))||e.power===_e.ElementalBoon)&&!c.includes(e)&&o.amount>=(e.isInPlay&&e.power!==_e.ElementalBoon?1:2)));l.count>0&&e.push({actionId:`${a.spirit}-Discard`,text:"Discard Power from Hand. (+2)",players:[a],category:Su.DiscardPowerFromHand,spirit:a,[r.Now]:async()=>{await l.pickOne((async e=>{d.amount+=2,c.push(e),await e.discard(),o.amount-=e.isInPlay&&e.power!==_e.ElementalBoon?1:2}))}});const h=a.powersWhere((e=>(s.some((a=>e.data.elements?.includes(a)))||e.power===_e.ElementalBoon)&&!e.isBlessed&&!e.assisted&&!c.includes(e)));h.count>0&&e.push({actionId:`${a.spirit}-Forget`,text:"Forget a Power. (+3-4)",players:[a],category:Su.ForgetPower,spirit:a,[r.Now]:async()=>{await h.pickOne((async e=>{d.amount+=e.isInPlay&&e.power!==_e.ElementalBoon?3:4,c.push(e),await e.forget()}))}})}let n="Jointly pay Energy";if(void 0!==t&&(n+=` aided by ${Uf[t].text}.`),n+=`<br>Paid: ${d.amount} / ${a}.`,0===e.length)throw new Error("No valid pay option.");await this.$.chooseBetween({text:n,effects:e},{orChoice:!1,payJointly:!0})}}async playDraftActions(e,a){for(;!this.$.gameEnded;){const t=this.availableExtraActions;if(0===t.length)break;const n=await this.$.query({name:"Drafting",prompt:a(),text:e(),query:tn.SelectGrowthOption,items:[...t],actionIds:[...t.map((e=>`ExtraAction-${void 0!==e.spirit?e.spirit.spirit:"Global"}-${e.effect.actionId}`))],players:this.spiritsWithExtraActions}),r=t[n];await this.$.doExtraAction(r)}}async playPowers(){for(;;){const e=this.availablePowersForPlay;if(0===e.length)break;const a=await this.$.query({name:"Play Powers",text:"Play Powers",query:tn.PlayPower,players:this.spiritsWithAvailablePowersForPlay,items:e,actionIds:e.map((e=>`${e.spirit.spirit}-${void 0===e.power?"Finish":e.power.power}`))});if(null===a)break;{const t=e[a];t.power?(t.spirit.hasPlayedPowers=!1,await t.power.play()):t.spirit.hasPlayedPowers=!0}}for(const e of this.spirits)await e.playInnates()}async playTrackActions(){for(;!this.$.gameEnded;){const e=this.availableExtraActions,a=this.availableTrackActions,t=a.length+e.length;if(0===t)break;const n=await this.$.queryOptional({name:"Spirit actions",text:"Pick Spirit action.",cancel:`Skip remaining Spirit action${t>1?"s":""}.`,query:tn.SelectGrowthOption,items:[...a,...e],actionIds:[...a.map((e=>`TrackAction-${e.spirit.spirit}-${e.effect.actionId}`)),...e.map((e=>`ExtraAction-${void 0!==e.spirit?e.spirit.spirit:"Global"}-${e.effect.actionId}`))],players:this.spiritsWithGrowthOptions(e)});if(null===n)break;if(n<a.length){const e=a[n];await e.spirit.doTrackAction(e.trackIndex)}else{const t=e[n-a.length];await this.$.doExtraAction(t)}}}powersWhere(e){const a=[];for(const t of this.spirits)a.push(...t.powers.filter(e));return Zn.createCollection(this.$,a)}async resolvePowers(e){for(;!this.$.gameEnded&&(void 0===this.$.resolvableCardsLeft||this.$.resolvableCardsLeft>0);){const a=this.resolvablePowers(e),t=this.availableExtraActions,n=a.length+t.length;if(0===n)break;const r=await this.$.queryOptional({name:(e===d.Fast?"Fast":"Slow")+" Powers",text:"Select power to resolve",cancel:"Skip remaining "+(n>1?"powers":"power"),query:tn.SelectPower,items:[...a,...t],actionIds:[...a.map((e=>`${e.owner.spirit}-${e.power}`)),...t.map((e=>`Extra-${e.effect.actionId}`))],players:this.spiritsWithResolvablePowersOActions(e,t)});if(null===r)return;if(r<a.length){const t=a[r];await t.changeSpeedIfNeeded(e),await t.owner.targetAndResolvePower(t)}else{const e=t[r-a.length];await this.$.doExtraAction(e)}}}async scoreFromPowers(){for(const e of this.spirits)await e.scoreFromPowers()}async setup(){for(const e of this.spirits)await e.setup()}async setupPresence(){for(const e of this.spirits)await e.setupPresence()}spiritsWhich(e){return this.fromAllSpirits().where(e)}spiritsWithGrowthOptions(e){return this.spirits.filter((a=>a.growthOptions.some((({status:e})=>e===Of.Available))||a.trackActions.some((({status:e})=>e===fc.Uncovered))||e.some((({effect:e})=>void 0===e.players||e.players?.includes(a)))))}spiritsWithResolvablePowersOActions(e,a){return this.spirits.filter((t=>t.resolvableCardsWithSpeed(e).length>0||a.some((({effect:e})=>void 0===e.players||e.players.includes(t)))))}async timePasses(){for(const e of this.spirits)await e.timePasses()}toString(){return Ic({spiritCount:this.spiritCount,spirits:this.spirits},2)}get spareEnergyWhenJointlyPayEnergyAidedBy(){return e=>{const{energy:a,element:t,aidedByRemovingDisease:n=!1}=e;let r=0;n&&(r+=3*this.$.forPiecesThatIs(this.$.Disease).count),t&&(r+=2*(this.$.landElements[t]??0));for(const e of this.spirits)if(r+=e.energy,t){const a=e.elementTreatedAsElement(t);r+=e.maxElementsWithConvert(a),r+=4*e.elementsFromHand[a],r+=4*e.elementsFromDiscard[a],r+=3*e.elementsFromNonBlessedPowers[a],e.hasPower(_e.ElementalBoon)&&(r+=4)}return r-a}}}var Ip=function(e,a,t,n){var r,i=arguments.length,s=i<3?a:null===n?n=Object.getOwnPropertyDescriptor(a,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,a,t,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(i<3?r(s):i>3?r(a,t,s):r(a,t))||s);return i>3&&s&&Object.defineProperty(a,t,s),s};class Ap{AllPieces=Z.AllPieces;AllPiecesButDahanPresenceAndSpiritTokens=Z.AllPiecesButDahanPresenceAndSpiritTokens;Badlands=Z.Badlands;BadlandsBeastsDiseaseOrWilds=Z.BadlandsBeastsDiseaseOrWilds;BadlandsOrBeasts=Z.BadlandsOrBeasts;BadlandsOrDisease=Z.BadlandsOrDisease;BadlandsOrStrife=Z.BadlandsOrStrife;Beasts=Z.Beasts;BeastsDiseaseOrWilds=Z.BeastsDiseaseOrWilds;Blight=Z.Blight;BlightExplorerOrTown=Z.BlightExplorerOrTown;City=Z.City;Dahan=Z.Dahan;Deeps=Z.Deeps;Disease=Z.Disease;Explorer=Z.Explorer;ExplorerDahanOrBlight=Z.ExplorerDahanOrBlight;ExplorerOrDahan=Z.ExplorerOrDahan;ExplorerOrTown=Z.ExplorerOrTown;ExplorerTownDahanOrBeasts=Z.ExplorerTownDahanOrBeasts;ExplorerTownOrDahan=Z.ExplorerTownOrDahan;FlameMarker=Z.FlameMarker;HiddenLocation=Z.HiddenLocation;Incarna=Z.Incarna;IncarnaBehemoth=Z.IncarnaBehemoth;IncarnaDarkness=Z.IncarnaDarkness;IncarnaLair=Z.IncarnaLair;IncarnaLocus=Z.IncarnaLocus;IncarnaRoots=Z.IncarnaRoots;IncarnaVoice=Z.IncarnaVoice;IncarnaWarrior=Z.IncarnaWarrior;Invader=Z.Invader;InvaderDahanOrBeast=Z.InvaderDahanOrBeast;InvaderDahanPresenceOrBeast=Z.InvaderDahanPresenceOrBeast;InvaderOrDahan=Z.InvaderOrDahan;Omen=Z.Omen;Presence=Z.Presence;Quake=Z.Quake;Strife=Z.Strife;Thief=Z.Thief;Town=Z.Town;TownCityOrDahan=Z.TownCityOrDahan;TownOrCity=Z.TownOrCity;TownOrDahan=Z.TownOrDahan;TownPresenceOrBeasts=Z.TownPresenceOrBeasts;Vitality=Z.Vitality;WardingPattern=Z.WardingPattern;Wilds=Z.Wilds;blightHandler;logErrors;pieceCount={};config;actionHandler;adminHandler;adversaryHandler;commandBeastHandler;conductor;difficultyCalculator;effectHandler;eventHandler;fearHandler;inquirer;instructionHandler;invaderCardHandler;islandHandler;overrider;powerHandler;randomizer;scenarioHandler;spiritHandler;surveyor;constructor(e,a,t={}){un.makeObservable(this),this.config=a,this.logErrors=t.logErrors??!0,this.randomizer=new uu(a.seed),this.actionHandler=new Bg(this),this.adminHandler=new Cu(this),this.adversaryHandler=new Bu(this),this.blightHandler=new xc(this),this.commandBeastHandler=new ku(this),this.conductor=new Lg(this),this.difficultyCalculator=new cu(this),this.effectHandler=new Cg(this),this.eventHandler=new oh(this),this.fearHandler=new Ag(this),this.inquirer=new gu(this,e),this.instructionHandler=new fu,this.invaderCardHandler=new bg(this),this.islandHandler=new Iu(this),this.powerHandler=new Pg(this),this.scenarioHandler=new Fu(this),this.spiritHandler=new vp(this),this.surveyor=new Pu(this),this.overrider=new Lu}get action(){return this.actionHandler.currentAction}get activeEventCard(){return this.eventHandler.activeEventCard}get adjustedCardPlays(){return this.spiritHandler.adjustedCardPlays}get adversaryLeading(){return this.adversaryHandler.adversaryLeading}get bannedCards(){return this.config.bannedCards||[uc.AStrangeMadnessAmongTheBeasts,_e.GrowthThroughSacrifice,uc.Outpaced,ac.TippingPoint,uc.WarTouchesTheIslandsShores]}get adversarySupporting(){return this.adversaryHandler.adversarySupporting}get allSpiritsHavePlayedPowers(){return this.spiritHandler.allSpiritsHavePlayedPowers}get alwaysPushToSameDestination(){return this.overrider.alwaysPushToSameDestination}get beastsCountAsBadlands(){return this.someEffect(r.BeastsCountAsBadlands)}get beastsOnIsland(){return this.islandHandler.pieceCountIncludingStasis(this.Beasts)}get blightCardActive(){return this.blightHandler.blightCardActive}get blightCardsDiscarded(){return this.blightHandler.blightCardsInDiscard}get blightCardsInDeck(){return this.blightHandler.blightCardsInDeck}get blightOnBlightCard(){return this.blightHandler.blightOnBlightCard}get blightPool(){return this.blightHandler.blightPool}get blightStatus(){return this.blightHandler.blightStatus}get boardCount(){return this.islandHandler.boardCount}get boards(){return this.islandHandler.boards}get bringingWarriorThisInstruction(){return this.instructionHandler.bringingWarrior}get buildOrderMatters(){return this.someEffect(r.BuildOrderMatters)}get capitalSize(){return this.islandHandler.capitalSize}get coastalLands(){return this.islandHandler.coastalLands}get coastalLandsWithCities(){return this.islandHandler.coastalLandsWithCities}get coastalLandsWithWardingPatterns(){return this.islandHandler.coastalLandsWithWardingPatterns}get corners(){return this.islandHandler.corners}get currentActionHasAllThresholds(){return this.action.type===en.PowerAction&&this.someEffect(r.PowerHasAllThresholds,{power:this.action.power})}get currentActionType(){return this.actionHandler.currentActionType}get currentFear(){return this.fearHandler.fear}get currentHistory(){return this.inquirer.currentHistory}get currentStackEffect(){return this.effectHandler.currentStackEffect}get cursorAtPlayPower(){return this.inquirer.cursorAtPlayPower}get dahanCount(){return this.islandHandler.pieceCountIncludingStasis(this.Dahan)}get damageIgnoreHealthBonuses(){return this.someEffect(r.DamageIgnoreHealthBonuses)}get destroyedBoards(){return this.islandHandler.destroyedBoards}get difficulty(){return this.difficultyCalculator.difficulty}get effectIds(){return this.effectHandler.effectIds}get eventCardIsActive(){return this.eventHandler.eventCardIsActive}get eventCardsInDeck(){return this.eventHandler.eventCardsInDeck}get exploreDeck(){return this.invaderCardHandler.exploreDeck}get exploreDistance(){return 1+(this.someEffect(r.ExtraExploreDistance)?1:0)}get extraBeastAdjacency(){return this.someEffect(r.ExtraBeastAdjacency)}get fearBasedVictoryIsRemoved(){return this.someEffect(r.RemoveFearBasedVictory)}get fearCardsDiscarded(){return this.fearHandler.fearCardsDiscarded}get fearCardsEarned(){return this.fearHandler.fearCardsEarned}get fearCardsEarnedCount(){return this.fearHandler.fearCardsEarnedCount}get fearCardsInDeck(){return this.fearHandler.fearCardsInDeck}get fearCardsInLevelCount(){return this.fearHandler.fearCardsInLevelCount}get fearPool(){return this.fearHandler.fearPool}get gameEnded(){return this.conductor.gameEnded}get gameLost(){return this.conductor.gameLost}get gameWon(){return this.conductor.gameWon}get globalReminders(){return this.effectHandler.globalReminderEffects}get hasAttemptedDamagingInvaderThisInstruction(){return this.instructionHandler.hasAttemptedDamagingInvader}get hasAttemptedDestroyingInvaderThisInstruction(){return this.instructionHandler.hasAttemptedDestroyingInvader}get hasLostFromEffect(){return this.effectHandler.hasLostFromEffect}get hasResolvedFearCard(){return this.fearHandler.hasResolvedFearCard}get hasRunningAction(){return this.actionHandler.hasRunningAction}get hasWonFromEffect(){return this.effectHandler.hasWonFromEffect}get highImmigrationActive(){return this.existEffect(r.HighImmigration)}get ignoreOneStrife(){return this.someEffect(r.IgnoreOneStrife)}get ignoreWildsDuringExplore(){return this.someEffect(r.IgnoreWildsDuringExplore)}get inputs(){return hc.getInputs(this,0)}get invaderCardsInExploreDeck(){return this.invaderCardHandler.invaderCardsInExploreDeck}get invaderCardsInFearDeck(){return this.fearHandler.invaderCardsInFearDeck}get invaderCardsVisible(){return this.invaderCardHandler.invaderCardsVisible}get isInAdmin(){return this.adminHandler.isInAdmin}get landCountWhereTownsAndCitiesOutnumberDahan(){return this.locationsIncludingNonExisting.filter((e=>e.the(this.TownOrCity).outnumber(this.Dahan))).length}get landElements(){return this.islandHandler.landElements}get lands(){return this.islandHandler.lands}get lastSeenEventCard(){return this.eventHandler.lastSeenEventCard}get locations(){return this.islandHandler.locations}get locationsIncludingNonExisting(){return this.islandHandler.locationsIncludingNonExisting}get lostReason(){return this.conductor.lostReason}get maxCoastalLandsWithCities(){return 2*this.islandHandler.boards.length+1}get maxIrreparableDamage(){return this.spiritCount+1}get maxTownsAllowed(){return this.adversaryHandler.maxTownsAllowed}get miningLandsCauseRavageActions(){return this.someEffect(r.MiningLandsCauseRavageActions)}get movedDahanThisInstruction(){return this.instructionHandler.movedDahan}get movedPresenceThisInstruction(){return this.instructionHandler.movedPresence}get nonDestroyedBoards(){return this.islandHandler.nonDestroyedBoards}get numberOfExploreCardsThisTurn(){return this.invaderCardHandler.numberOfExploreCardsThisTurn}get oceanIsAllowedForBlight(){return this.islandHandler.oceanIsAllowedForBlight}get orderOfRemoveAllMightMatter(){return this.someEffect(r.OrderOfRemoveAllMightMatter)}get parentEffect(){return this.effectHandler.parentEffect}get phase(){return this.conductor.phase}get pieces(){return this.islandHandler.pieces}get playingWithCommandBeasts(){return!this.config.events&&this.config.sets.length>1}get powerCardsInPlayThatGeneratesFear(){return this.powerCardsPlayedThisTurn.filter((e=>e.data.generatesFear&&!e.isBlessed&&!e.assisted))}get powerCardsPlayedThisTurn(){return this.spiritHandler.powerCardsPlayedThisTurn}get powercardsInMajorDeck(){return this.powerHandler.powercardsInMajorDeck}get powercardsInMinorDeck(){return this.powerHandler.powercardsInMinorDeck}get preventSlowPowers(){return this.someEffect(r.PreventSlowPowers)}get preventTerrorLevelAndResolveFearCards(){return this.fearHandler.preventTerrorLevelAndResolveFearCards}get randomEventsEnabled(){return this.overrider.randomEventsEnabled}get reminderEffects(){return this.effectHandler.reminderEffects}get reportedPhase(){return this.conductor.reportedPhase}get resolvableCardsLeft(){return this.overrider.resolvableCardsLeft}get resolvingFearCard(){return this.fearHandler.resolvingFearCard}get scenario(){return this.scenarioHandler.scenario}get score(){let e=0;return this.gameWon?(e+=5*this.difficulty+10+2*this.invaderCardsInExploreDeck.length,this.gameLost&&(e-=5)):e+=2*this.difficulty+(this.invaderCardsVisible.length+this.invaderCardsInSlot(ps.Discard).length),e+=Math.floor(this.pieceCountIncludingStasis(Z.Dahan)/this.spiritCount),e-=Math.floor(this.pieceCountIncludingStasis(Z.Blight)/this.spiritCount),e+=this.sumEffects(r.ExtraScore),e}get showFearCards(){return!this.preventTerrorLevelAndResolveFearCards}get showingTerrainTypes(){return this.invaderCardHandler.showingTerrainTypes}get slowHealingBlight(){return this.blightHandler.slowHealingBlight}get someBoardsHasExtraLocations(){return this.existEffect(r.BoardHasExtraLocation)}get someEffect(){return(e,a)=>this.effectHandler.someEffect(e,a)}get someEffectMakesOceanALand(){return this.existEffect(r.OceanIsLand)}get someLocationHasExtraTerrains(){return this.existEffect(r.LocationIsTerrain)}get someNonOceanIsOcean(){return this.existEffect(r.LocationIsOcean)}get spiritCount(){return this.spiritHandler.spiritCount}get spiritPhase(){return[Xe.Grow,Xe.GainEnergy,Xe.PlayPowers].includes(this.phase)}get spiritSimulation(){return this.overrider.spiritSimulation}get spirits(){return this.spiritHandler.spirits}get stage(){return this.invaderCardHandler.stage}get startingBlight(){return this.blightHandler.startingBlight}get strippedLandSize(){return this.islandHandler.strippedLandSize}get terrorLevel(){return this.fearHandler.terrorLevel}get theEndlessDark(){return this.islandHandler.theEndlessDark}get theEndlessDarkExists(){return this.config.boards.some((e=>e.spirit?.spirit===hn.Darkness))}get theEndlessDarkPosition(){return this.config.endlessDark??{x:0,y:0}}get townsCount(){return this.islandHandler.pieceCountIncludingStasis(this.Town)}get treatingAllOrsAsAnds(){return this.someEffect(r.TreatAllORsAsANDs)}get turn(){return this.conductor.turn}get unusedBoardCount(){return this.islandHandler.boardsUnused.length}get unusedFearCardsLeft(){return this.fearHandler.unusedFearCardsLeft}get upToMustBeUsedAtMaximum(){return this.someEffect(r.UpToMustBeUsedAtMaximum)}get willTakeFromBlightPool(){return this.blightHandler.willTakeFromBlightPool}get winReason(){return this.conductor.winReason}accelerateTheInvaderDeck(){return this.invaderCardHandler.accelerateTheInvaderDeck()}actualExploreCardIndex(e){return this.invaderCardHandler.actualExploreCardIndex(e)}addBlightToBlightCard(e){return this.blightHandler.addBlightToBlightCard(e)}addBlightToBlightPool(e){return this.blightHandler.addBlightToBlightPool(e)}addBoard(e){return this.islandHandler.addBoard(e)}addEffect(e){return this.effectHandler.addEffect(e)}addEffectUntilEndOfAction(e){return this.effectHandler.addEffectUntilEndOfAction(e)}addEffectUntilEndOfActionTree(e){return this.effectHandler.addEffectUntilEndOfActionTree(e)}addEffectUntilEndOfTurn(e){return this.effectHandler.addEffectUntilEndOfTurn(e)}addExploreCardToTop(e,a=0){return this.invaderCardHandler.addExploreCardToTop(e,a)}addFearCards(e){return this.fearHandler.addFearCards(e)}addFearToPool(e){return this.fearHandler.addFearToPool(e)}addRevealedBlightCard(){this.blightHandler.addOneToRevealedBlightCards()}addSlowHealingBlight(e=1){return this.blightHandler.addSlowHealingBlight(e)}addSubEffect(e){return this.effectHandler.addSubEffect(e)}addSubEffectUntilEndOfAction(e){return this.effectHandler.addSubEffectUntilEndOfAction(e)}addSubEffectUntilEndOfTimePasses(e){return this.effectHandler.addSubEffectUntilEndOfTimePasses(e)}addSubEffectUntilEndOfTurn(e){return this.effectHandler.addSubEffectUntilEndOfTurn(e)}addTrigger(e,a,t,n={}){return this.actionHandler.addTrigger(e,a,t,n)}advanceCardsIn(e){return this.invaderCardHandler.advanceCardsIn(e)}advanceInvaderCards(){return this.invaderCardHandler.advanceInvaderCards()}afterPiecesAreAddedOrMovedAddTrigger(e){return this.islandHandler.afterPiecesAreAddedOrMovedAddTrigger(e)}blightDeckIncludesCard(e){return this.blightHandler.blightCardsInDeck.includes(e)}build(e){return this.islandHandler.build(e)}buildFromCard(e,a,t={}){return this.islandHandler.buildFromCard(e,a,t)}checkIfEnded(){this.actionHandler.checkIfEnded()}chooseBetween(e,a={orChoice:!0,payJointly:!1}){return this.inquirer.chooseBetween(e,a)}async clickToContinue(e){await this.query({query:tn.ClickToContinue,items:[0],actionIds:["ClickToContinue"],...e})}closeDown(){this.inquirer.closeDown()}countPieceOnlyIfHavingPiece(e,a){return this.countPiecesOnlyIfHavingPieces([e],a)}async countPieceOptionally(e,a){this.action.dontCountAs.add(e);const t=a();this.action.dontCountAs.delete(e);const n=a();if(n.count>t.count){if(await this.may({prompt:`Count pieces as ${ee[e].text} to do this effect?`}))return n;this.dontCountAs(e)}return t}countPiecesOnlyIfHavingPieces(e,a){const t=this.action.dontCountAs;for(const a of e)t.add(a);const n=a();if(n.count>0){for(const a of e)t.delete(a);return a()}return n}defaultPromptForQueryType(e){return this.inquirer.defaultPromptForQueryType(e)}disableRandomEvents(){this.overrider.disableRandomEvents()}discardBlightCard(e){return this.blightHandler.discardBlightCard(e)}discardEarnedFearCards(e){return this.fearHandler.discardEarnedFearCards(e)}discardPowerToDeckDiscard(e){return this.powerHandler.discardPower(e)}discardTopFearCard(){return this.fearHandler.discardTopFearCard()}doActionOnEachBoard(e,a,t={}){return this.onEachBoard((t=>this.actionHandler.doAction(e,(()=>a(t)),{board:t})),t)}doAdversaryAction(e,a){return this.actionHandler.doAction(en.AdversaryAction,e,a)}doAdversaryActionOnEachBoard(e){return this.islandHandler.doAdversaryActionOnEachBoard(e)}doBlightCardAction(e){return this.actionHandler.doAction(en.BlightCardAction,e)}doBlightCardActionOnEachBoard(e){return this.doActionOnEachBoard(en.BlightCardAction,e)}doDahanEventAction(e,a){return this.actionHandler.doAction(en.DahanEventAction,e,a)}doDahanEventActionOnEachBoard(e,a={}){return this.doActionOnEachBoard(en.DahanEventAction,e,a)}doEffect(e,a,t){return this.effectHandler.doEffect(e,a,t)}doEffectWithContext(e,a,t){return this.effectHandler.doEffectWithContext(e,a,t)}doEffects(e,a,t){return this.effectHandler.doEffects(e,a,t)}doEffectsWithContext(e,a,t){return this.effectHandler.doEffectsWithContext(e,a,t)}doEffectsWithPriority(e,a){return this.effectHandler.doEffectsWithPriority(e,a)}async doExtraAction(e){void 0!==e.effect.spirit?await this.doSpiritAction((()=>this.addEffect(e.effect))):await this.addEffect(e.effect)}doExtraBuildInTerrain(e){return this.islandHandler.doExtraBuildInTerrain(e)}doExtraRavageInTerrain(e){return this.islandHandler.doExtraRavageInTerrain(e)}doFearAction(e,a){return this.actionHandler.doAction(en.FearAction,e,a)}doGameAction(e,a){return this.actionHandler.doAction(en.GameAction,e,a)}doInstruction(e){return this.instructionHandler.doInstruction(e)}doInvaderAction(e,a,t){return this.actionHandler.doAction(e,a,t)}doMainEventAction(e,a){return this.actionHandler.doAction(en.MainEventAction,e,a)}doMainEventActionOnEachBoard(e,a={}){return this.doActionOnEachBoard(en.MainEventAction,e,a)}doPowerAction(e,a,t){return this.actionHandler.doAction(en.PowerAction,a,{spirit:e,power:t})}doScenarioAction(e,a){return this.actionHandler.doAction(en.ScenarioAction,e,a)}doScenarioActionOnEachBoard(e,a={}){return this.doActionOnEachBoard(en.ScenarioAction,e,a)}doSpiritAction(e,a){return this.actionHandler.doAction(en.SpiritAction,e,a)}doTokenEventAction(e,a){return this.actionHandler.doAction(en.TokenEventAction,e,a)}doTokenEventActionOnEachBoard(e,a={}){return this.doActionOnEachBoard(en.TokenEventAction,e,a)}dontCountAs(e){this.action.dontCountAs.add(e)}drawAndDiscardPower(e){return this.powerHandler.drawAndDiscardPower(e)}drawEventCard(){return this.eventHandler.drawEventCard()}drawFrom(e,a){return this.config.controlledFate&&a.length>0?this.inquirer.chooseFrom(e,a):Promise.resolve(this.randomizer.drawFrom(e))}drawNextExploreCard(){return this.invaderCardHandler.drawNextExploreCard()}drawPower(e,a={}){return this.powerHandler.drawPower(e,a)}eachSpirit(e){return this.spiritHandler.eachSpirit(e)}earnFearCard(){return this.fearHandler.earnFearCard()}earnTerrorLevel(){return this.fearHandler.earnTerrorLevel()}effectsMappedWithFilter(e,a){return this.effectHandler.effectsMappedWithFilter(e,a)}effectsOfType(e){return this.effectHandler.effectsOfType(e)}enhanceEffectWithCurrentEffect(e){return this.effectHandler.enhanceEffectWithCurrentEffect(e)}enterAdminMode(){return this.adminHandler.enterAdminMode()}escalate(e,a){return this.invaderCardHandler.escalate(e,a)}eventCardAtIndexIsSpecial(e){return this.eventHandler.eventCardAtIndexIsSpecial(e)}eventDeckIncludesCard(e){return this.eventHandler.eventCardsInDeck.includes(e)}eventDiscardIncludesCard(e){return this.eventHandler.eventCardsInDiscard.includes(e)}existEffect(e){return this.effectHandler.existEffect(e)}existLandWhere(e){return this.islandHandler.existLandWhere(e)}existLocationIncludingNonExistingWhere(e){return this.islandHandler.existLocationIncludingNonExistingWhere(e)}explore(){return this.islandHandler.explore()}extractFeatures(){return wc.extractFeatures(this)}fear(e){return this.generateFear({amount:e,fromDestroyingBuildings:!1})}fearCardsInLevel(e){return this.fearHandler.fearCardsInLevel(e)}fearDeckIncludesCard(e){return this.fearHandler.fearCardsInDeck.includes(e)}firstEffectOfType(e,a){return this.effectHandler.firstEffectOfType(e,a)}forEachLand(e){return this.islandHandler.forEachLand(e)}forPieces(){return this.islandHandler.forPieces()}forPiecesThatIs(e,a){return this.islandHandler.forPieces().where((t=>t.isA(e)&&(void 0===a||a(t.location))))}forPiecesWhere(e){return this.islandHandler.forPieces().where(e)}fromAllSpirits(){return this.spiritHandler.fromAllSpirits()}gainDamageBoost(e){return this.spiritHandler.gainDamageBoost(e)}gainEnergyDividedEvenly(e){return this.spiritHandler.gainEnergyDividedEvenly(e)}gainEnergyFromTracks(){return this.spiritHandler.gainEnergyFromTracks()}gameStartQuery(){return this.clickToContinue({name:"Setup",splash:!0,text:"",noOptions:"Click to Start Game"})}generateFear(e){return this.fearHandler.generateFear(e)}generatePieceId(){return this.randomizer.generatePieceId()}globalHealthCheck(){return this.islandHandler.globalHealthCheck()}growAndPlayTrackActions(){return this.spiritHandler.growAndPlayTrackActions()}hasEffectNamed(e){return this.effectHandler.hasEffectNamed(e)}inBoards(){return this.islandHandler.inBoards()}inBoardsWhere(e){return this.islandHandler.inBoardsWhere(e)}inBoardsWith(e){return this.islandHandler.inBoardsWith(e)}inBoardsWithout(e){return this.islandHandler.inBoardsWithout(e)}inCoastalLands(){return this.inLandsWhere((e=>e.isCoastal))}inCorners(){return this.islandHandler.inCorners()}inCornersWhere(e){return this.islandHandler.inCornersWhere(e)}inDifferentLands(e){return this.islandHandler.inLands().inDifferent(e)}inInlandLands(){return this.inLandsWhere((e=>e.isInland))}inLands(){return this.islandHandler.inLands()}inLandsWhere(e){return this.islandHandler.inLandsWhere(e)}inLandsWith(e){return this.islandHandler.inLandsWith(e)}inLandsWithAllOf(...e){return this.islandHandler.inLandsWithAllOf(...e)}inLandsWithOneOf(...e){return this.islandHandler.inLandsWithOneOf(...e)}inLandsWithOrAdjacentTo(e){return this.islandHandler.inLandsWithOrAdjacentTo(e)}inLandsWithStrife(){return this.islandHandler.inLandsWithStrife()}inLandsWithout(e){return this.islandHandler.inLandsWithout(e)}inLocations(){return this.islandHandler.inLocations()}inLocationsWhere(e){return this.islandHandler.inLocationsWhere(e)}inOceans(){return this.inLocationsWhere((e=>e.type===an.Ocean))}inTargetableLandsWhere(e){return this.islandHandler.inTargetableLandsWhere(e)}insertEventCard(e){return this.eventHandler.insertEventCard(e)}insertInvaderCard(e,a={}){return this.invaderCardHandler.insertInvaderCard(e,a)}insertInvaderCardUnderFearCards(e,a){this.fearHandler.insertInvaderCardUnderFearCards(e,a)}invaderCardAtIndexIsSpecial(e){return this.invaderCardHandler.invaderCardAtIndexIsSpecial(e)}invaderCardsInSlot(e){return this.invaderDeckInSlot(e).cards}invaderCardsInVisibleSlot(e){return this.invaderDeckInSlot(e).cards}invaderDeckInSlot(e){return this.invaderCardHandler.invaderCardsInSlot[e]}invadersHaveMinusOneHealthPerStrife(){return this.islandHandler.invadersHaveMinusOneHealthPerStrife()}invalidateBoardCache(){this.islandHandler.invalidateBoardCache()}loseFear(e){return this.fearHandler.loseFear(e)}loseGame(e){return this.conductor.loseGame(e)}majorDeckIncludesPower(e){return this.powerHandler.powercardsInMajorDeck.includes(e)}majorDiscardIncludesPower(e){return this.powerHandler.powercardsInMajorDiscard.includes(e)}may(e,a=!1){return this.inquirer.may(e,a)}migrateCornerCornersFromBoard(e){this.islandHandler.migrateCornerCornersFromBoard(e)}minorDeckIncludesPower(e){return this.powerHandler.powercardsInMinorDeck.includes(e)}minorDiscardIncludesPower(e){return this.powerHandler.powercardsInMinorDiscard.includes(e)}moveNthCardOfStageUpByOne(e,a){return this.invaderCardHandler.moveNthCardOfStageUpByOne(e,a)}nextTriggerId(){return this.actionHandler.nextTriggerId()}nthCardOfStage(e,a){return this.invaderCardHandler.nthCardOfStage(e,a)}oceanIsLandForBlight(e){return this.someEffect(r.OceanIsLandForBlight,{location:e})}ofTheseLocations(e){return An.createCollection(this,e)}onEachBoard(e,a={}){return this.islandHandler.onEachBoard(e,a)}oneEffectActivates(e,a){return this.effectHandler.oneEffectActivates(e,a)}payEnergyJointlyAidedBy(e){return this.spiritHandler.payEnergyJointlyAidedBy(e)}pickAFaceDownFearCard(){return this.fearHandler.pickAFaceDownFearCard()}pickTerrainsWhere(e,a){return this.islandHandler.pickTerrainsWhere(e,a)}pieceCountIncludingStasis(e){return this.islandHandler.pieceCountIncludingStasis(e)}playDraftActions(e,a){return this.spiritHandler.playDraftActions(e,a)}playPowers(){return this.spiritHandler.playPowers()}playTrackActions(){return this.spiritHandler.playTrackActions()}playersCanJointlyPayEnergyAidedBy(e){return this.spiritHandler.playersCanJointlyPayEnergyAidedBy(e)}possiblyResolveHistoryFinished(){return this.inquirer.possiblyResolveHistoryFinished()}powersWhere(e){return this.spiritHandler.powersWhere(e)}putAllFearCardsInDeckIntoLevel(e){return this.fearHandler.putAllFearCardsInDeckIntoLevel(e)}putAllFearCardsIntoLevel(e){return this.fearHandler.putAllFearCardsIntoLevel(e)}putBottomEventCardToTop(){return this.eventHandler.putBottomEventCardToTop()}putTopEventCardToBottom(){return this.eventHandler.putTopEventCardToBottom()}putTopInvaderCardToBottom(){return this.invaderCardHandler.putTopInvaderCardToBottom()}query(e){return this.inquirer.query(e)}queryOptional(e){return this.inquirer.queryOptional(e)}randomFreePositionFromBoard(e){return this.surveyor.randomFreePositionFromBoard(e)}randomFromArray(e){return this.randomizer.randomFromArray(e)}ravage(){return this.islandHandler.ravage()}removeBlightFromBlightCard(e,a){return this.blightHandler.removeBlightFromBlightCard(e,a)}removeBlightFromBlightPool(e){return this.blightHandler.removeBlightFromBlightPool(e)}removeBottomMostInvaderCardOfStage(e){return this.invaderCardHandler.removeBottomMostInvaderCardOfStage(e)}removeEffect(e){return this.effectHandler.removeEffect(e)}removeEffectsWithId(e){return this.effectHandler.removeEffectsWithId(e)}removeEffectsWithName(e){return this.effectHandler.removeEffectsWithName(e)}removeEventCardFromDiscard(e){this.eventHandler.removeEventCardFromDiscard(e)}removeInvaderCard(e,a){return this.invaderCardHandler.removeCardFromExploreDeck(e,a)}removeInvadersWorthOfHealthUpTo(e){return this.islandHandler.removeInvadersWorthOfHealthUpTo(e)}removePowerCardFromDecks(e){return this.powerHandler.removePowerCardFromDecks(e)}removeSlowHealingBlight(e){return this.blightHandler.removeSlowHealingBlight(e)}removeThisEffect(){this.effectHandler.removeCurrentEffect()}removeTopFearCard(){return this.fearHandler.removeTopFearCard()}removeTopMostInvaderCardOfStage(e){return this.invaderCardHandler.removeTopMostInvaderCardOfStage(e)}removeTopNonSpecialExploreCard(){return this.invaderCardHandler.removeTopNonSpecialExploreCard()}reportMovement(e){return this.instructionHandler.reportMovement(e)}reshuffleFearDeck(){return this.fearHandler.reshuffleFearDeck()}resolvablePowers(e,a=!1){return Zn.createCollection(this,this.spiritHandler.resolvablePowers(e,a))}resolveFearCards(){return this.fearHandler.resolveFearCards()}resolveMaximimumPowers(e){this.overrider.resolveMaximimumPowers(e)}resolveNextFearCard(e){return this.fearHandler.resolveNextFearCard(e)}resolvePowers(e){return this.spiritHandler.resolvePowers(e)}resultFromFirstEffectOfType(e,a){return this.effectHandler.resultFromFirstEffectOfType(e,a)}revealFearCardAtLevel(e,a){return this.fearHandler.revealFearCard(e,a)}revealFearCardInDeck(e){return this.fearHandler.revealFearCardInDeck(e)}revealTopEventCard(){return this.eventHandler.revealTopEventCard()}revealTopFearCard(){return this.fearHandler.revealTopFearCard()}revealTopInvaderCard(){return this.invaderCardHandler.revealTopInvaderCard()}run(e,a){const t=this.inquirer.setHistory(e??[],a);return this.conductor.run(void 0===e),t}runEndOfActionEffects(e){return this.effectHandler.runEndOfActionEffects(e)}runEndOfActionTreeEffects(e){return this.effectHandler.runEndOfActionTreeEffects(e)}scoreFromPowers(){return this.spiritHandler.scoreFromPowers()}selectX(e,a,t={}){return this.inquirer.selectX(e,a,t)}sendEvent(e){return this.inquirer.send(e)}setCorners(e){this.islandHandler.setCorners(e)}setHasAttemptedDamagingInvaderThisInstruction(){this.instructionHandler.hasAttemptedDamagingInvader=!0}setHasAttemptedDestroyingInvaderThisInstruction(){this.instructionHandler.hasAttemptedDestroyingInvader=!0}setPhase(e){return this.conductor.setPhase(e)}setRandomSeed(){this.randomizer.setRandomSeed()}setSeed(e){this.randomizer.setSeed(e)}setupAdjacencies(){this.surveyor.setupAdjacencies()}setupAdversaries(){return this.adversaryHandler.setup()}setupCommandBeast(){return this.commandBeastHandler.setup()}setupCorners(){this.surveyor.setupCorners()}setupFearDeck(){return this.fearHandler.setupFearDeck()}setupInvaderDeck(){return this.invaderCardHandler.setupInvaderDeck()}setupPresence(){return this.spiritHandler.setupPresence()}setupScenario(){return this.scenarioHandler.setup()}setupSpirits(){return this.spiritHandler.setup()}setupStartingTokens(){return this.islandHandler.setupStartingTokens()}shuffle(e){return this.randomizer.shuffle(e)}shuffleTopThreeEventCards(){return this.eventHandler.shuffleTopThreeEventCards()}shuffleTopTwoEventCards(){return this.eventHandler.shuffleTopTwoEventCards()}shuffleTopTwoInvaderCards(){return this.invaderCardHandler.shuffleTopTwoInvaderCards()}simplifyMultiPush(){this.overrider.simplifyMultiPush()}simulateSpiritBoardOnly(){this.overrider.simulateSpiritBoardOnly()}spiritsWhich(e){return this.spiritHandler.spiritsWhich(e)}splittedDamage(e){return this.islandHandler.splittedDamage(e)}stageNumbersInSlot(e){return this.invaderCardHandler.stageNumbersInSlot(e)}startAllowOceanForBlight(e){this.oceanIsLandForBlight(e)&&(this.islandHandler.oceanIsAllowedForBlight=!0)}stopAllowOceanForBlight(){this.islandHandler.oceanIsAllowedForBlight=!1}sumEffects(e,a){return this.effectHandler.sumEffects(e,a)}timePassesForEffects(){return this.effectHandler.timePasses()}timePassesForFear(){return this.fearHandler.timePasses()}timePassesForSpirits(){return this.spiritHandler.timePasses()}timePassesLateExpiration(){return this.effectHandler.timePassesLateExpiration()}toString(){return Ic({adversary:this.adversaryHandler,blight:this.blightHandler,conductor:this.conductor,event:this.eventHandler,fear:this.fearHandler,invaderCards:this.invaderCardHandler,island:this.islandHandler,powerHandler:this.powerHandler,randomizer:this.randomizer,scenario:this.scenarioHandler,spirits:this.spiritHandler})}unusedInvaderCardOfStage(e){return this.invaderCardHandler.unusedInvaderCardOfStage(e)}updateReportedPhase(){this.conductor.updateReportedPhase()}waitForAnimationsToFinish(){return this.inquirer.waitForAnimationsToFinish()}winGame(e){return this.conductor.winGame(e)}}Ip([C.EW],Ap.prototype,"ignoreOneStrife",null),Ip([C.EW],Ap.prototype,"someBoardsHasExtraLocations",null),Ip([C.EW],Ap.prototype,"someEffectMakesOceanALand",null),Ip([C.EW],Ap.prototype,"someLocationHasExtraTerrains",null),Ip([C.EW],Ap.prototype,"someNonOceanIsOcean",null);class xp{lastNode;newNodes=[];config;estimator;history;moveValue;nodeHistory;onError;reachedEndPromise;seed;simParams;state;endTurn=0;isLeaf=!0;nodeHistoryCursor=0;nodesToAdd;randomMoves=0;constructor(e){this.config=e.config,this.history=e.history,this.nodeHistory=e.nodeHistory,this.seed=e.seed,this.simParams=e.simParams,this.onError=e.onError,this.state=new Ap(this,this.config),this.reachedEndPromise=new lu,this.moveValue=e.moveValue,this.estimator=e.estimator,this.lastNode=e.rootNode,this.nodesToAdd=e.simParams.nodesToAdd}async query(e){if(this.nodeHistoryCursor<this.nodeHistory.length){const e=this.nodeHistory[this.nodeHistoryCursor];return this.nodeHistoryCursor+=1,Promise.resolve(e)}if(this.state.turn===this.endTurn||this.randomMoves>100)return await this.endGame(),new Promise((()=>{}));this.randomMoves+=1;let a=Bd.pruneQuery(this.state,e,this.simParams,this.nodesToAdd>0);this.nodesToAdd>0?this.lastNode.reportPossibleMoves(a):a.length>1&&(this.isLeaf=!1);const t=a.map((e=>this.moveValue[e])).filter((e=>void 0!==e));if(t.length>0){const e=Math.max(...t);a=a.filter((a=>this.moveValue[a]===e))}const n=a[Math.floor(Math.random()*a.length)];return this.nodesToAdd>0&&(this.nodesToAdd-=1,this.lastNode=this.lastNode.children.find((e=>e.move===n))),Promise.resolve(n)}async send(e){if(e.data.type===T.GameEnd){if(this.state.lostReason!==kd.GameError)return await this.endGame(),Promise.resolve();this.onError?.({config:this.config,history:this.state.currentHistory,turns:this.state.turn,score:this.state.score,lostReason:this.state.lostReason,ended:new Date})}return Promise.resolve()}async simulate(){if(await this.state.run(this.history),this.endTurn=this.state.turn+1,void 0!==this.seed&&this.state.setSeed(this.seed),this.state.disableRandomEvents(),this.state.simplifyMultiPush(),void 0!==this.simParams.maxActions){const e=this.state.action.type===en.PowerAction?this.simParams.maxActions-1:this.simParams.maxActions;this.state.resolveMaximimumPowers(e)}return this.reachedEndPromise.promise}waitForAnimations(){return Promise.resolve()}async endGame(){this.state.closeDown();const e=await this.estimator.estimateValueWithReward(this.state,!1,this.simParams.weights);this.isLeaf&&this.lastNode.reportIsLeaf(),this.reachedEndPromise.resolve(e)}}class bp{config;history;simParams;workerId;onError;estimator;constructor(e,a,t,n,r,i){this.config=e,this.history=a,this.simParams=t,this.workerId=n,this.onError=r,this.estimator=i}async findBestMove(){un.reactivity=!1;let e=0;const a={},t=[];for(let r=0;r<this.simParams.repeats;r+=1){const r=new n,i=(this.workerId,Date.now());let s,o=0;const d=this.simParams.randomizeSeed?Math.floor(9999999*Math.random()):void 0;for(;s=Date.now()-i,!(s>this.simParams.maxSimulationTimeInMs||o>=this.simParams.maxNumberOfSimulations);){let e=null;for(;!r.isLeaf&&(e=r.selectNextNode(!0),null===e););if(null===e)break;const t=e.moveHistory,n=new xp({config:this.config,history:this.history,nodeHistory:t,simParams:this.simParams,seed:d,moveValue:a,onError:this.onError,estimator:this.estimator,rootNode:e}),i=await n.simulate();if(n.lastNode.updateValue(i,a),this.simParams.traceSimulation&&console.log(`${pc(`${i.toFixed(2)}`,4)}: ${t}`),o+=1,1===r.children?.length)break}if(s=Date.now()-i,r.children)for(let e=0;e<r.children.length;e+=1){const a=r.children[e];e>=t.length?t.push({move:a.move,plays:a.plays,value:a.value}):(t[e].plays+=a.plays,t[e].value=Math.max(t[e].value,a.value))}e+=o}return un.reactivity=!0,{runs:e,moves:t,mayRepeat:!0}}}(new class{run(){const e=new wc;self.addEventListener("message",(a=>{(async()=>{const t=a.data,{config:n,history:r,simParams:i,workerId:s}=JSON.parse(t),o=new bp(n,r,i,s,(e=>{self.postMessage({error:e})}),e),d=await o.findBestMove();self.postMessage(d)})()}))}}).run()}},n={};function r(e){var a=n[e];if(void 0!==a)return a.exports;var i=n[e]={exports:{}};return t[e](i,i.exports,r),i.exports}r.m=t,r.x=()=>{var e=r.O(void 0,[813],(()=>r(717)));return e=r.O(e)},e=[],r.O=(a,t,n,i)=>{if(!t){var s=1/0;for(l=0;l<e.length;l++){for(var[t,n,i]=e[l],o=!0,d=0;d<t.length;d++)(!1&i||s>=i)&&Object.keys(r.O).every((e=>r.O[e](t[d])))?t.splice(d--,1):(o=!1,i<s&&(s=i));if(o){e.splice(l--,1);var c=n();void 0!==c&&(a=c)}}return a}i=i||0;for(var l=e.length;l>0&&e[l-1][2]>i;l--)e[l]=e[l-1];e[l]=[t,n,i]},r.d=(e,a)=>{for(var t in a)r.o(a,t)&&!r.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:a[t]})},r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce(((a,t)=>(r.f[t](e,a),a)),[])),r.u=e=>e+".js",r.miniCssF=e=>{},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),r.o=(e,a)=>Object.prototype.hasOwnProperty.call(e,a),(()=>{var e;r.g.importScripts&&(e=r.g.location+"");var a=r.g.document;if(!e&&a&&(a.currentScript&&(e=a.currentScript.src),!e)){var t=a.getElementsByTagName("script");if(t.length)for(var n=t.length-1;n>-1&&(!e||!/^http(s?):/.test(e));)e=t[n--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=e})(),(()=>{var e={717:1};r.f.i=(a,t)=>{e[a]||importScripts(r.p+r.u(a))};var a=self.webpackChunkspirit_terminal=self.webpackChunkspirit_terminal||[],t=a.push.bind(a);a.push=a=>{var[n,i,s]=a;for(var o in i)r.o(i,o)&&(r.m[o]=i[o]);for(s&&s(r);n.length;)e[n.pop()]=1;t(a)}})(),a=r.x,r.x=()=>r.e(813).then(a);r.x()})();