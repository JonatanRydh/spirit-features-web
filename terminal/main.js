(()=>{var e={83:(e,a,t)=>{"use strict";e=t.nmd(e);const n=(e,a)=>(...t)=>`[${e(...t)+a}m`,r=(e,a)=>(...t)=>{const n=e(...t);return`[${38+a};5;${n}m`},i=(e,a)=>(...t)=>{const n=e(...t);return`[${38+a};2;${n[0]};${n[1]};${n[2]}m`},s=e=>e,o=(e,a,t)=>[e,a,t],d=(e,a,t)=>{Object.defineProperty(e,a,{get:()=>{const n=t();return Object.defineProperty(e,a,{value:n,enumerable:!0,configurable:!0}),n},enumerable:!0,configurable:!0})};let c;const l=(e,a,n,r)=>{void 0===c&&(c=t(734));const i=r?10:0,s={};for(const[t,r]of Object.entries(c)){const o="ansi16"===t?"ansi":t;t===a?s[o]=e(n,i):"object"==typeof r&&(s[o]=e(r[a],i))}return s};Object.defineProperty(e,"exports",{enumerable:!0,get:function(){const e=new Map,a={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};a.color.gray=a.color.blackBright,a.bgColor.bgGray=a.bgColor.bgBlackBright,a.color.grey=a.color.blackBright,a.bgColor.bgGrey=a.bgColor.bgBlackBright;for(const[t,n]of Object.entries(a)){for(const[t,r]of Object.entries(n))a[t]={open:`[${r[0]}m`,close:`[${r[1]}m`},n[t]=a[t],e.set(r[0],r[1]);Object.defineProperty(a,t,{value:n,enumerable:!1})}return Object.defineProperty(a,"codes",{value:e,enumerable:!1}),a.color.close="[39m",a.bgColor.close="[49m",d(a.color,"ansi",(()=>l(n,"ansi16",s,!1))),d(a.color,"ansi256",(()=>l(r,"ansi256",s,!1))),d(a.color,"ansi16m",(()=>l(i,"rgb",o,!1))),d(a.bgColor,"ansi",(()=>l(n,"ansi16",s,!0))),d(a.bgColor,"ansi256",(()=>l(r,"ansi256",s,!0))),d(a.bgColor,"ansi16m",(()=>l(i,"rgb",o,!0))),a}})},248:(e,a,t)=>{"use strict";const n=t(83),{stdout:r,stderr:i}=t(747),{stringReplaceAll:s,stringEncaseCRLFWithFirstIndex:o}=t(58),{isArray:d}=Array,c=["ansi","ansi","ansi256","ansi16m"],l=Object.create(null);class h{constructor(e){return u(e)}}const u=e=>{const a={};return((e,a={})=>{if(a.level&&!(Number.isInteger(a.level)&&a.level>=0&&a.level<=3))throw new Error("The `level` option should be an integer from 0 to 3");const t=r?r.level:0;e.level=void 0===a.level?t:a.level})(a,e),a.template=(...e)=>A(a.template,...e),Object.setPrototypeOf(a,g.prototype),Object.setPrototypeOf(a.template,a),a.template.constructor=()=>{throw new Error("`chalk.constructor()` is deprecated. Use `new chalk.Instance()` instead.")},a.template.Instance=h,a.template};function g(e){return u(e)}for(const[e,a]of Object.entries(n))l[e]={get(){const t=y(this,w(a.open,a.close,this._styler),this._isEmpty);return Object.defineProperty(this,e,{value:t}),t}};l.visible={get(){const e=y(this,this._styler,!0);return Object.defineProperty(this,"visible",{value:e}),e}};const f=["rgb","hex","keyword","hsl","hsv","hwb","ansi","ansi256"];for(const e of f)l[e]={get(){const{level:a}=this;return function(...t){const r=w(n.color[c[a]][e](...t),n.color.close,this._styler);return y(this,r,this._isEmpty)}}};for(const e of f){l["bg"+e[0].toUpperCase()+e.slice(1)]={get(){const{level:a}=this;return function(...t){const r=w(n.bgColor[c[a]][e](...t),n.bgColor.close,this._styler);return y(this,r,this._isEmpty)}}}}const p=Object.defineProperties((()=>{}),{...l,level:{enumerable:!0,get(){return this._generator.level},set(e){this._generator.level=e}}}),w=(e,a,t)=>{let n,r;return void 0===t?(n=e,r=a):(n=t.openAll+e,r=a+t.closeAll),{open:e,close:a,openAll:n,closeAll:r,parent:t}},y=(e,a,t)=>{const n=(...e)=>d(e[0])&&d(e[0].raw)?m(n,A(n,...e)):m(n,1===e.length?""+e[0]:e.join(" "));return Object.setPrototypeOf(n,p),n._generator=e,n._styler=a,n._isEmpty=t,n},m=(e,a)=>{if(e.level<=0||!a)return e._isEmpty?"":a;let t=e._styler;if(void 0===t)return a;const{openAll:n,closeAll:r}=t;if(-1!==a.indexOf(""))for(;void 0!==t;)a=s(a,t.close,t.open),t=t.parent;const i=a.indexOf("\n");return-1!==i&&(a=o(a,r,n,i)),n+a+r};let v;const A=(e,...a)=>{const[n]=a;if(!d(n)||!d(n.raw))return a.join(" ");const r=a.slice(1),i=[n.raw[0]];for(let e=1;e<n.length;e++)i.push(String(r[e-1]).replace(/[{}\\]/g,"\\$&"),String(n.raw[e]));return void 0===v&&(v=t(991)),v(e,i.join(""))};Object.defineProperties(g.prototype,l);const I=g();I.supportsColor=r,I.stderr=g({level:i?i.level:0}),I.stderr.supportsColor=i,e.exports=I},991:e=>{"use strict";const a=/(?:\\(u(?:[a-f\d]{4}|\{[a-f\d]{1,6}\})|x[a-f\d]{2}|.))|(?:\{(~)?(\w+(?:\([^)]*\))?(?:\.\w+(?:\([^)]*\))?)*)(?:[ \t]|(?=\r?\n)))|(\})|((?:.|[\r\n\f])+?)/gi,t=/(?:^|\.)(\w+)(?:\(([^)]*)\))?/g,n=/^(['"])((?:\\.|(?!\1)[^\\])*)\1$/,r=/\\(u(?:[a-f\d]{4}|{[a-f\d]{1,6}})|x[a-f\d]{2}|.)|([^\\])/gi,i=new Map([["n","\n"],["r","\r"],["t","\t"],["b","\b"],["f","\f"],["v","\v"],["0","\0"],["\\","\\"],["e",""],["a",""]]);function s(e){const a="u"===e[0],t="{"===e[1];return a&&!t&&5===e.length||"x"===e[0]&&3===e.length?String.fromCharCode(parseInt(e.slice(1),16)):a&&t?String.fromCodePoint(parseInt(e.slice(2,-1),16)):i.get(e)||e}function o(e,a){const t=[],i=a.trim().split(/\s*,\s*/g);let o;for(const a of i){const i=Number(a);if(Number.isNaN(i)){if(!(o=a.match(n)))throw new Error(`Invalid Chalk template style argument: ${a} (in style '${e}')`);t.push(o[2].replace(r,((e,a,t)=>a?s(a):t)))}else t.push(i)}return t}function d(e){t.lastIndex=0;const a=[];let n;for(;null!==(n=t.exec(e));){const e=n[1];if(n[2]){const t=o(e,n[2]);a.push([e].concat(t))}else a.push([e])}return a}function c(e,a){const t={};for(const e of a)for(const a of e.styles)t[a[0]]=e.inverse?null:a.slice(1);let n=e;for(const[e,a]of Object.entries(t))if(Array.isArray(a)){if(!(e in n))throw new Error(`Unknown Chalk style: ${e}`);n=a.length>0?n[e](...a):n[e]}return n}e.exports=(e,t)=>{const n=[],r=[];let i=[];if(t.replace(a,((a,t,o,l,h,u)=>{if(t)i.push(s(t));else if(l){const a=i.join("");i=[],r.push(0===n.length?a:c(e,n)(a)),n.push({inverse:o,styles:d(l)})}else if(h){if(0===n.length)throw new Error("Found extraneous } in Chalk template literal");r.push(c(e,n)(i.join(""))),i=[],n.pop()}else i.push(u)})),r.push(i.join("")),n.length>0){const e=`Chalk template literal is missing ${n.length} closing bracket${1===n.length?"":"s"} (\`}\`)`;throw new Error(e)}return r.join("")}},58:e=>{"use strict";e.exports={stringReplaceAll:(e,a,t)=>{let n=e.indexOf(a);if(-1===n)return e;const r=a.length;let i=0,s="";do{s+=e.substr(i,n-i)+a+t,i=n+r,n=e.indexOf(a,i)}while(-1!==n);return s+=e.substr(i),s},stringEncaseCRLFWithFirstIndex:(e,a,t,n)=>{let r=0,i="";do{const s="\r"===e[n-1];i+=e.substr(r,(s?n-1:n)-r)+a+(s?"\r\n":"\n")+t,r=n+1,n=e.indexOf("\n",r)}while(-1!==n);return i+=e.substr(r),i}}},659:(e,a,t)=>{const n=t(156),r={};for(const e of Object.keys(n))r[n[e]]=e;const i={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};e.exports=i;for(const e of Object.keys(i)){if(!("channels"in i[e]))throw new Error("missing channels property: "+e);if(!("labels"in i[e]))throw new Error("missing channel labels property: "+e);if(i[e].labels.length!==i[e].channels)throw new Error("channel and label counts mismatch: "+e);const{channels:a,labels:t}=i[e];delete i[e].channels,delete i[e].labels,Object.defineProperty(i[e],"channels",{value:a}),Object.defineProperty(i[e],"labels",{value:t})}i.rgb.hsl=function(e){const a=e[0]/255,t=e[1]/255,n=e[2]/255,r=Math.min(a,t,n),i=Math.max(a,t,n),s=i-r;let o,d;i===r?o=0:a===i?o=(t-n)/s:t===i?o=2+(n-a)/s:n===i&&(o=4+(a-t)/s),o=Math.min(60*o,360),o<0&&(o+=360);const c=(r+i)/2;return d=i===r?0:c<=.5?s/(i+r):s/(2-i-r),[o,100*d,100*c]},i.rgb.hsv=function(e){let a,t,n,r,i;const s=e[0]/255,o=e[1]/255,d=e[2]/255,c=Math.max(s,o,d),l=c-Math.min(s,o,d),h=function(e){return(c-e)/6/l+.5};return 0===l?(r=0,i=0):(i=l/c,a=h(s),t=h(o),n=h(d),s===c?r=n-t:o===c?r=1/3+a-n:d===c&&(r=2/3+t-a),r<0?r+=1:r>1&&(r-=1)),[360*r,100*i,100*c]},i.rgb.hwb=function(e){const a=e[0],t=e[1];let n=e[2];const r=i.rgb.hsl(e)[0],s=1/255*Math.min(a,Math.min(t,n));return n=1-1/255*Math.max(a,Math.max(t,n)),[r,100*s,100*n]},i.rgb.cmyk=function(e){const a=e[0]/255,t=e[1]/255,n=e[2]/255,r=Math.min(1-a,1-t,1-n);return[100*((1-a-r)/(1-r)||0),100*((1-t-r)/(1-r)||0),100*((1-n-r)/(1-r)||0),100*r]},i.rgb.keyword=function(e){const a=r[e];if(a)return a;let t,i=1/0;for(const a of Object.keys(n)){const r=n[a],d=(o=r,((s=e)[0]-o[0])**2+(s[1]-o[1])**2+(s[2]-o[2])**2);d<i&&(i=d,t=a)}var s,o;return t},i.keyword.rgb=function(e){return n[e]},i.rgb.xyz=function(e){let a=e[0]/255,t=e[1]/255,n=e[2]/255;a=a>.04045?((a+.055)/1.055)**2.4:a/12.92,t=t>.04045?((t+.055)/1.055)**2.4:t/12.92,n=n>.04045?((n+.055)/1.055)**2.4:n/12.92;return[100*(.4124*a+.3576*t+.1805*n),100*(.2126*a+.7152*t+.0722*n),100*(.0193*a+.1192*t+.9505*n)]},i.rgb.lab=function(e){const a=i.rgb.xyz(e);let t=a[0],n=a[1],r=a[2];t/=95.047,n/=100,r/=108.883,t=t>.008856?t**(1/3):7.787*t+16/116,n=n>.008856?n**(1/3):7.787*n+16/116,r=r>.008856?r**(1/3):7.787*r+16/116;return[116*n-16,500*(t-n),200*(n-r)]},i.hsl.rgb=function(e){const a=e[0]/360,t=e[1]/100,n=e[2]/100;let r,i,s;if(0===t)return s=255*n,[s,s,s];r=n<.5?n*(1+t):n+t-n*t;const o=2*n-r,d=[0,0,0];for(let e=0;e<3;e++)i=a+1/3*-(e-1),i<0&&i++,i>1&&i--,s=6*i<1?o+6*(r-o)*i:2*i<1?r:3*i<2?o+(r-o)*(2/3-i)*6:o,d[e]=255*s;return d},i.hsl.hsv=function(e){const a=e[0];let t=e[1]/100,n=e[2]/100,r=t;const i=Math.max(n,.01);n*=2,t*=n<=1?n:2-n,r*=i<=1?i:2-i;return[a,100*(0===n?2*r/(i+r):2*t/(n+t)),100*((n+t)/2)]},i.hsv.rgb=function(e){const a=e[0]/60,t=e[1]/100;let n=e[2]/100;const r=Math.floor(a)%6,i=a-Math.floor(a),s=255*n*(1-t),o=255*n*(1-t*i),d=255*n*(1-t*(1-i));switch(n*=255,r){case 0:return[n,d,s];case 1:return[o,n,s];case 2:return[s,n,d];case 3:return[s,o,n];case 4:return[d,s,n];case 5:return[n,s,o]}},i.hsv.hsl=function(e){const a=e[0],t=e[1]/100,n=e[2]/100,r=Math.max(n,.01);let i,s;s=(2-t)*n;const o=(2-t)*r;return i=t*r,i/=o<=1?o:2-o,i=i||0,s/=2,[a,100*i,100*s]},i.hwb.rgb=function(e){const a=e[0]/360;let t=e[1]/100,n=e[2]/100;const r=t+n;let i;r>1&&(t/=r,n/=r);const s=Math.floor(6*a),o=1-n;i=6*a-s,1&s&&(i=1-i);const d=t+i*(o-t);let c,l,h;switch(s){default:case 6:case 0:c=o,l=d,h=t;break;case 1:c=d,l=o,h=t;break;case 2:c=t,l=o,h=d;break;case 3:c=t,l=d,h=o;break;case 4:c=d,l=t,h=o;break;case 5:c=o,l=t,h=d}return[255*c,255*l,255*h]},i.cmyk.rgb=function(e){const a=e[0]/100,t=e[1]/100,n=e[2]/100,r=e[3]/100;return[255*(1-Math.min(1,a*(1-r)+r)),255*(1-Math.min(1,t*(1-r)+r)),255*(1-Math.min(1,n*(1-r)+r))]},i.xyz.rgb=function(e){const a=e[0]/100,t=e[1]/100,n=e[2]/100;let r,i,s;return r=3.2406*a+-1.5372*t+-.4986*n,i=-.9689*a+1.8758*t+.0415*n,s=.0557*a+-.204*t+1.057*n,r=r>.0031308?1.055*r**(1/2.4)-.055:12.92*r,i=i>.0031308?1.055*i**(1/2.4)-.055:12.92*i,s=s>.0031308?1.055*s**(1/2.4)-.055:12.92*s,r=Math.min(Math.max(0,r),1),i=Math.min(Math.max(0,i),1),s=Math.min(Math.max(0,s),1),[255*r,255*i,255*s]},i.xyz.lab=function(e){let a=e[0],t=e[1],n=e[2];a/=95.047,t/=100,n/=108.883,a=a>.008856?a**(1/3):7.787*a+16/116,t=t>.008856?t**(1/3):7.787*t+16/116,n=n>.008856?n**(1/3):7.787*n+16/116;return[116*t-16,500*(a-t),200*(t-n)]},i.lab.xyz=function(e){let a,t,n;t=(e[0]+16)/116,a=e[1]/500+t,n=t-e[2]/200;const r=t**3,i=a**3,s=n**3;return t=r>.008856?r:(t-16/116)/7.787,a=i>.008856?i:(a-16/116)/7.787,n=s>.008856?s:(n-16/116)/7.787,a*=95.047,t*=100,n*=108.883,[a,t,n]},i.lab.lch=function(e){const a=e[0],t=e[1],n=e[2];let r;r=360*Math.atan2(n,t)/2/Math.PI,r<0&&(r+=360);return[a,Math.sqrt(t*t+n*n),r]},i.lch.lab=function(e){const a=e[0],t=e[1],n=e[2]/360*2*Math.PI;return[a,t*Math.cos(n),t*Math.sin(n)]},i.rgb.ansi16=function(e,a=null){const[t,n,r]=e;let s=null===a?i.rgb.hsv(e)[2]:a;if(s=Math.round(s/50),0===s)return 30;let o=30+(Math.round(r/255)<<2|Math.round(n/255)<<1|Math.round(t/255));return 2===s&&(o+=60),o},i.hsv.ansi16=function(e){return i.rgb.ansi16(i.hsv.rgb(e),e[2])},i.rgb.ansi256=function(e){const a=e[0],t=e[1],n=e[2];if(a===t&&t===n)return a<8?16:a>248?231:Math.round((a-8)/247*24)+232;return 16+36*Math.round(a/255*5)+6*Math.round(t/255*5)+Math.round(n/255*5)},i.ansi16.rgb=function(e){let a=e%10;if(0===a||7===a)return e>50&&(a+=3.5),a=a/10.5*255,[a,a,a];const t=.5*(1+~~(e>50));return[(1&a)*t*255,(a>>1&1)*t*255,(a>>2&1)*t*255]},i.ansi256.rgb=function(e){if(e>=232){const a=10*(e-232)+8;return[a,a,a]}let a;e-=16;return[Math.floor(e/36)/5*255,Math.floor((a=e%36)/6)/5*255,a%6/5*255]},i.rgb.hex=function(e){const a=(((255&Math.round(e[0]))<<16)+((255&Math.round(e[1]))<<8)+(255&Math.round(e[2]))).toString(16).toUpperCase();return"000000".substring(a.length)+a},i.hex.rgb=function(e){const a=e.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!a)return[0,0,0];let t=a[0];3===a[0].length&&(t=t.split("").map((e=>e+e)).join(""));const n=parseInt(t,16);return[n>>16&255,n>>8&255,255&n]},i.rgb.hcg=function(e){const a=e[0]/255,t=e[1]/255,n=e[2]/255,r=Math.max(Math.max(a,t),n),i=Math.min(Math.min(a,t),n),s=r-i;let o,d;return o=s<1?i/(1-s):0,d=s<=0?0:r===a?(t-n)/s%6:r===t?2+(n-a)/s:4+(a-t)/s,d/=6,d%=1,[360*d,100*s,100*o]},i.hsl.hcg=function(e){const a=e[1]/100,t=e[2]/100,n=t<.5?2*a*t:2*a*(1-t);let r=0;return n<1&&(r=(t-.5*n)/(1-n)),[e[0],100*n,100*r]},i.hsv.hcg=function(e){const a=e[1]/100,t=e[2]/100,n=a*t;let r=0;return n<1&&(r=(t-n)/(1-n)),[e[0],100*n,100*r]},i.hcg.rgb=function(e){const a=e[0]/360,t=e[1]/100,n=e[2]/100;if(0===t)return[255*n,255*n,255*n];const r=[0,0,0],i=a%1*6,s=i%1,o=1-s;let d=0;switch(Math.floor(i)){case 0:r[0]=1,r[1]=s,r[2]=0;break;case 1:r[0]=o,r[1]=1,r[2]=0;break;case 2:r[0]=0,r[1]=1,r[2]=s;break;case 3:r[0]=0,r[1]=o,r[2]=1;break;case 4:r[0]=s,r[1]=0,r[2]=1;break;default:r[0]=1,r[1]=0,r[2]=o}return d=(1-t)*n,[255*(t*r[0]+d),255*(t*r[1]+d),255*(t*r[2]+d)]},i.hcg.hsv=function(e){const a=e[1]/100,t=a+e[2]/100*(1-a);let n=0;return t>0&&(n=a/t),[e[0],100*n,100*t]},i.hcg.hsl=function(e){const a=e[1]/100,t=e[2]/100*(1-a)+.5*a;let n=0;return t>0&&t<.5?n=a/(2*t):t>=.5&&t<1&&(n=a/(2*(1-t))),[e[0],100*n,100*t]},i.hcg.hwb=function(e){const a=e[1]/100,t=a+e[2]/100*(1-a);return[e[0],100*(t-a),100*(1-t)]},i.hwb.hcg=function(e){const a=e[1]/100,t=1-e[2]/100,n=t-a;let r=0;return n<1&&(r=(t-n)/(1-n)),[e[0],100*n,100*r]},i.apple.rgb=function(e){return[e[0]/65535*255,e[1]/65535*255,e[2]/65535*255]},i.rgb.apple=function(e){return[e[0]/255*65535,e[1]/255*65535,e[2]/255*65535]},i.gray.rgb=function(e){return[e[0]/100*255,e[0]/100*255,e[0]/100*255]},i.gray.hsl=function(e){return[0,0,e[0]]},i.gray.hsv=i.gray.hsl,i.gray.hwb=function(e){return[0,100,e[0]]},i.gray.cmyk=function(e){return[0,0,0,e[0]]},i.gray.lab=function(e){return[e[0],0,0]},i.gray.hex=function(e){const a=255&Math.round(e[0]/100*255),t=((a<<16)+(a<<8)+a).toString(16).toUpperCase();return"000000".substring(t.length)+t},i.rgb.gray=function(e){return[(e[0]+e[1]+e[2])/3/255*100]}},734:(e,a,t)=>{const n=t(659),r=t(507),i={};Object.keys(n).forEach((e=>{i[e]={},Object.defineProperty(i[e],"channels",{value:n[e].channels}),Object.defineProperty(i[e],"labels",{value:n[e].labels});const a=r(e);Object.keys(a).forEach((t=>{const n=a[t];i[e][t]=function(e){const a=function(...a){const t=a[0];if(null==t)return t;t.length>1&&(a=t);const n=e(a);if("object"==typeof n)for(let e=n.length,a=0;a<e;a++)n[a]=Math.round(n[a]);return n};return"conversion"in e&&(a.conversion=e.conversion),a}(n),i[e][t].raw=function(e){const a=function(...a){const t=a[0];return null==t?t:(t.length>1&&(a=t),e(a))};return"conversion"in e&&(a.conversion=e.conversion),a}(n)}))})),e.exports=i},507:(e,a,t)=>{const n=t(659);function r(e){const a=function(){const e={},a=Object.keys(n);for(let t=a.length,n=0;n<t;n++)e[a[n]]={distance:-1,parent:null};return e}(),t=[e];for(a[e].distance=0;t.length;){const e=t.pop(),r=Object.keys(n[e]);for(let n=r.length,i=0;i<n;i++){const n=r[i],s=a[n];-1===s.distance&&(s.distance=a[e].distance+1,s.parent=e,t.unshift(n))}}return a}function i(e,a){return function(t){return a(e(t))}}function s(e,a){const t=[a[e].parent,e];let r=n[a[e].parent][e],s=a[e].parent;for(;a[s].parent;)t.unshift(a[s].parent),r=i(n[a[s].parent][s],r),s=a[s].parent;return r.conversion=t,r}e.exports=function(e){const a=r(e),t={},n=Object.keys(a);for(let e=n.length,r=0;r<e;r++){const e=n[r];null!==a[e].parent&&(t[e]=s(e,a))}return t}},156:e=>{"use strict";e.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},747:e=>{"use strict";e.exports={stdout:!1,stderr:!1}}},a={};function t(n){var r=a[n];if(void 0!==r)return r.exports;var i=a[n]={id:n,loaded:!1,exports:{}};return e[n](i,i.exports,t),i.loaded=!0,i.exports}t.m=e,t.n=e=>{var a=e&&e.__esModule?()=>e.default:()=>e;return t.d(a,{a}),a},t.d=(e,a)=>{for(var n in a)t.o(a,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:a[n]})},t.u=e=>e+".js",t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),t.o=(e,a)=>Object.prototype.hasOwnProperty.call(e,a),t.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),(()=>{var e;t.g.importScripts&&(e=t.g.location+"");var a=t.g.document;if(!e&&a&&(a.currentScript&&(e=a.currentScript.src),!e)){var n=a.getElementsByTagName("script");if(n.length)for(var r=n.length-1;r>-1&&(!e||!/^http(s?):/.test(e));)e=n[r--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e})(),t.b=document.baseURI||self.location.href,(()=>{"use strict";var e,a,n;!function(e){e.BalancedA="BalancedA",e.BalancedB="BalancedB",e.BalancedC="BalancedC",e.BalancedD="BalancedD",e.BalancedE="BalancedE",e.BalancedF="BalancedF",e.BalancedG="BalancedG",e.BalancedH="BalancedH",e.ThematicEA="ThematicEA",e.ThematicNE="ThematicNE",e.ThematicNW="ThematicNW",e.ThematicSE="ThematicSE",e.ThematicSW="ThematicSW",e.ThematicWE="ThematicWE"}(e||(e={})),function(e){e.Base="Base",e.BranchAndClaw="BranchAndClaw",e.JaggedEarth="JaggedEarth",e.FeatherAndFlame="FeatherAndFlame",e.HorizonsOfSpiritIsland="HorizonsOfSpiritIsland",e.NatureIncarnate="NatureIncarnate"}(a||(a={})),function(e){e.Lightning="Lightning",e.River="River",e.Earth="Earth",e.Shadows="Shadows",e.Thunderspeaker="Thunderspeaker",e.Green="Green",e.Ocean="Ocean",e.Bringer="Bringer",e.Fangs="Fangs",e.Keeper="Keeper",e.Wildfire="Wildfire",e.Serpent="Serpent",e.Stone="Stone",e.Memory="Memory",e.Trickster="Trickster",e.Lure="Lure",e.ManyMinds="ManyMinds",e.Volcano="Volcano",e.Shroud="Shroud",e.Vengeance="Vengeance",e.Starlight="Starlight",e.Fractured="Fractured",e.Downpour="Downpour",e.Finder="Finder",e.Teeth="Teeth",e.Eyes="Eyes",e.Mud="Mud",e.Heat="Heat",e.Whirlwind="Whirlwind",e.Behemoth="Behemoth",e.HearthVigil="HearthVigil",e.Darkness="Darkness",e.Gaze="Gaze",e.Roots="Roots",e.Earthquakes="Earthquakes",e.Voice="Voice",e.Wounded="Wounded"}(n||(n={}));const r={boards:[{x:0,y:0,rotation:0,boardId:e.BalancedA,spirit:{spirit:n.Lightning,aspect:null,progression:!1}}],seed:Math.floor(9999999*Math.random()),sets:[a.Base]};function i(e){for(var a=arguments.length,t=new Array(a>1?a-1:0),n=1;n<a;n++)t[n-1]=arguments[n];throw new Error("number"==typeof e?"[MobX] minified error nr: "+e+(t.length?" "+t.map(String).join(","):"")+". Find the full error at: https://github.com/mobxjs/mobx/blob/main/packages/mobx/src/errors.ts":"[MobX] "+e)}var s={};function o(){return"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t.g?t.g:"undefined"!=typeof self?self:s}var d=Object.assign,c=Object.getOwnPropertyDescriptor,l=Object.defineProperty,h=Object.prototype,u=[];Object.freeze(u);var g={};Object.freeze(g);var f="undefined"!=typeof Proxy,p=Object.toString();function w(){f||i("Proxy not available")}function y(e){var a=!1;return function(){if(!a)return a=!0,e.apply(this,arguments)}}var m=function(){};function v(e){return"function"==typeof e}function A(e){switch(typeof e){case"string":case"symbol":case"number":return!0}return!1}function I(e){return null!==e&&"object"==typeof e}function x(e){if(!I(e))return!1;var a=Object.getPrototypeOf(e);if(null==a)return!0;var t=Object.hasOwnProperty.call(a,"constructor")&&a.constructor;return"function"==typeof t&&t.toString()===p}function b(e){var a=null==e?void 0:e.constructor;return!!a&&("GeneratorFunction"===a.name||"GeneratorFunction"===a.displayName)}function T(e,a,t){l(e,a,{enumerable:!1,writable:!0,configurable:!0,value:t})}function E(e,a,t){l(e,a,{enumerable:!1,writable:!1,configurable:!0,value:t})}function P(e,a){var t="isMobX"+e;return a.prototype[t]=!0,function(e){return I(e)&&!0===e[t]}}function S(e){return e instanceof Map}function O(e){return e instanceof Set}var C=void 0!==Object.getOwnPropertySymbols;var D="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:C?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Object.getOwnPropertyNames;function B(e){return null===e?null:"object"==typeof e?""+e:e}function k(e,a){return h.hasOwnProperty.call(e,a)}var L=Object.getOwnPropertyDescriptors||function(e){var a={};return D(e).forEach((function(t){a[t]=c(e,t)})),a};function F(e,a){for(var t=0;t<a.length;t++){var n=a[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(r=n.key,i=void 0,"symbol"==typeof(i=function(e,a){if("object"!=typeof e||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,a||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(e)}(r,"string"))?i:String(i)),n)}var r,i}function R(e,a,t){return a&&F(e.prototype,a),t&&F(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function N(){return N=Object.assign?Object.assign.bind():function(e){for(var a=1;a<arguments.length;a++){var t=arguments[a];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e},N.apply(this,arguments)}function $(e,a){e.prototype=Object.create(a.prototype),e.prototype.constructor=e,W(e,a)}function W(e,a){return W=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,a){return e.__proto__=a,e},W(e,a)}function M(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function G(e,a){(null==a||a>e.length)&&(a=e.length);for(var t=0,n=new Array(a);t<a;t++)n[t]=e[t];return n}function H(e,a){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(t)return(t=t.call(e)).next.bind(t);if(Array.isArray(e)||(t=function(e,a){if(e){if("string"==typeof e)return G(e,a);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?G(e,a):void 0}}(e))||a&&e&&"number"==typeof e.length){t&&(e=t);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var j=Symbol("mobx-stored-annotations");function U(e){return Object.assign((function(a,t){if(_(t))return e.decorate_20223_(a,t);q(a,t,e)}),e)}function q(e,a,t){k(e,j)||T(e,j,N({},e[j])),function(e){return e.annotationType_===Z}(t)||(e[j][a]=t)}function _(e){return"object"==typeof e&&"string"==typeof e.kind}var J=Symbol("mobx administration"),V=function(){function e(e){void 0===e&&(e="Atom"),this.name_=void 0,this.isPendingUnobservation_=!1,this.isBeingObserved_=!1,this.observers_=new Set,this.diffValue_=0,this.lastAccessedBy_=0,this.lowestObserverState_=Xe.NOT_TRACKING_,this.onBOL=void 0,this.onBUOL=void 0,this.name_=e}var a=e.prototype;return a.onBO=function(){this.onBOL&&this.onBOL.forEach((function(e){return e()}))},a.onBUO=function(){this.onBUOL&&this.onBUOL.forEach((function(e){return e()}))},a.reportObserved=function(){return ba(this)},a.reportChanged=function(){Ia(),Ta(this),xa()},a.toString=function(){return this.name_},e}(),Y=P("Atom",V);function z(e,a,t){void 0===a&&(a=m),void 0===t&&(t=m);var n,r=new V(e);return a!==m&&za(Ja,r,a,n),t!==m&&Ya(r,t),r}var Q={identity:function(e,a){return e===a},structural:function(e,a){return vn(e,a)},default:function(e,a){return Object.is?Object.is(e,a):e===a?0!==e||1/e==1/a:e!=e&&a!=a},shallow:function(e,a){return vn(e,a,1)}};function K(e,a,t){return it(e)?e:Array.isArray(e)?Re.array(e,{name:t}):x(e)?Re.object(e,void 0,{name:t}):S(e)?Re.map(e,{name:t}):O(e)?Re.set(e,{name:t}):"function"!=typeof e||ja(e)||nt(e)?e:b(e)?at(e):Ga(t,e)}function X(e){return e}var Z="override";function ee(e,a){return{annotationType_:e,options_:a,make_:ae,extend_:te,decorate_20223_:ne}}function ae(e,a,t,n){var r;if(null!=(r=this.options_)&&r.bound)return null===this.extend_(e,a,t,!1)?0:1;if(n===e.target_)return null===this.extend_(e,a,t,!1)?0:2;if(ja(t.value))return 1;var i=re(e,this,a,t,!1);return l(n,a,i),2}function te(e,a,t,n){var r=re(e,this,a,t);return e.defineProperty_(a,r,n)}function ne(e,a){var t=a.kind,n=a.name,r=a.addInitializer,s=this;if("field"!=t){var o,d,c,l,h,u;if("method"==t)return ja(e)||(d=e,e=_e(null!=(c=null==(l=s.options_)?void 0:l.name)?c:n.toString(),d,null!=(h=null==(u=s.options_)?void 0:u.autoAction)&&h)),null!=(o=this.options_)&&o.bound&&r((function(){var e=this,a=e[n].bind(e);a.isMobxAction=!0,e[n]=a})),e;i("Cannot apply '"+s.annotationType_+"' to '"+String(n)+"' (kind: "+t+"):\n'"+s.annotationType_+"' can only be used on properties with a function value.")}else r((function(){q(this,n,s)}))}function re(e,a,t,n,r){var i,s,o,d,c,l,h,u;void 0===r&&(r=ya.safeDescriptors),u=n,a.annotationType_,u.value;var g,f=n.value;null!=(i=a.options_)&&i.bound&&(f=f.bind(null!=(g=e.proxy_)?g:e.target_));return{value:_e(null!=(s=null==(o=a.options_)?void 0:o.name)?s:t.toString(),f,null!=(d=null==(c=a.options_)?void 0:c.autoAction)&&d,null!=(l=a.options_)&&l.bound?null!=(h=e.proxy_)?h:e.target_:void 0),configurable:!r||e.isPlainObject_,enumerable:!1,writable:!r}}function ie(e,a){return{annotationType_:e,options_:a,make_:se,extend_:oe,decorate_20223_:de}}function se(e,a,t,n){var r;if(n===e.target_)return null===this.extend_(e,a,t,!1)?0:2;if(null!=(r=this.options_)&&r.bound&&(!k(e.target_,a)||!nt(e.target_[a]))&&null===this.extend_(e,a,t,!1))return 0;if(nt(t.value))return 1;var i=ce(e,this,a,t,!1,!1);return l(n,a,i),2}function oe(e,a,t,n){var r,i=ce(e,this,a,t,null==(r=this.options_)?void 0:r.bound);return e.defineProperty_(a,i,n)}function de(e,a){var t;var n=a.name,r=a.addInitializer;return nt(e)||(e=at(e)),null!=(t=this.options_)&&t.bound&&r((function(){var e=this,a=e[n].bind(e);a.isMobXFlow=!0,e[n]=a})),e}function ce(e,a,t,n,r,i){var s;void 0===i&&(i=ya.safeDescriptors),s=n,a.annotationType_,s.value;var o,d=n.value;(nt(d)||(d=at(d)),r)&&((d=d.bind(null!=(o=e.proxy_)?o:e.target_)).isMobXFlow=!0);return{value:d,configurable:!i||e.isPlainObject_,enumerable:!1,writable:!i}}function le(e,a){return{annotationType_:e,options_:a,make_:he,extend_:ue,decorate_20223_:ge}}function he(e,a,t){return null===this.extend_(e,a,t,!1)?0:1}function ue(e,a,t,n){return function(e,a,t,n){a.annotationType_,n.get;0}(0,this,0,t),e.defineComputedProperty_(a,N({},this.options_,{get:t.get,set:t.set}),n)}function ge(e,a){var t=this,n=a.name;return(0,a.addInitializer)((function(){var a=Jt(this)[J],r=N({},t.options_,{get:e,context:this});r.name||(r.name="ObservableObject."+n.toString()),a.values_.set(n,new ea(r))})),function(){return this[J].getObservablePropValue_(n)}}function fe(e,a){return{annotationType_:e,options_:a,make_:pe,extend_:we,decorate_20223_:ye}}function pe(e,a,t){return null===this.extend_(e,a,t,!1)?0:1}function we(e,a,t,n){var r,i;return function(e,a,t,n){a.annotationType_;0}(0,this),e.defineObservableProperty_(a,t.value,null!=(r=null==(i=this.options_)?void 0:i.enhancer)?r:K,n)}function ye(e,a){var t=this,n=a.kind,r=a.name,i=new WeakSet;function s(e,a){var n,s,o=Jt(e)[J],d=new Qe(a,null!=(n=null==(s=t.options_)?void 0:s.enhancer)?n:K,"ObservableObject."+r.toString(),!1);o.values_.set(r,d),i.add(e)}if("accessor"==n)return{get:function(){return i.has(this)||s(this,e.get.call(this)),this[J].getObservablePropValue_(r)},set:function(e){return i.has(this)||s(this,e),this[J].setObservablePropValue_(r,e)},init:function(e){return i.has(this)||s(this,e),e}}}var me="true",ve=Ae();function Ae(e){return{annotationType_:me,options_:e,make_:Ie,extend_:xe,decorate_20223_:be}}function Ie(e,a,t,n){var r,i,s,o;if(t.get)return Me.make_(e,a,t,n);if(t.set){var d=_e(a.toString(),t.set);return n===e.target_?null===e.defineProperty_(a,{configurable:!ya.safeDescriptors||e.isPlainObject_,set:d})?0:2:(l(n,a,{configurable:!0,set:d}),2)}if(n!==e.target_&&"function"==typeof t.value)return b(t.value)?(null!=(o=this.options_)&&o.autoBind?at.bound:at).make_(e,a,t,n):(null!=(s=this.options_)&&s.autoBind?Ga.bound:Ga).make_(e,a,t,n);var c,h=!1===(null==(r=this.options_)?void 0:r.deep)?Re.ref:Re;"function"==typeof t.value&&null!=(i=this.options_)&&i.autoBind&&(t.value=t.value.bind(null!=(c=e.proxy_)?c:e.target_));return h.make_(e,a,t,n)}function xe(e,a,t,n){var r,i,s;if(t.get)return Me.extend_(e,a,t,n);if(t.set)return e.defineProperty_(a,{configurable:!ya.safeDescriptors||e.isPlainObject_,set:_e(a.toString(),t.set)},n);"function"==typeof t.value&&null!=(r=this.options_)&&r.autoBind&&(t.value=t.value.bind(null!=(s=e.proxy_)?s:e.target_));return(!1===(null==(i=this.options_)?void 0:i.deep)?Re.ref:Re).extend_(e,a,t,n)}function be(e,a){i("'"+this.annotationType_+"' cannot be used as a decorator")}var Te={deep:!0,name:void 0,defaultDecorator:void 0,proxy:!0};function Ee(e){return e||Te}Object.freeze(Te);var Pe=fe("observable"),Se=fe("observable.ref",{enhancer:X}),Oe=fe("observable.shallow",{enhancer:function(e,a,t){return null==e||zt(e)||kt(e)||Mt(e)||jt(e)?e:Array.isArray(e)?Re.array(e,{name:t,deep:!1}):x(e)?Re.object(e,void 0,{name:t,deep:!1}):S(e)?Re.map(e,{name:t,deep:!1}):O(e)?Re.set(e,{name:t,deep:!1}):void 0}}),Ce=fe("observable.struct",{enhancer:function(e,a){return vn(e,a)?a:e}}),De=U(Pe);function Be(e){return!0===e.deep?K:!1===e.deep?X:(a=e.defaultDecorator)&&null!=(t=null==(n=a.options_)?void 0:n.enhancer)?t:K;var a,t,n}function ke(e,a,t){return _(a)?Pe.decorate_20223_(e,a):A(a)?void q(e,a,Pe):it(e)?e:x(e)?Re.object(e,a,t):Array.isArray(e)?Re.array(e,a):S(e)?Re.map(e,a):O(e)?Re.set(e,a):"object"==typeof e&&null!==e?e:Re.box(e,a)}d(ke,De);var Le,Fe,Re=d(ke,{box:function(e,a){var t=Ee(a);return new Qe(e,Be(t),t.name,!0,t.equals)},array:function(e,a){var t=Ee(a);return(!1===ya.useProxies||!1===t.proxy?cn:bt)(e,Be(t),t.name)},map:function(e,a){var t=Ee(a);return new Wt(e,Be(t),t.name)},set:function(e,a){var t=Ee(a);return new Ht(e,Be(t),t.name)},object:function(e,a,t){return gn((function(){return Qa(!1===ya.useProxies||!1===(null==t?void 0:t.proxy)?Jt({},t):function(e,a){var t,n;return w(),e=Jt(e,a),null!=(n=(t=e[J]).proxy_)?n:t.proxy_=new Proxy(e,ht)}({},t),e,a)}))},ref:U(Se),shallow:U(Oe),deep:De,struct:U(Ce)}),Ne="computed",$e=le(Ne),We=le("computed.struct",{equals:Q.structural}),Me=function(e,a){if(_(a))return $e.decorate_20223_(e,a);if(A(a))return q(e,a,$e);if(x(e))return U(le(Ne,e));var t=x(a)?a:{};return t.get=e,t.name||(t.name=e.name||""),new ea(t)};Object.assign(Me,$e),Me.struct=U(We);var Ge,He=0,je=1,Ue=null!=(Le=null==(Fe=c((function(){}),"name"))?void 0:Fe.configurable)&&Le,qe={value:"action",configurable:!0,writable:!1,enumerable:!1};function _e(e,a,t,n){function r(){return Je(e,t,a,n||this,arguments)}return void 0===t&&(t=!1),r.isMobxAction=!0,r.toString=function(){return a.toString()},Ue&&(qe.value=e,l(r,"name",qe)),r}function Je(e,a,t,n,r){var s=function(e,a,t,n){var r=!1,i=0;0;var s=ya.trackingDerivation,o=!a||!s;Ia();var d=ya.allowStateChanges;o&&(ca(),d=Ve(!0));var c=ha(!0),l={runAsAction_:o,prevDerivation_:s,prevAllowStateChanges_:d,prevAllowStateReads_:c,notifySpy_:r,startTime_:i,actionId_:je++,parentActionId_:He};return He=l.actionId_,l}(0,a);try{return t.apply(n,r)}catch(e){throw s.error_=e,e}finally{!function(e){He!==e.actionId_&&i(30);He=e.parentActionId_,void 0!==e.error_&&(ya.suppressReactionErrors=!0);Ye(e.prevAllowStateChanges_),ua(e.prevAllowStateReads_),xa(),e.runAsAction_&&la(e.prevDerivation_);0;ya.suppressReactionErrors=!1}(s)}}function Ve(e){var a=ya.allowStateChanges;return ya.allowStateChanges=e,a}function Ye(e){ya.allowStateChanges=e}Ge=Symbol.toPrimitive;var ze,Qe=function(e){function a(a,t,n,r,i){var s;return void 0===n&&(n="ObservableValue"),void 0===r&&(r=!0),void 0===i&&(i=Q.default),(s=e.call(this,n)||this).enhancer=void 0,s.name_=void 0,s.equals=void 0,s.hasUnreportedChange_=!1,s.interceptors_=void 0,s.changeListeners_=void 0,s.value_=void 0,s.dehancer=void 0,s.enhancer=t,s.name_=n,s.equals=i,s.value_=t(a,void 0,n),s}$(a,e);var t=a.prototype;return t.dehanceValue=function(e){return void 0!==this.dehancer?this.dehancer(e):e},t.set=function(e){this.value_;if((e=this.prepareNewValue_(e))!==ya.UNCHANGED){0,this.setNewValue_(e)}},t.prepareNewValue_=function(e){if(ia(this),ut(this)){var a=ft(this,{object:this,type:At,newValue:e});if(!a)return ya.UNCHANGED;e=a.newValue}return e=this.enhancer(e,this.value_,this.name_),this.equals(this.value_,e)?ya.UNCHANGED:e},t.setNewValue_=function(e){var a=this.value_;this.value_=e,this.reportChanged(),pt(this)&&yt(this,{type:At,object:this,newValue:e,oldValue:a})},t.get=function(){return this.reportObserved(),this.dehanceValue(this.value_)},t.intercept_=function(e){return gt(this,e)},t.observe_=function(e,a){return a&&e({observableKind:"value",debugObjectName:this.name_,object:this,type:At,newValue:this.value_,oldValue:void 0}),wt(this,e)},t.raw=function(){return this.value_},t.toJSON=function(){return this.get()},t.toString=function(){return this.name_+"["+this.value_+"]"},t.valueOf=function(){return B(this.get())},t[Ge]=function(){return this.valueOf()},a}(V),Ke=P("ObservableValue",Qe);ze=Symbol.toPrimitive;var Xe,Ze,ea=function(){function e(e){this.dependenciesState_=Xe.NOT_TRACKING_,this.observing_=[],this.newObserving_=null,this.isBeingObserved_=!1,this.isPendingUnobservation_=!1,this.observers_=new Set,this.diffValue_=0,this.runId_=0,this.lastAccessedBy_=0,this.lowestObserverState_=Xe.UP_TO_DATE_,this.unboundDepsCount_=0,this.value_=new ta(null),this.name_=void 0,this.triggeredBy_=void 0,this.isComputing_=!1,this.isRunningSetter_=!1,this.derivation=void 0,this.setter_=void 0,this.isTracing_=Ze.NONE,this.scope_=void 0,this.equals_=void 0,this.requiresReaction_=void 0,this.keepAlive_=void 0,this.onBOL=void 0,this.onBUOL=void 0,e.get||i(31),this.derivation=e.get,this.name_=e.name||"ComputedValue",e.set&&(this.setter_=_e("ComputedValue-setter",e.set)),this.equals_=e.equals||(e.compareStructural||e.struct?Q.structural:Q.default),this.scope_=e.context,this.requiresReaction_=e.requiresReaction,this.keepAlive_=!!e.keepAlive}var a=e.prototype;return a.onBecomeStale_=function(){!function(e){if(e.lowestObserverState_!==Xe.UP_TO_DATE_)return;e.lowestObserverState_=Xe.POSSIBLY_STALE_,e.observers_.forEach((function(e){e.dependenciesState_===Xe.UP_TO_DATE_&&(e.dependenciesState_=Xe.POSSIBLY_STALE_,e.onBecomeStale_())}))}(this)},a.onBO=function(){this.onBOL&&this.onBOL.forEach((function(e){return e()}))},a.onBUO=function(){this.onBUOL&&this.onBUOL.forEach((function(e){return e()}))},a.get=function(){if(this.isComputing_&&i(32,this.name_,this.derivation),0!==ya.inBatch||0!==this.observers_.size||this.keepAlive_){if(ba(this),ra(this)){var e=ya.trackingContext;this.keepAlive_&&!e&&(ya.trackingContext=this),this.trackAndCompute()&&function(e){if(e.lowestObserverState_===Xe.STALE_)return;e.lowestObserverState_=Xe.STALE_,e.observers_.forEach((function(a){a.dependenciesState_===Xe.POSSIBLY_STALE_?a.dependenciesState_=Xe.STALE_:a.dependenciesState_===Xe.UP_TO_DATE_&&(e.lowestObserverState_=Xe.UP_TO_DATE_)}))}(this),ya.trackingContext=e}}else ra(this)&&(this.warnAboutUntrackedRead_(),Ia(),this.value_=this.computeValue_(!1),xa());var a=this.value_;if(na(a))throw a.cause;return a},a.set=function(e){if(this.setter_){this.isRunningSetter_&&i(33,this.name_),this.isRunningSetter_=!0;try{this.setter_.call(this.scope_,e)}finally{this.isRunningSetter_=!1}}else i(34,this.name_)},a.trackAndCompute=function(){var e=this.value_,a=this.dependenciesState_===Xe.NOT_TRACKING_,t=this.computeValue_(!0),n=a||na(e)||na(t)||!this.equals_(e,t);return n&&(this.value_=t),n},a.computeValue_=function(e){this.isComputing_=!0;var a,t=Ve(!1);if(e)a=sa(this,this.derivation,this.scope_);else if(!0===ya.disableErrorBoundaries)a=this.derivation.call(this.scope_);else try{a=this.derivation.call(this.scope_)}catch(e){a=new ta(e)}return Ye(t),this.isComputing_=!1,a},a.suspend_=function(){this.keepAlive_||(oa(this),this.value_=void 0)},a.observe_=function(e,a){var t=this,n=!0,r=void 0;return Ua((function(){var i=t.get();if(!n||a){var s=ca();e({observableKind:"computed",debugObjectName:t.name_,type:At,object:t,newValue:i,oldValue:r}),la(s)}n=!1,r=i}))},a.warnAboutUntrackedRead_=function(){},a.toString=function(){return this.name_+"["+this.derivation.toString()+"]"},a.valueOf=function(){return B(this.get())},a[ze]=function(){return this.valueOf()},e}(),aa=P("ComputedValue",ea);!function(e){e[e.NOT_TRACKING_=-1]="NOT_TRACKING_",e[e.UP_TO_DATE_=0]="UP_TO_DATE_",e[e.POSSIBLY_STALE_=1]="POSSIBLY_STALE_",e[e.STALE_=2]="STALE_"}(Xe||(Xe={})),function(e){e[e.NONE=0]="NONE",e[e.LOG=1]="LOG",e[e.BREAK=2]="BREAK"}(Ze||(Ze={}));var ta=function(e){this.cause=void 0,this.cause=e};function na(e){return e instanceof ta}function ra(e){switch(e.dependenciesState_){case Xe.UP_TO_DATE_:return!1;case Xe.NOT_TRACKING_:case Xe.STALE_:return!0;case Xe.POSSIBLY_STALE_:for(var a=ha(!0),t=ca(),n=e.observing_,r=n.length,i=0;i<r;i++){var s=n[i];if(aa(s)){if(ya.disableErrorBoundaries)s.get();else try{s.get()}catch(e){return la(t),ua(a),!0}if(e.dependenciesState_===Xe.STALE_)return la(t),ua(a),!0}}return ga(e),la(t),ua(a),!1}}function ia(e){}function sa(e,a,t){var n=ha(!0);ga(e),e.newObserving_=new Array(e.observing_.length+100),e.unboundDepsCount_=0,e.runId_=++ya.runId;var r,i=ya.trackingDerivation;if(ya.trackingDerivation=e,ya.inBatch++,!0===ya.disableErrorBoundaries)r=a.call(t);else try{r=a.call(t)}catch(e){r=new ta(e)}return ya.inBatch--,ya.trackingDerivation=i,function(e){for(var a=e.observing_,t=e.observing_=e.newObserving_,n=Xe.UP_TO_DATE_,r=0,i=e.unboundDepsCount_,s=0;s<i;s++){var o=t[s];0===o.diffValue_&&(o.diffValue_=1,r!==s&&(t[r]=o),r++),o.dependenciesState_>n&&(n=o.dependenciesState_)}t.length=r,e.newObserving_=null,i=a.length;for(;i--;){var d=a[i];0===d.diffValue_&&va(d,e),d.diffValue_=0}for(;r--;){var c=t[r];1===c.diffValue_&&(c.diffValue_=0,ma(c,e))}n!==Xe.UP_TO_DATE_&&(e.dependenciesState_=n,e.onBecomeStale_())}(e),ua(n),r}function oa(e){var a=e.observing_;e.observing_=[];for(var t=a.length;t--;)va(a[t],e);e.dependenciesState_=Xe.NOT_TRACKING_}function da(e){var a=ca();try{return e()}finally{la(a)}}function ca(){var e=ya.trackingDerivation;return ya.trackingDerivation=null,e}function la(e){ya.trackingDerivation=e}function ha(e){var a=ya.allowStateReads;return ya.allowStateReads=e,a}function ua(e){ya.allowStateReads=e}function ga(e){if(e.dependenciesState_!==Xe.UP_TO_DATE_){e.dependenciesState_=Xe.UP_TO_DATE_;for(var a=e.observing_,t=a.length;t--;)a[t].lowestObserverState_=Xe.UP_TO_DATE_}}var fa=function(){this.version=6,this.UNCHANGED={},this.trackingDerivation=null,this.trackingContext=null,this.runId=0,this.mobxGuid=0,this.inBatch=0,this.pendingUnobservations=[],this.pendingReactions=[],this.isRunningReactions=!1,this.allowStateChanges=!1,this.allowStateReads=!0,this.enforceActions=!0,this.spyListeners=[],this.globalReactionErrorHandlers=[],this.computedRequiresReaction=!1,this.reactionRequiresObservable=!1,this.observableRequiresReaction=!1,this.disableErrorBoundaries=!1,this.suppressReactionErrors=!1,this.useProxies=!0,this.verifyProxies=!1,this.safeDescriptors=!0},pa=!0,wa=!1,ya=function(){var e=o();return e.__mobxInstanceCount>0&&!e.__mobxGlobals&&(pa=!1),e.__mobxGlobals&&e.__mobxGlobals.version!==(new fa).version&&(pa=!1),pa?e.__mobxGlobals?(e.__mobxInstanceCount+=1,e.__mobxGlobals.UNCHANGED||(e.__mobxGlobals.UNCHANGED={}),e.__mobxGlobals):(e.__mobxInstanceCount=1,e.__mobxGlobals=new fa):(setTimeout((function(){wa||i(35)}),1),new fa)}();function ma(e,a){e.observers_.add(a),e.lowestObserverState_>a.dependenciesState_&&(e.lowestObserverState_=a.dependenciesState_)}function va(e,a){e.observers_.delete(a),0===e.observers_.size&&Aa(e)}function Aa(e){!1===e.isPendingUnobservation_&&(e.isPendingUnobservation_=!0,ya.pendingUnobservations.push(e))}function Ia(){ya.inBatch++}function xa(){if(0==--ya.inBatch){Oa();for(var e=ya.pendingUnobservations,a=0;a<e.length;a++){var t=e[a];t.isPendingUnobservation_=!1,0===t.observers_.size&&(t.isBeingObserved_&&(t.isBeingObserved_=!1,t.onBUO()),t instanceof ea&&t.suspend_())}ya.pendingUnobservations=[]}}function ba(e){var a=ya.trackingDerivation;return null!==a?(a.runId_!==e.lastAccessedBy_&&(e.lastAccessedBy_=a.runId_,a.newObserving_[a.unboundDepsCount_++]=e,!e.isBeingObserved_&&ya.trackingContext&&(e.isBeingObserved_=!0,e.onBO())),e.isBeingObserved_):(0===e.observers_.size&&ya.inBatch>0&&Aa(e),!1)}function Ta(e){e.lowestObserverState_!==Xe.STALE_&&(e.lowestObserverState_=Xe.STALE_,e.observers_.forEach((function(e){e.dependenciesState_===Xe.UP_TO_DATE_&&e.onBecomeStale_(),e.dependenciesState_=Xe.STALE_})))}var Ea=function(){function e(e,a,t,n){void 0===e&&(e="Reaction"),this.name_=void 0,this.onInvalidate_=void 0,this.errorHandler_=void 0,this.requiresObservable_=void 0,this.observing_=[],this.newObserving_=[],this.dependenciesState_=Xe.NOT_TRACKING_,this.diffValue_=0,this.runId_=0,this.unboundDepsCount_=0,this.isDisposed_=!1,this.isScheduled_=!1,this.isTrackPending_=!1,this.isRunning_=!1,this.isTracing_=Ze.NONE,this.name_=e,this.onInvalidate_=a,this.errorHandler_=t,this.requiresObservable_=n}var a=e.prototype;return a.onBecomeStale_=function(){this.schedule_()},a.schedule_=function(){this.isScheduled_||(this.isScheduled_=!0,ya.pendingReactions.push(this),Oa())},a.isScheduled=function(){return this.isScheduled_},a.runReaction_=function(){if(!this.isDisposed_){Ia(),this.isScheduled_=!1;var e=ya.trackingContext;if(ya.trackingContext=this,ra(this)){this.isTrackPending_=!0;try{this.onInvalidate_()}catch(e){this.reportExceptionInDerivation_(e)}}ya.trackingContext=e,xa()}},a.track=function(e){if(!this.isDisposed_){Ia();0,this.isRunning_=!0;var a=ya.trackingContext;ya.trackingContext=this;var t=sa(this,e,void 0);ya.trackingContext=a,this.isRunning_=!1,this.isTrackPending_=!1,this.isDisposed_&&oa(this),na(t)&&this.reportExceptionInDerivation_(t.cause),xa()}},a.reportExceptionInDerivation_=function(e){var a=this;if(this.errorHandler_)this.errorHandler_(e,this);else{if(ya.disableErrorBoundaries)throw e;var t="[mobx] uncaught error in '"+this+"'";ya.suppressReactionErrors||console.error(t,e),ya.globalReactionErrorHandlers.forEach((function(t){return t(e,a)}))}},a.dispose=function(){this.isDisposed_||(this.isDisposed_=!0,this.isRunning_||(Ia(),oa(this),xa()))},a.getDisposer_=function(e){var a=this,t=function t(){a.dispose(),null==e||null==e.removeEventListener||e.removeEventListener("abort",t)};return null==e||null==e.addEventListener||e.addEventListener("abort",t),t[J]=this,t},a.toString=function(){return"Reaction["+this.name_+"]"},a.trace=function(e){void 0===e&&(e=!1)},e}();var Pa=100,Sa=function(e){return e()};function Oa(){ya.inBatch>0||ya.isRunningReactions||Sa(Ca)}function Ca(){ya.isRunningReactions=!0;for(var e=ya.pendingReactions,a=0;e.length>0;){++a===Pa&&(console.error("[mobx] cycle in reaction: "+e[0]),e.splice(0));for(var t=e.splice(0),n=0,r=t.length;n<r;n++)t[n].runReaction_()}ya.isRunningReactions=!1}var Da=P("Reaction",Ea);var Ba="action",ka="autoAction",La="<unnamed action>",Fa=ee(Ba),Ra=ee("action.bound",{bound:!0}),Na=ee(ka,{autoAction:!0}),$a=ee("autoAction.bound",{autoAction:!0,bound:!0});function Wa(e){return function(a,t){return v(a)?_e(a.name||La,a,e):v(t)?_e(a,t,e):_(t)?(e?Na:Fa).decorate_20223_(a,t):A(t)?q(a,t,e?Na:Fa):A(a)?U(ee(e?ka:Ba,{name:a,autoAction:e})):void 0}}var Ma=Wa(!1);Object.assign(Ma,Fa);var Ga=Wa(!0);function Ha(e){return Je(e.name,!1,e,this,void 0)}function ja(e){return v(e)&&!0===e.isMobxAction}function Ua(e,a){var t,n,r,i,s;void 0===a&&(a=g);var o,d=null!=(t=null==(n=a)?void 0:n.name)?t:"Autorun";if(!a.scheduler&&!a.delay)o=new Ea(d,(function(){this.track(h)}),a.onError,a.requiresObservable);else{var c=_a(a),l=!1;o=new Ea(d,(function(){l||(l=!0,c((function(){l=!1,o.isDisposed_||o.track(h)})))}),a.onError,a.requiresObservable)}function h(){e(o)}return null!=(r=a)&&null!=(i=r.signal)&&i.aborted||o.schedule_(),o.getDisposer_(null==(s=a)?void 0:s.signal)}Object.assign(Ga,Na),Ma.bound=U(Ra),Ga.bound=U($a);var qa=function(e){return e()};function _a(e){return e.scheduler?e.scheduler:e.delay?function(a){return setTimeout(a,e.delay)}:qa}var Ja="onBO",Va="onBUO";function Ya(e,a,t){return za(Va,e,a,t)}function za(e,a,t,n){var r="function"==typeof n?ln(a,t):ln(a),i=v(n)?n:t,s=e+"L";return r[s]?r[s].add(i):r[s]=new Set([i]),function(){var e=r[s];e&&(e.delete(i),0===e.size&&delete r[s])}}function Qa(e,a,t,n){var r=L(a);return gn((function(){var a=Jt(e,n)[J];D(r).forEach((function(e){a.extend_(e,r[e],!t||(!(e in t)||t[e]))}))})),e}var Ka=0;function Xa(){this.message="FLOW_CANCELLED"}Xa.prototype=Object.create(Error.prototype);var Za=ie("flow"),et=ie("flow.bound",{bound:!0}),at=Object.assign((function(e,a){if(_(a))return Za.decorate_20223_(e,a);if(A(a))return q(e,a,Za);var t=e,n=t.name||"<unnamed flow>",r=function(){var e,a=arguments,r=++Ka,i=Ma(n+" - runid: "+r+" - init",t).apply(this,a),s=void 0,o=new Promise((function(a,t){var o=0;function d(e){var a;s=void 0;try{a=Ma(n+" - runid: "+r+" - yield "+o++,i.next).call(i,e)}catch(e){return t(e)}l(a)}function c(e){var a;s=void 0;try{a=Ma(n+" - runid: "+r+" - yield "+o++,i.throw).call(i,e)}catch(e){return t(e)}l(a)}function l(e){if(!v(null==e?void 0:e.then))return e.done?a(e.value):(s=Promise.resolve(e.value)).then(d,c);e.then(l,t)}e=t,d(void 0)}));return o.cancel=Ma(n+" - runid: "+r+" - cancel",(function(){try{s&&tt(s);var a=i.return(void 0),t=Promise.resolve(a.value);t.then(m,m),tt(t),e(new Xa)}catch(a){e(a)}})),o};return r.isMobXFlow=!0,r}),Za);function tt(e){v(e.cancel)&&e.cancel()}function nt(e){return!0===(null==e?void 0:e.isMobXFlow)}function rt(e,a){return!!e&&(void 0!==a?!!zt(e)&&e[J].values_.has(a):zt(e)||!!e[J]||Y(e)||Da(e)||aa(e))}function it(e){return rt(e)}function st(e,a,t){return e.set(a,t),t}function ot(e,a){if(null==e||"object"!=typeof e||e instanceof Date||!it(e))return e;if(Ke(e)||aa(e))return ot(e.get(),a);if(a.has(e))return a.get(e);if(kt(e)){var t=st(a,e,new Array(e.length));return e.forEach((function(e,n){t[n]=ot(e,a)})),t}if(jt(e)){var n=st(a,e,new Set);return e.forEach((function(e){n.add(ot(e,a))})),n}if(Mt(e)){var r=st(a,e,new Map);return e.forEach((function(e,t){r.set(t,ot(e,a))})),r}var s=st(a,e,{});return function(e){if(zt(e))return e[J].ownKeys_();i(38)}(e).forEach((function(t){h.propertyIsEnumerable.call(e,t)&&(s[t]=ot(e[t],a))})),s}function dt(e,a){return ot(e,new Map)}function ct(e,a){void 0===a&&(a=void 0),Ia();try{return e.apply(a)}finally{xa()}}function lt(e){return e[J]}at.bound=U(et);var ht={has:function(e,a){return lt(e).has_(a)},get:function(e,a){return lt(e).get_(a)},set:function(e,a,t){var n;return!!A(a)&&(null==(n=lt(e).set_(a,t,!0))||n)},deleteProperty:function(e,a){var t;return!!A(a)&&(null==(t=lt(e).delete_(a,!0))||t)},defineProperty:function(e,a,t){var n;return null==(n=lt(e).defineProperty_(a,t))||n},ownKeys:function(e){return lt(e).ownKeys_()},preventExtensions:function(e){i(13)}};function ut(e){return void 0!==e.interceptors_&&e.interceptors_.length>0}function gt(e,a){var t=e.interceptors_||(e.interceptors_=[]);return t.push(a),y((function(){var e=t.indexOf(a);-1!==e&&t.splice(e,1)}))}function ft(e,a){var t=ca();try{for(var n=[].concat(e.interceptors_||[]),r=0,s=n.length;r<s&&((a=n[r](a))&&!a.type&&i(14),a);r++);return a}finally{la(t)}}function pt(e){return void 0!==e.changeListeners_&&e.changeListeners_.length>0}function wt(e,a){var t=e.changeListeners_||(e.changeListeners_=[]);return t.push(a),y((function(){var e=t.indexOf(a);-1!==e&&t.splice(e,1)}))}function yt(e,a){var t=ca(),n=e.changeListeners_;if(n){for(var r=0,i=(n=n.slice()).length;r<i;r++)n[r](a);la(t)}}function mt(e,a,t){return gn((function(){var n=Jt(e,t)[J];null!=a||(a=function(e){return k(e,j)||T(e,j,N({},e[j])),e[j]}(e)),D(a).forEach((function(e){return n.make_(e,a[e])}))})),e}var vt="splice",At="update",It={get:function(e,a){var t=e[J];return a===J?t:"length"===a?t.getArrayLength_():"string"!=typeof a||isNaN(a)?k(Tt,a)?Tt[a]:e[a]:t.get_(parseInt(a))},set:function(e,a,t){var n=e[J];return"length"===a&&n.setArrayLength_(t),"symbol"==typeof a||isNaN(a)?e[a]=t:n.set_(parseInt(a),t),!0},preventExtensions:function(){i(15)}},xt=function(){function e(e,a,t,n){void 0===e&&(e="ObservableArray"),this.owned_=void 0,this.legacyMode_=void 0,this.atom_=void 0,this.values_=[],this.interceptors_=void 0,this.changeListeners_=void 0,this.enhancer_=void 0,this.dehancer=void 0,this.proxy_=void 0,this.lastKnownLength_=0,this.owned_=t,this.legacyMode_=n,this.atom_=new V(e),this.enhancer_=function(e,t){return a(e,t,"ObservableArray[..]")}}var a=e.prototype;return a.dehanceValue_=function(e){return void 0!==this.dehancer?this.dehancer(e):e},a.dehanceValues_=function(e){return void 0!==this.dehancer&&e.length>0?e.map(this.dehancer):e},a.intercept_=function(e){return gt(this,e)},a.observe_=function(e,a){return void 0===a&&(a=!1),a&&e({observableKind:"array",object:this.proxy_,debugObjectName:this.atom_.name_,type:"splice",index:0,added:this.values_.slice(),addedCount:this.values_.length,removed:[],removedCount:0}),wt(this,e)},a.getArrayLength_=function(){return this.atom_.reportObserved(),this.values_.length},a.setArrayLength_=function(e){("number"!=typeof e||isNaN(e)||e<0)&&i("Out of range: "+e);var a=this.values_.length;if(e!==a)if(e>a){for(var t=new Array(e-a),n=0;n<e-a;n++)t[n]=void 0;this.spliceWithArray_(a,0,t)}else this.spliceWithArray_(e,a-e)},a.updateArrayLength_=function(e,a){e!==this.lastKnownLength_&&i(16),this.lastKnownLength_+=a,this.legacyMode_&&a>0&&dn(e+a+1)},a.spliceWithArray_=function(e,a,t){var n=this;this.atom_;var r=this.values_.length;if(void 0===e?e=0:e>r?e=r:e<0&&(e=Math.max(0,r+e)),a=1===arguments.length?r-e:null==a?0:Math.max(0,Math.min(a,r-e)),void 0===t&&(t=u),ut(this)){var i=ft(this,{object:this.proxy_,type:vt,index:e,removedCount:a,added:t});if(!i)return u;a=i.removedCount,t=i.added}if(t=0===t.length?t:t.map((function(e){return n.enhancer_(e,void 0)})),this.legacyMode_){var s=t.length-a;this.updateArrayLength_(r,s)}var o=this.spliceItemsIntoValues_(e,a,t);return 0===a&&0===t.length||this.notifyArraySplice_(e,t,o),this.dehanceValues_(o)},a.spliceItemsIntoValues_=function(e,a,t){var n;if(t.length<1e4)return(n=this.values_).splice.apply(n,[e,a].concat(t));var r=this.values_.slice(e,e+a),i=this.values_.slice(e+a);this.values_.length+=t.length-a;for(var s=0;s<t.length;s++)this.values_[e+s]=t[s];for(var o=0;o<i.length;o++)this.values_[e+t.length+o]=i[o];return r},a.notifyArrayChildUpdate_=function(e,a,t){var n=!this.owned_&&!1,r=pt(this),i=r||n?{observableKind:"array",object:this.proxy_,type:At,debugObjectName:this.atom_.name_,index:e,newValue:a,oldValue:t}:null;this.atom_.reportChanged(),r&&yt(this,i)},a.notifyArraySplice_=function(e,a,t){var n=!this.owned_&&!1,r=pt(this),i=r||n?{observableKind:"array",object:this.proxy_,debugObjectName:this.atom_.name_,type:vt,index:e,removed:t,added:a,removedCount:t.length,addedCount:a.length}:null;this.atom_.reportChanged(),r&&yt(this,i)},a.get_=function(e){if(!(this.legacyMode_&&e>=this.values_.length))return this.atom_.reportObserved(),this.dehanceValue_(this.values_[e]);console.warn("[mobx] Out of bounds read: "+e)},a.set_=function(e,a){var t=this.values_;if(this.legacyMode_&&e>t.length&&i(17,e,t.length),e<t.length){this.atom_;var n=t[e];if(ut(this)){var r=ft(this,{type:At,object:this.proxy_,index:e,newValue:a});if(!r)return;a=r.newValue}(a=this.enhancer_(a,n))!==n&&(t[e]=a,this.notifyArrayChildUpdate_(e,a,n))}else{for(var s=new Array(e+1-t.length),o=0;o<s.length-1;o++)s[o]=void 0;s[s.length-1]=a,this.spliceWithArray_(t.length,0,s)}},e}();function bt(e,a,t,n){return void 0===t&&(t="ObservableArray"),void 0===n&&(n=!1),w(),gn((function(){var r=new xt(t,a,n,!1);E(r.values_,J,r);var i=new Proxy(r.values_,It);return r.proxy_=i,e&&e.length&&r.spliceWithArray_(0,0,e),i}))}var Tt={clear:function(){return this.splice(0)},replace:function(e){var a=this[J];return a.spliceWithArray_(0,a.values_.length,e)},toJSON:function(){return this.slice()},splice:function(e,a){for(var t=arguments.length,n=new Array(t>2?t-2:0),r=2;r<t;r++)n[r-2]=arguments[r];var i=this[J];switch(arguments.length){case 0:return[];case 1:return i.spliceWithArray_(e);case 2:return i.spliceWithArray_(e,a)}return i.spliceWithArray_(e,a,n)},spliceWithArray:function(e,a,t){return this[J].spliceWithArray_(e,a,t)},push:function(){for(var e=this[J],a=arguments.length,t=new Array(a),n=0;n<a;n++)t[n]=arguments[n];return e.spliceWithArray_(e.values_.length,0,t),e.values_.length},pop:function(){return this.splice(Math.max(this[J].values_.length-1,0),1)[0]},shift:function(){return this.splice(0,1)[0]},unshift:function(){for(var e=this[J],a=arguments.length,t=new Array(a),n=0;n<a;n++)t[n]=arguments[n];return e.spliceWithArray_(0,0,t),e.values_.length},reverse:function(){return ya.trackingDerivation&&i(37,"reverse"),this.replace(this.slice().reverse()),this},sort:function(){ya.trackingDerivation&&i(37,"sort");var e=this.slice();return e.sort.apply(e,arguments),this.replace(e),this},remove:function(e){var a=this[J],t=a.dehanceValues_(a.values_).indexOf(e);return t>-1&&(this.splice(t,1),!0)}};function Et(e,a){"function"==typeof Array.prototype[e]&&(Tt[e]=a(e))}function Pt(e){return function(){var a=this[J];a.atom_.reportObserved();var t=a.dehanceValues_(a.values_);return t[e].apply(t,arguments)}}function St(e){return function(a,t){var n=this,r=this[J];return r.atom_.reportObserved(),r.dehanceValues_(r.values_)[e]((function(e,r){return a.call(t,e,r,n)}))}}function Ot(e){return function(){var a=this,t=this[J];t.atom_.reportObserved();var n=t.dehanceValues_(t.values_),r=arguments[0];return arguments[0]=function(e,t,n){return r(e,t,n,a)},n[e].apply(n,arguments)}}Et("at",Pt),Et("concat",Pt),Et("flat",Pt),Et("includes",Pt),Et("indexOf",Pt),Et("join",Pt),Et("lastIndexOf",Pt),Et("slice",Pt),Et("toString",Pt),Et("toLocaleString",Pt),Et("toSorted",Pt),Et("toSpliced",Pt),Et("with",Pt),Et("every",St),Et("filter",St),Et("find",St),Et("findIndex",St),Et("findLast",St),Et("findLastIndex",St),Et("flatMap",St),Et("forEach",St),Et("map",St),Et("some",St),Et("toReversed",St),Et("reduce",Ot),Et("reduceRight",Ot);var Ct,Dt,Bt=P("ObservableArrayAdministration",xt);function kt(e){return I(e)&&Bt(e[J])}var Lt={},Ft="add",Rt="delete";Ct=Symbol.iterator,Dt=Symbol.toStringTag;var Nt,$t,Wt=function(){function e(e,a,t){var n=this;void 0===a&&(a=K),void 0===t&&(t="ObservableMap"),this.enhancer_=void 0,this.name_=void 0,this[J]=Lt,this.data_=void 0,this.hasMap_=void 0,this.keysAtom_=void 0,this.interceptors_=void 0,this.changeListeners_=void 0,this.dehancer=void 0,this.enhancer_=a,this.name_=t,v(Map)||i(18),gn((function(){n.keysAtom_=z("ObservableMap.keys()"),n.data_=new Map,n.hasMap_=new Map,e&&n.merge(e)}))}var a=e.prototype;return a.has_=function(e){return this.data_.has(e)},a.has=function(e){var a=this;if(!ya.trackingDerivation)return this.has_(e);var t=this.hasMap_.get(e);if(!t){var n=t=new Qe(this.has_(e),X,"ObservableMap.key?",!1);this.hasMap_.set(e,n),Ya(n,(function(){return a.hasMap_.delete(e)}))}return t.get()},a.set=function(e,a){var t=this.has_(e);if(ut(this)){var n=ft(this,{type:t?At:Ft,object:this,newValue:a,name:e});if(!n)return this;a=n.newValue}return t?this.updateValue_(e,a):this.addValue_(e,a),this},a.delete=function(e){var a=this;if((this.keysAtom_,ut(this))&&!ft(this,{type:Rt,object:this,name:e}))return!1;if(this.has_(e)){var t=pt(this),n=t?{observableKind:"map",debugObjectName:this.name_,type:Rt,object:this,oldValue:this.data_.get(e).value_,name:e}:null;return ct((function(){var t;a.keysAtom_.reportChanged(),null==(t=a.hasMap_.get(e))||t.setNewValue_(!1),a.data_.get(e).setNewValue_(void 0),a.data_.delete(e)})),t&&yt(this,n),!0}return!1},a.updateValue_=function(e,a){var t=this.data_.get(e);if((a=t.prepareNewValue_(a))!==ya.UNCHANGED){var n=pt(this),r=n?{observableKind:"map",debugObjectName:this.name_,type:At,object:this,oldValue:t.value_,name:e,newValue:a}:null;0,t.setNewValue_(a),n&&yt(this,r)}},a.addValue_=function(e,a){var t=this;this.keysAtom_,ct((function(){var n,r=new Qe(a,t.enhancer_,"ObservableMap.key",!1);t.data_.set(e,r),a=r.value_,null==(n=t.hasMap_.get(e))||n.setNewValue_(!0),t.keysAtom_.reportChanged()}));var n=pt(this),r=n?{observableKind:"map",debugObjectName:this.name_,type:Ft,object:this,name:e,newValue:a}:null;n&&yt(this,r)},a.get=function(e){return this.has(e)?this.dehanceValue_(this.data_.get(e).get()):this.dehanceValue_(void 0)},a.dehanceValue_=function(e){return void 0!==this.dehancer?this.dehancer(e):e},a.keys=function(){return this.keysAtom_.reportObserved(),this.data_.keys()},a.values=function(){var e=this,a=this.keys();return xn({next:function(){var t=a.next(),n=t.done,r=t.value;return{done:n,value:n?void 0:e.get(r)}}})},a.entries=function(){var e=this,a=this.keys();return xn({next:function(){var t=a.next(),n=t.done,r=t.value;return{done:n,value:n?void 0:[r,e.get(r)]}}})},a[Ct]=function(){return this.entries()},a.forEach=function(e,a){for(var t,n=H(this);!(t=n()).done;){var r=t.value,i=r[0],s=r[1];e.call(a,s,i,this)}},a.merge=function(e){var a=this;return Mt(e)&&(e=new Map(e)),ct((function(){x(e)?function(e){var a=Object.keys(e);if(!C)return a;var t=Object.getOwnPropertySymbols(e);return t.length?[].concat(a,t.filter((function(a){return h.propertyIsEnumerable.call(e,a)}))):a}(e).forEach((function(t){return a.set(t,e[t])})):Array.isArray(e)?e.forEach((function(e){var t=e[0],n=e[1];return a.set(t,n)})):S(e)?(e.constructor!==Map&&i(19,e),e.forEach((function(e,t){return a.set(t,e)}))):null!=e&&i(20,e)})),this},a.clear=function(){var e=this;ct((function(){da((function(){for(var a,t=H(e.keys());!(a=t()).done;){var n=a.value;e.delete(n)}}))}))},a.replace=function(e){var a=this;return ct((function(){for(var t,n=function(e){if(S(e)||Mt(e))return e;if(Array.isArray(e))return new Map(e);if(x(e)){var a=new Map;for(var t in e)a.set(t,e[t]);return a}return i(21,e)}(e),r=new Map,s=!1,o=H(a.data_.keys());!(t=o()).done;){var d=t.value;if(!n.has(d))if(a.delete(d))s=!0;else{var c=a.data_.get(d);r.set(d,c)}}for(var l,h=H(n.entries());!(l=h()).done;){var u=l.value,g=u[0],f=u[1],p=a.data_.has(g);if(a.set(g,f),a.data_.has(g)){var w=a.data_.get(g);r.set(g,w),p||(s=!0)}}if(!s)if(a.data_.size!==r.size)a.keysAtom_.reportChanged();else for(var y=a.data_.keys(),m=r.keys(),v=y.next(),A=m.next();!v.done;){if(v.value!==A.value){a.keysAtom_.reportChanged();break}v=y.next(),A=m.next()}a.data_=r})),this},a.toString=function(){return"[object ObservableMap]"},a.toJSON=function(){return Array.from(this)},a.observe_=function(e,a){return wt(this,e)},a.intercept_=function(e){return gt(this,e)},R(e,[{key:"size",get:function(){return this.keysAtom_.reportObserved(),this.data_.size}},{key:Dt,get:function(){return"Map"}}]),e}(),Mt=P("ObservableMap",Wt);var Gt={};Nt=Symbol.iterator,$t=Symbol.toStringTag;var Ht=function(){function e(e,a,t){var n=this;void 0===a&&(a=K),void 0===t&&(t="ObservableSet"),this.name_=void 0,this[J]=Gt,this.data_=new Set,this.atom_=void 0,this.changeListeners_=void 0,this.interceptors_=void 0,this.dehancer=void 0,this.enhancer_=void 0,this.name_=t,v(Set)||i(22),this.enhancer_=function(e,n){return a(e,n,t)},gn((function(){n.atom_=z(n.name_),e&&n.replace(e)}))}var a=e.prototype;return a.dehanceValue_=function(e){return void 0!==this.dehancer?this.dehancer(e):e},a.clear=function(){var e=this;ct((function(){da((function(){for(var a,t=H(e.data_.values());!(a=t()).done;){var n=a.value;e.delete(n)}}))}))},a.forEach=function(e,a){for(var t,n=H(this);!(t=n()).done;){var r=t.value;e.call(a,r,r,this)}},a.add=function(e){var a=this;if((this.atom_,ut(this))&&!ft(this,{type:Ft,object:this,newValue:e}))return this;if(!this.has(e)){ct((function(){a.data_.add(a.enhancer_(e,void 0)),a.atom_.reportChanged()}));var t=!1,n=pt(this),r=n?{observableKind:"set",debugObjectName:this.name_,type:Ft,object:this,newValue:e}:null;t,n&&yt(this,r)}return this},a.delete=function(e){var a=this;if(ut(this)&&!ft(this,{type:Rt,object:this,oldValue:e}))return!1;if(this.has(e)){var t=pt(this),n=t?{observableKind:"set",debugObjectName:this.name_,type:Rt,object:this,oldValue:e}:null;return ct((function(){a.atom_.reportChanged(),a.data_.delete(e)})),t&&yt(this,n),!0}return!1},a.has=function(e){return this.atom_.reportObserved(),this.data_.has(this.dehanceValue_(e))},a.entries=function(){var e=0,a=Array.from(this.keys()),t=Array.from(this.values());return xn({next:function(){var n=e;return e+=1,n<t.length?{value:[a[n],t[n]],done:!1}:{done:!0}}})},a.keys=function(){return this.values()},a.values=function(){this.atom_.reportObserved();var e=this,a=0,t=Array.from(this.data_.values());return xn({next:function(){return a<t.length?{value:e.dehanceValue_(t[a++]),done:!1}:{done:!0}}})},a.replace=function(e){var a=this;return jt(e)&&(e=new Set(e)),ct((function(){Array.isArray(e)||O(e)?(a.clear(),e.forEach((function(e){return a.add(e)}))):null!=e&&i("Cannot initialize set from "+e)})),this},a.observe_=function(e,a){return wt(this,e)},a.intercept_=function(e){return gt(this,e)},a.toJSON=function(){return Array.from(this)},a.toString=function(){return"[object ObservableSet]"},a[Nt]=function(){return this.values()},R(e,[{key:"size",get:function(){return this.atom_.reportObserved(),this.data_.size}},{key:$t,get:function(){return"Set"}}]),e}(),jt=P("ObservableSet",Ht),Ut=Object.create(null),qt="remove",_t=function(){function e(e,a,t,n){void 0===a&&(a=new Map),void 0===n&&(n=ve),this.target_=void 0,this.values_=void 0,this.name_=void 0,this.defaultAnnotation_=void 0,this.keysAtom_=void 0,this.changeListeners_=void 0,this.interceptors_=void 0,this.proxy_=void 0,this.isPlainObject_=void 0,this.appliedAnnotations_=void 0,this.pendingKeys_=void 0,this.target_=e,this.values_=a,this.name_=t,this.defaultAnnotation_=n,this.keysAtom_=new V("ObservableObject.keys"),this.isPlainObject_=x(this.target_)}var a=e.prototype;return a.getObservablePropValue_=function(e){return this.values_.get(e).get()},a.setObservablePropValue_=function(e,a){var t=this.values_.get(e);if(t instanceof ea)return t.set(a),!0;if(ut(this)){var n=ft(this,{type:At,object:this.proxy_||this.target_,name:e,newValue:a});if(!n)return null;a=n.newValue}if((a=t.prepareNewValue_(a))!==ya.UNCHANGED){var r=pt(this),i=r?{type:At,observableKind:"object",debugObjectName:this.name_,object:this.proxy_||this.target_,oldValue:t.value_,name:e,newValue:a}:null;0,t.setNewValue_(a),r&&yt(this,i)}return!0},a.get_=function(e){return ya.trackingDerivation&&!k(this.target_,e)&&this.has_(e),this.target_[e]},a.set_=function(e,a,t){return void 0===t&&(t=!1),k(this.target_,e)?this.values_.has(e)?this.setObservablePropValue_(e,a):t?Reflect.set(this.target_,e,a):(this.target_[e]=a,!0):this.extend_(e,{value:a,enumerable:!0,writable:!0,configurable:!0},this.defaultAnnotation_,t)},a.has_=function(e){if(!ya.trackingDerivation)return e in this.target_;this.pendingKeys_||(this.pendingKeys_=new Map);var a=this.pendingKeys_.get(e);return a||(a=new Qe(e in this.target_,X,"ObservableObject.key?",!1),this.pendingKeys_.set(e,a)),a.get()},a.make_=function(e,a){if(!0===a&&(a=this.defaultAnnotation_),!1!==a){if(Kt(this,a,e),!(e in this.target_)){var t;if(null!=(t=this.target_[j])&&t[e])return;i(1,a.annotationType_,this.name_+"."+e.toString())}for(var n=this.target_;n&&n!==h;){var r=c(n,e);if(r){var s=a.make_(this,e,r,n);if(0===s)return;if(1===s)break}n=Object.getPrototypeOf(n)}Qt(this,a,e)}},a.extend_=function(e,a,t,n){if(void 0===n&&(n=!1),!0===t&&(t=this.defaultAnnotation_),!1===t)return this.defineProperty_(e,a,n);Kt(this,t,e);var r=t.extend_(this,e,a,n);return r&&Qt(this,t,e),r},a.defineProperty_=function(e,a,t){void 0===t&&(t=!1),this.keysAtom_;try{Ia();var n=this.delete_(e);if(!n)return n;if(ut(this)){var r=ft(this,{object:this.proxy_||this.target_,name:e,type:Ft,newValue:a.value});if(!r)return null;var i=r.newValue;a.value!==i&&(a=N({},a,{value:i}))}if(t){if(!Reflect.defineProperty(this.target_,e,a))return!1}else l(this.target_,e,a);this.notifyPropertyAddition_(e,a.value)}finally{xa()}return!0},a.defineObservableProperty_=function(e,a,t,n){void 0===n&&(n=!1),this.keysAtom_;try{Ia();var r=this.delete_(e);if(!r)return r;if(ut(this)){var i=ft(this,{object:this.proxy_||this.target_,name:e,type:Ft,newValue:a});if(!i)return null;a=i.newValue}var s=Yt(e),o={configurable:!ya.safeDescriptors||this.isPlainObject_,enumerable:!0,get:s.get,set:s.set};if(n){if(!Reflect.defineProperty(this.target_,e,o))return!1}else l(this.target_,e,o);var d=new Qe(a,t,"ObservableObject.key",!1);this.values_.set(e,d),this.notifyPropertyAddition_(e,d.value_)}finally{xa()}return!0},a.defineComputedProperty_=function(e,a,t){void 0===t&&(t=!1),this.keysAtom_;try{Ia();var n=this.delete_(e);if(!n)return n;if(ut(this))if(!ft(this,{object:this.proxy_||this.target_,name:e,type:Ft,newValue:void 0}))return null;a.name||(a.name="ObservableObject.key"),a.context=this.proxy_||this.target_;var r=Yt(e),i={configurable:!ya.safeDescriptors||this.isPlainObject_,enumerable:!1,get:r.get,set:r.set};if(t){if(!Reflect.defineProperty(this.target_,e,i))return!1}else l(this.target_,e,i);this.values_.set(e,new ea(a)),this.notifyPropertyAddition_(e,void 0)}finally{xa()}return!0},a.delete_=function(e,a){if(void 0===a&&(a=!1),this.keysAtom_,!k(this.target_,e))return!0;if(ut(this)&&!ft(this,{object:this.proxy_||this.target_,name:e,type:qt}))return null;try{var t,n;Ia();var r,i=pt(this),s=this.values_.get(e),o=void 0;if(!s&&i)o=null==(r=c(this.target_,e))?void 0:r.value;if(a){if(!Reflect.deleteProperty(this.target_,e))return!1}else delete this.target_[e];if(s&&(this.values_.delete(e),s instanceof Qe&&(o=s.value_),Ta(s)),this.keysAtom_.reportChanged(),null==(t=this.pendingKeys_)||null==(n=t.get(e))||n.set(e in this.target_),i){var d={type:qt,observableKind:"object",object:this.proxy_||this.target_,debugObjectName:this.name_,oldValue:o,name:e};0,i&&yt(this,d)}}finally{xa()}return!0},a.observe_=function(e,a){return wt(this,e)},a.intercept_=function(e){return gt(this,e)},a.notifyPropertyAddition_=function(e,a){var t,n,r=pt(this);if(r){var i=r?{type:Ft,observableKind:"object",debugObjectName:this.name_,object:this.proxy_||this.target_,name:e,newValue:a}:null;0,r&&yt(this,i)}null==(t=this.pendingKeys_)||null==(n=t.get(e))||n.set(!0),this.keysAtom_.reportChanged()},a.ownKeys_=function(){return this.keysAtom_.reportObserved(),D(this.target_)},a.keys_=function(){return this.keysAtom_.reportObserved(),Object.keys(this.target_)},e}();function Jt(e,a){var t;if(k(e,J))return e;var n=null!=(t=null==a?void 0:a.name)?t:"ObservableObject",r=new _t(e,new Map,String(n),function(e){var a;return e?null!=(a=e.defaultDecorator)?a:Ae(e):void 0}(a));return T(e,J,r),e}var Vt=P("ObservableObjectAdministration",_t);function Yt(e){return Ut[e]||(Ut[e]={get:function(){return this[J].getObservablePropValue_(e)},set:function(a){return this[J].setObservablePropValue_(e,a)}})}function zt(e){return!!I(e)&&Vt(e[J])}function Qt(e,a,t){var n;null==(n=e.target_[j])||delete n[t]}function Kt(e,a,t){}var Xt,Zt,en=sn(0),an=function(){var e=!1,a={};return Object.defineProperty(a,"0",{set:function(){e=!0}}),Object.create(a)[0]=1,!1===e}(),tn=0,nn=function(){};Xt=nn,Zt=Array.prototype,Object.setPrototypeOf?Object.setPrototypeOf(Xt.prototype,Zt):void 0!==Xt.prototype.__proto__?Xt.prototype.__proto__=Zt:Xt.prototype=Zt;var rn=function(e,a,t){function n(a,t,n,r){var i;return void 0===n&&(n="ObservableArray"),void 0===r&&(r=!1),i=e.call(this)||this,gn((function(){var e=new xt(n,t,r,!0);e.proxy_=M(i),E(M(i),J,e),a&&a.length&&i.spliceWithArray(0,0,a),an&&Object.defineProperty(M(i),"0",en)})),i}$(n,e);var r=n.prototype;return r.concat=function(){this[J].atom_.reportObserved();for(var e=arguments.length,a=new Array(e),t=0;t<e;t++)a[t]=arguments[t];return Array.prototype.concat.apply(this.slice(),a.map((function(e){return kt(e)?e.slice():e})))},r[t]=function(){var e=this,a=0;return xn({next:function(){return a<e.length?{value:e[a++],done:!1}:{done:!0,value:void 0}}})},R(n,[{key:"length",get:function(){return this[J].getArrayLength_()},set:function(e){this[J].setArrayLength_(e)}},{key:a,get:function(){return"Array"}}]),n}(nn,Symbol.toStringTag,Symbol.iterator);function sn(e){return{enumerable:!1,configurable:!0,get:function(){return this[J].get_(e)},set:function(a){this[J].set_(e,a)}}}function on(e){l(rn.prototype,""+e,sn(e))}function dn(e){if(e>tn){for(var a=tn;a<e+100;a++)on(a);tn=e}}function cn(e,a,t){return new rn(e,a,t)}function ln(e,a){if("object"==typeof e&&null!==e){if(kt(e))return void 0!==a&&i(23),e[J].atom_;if(jt(e))return e.atom_;if(Mt(e)){if(void 0===a)return e.keysAtom_;var t=e.data_.get(a)||e.hasMap_.get(a);return t||i(25,a,un(e)),t}if(zt(e)){if(!a)return i(26);var n=e[J].values_.get(a);return n||i(27,a,un(e)),n}if(Y(e)||aa(e)||Da(e))return e}else if(v(e)&&Da(e[J]))return e[J];i(28)}function hn(e,a){return e||i(29),void 0!==a?hn(ln(e,a)):Y(e)||aa(e)||Da(e)||Mt(e)||jt(e)?e:e[J]?e[J]:void i(24,e)}function un(e,a){var t;if(void 0!==a)t=ln(e,a);else{if(ja(e))return e.name;t=zt(e)||Mt(e)||jt(e)?hn(e):ln(e)}return t.name_}function gn(e){var a=ca(),t=Ve(!0);Ia();try{return e()}finally{xa(),Ye(t),la(a)}}Object.entries(Tt).forEach((function(e){var a=e[0],t=e[1];"concat"!==a&&T(rn.prototype,a,t)})),dn(1e3);var fn,pn,wn,yn,mn=h.toString;function vn(e,a,t){return void 0===t&&(t=-1),An(e,a,t)}function An(e,a,t,n,r){if(e===a)return 0!==e||1/e==1/a;if(null==e||null==a)return!1;if(e!=e)return a!=a;var i=typeof e;if("function"!==i&&"object"!==i&&"object"!=typeof a)return!1;var s=mn.call(e);if(s!==mn.call(a))return!1;switch(s){case"[object RegExp]":case"[object String]":return""+e==""+a;case"[object Number]":return+e!=+e?+a!=+a:0==+e?1/+e==1/a:+e==+a;case"[object Date]":case"[object Boolean]":return+e==+a;case"[object Symbol]":return"undefined"!=typeof Symbol&&Symbol.valueOf.call(e)===Symbol.valueOf.call(a);case"[object Map]":case"[object Set]":t>=0&&t++}e=In(e),a=In(a);var o="[object Array]"===s;if(!o){if("object"!=typeof e||"object"!=typeof a)return!1;var d=e.constructor,c=a.constructor;if(d!==c&&!(v(d)&&d instanceof d&&v(c)&&c instanceof c)&&"constructor"in e&&"constructor"in a)return!1}if(0===t)return!1;t<0&&(t=-1),r=r||[];for(var l=(n=n||[]).length;l--;)if(n[l]===e)return r[l]===a;if(n.push(e),r.push(a),o){if((l=e.length)!==a.length)return!1;for(;l--;)if(!An(e[l],a[l],t-1,n,r))return!1}else{var h,u=Object.keys(e);if(l=u.length,Object.keys(a).length!==l)return!1;for(;l--;)if(!k(a,h=u[l])||!An(e[h],a[h],t-1,n,r))return!1}return n.pop(),r.pop(),!0}function In(e){return kt(e)?e.slice():S(e)||Mt(e)||O(e)||jt(e)?Array.from(e.entries()):e}function xn(e){return e[Symbol.iterator]=bn,e}function bn(){return this}["Symbol","Map","Set"].forEach((function(e){void 0===o()[e]&&i("MobX requires global '"+e+"' to be available or polyfilled")})),"object"==typeof __MOBX_DEVTOOLS_GLOBAL_HOOK__&&__MOBX_DEVTOOLS_GLOBAL_HOOK__.injectMobx({spy:function(e){return console.warn("[mobx.spy] Is a no-op in production builds"),function(){}},extras:{getDebugName:un},$mobx:J}),function(e){e.AbsorbedPresence="AbsorbedPresence",e.BlightAdded="BlightAdded",e.BlightCardFlipped="BlightCardFlipped",e.BlightRemoved="BlightRemoved",e.BoardRemoved="BoardRemoved",e.Cascade="Cascade",e.DamageCleared="DamageCleared",e.DefendAdded="DefendAdded",e.DoNotParticipateInRavage="DoNotParticipateInRavage",e.DrawEventCard="DrawEventCard",e.EnergyGained="EnergyGained",e.EnergyLost="EnergyLost",e.Error="Error",e.FearAddedToPool="FearAddedToPool",e.FearCardAdded="FearCardAdded",e.FearCardDiscarded="FearCardDiscarded",e.FearCardEarned="FearCardEarned",e.FearCardResolved="FearCardResolved",e.FearEarned="FearEarned",e.FearLost="FearLost",e.GameEnd="GameEnd",e.GenericMain="GenericMain",e.GenericSub="GenericSub",e.Grow="Grow",e.InvaderCardAdded="InvaderCardAdded",e.InvaderCardRemoved="InvaderCardRemoved",e.InvadersBuild="InvadersBuild",e.InvadersExplore="InvadersExplore",e.InvadersRavage="InvadersRavage",e.InvadersRavageInLand="InvadersRavageInLand",e.InvadersRavageInTerrain="InvadersRavageInTerrain",e.InvadersBuildInTerrain="InvadersBuildInTerrain",e.NewTerrorLevel="NewTerrorLevel",e.LandIsolated="LandIsolated",e.Phase="Phase",e.PieceAdded="PieceAdded",e.PieceDamaged="PieceDamaged",e.PieceMoved="PieceMoved",e.PieceRemoved="PieceRemoved",e.PieceReplaced="PieceReplaced",e.PowerCardDiscarded="PowerCardDiscarded",e.PowerCardDrawn="PowerCardDrawn",e.PowerCardForgotten="PowerCardForgotten",e.PowerCardGained="PowerCardGained",e.PowerCardGiven="PowerCardGiven",e.PowerCardImpended="PowerCardImpended",e.PowerCardPlayed="PowerCardPlayed",e.PowerCardReclaimed="PowerCardReclaimed",e.PowerResolvedInLands="PowerResolvedInLand",e.PowerResolvedOnSpirit="PowerResolvedOnSpirit",e.ResolveEventCard="ResolveEventCard",e.RestoringLandToSetupSymbols="RestoringLandToSetupSymbols",e.ScoreFromInnate="ScoreFromInnate",e.ScoreFromPower="ScoreFromPower",e.SetupAdversary="SetupAdversary",e.SetupScenario="SetupScenario",e.SetupSpirit="SetupSpirit",e.SlowHealingBlightAdded="SlowHealingBlightAdded",e.StrifeAdded="StrifeAdded",e.StrifeRemoved="StrifeRemoved",e.TargetedAcrossIslets="TargetedAcrossIslets",e.TimeLost="TimeLost",e.TrackUncovered="TrackUncovered",e.WaveOfImmigration="WaveOfImmigration"}(fn||(fn={})),function(e){e.ChooseBetween="ChooseBetween",e.ClickToContinueCard="ClickToContinueCard",e.ClickToContinue="ClickToContinue",e.PayJointly="PayJointly",e.PlayPower="PlayPower",e.SelectBoard="SelectBoard",e.SelectCard="SelectCard",e.SelectCorner="SelectCorner",e.SelectFearCard="SelectFearCard",e.SelectGrowthOption="SelectGrowthOption",e.SelectHealingCard="SelectHealingCard",e.SelectLand="SelectLand",e.SelectPiece="SelectPiece",e.SelectPower="SelectPower",e.SelectPowerToGain="SelectPowerToGain",e.SelectPowerType="SelectPowerType",e.SelectSpirit="SelectSpirit",e.SelectTerrain="SelectTerrain",e.SelectTrack="SelectTrack"}(pn||(pn={})),function(e){e.ProudAndMightCapital="ProudAndMightCapital",e.BuildingBoom="BuildingBoom",e.IndenturedServantsEarnLand="IndenturedServantsEarnLand",e.HighImmigrationI="HighImmigrationI",e.HighImmigrationFull="HighImmigrationFull",e.LocalAutonomy="LocalAutonomy",e.IndependentResolve="IndependentResolve",e.SprawlingPlantation="SprawlingPlantation",e.DemandForNewCashCrops="DemandForNewCashCrops",e.FrontierExplorers="FrontierExplorers",e.SlaveLabor="SlaveLabor",e.TriangleTrade="TriangleTrade",e.SlowHealingEcosystem="SlowHealingEcosystem",e.PersistentExplorers="PersistentExplorers",e.IrreparableDamage="IrreparableDamage",e.SeekPrimeTerritory="SeekPrimeTerritory",e.MigratoryHerders="MigratoryHerders",e.MoreRuralThanUrban="MoreRuralThanUrban",e.HerdsThriveInVerdantLands="HerdsThriveInVerdantLands",e.WaveOfImmigration="WaveOfImmigration",e.FarFlungHerds="FarFlungHerds",e.LandRush="LandRush",e.HuntersSwarmTheIsland="HuntersSwarmTheIsland",e.StalkThePredators="StalkThePredators",e.HuntersSeekShellAndHide="HuntersSeekShellAndHide",e.ASenseForImpendingDisaster="ASenseForImpendingDisaster",e.CompetitionAmongHunters="CompetitionAmongHunters",e.PressureForFastProfit="PressureForFastProfit",e.LandStrippedBare="LandStrippedBare",e.MiningTunnels="MiningTunnels",e.AvariceRewarded="AvariceRewarded",e.CeaselessMining="CeaselessMining",e.MiningBoomI="MiningBoom",e.UntappedSaltDeposits="UntappedSaltDeposits",e.MiningBoomII="MiningBoomII",e.TheEmpireAscendant="TheEmpireAscendant",e.TradeHub="TradeHub",e.PortsSprawlOutward="PortsSprawlOutward",e.TradingPort="TradingPort",e.ChartTheCoastline="ChartTheCoastline",e.RunoffAndBilgewater="RunoffAndBilgewater",e.ExportsFuelInwardGrowth="ExportsFuelInwardGrowth",e.SwayedByTheInvaders="SwayedByTheInvaders",e.HeavyMining="HeavyMining",e.FineSteelForToolsAndGuns="FineSteelForToolsAndGuns",e.RoyalBacking="RoyalBacking",e.MiningRush="MiningRush",e.ShadowsPartake="ShadowsPartake",e.Immense="Immense",e.Travel="Travel",e.Madness="Madness",e.Reach="Reach",e.Resilience="Resilience",e.DarkFire="DarkFire",e.Encircle="Encircle",e.Intensify="Intensify",e.Lair="Lair",e.Locus="Locus",e.Mentor="Mentor",e.Nourishing="Nourishing",e.Regrowth="Regrowth",e.SpreadingHostility="SpreadingHostility",e.Stranded="Stranded",e.Tactician="Tactician",e.Transforming="Transforming",e.Unconstrained="Unconstrained",e.Violence="Violence",e.Warrior="Warrior",e.DownwardSpiral="DownwardSpiral",e.MemoryFadesToDust="MemoryFadesToDust",e.BackAgainstTheWall="BackAgainstTheWall",e.AllThingsWeaken="AllThingsWeaken",e.PowerCorrodesTheSpirit="PowerCorrodesTheSpirit",e.UntendedLandCrumbles="UntendedLandCrumbles",e.AttenuatedEssence="AttenuatedEssence",e.BlightCorrodesTheSpirit="BlightCorrodesTheSpirit",e.IntensifyingExploitation="IntensifyingExploitation",e.TheBorderOfLifeAndDeath="TheBorderOfLifeAndDeath",e.DistantExploration="DistantExploration",e.FearfulMobs="FearfulMobs",e.SpurnTheInvaders="SpurnTheInvaders",e.TeachTheInvaders="TeachTheInvaders",e.HeavyFarming="HeavyFarming",e.IncreasingAggression="IncreasingAggression",e.DestroyTheUnnatural="DestroyTheUnnatural",e.CurseTheTongues="CurseTheTongues",e.PromisingFarmland="PromisingFarmland",e.WeaveLies="WeaveLies",e.StrangeTalesAttractExplorers="StrangeTalesAttractExplorers",e.Fortification="Fortification",e.TightknitCommunities="TightknitCommunities",e.UrbanDevelopment="UrbanDevelopment",e.WaveOfReconnaissance="WaveOfReconnaissance",e.WellpreparedExplorers="WellpreparedExplorers",e.YearsOfLittleRain="YearsOfLittleRain",e.BureaucratsAdjustFunding="BureaucratsAdjustFunding",e.RansackAndRun="RansackAndRun",e.DepletedSoil="DepletedSoil",e.CivicEngagement="CivicEngagement",e.CooperationAmongTowns="CooperationAmongTowns",e.IgnoreTheirInterest="IgnoreTheirInterest",e.ChangeAndHelp="ChangeAndHelp",e.EagerExplorers="EagerExplorers",e.Xenophobia="Xenophobia",e.Fortuneseekers="Fortuneseekers",e.TheLandsBountyExhausted="TheLandsBountyExhausted",e.CreateUnnervingDistractions="CreateUnnervingDistractions",e.BeastsPreyOnTheInjured="BeastsPreyOnTheInjured",e.CoordinatedStrikes="CoordinatedStrikes",e.InvestedAristocracy="InvestedAristocracy",e.ForeignDignitariesVisit="ForeignDignitariesVisit",e.LetDestructionHaveItsDay="LetDestructionHaveItsDay",e.FortifyTheResilienceOfLife="FortifyTheResilienceOfLife",e.MapmakersChartTheWild="MapmakersChartTheWild",e.NoBraveryWithoutNumbers="NoBraveryWithoutNumbers",e.CourageOfTheCrowd="CourageOfTheCrowd",e.TerrorBreedsAggression="TerrorBreedsAggression",e.PullTogetherInAdversity="PullTogetherInAdversity",e.RelentlessOptimism="RelentlessOptimism",e.LeaveItsStrength="LeaveItsStrength",e.CraftAGreatWardingUntilEndOfTurn="CraftAGreatWardingUntilEndOfTurn",e.CraftAGreatWardingOngoing="CraftAGreatWardingOngoing",e.ResourcefulPopulace="ResourcefulPopulace",e.StripTheLandBare="StripTheLandBare",e.VoraciousConsumption="VoraciousConsumption",e.EngageOnTheirOwnTerms="EngageOnTheirOwnTerms",e.FocusYourWill="FocusYourWill",e.LayAmbushes="LayAmbushes",e.TemporaryTruce="TemporaryTruce",e.TemporaryCaution="TemporaryCaution",e.TheFrontierCalls="TheFrontierCalls",e.SelfSacrificeBuysTime="SelfSacrificeBuysTime",e.AccumulatedDevastation="AccumulatedDevastation",e.InfluxOfSettlers="InfluxOfSettlers",e.NetworkOfSupportAndTrade="NetworkOfSupportAndTrade",e.WidespreadHunting="WidespreadHunting",e.FinalHarvest="FinalHarvest",e.HeadOffTheProblems="HeadOffTheProblems",e.StrengthFromTrade="StrengthFromTrade",e.CannyDefense="CannyDefense",e.CarefulDefense="CarefulDefense",e.CoordinatedDefense="CoordinatedDefense",e.IrregularOutbreaks="IrregularOutbreaks",e.LingeringPlagues="LingeringPlagues",e.Stricken="Stricken",e.AvoidTheDahanI="AvoidTheDahanI",e.AvoidTheDahanII="AvoidTheDahanII",e.AvoidTheDahanIII="AvoidTheDahanIII",e.BeliefTakesRootI="BeliefTakesRootI",e.BeliefTakesRootII="BeliefTakesRootII",e.DahanOnTheirGuardI="DahanOnTheirGuardI",e.DahanOnTheirGuardII="DahanOnTheirGuardII",e.DahanOnTheirGuardIII="DahanOnTheirGuardIII",e.OverseasTradeSeemSaferI="OverseasTradeSeemSaferI",e.OverseasTradeSeemSaferII="OverseasTradeSeemSaferII",e.OverseasTradeSeemSaferIII="OverseasTradeSeemSaferIII",e.TradeSuffersI="TradeSuffersI",e.DemoralizedI="DemoralizedI",e.DemoralizedII="DemoralizedII",e.DemoralizedIII="DemoralizedIII",e.ExplorersAreReluctantI="ExplorersAreReluctantI",e.ExplorersAreReluctantII="ExplorersAreReluctantII",e.ExplorersAreReluctantIII="ExplorersAreReluctantIII",e.ImmigrationSlowsI="ImmigrationSlowsI",e.ImmigrationSlowsII="ImmigrationSlowsII",e.ImmigrationSlowsIII="ImmigrationSlowsIII",e.PanickedByWildBeastsII="PanickedByWildBeastsII",e.PanickedByWildBeastsIII="PanickedByWildBeastsIII",e.PlanForDepartureII="PlanForDepartureII",e.PlanForDepartureIII="PlanForDepartureIII",e.QuarantineI="QuarantineI",e.QuarantineII="QuarantineII",e.QuarantineIII="QuarantineIII",e.CommunitiesInDisarrayI="CommunitiesInDisarrayI",e.CommunitiesInDisarrayII="CommunitiesInDisarrayII",e.CommunitiesInDisarrayIII="CommunitiesInDisarrayIII",e.BesetByManyTroublesI="BesetByManyTroublesI",e.BesetByManyTroublesII="BesetByManyTroublesII",e.BesetByManyTroublesIII="BesetByManyTroublesIII",e.DauntedByTheDahan="DauntedByTheDahan",e.DistractedByLocalTroublesII="DistractedByLocalTroublesII",e.DistractedByLocalTroublesIII="DistractedByLocalTroublesIII",e.RoilingWaters="RoilingWaters",e.SereneWaters="SereneWaters",e.DreamOfTheUntouchedLand="DreamOfTheUntouchedLand",e.DreamOfTheUntouchedLandSkipBoard="DreamOfTheUntouchedLandSkipBoard",e.BargainsOfPowerAndProtection="BargainsOfPowerAndProtection",e.BargainsOfCoursingPath="BargainsOfCoursingPath",e.Blitz="Blitz",e.DahanInsurrection="DahanInsurrection",e.GuardTheIslesHeart="GuardTheIslesHeart",e.RitualsOfTerror="RitualsOfTerror",e.BronzeLoopSpirit="BronzeLoopSpirit",e.BronzeLoopInvader="BronzeLoopInvader",e.GlowingEmberInvader="GlowingEmberInvader",e.GlowingEmberSpirit="GlowingEmberSpirit",e.JaggedTooth="JaggedTooth",e.LizardsScale="LizardsScale",e.RibBone="RibBone",e.WindWovenRope="WindWovenRope",e.JaggedToothInvader="JaggedToothInvader",e.JaggedToothSpirit="JaggedToothSpirit",e.LizardsScaleInvader="LizardsScaleInvader",e.LizardScaleSpirit="LizardScaleSpirit",e.RibBoneInvader="RibBoneInvader",e.RibBoneSpirit="RibBoneSpirit",e.WindWovenRopeInvader="WindWovenRopeInvader",e.WindWovenRopeSpirit="WindWovenRopeSpirit",e.PowersLongForgotten="PowersLongForgotten",e.RitualsOfTheDestroyingFlame="RitualsOfTheDestroyingFlame",e.SecondWave="SecondWave",e.WardTheShores="WardTheShores",e.ADiversityOfSpirits="ADiversityOfSpirits",e.VariedTerrain="VariedTerrain",e.DespicableTheft="DespicableTheft",e.ElementalInvocation="ElementalInvocation",e.TheGreatRiver="TheGreatRiver",e.DestinyUnfold="DestinyUnfold",e.SurgesOfColonization="SurgesOfColonization",e.Bringer="Bringer",e.Earth="Earth",e.GreenChokeTheLandWithGreen="GreenChokeTheLandWithGreen",e.GreenSteadyRegeneration="GreenSteadyRegeneration",e.Lightning="Lightning",e.Ocean="Ocean",e.River="River",e.Shadows="Shadows",e.Thunderspeaker="Thunderspeaker",e.FangsAllyOfTheBeasts="Fangs",e.FangsCallForthPredators="FangsCallForthPredators",e.Keeper="Keeper",e.Downpour="Downpour",e.Finder="Finder",e.Serpent="Serpent",e.Wildfire="Wildfire",e.Eyes="Eyes",e.Heat="Heat",e.Mud="Mud",e.Teeth="Teeth",e.Whirlwind="Whirlwind",e.Fractured="Fractured",e.LureHomeOfTheIslandsHeart="LureHomeOfTheIslandsHeart",e.LureEnthrallTheForeignExplorers="LureEnthrallTheForeignExplorers",e.ManyMinds="ManyMinds",e.MemoryKnowledge="Memory",e.MemoryInsight="MemoryInsight",e.ShroudGatherPowerFromTheCoolAndDark="ShroudGatherPowerFromTheCoolAndDark",e.ShroudMistsShiftAndFlow="ShroudMistsShiftAndFlow",e.SlowAndSilentDeath="SlowAndSilentDeath",e.Starlight="Starlight",e.Stone="Stone",e.Trickster="Trickster",e.Vengeance="Vengeance",e.Volcano="Volcano",e.Behemoth="Behemoth",e.Darkness="Darkness",e.Earthquakes="Earthquakes",e.Gaze="Gaze",e.HearthVigil="HearthVigil",e.Roots="Roots",e.Voice="Voice",e.WoundedSeekingAPathTowardsHealing="WoundedSeekingAPathTowardsHealing",e.Downgrade="Downgrade"}(wn||(wn={})),function(e){e.ActionEnds="ActionEnds",e.AddTwoExtraBroken="AddTwoExtraBroken",e.AdjustBuildPlans="AdjustBuildPlans",e.AdjustCardPlays="AdjustCardPlays",e.AdjustCollectiveDahanRavageDamage="AdjustCollectiveDahanRavageDamage",e.AdjustCollectiveInvaderRavageDamage="AdjustCollectiveInvaderRavageDamage",e.AdjustDamageDuringRavage="AdjustDamageDuringRavage",e.AdjustDamage="AdjustDamage",e.AdjustGainingPowers="AdjustGainingPowers",e.AdjustHealth="AdjustHealth",e.AdjustIndividualInvaderRavageDamage="AdjustIndividualInvaderRavageDamage",e.AdjustLandHealth="AdjustLandHealth",e.AdjustNumberOfActions="AdjustNumberOfActions",e.AdjustNumberOfExploreCards="AdjustNumberOfExploreCards",e.AdjustPlayPower="AdjustPlayPower",e.AdjustPowerSpeedOnPlay="AdjustPowerSpeedOnPlay",e.AdjustRemovePiece="AdjustRemovePiece",e.AdjustSetupPresence="AdjustSetupPresence",e.AfterAddingPiece="AfterAddingPiece",e.AfterAddingSlowHealingBlight="AfterAddingSlowHealingBlight",e.AfterAddingStrife="AfterAddingStrife",e.AfterAdvancingCards="AfterAdvancingCards",e.AfterAdversaryActionsOnEachBoard="AfterAdversaryActionsOnEachBoard",e.AfterChangingInvaderDeck="AfterChangingInvaderDeck",e.AfterChangingSpeed="AfterChangingSpeed",e.AfterDahanDestroyedInRavage="AfterDahanDestroyedInRavage",e.AfterDrawingBlightCard="AfterDrawingBlightCard",e.AfterEventPhase="AfterEventPhase",e.AfterFastPhase="AfterFastPhase",e.AfterFearDeckIsDecreasing="AfterFearDeckIsDecreasing",e.AfterGainingEnergyFromTracks="AfterGainingEnergyFromTracks",e.AfterGainingPowers="AfterGainingPowers",e.AfterGameEnds="AfterGameEnds",e.AfterGrowth="AfterGrowth",e.AfterInitialExplore="AfterInitialExplore",e.AfterInvaderPhase="AfterInvaderPhase",e.AfterLandChangesAmountOfPresence="AfterLandChangesAmountOfPresence",e.AfterMoving="AfterMoving",e.AfterPlayPowers="AfterPlayPowers",e.AfterPowerAddsDefense="AfterPowerAddsDefense",e.AfterPowerGenerateFearInLand="AfterPowerGenerateFearInLand",e.AfterPowerLeavesPlay="AfterPowerLeavesPlay",e.AfterRavagingDamageLand="AfterRavagingDamageLand",e.AfterRavaging="AfterRavaging",e.AfterReachingTerrorLevel="AfterReachingTerrorLevel",e.AfterRemovePiece="AfterRemovePiece",e.AfterReplacePieces="AfterReplacePieces",e.AfterResolvingBuildCard="AfterResolvingBuildCard",e.AfterResolvingEventCard="AfterResolvingEventCard",e.AfterResolvingExploreCard="AfterResolvingExploreCard",e.AfterResolvingLandTargetingPower="AfterResolvingLandTargetingPower",e.AfterResolvingRavageCard="AfterResolvingRavageCard",e.AfterSetupPresence="AfterSetupPresence",e.AfterSlowPhase="AfterSlowPhase",e.AfterSuccessfulBuild="AfterSuccessfulBuild",e.AfterSuccessfulExplore="AfterSuccessfulExplore",e.AfterTargetingLand="AfterTargetingLand",e.AfterTargetingLands="AfterTargetingLands",e.AfterTargetingSource="AfterTargetingSource",e.AfterTheNormalBuildStep="AfterTheNormalBuildStep",e.AfterTheNormalExploreStep="AfterTheNormalExploreStep",e.AfterTheNormalRavageStep="AfterTheNormalRavageStep",e.AfterUncoveringTrack="AfterUncoveringTrack",e.AlterInvaderActionInLand="AlterInvaderActionInLand",e.AnyActionEnds="AnyActionEnds",e.AnyActionStarts="AnyActionStarts",e.AtTimePassesBegin="AtTimePassesBegin",e.AtTimePassesEnds="AtTimePassesEnds",e.BeastsCountAsBadlands="BeastsCountAsBadlands",e.BeforeAdvancingCards="BeforeAdvancingCards",e.BeforeAdversaryActionsOnEachBoard="BeforeAdversaryActionsOnEachBoard",e.BeforeInitialExplore="BeforeInitialExplore",e.BeforeMoving="BeforeMoving",e.BeforePayEnergy="BeforePayEnergy",e.BeforePlayPowers="BeforePlayPowers",e.BeforeRavageStep="BeforeRavageStep",e.BeforeResolvingInnate="BeforeResolvingInnate",e.BeforeResolvingInvaderCard="BeforeResolvingInvaderCard",e.BeforeRevealingBlightCard="BeforeRevealingBlightCard",e.BeforeSetupPresence="BeforeSetupPresence",e.BeforeSuccessfulBuild="BeforeSuccessfulBuild",e.BeforeSuccessfulExplore="BeforeSuccessfulExplore",e.BlightAlwaysCascadesInLand="BlightAlwaysCascadesInLand",e.BlightedIslandPhase="BlightedIslandPhase",e.BoardHasExtraLocation="BoardHasExtraLocation",e.BuildCardsAffectLandsWithoutInvaders="BuildCardsAffectLandsWithoutInvaders",e.BuildOrderMatters="BuildOrderMatters",e.CanPlayCardsWithoutCost="CanPlayCardsWithoutCost",e.ChangeSpeedOfPower="ChangeSpeedOfPower",e.DahanFightBeforeInvaders="DahanFightBeforeInvaders",e.DahanFightSimultaneously="DahanFightSimultaneously",e.DamageBoost="DamageBoost",e.DamageIgnoreHealthBonuses="DamageIgnoreHealthBonuses",e.DefendFromGame="DefendFromGame",e.DefendFromSpirits="DefendFromSpirits",e.DoesNotParticipateInRavage="DoesNotParticipateInRavage",e.Elements="Elements",e.EnergyDebt="EnergyDebt",e.Escalation="Escalation",e.ExploreOrderMatters="ExploreOrderMatters",e.ExplorersFightWithDahan="ExplorersFightWithDahan",e.ExtraAction="ExtraAction",e.ExtraAdjacency="ExtraAdjacency",e.ExtraBeastAdjacency="ExtraBeastAdjacency",e.ExtraBlightFromDamage="ExtraBlightFromDamage",e.ExtraBoard="ExtraBoard",e.ExtraCardDrawAmount="ExtraCardDrawAmount",e.ExtraCardKeepAmount="ExtraCardKeepAmount",e.ExtraCardPlaysCost="ExtraCardPlaysCost",e.ExtraCardPlaysForDamageAndDestroy="ExtraCardPlaysForDamageAndDestroy",e.ExtraCardPlays="ExtraCardPlays",e.ExtraDefense="ExtraDefense",e.ExtraExploreDistance="ExtraExploreDistance",e.ExtraLandNumber="ExtraLandNumber",e.ExtraMove="ExtraMove",e.ExtraRangeToLand="ExtraRangeToLand",e.ExtraRange="ExtraRange",e.ExtraRemove="ExtraRemove",e.ExtraScore="ExtraScore",e.Flooded="Flooded",e.GlobalReminder="GlobalReminder",e.HasSacredSiteOf="HasSacredSiteOf",e.HighImmigration="HighImmigration",e.IgnoreOneStrife="IgnoreOneStrife",e.IgnoreWildsDuringExplore="IgnoreWildsDuringExplore",e.InTargetLand="InTargetLand",e.Isolated="Isolated",e.LandIsExploringSource="LandIsExploringSource",e.LocationIsOcean="LocationIsOcean",e.LocationIsTerrain="LocationIsTerrain",e.LossCondition="LossCondition",e.MayChangeSpeedOfPower="MayChangeSpeedOfPower",e.MayGrowWithDestroyedPresence="MayGrowWithDestroyedPresence",e.MayIgnoreRangeWhenTargetingLand="MayIgnoreRangeWhenTargetingLand",e.MayIgnoreTargetFilterWhenTargetingLand="MayIgnoreTargetFilterWhenTargetingLand",e.MayRepeatPowercard="MayRepeatPowercard",e.MayShift="MayShift",e.MayTargetTheEndlessDark="MayTargetTheEndlessDark",e.MayUseOtherSpiritPresenceForTargeting="MayUseOtherSpiritPresenceForTargeting",e.MiningLandsCauseRavageActions="MiningLandsCauseRavageActions",e.MoveWithoutWaiting="MoveWithoutWaiting",e.Now="Now",e.OceanIsLandForBlight="OceanIsLandForBlight",e.OceanIsLand="OceanIsLand",e.OnSetupAfterAddingInvaders="OnSetupAfterAddingInvaders",e.OrderOfRemoveAllMightMatter="OrderOfRemoveAllMightMatter",e.OverrideMatchesInvaderCard="OverrideMatchesInvaderCard",e.PermanentHighImmigration="PermanentHighImmigration",e.PowerCostExtraTime="PowerCostExtraTime",e.PowerHasAllThresholds="PowerHasAllThresholds",e.PresenceCountsAsBadlandsOrBeasts="PresenceCountsAsBadlandsOrBeasts",e.PreventAddAnyPresence="PreventAddAnyPresence",e.PreventAddBlightInSetup="PreventAddBlightInSetup",e.PreventAddBlight="PreventAddBlight",e.PreventAddPiece="PreventAddPiece",e.PreventAddPresence="PreventAddPresence",e.PreventAddRemovedBlightToBlightCard="PreventAddRemovedBlightToBlightCard",e.PreventAdversaryActionOnBoard="PreventAdversaryActionOnBoard",e.PreventBlightDestroyingPresence="PreventBlightDestroyingPresence",e.PreventCascade="PreventCascade",e.PreventChangeSpeedOfPower="PreventChangeSpeedOfPower",e.PreventClearDamage="PreventClearDamage",e.PreventDamagingPiece="PreventDamagingPiece",e.PreventDiseasePreventingBuilds="PreventDiseasePreventingBuilds",e.PreventEscalation="PreventEscalation",e.PreventExploreSourceInLand="PreventExploreSourceInLand",e.PreventFearGeneration="PreventFearGeneration",e.PreventForgetPowercard="PreventForgetPowercard",e.PreventGainEnergy="PreventGainEnergy",e.PreventInvaderActionInLand="PreventInvaderActionInLand",e.PreventMovePiece="PreventMovePiece",e.PreventRemovalEffects="PreventRemovalEffects",e.PreventRemoveBlightFromBlightCard="PreventRemoveBlightFromBlightCard",e.PreventRemoveBoard="PreventRemoveBoard",e.PreventRemovePiece="PreventRemovePiece",e.PreventReplacePiece="PreventReplacePiece",e.PreventSlowPowers="PreventSlowPowers",e.PreventTargetLand="PreventTargetLand",e.Reminder="Reminder",e.PreventTargetPiece="PreventTargetPiece",e.PreventTerrorLevelAndResolveFearCards="PreventTerrorLevelAndResolveFearCards",e.RemoveFearBasedVictory="RemoveFearBasedVictory",e.RepeatPowerCard="RepeatPowerCard",e.ShowLossCondition="ShowLossCondition",e.SkipNextBuildCard="SkipNextBuildCard",e.SkipNextExploreCard="SkipNextExploreCard",e.SkipNextRavageCard="SkipNextRavageCard",e.SpiritHasExtraGrowthOptions="SpiritHasExtraGrowthOptions",e.StartOfRavageStep="StartOfRavageStep",e.StartOfSlowPhase="StartOfSlowPhase",e.StartOfSpiritPhase="StartOfSpiritPhase",e.TargetSpirit="TargetSpirit",e.TimePasses="TimePasses",e.TreatAllORsAsANDs="TreatAllORsAsANDs",e.TreatElementAsElement="TreatElementAsElement",e.TreatElementsAsElements="TreatElementsAsElements",e.UpToMustBeUsedAtMaximum="UpToMustBeUsedAtMaximum",e.WhenAddingBlight="WhenAddingBlight",e.WinCondition="WinCondition"}(yn||(yn={}));const Tn={name:"Downward Spiral",set:a.Base,blightPerPlayer:5,requireEvents:!1,effects:[{textArea:[.245,.331],text:"At the start of each Invader Phase each Spirit destroys 1 of their <presence>.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffect({effectId:wn.DownwardSpiral,[yn.BlightedIslandPhase]:async()=>{await e.eachSpirit((a=>e.doBlightCardAction((async()=>{await a.destroyPresence(1)}))))},[yn.GlobalReminder]:()=>({icon:"<blight>",ongoing:!0})})}}]};var En;!function(e){e.Minor="Minor",e.Major="Major",e.Unique="Unique",e.Innate="Innate",e.NonMinorCard="NonMinorCard",e.NonMajorCard="NonMajorCard",e.NonUniqueCard="NonUniqueCard",e.AnyCard="AnyCard",e.Any="Any"}(En||(En={}));const Pn={name:"Memory Fades to Dust",set:a.Base,blightPerPlayer:4,requireEvents:!1,effects:[{textArea:[.242,.373],text:"At the start of each Invader Phase each Spirit Forgets a Power or destroys 1 of their <presence>.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffect({effectId:wn.MemoryFadesToDust,[yn.BlightedIslandPhase]:async()=>{await e.eachSpirit((a=>e.doBlightCardAction((()=>e.chooseBetween({effects:[{actionId:"ForgetPower",text:"Forget a Power.",[yn.Now]:async()=>{await a.forgetPowers()},condition:()=>a.hasAtLeastNonBlessed(1,En.AnyCard)},{actionId:"DestroyPresence",text:"Destroy 1 of your <presence>.",[yn.Now]:async()=>{await a.destroyPresence(1)},condition:()=>a.presence().count>0}]})))))},[yn.GlobalReminder]:()=>({icon:"<blight>",ongoing:!0})})}}]};var Sn;!function(e){e.Unique="Unique",e.Minor="Minor",e.Major="Major",e.Innate="Innate",e.Scenario="Scenario"}(Sn||(Sn={}));const On={name:"Aid From Lesser Spirit",set:a.BranchAndClaw,blightPerPlayer:2,requireEvents:!0,effects:[{textArea:[.25,.463],text:"Immediately, draw 1 Minor Power Card per player plus 1 more. Give 1 to each Spirit. They may be used every turn as if played, but cost no Card Plays/Energy. Place unselected card in Minor Powers discard pile.",[yn.Now]:async({$:e})=>{let a=[];await e.eachSpirit((t=>e.doBlightCardAction((async()=>{const n=await t.gainPowerCard({powerType:Sn.Minor,drawAmount:e.spiritCount+1,discardAfter:2===a.length,gifted:!0,fromSelection:a.length>0?a:void 0});a=n.notChosen,await n.chosen[0].bless()}))))}}]},Cn={name:"A Pall Upon The Land",set:a.BranchAndClaw,blightPerPlayer:3,requireEvents:!0,effects:[{textArea:[.248,.334],text:"Immediately, on each board: destroy 1 <presence> and remove 1 <town>.",[yn.Now]:async({$:e})=>{await e.doBlightCardActionOnEachBoard((async a=>{await a.presence().pickOne((async e=>{await e.destroy()}),{text:"Destroy 1 <presence>.",highlightBoards:[a],noOptions:`On board ${a.name}: No <presence> to remove.`}),await a.forPiecesThatIs(e.Town).pickOne((async e=>{await e.remove()}),{text:"Remove 1 <town>.",highlightBoards:[a],noOptions:`On board ${a.name}: No <town> to remove.`})}))}}]},Dn={name:"Back Against The Wall",set:a.BranchAndClaw,blightPerPlayer:2,requireEvents:!0,effects:[{textArea:[.245,.332],text:"Every Spirit Phase each Spirit gains +1 Energy and +1 Card Play.",[yn.Now]:async({$:e})=>{const a=async()=>{await e.eachSpirit((a=>e.doBlightCardAction((async()=>{await a.gainEnergy(1),await a.gainCardPlays(1)}))))};await e.clickToContinue(),e.spiritPhase&&await a(),await e.addSubEffect({effectId:wn.BackAgainstTheWall,[yn.StartOfSpiritPhase]:async()=>{await e.clickToContinue(),await a()},[yn.GlobalReminder]:()=>({icon:"<blight>",ongoing:!0})})}}]};var Bn;!function(e){e.Badlands="Badlands",e.Beasts="Beasts",e.Blight="Blight",e.City="City",e.Dahan="Dahan",e.Deeps="Deeps",e.Disease="Disease",e.Explorer="Explorer",e.FlameMarker="FlameMarker",e.HiddenLocation="HiddenLocation",e.IncarnaBehemoth="IncarnaBehemoth",e.IncarnaDarkness="IncarnaDarkness",e.IncarnaLair="IncarnaLair",e.IncarnaLocus="IncarnaLocus",e.IncarnaRoots="IncarnaRoots",e.IncarnaVoice="IncarnaVoice",e.IncarnaWarrior="IncarnaWarrior",e.Omen="Omen",e.Presence="Presence",e.Quake="Quake",e.Strife="Strife",e.Thief="Thief",e.Town="Town",e.Vitality="Vitality",e.WardingPattern="WardingPattern",e.Wilds="Wilds"}(Bn||(Bn={}));const kn={name:"Disintegrating Ecosystem",set:a.BranchAndClaw,blightPerPlayer:5,requireEvents:!0,effects:[{textArea:[.248,.34],text:"Immediately, on each board: Destroy 1 <beasts>, then add 1 <blight> to a land with <town>/<city>.",[yn.Now]:async({$:e})=>{await e.doBlightCardActionOnEachBoard((async a=>{await e.addSubEffect({effects:[{highlightBoards:[a],textArea:[.25,.29],text:"Destroy 1 <beasts>",[yn.Now]:()=>e.countPieceOnlyIfHavingPiece(Bn.Beasts,(()=>a.forPiecesThatIs(e.Beasts))).pickOne((async e=>{await e.destroy()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No <beasts> to destroy.`})},{highlightBoards:[a],textArea:[.295,.335],text:"Add 1 <blight> to a land with <town>/<city>.",[yn.Now]:async()=>{await a.inLandsWith(e.TownOrCity).pickOne((async e=>{await e.addBlight(1)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <town>/<city>.`})}}]})}))}}]},Ln={name:"Erosion Of Will",set:a.BranchAndClaw,blightPerPlayer:3,requireEvents:!0,effects:[{textArea:[.248,.335],text:"Immediately, 2 <fear> per player. Each Spirit destroys 1 of their <presence> and loses 1 Energy.",[yn.Now]:async({$:e})=>{await e.doBlightCardAction((async()=>{await e.clickToContinue(),await e.fear(2*e.spiritCount),await e.eachSpirit((a=>e.doBlightCardAction((async()=>{await e.addSubEffect({effects:[{textArea:[.248,.335],text:"Each Spirit destroys 1 of their <presence> and loses 1 Energy.",[yn.Now]:async()=>{await a.destroyPresence(1),await a.loseEnergy(1)}}]})}))))}))}}]},Fn={name:"Promising Farmlands",set:a.BranchAndClaw,blightPerPlayer:4,requireEvents:!0,effects:[{textArea:[.25,.337],text:"Immediately, on each board: Add 1 <town> and 1 <city> to an Inland land with no <town>/<city>.",[yn.Now]:async({$:e})=>{await e.doBlightCardActionOnEachBoard((async a=>{await a.inLandsWhere((a=>a.isInland&&!a.has(e.TownOrCity))).pickOne((async a=>{await a.add(1,e.Town),await a.add(1,e.City)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No Inland lands without <town>/<city>`})}))}}]},Rn={name:"Tipping Point",banned:!0,set:a.BranchAndClaw,blightPerPlayer:5,requireEvents:!0,effects:[{textArea:[.248,.288],text:"Immediately, destroy 3 <presence> from each Spirit.",[yn.Now]:async({$:e})=>{await e.eachSpirit((a=>e.doBlightCardAction((async()=>{await a.destroyPresence(3)}))))}}]};var Nn;!function(e){e.DirectDestroy="DirectDestroy",e.DestroyByDamageOrBlight="DestroyByDamageOrBlight",e.DestroyByHealthChange="DestroyByHealthChange",e.Drown="Drown",e.Remove="Remove",e.Replace="Replace",e.RemoveFromGame="RemoveFromGame",e.Relocate="Relocate",e.Silent="Silent"}(Nn||(Nn={}));const $n={name:"All Things Weaken",set:a.JaggedEarth,blightPerPlayer:3,requireEvents:!1,effects:[{textArea:[.25,.337],text:"Ongoing, starting next turn: Invaders and <dahan> have -1 Health (min. 1).",[yn.Now]:async({$:e})=>{const a=e.turn;await e.clickToContinue(),await e.addSubEffect({effectId:wn.AllThingsWeaken,[yn.AdjustHealth]:({piece:t})=>e.turn>a&&t.isOneOf(e.Invader,e.Dahan)?-1:0,[yn.StartOfSpiritPhase]:async()=>{e.turn===a+1&&await e.globalHealthCheck()},[yn.GlobalReminder]:()=>({text:"Ongoing, starting next turn: Invaders and <dahan> have -1 Health (min. 1).<br><br>The land takes <blight> on 1 less Damage (normally 1).<br><br>When you add <blight>, it Destroys all <presence>/<beasts> in that land and 1 <presence> (total) in an adjacent land.",icon:"<blight>",ongoing:!0})})}},{textArea:[.289,.38],text:"The land takes <blight> on 1 less Damage (normally 1).",[yn.Now]:async({$:e})=>{const a=e.turn;await e.clickToContinue(),await e.addSubEffect({[yn.AdjustLandHealth]:()=>e.turn>a?-1:0})}},{textArea:[.334,.466],text:"When you add <blight>, it Destroys all <presence>/<beasts> in that land and 1 <presence> (total) in an adjacent land.",[yn.Now]:async({$:e})=>{const a=e.turn;await e.clickToContinue(),await e.addSubEffect({[yn.WhenAddingBlight]:async({land:t})=>{e.turn<=a||(e.dontCountAs(Bn.Beasts),e.dontCountAs(Bn.Presence),await t.piecesThatAre(e.Presence).forEach((async e=>{t.blightIsPreventedFromDestroyingPresenceOf(e.owner)||await e.remove(Nn.DestroyByDamageOrBlight)})),await t.destroyAll(e.Beasts,{removement:Nn.DestroyByDamageOrBlight}),await e.countPieceOnlyIfHavingPiece(Bn.Presence,(()=>t.adjacentPiecesInLandsWhere((e=>e.isPresence)))).pickOne((async e=>{t.blightIsPreventedFromDestroyingPresenceOf(e.owner)||await e.remove(Nn.DestroyByDamageOrBlight)}),{noOptions:"No adjacent lands with <presence>."}))}})}}]},Wn={name:"Invaders Find The Land To Their Liking",set:a.JaggedEarth,blightPerPlayer:2,requireEvents:!1,stillHealthy:!0,effects:[{textArea:[.252,.381],text:"Immediately: If the Terror Level is I / II / III, add 1 / 1.5 / 2 Fear Markers per player to the Fear pool. (Round down at Terror Level II.)",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addFearToPool(Math.floor((.5*e.terrorLevel+.5)*e.spiritCount))}}]},Mn={name:"Power Corrodes The Spirit",set:a.JaggedEarth,blightPerPlayer:4,requireEvents:!1,effects:[{textArea:[.292,.465],text:"Each Invader Phase: Each Spirit Destroys 1 of their <presence> if they have 3 or more Power Cards in play, or have a Power Card in play costing 4 or more (printed) Energy.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffect({effectId:wn.PowerCorrodesTheSpirit,[yn.BlightedIslandPhase]:()=>e.spiritsWhich((e=>e.powerCardsInPlay.length>=3||e.powerCardsInPlay.some((e=>e.costToPlay>=4)))).forEach((a=>e.doBlightCardAction((async()=>{await a.destroyPresence(1)})))),[yn.GlobalReminder]:()=>({icon:"<blight>",ongoing:!0})})}}]},Gn={name:"Strong Earth Shatters Slowly",set:a.JaggedEarth,blightPerPlayer:2,requireEvents:!1,stillHealthy:!0,effects:[{textArea:[.248,.332],text:"Immediately: Each player adds 1 <blight> (from this card) to a land adjacent to <blight>.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doBlightCardAction((()=>e.inLocationsWhere((a=>a.isLandForBlight&&a.hasAdjacentLocationWhere((a=>a.isLandForBlight&&a.has(e.Blight))))).pickOne((async e=>{await e.addBlight(1)}))))))}]},Hn={name:"Thriving Communities",set:a.JaggedEarth,blightPerPlayer:4,requireEvents:!0,effects:[{textArea:[.291,.388],text:"Immediately, on each board: In 4 different lands with <explorer>/<town>, Replace 1 <town> with 1 <city> or Replace 1 <explorer> with 1 <town>.",[yn.Now]:({$:e})=>e.doBlightCardActionOnEachBoard((a=>a.inLandsWith(e.ExplorerOrTown).selectOrder().pickMultiple({amount:4,effect:{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <explorer>/<town>`},forPickedItem:async a=>{await a.piecesThatAre(e.ExplorerOrTown).pickOne((async a=>{a.isA(e.Explorer)?await a.replace([Bn.Town]):await a.replace([Bn.City])}))}})))}]},jn={name:"Unnatural Proliferation",set:a.JaggedEarth,blightPerPlayer:3,requireEvents:!1,effects:[{textArea:[.25,.331],text:"Immediately: Each Spirit adds 1 <presence> to a land with their <presence>.",[yn.Now]:({$:e})=>e.eachSpirit((a=>e.doBlightCardAction((async()=>{await a.addPresence()}))))},{textArea:[.332,.473],text:"On Each Board: Add 1 <dahan> to a land with <dahan>, and 2 <city> to the land with fewest <town>/<city> (min. 1).",[yn.Now]:({$:e})=>e.doBlightCardActionOnEachBoard((async a=>{await e.addSubEffect({effects:[{highlightBoards:[a],textArea:[.335,.426],text:"Add 1 <dahan> to a land with <dahan>",[yn.Now]:()=>a.inLandsWith(e.Dahan).pickOne((async a=>{await a.add(1,e.Dahan)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <dahan>.`})},{highlightBoards:[a],textArea:[.38,.475],text:"Add 2 <city> to the land with fewest <town>/<city> (min. 1).",[yn.Now]:()=>a.inLandsWith(e.TownOrCity).withLeast((a=>a.numberOf(e.TownOrCity))).pickOne((async a=>{await a.add(2,e.City)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <town>/<city>.`})}]})}))}]},Un={name:"Untended Land Crumbles",set:a.JaggedEarth,blightPerPlayer:4,requireEvents:!1,effects:[{textArea:[.292,.509],text:"Each Invader Phase: On Each Board: Add 1 <blight> to a land adjacent to <blight>. Spirits may prevent this on any/all boards; each board to be protected requires jointly paying 3 Energy or Destroying 1 <presence> from that board.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffect({effectId:wn.UntendedLandCrumbles,[yn.BlightedIslandPhase]:()=>e.onEachBoard((async a=>{await e.chooseBetween({highlightBoards:[a],effects:[{actionId:"AddBlight",textArea:[.292,.38],text:"Add 1 <blight> to a land adjacent to <blight>.",[yn.Now]:()=>a.inLocationsWhere((a=>a.isLandForBlight&&a.hasAdjacentLocationWhere((a=>a.isLandForBlight&&a.has(e.Blight))))).pickOne((async e=>{await e.addBlight(1)})),condition:()=>a.hasOneLocationWhere((a=>a.isLandForBlight&&a.hasAdjacentLocationWhere((a=>a.isLandForBlight&&a.has(e.Blight)))))},{actionId:"PreventByEnergy",textArea:[.424,.464],text:"Prevent this by jointly paying 3 Energy.",[yn.Now]:async()=>{await e.payEnergyJointlyAidedBy({energy:3})},condition:()=>e.playersCanJointlyPayEnergyAidedBy({energy:3})},{actionId:"PreventByDestroyingPresence",textArea:[.469,.509],text:"Prevent this by Destroying 1 <presence> from that board.",[yn.Now]:()=>a.destroyPresence(1),condition:()=>a.numberOf(e.Presence)>=1}]})})),[yn.GlobalReminder]:()=>({icon:"<blight>",ongoing:!0})})}}]},qn={name:"Attenuated Essence",set:a.NatureIncarnate,blightPerPlayer:4,requireEvents:!1,effects:[{textArea:[.248,.334],text:"Each Invader Phase: Each Spirit with at least 5 <presence> on the island Destroys 1 <presence>.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffect({effectId:wn.AttenuatedEssence,[yn.BlightedIslandPhase]:()=>e.spiritsWhich((e=>e.numberOfPresenceInLands>=5)).forEach((a=>e.doBlightCardAction((async()=>{await a.destroyPresence(1)})))),[yn.GlobalReminder]:()=>({icon:"<blight>",ongoing:!0})})}}]},_n={name:"Blight Corrodes The Spirit",set:a.NatureIncarnate,blightPerPlayer:4,requireEvents:!1,effects:[{textArea:[.251,.337],text:"Each Invader Phase: On Each Board, Destroy 1 <presence> in a land with <blight>.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffect({effectId:wn.BlightCorrodesTheSpirit,[yn.BlightedIslandPhase]:()=>e.doBlightCardActionOnEachBoard((async a=>(await e.countPieceOptionally(Bn.Presence,(()=>a.forPiecesThatIs(e.Presence).where((a=>a.location.has(e.Blight)))))).pickOne((async e=>{await e.destroy()})))),[yn.GlobalReminder]:()=>({icon:"<blight>",ongoing:!0})})}}]};var Jn;!function(e){e.Adjacent="Adjacent",e.AnyLands="Any",e.AnyLocations="AnyLocations",e.OnThisBoard="OnThisBoard",e.Remove="Remove",e.RemoveFromGame="RemoveFromGame",e.Time="Time",e.ToAnyOcean="ToAnyOcean",e.ToOneOfYourLands="ToOneOfYourLands",e.ToClosestLegalLand="ToClosestLegalLand",e.ToThisLocation="InThisLocation",e.WithinRange="WithinRange"}(Jn||(Jn={}));const Vn={name:"Burn Brightest Before The End",set:a.NatureIncarnate,blightPerPlayer:2,requireEvents:!0,effects:[{textArea:[.249,.423],text:"Immediately: Each Spirit Adds 1 <presence> to one of their lands or removes 1 <presence> from their Presence Tracks. (<presence> removed from Presence Tracks goes to the <broken> supply.)",[yn.Now]:({$:e})=>e.eachSpirit((a=>e.doBlightCardAction((async()=>{await e.chooseBetween({effects:[{actionId:"AddToLands",text:"Add 1 <presence> to one of your lands.",[yn.Now]:async()=>{await a.addPresence()}},{actionId:"Remove",text:"Remove 1 <presence> from your Presence Tracks.",[yn.Now]:async()=>{await a.addPresence({locations:Jn.Remove})}}]})}))))}]},Yn={name:"Intensifying Exploitation",set:a.NatureIncarnate,blightPerPlayer:5,requireEvents:!1,effects:[{textArea:[.251,.334],text:"Ongoing, starting next turn: During Ravage Actions, Invaders deal +2 Damage (per land).",[yn.Now]:async({$:e})=>{const a=e.turn;await e.clickToContinue(),await e.addSubEffect({effectId:wn.IntensifyingExploitation,[yn.AdjustCollectiveInvaderRavageDamage]:()=>e.turn>a?2:0,[yn.GlobalReminder]:()=>({icon:"<blight>",ongoing:!0})})}}]},zn={name:"Shattered Fragments Of Power",set:a.NatureIncarnate,blightPerPlayer:2,requireEvents:!0,effects:[{textArea:[.249,.423],text:"Immediately: Draw 1 Major Power Card per Spirit plus 2 more. Each Spirit Takes 1 and gains 2 Energy. (Discard the 2 unselected cards.)",[yn.Now]:async({$:e})=>{let a=[];await e.eachSpirit((t=>e.doBlightCardAction((async()=>{const n=await t.gainPowerCard({powerType:Sn.Major,drawAmount:e.spiritCount+2,discardAfter:3===a.length,withoutForgetting:!0,fromSelection:a.length>0?a:void 0,taken:!0});a=n.notChosen,await t.gainEnergy(2)}))))}}]};var Qn;!function(e){e.AllPieces="AllPieces",e.AllPiecesButDahanPresenceAndSpiritTokens="AllPiecesButDahanPresenceAndSpiritTokens",e.Badlands="Badlands",e.BadlandsOrBeasts="BadlandsOrBeasts",e.BadlandsOrDisease="BadlandsOrDisease",e.BadlandsOrStrife="BadlandsOrStrife",e.Beasts="Beasts",e.BeastsDiseaseOrWilds="BeastsDiseaseOrWilds",e.BadlandsBeastsDiseaseOrWilds="BadlandsBeastsDiseaseOrWilds",e.BlightExplorerOrTown="BlightExplorerOrTown",e.Blight="Blight",e.City="City",e.Dahan="Dahan",e.Deeps="Deeps",e.Disease="Disease",e.Explorer="Explorer",e.ExplorerDahanOrBlight="ExplorerDahanOrBlight",e.ExplorerOrDahan="ExplorerOrDahan",e.ExplorerOrTown="ExplorerOrTown",e.ExplorerTownOrDahan="ExplorerTownOrDahan",e.ExplorerTownDahanOrBeasts="ExplorerTownDahanOrBeast",e.FlameMarker="FlameMarker",e.HiddenLocation="HiddenLocation",e.Incarna="Incarna",e.IncarnaBehemoth="IncarnaBehemoth",e.IncarnaDarkness="IncarnaDarkness",e.IncarnaLair="IncarnaLair",e.IncarnaLocus="IncarnaLocus",e.IncarnaRoots="IncarnaRoots",e.IncarnaVoice="IncarnaVoice",e.IncarnaWarrior="IncarnaWarrior",e.Invader="Invader",e.InvaderDahanPresenceOrBeast="InvaderDahanPresenceOrBeast",e.InvaderDahanOrBeast="InvaderDahanOrBeast",e.InvaderOrDahan="InvaderOrDahan",e.Omen="Omen",e.Presence="Presence",e.Quake="Quake",e.Strife="Strife",e.Thief="Thief",e.Town="Town",e.TownCityOrDahan="TownCityOrDahan",e.TownOrCity="TownOrCity",e.TownOrDahan="TownOrDahan",e.TownPresenceOrBeasts="TownPresenceOrBeasts",e.Vitality="Vitality",e.WardingPattern="WardingPattern",e.Wilds="Wilds"}(Qn||(Qn={}));const Kn={[Qn.AllPieces]:{name:"Piece",text:"piece",pieces:[Bn.Badlands,Bn.Beasts,Bn.Blight,Bn.City,Bn.Dahan,Bn.Deeps,Bn.Disease,Bn.Explorer,Bn.FlameMarker,Bn.HiddenLocation,Bn.IncarnaBehemoth,Bn.IncarnaDarkness,Bn.IncarnaLair,Bn.IncarnaLocus,Bn.IncarnaRoots,Bn.IncarnaVoice,Bn.IncarnaWarrior,Bn.Omen,Bn.Presence,Bn.Quake,Bn.Strife,Bn.Thief,Bn.Town,Bn.Vitality,Bn.WardingPattern,Bn.Wilds],includesInvaders:!0,ignoreCountAs:!0},[Qn.AllPiecesButDahanPresenceAndSpiritTokens]:{name:"Piece",text:"piece",pieces:[Bn.Blight,Bn.City,Bn.Explorer,Bn.FlameMarker,Bn.HiddenLocation,Bn.IncarnaBehemoth,Bn.IncarnaDarkness,Bn.IncarnaLair,Bn.IncarnaLocus,Bn.IncarnaRoots,Bn.IncarnaVoice,Bn.IncarnaWarrior,Bn.Omen,Bn.Thief,Bn.Town,Bn.WardingPattern],includesInvaders:!0,ignoreCountAs:!0},[Qn.Incarna]:{name:"Incarna",text:"incarna",pieces:[Bn.IncarnaBehemoth,Bn.IncarnaDarkness,Bn.IncarnaLair,Bn.IncarnaLocus,Bn.IncarnaRoots,Bn.IncarnaVoice,Bn.IncarnaWarrior],includesInvaders:!1,ignoreCountAs:!0},[Qn.BeastsDiseaseOrWilds]:{name:"Beasts, Disease or Wilds",text:"<beasts>/<disease>/<wilds>",pieces:[Bn.Beasts,Bn.Disease,Bn.Wilds],includesInvaders:!1,ignoreCountAs:!1},[Qn.BadlandsBeastsDiseaseOrWilds]:{name:"Badlands, Beasts, Disease or Wilds",text:"<badlands>/<beasts>/<disease>/<wilds>/<strife>",pieces:[Bn.Badlands,Bn.Beasts,Bn.Disease,Bn.Wilds,Bn.Strife],includesInvaders:!1,ignoreCountAs:!1},[Qn.Badlands]:{name:"Badlands",text:"<badlands>",pieces:[Bn.Badlands],includesInvaders:!1,ignoreCountAs:!1},[Qn.BadlandsOrBeasts]:{name:"Badlands or Beasts",text:"<badlands>/<beasts>",pieces:[Bn.Badlands,Bn.Beasts],includesInvaders:!1,ignoreCountAs:!1},[Qn.BadlandsOrDisease]:{name:"Badlands or Disease",text:"<badlands>/<disease>",pieces:[Bn.Badlands,Bn.Disease],includesInvaders:!1,ignoreCountAs:!1},[Qn.BadlandsOrStrife]:{name:"Badlands or Strife",text:"<badlands>/<strife>",pieces:[Bn.Badlands,Bn.Strife],includesInvaders:!1,ignoreCountAs:!1},[Qn.Beasts]:{name:"Beasts",text:"<beasts>",pieces:[Bn.Beasts],includesInvaders:!1,ignoreCountAs:!1},[Qn.Blight]:{name:"Blight",text:"<blight>",pieces:[Bn.Blight],includesInvaders:!1,ignoreCountAs:!0},[Qn.BlightExplorerOrTown]:{name:"Blight, Explorer or Town",text:"<blight>/<explorer>/<town>",pieces:[Bn.Blight,Bn.Explorer,Bn.Town],includesInvaders:!0,ignoreCountAs:!1},[Qn.City]:{name:"City",text:"<city>",pieces:[Bn.City],includesInvaders:!0,ignoreCountAs:!0},[Qn.Dahan]:{name:"Dahan",text:"<dahan>",pieces:[Bn.Dahan],includesInvaders:!1,ignoreCountAs:!0},[Qn.Deeps]:{name:"Deeps",text:"<deeps>",pieces:[Bn.Deeps],includesInvaders:!1,ignoreCountAs:!0},[Qn.Disease]:{name:"Disease",text:"<disease>",pieces:[Bn.Disease],includesInvaders:!1,ignoreCountAs:!0},[Qn.Explorer]:{name:"Explorer",text:"<explorer>",pieces:[Bn.Explorer],includesInvaders:!0,ignoreCountAs:!1},[Qn.ExplorerDahanOrBlight]:{name:"Explorer / Dahan / Blight",text:"<explorer>/<dahan>/<blight>",pieces:[Bn.Explorer,Bn.Dahan,Bn.Blight],includesInvaders:!0,ignoreCountAs:!1},[Qn.ExplorerOrDahan]:{name:"Explorer / Dahan",text:"<explorer>/<dahan>",pieces:[Bn.Explorer,Bn.Dahan],includesInvaders:!0,ignoreCountAs:!1},[Qn.ExplorerOrTown]:{name:"Explorer / Town",text:"<explorer>/<town>",pieces:[Bn.Explorer,Bn.Town],includesInvaders:!0,ignoreCountAs:!1},[Qn.ExplorerTownOrDahan]:{name:"Explorer / Town / Dahan",text:"<explorer>/<town>/<dahan>",pieces:[Bn.Explorer,Bn.Town,Bn.Dahan],includesInvaders:!0,ignoreCountAs:!1},[Qn.ExplorerTownDahanOrBeasts]:{name:"Explorer / Town / Dahan / Beasts",text:"<explorer>/<town>/<dahan>/<beasts>",pieces:[Bn.Explorer,Bn.Town,Bn.Dahan,Bn.Beasts],includesInvaders:!0,ignoreCountAs:!1},[Qn.FlameMarker]:{name:"FlameMarker",text:"Flame Marker",pieces:[Bn.FlameMarker],includesInvaders:!1,ignoreCountAs:!0},[Qn.HiddenLocation]:{name:"Hidden Location",text:"Hidden Location",pieces:[Bn.HiddenLocation],includesInvaders:!1,ignoreCountAs:!0},[Qn.IncarnaBehemoth]:{name:"Incarna",text:"<incarna-behemoth>",pieces:[Bn.IncarnaBehemoth],includesInvaders:!1,ignoreCountAs:!0},[Qn.IncarnaDarkness]:{name:"Incarna",text:"<incarna-darkness>",pieces:[Bn.IncarnaDarkness],includesInvaders:!1,ignoreCountAs:!0},[Qn.IncarnaLair]:{name:"Incarna",text:"<incarna-lair>",pieces:[Bn.IncarnaLair],includesInvaders:!1,ignoreCountAs:!0},[Qn.IncarnaLocus]:{name:"Incarna",text:"<incarna-locus>",pieces:[Bn.IncarnaLocus],includesInvaders:!1,ignoreCountAs:!0},[Qn.IncarnaRoots]:{name:"Incarna",text:"<incarna-roots>",pieces:[Bn.IncarnaRoots],includesInvaders:!1,ignoreCountAs:!0},[Qn.IncarnaVoice]:{name:"Incarna",text:"<incarna-voice>",pieces:[Bn.IncarnaVoice],includesInvaders:!1,ignoreCountAs:!0},[Qn.IncarnaWarrior]:{name:"Incarna",text:"<incarna-warrior>",pieces:[Bn.IncarnaWarrior],includesInvaders:!1,ignoreCountAs:!0},[Qn.Invader]:{name:"Invader",text:"Invader",pieces:[Bn.Explorer,Bn.Town,Bn.City],includesInvaders:!0,ignoreCountAs:!1},[Qn.InvaderDahanPresenceOrBeast]:{name:"Invader / Dahan / Presence / Beasts",text:"Invader or <dahan>/<presence>/<beasts>",pieces:[Bn.Explorer,Bn.Town,Bn.City,Bn.Dahan,Bn.Presence,Bn.Beasts],includesInvaders:!0,ignoreCountAs:!1},[Qn.InvaderDahanOrBeast]:{name:"Invader / Dahan / Beasts",text:"Invader or <dahan>/<beasts>",pieces:[Bn.Explorer,Bn.Town,Bn.City,Bn.Dahan,Bn.Beasts],includesInvaders:!0,ignoreCountAs:!1},[Qn.InvaderOrDahan]:{name:"Invader / Dahan",text:"Invader or <dahan>",pieces:[Bn.Explorer,Bn.Town,Bn.City,Bn.Dahan],includesInvaders:!0,ignoreCountAs:!1},[Qn.Omen]:{name:"Omen",text:"Omen",pieces:[Bn.Omen],includesInvaders:!1,ignoreCountAs:!0},[Qn.Presence]:{name:"Presence",text:"<presence>",pieces:[Bn.Presence],includesInvaders:!1,ignoreCountAs:!1},[Qn.Quake]:{name:"Quake",text:"<quake>",pieces:[Bn.Quake],includesInvaders:!1,ignoreCountAs:!0},[Qn.Strife]:{name:"Strife",text:"<strife>",pieces:[Bn.Strife],includesInvaders:!1,ignoreCountAs:!0},[Qn.Thief]:{name:"Thief",text:"thief",pieces:[Bn.Thief],includesInvaders:!1,ignoreCountAs:!0},[Qn.Town]:{name:"Town",text:"<town>",pieces:[Bn.Town],includesInvaders:!0,ignoreCountAs:!0},[Qn.TownCityOrDahan]:{name:"Town / City / Dahan",text:"<town>/<city>/<dahan>",pieces:[Bn.Town,Bn.City,Bn.Dahan],includesInvaders:!0,ignoreCountAs:!0},[Qn.TownPresenceOrBeasts]:{name:"Town / Presence / Beasts",text:"<town>/<presence>/<beasts>",pieces:[Bn.Town,Bn.Presence,Bn.Beasts],includesInvaders:!0,ignoreCountAs:!1},[Qn.TownOrCity]:{name:"Town / City",text:"<town>/<city>",pieces:[Bn.Town,Bn.City],includesInvaders:!0,ignoreCountAs:!0},[Qn.TownOrDahan]:{name:"Town / Dahan",text:"<town>/<dahan>",pieces:[Bn.Town,Bn.Dahan],includesInvaders:!0,ignoreCountAs:!0},[Qn.Vitality]:{name:"Vitality",text:"<vitality>",pieces:[Bn.Vitality],includesInvaders:!1,ignoreCountAs:!0},[Qn.WardingPattern]:{name:"Warding Pattern",text:"Warding Pattern",pieces:[Bn.WardingPattern],includesInvaders:!1,ignoreCountAs:!0},[Qn.Wilds]:{name:"Wilds",text:"<wilds>",pieces:[Bn.Wilds],includesInvaders:!1,ignoreCountAs:!0}},Xn={name:"Slow Dissolution Of Will",set:a.NatureIncarnate,blightPerPlayer:3,requireEvents:!1,effects:[{textArea:[.249,.506],text:"Immediately: Each Spirit chooses one of <badlands>, <beasts>, or <wilds>.<br><br>Each Invader Phase: Each Spirit Replaces 1 <presence> with their chosen type of Spirit Token. (The <presence> goes to the <broken> supply.)",[yn.Now]:async({$:e})=>{await e.eachSpirit((a=>e.doBlightCardAction((()=>e.chooseBetween({effects:[Bn.Badlands,Bn.Beasts,Bn.Wilds].map((t=>({actionId:t,text:Kn[t].text,[yn.Now]:async()=>{await e.addSubEffect({textArea:[.377,.513],text:"Each Invader Phase: Each Spirit Replaces 1 <presence> with their chosen type of Spirit Token. (The <presence> goes to the <broken> supply.)",[yn.BlightedIslandPhase]:()=>a.presence().pickOne((async e=>{await e.replace([t])})),[yn.GlobalReminder]:()=>({icon:`<broken> = <br>${Kn[t].text}`,spirit:a,players:[a],ongoing:!0})})}})))})))))}}]};var Zn;!function(e){e.APallUponTheLand="APallUponTheLand",e.AidFromLesserSpirit="AidFromLesserSpirit",e.AllThingsWeaken="AllThingsWeaken",e.AttenuatedEssence="AttenuatedEssence",e.BackAgainstTheWall="BackAgainstTheWall",e.BlightCorrodesTheSpirit="BlightCorrodesTheSpirit",e.BurnBrightestBeforeTheEnd="BurnBrightestBeforeTheEnd",e.DisintegratingEcosystem="DisintegratingEcosystem",e.DownwardSpiral="DownwardSpiral",e.ErosionOfWill="ErosionOfWill",e.IntensifyingExploitation="IntensifyingExploitation",e.InvadersFindTheLandToTheirLiking="InvadersFindTheLandToTheirLiking",e.MemoryFadesToDust="MemoryFadesToDust",e.PowerCorrodesTheSpirit="PowerCorrodesTheSpirit",e.PromisingFarmlands="PromisingFarmlands",e.ShatteredFragmentsOfPower="ShatteredFragmentsOfPower",e.SlowDissolutionOfWill="SlowDissolutionOfWill",e.StrongEarthShattersSlowly="StrongEarthShattersSlowly",e.TheBorderOfLifeAndDeath="TheBorderOfLifeAndDeath",e.ThrivingCommunities="ThrivingCommunities",e.ThrivingCrops="ThrivingCrops",e.TippingPoint="TippingPoint",e.UnnaturalProliferation="UnnaturalProliferation",e.UntendedLandCrumbles="UntendedLandCrumbles"}(Zn||(Zn={}));const er={name:"The Border Of Life And Death",set:a.NatureIncarnate,blightPerPlayer:1,requireEvents:!1,stillHealthy:!0,effects:[{textArea:[.251,.426],text:"Now and Each Invader Phase (until this card is replaced): Each Spirit with at least 2 <presence> on the island Destroys 1 <presence> and may discard a Power Card to gain 1 Energy.",[yn.Now]:async({$:e})=>{const a=async()=>{await e.spiritsWhich((e=>e.numberOfPresenceInLands>=2)).forEach((a=>e.doBlightCardAction((async()=>{await a.destroyPresence(1),a.numberOfPowerCardsInHand>0&&await e.may({prompt:"Discard a Power Card to gain 1 Energy?"})&&(await a.discardPowerCards(1),await a.gainEnergy(1))}))),{noOptions:"No Spirits with at least 2 <presence>."})};await e.addSubEffect({effectId:wn.TheBorderOfLifeAndDeath,[yn.AfterDrawingBlightCard]:({blightCard:a})=>(a!==Zn.TheBorderOfLifeAndDeath&&e.removeThisEffect(),Promise.resolve()),[yn.BlightedIslandPhase]:async()=>{await a()},[yn.GlobalReminder]:()=>({icon:"<blight>",ongoing:!0})}),await a()}}]},ar={name:"Thriving Crops",set:a.NatureIncarnate,blightPerPlayer:2,requireEvents:!1,stillHealthy:!0,effects:[{textArea:[.251,.379],text:"Immediately: On Each Board, Build in 3 lands. (Build Actions in lands without Invaders normally Build 1 <town>.)",[yn.Now]:({$:e})=>e.doBlightCardActionOnEachBoard((e=>e.inLands().pickMultiple({amount:3,forPickedItem:async e=>{await e.doExtraBuild()},effect:{highlightBoards:[e]}})))}]},tr={[Zn.APallUponTheLand]:Cn,[Zn.AidFromLesserSpirit]:On,[Zn.AllThingsWeaken]:$n,[Zn.AttenuatedEssence]:qn,[Zn.BackAgainstTheWall]:Dn,[Zn.BlightCorrodesTheSpirit]:_n,[Zn.BurnBrightestBeforeTheEnd]:Vn,[Zn.DisintegratingEcosystem]:kn,[Zn.DownwardSpiral]:Tn,[Zn.ErosionOfWill]:Ln,[Zn.IntensifyingExploitation]:Yn,[Zn.InvadersFindTheLandToTheirLiking]:Wn,[Zn.MemoryFadesToDust]:Pn,[Zn.PowerCorrodesTheSpirit]:Mn,[Zn.PromisingFarmlands]:Fn,[Zn.ShatteredFragmentsOfPower]:zn,[Zn.SlowDissolutionOfWill]:Xn,[Zn.StrongEarthShattersSlowly]:Gn,[Zn.TheBorderOfLifeAndDeath]:er,[Zn.ThrivingCommunities]:Hn,[Zn.ThrivingCrops]:ar,[Zn.TippingPoint]:Rn,[Zn.UnnaturalProliferation]:jn,[Zn.UntendedLandCrumbles]:Un};var nr,rr,ir,sr;!function(e){e.Sun="Sun",e.Moon="Moon",e.Fire="Fire",e.Air="Air",e.Water="Water",e.Earth="Earth",e.Plant="Plant",e.Animal="Animal",e.Any="Any",e.SunOrMoon="SunOrMoon",e.WaterOrAnimal="WaterOrAnimal",e.FireOrPlant="FireOrPlant",e.DarkFire="DarkFire"}(nr||(nr={})),function(e){e.Fast="Fast",e.Slow="Slow"}(rr||(rr={})),function(e){e.Land="Land",e.Spirit="Spirit"}(ir||(ir={})),function(e){e.Beasts="Beasts",e.Blight="Blight",e.BlightAndInvaders="BlightAndInvaders",e.City="City",e.Coastal="Coastal",e.CoastalCity="CoastalCity",e.Dahan="Dahan",e.Deeps="Deeps",e.Disease="Disease",e.Incarna="Incarna",e.IncarnaAndDahan="IncarnaAndDahan",e.IncarnaBehemoth="IncarnaBehemoth",e.IncarnaLair="IncarnaLair",e.IncarnaRoots="IncarnaRoots",e.IncarnaVoice="IncarnaVoice",e.Inland="Inland",e.Invaders="Invaders",e.InvadersAndIncarnaRoots="InvadersAndIncarnaRoots",e.Jungle="Jungle",e.JunglesOrWetlands="JunglesOrWetlands",e.Mountain="Mountain",e.MountainOrJungles="MountainOrJungles",e.NoInvaders="NoInvaders",e.NonBlight="NonBlight",e.NonOceanLand="NonOceanLand",e.NotWetlands="NotWetlands",e.Quake="Quake",e.SacredSite="SacredSite",e.SacredSiteAndDahan="SacredSiteAndDahan",e.Sands="Sands",e.Strife="Strife",e.TheEndlessDark="TheEndlessDark",e.Town="Town",e.TownOrCity="TownOrCity",e.TwoBeasts="TwoBeasts",e.TwoBeastsAndInvaders="TwoBeastsAndInvaders",e.TwoDahan="TwoDahan",e.WardTheShores="WardTheShores",e.Wetlands="Wetlands"}(sr||(sr={}));const or={name:"Accelerated Rot",type:Sn.Major,speed:rr.Slow,energy:4,elements:[nr.Sun,nr.Water,nr.Plant],set:a.Base,target:ir.Land,targetFilter:[sr.Jungle,sr.Wetlands],range:2,blightWhiteListedPower:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.636,.676],text:"2 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.679,.719],text:"4 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(4)}},{textArea:[.897,.937],text:"If you have 3 <sun> 2 <water> 3 <plant>:<br>+5 Damage.<br>Remove 1 <blight>.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[nr.Sun]:3,[nr.Water]:2,[nr.Plant]:3})&&await e.addSubEffect({effects:[{text:"+5 Damage.",[yn.Now]:async()=>{await t.damage(5)}},{text:"Remove 1 <blight>.",[yn.Now]:async()=>{await t.removeBlight()}}]})}}]},dr={name:"Blazing Renewal",type:Sn.Major,speed:rr.Fast,energy:5,elements:[nr.Fire,nr.Earth,nr.Plant],set:a.Base,target:ir.Spirit,hasDamageInstructions:!0,effects:[{textArea:[.598,.717],text:"Target Spirit adds 2 of their destroyed <presence> into a single land, up to <range-2> from your <presence>.",[yn.TargetSpirit]:async({$:e,you:a,spirit:t})=>{await e.inLocationsWhere((e=>e.inLandsWithin(2,a).hasOneWhere((e=>e.hasPresenceOf(a))))).pickOne((async n=>{if(t.destroyedPresence>0){const a=await t.addPresence({amount:Math.min(t.destroyedPresence,2),together:!0,locations:Jn.AnyLands,filter:e=>e===n,range:2,destroyed:!0,autoPlayOneOption:!0});a.length>0&&await e.addSubEffect({textArea:[.676,.802],text:"If any <presence> was added, 2 Damage to each <town>/<city> in that land.",[yn.Now]:async()=>{await a[0].location.damageEach(2,e.TownOrCity)}})}await e.addSubEffect({textArea:[.899,.939],text:"If you have 3 <fire> 3 <earth> 2 <plant>:<br>4 Damage in that land.",[yn.Now]:async()=>{await a.askToConvertElements({[nr.Fire]:3,[nr.Earth]:2,[nr.Plant]:2})&&await n.damage(4)}})}))}}]},cr={name:"Cleansing Floods",type:Sn.Major,speed:rr.Slow,energy:5,elements:[nr.Sun,nr.Water],set:a.Base,target:ir.Land,sourceFilter:[sr.Wetlands],range:1,blightWhiteListedPower:!0,hasDamageInstructions:!0,effects:[{textArea:[.636,.676],text:"4 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(4)}},{textArea:[.68,.72],text:"Remove 1 <blight>.",[yn.InTargetLand]:async({land:e})=>{await e.removeBlight()}},{textArea:[.899,.939],text:"If you have 4 <water>:<br>+10 Damage.",[yn.InTargetLand]:async({you:e,land:a})=>{await e.askToConvertElements({[nr.Water]:4})&&await a.damage(10)}}]};var lr;!function(e){e.Exactly="Exactly",e.UpTo="UpTo",e.AtLeast="AtLeast",e.All="All",e.Any="Any",e.UpToMinimumOne="UpToMinimumOne",e.May="May"}(lr||(lr={}));const hr={name:"Dissolve The Bonds Of Kinship",type:Sn.Major,speed:rr.Slow,energy:4,elements:[nr.Fire,nr.Water,nr.Animal],set:a.Base,target:ir.Land,range:1,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{textArea:[.611,.651],text:"Replace 1 <city> with 2 <explorer>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.replaceOne({pieces:e.City,withAmount:2,withPiece:Bn.Explorer})}},{textArea:[.611,.683],text:"Replace 1 <town> with 1 <explorer>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.replaceOne({pieces:e.Town,withPiece:Bn.Explorer})}},{textArea:[.646,.686],text:"Replace 1 <dahan> with 1 <explorer>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.replaceOne({pieces:e.Dahan,withPiece:Bn.Explorer})}},{textArea:[.858,.937],text:"If you have 2 <fire> 2 <water> 3 <animal>:<br><explorer> and <town>/<city> do Damage to each other.<br>",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{if(await a.askToConvertElements({[nr.Fire]:2,[nr.Water]:2,[nr.Animal]:3})){const a=t.piecesThatAre(e.Explorer).sum((e=>e.strengthOutOfRavage)),n=t.piecesThatAre(e.TownOrCity).sum((e=>e.strengthOutOfRavage));await t.damage(a,e.TownOrCity),await t.damage(n,e.Explorer)}}},{textArea:[.646,.752],text:"Push all <explorer> from target land to as many different lands as possible.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.push({quantifier:lr.All,pieces:e.Explorer,differentLands:!0})}}]};var ur;!function(e){e.Another="Another",e.Yourself="Yourself"}(ur||(ur={}));const gr={name:"Entwined Power",type:Sn.Major,speed:rr.Fast,energy:2,elements:[nr.Moon,nr.Water,nr.Plant],set:a.Base,target:ir.Spirit,targetFilter:[ur.Another],effects:[{textArea:[.607,.682],text:"You and target Spirit may use each other's <presence> to target Powers.",[yn.TargetSpirit]:async({$:e,you:a,power:t,spirit:n})=>{n!==a&&await e.addSubEffectUntilEndOfTurn({[yn.GlobalReminder]:()=>({power:t.power,players:[a,n]}),[yn.MayUseOtherSpiritPresenceForTargeting]:e=>e.spirit===n?a.presence().items:e.spirit===a?n.presence().items:[]})}},{textArea:[.644,.746],text:"Target Spirit gains a Power Card. You gain one of the Power Cards they did not keep.",[yn.TargetSpirit]:async({you:e,spirit:a})=>{const{notChosen:t}=await a.gainPowerCard();await e.gainPowerCard({fromSelection:t})}},{textArea:[.861,.936],text:"If you have 4 <water> 2 <plant>:<br>You and target Spirit each gain 3 Energy and may gift the other 1 Power from hand.",[yn.TargetSpirit]:async({you:e,spirit:a})=>{await e.askToConvertElements({[nr.Water]:2,[nr.Plant]:4})&&(await e.gainEnergy(3),await a.gainEnergy(3),a!==e&&(await e.powersWhere((e=>e.isInHand)).optionallyPickOne((async e=>{await a.givePower(e)}),{noOptions:`${e.nameLink} has no Powers in hand to gift.`,prompt:`Gift ${a.nameLink} 1 Power from hand?`,players:[e]}),await a.powersWhere((e=>e.isInHand)).optionallyPickOne((async a=>{await e.givePower(a)}),{noOptions:`${a.nameLink} has no Powers in hand to gift.`,prompt:`Gift ${e.nameLink} 1 Power from hand?`,players:[a]})))}}]},fr={name:"Indomitable Claim",type:Sn.Major,speed:rr.Fast,energy:4,elements:[nr.Sun,nr.Earth],set:a.Base,target:ir.Land,range:1,generatesFear:!0,effects:[{textArea:[.594,.722],text:"Add 1 <presence> in target land even if you normally could not due to land type.",[yn.InTargetLand]:async({you:e,land:a})=>{await a.addPresence(e,{ignoreLandType:!0})}},{textArea:[.68,.72],text:"Defend 20.",[yn.InTargetLand]:async({land:e})=>{await e.defend(20)}},{textArea:[.802,.939],text:"If you have 2 <sun> 3 <earth>:<br>3 <fear> if Invaders are present.<br>Invaders skip all Actions in target land this turn.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[nr.Sun]:2,[nr.Earth]:3})&&await e.addSubEffect({effects:[{textArea:[.812,.852],text:"3 <fear> if Invaders are present.",[yn.Now]:async()=>{t.hasInvaders&&await t.fear(3)}},{textArea:[.855,.937],text:"Invaders skip all Actions in target land this turn.",[yn.Now]:async()=>{await t.skipInvaderAction({all:!0})}}]})}}]},pr={[Nn.DirectDestroy]:{verb:"Destroy",textPast:"destroyed",isDestroyLike:!0},[Nn.DestroyByDamageOrBlight]:{verb:"Destroy",textPast:"destroyed",isDestroyLike:!0},[Nn.DestroyByHealthChange]:{verb:"Destroy",textPast:"destroyed",isDestroyLike:!0},[Nn.Drown]:{verb:"Drown",textPast:"drowned",isDestroyLike:!0},[Nn.Relocate]:{verb:"Relocate",textPast:"relocated",isDestroyLike:!1},[Nn.Remove]:{verb:"Remove",textPast:"removed",isDestroyLike:!1},[Nn.RemoveFromGame]:{verb:"Remove from game",textPast:"removed from the game",isDestroyLike:!1},[Nn.Replace]:{verb:"Replace",textPast:"replaced",isDestroyLike:!1},[Nn.Silent]:{verb:"Silent",textPast:"replaced",isDestroyLike:!1,skipEvent:!0}},wr={name:"Infinite Vitality",type:Sn.Major,speed:rr.Fast,energy:3,elements:[nr.Earth,nr.Plant,nr.Animal],set:a.Base,target:ir.Land,sourceFilter:[sr.SacredSite],range:1,blightWhiteListedPower:!0,effects:[{textArea:[.611,.651],text:"<dahan> have +4 Health while in target land.",[yn.InTargetLand]:async({$:e,land:a,effect:t})=>{a.isLand&&await e.addSubEffectUntilEndOfTurn({[yn.AdjustHealth]:({piece:t})=>t.location===a&&t.isA(e.Dahan)?4:0,[yn.Reminder]:e=>e===a?t.text:void 0})}},{textArea:[.647,.719],text:"Whenever <blight> would be added to target land, instead leave it on the card.",[yn.InTargetLand]:async({$:e,land:a,effect:t})=>{await e.addSubEffectUntilEndOfTurn({[yn.Reminder]:e=>e===a?t.text:void 0,[yn.PreventAddBlight]:({location:e})=>Promise.resolve(e===a)})}},{textArea:[.827,.934],text:"If you have 4 <earth>:<br><dahan> ignore Damage and Destruction effects. Remove 1 <blight> from target or adjacent land.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[nr.Earth]:4})&&await e.addSubEffect({effects:[{textArea:[.828,.899],text:"<dahan> ignore Damage and Destruction effects.",[yn.Now]:async({effect:a})=>{t.isLand&&await e.addSubEffectUntilEndOfTurn({[yn.PreventDamagingPiece]:({piece:a})=>Promise.resolve(a.location===t&&a.isA(e.Dahan)),[yn.PreventRemovePiece]:({piece:a,location:n,removement:r})=>Promise.resolve(a.isA(e.Dahan)&&n===t&&pr[r].isDestroyLike),[yn.Reminder]:e=>e===t?a.text:void 0})}},{textArea:[.864,.933],text:"Remove 1 <blight> from target or adjacent land.",[yn.Now]:async()=>{await t.piecesInThisAndAdjacentLocations().where((a=>a.isA(e.Blight)&&a.location.isLandForBlight)).pickOne((async e=>{await e.location.removeBlight()}),{noOptions:"No <blight> to remove in target or adjacent lands."})}}]})}}]},yr={name:"Mists Of Oblivion",type:Sn.Major,speed:rr.Slow,energy:4,elements:[nr.Moon,nr.Air,nr.Water],set:a.Base,target:ir.Land,range:3,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.61,.703],text:"1 <fear> per <town>/<city> this Power destroys (to a maximum of 4).",[yn.InTargetLand]:async({$:e,action:a,land:t})=>{a.data.buildingsDestroyed=0,await e.addEffectUntilEndOfAction({[yn.ActionEnds]:async()=>{await e.sendEvent({type:fn.GenericMain,text:`<p>MistsOfOblivion</p> destroyed ${a.data.buildingsDestroyed} <town>/<city>.`}),await t.fear(Math.min(a.data.buildingsDestroyed,4))}})}},{textArea:[.705,.745],text:"1 Damage to each Invader.",[yn.InTargetLand]:async({$:e,action:a,land:t})=>{const n=await t.damageEach(1);a.data.buildingsDestroyed+=n.filter((a=>pr[a.removement].isDestroyLike&&a.piece.isA(e.TownOrCity))).length}},{textArea:[.884,.924],text:"If you have 2 <moon> 3 <air> 2 <water>:<br>3 Damage.",[yn.InTargetLand]:async({$:e,you:a,land:t,action:n})=>{if(await a.askToConvertElements({[nr.Moon]:2,[nr.Air]:3,[nr.Water]:2})){const a=await t.damage(3);n.data.buildingsDestroyed+=a.filter((a=>pr[a.removement].isDestroyLike&&a.piece.isA(e.TownOrCity))).length}}}]},mr={name:"Paralyzing Fright",type:Sn.Major,speed:rr.Fast,energy:4,elements:[nr.Air,nr.Earth],set:a.Base,target:ir.Land,sourceFilter:[sr.SacredSite],range:1,generatesFear:!0,effects:[{textArea:[.617,.657],text:"4 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(4)}},{textArea:[.664,.748],text:"Invaders skip all Actions in target land this turn.",[yn.InTargetLand]:async({land:e})=>{await e.skipInvaderAction({all:!0})}},{textArea:[.878,.918],text:"If you have 2 <air> 3 <earth>:<br>+4 <fear>.",[yn.InTargetLand]:async({you:e,land:a})=>{await e.askToConvertElements({[nr.Air]:2,[nr.Earth]:3})&&await a.fear(4)}}]},vr={name:"Pillar of Living Flame",type:Sn.Major,speed:rr.Slow,energy:5,elements:[nr.Fire],set:a.Base,target:ir.Land,sourceFilter:[sr.SacredSite],range:2,blightWhiteListedPower:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.592,.632],text:"3 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(3)}},{textArea:[.637,.677],text:"5 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(5)}},{textArea:[.709,.815],text:"If target land is <jungles>/<wetlands>, add 1 <blight>.",[yn.InTargetLand]:async({land:e})=>{e.isJungleOrWetlands&&await e.addBlight(1)}},{textArea:[.897,.937],text:"If you have 4 <fire>:<br>+2 <fear> and +5 damage.",[yn.InTargetLand]:async({land:e,you:a})=>{await a.askToConvertElements({[nr.Fire]:4})&&(await e.fear(2),await e.damage(5))}}]},Ar={name:"Poisoned Land",type:Sn.Major,speed:rr.Slow,energy:3,elements:[nr.Earth,nr.Plant,nr.Animal],set:a.Base,target:ir.Land,range:1,blightWhiteListedPower:!0,generatesFear:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{textArea:[.617,.657],text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.661,.701],text:"7 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(7)}},{textArea:[.705,.745],text:"Add 1 <blight> and destroy all <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.addBlight(1),await a.destroyAll(e.Dahan)}},{textArea:[.847,.934],text:"If you have 3 <earth> 2 <plant> 2 <animal>:<br>For each <blight> then present, +1 <fear> and +4 Damage.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[nr.Earth]:3,[nr.Plant]:2,[nr.Animal]:2})&&(await t.fear(t.numberOf(e.Blight)),await t.damage(4*t.numberOf(e.Blight)))}}]},Ir={name:"Powerstorm",type:Sn.Major,speed:rr.Fast,energy:3,elements:[nr.Sun,nr.Fire,nr.Air],set:a.Base,target:ir.Spirit,effects:[{textArea:[.587,.627],text:"Target Spirit gains 3 Energy.",[yn.TargetSpirit]:async({spirit:e})=>{await e.gainEnergy(3)}},{textArea:[.636,.762],text:"Once this turn, target may Repeat a Power Card by paying its cost again.",[yn.TargetSpirit]:async({$:e,...a})=>{if(a.isRepeat)return;const t=await a.spirit.askToConvertElements({[nr.Sun]:2,[nr.Fire]:2,[nr.Air]:3})?3:1,n=Re.box([]);await e.addSubEffectUntilEndOfTurn({textArea:0===n.get().length||1===t?[.636,.762]:[.848,.934],[yn.GlobalReminder]:()=>({icon:`Repeat<br>${n.get().length} / ${t}`,players:[a.spirit]}),[yn.MayRepeatPowercard]:({power:e,speed:r})=>n.get().length<t&&e.owner===a.spirit&&e.costToPlay<=a.spirit.energy&&e.data.type!==Sn.Innate&&!n.get().includes(e)&&e.possibleToRepeatAtSpeed(r),[yn.RepeatPowerCard]:async({power:a,speed:r})=>{n.get().push(a),n.get().length===t&&e.removeThisEffect(),await a.payForPlay(),await a.replay(r)}})}}]},xr={name:"Talons Of Lightning",type:Sn.Major,speed:rr.Fast,energy:6,elements:[nr.Fire,nr.Air],set:a.Base,target:ir.Land,targetFilter:[sr.Mountain,sr.Wetlands],range:1,generatesFear:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,modifiesRange:({spirit:e,withConvert:a})=>e.hasElements({[nr.Fire]:3,[nr.Air]:3},a)?2:0,payForRange:async({spirit:e})=>{await e.convertElements({[nr.Fire]:3,[nr.Air]:3})},effects:[{textArea:[.636,.676],text:"3 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(3)}},{textArea:[.68,.72],text:"5 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(5)}},{textArea:[.848,.888],text:"If you have 3 <fire> 3 <air>:<br>Destroy 1 <town> in each adjacent land.",[yn.InTargetLand]:async({you:e,$:a,land:t,power:n})=>{n.validOriginsGivenTargetLand(t).hasAtLeast(1,(a=>a.landsWithin(1,e,{targetingLands:!0}).includes(t)))&&!await e.askToConvertElements({[nr.Fire]:3,[nr.Air]:3})||await t.inAdjacentLands().where((e=>e.has(a.Town))).selectOrder().forEach((async e=>{await e.destroyOne(a.Town)}),{noOptions:"No adjacent lands with at <town>."})}}]},br={name:"Terrifying Nightmares",type:Sn.Major,speed:rr.Fast,energy:4,elements:[nr.Moon,nr.Air],set:a.Base,target:ir.Land,range:2,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.636,.676],text:"2 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.68,.72],text:"Push up to 4 <explorer>/<town>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(4,e.ExplorerOrTown)}},{textArea:[.888,.928],text:"If you have 4 <moon>:<br>+4 <fear>.",[yn.InTargetLand]:async({you:e,land:a})=>{await e.askToConvertElements({[nr.Moon]:4})&&await a.fear(4)}}]},Tr={name:"The Jungle Hungers",type:Sn.Major,speed:rr.Slow,energy:3,elements:[nr.Moon,nr.Plant],set:a.Base,target:ir.Land,sourceFilter:[sr.Jungle],range:1,hasDestroyInstructions:!0,effects:[{textArea:[.636,.676],text:"Destroy all <explorer> and all <town>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.destroyAll(e.ExplorerOrTown)}},{textArea:[.679,.719],text:"Destroy all <dahan>.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[nr.Moon]:2,[nr.Plant]:3})||await t.destroyAll(e.Dahan)}},{textArea:[.858,.898],text:"If you have 2 <moon> 3 <plant>:<br>Destroy 1 <city>. Do not destroy any <dahan>.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{a.hasElements({[nr.Moon]:2,[nr.Plant]:3})&&await t.destroyOne(e.City)}}]},Er={name:"The Land Thrashes In Furious Pain",type:Sn.Major,speed:rr.Slow,energy:4,elements:[nr.Moon,nr.Fire,nr.Earth],set:a.Base,target:ir.Land,targetFilter:[sr.Blight],range:2,hasDamageInstructions:!0,effects:[{textArea:[.643,.683],text:"2 Damage per <blight> in target land.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.damage(2*a.numberOf(e.Blight))}},{textArea:[.686,.726],text:"+1 Damage per adjacent <blight>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.damage(a.adjacentPiecesInLocationsWhere((a=>a.location.isLandForBlight&&a.isA(e.Blight))).count)}},{textArea:[.877,.917],text:"If you have 3 <moon> 3 <earth>:<br>Repeat on an adjacent land.",[yn.InTargetLand]:async({you:e,power:a,isRepeat:t,land:n})=>{!t&&await e.askToConvertElements({[nr.Moon]:3,[nr.Earth]:3})&&await n.inAdjacentLands().pickOne((async e=>{await a.repeatInLocations([e])}))}}]},Pr={name:"The Trees And Stones Speak Of War",type:Sn.Major,speed:rr.Fast,energy:2,elements:[nr.Sun,nr.Earth,nr.Plant],set:a.Base,target:ir.Land,targetFilter:[sr.Dahan],range:1,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{textArea:[.624,.722],text:"For each <dahan> in target land, 1 Damage and Defend 2.",[yn.InTargetLand]:async({$:e,land:a})=>{const t=a.numberOf(e.Dahan);await a.damage(t),await a.defend(2*t)}},{textArea:[.851,.94],text:"If you have 2 <sun> 2 <earth> 2 <plant>:<br>You may Push up to 2 <dahan>, moving each one's Defend with them.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{if(await a.askToConvertElements({[nr.Sun]:2,[nr.Earth]:2,[nr.Plant]:2})){const a=await t.pushUpTo(2,e.Dahan);for(const{source:e,destination:t}of a)await e.defend(-2,{singleLand:!1}),await t.defend(2,{singleLand:!1})}}}]},Sr={name:"Tsunami",type:Sn.Major,speed:rr.Slow,energy:6,elements:[nr.Water,nr.Earth],set:a.Base,target:ir.Land,sourceFilter:[sr.SacredSite],targetFilter:[sr.Coastal],range:2,generatesFear:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{textArea:[.592,.632],text:"2 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.636,.676],text:"8 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(8)}},{textArea:[.68,.72],text:"Destroy 2 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.destroy({amount:2,pieces:e.Dahan})}},{textArea:[.809,.942],text:"If you have 3 <water> 2 <earth>:<br>In each other Coastal land on the same board: 1 <fear>, 4 Damage, and Destroy 1 <dahan>.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[nr.Water]:3,[nr.Earth]:2})&&await t.boards().pickOne((a=>a.inCoastalLands().where((e=>e!==t)).selectOrder().forEach((async a=>{await e.addSubEffect({effects:[{textArea:[.854,.894],text:"1 <fear>.",[yn.Now]:async()=>{await a.fear(1)}},{textArea:[.854,.894],text:"4 Damage.",[yn.Now]:async()=>{await a.damage(4)}},{textArea:[.897,.937],text:"Destroy 1 <dahan>.",[yn.Now]:async()=>{await a.destroyOne(e.Dahan)}}]})}))))}}]},Or={name:"Vengeance Of The Dead",type:Sn.Major,speed:rr.Fast,energy:3,elements:[nr.Moon,nr.Fire,nr.Animal],set:a.Base,target:ir.Land,range:3,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.587,.627],text:"3 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(3)}},{textArea:[.63,.94],text:"After each effect that destroys <town>/<city>/<dahan> in target land, 1 Damage per <town>/<city>/<dahan> destroyed.<br><br>If you have 3 <animal>:<br>Damage from this Power may be dealt into adjacent lands.",[yn.InTargetLand]:async({$:e,you:a,land:t,effect:n,...r})=>{const i=await a.askToConvertElements({[nr.Animal]:3}),s=e.nextTriggerId(),o={triggerId:s,text:i?"1 Damage per <town>/<city>/<dahan> destroyed.<br><br>If you have 3 <animal>:<br>Damage from this Power may be dealt into adjacent lands.":"1 Damage per <town>/<city>/<dahan> destroyed.",textArea:i?[.706,.94]:[.717,.757],[yn.Now]:async({action:e})=>{const a=e.parentData.destroyedCount[s];i?await t.damageInThisAndAdjacentLands(a):await t.damage(a)}};await e.addSubEffectUntilEndOfTurn({[yn.Reminder]:e=>e===t?"After each effect that destroys <town>/<city>/<dahan> in target land, 1 Damage per <town>/<city>/<dahan> destroyed."+(i?"<br><br>Damage from this Power may be dealt into adjacent lands.":""):void 0,[yn.AfterRemovePiece]:async({location:a,piece:i,removement:d})=>{a===t&&(i.isA(e.TownOrCity)||i.isA(e.Dahan))&&pr[d].isDestroyLike&&(void 0===e.action.data.destroyedCount&&(e.action.data.destroyedCount={}),e.action.data.destroyedCount[s]=(e.action.data.destroyedCount[s]??0)+1,await e.addTrigger(o,n,r.action))}})}}]},Cr=e=>e.filter(((a,t)=>e.indexOf(a)===t)),Dr={name:"Vigor Of The Breaking Dawn",type:Sn.Major,speed:rr.Fast,energy:3,elements:[nr.Sun,nr.Animal],set:a.Base,target:ir.Land,targetFilter:[sr.Dahan],range:2,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{textArea:[.638,.678],text:"2 Damage per <dahan> in target land.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.damage(2*a.numberOf(e.Dahan))}},{textArea:[.807,.939],text:"If you have 3 <sun> 2 <animal>:<br>You may Push up to 2 <dahan>. In lands you Pushed <dahan> to, 2 Damage per <dahan>.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{if(await a.askToConvertElements({[nr.Sun]:3,[nr.Animal]:2})){let a=[];await e.addSubEffect({effects:[{textArea:[.811,.851],text:"You may Push up to 2 <dahan>.",[yn.Now]:async()=>{const n=await t.pushUpTo(2,e.Dahan);a=Cr(n.filter((({piece:a})=>a.isA(e.Dahan))).map((({destination:e})=>e)))}}]}),await e.addSubEffect({effects:[{textArea:[.853,.937],text:"In lands you Pushed <dahan> to, 2 Damage per <dahan>.",[yn.Now]:async()=>{for(t of a)await t.damage(2*t.numberOf(e.Dahan))}}]})}}}]},Br={name:"Winds Of Rust And Atrophy",type:Sn.Major,speed:rr.Fast,energy:3,elements:[nr.Air,nr.Water,nr.Animal],set:a.Base,target:ir.Land,sourceFilter:[sr.SacredSite],range:3,generatesFear:!0,effects:[{textArea:[.611,.651],text:"1 <fear> and Defend 6. ",[yn.InTargetLand]:async({land:e})=>{await e.fear(1),await e.defend(6)}},{textArea:[.651,.749],text:"Replace 1 <city> with 1 <town> or 1 <town> with 1 <explorer>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.piecesWhere((a=>a.isA(e.TownOrCity))).pickOne((async e=>{await e.downgrade()}))}},{textArea:[.876,.916],text:"If you have 3 <air> 3 <water> 2 <animal>:<br>Repeat this Power.",[yn.InTargetLand]:async({you:e,power:a,isRepeat:t})=>{!t&&await e.askToConvertElements({[nr.Air]:3,[nr.Water]:3,[nr.Animal]:2})&&await a.repeat()}}]},kr={name:"Wrap In Wings Of Sunlight",type:Sn.Major,speed:rr.Fast,energy:3,elements:[nr.Sun,nr.Air,nr.Animal],set:a.Base,target:ir.Land,range:0,hasPushOrGather:!0,effects:[{textArea:[.88,.92],text:"If you have 2 <sun> 2 <air> 2 <animal>: First, Gather up to 3 <dahan>.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[nr.Sun]:2,[nr.Air]:2,[nr.Animal]:2})&&await t.gatherUpTo(3,e.Dahan)}},{textArea:[.61,.743],text:"Move up to 5 <dahan> from target land to any land. Defend 5 in that land.",[yn.InTargetLand]:async({$:e,land:a})=>{const t=await a.move({quantifier:lr.UpTo,amount:5,pieces:e.Dahan,locations:{target:Jn.AnyLands},together:!0});t.length>0&&await t[0].destination.defend(5)}}]},Lr={name:"Bloodwrack Plague",type:Sn.Major,speed:rr.Fast,energy:4,elements:[nr.Water,nr.Earth,nr.Animal],set:a.BranchAndClaw,target:ir.Land,sourceFilter:[sr.SacredSite],range:1,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.607,.647],text:"Add 2 <disease>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.add(2,e.Disease)}},{textArea:[.641,.715],text:"For each <disease> in target land, Defend 1 in target and all adjacent lands.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.inThisAndAdjacentLands().forEach((async t=>{await t.defend(a.numberOf(e.Disease),{singleLand:!1})}))}},{textArea:[.824,.932],text:"If you have 2 <earth> 4 <animal>:<br>2 <fear>. For each <disease> in target land, do 1 Damage in target or an adjacent land.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[nr.Earth]:2,[nr.Animal]:4})&&(await t.fear(2),await t.damageInThisAndAdjacentLands(t.numberOf(e.Disease)))}}]};var Fr;!function(e){e.Bring="Bring",e.Gather="Gather",e.Move="Move",e.Push="Push",e.Relocate="Relocate"}(Fr||(Fr={}));const Rr={name:"Cast Down Into The Briny Deep",type:Sn.Major,speed:rr.Slow,energy:9,elements:[nr.Sun,nr.Moon,nr.Water,nr.Earth],set:a.BranchAndClaw,target:ir.Land,sourceFilter:[sr.SacredSite],targetFilter:[sr.Coastal],range:1,blightWhiteListedPower:!0,generatesFear:!0,hasDestroyInstructions:!0,effects:[{textArea:[.607,.647],text:"6 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(6)}},{textArea:[.641,.681],text:"Destroy all Invaders.",[yn.InTargetLand]:async({$:e,land:a})=>{a.isLand&&await a.destroyAll(e.Invader)}},{textArea:[.792,.933],text:"If you have 2 <sun> 2 <moon> 4 <water> 4 <earth>:<br>Destroy the board containing target land and everything on that board. All destroyed <blight> is removed from the game instead of being returned to the Blight Card.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[nr.Sun]:2,[nr.Moon]:2,[nr.Water]:4,[nr.Earth]:4})&&await t.boards().pickOne((async a=>{for(const t of a.existingLocations){await t.destroyAll(e.AllPieces,{autoPlay:!0});for(const a of e.reminderEffects)void 0!==a[yn.Reminder]&&void 0!==a[yn.Reminder](t)&&e.removeEffect(a)}await e.oneEffectActivates(yn.PreventRemoveBoard),Nn.DirectDestroy,await a.destroy()}))}}]},Nr={name:"Death Falls Gently From Open Blossoms",type:Sn.Major,speed:rr.Slow,energy:4,elements:[nr.Moon,nr.Air,nr.Plant],set:a.BranchAndClaw,target:ir.Land,targetFilter:[sr.Jungle,sr.Sands],range:3,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.607,.647],text:"4 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(4)}},{textArea:[.653,.693],text:"If any Invaders remain, add 1 <disease>.",[yn.InTargetLand]:async({$:e,land:a})=>{a.hasInvaders&&await a.add(1,e.Disease)}},{textArea:[.811,.939],text:"If you have 3 <air> 3 <plant>:<br>3 <fear>.<br>Add 1 <disease> to 2 adjacent lands with Invaders.",[yn.InTargetLand]:async({$:e,land:a,you:t})=>{await t.askToConvertElements({[nr.Air]:3,[nr.Plant]:3})&&(await a.fear(3),await a.inAdjacentLandsWhere((e=>e.hasInvaders)).pickMultiple({amount:2,forPickedItem:async a=>{await a.add(1,e.Disease)}}))}}]},$r={name:"Fire And Flood",type:Sn.Major,speed:rr.Slow,energy:7,elements:[nr.Sun,nr.Fire,nr.Water],set:a.BranchAndClaw,specifyOrigin:!0,target:ir.Land,ranges:[1,2],sourceFilter:[sr.SacredSite],hasDamageInstructions:!0,effects:[{textArea:[.592,.72],text:"4 Damage in each target land. (Range must be measured from the same <sacred>.)",[yn.InTargetLand]:async({$:e,you:a,lands:t})=>{const n=t[0],r=t.length>1?t[1]:null;await e.addSubEffectUntilEndOfTurn({effects:[{text:"4 Damage in each target land.",[yn.Now]:async()=>{await n.damage(4),await(r?.damage(4))}},{textArea:[.812,.852],text:"If you have 3 <fire>:<br>+4 Damage in either target land.",[yn.Now]:async()=>{await a.askToConvertElements({[nr.Fire]:3})&&await e.ofTheseLocations(t).pickOne((async e=>{await e.damage(4)}))}},{textArea:[.897,.937],text:"If you have 3 <water>:<br>+4 Damage in either target land.",[yn.Now]:async()=>{await a.askToConvertElements({[nr.Water]:3})&&await e.ofTheseLocations(t).pickOne((async e=>{await e.damage(4)}))}}]})}}]},Wr={name:"Flow Like Water Reach Like Air",type:Sn.Major,speed:rr.Fast,energy:2,elements:[nr.Air,nr.Water],set:a.BranchAndClaw,target:ir.Spirit,hasPushOrGather:!0,effects:[{textArea:[.6,.64],text:"Target Spirit gets <range+2> with all Powers.",[yn.TargetSpirit]:async({$:e,power:a,spirit:t})=>{await e.addSubEffectUntilEndOfTurn({[yn.GlobalReminder]:()=>({power:a.power,players:[t]}),[yn.ExtraRange]:e=>e.spirit===t?2:0})}},{textArea:[.638,.933],text:"Target Spirit may Push 1 of their <presence> to an adjacent land, bringing up to 2 <explorer>, 2 <town>, and 2 <dahan> along with it.<br><br>If you have 2 <air> 2 <water>:<br>The moved <presence> may also bring along up to 2 <city> and up to 2 <blight>.",[yn.TargetSpirit]:async({$:e,you:a,spirit:t})=>{const n=await a.askToConvertElements({[nr.Air]:2,[nr.Water]:2});await t.inLands().optionallyPickOne((async a=>{const r=await a.push({pieces:e.Presence,owner:t});if(r.length>0){const t=[e.Explorer,e.Town,e.Dahan];n&&t.push(e.City,e.Blight);for(const e of t)await a.move({quantifier:lr.UpTo,amount:2,pieces:e,movement:Fr.Bring,locations:{target:Jn.ToThisLocation,location:r[0].destination}})}}))}}]},Mr={name:"Grant Hatred A Ravenous Form",type:Sn.Major,speed:rr.Slow,energy:4,elements:[nr.Moon,nr.Fire],set:a.BranchAndClaw,target:ir.Land,range:1,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.595,.773],text:"For each <strife>/<blight> in target land, 1 <fear> and 2 Damage.<br><br>If this destroys all Invaders in target land, add 1 <beasts>.",[yn.InTargetLand]:async({$:e,land:a})=>{const t=a.invaders(),n=t.count>0,r=a.numberOfStrife+a.numberOf(e.Blight);await a.fear(r);const i=await a.damage(2*r);for(const e of i)pr[e.removement].isDestroyLike&&t.remove(e.piece);n&&0===t.count&&await a.add(1,e.Beasts)}},{textArea:[.891,.931],text:"If you have 4 <moon> 2 <fire>:<br>Add 1 <strife> in up to 3 adjacent lands.",[yn.InTargetLand]:async({you:e,land:a})=>{await e.askToConvertElements({[nr.Moon]:4,[nr.Fire]:2})&&await a.inAdjacentLands().pickMultiple({amount:3,forPickedItem:async e=>{await e.addStrife(1)},optional:!0,effect:{prompt:"Pick an adjacent land to add <strife>."}})}}]},Gr={name:"Insatiable Hunger Of The Swarm",type:Sn.Major,speed:rr.Fast,energy:4,elements:[nr.Air,nr.Plant,nr.Animal],set:a.BranchAndClaw,target:ir.Land,sourceFilter:[sr.SacredSite],range:2,hasPushOrGather:!0,generatesFear:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{textArea:[.636,.676],text:"Add 1 <blight>.",[yn.InTargetLand]:async({land:e})=>{await e.addBlight(1)}},{textArea:[.636,.676],text:"Add 2 <beasts>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.add(2,e.Beasts)}},{textArea:[.636,.676],text:"Gather up to 2 <beasts>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(2,e.Beasts)}},{textArea:[.673,.748],text:"Each <beasts> deal 1 <fear>, 2 Damage to Invaders and 2 Damage to <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{const t=a.numberOf(e.Beasts);await a.fear(t),await a.damage(2*t,e.Invader),await a.damage(2*t,e.Dahan)}},{textArea:[.706,.746],text:"Destroy 1 <beasts>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.destroyOne(e.Beasts)}},{textArea:[.893,.933],text:"If you have 2 <air> 4 <animal>:<br>Repeat this Power on an adjacent land.",[yn.InTargetLand]:async({you:e,power:a,land:t,isRepeat:n})=>{!n&&await e.askToConvertElements({[nr.Air]:2,[nr.Animal]:4})&&await t.inAdjacentLands().pickOne((async e=>{await a.repeatInLocations([e])}))}}]};var Hr;!function(e){e.Explore="Explore",e.Build="Build",e.Ravage="Ravage"}(Hr||(Hr={}));const jr={name:"Instruments Of Their Own Ruin",type:Sn.Major,speed:rr.Fast,energy:4,elements:[nr.Sun,nr.Fire,nr.Air,nr.Animal],set:a.BranchAndClaw,target:ir.Land,sourceFilter:[sr.SacredSite],range:1,blightWhiteListedPower:!0,hasDamageInstructions:!0,effects:[{textArea:[.592,.632],text:"Add 1 <strife>.",[yn.InTargetLand]:async({land:e})=>{await e.addStrife(1)}},{textArea:[.63,.937],text:"Each Invader with <strife> deals Damage to other Invaders in target land.<br><br>If you have 4 <sun> 2 <fire> 2 <animal>:<br><br>Instead, if Invaders Ravage in target land, they Damage Invaders in adjacent lands instead of <dahan> and the land. <dahan> in target land do not fight back.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{t.isLand&&(await a.askToConvertElements({[nr.Sun]:4,[nr.Fire]:2,[nr.Animal]:2})?(await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({[yn.Reminder]:e=>e===t?"If Invaders Ravage in target land, they Damage Invaders in adjacent lands instead of <dahan> and the land. <dahan> in target land do not fight back.":void 0,[yn.AlterInvaderActionInLand]:async e=>{if(e.land===t&&e.invaderAction===Hr.Ravage){let a=t.participatingInvaders().sum((a=>a.strengthDuringRavage+a.adjustedIndividualInvaderRavageDamage({towardsLand:!1,normal:e.normal})));return a>0&&(a+=e.land.sumAdjustedCollectiveInvaderRavageDamage({normal:e.normal,towardsLand:!1}),await t.damageInAdjacentLands(a)),!0}return!1}})):await t.piecesWithStrifeDealsDamageToOtherInvaders())}}]},Ur={name:"Manifest Incarnation",type:Sn.Major,speed:rr.Slow,energy:6,elements:[nr.Sun,nr.Moon,nr.Earth,nr.Animal],set:a.BranchAndClaw,target:ir.Land,targetFilter:[sr.City],range:0,generatesFear:!0,effects:[{textArea:[.601,.641],text:"6 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(6)}},{textArea:[.643,.713],text:"+1 <fear> for each <town>/<city> and for each of your <presence> in target land.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await t.fear(t.numberOf(e.TownOrCity)+t.numberOfPresenceOf(a))}},{textArea:[.677,.75],text:"Remove 1 <city>, 1 <town> and 1 <explorer>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.remove({amount:1,pieces:e.City}),await a.remove({amount:1,pieces:e.Town}),await a.remove({amount:1,pieces:e.Explorer})}},{textArea:[.71,.75],text:"Then, Invaders in target land Ravage.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[nr.Sun]:3,[nr.Moon]:3})&&await e.addEffectUntilEndOfAction({text:"Invaders do -6 Damage on their Ravage.",[yn.AdjustCollectiveInvaderRavageDamage]:e=>e.land===t?-6:0}),await t.doExtraRavage()}},{textArea:[.853,.893],text:"3 <fear>.",[yn.InTargetLand]:async({$:e,you:a})=>{a.hasElements({[nr.Sun]:3,[nr.Moon]:3})&&await e.fear(3)}}]},qr=(e,a)=>{const t=a instanceof Function?e.findIndex(a):e.indexOf(a);if(t>-1){const[a]=e.splice(t,1);return a}return null},_r=async(e,a)=>{for(let t=0;t<e;t+=1)await a(t)},Jr={name:"Pentup Calamity",type:Sn.Major,speed:rr.Fast,energy:3,elements:[nr.Moon,nr.Fire,nr.Earth,nr.Plant,nr.Animal],set:a.BranchAndClaw,target:ir.Land,range:2,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.611,.943],text:"Add 1 <disease> and 1 <strife>.<or>Remove any number of <beasts>/<disease>/<strife>/<wilds>. For each token removed, 1 <fear> and 3 Damage.<br><br>If you have 2 <moon> 3 <fire>:<br>If you have removed tokens, return up to 2 of them. Otherwise, add 2 <strife>.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await e.chooseBetween({effects:[{actionId:"AddDiseaseAndStrife",textArea:[.613,.653],text:"Add 1 <disease> and 1 <strife>.",[yn.Now]:async()=>{await t.add(1,e.Disease),await t.addStrife(1),await a.askToConvertElements({[nr.Moon]:2,[nr.Fire]:3})&&await e.addSubEffect({textArea:[.9,.94],text:"If you have 2 <moon> 3 <fire>:<br>If you have removed tokens, return up to 2 of them. Otherwise, add 2 <strife>.",[yn.Now]:async()=>{await t.addStrife(2)}})}},{actionId:"RemoveTokens",textArea:[.68,.762],text:"Remove any number of <beasts>/<disease>/<strife>/<wilds>. For each token removed, 1 <fear> and 3 Damage.",[yn.Now]:async()=>{const n=[];for(;;){const a=n.length;if(await t.piecesWhere((a=>a.isA(e.BeastsDiseaseOrWilds)||a.strife>0)).optionallyPickOne((async e=>{if(e.isInvader)await e.removeStrife(),n.push(Bn.Strife);else{const a=await e.remove();a.length>0&&n.push(a[0].piece.piece)}}),{prompt:`Pick any number of <beasts>/<disease>/<strife>/<wilds>. ${n.length} removed.`}),n.length===a)break}n.length>0&&(await t.fear(n.length),await t.damage(3*n.length),await a.askToConvertElements({[nr.Moon]:2,[nr.Fire]:3})&&await e.addSubEffect({textArea:[.867,.94],text:"If you have 2 <moon> 3 <fire>:<br>If you have removed tokens, return up to 2 of them. Otherwise, add 2 <strife>.",[yn.Now]:async()=>{await _r(2,(async a=>{await e.chooseBetween({prompt:`Pick token to return. ${2-a} left.`,effects:n.map((e=>({actionId:e,label:Kn[Qn[e]].text,[yn.Now]:async()=>{qr(n,e),e===Bn.Strife?await t.addStrife(1):await t.add(1,Qn[e])}})))})}))}}))}}]})}}]},Vr={name:"Pyroclastic Flow",type:Sn.Major,speed:rr.Fast,energy:3,elements:[nr.Fire,nr.Air,nr.Earth],set:a.BranchAndClaw,target:ir.Land,sourceFilter:[sr.Mountain],range:1,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{textArea:[.602,.642],text:"2 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(2)}},{textArea:[.602,.642],text:"Destroy all <explorer>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.destroyAll(e.Explorer)}},{textArea:[.683,.786],text:"If target land is <jungles-wetlands>, add 1 <blight>.",[yn.InTargetLand]:async({land:e})=>{e.isJungleOrWetlands&&await e.addBlight(1)}},{textArea:[.89,.93],text:"If you have 2 <fire> 3 <air> 2 <earth>:<br>+4 Damage. Add 1 <wilds>.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[nr.Fire]:2,[nr.Air]:3,[nr.Earth]:2})&&(await t.damage(4),await t.add(1,e.Wilds))}}]},Yr={name:"Savage Transformation",type:Sn.Major,speed:rr.Slow,energy:2,elements:[nr.Moon,nr.Animal],set:a.BranchAndClaw,target:ir.Land,range:1,generatesFear:!0,effects:[{textArea:[.623,.663],text:"2 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.666,.706],text:"Replace 1 <explorer> with 1 <beasts>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.replaceOne({pieces:e.Explorer,withPiece:Bn.Beasts})}},{textArea:[.841,.936],text:"If you have 2 <moon> 3 <animal>:<br>Replace 1 additional <explorer> with 1 <beasts> in either target or adjacent land.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[nr.Moon]:2,[nr.Animal]:3})&&await t.inThisAndAdjacentLands().where((a=>a.has(e.Explorer))).pickOne((async a=>{await a.replaceOne({pieces:e.Explorer,withPiece:Bn.Beasts})}),{noOptions:"No more <explorer> in target or adjacent land."})}}]},zr={name:"Smothering Infestation",type:Sn.Major,speed:rr.Slow,energy:3,elements:[nr.Water,nr.Plant],set:a.BranchAndClaw,target:ir.Land,range:0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.602,.642],text:"Add 1 <disease>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Disease)}},{textArea:[.687,.785],text:"If target land is <jungles-wetlands>, 2 <fear> and 3 Damage.",[yn.InTargetLand]:async({land:e})=>{e.isJungleOrWetlands&&(await e.fear(2),await e.damage(3))}},{textArea:[.894,.934],text:"If you have 2 <water> 2 <plant>: 1 Damage to each Invader.",[yn.InTargetLand]:async({you:e,land:a})=>{await e.askToConvertElements({[nr.Water]:2,[nr.Plant]:2})&&await a.damageEach(1)}}]},Qr={name:"Strangling Firevine",type:Sn.Major,speed:rr.Slow,energy:4,elements:[nr.Fire,nr.Plant],set:a.BranchAndClaw,target:ir.Land,sourceFilter:[sr.Sands],range:1,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{textArea:[.607,.647],text:"Destroy all <explorer>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.destroyAll(e.Explorer)}},{textArea:[.64,.68],text:"Add 1 <wilds>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Wilds)}},{textArea:[.676,.716],text:"Add 1 <wilds> in the originating Sands.",[yn.InTargetLand]:async({$:e,power:a})=>{await a.validOriginSites.pickOne((async a=>{await a.add(1,e.Wilds)}))}},{textArea:[.71,.75],text:"1 Damage per <wilds> in/adjacent to target land.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.damage(a.numberOfPiecesInThisOrAdjacentLands(e.Wilds))}},{textArea:[.86,.934],text:"If you have 2 <fire> 3 <plant>:<br>+1 Damage per <wilds> in/adjacent to target land.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[nr.Fire]:2,[nr.Plant]:3})&&await t.damage(t.numberOfPiecesInThisOrAdjacentLands(e.Wilds))}}]},Kr={name:"Sweep Into The Sea",type:Sn.Major,speed:rr.Slow,energy:4,elements:[nr.Sun,nr.Air,nr.Water],set:a.BranchAndClaw,target:ir.Land,range:2,hasPushOrGather:!0,hasDestroyInstructions:!0,effects:[{textArea:[.604,.791],text:"Push all <explorer> and <town> one land towards the nearest Ocean.<or>If target land is Coastal, destroy all <explorer> and <town>.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"Push",textArea:[.607,.679],text:"Push all <explorer> and <town> one land towards the nearest Ocean.",[yn.Now]:async()=>{await a.inAdjacentLands().where((e=>e.distanceToNearestOcean<a.distanceToNearestOcean)).pickOne((async t=>{await a.push({quantifier:lr.All,pieces:e.ExplorerOrTown,locations:{target:Jn.ToThisLocation,location:t}})}),{noOptions:"No land is closer to the Ocean than target land."})}},{actionId:"DestroyAll",label:"Destroy all <explorer> and <town>.",textArea:[.707,.784],text:"If target land is Coastal, destroy all <explorer> and <town>.",[yn.Now]:async()=>{await a.destroyAll(e.ExplorerOrTown)},condition:()=>a.isCoastal}]})}},{textArea:[.894,.934],text:"Repeat on an adjacent land.",[yn.InTargetLand]:async({isRepeat:e,you:a,power:t,land:n})=>{!e&&await a.askToConvertElements({[nr.Sun]:3,[nr.Water]:2})&&await n.inAdjacentLands().pickOne((async e=>{await t.repeatInLocations([e])}))}}]},Xr={name:"Tigers Hunting",type:Sn.Major,speed:rr.Fast,energy:2,elements:[nr.Sun,nr.Moon,nr.Animal],set:a.BranchAndClaw,target:ir.Land,sourceFilter:[sr.Jungle],targetFilter:[sr.NonBlight],range:1,hasPushOrGather:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.613,.653],text:"2 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.648,.688],text:"Add 1 <beasts>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Beasts)}},{textArea:[.648,.688],text:"Gather up to 1 <beasts>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(1,e.Beasts)}},{textArea:[.686,.726],text:"1 Damage per <beasts>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.damage(a.numberOf(e.Beasts))}},{textArea:[.686,.726],text:"Push up to 2 <beasts>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(2,e.Beasts)}},{textArea:[.85,.93],text:"If you have 2 <sun> 2 <moon> 3 <animal>:<br>1 Damage in a adjacent land without <blight>, and +1 Damage per <beasts> there.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[nr.Sun]:2,[nr.Moon]:2,[nr.Animal]:3})&&await t.inAdjacentLandsWhere((a=>!a.has(e.Blight))).pickOne((async a=>{await a.damage(1+a.numberOf(e.Beasts))}),{noOptions:"No adjacent land is without <blight>."})}}]},Zr={name:"Twisted Flowers Murmur Ultimatums",type:Sn.Major,speed:rr.Slow,energy:5,elements:[nr.Sun,nr.Moon,nr.Air,nr.Earth,nr.Plant],set:a.BranchAndClaw,target:ir.Land,sourceFilter:[sr.SacredSite],targetFilter:[sr.Invaders],range:1,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.607,.647],text:"4 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(4)}},{textArea:[.643,.683],text:"Add 1 <strife>.",[yn.InTargetLand]:async({land:e})=>{await e.addStrife(1)}},{textArea:[.86,.9],text:"If you have 3 <moon> 2 <air> 3 <plant>:<br>+3 <fear>, before the Terror Level check.",[yn.InTargetLand]:async({you:e,land:a})=>{await e.askToConvertElements({[nr.Moon]:3,[nr.Air]:2,[nr.Plant]:3})&&await a.fear(3)}},{textArea:[.68,.753],text:"If the Terror Level is 2 or higher, remove 2 Invaders.",[yn.InTargetLand]:async({$:e,land:a})=>{e.terrorLevel>=2&&await a.remove({amount:2,pieces:e.Invader})}},{textArea:[.896,.936],text:"If you have 3 <moon> 2 <air> 3 <plant>:<br>3 Damage.",[yn.InTargetLand]:async({you:e,land:a})=>{e.hasElements({[nr.Moon]:3,[nr.Air]:2,[nr.Plant]:3})&&await a.damage(3)}}]},ei={name:"Unlock The Gates Of Deepest Power",type:Sn.Major,speed:rr.Fast,energy:4,elements:[nr.Sun,nr.Moon,nr.Fire,nr.Air,nr.Water,nr.Earth,nr.Plant,nr.Animal],set:a.BranchAndClaw,target:ir.Spirit,effects:[{textArea:[.595,.705],text:"Target Spirit gains a Major Power by drawing 2 and keeping 1, without having to Forget another Power Card.",[yn.TargetSpirit]:async({spirit:e,action:a})=>{a.data.powerGain=await e.gainPowerCard({powerType:Sn.Major,drawAmount:2,withoutForgetting:!0,forgetOptional:!0})}},{textArea:[.799,.94],text:"If you have 2 <sun> 2 <moon> 2 <fire> 2 <air> 2 <water> 2 <earth> 2 <plant> 2 <animal>:<br>Target Spirit may now play the Major Power they keep by paying half its cost (round up) OR by Forgetting it at the end of turn. It gains all elemental thresholds.",[yn.TargetSpirit]:async({$:e,spirit:a,you:t,action:n,power:r})=>{await t.askToConvertElements({[nr.Sun]:2,[nr.Moon]:2,[nr.Fire]:2,[nr.Air]:2,[nr.Water]:2,[nr.Earth]:2,[nr.Plant]:2,[nr.Animal]:2},{optionalThreshold:!1})&&await a.powersWhere((e=>n.data.powerGain.chosen.includes(e))).autoPickOne((async n=>{let i=!1;await e.chooseBetween({effects:[{actionId:"PayEnergy",textArea:[.832,.872],label:`Pay ${Math.ceil(n.costToPlay/2)} energy.`,[yn.Now]:async()=>{await n.play({payHalfRoundUp:!0,withoutUsingCardPlays:!0}),i=!0},condition:()=>a.energy>=Math.ceil(n.costToPlay/2)},{actionId:"ForgetPower",textArea:[.865,.905],text:`Forget ${sg[n.power].name} at the end of turn.`,[yn.Now]:async()=>{await n.play({withoutPaying:!0}),await e.addSubEffectUntilEndOfTurn({[yn.GlobalReminder]:()=>({power:r.power,players:[t]}),[yn.AtTimePassesBegin]:async()=>{await n.forget()}}),i=!0}},{actionId:"Neither",text:"Neither."}]}),i&&await e.addSubEffectUntilEndOfTurn({text:"It gains all elemental thresholds.",[yn.GlobalReminder]:()=>({power:n.power,players:[t]}),[yn.PowerHasAllThresholds]:e=>e.power===n})}),{prompt:"Pick which Major Power to apply threshold with."})}}]},ai={name:"Unrelenting Growth",type:Sn.Major,speed:rr.Slow,energy:4,elements:[nr.Sun,nr.Fire,nr.Water,nr.Plant],set:a.BranchAndClaw,target:ir.Spirit,effects:[{textArea:[.604,.7],text:"Target Spirit adds 2 <presence> and 1 <wilds> to a land at <range-1>.",[yn.TargetSpirit]:async({$:e,spirit:a,action:t})=>{t.data.addition=await a.addPresenceInRange(1,{together:!0,amount:2}),t.data.addition.length>0&&await t.data.addition[0].location.add(1,e.Wilds)}},{textArea:[.811,.94],text:"If you have 3 <sun> 3 <plant>:<br>In that land, add 1 additional <wilds> and remove 1 <blight>. Target Spirit gains a Power Card.",[yn.TargetSpirit]:async({$:e,you:a,action:t,spirit:n})=>{if(await a.askToConvertElements({[nr.Sun]:3,[nr.Plant]:3})){const a=t.data.addition[0].location;await a.add(1,e.Wilds),await a.removeBlight(),await n.gainPowerCard()}}}]},ti={name:"Volcanic Eruption",type:Sn.Major,speed:rr.Slow,energy:8,elements:[nr.Fire,nr.Earth],set:a.BranchAndClaw,target:ir.Land,sourceFilter:[sr.Mountain],range:1,blightWhiteListedPower:!0,generatesFear:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{textArea:[.605,.645],text:"6 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(6)}},{textArea:[.643,.683],text:"20 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(20)}},{textArea:[.64,.717],text:"Destroy all <dahan> and <beasts>.",[yn.InTargetLand]:async({$:e,land:a})=>{a.isLand&&(e.dontCountAs(Bn.Beasts),await a.destroyAll(e.Dahan),await a.destroyAll(e.Beasts))}},{textArea:[.676,.716],text:"Add 1 <blight>.",[yn.InTargetLand]:async({land:e})=>{await e.addBlight(1)}},{text:"If you have 4 <fire> 3 <earth>:<br>Destroy all Invaders. Add 1 <wilds>. In each adjacent land: 10 Damage. Destroy all <dahan> and <beasts>. If there are no <blight>, add 1 <blight>.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[nr.Fire]:4,[nr.Earth]:3})&&await e.addSubEffect({effects:[{textArea:[.827,.867],text:"Destroy all Invaders.",[yn.Now]:async()=>{await t.destroyAll(e.Invader)}},{textArea:[.827,.867],text:"Add 1 <wilds>.",[yn.Now]:async()=>{await t.add(1,e.Wilds)}},{textArea:[.865,.934],text:"In each adjacent land: 10 Damage. Destroy all <dahan> and <beasts>. If there are no <blight>, add 1 <blight>.",[yn.Now]:async()=>{await t.inAdjacentLands().selectOrder().forEach((async a=>{await e.addSubEffect({effects:[{textArea:[.861,.901],text:"10 Damage.",[yn.Now]:async()=>{await a.damage(10)}},{textArea:[.861,.934],text:"Destroy all <dahan> and <beasts>.",[yn.Now]:async()=>{await a.destroyAll(e.Dahan),await a.destroyAll(e.Beasts)}},{textArea:[.899,.939],text:"If there are no <blight>, add 1 <blight>.",[yn.Now]:async()=>{a.has(e.Blight)||await a.addBlight(1)}}]})}))}}]})}}]},ni={name:"Angry Bears",type:Sn.Major,speed:rr.Slow,energy:3,elements:[nr.Sun,nr.Fire,nr.Animal],set:a.JaggedEarth,target:ir.Land,range:0,hasPushOrGather:!0,generatesFear:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{textArea:[.597,.637],text:"2 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.597,.637],text:"2 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(2)}},{textArea:[.65,.776],text:"If no <beasts> are present, add 1 <beasts>. Otherwise, +2 Damage, and Push up to 1 <beasts>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.possiblyDontCountPiecesAs(Bn.Beasts),a.doesntHave(e.Beasts)?await e.addSubEffect({textArea:[.65,.69],text:"Add 1 <beasts>.",[yn.Now]:async()=>{await a.add(1,e.Beasts)}}):await e.addSubEffect({textArea:[.69,.775],text:"Otherwise, +2 Damage, and Push up to 1 <beasts>.",[yn.Now]:async()=>{await a.damage(2),await a.pushUpTo(1,e.Beasts)}})}},{textArea:[.86,.946],text:"If you have 2 <fire> 3 <animal>:<br>1 <fear> and Destroy 1 <explorer>/<town> in an adjacent land with <beasts>.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[nr.Fire]:2,[nr.Animal]:3})&&(await t.fear(1),await t.adjacentPiecesInLandsWhere((a=>a.isA(e.ExplorerOrTown)&&a.location.has(e.Beasts))).pickOne((async e=>{await e.destroy()}),{noOptions:"No adjacent land with <explorer>/<town> and <beasts>"}))}}]},ri={name:"Bargains Of Power And Protection",type:Sn.Major,speed:rr.Fast,energy:2,elements:[nr.Sun,nr.Water,nr.Earth,nr.Animal],set:a.JaggedEarth,target:ir.Land,targetFilter:[sr.Dahan],range:0,effects:[{[yn.InTargetLand]:async({$:e,you:a})=>{a.unlockedTrackPresence.length>0&&await a.askToConvertElements({[nr.Sun]:3,[nr.Water]:2,[nr.Earth]:2})?await e.addSubEffect({textArea:[.911,.951],text:"If you have 3 <sun> 2 <water> 2 <earth>:<br>The <presence> instead comes from your <presence> track.",[yn.Now]:async()=>{await a.addPresence({locations:Jn.RemoveFromGame})}}):await e.addSubEffect({textArea:[.592,.664],text:"Remove 1 of your <presence> on the island from the game.",[yn.Now]:async()=>{await a.destroyPresence(1,Nn.RemoveFromGame)}})}},{textArea:[.667,.815],text:"From now on: Each <dahan> within <range-1> of your <presence> provides Defend 1 in its land, and you gain 1 less Energy each turn. (This effect stacks if used multiple times.)",[yn.InTargetLand]:async({$:e,power:a,you:t})=>{let n=!1;await e.addSubEffect({effectId:wn.BargainsOfPowerAndProtection,[yn.GlobalReminder]:()=>({power:a.power,players:[t]}),[yn.DefendFromSpirits]:({land:e})=>e.numberOfParticipatingDahan>0&&e.inLandsWithin(1,t).hasOneWhere((e=>e.hasPresenceOf(t)))?e.numberOfParticipatingDahan:0,[yn.EnergyDebt]:({spirit:e})=>e!==t||n?0:1,[yn.PreventGainEnergy]:async({spirit:a})=>!n&&a===t&&(n=!0,await e.sendEvent({type:fn.GenericMain,text:`${t.nameLink} gained 1 less Energy from <p>BargainsOfPowerAndProtection</p>.`}),!0),[yn.TimePasses]:()=>(n=!1,Promise.resolve())})}}]},ii={name:"Draw Towards A Consuming Void",type:Sn.Major,speed:rr.Slow,energy:8,elements:[],set:a.JaggedEarth,target:ir.Land,range:0,hasPushOrGather:!0,generatesFear:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{textArea:[.607,.682],text:"Gather 1 <explorer>, <town>, <city>, <dahan>, <beasts>, and 1 <presence> (from any Spirit) from each adjacent land.",[yn.InTargetLand]:({$:e,land:a})=>a.inAdjacentLands().forEach((async t=>{for(const n of[e.Explorer,e.Town,e.City,e.Dahan,e.Beasts,e.Presence])await a.gather({amount:1,pieces:n,filter:e=>e===t,pickPiecesEffect:{autoPlayOneOption:!0}})}))},{textArea:[.687,.727],text:"4 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(4)}},{textArea:[.687,.727],text:"15 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(15)}},{textArea:[.687,.727],text:"5 Damage to <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.damage(5,e.Dahan)}},{textArea:[.722,.762],text:"Destroy 1 <presence> from each Spirit.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.eachSpirit((async t=>{await a.destroy({amount:1,pieces:e.Presence,owner:t})}))}},{textArea:[.722,.762],text:"Destroy 2 <beasts>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.destroy({amount:2,pieces:e.Beasts})}},{textArea:[.831,.94],text:"If you have no other power cards in play: Any number of times: Forget a Minor Power, a Major Power, and a Unique Power to perform the above effects again.",[yn.InTargetLand]:async({$:e,power:a,you:t,land:n})=>{1===t.powerCardsInPlayNotBlessed.length&&t.hasAtLeastNonBlessed(1,En.Minor)&&t.hasAtLeastNonBlessed(1,En.Major)&&t.hasAtLeastNonBlessed(1,En.Unique)&&await e.may({prompt:"Forget a Minor Power, a Major Power, and a Unique Power to perform the above effects again?"})&&(await t.forgetPowers({powerFilter:En.Minor}),await t.forgetPowers({powerFilter:En.Major}),await t.forgetPowers({powerFilter:En.Unique}),await t.resolvePowerInLocations(a,[n],!1,!0))}}]},si={name:"Dream Of The Untouched Land",type:Sn.Major,speed:rr.Fast,energy:6,elements:[nr.Moon,nr.Water,nr.Earth,nr.Plant,nr.Animal],set:a.JaggedEarth,target:ir.Land,sourceFilter:[sr.SacredSite],range:1,blightWhiteListedPower:!0,effects:[{textArea:[.584,.663],text:"Remove up to 3 <blight> and up to 3 Health worth of Invaders.",[yn.InTargetLand]:async({land:e})=>{await e.removeBlight({amount:3,quantifier:lr.UpTo}),await e.removeInvadersWorthOfHealthUpTo(3)}},{textArea:[.736,.94],text:'If you have 3 <moon> 2 <water> 3 <earth> 2 <plant>:<br>(Max. 1x/game) Add a random new Island Board next to target board. Ignore its Setup icons; add 2 <beasts>, 2 <wilds>, 2 <badlands> and up to 2 <presence> (from any Spirits) anywhere on it. From now on, Build Cards and "Each board/Each land" Adversary Actions skip 1 board.',[yn.InTargetLand]:async({$:e,you:a,power:t,land:n})=>{e.hasEffectNamed("Dream Of The Untouched Land")||await a.askToConvertElements({[nr.Moon]:3,[nr.Water]:2,[nr.Earth]:3,[nr.Plant]:2})&&await n.boards().pickOne((async a=>{const n=await a.addRandomBoard();null!==n&&await e.addSubEffect({effects:[{[yn.Now]:async()=>{for(const a of[e.Beasts,e.Wilds,e.Badlands])await n.inLands().pickMultiple({amount:2,effect:{textArea:[.802,.876],text:`Add 2 ${Kn[a].text} anywhere on it.`},forPickedItem:async e=>{await e.add(1,a)},repeatSame:!0})}},{textArea:[.802,.876],text:"Add up to 2 <presence> anywhere on it.",[yn.Now]:async()=>{await e.fromAllSpirits().pickMultiple({amount:2,forPickedItem:async e=>{await n.addPresence(e)},effect:{autoPlayOneOption:!0},repeatSame:!0})}},{textArea:[.87,.942],text:'From now on, Build Cards and "Each board/Each land" Adversary Actions skip 1 board.',[yn.Now]:async()=>{await e.clickToContinue(),await e.addSubEffect({effectId:wn.DreamOfTheUntouchedLand,[yn.GlobalReminder]:()=>({power:t.power}),[yn.BeforeResolvingInvaderCard]:async({invaderAction:a})=>{a===Hr.Build&&await e.inBoards().pickOne((async a=>(await e.addSubEffectUntilEndOfTurn({name:"Skip Board",effectId:wn.DreamOfTheUntouchedLandSkipBoard,[yn.OverrideMatchesInvaderCard]:e=>!e.land.boards().has(a)&&void 0}),Promise.resolve())),{text:`From now on, Build Cards and "Each board/Each land" Adversary Actions skip 1 board.<br><br>Choose a Board to skip the following effect:<br><br>${e.parentEffect?.text}`})},[yn.AfterResolvingBuildCard]:()=>(e.removeEffectsWithId(wn.DreamOfTheUntouchedLandSkipBoard),Promise.resolve()),[yn.BeforeAdversaryActionsOnEachBoard]:async()=>{await e.inBoards().pickOne((async a=>(await e.addSubEffectUntilEndOfTurn({effectId:wn.DreamOfTheUntouchedLandSkipBoard,name:"Skip Board",[yn.PreventAdversaryActionOnBoard]:e=>e.board===a}),Promise.resolve())),{text:`From now on, Build Cards and "Each board/Each land" Adversary Actions skip 1 board.<br><br>Choose a Board to skip the following effect:<br><br>${e.parentEffect?.text}`})},[yn.AfterAdversaryActionsOnEachBoard]:()=>(e.removeEffectsWithId(wn.DreamOfTheUntouchedLandSkipBoard),Promise.resolve())})}}]})}))}}]},oi={name:"Focus The Land's Anguish",type:Sn.Major,speed:rr.Slow,energy:5,elements:[nr.Sun],set:a.JaggedEarth,target:ir.Land,range:1,hasPushOrGather:!0,blightWhiteListedPower:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.697,.779],text:"Gather up to 5 <blight>. 1 Damage per <blight>.",[yn.InTargetLand]:async({$:e,land:a,action:t})=>{await a.gatherUpTo(5,e.Blight);const n=await a.damage(a.numberOf(e.Blight));t.data.destroyedBuilding=n.some((a=>pr[a.removement].isDestroyLike&&a.piece.isA(e.TownOrCity)))}},{textArea:[.894,.934],text:"If you have 3 <sun>:<br>+1 Damage per <blight>.",[yn.InTargetLand]:async({$:e,you:a,land:t,action:n})=>{if(await a.askToConvertElements({[nr.Sun]:3})){const a=await t.damage(t.numberOf(e.Blight));n.data.destroyedBuilding=n.data.destroyedBuilding||a.some((a=>pr[a.removement].isDestroyLike&&a.piece.isA(e.TownOrCity)))}}},{textArea:[.613,.699],text:"If this Power Destroyed any <town>/<city>, 5 <fear>.",[yn.InTargetLand]:async({land:e,action:a})=>{a.data.destroyedBuilding&&await e.fear(5)}}]},di={name:"Forests Of Living Obsidian",type:Sn.Major,speed:rr.Slow,energy:4,elements:[nr.Sun,nr.Fire,nr.Earth,nr.Plant],set:a.JaggedEarth,target:ir.Land,range:0,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{textArea:[.598,.638],text:"Add 1 <badlands>.",[yn.InTargetLand]:async({$:e,land:a,action:t,power:n})=>{t.data.validOrigins=n.validOriginsGivenTargetLand(a),await a.add(1,e.Badlands)}},{textArea:[.598,.638],text:"Push all <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushAll(e.Dahan)}},{textArea:[.657,.697],text:"1 Damage to each Invader.",[yn.InTargetLand]:async({land:e})=>{await e.damageEach(1)}},{textArea:[.702,.782],text:"If the origin land is your <sacred>, +1 Damage to each Invader.",[yn.InTargetLand]:async({you:e,land:a,action:t})=>{t.data.validOrigins.hasOneWhere((a=>a.hasSacredSiteOf(e)))&&await a.damageEach(1)}},{textArea:[.89,.93],text:"If you have 2 <sun> 3 <fire> 3 <earth>:<br>Repeat this Power.",[yn.InTargetLand]:async({isRepeat:e,you:a,power:t})=>{!e&&await a.askToConvertElements({[nr.Sun]:2,[nr.Fire]:3,[nr.Earth]:3})&&await t.repeat()}}]},ci={name:"Infestation Of Venomous Spiders",type:Sn.Major,speed:rr.Fast,energy:4,elements:[nr.Air,nr.Earth,nr.Plant,nr.Animal],set:a.JaggedEarth,target:ir.Land,sourceFilter:[sr.SacredSite],targetFilter:[sr.Invaders],range:2,hasPushOrGather:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.607,.647],text:"Add 1 <beasts>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Beasts)}},{textArea:[.607,.647],text:"Gather up to 1 <beasts>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(1,e.Beasts)}},{textArea:[.666,.939],text:"For each <beasts>, 1 <fear> (max. 4) and Invaders skip one Action in target land.<br><br>If you have 2 <air> 2 <earth> 3 <animal>:<br>After this Power causes Invaders to skip an Action, 4 Damage.",[yn.InTargetLand]:async({$:e,you:a,land:t,effect:n,action:r})=>{const i=Math.min(t.numberOf(e.Beasts),4);await t.fear(i);const s={textArea:[.86,.939],text:"If you have 2 <air> 2 <earth> 3 <animal>:<br>After this Power causes Invaders to skip an Action, 4 Damage.",triggerId:e.nextTriggerId(),[yn.Now]:async()=>{await t.damage(4)}},o=await a.askToConvertElements({[nr.Air]:2,[nr.Earth]:2,[nr.Animal]:3});await t.skipInvaderAction({text:"For each <beasts>, Invaders skip one Action in target land."+(o?"<br><br>After this Power causes Invaders to skip an Action, 4 Damage.":""),amount:i,afterSkip:async()=>{o&&await e.addTrigger(s,n,r)}})}}]},li={name:"Irresistible Call",type:Sn.Major,speed:rr.Fast,energy:6,elements:[nr.Sun,nr.Air,nr.Plant],set:a.JaggedEarth,target:ir.Land,sourceFilter:[sr.SacredSite],targetFilter:[sr.Inland],range:2,hasPushOrGather:!0,effects:[{textArea:[.624,.715],text:"Gather 5 <town>, 5 <dahan>, 5 <beasts>, and 15 <explorer>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.possiblyDontCountPiecesAs(Bn.Beasts),await a.gather({amount:5,pieces:e.Town}),await a.gather({amount:5,pieces:e.Dahan}),await a.gather({amount:5,pieces:e.Beasts}),await a.gather({amount:15,pieces:e.Explorer})}},{textArea:[.848,.939],text:"If you have 2 <sun> 3 <air> 2 <plant>:<br>Invaders skip all Actions in target land. Isolate target land.",[yn.InTargetLand]:async({you:e,land:a})=>{await e.askToConvertElements({[nr.Sun]:2,[nr.Air]:3,[nr.Plant]:2})&&(await a.skipInvaderAction({text:"Invaders skip all Actions in target land.",all:!0}),await a.isolate())}}]},hi={name:"Melt Earth Into Quicksand",type:Sn.Major,speed:rr.Fast,energy:4,elements:[nr.Moon,nr.Water,nr.Earth],set:a.JaggedEarth,target:ir.Land,targetFilter:[sr.Sands,sr.Wetlands],range:1,generatesFear:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{textArea:[.607,.647],text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.607,.647],text:"2 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(2)}},{textArea:[.607,.647],text:"Isolate target land.",[yn.InTargetLand]:async({land:e})=>{await e.isolate()}},{textArea:[.663,.75],text:"After Invaders/<dahan> are Moved into target land, Destroy them.",[yn.InTargetLand]:async({$:e,land:a,effect:t,...n})=>{const r={triggerId:e.nextTriggerId(),[yn.Now]:async({action:t})=>{for(const n of t.parentData.piecesToDestroy)n.isAlive&&n.location===a&&(await e.sendEvent({type:fn.GenericMain,text:`<p>MeltEarthIntoQuicksand</p> triggered from ${Kn[n.piece].text} moving into ${a.coordinateLink}.`}),await n.destroy())}};await e.addSubEffectUntilEndOfTurn({[yn.Reminder]:e=>e===a?t.text:void 0,[yn.AfterMoving]:async({piece:i,source:s,destination:o,movement:d})=>{i.isA(e.InvaderOrDahan)&&s!==a&&o===a&&d!==Fr.Relocate&&(void 0===e.action.data.piecesToDestroy&&(e.action.data.piecesToDestroy=[]),e.action.data.piecesToDestroy.push(i),await e.addTrigger(r,t,n.action,{movingAction:e.action}))}})}},{textArea:[.874,.914],text:"If you have 2 <moon> 4 <water> 2 <earth>:<br>+4 Damage. Add 1 <badlands>. Add 1 <wilds>.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[nr.Fire]:2,[nr.Water]:4,[nr.Earth]:2})&&(await t.damage(4),await t.add(1,e.Badlands),await t.add(1,e.Wilds))}}]},ui={name:"Sea Monsters",type:Sn.Major,speed:rr.Slow,energy:5,elements:[nr.Water,nr.Animal],set:a.JaggedEarth,target:ir.Land,targetFilter:[sr.Coastal,sr.Wetlands],range:1,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.594,.634],text:"Add 1 <beasts>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Beasts)}},{textArea:[.641,.681],text:"If Invaders are present, 2 <fear> per <beasts> (max. 8 <fear).",[yn.InTargetLand]:async({$:e,land:a})=>{a.hasInvaders&&await a.fear(Math.min(2*a.numberOf(e.Beasts),8))}},{textArea:[.683,.723],text:"3 Damage per <beasts>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.damage(3*a.numberOf(e.Beasts))}},{textArea:[.729,.769],text:"1 Damage per <blight>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.damage(a.numberOf(e.Blight))}},{textArea:[.878,.918],text:"If you have 3 <water> 3 <animal>:<br>Repeat this Power.",[yn.InTargetLand]:async({you:e,isRepeat:a,power:t})=>{!a&&await e.askToConvertElements({[nr.Water]:3,[nr.Animal]:3})&&await t.repeat()}}]},gi={name:"Settle Into Hunting-Grounds",type:Sn.Major,speed:rr.Fast,energy:3,elements:[nr.Moon,nr.Fire,nr.Plant,nr.Animal],set:a.JaggedEarth,target:ir.Spirit,targetFilter:[ur.Yourself],generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.595,.687],text:"Your <presence> may count as <badlands> and <beasts>. (Decide per <presence>, per Action.)",[yn.TargetSpirit]:async({$:e,power:a,you:t})=>{await e.addSubEffectUntilEndOfTurn({[yn.GlobalReminder]:()=>({text:"Your <presence> may count as <badlands> and <beasts>. (Decide per <presence>, per Action.)<br><br>Your <presence> cannot move.",power:a.power,players:[t]}),[yn.PresenceCountsAsBadlandsOrBeasts]:({spirit:e})=>e===t})}},{textArea:[.696,.736],text:"Your <presence> cannot move.",[yn.TargetSpirit]:async({$:e,you:a})=>{await e.addSubEffectUntilEndOfTurn({[yn.PreventMovePiece]:({piece:e,movement:t})=>e.isAPresenceOf(a)&&t!==Fr.Relocate})}},{textArea:[.845,.937],text:"If you have 2 <plant> 3 <animal>:<br>2 <fear> and 2 Damage in on of your lands.",[yn.TargetSpirit]:async({you:e})=>{await e.askToConvertElements({[nr.Plant]:2,[nr.Animal]:3})&&await e.inLands().pickOne((async e=>{await e.fear(2),await e.damage(2)}))}}]},fi={name:"Sleep And Never Waken",type:Sn.Major,speed:rr.Fast,energy:3,elements:[nr.Moon,nr.Air,nr.Earth,nr.Animal],set:a.JaggedEarth,target:ir.Land,sourceFilter:[sr.Sands],range:2,generatesFear:!0,effects:[{textArea:[.594,.634],text:"Invaders skip all Actions in target land.",[yn.InTargetLand]:async({land:e})=>{await e.skipInvaderAction({all:!0})}},{textArea:[.648,.923],text:"1 <fear> per 2 <explorer> this Power Removes. Remove up to 2 <explorer>.<br><br>If you have 3 <moon> 2 <air> 2 <animal>:<br>Remove up to 6 <explorer> from among your lands.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{const n=[];n.push(...await t.remove({quantifier:lr.UpTo,amount:2,pieces:e.Explorer})),await a.askToConvertElements({[nr.Moon]:3,[nr.Air]:2,[nr.Animal]:2})&&await a.forPieces().pickMultiple({amount:6,where:a=>a.isA(e.Explorer),forPickedItem:async e=>{n.push(...await e.remove())},optional:!0});const r=n.filter((a=>a.piece.isA(e.Explorer)&&a.removement===Nn.Remove)).length;await t.fear(Math.floor(r/2))}}]},pi={name:"Spill Bitterness Into The Earth",type:Sn.Major,speed:rr.Fast,energy:5,elements:[nr.Fire,nr.Water,nr.Earth],set:a.JaggedEarth,target:ir.Land,range:0,blightWhiteListedPower:!0,hasDamageInstructions:!0,effects:[{textArea:[.601,.641],text:"6 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(6)}},{textArea:[.601,.641],text:"Add 2 <badlands>/<strife> and 1 <blight>.",[yn.InTargetLand]:async({$:e,land:a})=>{a.isLand&&await a.add(2,e.BadlandsOrStrife),await a.addBlight(1)}},{textArea:[.648,.733],text:"In up to 3 adjacent lands with <blight>, add 1 <badlands>/<strife>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.inAdjacentLands().pickMultiple({amount:3,where:a=>a.has(e.Blight),forPickedItem:async a=>{await a.add(1,e.BadlandsOrStrife)}})}},{textArea:[.848,.927],text:"If you have 3 <fire> 3 <water>:<br>In up to 3 adjacent lands, 1 Damage to each Invader.",[yn.InTargetLand]:async({you:e,land:a})=>{await e.askToConvertElements({[nr.Fire]:3,[nr.Water]:3})&&await a.inAdjacentLands().pickMultiple({amount:3,forPickedItem:async e=>{await e.damageEach(1)}})}}]},wi={name:"Storm-Swath",type:Sn.Major,speed:rr.Slow,energy:3,elements:[nr.Fire,nr.Air,nr.Water],set:a.JaggedEarth,target:ir.Land,sourceFilter:[sr.SacredSite],range:1,generatesFear:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,modifiesRange:({spirit:e,withConvert:a})=>e.hasElements({[nr.Fire]:2,[nr.Air]:3,[nr.Water]:2},a)?1:0,payForRange:async({spirit:e})=>{await e.convertElements({[nr.Fire]:2,[nr.Air]:3,[nr.Water]:2})},effects:[{textArea:[.6,.64],text:"2 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.601,.676],text:"In both origin land and target land: 1 Damage to each Invader.",[yn.InTargetLand]:async({land:e,power:a,action:t})=>{await a.validOriginsGivenTargetLand(e).pickOne((async a=>{await a.damageEach(1),await e.damageEach(1),t.data.originLand=a}),{prompt:"Select origin land."})}},{textArea:[.773,.94],text:"If you have 2 <fire> 3 <air> 2 <water>:<br>+1 <fear>. This Power has <range+1>.<br>In a land adjacent to both origin and target, 1 Damage to each Invader.<br>In lands where you did Damage, Destroy 1 <town>.",[yn.InTargetLand]:async({$:e,you:a,land:t,action:n})=>{if(await a.askToConvertElements({[nr.Fire]:2,[nr.Air]:3,[nr.Water]:2})){let a=null;await e.addSubEffect({effects:[{textArea:[.773,.813],text:"If you have 2 <fire> 3 <air> 2 <water>:<br>+1 <fear>.",[yn.Now]:async()=>{await t.fear(1)}},{textArea:[.819,.893],text:"In a land adjacent to both origin and target, 1 Damage to each Invader.",[yn.Now]:async()=>{await e.inLandsWhere((e=>e.isAdjacentTo(t)&&e.isAdjacentTo(n.data.originLand))).pickOne((async e=>{await e.damageEach(1),a=e}),{noOptions:"No land adjacent to both origin and target."})}},{textArea:[.903,.943],text:"In lands where you did Damage, Destroy 1 <town>.",[yn.Now]:async()=>{await e.addSubEffect({effects:[{highlightLocations:[t],[yn.Now]:async()=>{await t.destroyOne(e.Town)}},{highlightLocations:[n.data.originLand],[yn.Now]:async()=>{n.data.originLand!==t&&await n.data.originLand.destroyOne(e.Town)}},{highlightLocations:[a],[yn.Now]:async()=>{await(a?.destroyOne(e.Town))}}]})}}]})}}}]},yi={name:"The Wounded Wild Turns On Its Assailants",type:Sn.Major,speed:rr.Slow,energy:4,elements:[nr.Fire,nr.Plant,nr.Animal],set:a.JaggedEarth,target:ir.Land,targetFilter:[sr.Blight],range:1,hasPushOrGather:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.613,.653],text:"Add 2 <badlands>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.add(2,e.Badlands)}},{textArea:[.613,.653],text:"Gather up to 2 <beasts>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(2,e.Beasts)}},{textArea:[.67,.71],text:"1 Damage per <blight>/<beasts>/<wilds>.",[yn.InTargetLand]:async({$:e,land:a,action:t})=>{t.data.removed=await a.damage(a.numberOf(e.Blight)+a.numberOf(e.Beasts)+a.numberOf(e.Wilds))}},{textArea:[.837,.924],text:"If you have 2 <fire> 3 <plant> 2 <animal>:<br>2 <fear> per Invader Destroyed by this Power (max. 8 <fear>).",[yn.InTargetLand]:async({you:e,land:a,action:t})=>{if(await e.askToConvertElements({[nr.Fire]:2,[nr.Plant]:3,[nr.Animal]:2})){const e=t.data.removed.filter((({piece:e,removement:a})=>e.isInvader&&pr[a].isDestroyLike)).length;await a.fear(Math.min(2*e,8))}}}]},mi={name:"Thickets Erupt With Every Touch Of Breeze",type:Sn.Major,speed:rr.Fast,energy:3,elements:[nr.Air,nr.Plant],set:a.JaggedEarth,target:ir.Land,sourceFilter:[sr.SacredSite],targetFilter:[sr.Inland],range:2,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.607,.647],text:"2 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(2)}},{textArea:[.659,.792],text:"Then either: Add 3 <wilds><or>Remove 1 <blight>.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"AddWilds",textArea:[.663,.703],text:"Add 3 <wilds>.",[yn.Now]:async()=>{await a.add(3,e.Wilds)}},{actionId:"RemoveBlight",textArea:[.748,.788],text:"Remove 1 <blight>.",[yn.Now]:async()=>{await a.removeBlight()}}]})}},{textArea:[.887,.927],text:"If you have 3 <plant>:<br>1 <fear>. +2 Damage.",[yn.InTargetLand]:async({you:e,land:a})=>{await e.askToConvertElements({[nr.Plant]:3})&&(await a.fear(1),await a.damage(2))}}]},vi={name:"Transform To A Murderous Darkness",type:Sn.Major,speed:rr.Slow,energy:6,elements:[nr.Moon,nr.Fire,nr.Air,nr.Water,nr.Plant],set:a.JaggedEarth,target:ir.Spirit,hasPushOrGather:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.59,.63],text:"Target Spirit may choose one of their <sacred>.",[yn.TargetSpirit]:async({$:e,spirit:a,action:t})=>{await a.inSacredSites().optionallyPickOne((async n=>{let r;t.data.targetLand=n,await e.addSubEffect({effects:[{textArea:[.64,.709],text:"In that land: Replace each of their <presence> with <badlands>; the Replaced <presence> leaves the game.",[yn.Now]:async()=>{await n.possiblyDontCountPiecesAs(Bn.Presence),r=await n.replaceIndividually({amount:n.numberOfPresenceOf(a),pieces:e.Presence,withPiece:Bn.Badlands,owner:a,removement:Nn.RemoveFromGame})}},{textArea:[.705,.745],text:"Push any number of those <badlands>.",[yn.Now]:async()=>{e.action.data.dontCountAnythingAsBadlands=!0,await n.pushUpTo(r.added.length,e.Badlands)}},{textArea:[.705,.745],text:"3 <fear>.",[yn.Now]:async()=>{await n.fear(3)}},{textArea:[.742,.782],text:"3 Damage per <presence> Replaced.",[yn.Now]:async()=>{e.action.data.dontCountAnythingAsBadlands=!1,await n.damage(3*r.removed.length)}}]})}))}},{text:"If you have 3 <moon> 2 <fire> 2 <air>:<br>1 Damage in an adjacent land.<br>1 Damage in an adjacent land.",[yn.TargetSpirit]:async({$:e,you:a,action:t})=>{if(await a.askToConvertElements({[nr.Moon]:3,[nr.Fire]:2,[nr.Air]:2})){const a=t.data.targetLand;a&&(await e.addSubEffect({text:"1 Damage in an adjacent land.",textArea:[.867,.907],[yn.Now]:async()=>{await a.damageInAdjacentLands(1)}}),await e.addSubEffect({text:"1 Damage in an adjacent land.",textArea:[.9,.94],[yn.Now]:async()=>{await a.damageInAdjacentLands(1)}}))}}}]},Ai={name:"Trees Radiate Celestial Brilliance",type:Sn.Major,speed:rr.Fast,energy:3,elements:[nr.Sun,nr.Moon,nr.Plant],set:a.JaggedEarth,target:ir.Land,targetFilter:[sr.Jungle,sr.NonBlight],range:1,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.62,.66],text:"3 <fear>",[yn.InTargetLand]:async({land:e})=>{await e.fear(3)}},{textArea:[.62,.66],text:"Defend 6",[yn.InTargetLand]:async({land:e})=>{await e.defend(6)}},{textArea:[.68,.766],text:"This turn, Invaders in target land skip the next Build Action.",[yn.InTargetLand]:async({land:e})=>{await e.skipInvaderAction({filter:e=>e.invaderAction===Hr.Build,next:!0})}},{textArea:[.888,.928],text:"If you have 3 <sun> 2 <moon> 2 <plant>:<br>1 Damage per <sun> you have.",[yn.InTargetLand]:async({you:e,land:a})=>{await e.askToConvertElements({[nr.Sun]:3,[nr.Moon]:2,[nr.Plant]:2})&&(await e.askToConvertElementsToCombo({[nr.Sun]:1}),await a.damage(e.elements[nr.Sun]))}}]},Ii={name:"Unleash A Torrent Of The Selfs Own Essence",type:Sn.Major,speed:rr.Fast,energy:2,elements:[nr.Sun,nr.Moon,nr.Fire,nr.Water],set:a.JaggedEarth,target:ir.Spirit,targetFilter:[ur.Yourself],hasDamageInstructions:!0,effects:[{textArea:[.601,.786],text:"Gain 4 Energy. You may Forget a Power Card to gain 4 more Energy.<or>Pay X Energy (min.1) to deal X Damage in a land at <range-0>.",[yn.TargetSpirit]:async({$:e,spirit:a})=>{const t={actionId:"GainEnergy",textArea:[.598,.676],text:"Gain 4 Energy. You may Forget a Power Card to gain 4 more Energy.",[yn.Now]:async()=>{await a.gainEnergy(4),await e.may({prompt:"Forget a Power Card to gain 4 more Energy?"})&&(await a.forgetPowers(),await a.gainEnergy(4))}},n={actionId:"DealDamage",textArea:[.702,.786],text:"Pay X Energy (min.1) to deal X Damage in a land at <range-0>.",condition:()=>a.energy>=1,[yn.Now]:async()=>{const t=await e.selectX(1,a.energy);await a.payEnergy(t),await a.inLandsWithinRange(0).pickOne((async e=>{await e.damage(t)}))}};await e.chooseBetween({effects:[t,n,{actionId:"DoBoth",textArea:[.888,.928],text:"Do both.",condition:()=>!e.treatingAllOrsAsAnds&&a.hasElementsWithConvert({[nr.Sun]:2,[nr.Fire]:3}),effects:[{[yn.Now]:async()=>{await a.convertElements({[nr.Sun]:2,[nr.Fire]:3})}},t,n]}]})}}]},xi={name:"Utter A Curse Of Dread And Bone",type:Sn.Major,speed:rr.Slow,energy:4,elements:[nr.Moon,nr.Animal],set:a.JaggedEarth,target:ir.Land,sourceFilter:[sr.SacredSite],range:1,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.604,.687],text:"For each <blight> in or adjacent to target land, add 1 <badlands>, 1 <disease> or 1 <strife>. (Max +3 of each.)",[yn.InTargetLand]:async({$:e,land:a,action:t})=>{const n=a.numberOf(e.Blight)+a.inAdjacentLocations().sum((a=>a.isLandForBlight?a.numberOf(e.Blight):0));t.data.addedPieces={},await _r(n,(async r=>{await e.chooseBetween({text:`Select piece. ${n-r} left.`,effects:[e.Badlands,e.Disease,e.Strife].map((e=>({actionId:e,label:Kn[e].text,condition:()=>(t.data.addedPieces[e]??0)<3,[yn.Now]:async()=>{t.data.addedPieces[e]=(t.data.addedPieces[e]??0)+1,await a.add(1,e)}})))})}))}},{textArea:[.692,.732],text:"Then: 2 <fear>. 1 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.fear(2),await e.damage(1)}},{textArea:[.831,.934],text:"If you have 3 <moon> 2 <animal>:<br>For each type of token you added, add 1 more within <range-1>. 1 Damage in an adjacent land.",[yn.InTargetLand]:async({$:e,you:a,land:t,action:n})=>{await a.askToConvertElements({[nr.Moon]:3,[nr.Animal]:2})&&await e.addSubEffect({effects:[{textArea:[.831,.906],text:"If you have 3 <moon> 2 <animal>:<br>For each type of token you added, add 1 more within <range-1>.",[yn.Now]:async()=>{for(const r of Object.keys(n.data.addedPieces))r===e.Strife?await t.forPiecesWithin(1,a).where((e=>e.isInvader)).pickOne((async e=>{await e.addStrife()}),{prompt:"Add 1 <strife> to an Invader within <range-1>."}):await t.inLandsWithin(1,a).pickOne((async e=>{await e.add(1,r)}),{prompt:`Pick a land to add ${Kn[r].text}.`})}},{textArea:[.899,.939],text:"1 Damage in an adjacent land.",[yn.Now]:async()=>{await t.damageInAdjacentLands(1)}}]})}}]},bi={name:"Vanish Softly Away Forgotten By All",type:Sn.Major,speed:rr.Slow,energy:3,elements:[nr.Moon,nr.Air],set:a.JaggedEarth,target:ir.Land,range:2,effects:[{textArea:[.587,.788],text:"Remove 1 Invader and 1 <explorer>/<town>.<or>Remove all Damaged Invaders.<br><br>Adversary or Scenario rules that prevent or alter Removal do not affect this Power.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.addEffectUntilEndOfActionTree({[yn.PreventRemovalEffects]:()=>!0}),await e.chooseBetween({effects:[{actionId:"RemoveInvader",textArea:[.588,.628],text:"Remove 1 Invader and 1 <explorer>/<town>.",[yn.Now]:async()=>{await a.remove({amount:1,pieces:e.Invader}),await a.remove({amount:1,pieces:e.ExplorerOrTown})}},{actionId:"RemoveDamaged",textArea:[.657,.697],text:"Remove all Damaged Invaders.",[yn.Now]:async()=>{await a.remove({quantifier:lr.All,pieces:e.Invader,filter:e=>e.damage>0})}}]})}},{textArea:[.88,.95],text:"If you have 3 <moon> 3 <air>:<br>In any 2 lands with 4 or more Invaders: Remove 1 Invader.",[yn.InTargetLand]:async({$:e,you:a})=>{await a.askToConvertElements({[nr.Moon]:3,[nr.Air]:3})&&await e.inLandsWhere((a=>a.numberOf(e.Invader)>=4)).pickMultiple({amount:2,forPickedItem:async a=>{await a.remove({amount:1,pieces:e.Invader})}})}}]},Ti={name:"Voice Of Command",type:Sn.Major,speed:rr.Fast,energy:3,elements:[nr.Sun,nr.Air],set:a.JaggedEarth,target:ir.Land,sourceFilter:[sr.SacredSite],targetFilter:[sr.Dahan],range:1,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{textArea:[.878,.918],text:"If you have 3 <sun> 2 <air>:<br>First, Gather up to 2 <explorer>/<town>/<dahan>.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[nr.Sun]:3,[nr.Air]:2})&&await t.gatherUpTo(2,e.ExplorerTownOrDahan)}},{textArea:[.597,.637],text:"1 Damage per <dahan>/<explorer>, to <town>/<city> only.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.damage(a.numberOf(e.Dahan)+a.numberOf(e.Explorer),e.TownOrCity)}},{textArea:[.653,.693],text:"Defend 2.",[yn.InTargetLand]:async({land:e})=>{await e.defend(2)}},{textArea:[.653,.766],text:"During Ravage Actions, <explorer> fight alongside <dahan>. (Deal/take Damage at the same time, and to/from the same sources.)",[yn.InTargetLand]:async({$:e,land:a,effect:t})=>{await e.addSubEffectUntilEndOfTurn({[yn.Reminder]:e=>e===a?t.text:void 0,[yn.ExplorersFightWithDahan]:e=>e.land===a})}}]},Ei={name:"Walls Of Rock And Thorn",type:Sn.Major,speed:rr.Fast,energy:4,elements:[nr.Sun,nr.Earth,nr.Plant],set:a.JaggedEarth,target:ir.Land,sourceFilter:[sr.SacredSite],targetFilter:[sr.Mountain,sr.Jungle],range:2,hasDamageInstructions:!0,effects:[{textArea:[.597,.637],text:"2 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(2)}},{textArea:[.597,.637],text:"Defend 8.",[yn.InTargetLand]:async({land:e})=>{await e.defend(8)}},{textArea:[.653,.693],text:"Add 1 <wilds>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Wilds)}},{textArea:[.653,.693],text:"Isolate target land.",[yn.InTargetLand]:async({land:e})=>{await e.isolate()}},{text:"If you have 2 <earth> 2 <plant>:<br>+2 Damage. +2 Defend. Add 1 <badlands>.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[nr.Earth]:2,[nr.Plant]:2})&&(await e.addSubEffect({effects:[{textArea:[.822,.862],text:"+2 Damage.",[yn.Now]:async()=>{await t.damage(2)}}]}),await e.addSubEffect({effects:[{textArea:[.822,.862],text:"+2 Defend.",[yn.Now]:async()=>{await t.defend(2)}}]}),await e.addSubEffect({effects:[{textArea:[.865,.905],text:"Add 1 <badlands>.",[yn.Now]:async()=>{await t.add(1,e.Badlands)}}]}))}}]},Pi={name:"Weave Together The Fabric Of Place",type:Sn.Major,speed:rr.Fast,energy:4,elements:[nr.Sun,nr.Moon,nr.Air,nr.Water,nr.Earth],set:a.JaggedEarth,target:ir.Land,sourceFilter:[sr.SacredSite],range:1,generatesFear:!0,effects:[{textArea:[.591,.776],text:"Target land and a land adjacent to it become a single land for this turn. (It has the terrain and land # of both lands. When this effect expires, divide pieces as you wish; all of them are considered moved.)",[yn.InTargetLand]:async({$:e,land:a,...t})=>{await a.inAdjacentLands().pickOne((async n=>{const r=n.adjacentLocations.filter((e=>!a.isAdjacentTo(e)&&a!==e)).map((e=>({land1:a,land2:e})));await n.move({quantifier:lr.All,pieces:Qn.AllPieces,movement:Fr.Relocate,locations:{target:Jn.ToThisLocation,location:a}}),n.exists=!1,await e.addSubEffectUntilEndOfTimePasses({[yn.LocationIsOcean]:({location:e})=>e===a&&n.isOcean,[yn.LocationIsTerrain]:({location:e,terrain:t})=>e===a&&n.terrain===t,[yn.ExtraLandNumber]:({location:e})=>e===a&&a.landNumber!==n.landNumber?n.landNumber:null,[yn.ExtraBoard]:({location:e})=>e===a&&a.board!==n.board?n.board:null,[yn.Reminder]:e=>e===a||e===n?t.effect.text:void 0,[yn.BoardHasExtraLocation]:({board:e})=>n.board===e&&a.board!==e?a:null,[yn.AtTimePassesEnds]:async()=>{a.exists&&(n.exists=!0),e.removeThisEffect(),e.setupAdjacencies(),await e.doSpiritAction((async()=>{await a.forPieces().forEach((async e=>{await e.move({locations:{target:Jn.AnyLocations},destinationFilter:e=>e===a||e===n,oceanIsAllowed:!0,pickPiecesEffect:{textArea:[.707,.779],highlightLocations:[a,n],text:"When this effect expires, divide pieces as you wish; all of them are considered moved."}})}))}),{spirit:t.action.spirit})},[yn.ExtraAdjacency]:()=>r}),e.setupAdjacencies()}))}},{textArea:[.864,.934],text:"If you have 4 <air>:<br>Isolate the joined land. If it has Invaders, 2 <fear>, and Remove up to 2 Invaders.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[nr.Air]:4})&&(await t.isolate(),t.hasInvaders&&(await t.fear(2),await t.remove({quantifier:lr.UpTo,amount:2,pieces:e.Invader})))}}]},Si={name:"Bargain Of Coursing Paths",type:Sn.Major,speed:rr.Fast,energy:2,elements:[nr.Moon,nr.Air,nr.Water,nr.Earth],set:a.NatureIncarnate,target:ir.Land,targetFilter:[sr.TwoDahan],range:0,effects:[{textArea:[.907,.947],text:"Bargain: 1 <presence> now and -1 Energy/turn.<br><br>If you have 3 <air> 2 <water> 2 <earth>:<br>The <presence> cost comes from your <presence> tracks.",[yn.InTargetLand]:async({$:e,power:a,you:t})=>{t.unlockedTrackPresence.length>0&&await t.askToConvertElements({[nr.Air]:3,[nr.Water]:2,[nr.Earth]:2})?await e.addSubEffect({[yn.Now]:async()=>{await t.addPresence({locations:Jn.RemoveFromGame})}}):await e.addSubEffect({textArea:[.588,.628],text:"Bargain: 1 <presence> now and -1 Energy/turn.",[yn.Now]:async()=>{await t.destroyPresence(1,Nn.RemoveFromGame)}});let n=!1;await e.addSubEffect({effectId:wn.BargainsOfCoursingPath,[yn.GlobalReminder]:()=>({textArea:[.588,.628],text:"-1 Energy/turn.<br><br>"+(n?"Have paid cost this turn.":"Have not paid cost this turn."),ongoing:!0,power:a.power,players:[t]}),[yn.EnergyDebt]:({spirit:e})=>e!==t||n?0:1,[yn.PreventGainEnergy]:async({spirit:a})=>!n&&a===t&&(n=!0,await e.sendEvent({type:fn.GenericMain,text:`${t.nameLink} gained 1 less Energy from <p>BargainOfCoursingPaths</p>.`}),!0),[yn.TimePasses]:()=>(n=!1,Promise.resolve())})}},{textArea:[.63,.706],text:"Now: Mark both target land and another land with 2 or more <dahan>.",[yn.InTargetLand]:async({$:e,land:a,action:t})=>{t.data.markedLands=[a],await e.addSubEffect({[yn.Reminder]:e=>t.data.markedLands.includes(e)?"Ongoing: After pieces are added or moved into the marked lands: choose any land, then Move those pieces directly to that land.":void 0}),await e.inLandsWhere((t=>t!==a&&t.hasAtLeast(2,e.Dahan))).pickOne((e=>(t.data.markedLands.push(e),Promise.resolve())),{noOptions:"No other land with 2 or more <dahan>."})}},{textArea:[.71,.818],text:"Ongoing: After pieces are added or moved into the marked lands: choose any land, then Move those pieces directly to that land.",[yn.InTargetLand]:async({$:e,...a})=>{const t=a.action.data.markedLands;await e.afterPiecesAreAddedOrMovedAddTrigger({reminder:!1,permanent:!0,pieces:Qn.AllPieces,locationFilter:e=>t.includes(e),trigger:{triggerId:e.nextTriggerId(),[yn.Now]:async({action:a})=>{for(const n of[...a.parentData.piecesAddedOrMoved])n.isA(e.InvaderOrDahan)&&!n.isAlive||!t.includes(n.location)||await n.move({locations:{target:Jn.AnyLands}})}},effect:a.effect,action:a.action})}}]},Oi={name:"Bombard With Boulders And Stinging Seeds",type:Sn.Major,speed:rr.Slow,energy:2,elements:[nr.Air,nr.Earth,nr.Plant],set:a.NatureIncarnate,target:ir.Land,sourceFilter:[sr.MountainOrJungles],range:2,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.629,.67],text:"1 <fear>",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.629,.67],text:"2 Damage",[yn.InTargetLand]:async({land:e})=>{await e.damage(2)}},{textArea:[.696,.737],text:"Add 1 <badlands>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Badlands)}},{textArea:[.854,.938],text:"If you have 2 <air>, 2 <earth>, 3 <plant>:<br><br>1 <fear>. 2 Damage. Add 1 <wilds>.",[yn.InTargetLand]:async({you:e,land:a,$:t})=>{await e.askToConvertElements({[nr.Air]:2,[nr.Earth]:2})&&await t.addSubEffect({effects:[{text:"1 <fear>.",[yn.Now]:async()=>{await a.fear(1)}},{text:"2 Damage.",[yn.Now]:async()=>{await a.damage(2)}},{text:"Add 1 <wilds>.",[yn.Now]:async()=>{await a.add(1,t.Wilds)}}]})}}]},Ci={name:"Exaltation Of The Incandescent Sky",type:Sn.Major,speed:rr.Fast,energy:7,elements:[nr.Sun,nr.Fire,nr.Air,nr.Water],set:a.NatureIncarnate,target:ir.Spirit,targetFilter:[ur.Another],generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.596,.738],text:"Target Spirit may play 1 Power Card by paying its cost, make up to 2 of their Powers <fast> this turn, and do 3 Damage in one of their lands.",[yn.TargetSpirit]:async({$:e,you:a,spirit:t})=>{await t.andAnotherSpirit(a,{now:async(a,t)=>{await e.addSubEffect({effects:[{textArea:t?[.593,.671]:[.729,.77],text:(t?"Target Spirit":"You")+" may play 1 Power Card by paying its cost.",[yn.Now]:async()=>{await a.playAPowerCardByPayingItsCost()}},{textArea:t?[.629,.701]:[.729,.77],text:`${t?"Target Spirit":"You"} may make up to 2 of ${t?"their":"your"} Powers <fast> this turn.`,[yn.Now]:async()=>{await e.clickToContinue(),await a.gainMakeFastBuff({amount:2})}},{textArea:t?[.693,.734]:[.729,.77],text:`${t?"Target Spirit deals":"You deal"} 3 Damage in one of ${t?"their":"your"} lands.`,[yn.Now]:async()=>{await a.inLands().pickOne((async e=>{await e.damage(3)}))}}]})}})}},{textArea:[.771,.935],text:"If you have<br>3 <sun> 3 <fire> 4 <air> 2 <water>:<br><br>In any 4 lands on the island, Skip 1 Invader Action. 5 <fear> (total).",[yn.TargetSpirit]:async({you:e,$:a})=>{await e.askToConvertElements({[nr.Sun]:3,[nr.Fire]:3,[nr.Air]:4,[nr.Water]:2})&&(await a.inLands().pickMultiple({amount:4,forPickedItem:async e=>{await e.skipInvaderAction()}}),await a.fear(5))}}]},Di={name:"Flocking Red Talons",type:Sn.Major,speed:rr.Fast,energy:3,elements:[nr.Air,nr.Water,nr.Plant,nr.Animal],set:a.NatureIncarnate,target:ir.Land,sourceFilter:[sr.Wetlands],range:3,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{textArea:[.612,.653],text:"Add 1 <beasts>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Beasts)}},{textArea:[.61,.683],text:"Move up to 2 <beasts> within <range-3> to target land.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await t.forPiecesWithin(3,a).where((a=>a.isA(e.Beasts))).pickMultiple({amount:2,forPickedItem:async e=>{await e.move({locations:{target:Jn.ToThisLocation,location:t}})},repeatSame:!0,optional:!0})}},{textArea:[.65,.762],text:"For each <beasts> present, choose a different Invader. 1 Damage to each of those Invaders.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.piecesThatAre(e.Invader).pickMultiple({amount:a.numberOf(e.Beasts),forPickedItem:async e=>{await e.damageOnlyThis(1)}})}},{textArea:[.718,.759],text:"Push 1 <explorer>/<town> per <beasts>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.push({amount:a.numberOf(e.Beasts),pieces:e.ExplorerOrTown})}},{textArea:[.774,.935],text:"If you have 2 <air> 2 <plant> 3 <animal>:<br>Repeat this Power on a different land within <range-3> of target land.",[yn.InTargetLand]:async({you:e,land:a,power:t,isRepeat:n})=>{!n&&await e.askToConvertElements({[nr.Air]:2,[nr.Plant]:2,[nr.Animal]:3})&&await a.inLandsWithin(3).where((e=>e!==a)).pickOne((async e=>{await t.repeatInLocations([e])}))}}]},Bi={name:"Fragments Of Yesteryear",type:Sn.Major,speed:rr.Slow,energy:7,elements:[nr.Sun,nr.Moon],set:a.NatureIncarnate,target:ir.Land,range:0,mayBeSpeed:{effect:{textArea:[.726,.82],text:"If you have 3 <sun>:<br>This power may be <fast>.",[yn.Now]:async({action:e})=>{await e.spirit.convertElements({[nr.Sun]:3}),await e.power.makeFast()}},condition:({speed:e,spirit:a})=>e===rr.Fast&&a.hasElementsWithConvert({[nr.Sun]:3})},effects:[{textArea:[.607,.946],text:"Remove all pieces, then Add the pieces matching the target land's Setup Symbols.<br><br>If you have 3 <moon>:<br>Don't Remove <dahan>, any Spirit's <presence>, or Spirit Tokens. Don't Add Invaders/<blight>.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[nr.Moon]:3})?(await t.remove({quantifier:lr.All,pieces:e.AllPiecesButDahanPresenceAndSpiritTokens,autoPlay:!0}),await t.restoreToSetupSymbols({removeFirst:!1,exceptPieces:[e.Invader,e.Blight]})):await t.restoreToSetupSymbols()}}]},ki={name:"Inspire The Release Of StolenLands",type:Sn.Major,speed:rr.Slow,energy:4,elements:[nr.Sun,nr.Water,nr.Plant,nr.Animal],set:a.NatureIncarnate,target:ir.Land,targetFilter:[sr.NonBlight],hasPushOrGather:!0,range:2,effects:[{textArea:[.713,.843],text:"If you have 3 <sun> 3 <water> 2 <animal>:<br><br>This Power can target lands with <blight>.",[yn.InTargetLand]:async({$:e,land:a,you:t})=>{a.has(e.Blight)&&!await t.askToConvertElements({[nr.Sun]:3,[nr.Water]:3,[nr.Animal]:2})||await e.addSubEffect({effects:[{textArea:[.618,.659],text:"Gather up to 3 <dahan>.",[yn.Now]:async()=>{await a.gatherUpTo(3,e.Dahan)}},{textArea:[.621,.694],text:"Remove up to 3 Health worth of Invaders per <dahan>.",[yn.Now]:async()=>{await a.removeInvadersWorthOfHealthUpTo(3*a.numberOf(e.Dahan))}},{textArea:[.834,.941],text:"If <dahan> are present, Remove 1 <blight> from target land, then Remove 1 <explorer>, 1 <town>, and 1 <city> from a land with <range-1> (of target land).",[yn.Now]:async()=>{(a.has(e.Blight)||await t.askToConvertElements({[nr.Sun]:3,[nr.Water]:3,[nr.Animal]:2}))&&a.has(e.Dahan)&&(await a.removeBlight(),await a.inLandsWithin(1,t).pickOne((async a=>{await a.removeOne(e.Explorer),await a.removeOne(e.Town),await a.removeOne(e.City)})))}}]})}}]},Li={name:"Plague Ships Sail To Distant Ports",type:Sn.Major,speed:rr.Fast,energy:4,elements:[nr.Fire,nr.Air,nr.Water,nr.Animal],set:a.NatureIncarnate,target:ir.Land,targetFilter:[sr.CoastalCity],range:1,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.598,.941],text:"1 <fear>. Add 4 <disease> among Coastal lands (on any boards) other than target land.<br><br>If you have 2 <fire> 2 <water> 2 <animal>:<br><br>Instead: 1 <fear>. 3 Damage. Spirits may jointly spend 3 Energy per player (aided by Removing <disease> from the island for 3 Energy each) to remove the top card of the Fear Deck from the game. Add 1 <disease>.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[nr.Fire]:2,[nr.Water]:2,[nr.Animal]:2})?await e.addSubEffect({effects:[{textArea:[.768,.809],text:"Instead: 1 <fear>.",[yn.Now]:async()=>{await t.fear(1)}},{textArea:[.768,.809],text:"3 Damage.",[yn.Now]:async()=>{await t.damage(3)}},{textArea:[.801,.938],text:"Spirits may jointly spend 3 Energy per player (aided by Removing <disease> from the island for 3 Energy each) to remove the top card of the Fear Deck from the game. Add 1 <disease>.",[yn.Now]:async()=>{e.playersCanJointlyPayEnergyAidedBy({energy:3*e.spiritCount,aidedByRemovingDisease:!0})&&await e.may({prompt:"Pay jointly 3 Energy per player (aided by Removing <disease> from the island for 3 Energy each) to remove the top card of the Fear Deck from the game?"})&&(await e.payEnergyJointlyAidedBy({energy:3*e.spiritCount,aidedByRemovingDisease:!0}),await e.removeTopFearCard())}},{textArea:[.899,.94],text:"Add 1 <disease>.",[yn.Now]:async()=>{await t.add(1,e.Disease)}}]}):await e.addSubEffect({effects:[{textArea:[.764,.805],text:"1 <fear>",[yn.Now]:async()=>{await t.fear(1)}},{textArea:[.601,.674],text:"Add 4 <disease> among Coastal lands (on any boards) other than target land.",[yn.Now]:async()=>{await e.inCoastalLands().where((e=>e!==t)).pickMultiple({amount:4,forPickedItem:async a=>{await a.add(1,e.Disease)},repeatSame:!0})}}]})}}]},Fi={name:"Ravaged Undergrowth Slithers Back To Life",type:Sn.Major,speed:rr.Slow,energy:3,elements:[nr.Water,nr.Plant,nr.Animal],set:a.NatureIncarnate,target:ir.Land,sourceFilter:[sr.SacredSite],targetFilter:[sr.Blight],range:1,hasPushOrGather:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.607,.648],text:"Replace 1 <blight> with 1 <wilds>.",[yn.InTargetLand]:async({$:e,land:a,action:t})=>{t.data.replacement=await a.replaceOne({pieces:e.Blight,withAmount:1,withPiece:Bn.Wilds})}},{textArea:[.652,.693],text:"1 <fear>",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.652,.693],text:"3 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(3)}},{textArea:[.699,.74],text:"Push that <wilds>.",[yn.InTargetLand]:async({action:e,land:a})=>{const t=e.data.replacement.added;t.length>0&&t[0].location===a&&await t[0].piece.push()}},{textArea:[.747,.941],text:"If you have 3 <water> 2 <plant>:<br><br>Add 1 <wilds>. You may Push it. In each land with <wilds> within <range-1> (of target land):<br>Push 1 <explorer> and 1 <town> to lands without <wilds>.",[yn.InTargetLand]:async({land:e,you:a,$:t})=>{if(await a.askToConvertElements({[nr.Water]:3,[nr.Plant]:2})){const n=await e.add(1,t.Wilds);n.length>0&&n[0].location===e&&await t.addSubEffect({textArea:[.831,.872],text:"You may Push it.",[yn.Now]:async()=>{await n[0].piece.push({quantifier:lr.May})}}),await e.inLandsWithin(1,a).where((e=>e.has(t.Wilds))).selectOrder().forEach((async e=>{await t.addSubEffect({textArea:[.899,.94],text:"Push 1 <explorer> and 1 <town> to lands without <wilds>.",[yn.Now]:async()=>{await e.push({pieces:t.Explorer,destinationFilter:e=>e.doesntHave(t.Wilds)}),await e.push({pieces:t.Town,destinationFilter:e=>e.doesntHave(t.Wilds)})}})}),{textArea:[.834,.941],text:"In each land with <wilds> within <range-1> (of target land):<br>Push 1 <explorer> and 1 <town> to lands without <wilds>."})}}}]},Ri={name:"Rumbling Earthquakes",type:Sn.Major,speed:rr.Slow,energy:6,elements:[nr.Fire,nr.Earth],set:a.NatureIncarnate,target:ir.Land,sourceFilter:[sr.SacredSite],range:1,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.607,.648],text:"This Power ignores Health bonuses.",[yn.InTargetLand]:async({$:e})=>{await e.addEffectUntilEndOfAction({[yn.DamageIgnoreHealthBonuses]:()=>!0})}},{textArea:[.651,.692],text:"3 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(3)}},{textArea:[.651,.692],text:"6 Damage, to <town>/<city> only.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.damage(6,e.TownOrCity)}},{textArea:[.688,.768],text:"6 Damage among adjacent lands, to <town>/<city> only.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.damageInAdjacentLands(6,e.TownOrCity)}},{textArea:[.779,.941],text:"If you have 4 <earth>:<br>6 Damage among target/adjacent lands, to <town>/<city> only.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[nr.Earth]:4})&&await t.damageInThisAndAdjacentLands(6,e.TownOrCity)}}]},Ni={name:"Solidify Echoes Of Majesty Past",type:Sn.Major,speed:rr.Fast,energy:4,elements:[nr.Sun,nr.Moon,nr.Air,nr.Earth],set:a.NatureIncarnate,target:ir.Spirit,effects:[{textArea:[.581,.758],text:"Choose one of target Spirit's lands. In that land and each adjacent land, Defend 3. They Add 1 <broken> to each adjacent land. Skip up to 1 Invader Action at each added <broken>.",[yn.TargetSpirit]:async({spirit:e})=>{await e.inLands().pickOne((async a=>{await a.inThisAndAdjacentLands().forEach((async e=>{await e.defend(3)})),await a.inAdjacentLands().selectOrder(e.destroyedPresence>0).forEach((async t=>{if(t!==a&&e.destroyedPresence>0){(await t.addPresence(e,{destroyed:!0})).length>0&&await t.skipInvaderAction({textArea:[.685,.757],text:"Skip up to 1 Invader Action at each added <broken>."})}}),{highlightLocations:[a]})}))}},{textArea:[.756,.947],text:"If you have 2 <sun>, 2 <moon>, 2 <earth>:<br><br>Target Spirit either Reclaims 1 Power Card or re-gains a Unique Power they previously forgot. They may play it by paying its cost.",[yn.TargetSpirit]:async({you:e,spirit:a,$:t})=>{await e.askToConvertElements({[nr.Sun]:2,[nr.Moon]:2,[nr.Earth]:2})&&await t.chooseBetween({players:[a],effects:[{actionId:"Reclaim",textArea:[.834,.875],text:"Reclaim 1 Power Card.",[yn.Now]:async()=>{const e=await a.reclaim(1);e.length>0&&e[0].isPlayable&&await t.may({textArea:[.907,.948],text:"They may play it by paying its cost.",prompt:`Play ${e[0].powerLink} by paying its cost?`})&&await e[0].play({withoutUsingCardPlays:!0})},condition:()=>a.hasReclaimableCards},{actionId:"Regain",textArea:[.871,.944],text:"Regain a Unique Power you previously forgot.",condition:()=>a.availableRememberedUniques.length>0,[yn.Now]:async()=>{const e=await a.gainPowerCard({fromSelection:a.availableRememberedUniques,taken:!0});e.chosen.length>0&&e.chosen[0].isPlayable&&await t.may({textArea:[.907,.948],text:"They may play it by paying its cost.",prompt:`Play ${e.chosen[0].powerLink} by paying its cost?`})&&await e.chosen[0].play({withoutUsingCardPlays:!0})}}]})}}]},$i={name:"Transformative Sacrifice",type:Sn.Major,speed:rr.Fast,energy:3,elements:[nr.Moon,nr.Fire,nr.Water,nr.Plant],set:a.NatureIncarnate,target:ir.Spirit,effects:[{textArea:[.749,.938],text:"If you have 2 <moon> 3 <fire> 2 <plant>:<br>Before taking cards, they may also Remove 1 <presence> from their <presence> track to Take a Minor Power and play it.",[yn.TargetSpirit]:async({you:e,spirit:a})=>{if(a.unlockedTrackPresence.length>0&&await e.askToConvertElements({[nr.Moon]:2,[nr.Fire]:3,[nr.Plant]:2})){await a.addPresence({locations:Jn.Remove,forcedFromTrack:!0});const e=await a.gainPowerCard({powerType:Sn.Minor,drawAmount:1,taken:!0});e.chosen.length>0&&await e.chosen[0].play({withoutPaying:!0,withoutUsingCardPlays:!0})}}},{textArea:[.604,.752],text:"Target Spirit may Remove up to 3 <presence> (from anywhere on the island). Then for each Removed <presence>, they Take a Minor Power and  play it (for free).",[yn.TargetSpirit]:async({spirit:e,action:a})=>{const t=await e.destroyPresence(3,Nn.Remove,!0),n=a.data.extraGainAndPlay??0;await _r(t.length+n,(async()=>{const a=await e.gainPowerCard({powerType:Sn.Minor,drawAmount:1,taken:!0});a.chosen.length>0&&await a.chosen[0].play({withoutPaying:!0,withoutUsingCardPlays:!0})}))}}]};var Wi,Mi;!function(e){e.AdvanceCards="AdvanceCards",e.BlightedIsland="BlightedIsland",e.Build="Build",e.Event="Event",e.Explore="Explore",e.FastPowers="FastPowers",e.Fear="Fear",e.GainEnergy="GainEnergy",e.Grow="Grow",e.HighImmigration="HighImmigration",e.InitialExplore="InitialExplore",e.PlayPowers="PlayPowers",e.Ravage="Ravage",e.RoyalBacking="RoyalBacking",e.Setup="Setup",e.SetupPresence="SetupPresence",e.SlowPowers="SlowPowers",e.TimePasses="TimePasses"}(Wi||(Wi={})),function(e){e.ACircuitousAndWendingJourney="ACircuitousAndWendingJourney",e.ADreadfulTideOfScurryingFlesh="ADreadfulTideOfScurryingFlesh",e.AYearOfPerfectStillness="AYearOfPerfectStillness",e.AbsoluteStasis="AbsoluteStasis",e.AbsorbCorruption="AbsorbCorruption",e.AbsorbEssence="AbsorbEssence",e.AcceleratedRot="AcceleratedRot",e.AfflictWithBloodthirst="AfflictWithBloodthirst",e.AidFromTheSpiritspeakers="AidFromTheSpiritspeakers",e.AirMovesEarthEndures="AirMovesEarthEndures",e.AllEnvelopingGreen="AllEnvelopingGreen",e.AngryBears="AngryBears",e.AnimatedWrackroot="AnimatedWrackroot",e.AsphyxiatingSmoke="AsphyxiatingSmoke",e.BargainOfCoursingPaths="BargainOfCoursingPaths",e.BargainsOfPowerAndProtection="BargainsOfPowerAndProtection",e.BatsScoutForRaidsByDarkness="BatsScoutForRaidsByDarkness",e.BelligerentAndAggressiveCrops="BelligerentAndAggressiveCrops",e.BesetAndConfoundTheInvaders="BesetAndConfoundTheInvaders",e.BirdsCryWarning="BirdsCryWarning",e.BlazingIntimidation="BlazingIntimidation",e.BlazingRenewal="BlazingRenewal",e.BlindingGlare="BlindingGlare",e.BloodDrawsPredators="BloodDrawsPredators",e.BloodWaterAndBloodlust="BloodWaterAndBloodlust",e.BloodwrackPlague="BloodwrackPlague",e.BloomingOfTheRocksAndTrees="BloomingOfTheRocksAndTrees",e.BlurTheArcOfYears="BlurTheArcOfYears",e.BombardWithBouldersAndStingingSeeds="BombardWithBouldersAndStingingSeeds",e.BoonOfAncientMemories="BoonOfAncientMemories",e.BoonOfCorruptedBlood="BoonOfCorruptedBlood",e.BoonOfGrowingPower="BoonOfGrowingPower",e.BoonOfReimagining="BoonOfReimagining",e.BoonOfResilientPower="BoonOfResilientPower",e.BoonOfSunshinesPromise="BoonOfSunshinesPromise",e.BoonOfSwarmingBedevilment="BoonOfSwarmingBedevilment",e.BoonOfVigor="BoonOfVigor",e.BoonOfWatchfulGuarding="BoonOfWatchfulGuarding",e.CallOfTheDahanWays="CallOfTheDahanWays",e.CallOfTheDeeps="CallOfTheDeeps",e.CallOnHerdersForAid="CallOnHerdersForAid",e.CallOnMidnightsDream="CallOnMidnightsDream",e.CallToAFastnessOfRenewal="CallToAFastnessOfRenewal",e.CallToASunlitHaven="CallToASunlitHaven",e.CallToBloodshed="CallToBloodshed",e.CallToFerocity="CallToFerocity",e.CallToGuard="CallToGuard",e.CallToIsolation="CallToIsolation",e.CallToMigrate="CallToMigrate",e.CallToTend="CallToTend",e.CallToTrade="CallToTrade",e.CallToVigilance="CallToVigilance",e.CarapacedLand="CarapacedLand",e.CastDownIntoTheBrinyDeep="CastDownIntoTheBrinyDeep",e.CleansingFloods="CleansingFloods",e.CloseTheWays="CloseTheWays",e.ConcealingShadows="ConcealingShadows",e.ConfoundingMists="ConfoundingMists",e.ConsiderAHarmoniousNature="ConsiderAHarmoniousNature",e.CoordinatedRaid="CoordinatedRaid",e.CreepersTearIntoMortar="CreepersTearIntoMortar",e.CropsWitherAndFade="CropsWitherAndFade",e.CyclesOfTimeAndTide="CyclesOfTimeAndTide",e.DarkAndTangledWoods="DarkAndTangledWoods",e.DarkSkiesLooseAStingingRain="DarkSkiesLooseAStingingRain",e.DarknessSwallowsTheUnwary="DarknessSwallowsTheUnwary",e.DeathApproachesFromBeneathTheSurface="DeathApproachesFromBeneathTheSurface",e.DeathFallsGentlyFromOpenBlossoms="DeathFallsGentlyFromOpenBlossoms",e.DelusionsOfDanger="DelusionsOfDanger",e.DesiccatingWinds="DesiccatingWinds",e.DevouringAnts="DevouringAnts",e.DireMetamorphosis="DireMetamorphosis",e.DisorientingLandscape="DisorientingLandscape",e.DissolveTheBondsOfKinship="DissolveTheBondsOfKinship",e.DissolvingVapors="DissolvingVapors",e.DomesticatedAnimalsGoBerserk="DomesticatedAnimalsGoBerserk",e.DrawOfTheFruitfulEarth="DrawOfTheFruitfulEarth",e.DrawToTheWatersEdge="DrawToTheWatersEdge",e.DrawTowardsAConsumingVoid="DrawTowardsAConsumingVoid",e.DreadApparitions="DreadApparitions",e.DreamOfTheUntouchedLand="DreamOfTheUntouchedLand",e.DreamsOfTheDahan="DreamsOfTheDahan",e.DriftDownIntoSlumber="DriftDownIntoSlumber",e.Drought="Drought",e.DryWoodExplodesInSmolderingSplinters="DryWoodExplodesInSmolderingSplinters",e.EarthMovesWithVigorAndMight="EarthMovesWithVigorAndMight",e.EarthShuddersBuildingsFall="EarthShuddersBuildingsFall",e.EerieNoisesAndMovingTrees="EerieNoisesAndMovingTrees",e.ElementalAegis="ElementalAegis",e.ElementalBoon="ElementalBoon",e.ElementalTeachings="ElementalTeachings",e.ElusiveAmbushes="ElusiveAmbushes",e.EmergeFromTheDreadNightWind="EmergeFromTheDreadNightWind",e.EncircleTheUnsuspectingPrey="EncircleTheUnsuspectingPrey",e.EncompassingWard="EncompassingWard",e.EnticingAndLullingDreams="EnticingAndLullingDreams",e.EnticingSplendor="EnticingSplendor",e.EntrancingApparitions="EntrancingApparitions",e.EntrapTheForcesOfCorruption="EntrapTheForcesOfCorruption",e.EntwineTheFatesOfAll="EntwineTheFatesOfAll",e.EntwinedPower="EntwinedPower",e.EpidemicsRunRampant="EpidemicsRunRampant",e.EvermultiplyingSwarm="EvermultiplyingSwarm",e.ExaltationOfEchoedSteps="ExaltationOfEchoedSteps",e.ExaltationOfGraspingRoots="ExaltationOfGraspingRoots",e.ExaltationOfMoltenStone="ExaltationOfMoltenStone",e.ExaltationOfTangledGrowth="ExaltationOfTangledGrowth",e.ExaltationOfTheIncandescentSky="ExaltationOfTheIncandescentSky",e.ExaltationOfTheStormWind="ExaltationOfTheStormWind",e.ExaltationOfTheTransformingFlame="ExaltationOfTheTransformingFlame",e.ExhaleConfusionAndDelirium="ExhaleConfusionAndDelirium",e.ExplosiveEruption="ExplosiveEruption",e.FavorOfTheSunAndStarlitDark="FavorOfTheSunAndStarlitDark",e.FavorsCalledDue="FavorsCalledDue",e.FavorsOfStoryAndSeason="FavorsOfStoryAndSeason",e.FerociousRampage="FerociousRampage",e.FetidBreathSpreadsInfection="FetidBreathSpreadsInfection",e.FieldsChokedWithGrowth="FieldsChokedWithGrowth",e.FieryVengeance="FieryVengeance",e.FireAndFlood="FireAndFlood",e.FireBurnsWaterSoothes="FireBurnsWaterSoothes",e.FireInTheSky="FireInTheSky",e.Firestorm="Firestorm",e.FlamesFury="FlamesFury",e.FlashFloods="FlashFloods",e.Flashfires="Flashfires",e.FleshrotFever="FleshrotFever",e.FlockingRedTalons="FlockingRedTalons",e.FlowDownriverBlowDownwind="FlowDownriverBlowDownwind",e.FlowLikeWaterReachLikeAir="FlowLikeWaterReachLikeAir",e.FlowingAndSilentFormsDartBy="FlowingAndSilentFormsDartBy",e.FocusTheLandsAnguish="FocusTheLandsAnguish",e.FocusTheSunsRays="FocusTheSunsRays",e.ForestsOfLivingObsidian="ForestsOfLivingObsidian",e.ForsakeSocietyToChaseAfterDreams="ForsakeSocietyToChaseAfterDreams",e.FoulVaporsAndFetidMuck="FoulVaporsAndFetidMuck",e.FoundationsSinkIntoMud="FoundationsSinkIntoMud",e.FragmentsOfYesteryear="FragmentsOfYesteryear",e.FrenziedAssault="FrenziedAssault",e.FrightfulKeening="FrightfulKeening",e.GatherTheScatteredLightOfStars="GatherTheScatteredLightOfStars",e.GatherTheWarriors="GatherTheWarriors",e.GiftOfAbundance="GiftOfAbundance",e.GiftOfConstancy="GiftOfConstancy",e.GiftOfFlowingPower="GiftOfFlowingPower",e.GiftOfFuriousMight="GiftOfFuriousMight",e.GiftOfLivingEnergy="GiftOfLivingEnergy",e.GiftOfNaturesConnection="GiftOfNaturesConnection",e.GiftOfPower="GiftOfPower",e.GiftOfProliferation="GiftOfProliferation",e.GiftOfSearingHeat="GiftOfSearingHeat",e.GiftOfSeismicEnergy="GiftOfSeismicEnergy",e.GiftOfStrength="GiftOfStrength",e.GiftOfThePrimordialDeeps="GiftOfThePrimordialDeeps",e.GiftOfTheSparkingSky="GiftOfTheSparkingSky",e.GiftOfTheSunlitAir="GiftOfTheSunlitAir",e.GiftOfTheUntamedWild="GiftOfTheUntamedWild",e.GiftOfTwinnedDays="GiftOfTwinnedDays",e.GiftOfWindspedSteps="GiftOfWindspedSteps",e.GnawingRootbiters="GnawingRootbiters",e.GoldsAllure="GoldsAllure",e.GrantHatredARavenousForm="GrantHatredARavenousForm",e.GraspingTide="GraspingTide",e.GrowthThroughSacrifice="GrowthThroughSacrifice",e.GuardTheHealingLand="GuardTheHealingLand",e.GuardianSerpents="GuardianSerpents",e.GuideTheWayOnFeatheredWings="GuideTheWayOnFeatheredWings",e.HarbingersOfTheLightning="HarbingersOfTheLightning",e.HauntedByPrimalMemories="HauntedByPrimalMemories",e.HazardsSpreadAcrossTheIsland="HazardsSpreadAcrossTheIsland",e.HerdTowardsTheLurkingMaw="HerdTowardsTheLurkingMaw",e.HereThereBeMonsters="HereThereBeMonsters",e.HoldTheIslandFastWithABulwarkOfWill="HoldTheIslandFastWithABulwarkOfWill",e.ImbueWithNourishingVitality="ImbueWithNourishingVitality",e.ImpenetrableTanglesOfGreenery="ImpenetrableTanglesOfGreenery",e.ImpersonateAuthority="ImpersonateAuthority",e.InciteTheMob="InciteTheMob",e.IndomitableClaim="IndomitableClaim",e.InfestationOfVenomousSpiders="InfestationOfVenomousSpiders",e.InfestedAquifers="InfestedAquifers",e.InfiniteVitality="InfiniteVitality",e.InflameTheFiresOfLife="InflameTheFiresOfLife",e.InsatiableHungerOfTheSwarm="InsatiableHungerOfTheSwarm",e.InscrutableJourneying="InscrutableJourneying",e.InspireAWindingDance="InspireAWindingDance",e.InspireTheReleaseOfStolenLands="InspireTheReleaseOfStolenLands",e.InstrumentsOfTheirOwnRuin="InstrumentsOfTheirOwnRuin",e.IntractableThicketsAndThorns="IntractableThicketsAndThorns",e.IrresistibleCall="IrresistibleCall",e.JaggedShardsPushFromTheEarth="JaggedShardsPushFromTheEarth",e.KeepWatchForNewIncursions="KeepWatchForNewIncursions",e.LandCreaksWithTension="LandCreaksWithTension",e.LandOfHauntsAndEmbers="LandOfHauntsAndEmbers",e.LavaFlows="LavaFlows",e.LayPathsTheyCannotHelpButWalk="LayPathsTheyCannotHelpButWalk",e.LeadTheFuriousAssault="LeadTheFuriousAssault",e.LeadTheWarriorsToBattle="LeadTheWarriorsToBattle",e.LearnTheInvadersTactics="LearnTheInvadersTactics",e.LeaveATrailOfDeathlySilence="LeaveATrailOfDeathlySilence",e.LetThemBreakThemselvesAgainstTheStone="LetThemBreakThemselvesAgainstTheStone",e.LetsSeeWhatHappens="LetsSeeWhatHappens",e.LightningTornSkiesIncitePandemonium="LightningTornSkiesIncitePandemonium",e.LightningsBoon="LightningsBoon",e.LikeCallsToLike="LikeCallsToLike",e.LostInTheEndlessDark="LostInTheEndlessDark",e.LostInTheSwirlingHaze="LostInTheSwirlingHaze",e.LureOfTheUnknown="LureOfTheUnknown",e.ManifestIncarnation="ManifestIncarnation",e.ManifestationOfPowerAndGlory="ManifestationOfPowerAndGlory",e.MantleOfDread="MantleOfDread",e.MarkTerritoryWithScarsAndTeeth="MarkTerritoryWithScarsAndTeeth",e.MassiveFlooding="MassiveFlooding",e.MeltEarthIntoQuicksand="MeltEarthIntoQuicksand",e.MesmerizedTranquility="MesmerizedTranquility",e.MindShatteringSong="MindShatteringSong",e.MischiefAndSabotage="MischiefAndSabotage",e.MistsOfOblivion="MistsOfOblivion",e.MysteriousAbductions="MysteriousAbductions",e.NaturesResilience="NaturesResilience",e.NeverHeardFromAgain="NeverHeardFromAgain",e.NightTerrors="NightTerrors",e.ObserveTheEverChangingWorld="ObserveTheEverChangingWorld",e.OceanBreaksTheShore="OceanBreaksTheShore",e.OfferPassageBetweenWorlds="OfferPassageBetweenWorlds",e.OpenShiftingWaterways="OpenShiftingWaterways",e.OverenthusiasticArson="OverenthusiasticArson",e.OvergrowInANight="OvergrowInANight",e.PactOfTheJoinedHunt="PactOfTheJoinedHunt",e.ParalyzingFright="ParalyzingFright",e.PathsTiedByNature="PathsTiedByNature",e.PeaceOfTheNighttimeSky="PeaceOfTheNighttimeSky",e.PentupCalamity="PentupCalamity",e.PerilsOfTheDeepestIsland="PerilsOfTheDeepestIsland",e.PillarOfLivingFlame="PillarOfLivingFlame",e.PlagueShipsSailToDistantPorts="PlagueShipsSailToDistantPorts",e.Plaguebearers="Plaguebearers",e.PlowsShatterOnRockyGround="PlowsShatterOnRockyGround",e.PoisonedDew="PoisonedDew",e.PoisonedLand="PoisonedLand",e.PortentsOfDisaster="PortentsOfDisaster",e.PoundShipsToSplinters="PoundShipsToSplinters",e.PourTimeSideways="PourTimeSideways",e.PoweredByTheFurnaceOfTheEarth="PoweredByTheFurnaceOfTheEarth",e.Powerstorm="Powerstorm",e.PredatoryNightmares="PredatoryNightmares",e.PreyOnTheBuilders="PreyOnTheBuilders",e.PromisesOfProtection="PromisesOfProtection",e.ProwlingPanthers="ProwlingPanthers",e.PullBeneathTheHungryEarth="PullBeneathTheHungryEarth",e.PunishThoseWhoTrespass="PunishThoseWhoTrespass",e.PurifyingFlame="PurifyingFlame",e.PursueWithScratchesPecksAndStings="PursueWithScratchesPecksAndStings",e.PyroclasticBombardment="PyroclasticBombardment",e.PyroclasticFlow="PyroclasticFlow",e.QuickenTheEarthsStruggles="QuickenTheEarthsStruggles",e.RadiantAndHallowedGrove="RadiantAndHallowedGrove",e.RadiatingTremors="RadiatingTremors",e.RagingStorm="RagingStorm",e.RainAndMudSuppressConflict="RainAndMudSuppressConflict",e.RainOfAsh="RainOfAsh",e.RainOfBlood="RainOfBlood",e.RangingHunt="RangingHunt",e.RavagedUndergrowthSlithersBackToLife="RavagedUndergrowthSlithersBackToLife",e.RazorsharpUndergrowth="RazorsharpUndergrowth",e.ReachFromTheInfiniteDarkness="ReachFromTheInfiniteDarkness",e.ReachingGrasp="ReachingGrasp",e.ReclaimedByTheDeeps="ReclaimedByTheDeeps",e.RegrowFromRoots="RegrowFromRoots",e.RenewingBoon="RenewingBoon",e.RenewingRain="RenewingRain",e.ResoundingFootfallsSowDismay="ResoundingFootfallsSowDismay",e.RevokeSanctuaryAndCastOut="RevokeSanctuaryAndCastOut",e.RitesOfTheLandsRejection="RitesOfTheLandsRejection",e.RitualsOfDestruction="RitualsOfDestruction",e.RiversBounty="RiversBounty",e.RoilingBogAndSnaggingThorn="RoilingBogAndSnaggingThorn",e.RouseTheTreesAndStones="RouseTheTreesAndStones",e.RumblingEarthquakes="RumblingEarthquakes",e.RumblingsPortendAGreaterQuake="RumblingsPortendAGreaterQuake",e.SacrosanctWilderness="SacrosanctWilderness",e.SanguinaryTaint="SanguinaryTaint",e.SapTheStrengthOfMultitudes="SapTheStrengthOfMultitudes",e.SavageMawbeasts="SavageMawbeasts",e.SavageRevenge="SavageRevenge",e.SavageTransformation="SavageTransformation",e.ScarredAndStonyLand="ScarredAndStonyLand",e.ScatterToTheWinds="ScatterToTheWinds",e.ScorchWithWavesOfHeat="ScorchWithWavesOfHeat",e.ScorchingConvergence="ScorchingConvergence",e.ScourTheLand="ScourTheLand",e.ScreamDiseaseIntoTheWind="ScreamDiseaseIntoTheWind",e.SeaMonsters="SeaMonsters",e.SearAngerIntoTheWildLands="SearAngerIntoTheWildLands",e.SerpentRousesInAnger="SerpentRousesInAnger",e.SerpentWakesInPower="SerpentWakesInPower",e.SetThemOnAnEvertwistingTrail="SetThemOnAnEvertwistingTrail",e.SettleIntoHuntinggrounds="SettleIntoHuntinggrounds",e.ShadowsOfTheBurningForest="ShadowsOfTheBurningForest",e.ShapeTheSelfAnew="ShapeTheSelfAnew",e.ShareMentorshipAndExpertise="ShareMentorshipAndExpertise",e.ShareSecretsOfSurvival="ShareSecretsOfSurvival",e.ShatterHomesteads="ShatterHomesteads",e.ShelterUnderToweringBranches="ShelterUnderToweringBranches",e.SiderealGuidance="SiderealGuidance",e.SkiesHeraldTheSeasonOfReturn="SkiesHeraldTheSeasonOfReturn",e.SkyStretchesToShore="SkyStretchesToShore",e.SleepAndNeverWaken="SleepAndNeverWaken",e.SlipTheFlowOfTime="SlipTheFlowOfTime",e.SmashStompAndFlatten="SmashStompAndFlatten",e.SmiteTheLandWithFulmination="SmiteTheLandWithFulmination",e.SmotheringInfestation="SmotheringInfestation",e.SocietyDissolvesAtTheBeckoningHeart="SocietyDissolvesAtTheBeckoningHeart",e.SoftlyBeckonEverInward="SoftlyBeckonEverInward",e.SolidifyEchoesOfMajestyPast="SolidifyEchoesOfMajestyPast",e.SongOfSanctity="SongOfSanctity",e.SpillBitternessIntoTheEarth="SpillBitternessIntoTheEarth",e.SpiritsMayYetDream="SpiritsMayYetDream",e.SpreadingAndDreadfulMire="SpreadingAndDreadfulMire",e.SpreadingWilds="SpreadingWilds",e.SpurOnWithWordsOfFire="SpurOnWithWordsOfFire",e.StarsBlazeInTheDaytimeSky="StarsBlazeInTheDaytimeSky",e.SteamVents="SteamVents",e.StemTheFlowOfFreshWater="StemTheFlowOfFreshWater",e.StingingSandstorm="StingingSandstorm",e.Stormswath="Stormswath",e.StranglingFirevine="StranglingFirevine",e.StrengthOfTheWakingIsland="StrengthOfTheWakingIsland",e.StretchOutCoilsOfForebodingDread="StretchOutCoilsOfForebodingDread",e.StrikeLowWithSuddenFevers="StrikeLowWithSuddenFevers",e.StrongAndConstantCurrents="StrongAndConstantCurrents",e.StubbornSolidity="StubbornSolidity",e.StudyTheInvadersFears="StudyTheInvadersFears",e.SuckingOoze="SuckingOoze",e.SuddenAmbush="SuddenAmbush",e.SuffocatingShroud="SuffocatingShroud",e.SunsetsFireFlowsAcrossTheLand="SunsetsFireFlowsAcrossTheLand",e.SurgingLahar="SurgingLahar",e.SurroundedByTheDahan="SurroundedByTheDahan",e.SwallowTheLanddwellers="SwallowTheLanddwellers",e.SwallowedByTheEndlessDark="SwallowedByTheEndlessDark",e.SwallowedByTheWilderness="SwallowedByTheWilderness",e.SwarmingWasps="SwarmingWasps",e.SweepIntoTheSea="SweepIntoTheSea",e.SwelteringExhaustion="SwelteringExhaustion",e.SwirlAndSpill="SwirlAndSpill",e.TalonsOfLightning="TalonsOfLightning",e.TeemingRivers="TeemingRivers",e.TeethGleamFromDarkness="TeethGleamFromDarkness",e.TempestOfLeavesAndBranches="TempestOfLeavesAndBranches",e.TerrifyingChase="TerrifyingChase",e.TerrifyingNightmares="TerrifyingNightmares",e.TerrifyingRampage="TerrifyingRampage",e.TerritorialStrife="TerritorialStrife",e.TerrorOfTheHunted="TerrorOfTheHunted",e.TerrorTurnsToMadness="TerrorTurnsToMadness",e.TheBurnedLandRegrows="TheBurnedLandRegrows",e.TheFogClosesIn="TheFogClosesIn",e.TheJungleHungers="TheJungleHungers",e.TheLandThrashesInFuriousPain="TheLandThrashesInFuriousPain",e.ThePastReturnsAgain="ThePastReturnsAgain",e.TheShoreSeethesWithHatred="TheShoreSeethesWithHatred",e.TheTeemingHostArrives="TheTeemingHostArrives",e.TheTreesAndStonesSpeakOfWar="TheTreesAndStonesSpeakOfWar",e.TheWoundedWildTurnsOnItsAssailants="TheWoundedWildTurnsOnItsAssailants",e.ThicketsEruptWithEveryTouchOfBreeze="ThicketsEruptWithEveryTouchOfBreeze",e.ThreateningFlames="ThreateningFlames",e.ThrivingChokefungus="ThrivingChokefungus",e.ThunderingDestruction="ThunderingDestruction",e.TidalBoon="TidalBoon",e.TigersHunting="TigersHunting",e.TooNearTheJungle="TooNearTheJungle",e.TormentingRotflies="TormentingRotflies",e.ToweringWrath="ToweringWrath",e.TransformToAMurderousDarkness="TransformToAMurderousDarkness",e.TransformativeSacrifice="TransformativeSacrifice",e.TravelersBoon="TravelersBoon",e.TreacherousWaterways="TreacherousWaterways",e.TreesRadiateCelestialBrilliance="TreesRadiateCelestialBrilliance",e.Tsunami="Tsunami",e.TurmoilsTouch="TurmoilsTouch",e.TwilightFogBringsMadness="TwilightFogBringsMadness",e.TwistPerceptions="TwistPerceptions",e.TwistedFlowersMurmurUltimatums="TwistedFlowersMurmurUltimatums",e.UnbearableDeluge="UnbearableDeluge",e.UnbearableGaze="UnbearableGaze",e.UnbelievableRegrowth="UnbelievableRegrowth",e.UncannyMelting="UncannyMelting",e.UnearthABeastOfWrathfulStone="UnearthABeastOfWrathfulStone",e.UnexpectedTigers="UnexpectedTigers",e.UnleashATorrentOfTheSelfsOwnEssence="UnleashATorrentOfTheSelfsOwnEssence",e.UnlockTheGatesOfDeepestPower="UnlockTheGatesOfDeepestPower",e.UnnervingPall="UnnervingPall",e.UnquenchableFlames="UnquenchableFlames",e.UnrelentingGrowth="UnrelentingGrowth",e.UtterACurseOfDreadAndBone="UtterACurseOfDreadAndBone",e.VanishSoftlyAwayForgottenByAll="VanishSoftlyAwayForgottenByAll",e.VeilTheNightsHunt="VeilTheNightsHunt",e.VengeanceOfTheDead="VengeanceOfTheDead",e.VigorOfTheBreakingDawn="VigorOfTheBreakingDawn",e.ViolentWindstorms="ViolentWindstorms",e.VisionsOfAShiftingFuture="VisionsOfAShiftingFuture",e.VisionsOfFieryDoom="VisionsOfFieryDoom",e.VoiceOfCommand="VoiceOfCommand",e.VoiceOfThunder="VoiceOfThunder",e.VolcanicEruption="VolcanicEruption",e.VoraciousGrowth="VoraciousGrowth",e.WallsOfRockAndThorn="WallsOfRockAndThorn",e.WardTheShores="WardTheShores",e.WarnOfImpendingConflict="WarnOfImpendingConflict",e.WashAway="WashAway",e.WaterEatsAwayTheDeepRootsOfEarth="WaterEatsAwayTheDeepRootsOfEarth",e.WaterNourishesLifesGrowth="WaterNourishesLifesGrowth",e.WaysOfShoreAndHeartland="WaysOfShoreAndHeartland",e.WeaveTogetherTheFabricOfPlace="WeaveTogetherTheFabricOfPlace",e.WeepForWhatIsLost="WeepForWhatIsLost",e.WhisperedGuidanceThroughTheNight="WhisperedGuidanceThroughTheNight",e.WhyDontYouAndThemFight="WhyDontYouAndThemFight",e.WindsOfRustAndAtrophy="WindsOfRustAndAtrophy",e.WitherBodiesScarStones="WitherBodiesScarStones",e.WoodSeeksGrowthHumansSeekFreedom="WoodSeeksGrowthHumansSeekFreedom",e.WordsOfWarning="WordsOfWarning",e.WrackWithPainAndGrief="WrackWithPainAndGrief",e.WrapInWingsOfSunlight="WrapInWingsOfSunlight"}(Mi||(Mi={}));const Gi="After the next Invader Phase (on any turn) with no Ravage/Build Actions in target land: 3 <fear>. 12 Damage. Add 1 <beasts>. You may Push that <beasts>. 1 <fear> and 2 Damage in its land.",Hi=`${Gi}<br><br>If you have 2 <moon> 3 <earth> 3 <animal>:<br>Mark it (<marked-beast>), <marked-beast> can't leave the island. Each <slow> phase: You may Push <marked-beast>. 1 <fear> and 2 Damage at <marked-beast>.`,ji={name:"Unearth A Beast Of Wrathful Stone",type:Sn.Major,speed:rr.Fast,energy:5,elements:[nr.Moon,nr.Fire,nr.Earth,nr.Animal],set:a.NatureIncarnate,target:ir.Land,sourceFilter:[sr.SacredSite],targetFilter:[sr.Invaders],range:1,hasPushOrGather:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.579,.943],text:Hi,[yn.InTargetLand]:async({$:e,you:a,land:t,power:n})=>{const r=e.phase===Wi.FastPowers?e.turn:e.turn+1;let i=!1;const s=await a.askToConvertElements({[nr.Moon]:2,[nr.Earth]:3,[nr.Animal]:3}),o=s?Hi:Gi;await e.addSubEffect({[yn.Reminder]:e=>e===t?o:void 0,[yn.AfterRavaging]:e=>(e.land===t&&(i=!0),Promise.resolve()),[yn.AfterSuccessfulBuild]:e=>(e.land===t&&(i=!0),Promise.resolve()),[yn.AfterFastPhase]:()=>(i=!1,Promise.resolve()),[yn.AfterInvaderPhase]:async()=>{!i&&e.turn>=r&&await e.doPowerAction(a,(async()=>{await e.addSubEffect({effects:[{textArea:[.654,.695],text:"3 <fear>.",[yn.Now]:async()=>{await t.fear(3)}},{textArea:[.654,.695],text:"12 Damage.",[yn.Now]:async()=>{await t.damage(12)}},{textArea:[.654,.695],text:"Add 1 <beasts>.",[yn.Now]:async({action:a})=>{const n=await t.add(1,e.Beasts);n.length>0&&(a.data.beast=n[0].piece)}},{textArea:[.654,.729],text:"You may Push that <beasts>.",[yn.Now]:async({action:e})=>{const a=e.data.beast;await a.push({quantifier:lr.May})}},{textArea:[.688,.729],text:"1 <fear> and 2 Damage in its land.",[yn.Now]:async({action:e})=>{const a=e.data.beast;null!=a.location&&(await a.location.fear(1),await a.location.damage(2))}},{textArea:[.721,.946],text:"If you have 2 <moon> 3 <earth> 3 <animal>:<br>Mark it (<marked-beast>), <marked-beast> can't leave the island. Each <slow> phase: You may Push <marked-beast>. 1 <fear> and 2 Damage at <marked-beast>.",[yn.Now]:async({action:t})=>{if(await a.askToConvertElements({[nr.Moon]:2,[nr.Earth]:3,[nr.Animal]:3})){const r=t.data.beast;s&&await r.mark(),await e.addSubEffect({[yn.PreventRemovePiece]:({piece:e,removement:a})=>Promise.resolve(e===r&&a!==Nn.Relocate&&a!==Nn.Silent)}),await a.addExtraAction({actionId:`MarkBeast-${r.id}`,icon:"<marked-beast>",text:"You may Push <marked-beast>. 1 <fear> and 2 Damage at <marked-beast>.",enabled:()=>e.phase===Wi.SlowPowers,onActivate:async()=>{void 0!==r.location&&await e.doPowerAction(a,(async()=>{await e.addSubEffect({card:Mi.UnearthABeastOfWrathfulStone,effects:[{textArea:[.86,.901],text:"You may Push <marked-beast>.",[yn.Now]:async()=>{await r.push({quantifier:lr.May})}},{textArea:[.899,.94],text:"1 <fear> and 2 Damage at <marked-beast>.",[yn.Now]:async()=>{await(r.location?.fear(1)),await(r.location?.damage(2))}}]})}),n)}})}}}]}),e.removeThisEffect()}),n)}})}}]},Ui={name:"Call Of The Dahan Ways",type:Sn.Minor,speed:rr.Slow,energy:1,elements:[nr.Moon,nr.Water,nr.Animal],set:a.Base,target:ir.Land,targetFilter:[sr.Dahan],range:1,effects:[{textArea:[.657,.94],text:"Replace 1 <explorer> with 1 <dahan>.<br><br>If you have 2 <moon>:<br>You may instead replace 1 <town> with 1 <dahan>.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await t.replaceOne({pieces:await a.askToConvertElements({[nr.Moon]:2})?e.ExplorerOrTown:e.Explorer,withPiece:Bn.Dahan})}}]},qi={name:"Call to Bloodshed",type:Sn.Minor,speed:rr.Slow,energy:1,elements:[nr.Sun,nr.Fire,nr.Animal],set:a.Base,target:ir.Land,targetFilter:[sr.Dahan],range:1,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{textArea:[.696,.837],text:"1 Damage per <dahan>.<or>Gather up to 3 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"DamagePerDahan",textArea:[.703,.743],text:"1 Damage per <dahan>.",[yn.Now]:async()=>{await a.damage(a.numberOf(e.Dahan))}},{actionId:"GatherDahan",textArea:[.791,.831],text:"Gather up to 3 <dahan>.",[yn.Now]:async()=>{await a.gatherUpTo(3,e.Dahan)}}]})}}]},_i={name:"Call to Isolation",type:Sn.Minor,speed:rr.Fast,energy:0,elements:[nr.Sun,nr.Air,nr.Animal],set:a.Base,target:ir.Land,targetFilter:[sr.Dahan],range:1,hasPushOrGather:!0,effects:[{textArea:[.696,.837],text:"Push 1 <explorer>/<town> per <dahan>.<or>Push 1 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"PushExplorerOrTown",textArea:[.707,.747],text:"Push 1 <explorer>/<town> per <dahan>.",[yn.Now]:async()=>{await a.push({amount:a.numberOf(e.Dahan),pieces:e.ExplorerOrTown})}},{actionId:"PushDahan",textArea:[.792,.832],text:"Push 1 <dahan>.",[yn.Now]:async()=>{await a.push({amount:1,pieces:e.Dahan})}}]})}}]},Ji={name:"Call To Migrate",type:Sn.Minor,speed:rr.Slow,energy:1,elements:[nr.Fire,nr.Air,nr.Animal],set:a.Base,target:ir.Land,range:1,hasPushOrGather:!0,effects:[{textArea:[.705,.745],text:"Gather up to 3 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(3,e.Dahan)}},{textArea:[.75,.79],text:"Push up to 3 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(3,e.Dahan)}}]},Vi={name:"Call To Tend",type:Sn.Minor,speed:rr.Slow,energy:1,elements:[nr.Water,nr.Plant,nr.Animal],set:a.Base,target:ir.Land,targetFilter:[sr.Dahan],range:1,hasPushOrGather:!0,effects:[{textArea:[.699,.835],text:"Remove 1 <blight>.<or>Push up to 3 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"RemoveBlight",textArea:[.703,.743],text:"Remove 1 <blight>.",[yn.Now]:async()=>{await a.removeBlight()}},{actionId:"PushDahan",textArea:[.788,.828],text:"Push up to 3 <dahan>.",[yn.Now]:async()=>{await a.pushUpTo(3,e.Dahan)},condition:()=>a.isLand}]})}}]},Yi={name:"Dark And Tangled Woods",type:Sn.Minor,speed:rr.Fast,energy:1,elements:[nr.Moon,nr.Earth,nr.Plant],set:a.Base,target:ir.Land,range:1,generatesFear:!0,effects:[{textArea:[.68,.72],text:"2 <fear>",[yn.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.762,.854],text:"If target land is <mountains-jungles>, Defend 3.",[yn.InTargetLand]:async({land:e})=>{e.isMountainsOrJungles&&await e.defend(3)}}]},zi={name:"Delusions of Danger",type:Sn.Minor,speed:rr.Fast,energy:1,elements:[nr.Sun,nr.Moon,nr.Air],set:a.Base,target:ir.Land,range:1,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.705,.837],text:"Push 1 <explorer>.<or>2 <fear>.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"PushExplorer",textArea:[.705,.745],text:"Push 1 <explorer>.",[yn.Now]:async()=>{await a.pushOne(e.Explorer)}},{actionId:"Fear",textArea:[.786,.837],text:"2 <fear>.",[yn.Now]:async()=>{await a.fear(2)}}]})}}]},Qi={name:"Devouring Ants",type:Sn.Minor,speed:rr.Slow,energy:1,elements:[nr.Sun,nr.Earth,nr.Animal],set:a.Base,target:ir.Land,sourceFilter:[sr.SacredSite],range:1,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{textArea:[.636,.676],text:"1 fear.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.68,.72],text:"1 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(1)}},{textArea:[.722,.762],text:"Destroy 1 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.destroyOne(e.Dahan)}},{textArea:[.807,.894],text:"If target land is <jungles-sands>, +1 Damage.",[yn.InTargetLand]:async({land:e})=>{e.isJungleOrSands&&await e.damage(1)}}]},Ki={name:"Drift Down Into Slumber",type:Sn.Minor,speed:rr.Fast,energy:0,elements:[nr.Air,nr.Earth,nr.Plant],set:a.Base,target:ir.Land,range:2,effects:[{[yn.InTargetLand]:async({$:e,land:a})=>{a.isJungleOrSands?await e.addSubEffect({textArea:[.762,.854],text:"If target land is <jungles-sands> instead, Defend 4.",[yn.Now]:async()=>{await a.defend(4)}}):await e.addSubEffect({textArea:[.68,.72],text:"Defend 1.",[yn.Now]:async()=>{await a.defend(1)}})}}]},Xi={name:"Drought",type:Sn.Minor,speed:rr.Slow,energy:1,elements:[nr.Sun,nr.Fire,nr.Earth],set:a.Base,target:ir.Land,range:1,blightWhiteListedPower:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{textArea:[.62,.66],text:"Destroy 3 <town>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.destroy({amount:3,pieces:e.Town})}},{textArea:[.664,.704],text:"1 Damage to each <town>/<city>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.damageEach(1,e.TownOrCity)}},{textArea:[.707,.747],text:"Add 1 <blight>.",[yn.InTargetLand]:async({land:e})=>{await e.addBlight(1)}},{textArea:[.877,.93],text:"If you have 3 <sun>: Destroy 1 <city>.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[nr.Sun]:3})&&await t.destroyOne(e.City)}}]},Zi={name:"Elemental Boon",type:Sn.Minor,speed:rr.Fast,energy:1,elements:[],set:a.Base,target:ir.Spirit,effects:[{textArea:[.656,.883],text:"Target Spirit gains 3 different Elements of their choice.<br><br>If you target another Spirit, you also gain the chosen Elements.",[yn.TargetSpirit]:async({you:e,spirit:a})=>{const t=await a.gainElements({amount:3,different:!0});a!==e&&await e.gainElementsUntilEndOfTurn(t)}}]},es={name:"Encompassing Ward",type:Sn.Minor,speed:rr.Fast,energy:1,elements:[nr.Sun,nr.Water,nr.Earth],set:a.Base,target:ir.Spirit,effects:[{textArea:[.717,.809],text:"Target Spirit provides Defend 2 in each of its lands.",[yn.TargetSpirit]:async({$:e,spirit:a})=>{await e.addSubEffectUntilEndOfTurn({[yn.DefendFromSpirits]:({land:e})=>e.hasPresenceOf(a)?2:0})}}]},as={name:"Enticing Splendor",type:Sn.Minor,speed:rr.Fast,energy:0,elements:[nr.Sun,nr.Air,nr.Plant],set:a.Base,target:ir.Land,targetFilter:[sr.NonBlight],range:0,hasPushOrGather:!0,effects:[{textArea:[.699,.837],text:"Gather 1 <explorer>/<town>.<or>Gather up to 2 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"GatherExplorerOrTown",textArea:[.705,.745],text:"Gather 1 <explorer>/<town>.",[yn.Now]:async()=>{await a.gatherOne(e.ExplorerOrTown)}},{actionId:"GatherDahan",textArea:[.792,.832],text:"Gather up to 2 <dahan>.",[yn.Now]:async()=>{await a.gatherUpTo(2,e.Dahan)}}]})}}]},ts={name:"Entrancing Apparitions",type:Sn.Minor,speed:rr.Fast,energy:1,elements:[nr.Moon,nr.Air,nr.Water],set:a.Base,target:ir.Land,range:1,hasPushOrGather:!0,effects:[{textArea:[.663,.703],text:"Defend 2.",[yn.InTargetLand]:async({land:e})=>{await e.defend(2)}},{textArea:[.749,.84],text:"If no Invaders are present, Gather up to 2 <explorer>.",[yn.InTargetLand]:async({$:e,land:a})=>{a.doesntHave(e.Invader)&&await a.gatherUpTo(2,e.Explorer)}}]},ns={name:"Gift Of Constancy",type:Sn.Minor,speed:rr.Fast,energy:0,elements:[nr.Sun,nr.Earth],set:a.Base,target:ir.Spirit,effects:[{textArea:[.598,.638],text:"Target Spirit gains 2 Energy.",[yn.TargetSpirit]:async({spirit:e})=>{await e.gainEnergy(2)}},{textArea:[.641,.769],text:"At end of turn, target Spirit may Reclaim 1 Power Card instead of discarding it.",[yn.TargetSpirit]:async({power:e,spirit:a})=>{await a.mayReclaimPowerCardInsteadOfDiscarding(e)}},{textArea:[.812,.943],text:"If you target another Spirit, you may also Reclaim 1 Power Card instead of discarding it.",[yn.TargetSpirit]:async({you:e,power:a,spirit:t})=>{t!==e&&await e.mayReclaimPowerCardInsteadOfDiscarding(a)}}]},rs={name:"Gift Of Living Energy",type:Sn.Minor,speed:rr.Fast,energy:0,elements:[nr.Sun,nr.Fire,nr.Plant],set:a.Base,target:ir.Spirit,effects:[{textArea:[.631,.671],text:"Target Spirit gains 1 Energy.",[yn.TargetSpirit]:async({spirit:e})=>{await e.gainEnergy(1)}},{textArea:[.674,.761],text:"+1 Energy if target Spirit is not yourself.",[yn.TargetSpirit]:async({you:e,spirit:a})=>{a!==e&&await a.gainEnergy(1)}},{textArea:[.804,.893],text:"If you have at least 2 <sacred>, target Spirit gains +1 Energy.",[yn.TargetSpirit]:async({you:e,spirit:a})=>{e.inSacredSites().count>=2&&await a.gainEnergy(1)}}]},is={name:"Gift Of Power",type:Sn.Minor,speed:rr.Slow,energy:0,elements:[nr.Moon,nr.Water,nr.Earth,nr.Plant],set:a.Base,target:ir.Spirit,effects:[{textArea:[.713,.808],text:"Target Spirit gains a Minor Power Card.",[yn.TargetSpirit]:async({spirit:e})=>{await e.gainPowerCard({powerType:Sn.Minor})}}]},ss={name:"Gnawing Rootbiters",type:Sn.Minor,speed:rr.Slow,energy:0,elements:[nr.Earth,nr.Animal],set:a.Base,target:ir.Land,range:1,hasPushOrGather:!0,effects:[{textArea:[.748,.788],text:"Push up to 2 <town>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(2,e.Town)}}]},os={name:"Land Of Haunts And Embers",type:Sn.Minor,speed:rr.Fast,energy:0,elements:[nr.Moon,nr.Fire,nr.Air],set:a.Base,target:ir.Land,range:2,hasPushOrGather:!0,blightWhiteListedPower:!0,generatesFear:!0,effects:[{textArea:[.636,.676],text:"2 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.636,.676],text:"Push up to 2 <explorer>/<town>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(2,e.ExplorerOrTown)}},{textArea:[.723,.763],text:"If target land has <blight>, +2 <fear>.",[yn.InTargetLand]:async({$:e,land:a})=>{a.has(e.Blight)&&await a.fear(2)}},{textArea:[.769,.809],text:"Push up to 2 more <explorer>/<town>.",[yn.InTargetLand]:async({$:e,land:a})=>{a.has(e.Blight)&&await a.pushUpTo(2,e.ExplorerOrTown)}},{textArea:[.858,.898],text:"Add 1 <blight>",[yn.InTargetLand]:async({land:e})=>{await e.addBlight(1)}}]},ds={name:"Lure Of The Unknown",type:Sn.Minor,speed:rr.Fast,energy:0,elements:[nr.Moon,nr.Fire,nr.Air,nr.Plant],set:a.Base,target:ir.Land,targetFilter:[sr.NoInvaders],range:2,hasPushOrGather:!0,effects:[{textArea:[.75,.79],text:"Gather 1 <explorer>/<town>",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherOne(e.ExplorerOrTown)}}]},cs={name:"Natures Resilience",type:Sn.Minor,speed:rr.Fast,energy:1,elements:[nr.Earth,nr.Plant,nr.Animal],set:a.Base,target:ir.Land,sourceFilter:[sr.SacredSite],range:1,blightWhiteListedPower:!0,effects:[{textArea:[.653,.926],text:"Defend 6.<br><br>If you have 2 <water>: You may instead remove 1 <blight>.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await e.chooseBetween({effects:[{actionId:"Defend",textArea:[.663,.703],text:"Defend 6.",[yn.Now]:async()=>{await t.defend(6)},condition:()=>t.isLand},{actionId:"RemoveBlight",textArea:[.881,.921],text:"Remove 1 <blight>.",[yn.Now]:async()=>{await a.convertElements({[nr.Water]:2}),await t.removeBlight()},condition:()=>a.hasElementsWithConvert({[nr.Water]:2})}]},{orChoice:!1})}}]},ls={name:"Pull Beneath The Hungry Earth",type:Sn.Minor,speed:rr.Slow,energy:1,elements:[nr.Moon,nr.Water,nr.Earth],set:a.Base,target:ir.Land,range:1,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.661,.75],text:"If target land has your <presence>, 1 <fear> and 1 Damage.",[yn.InTargetLand]:async({land:e,you:a})=>{e.hasPresenceOf(a)&&(await e.fear(1),await e.damage(1))}},{textArea:[.785,.878],text:"If target land is <sands-wetlands>, 1 Damage.",[yn.InTargetLand]:async({land:e})=>{e.isSandsOrWetlands&&await e.damage(1)}}]},hs={name:"Purifying Flame",type:Sn.Minor,speed:rr.Slow,energy:1,elements:[nr.Sun,nr.Fire,nr.Air,nr.Plant],set:a.Base,target:ir.Land,sourceFilter:[sr.SacredSite],range:1,hasDamageInstructions:!0,effects:[{textArea:[.67,.864],text:"1 Damage per <blight>. If target land is <mountains>/<sands>, you may instead remove 1 <blight>.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"DamagePerBlight",textArea:[.679,.719],text:"1 Damage per <blight>.",[yn.Now]:async()=>{await a.damage(a.numberOf(e.Blight))}},{actionId:"RemoveBlight",textArea:[.759,.864],text:"Remove 1 <blight>.",[yn.Now]:async()=>{await a.removeBlight()},condition:()=>a.isMountainsOrSands}]},{orChoice:!1})}}]},us={name:"Quicken The Earths Struggles",type:Sn.Minor,speed:rr.Fast,energy:1,elements:[nr.Moon,nr.Fire,nr.Earth,nr.Animal],set:a.Base,target:ir.Land,sourceFilter:[sr.SacredSite],range:0,hasDamageInstructions:!0,effects:[{textArea:[.693,.842],text:"1 Damage to each <town>/<city>.<or>Defend 10",[yn.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"DamageToEach",textArea:[.707,.747],text:"1 Damage to each <town>/<city>.",[yn.Now]:async()=>{await a.damageEach(1,e.TownOrCity)}},{actionId:"Defend",textArea:[.792,.832],text:"Defend 10.",[yn.Now]:async()=>{await a.defend(10)}}]})}}]},gs={name:"Rain Of Blood",type:Sn.Minor,speed:rr.Slow,energy:0,elements:[nr.Air,nr.Water,nr.Animal],set:a.Base,target:ir.Land,sourceFilter:[sr.SacredSite],targetFilter:[sr.Invaders],range:1,generatesFear:!0,effects:[{textArea:[.659,.699],text:"2 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.748,.883],text:"If target land has at least 2 <town>/<city>, +1 <fear>.",[yn.InTargetLand]:async({$:e,land:a})=>{a.hasAtLeast(2,e.TownOrCity)&&await a.fear(1)}}]},fs={name:"Reaching Grasp",type:Sn.Minor,speed:rr.Fast,energy:0,elements:[nr.Sun,nr.Air,nr.Water],set:a.Base,target:ir.Spirit,effects:[{textArea:[.716,.814],text:"Target Spirit gets +2 range with all their Powers.",[yn.TargetSpirit]:async({$:e,power:a,spirit:t})=>{await e.addSubEffectUntilEndOfTurn({[yn.GlobalReminder]:()=>({power:a.power,players:[t]}),[yn.ExtraRange]:e=>e.spirit===t?2:0})}}]},ps={name:"Rouse The Trees And Stones",type:Sn.Minor,speed:rr.Slow,energy:1,elements:[nr.Fire,nr.Earth,nr.Plant],set:a.Base,target:ir.Land,sourceFilter:[sr.SacredSite],targetFilter:[sr.NonBlight],range:1,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{textArea:[.722,.762],text:"2 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(2)}},{textArea:[.766,.806],text:"Push 1 <explorer>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushOne(e.Explorer)}}]},ws={name:"Sap The Strength Of Multitudes",type:Sn.Minor,speed:rr.Fast,energy:0,elements:[nr.Water,nr.Animal],set:a.Base,target:ir.Land,range:0,modifiesRange:({spirit:e,withConvert:a})=>e.hasElements({[nr.Air]:1},a)?1:0,payForRange:async({spirit:e})=>{await e.convertElements({[nr.Air]:1})},effects:[{textArea:[.664,.704],text:"Defend 5.",[yn.InTargetLand]:async({land:e})=>{await e.defend(5)}}]},ys={name:"Savage Mawbeasts",type:Sn.Minor,speed:rr.Slow,energy:0,elements:[nr.Fire,nr.Animal],set:a.Base,target:ir.Land,sourceFilter:[sr.SacredSite],range:1,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.636,.739],text:"If target land is <jungles-wetlands>, 1 <fear> and 1 Damage.",[yn.InTargetLand]:async({land:e})=>{e.isJungleOrWetlands&&(await e.fear(1),await e.damage(1))}},{textArea:[.894,.934],text:"If you have 3 <animal>: 1 Damage.",[yn.InTargetLand]:async({you:e,land:a})=>{await e.askToConvertElements({[nr.Animal]:3})&&await a.damage(1)}}]},ms={name:"Shadows Of The Burning Forest",type:Sn.Minor,speed:rr.Slow,energy:0,elements:[nr.Moon,nr.Fire,nr.Plant],set:a.Base,target:ir.Land,targetFilter:[sr.Invaders],range:0,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.66,.7],text:"2 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.745,.853],text:"If target land is <mountains-jungles>, Push 1 <explorer> and 1 <town>.",[yn.InTargetLand]:async({$:e,land:a})=>{a.isMountainsOrJungles&&(await a.pushOne(e.Explorer),await a.pushOne(e.Town))}}]},vs={name:"Song Of Sanctity",type:Sn.Minor,speed:rr.Slow,energy:1,elements:[nr.Sun,nr.Water,nr.Plant],set:a.Base,target:ir.Land,targetFilter:[sr.Mountain,sr.Jungle],range:1,hasPushOrGather:!0,effects:[{textArea:[.673,.863],text:"If target land has <explorer>, Push all <explorer>. Otherwise, remove 1 <blight>.",[yn.InTargetLand]:async({$:e,land:a})=>{a.isLand&&a.has(e.Explorer)?await e.addSubEffect({textArea:[.673,.773],text:"If target land has <explorer>, Push all <explorer>.",[yn.Now]:async()=>{await a.pushAll(e.Explorer)}}):await e.addSubEffect({textArea:[.815,.855],text:"Otherwise, remove 1 <blight>.",[yn.Now]:async()=>{await a.removeBlight()}})}}]},As={name:"Steam Vents",type:Sn.Minor,speed:rr.Fast,energy:1,elements:[nr.Fire,nr.Air,nr.Water,nr.Earth],set:a.Base,target:ir.Land,range:0,hasDestroyInstructions:!0,effects:[{textArea:[.647,.936],text:"Destroy 1 <explorer>.<br><br>If you have 3 <earth>: You may instead destroy 1 <town>.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await t.destroy({amount:1,pieces:await a.askToConvertElements({[nr.Earth]:3})?e.ExplorerOrTown:e.Explorer})}}]},Is={name:"Uncanny Melting",type:Sn.Minor,speed:rr.Slow,energy:1,elements:[nr.Sun,nr.Moon,nr.Water],set:a.Base,target:ir.Land,sourceFilter:[sr.SacredSite],range:1,blightWhiteListedPower:!0,generatesFear:!0,effects:[{textArea:[.671,.711],text:"If Invaders are present, 1 <fear>.",[yn.InTargetLand]:async({land:e})=>{e.hasInvaders&&await e.fear(1)}},{textArea:[.752,.854],text:"If target land is <sands-wetlands>, remove 1 <blight>.",[yn.InTargetLand]:async({land:e})=>{e.isSandsOrWetlands&&await e.removeBlight()}}]},xs={name:"Veil The Nights Hunt",type:Sn.Minor,speed:rr.Fast,energy:1,elements:[nr.Moon,nr.Air,nr.Animal],set:a.Base,target:ir.Land,targetFilter:[sr.Dahan],range:2,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{textArea:[.669,.854],text:"Each <dahan> deals 1 Damage to a different Invader.<or>Push up to 3 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"DealDamage",textArea:[.669,.766],text:"Each <dahan> deals 1 Damage to a different Invader.",[yn.Now]:async()=>{await a.damageDifferent(a.numberOf(e.Dahan),e.Invader)}},{actionId:"PushDahan",textArea:[.808,.848],text:"Push up to 3 <dahan>.",[yn.Now]:async()=>{await a.pushUpTo(3,e.Dahan)}}]})}}]},bs={name:"Visions Of Fiery Doom",type:Sn.Minor,speed:rr.Fast,energy:1,elements:[nr.Moon,nr.Fire],set:a.Base,target:ir.Land,range:0,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.636,.676],text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.68,.72],text:"Push 1 <explorer>/<town>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushOne(e.ExplorerOrTown)}},{textArea:[.888,.928],text:"If you have 2 <fire>: +1 <fear>.",[yn.InTargetLand]:async({you:e,land:a})=>{await e.askToConvertElements({[nr.Fire]:2})&&await a.fear(1)}}]},Ts={name:"Voracious Growth",type:Sn.Minor,speed:rr.Slow,energy:1,elements:[nr.Water,nr.Plant],set:a.Base,target:ir.Land,sourceFilter:[sr.SacredSite],targetFilter:[sr.Jungle,sr.Wetlands],range:1,blightWhiteListedPower:!0,hasDamageInstructions:!0,effects:[{textArea:[.703,.837],text:"2 Damage.<or>Remove 1 <blight>.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"Damage",textArea:[.705,.745],text:"2 Damage.",[yn.Now]:async()=>{await a.damage(2)}},{actionId:"RemoveBlight",textArea:[.792,.832],text:"Remove 1 <blight>.",[yn.Now]:async()=>{await a.removeBlight()}}]})}}]},Es={name:"Absorb Corruption",type:Sn.Minor,speed:rr.Slow,energy:1,elements:[nr.Sun,nr.Earth,nr.Plant],set:a.BranchAndClaw,target:ir.Land,range:0,hasPushOrGather:!0,blightWhiteListedPower:!0,effects:[{textArea:[.61,.934],text:"Gather 1 <blight>.<or>Pay 1 Energy to remove 1 <blight>.<br><br>If you have 2 <plant>:<br>You may do both.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await e.chooseBetween({effects:[{actionId:"GatherBlight",textArea:[.615,.655],text:"Gather 1 <blight>",[yn.Now]:async()=>{await t.gatherOne(e.Blight)},condition:()=>t.hasAdjacentLandWithPiece(e.Blight)},{actionId:"RemoveBlight",textArea:[.702,.742],text:"Pay 1 Energy to remove 1 <blight>.",[yn.Now]:async()=>{await a.payEnergy(1),await t.removeBlight()},condition:()=>t.has(e.Blight)&&a.energy>=1},{actionId:"DoBoth",textArea:[.605,.752],text:"Do both.",[yn.Now]:async()=>{await a.convertElements({[nr.Plant]:2}),await e.addSubEffect({textArea:[.615,.655],text:"Gather 1 <blight>",[yn.Now]:async()=>{await t.gatherOne(e.Blight)}}),await e.addSubEffect({textArea:[.702,.742],text:"Pay 1 Energy to remove 1 <blight>.",[yn.Now]:async()=>{await a.payEnergy(1),await t.removeBlight()}})},condition:()=>a.hasElementsWithConvert({[nr.Plant]:2})&&t.hasOrIsAdjacentToLandsWith(e.Blight)&&!e.treatingAllOrsAsAnds&&a.energy>=1}]})}}]},Ps={name:"Animated Wrackroot",type:Sn.Minor,speed:rr.Slow,energy:0,elements:[nr.Moon,nr.Fire,nr.Plant],set:a.BranchAndClaw,target:ir.Land,range:0,generatesFear:!0,hasDestroyInstructions:!0,effects:[{textArea:[.696,.84],text:"1 <fear>. Destroy 1 <explorer>.<or>Add 1 <wilds>.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"Fear",textArea:[.705,.745],text:"1 <fear>. Destroy 1 <explorer>.",[yn.Now]:async()=>{await a.fear(1),await a.destroyOne(e.Explorer)}},{actionId:"AddWilds",textArea:[.791,.831],text:"Add 1 <wilds>.",[yn.Now]:async()=>{await a.add(1,e.Wilds)}}]})}}]},Ss={name:"Call to Ferocity",type:Sn.Minor,speed:rr.Slow,energy:0,elements:[nr.Sun,nr.Fire,nr.Earth],set:a.BranchAndClaw,targetFilter:[sr.Invaders],target:ir.Land,range:1,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.67,.863],text:"Gather up to 3 <dahan>.<or>If target land has <dahan>, 1 <fear> and Push 1 <explorer> and 1 <town>.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"GatherDahan",textArea:[.68,.72],text:"Gather up to 3 <dahan>.",[yn.Now]:async()=>{await a.gatherUpTo(3,e.Dahan)}},{actionId:"FearAndPush",textArea:[.768,.863],text:"If target land has <dahan>, 1 <fear> and Push 1 <explorer> and 1 <town>.",[yn.Now]:async()=>{a.has(e.Dahan)&&(await a.fear(1),await a.pushOne(e.Explorer),await a.pushOne(e.Town))}}]})}}]},Os={name:"Call To Trade",type:Sn.Minor,speed:rr.Fast,energy:1,elements:[nr.Air,nr.Water,nr.Earth,nr.Plant],set:a.BranchAndClaw,target:ir.Land,targetFilter:[sr.Dahan],range:2,hasPushOrGather:!0,effects:[{textArea:[.637,.677],text:"You may Gather 1 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.mayGather(e.Dahan)}},{text:"If the Terror Level is 2 or lower, Gather 1 <town> and the first Ravage in target land this turn becomes a Build there instead.",effects:[{textArea:[.72,.812],text:"Gather 1 <town>",[yn.InTargetLand]:async({$:e,land:a})=>{e.terrorLevel<=2&&await a.gatherOne(e.Town)}},{textArea:[.768,.9],text:"The first Ravage in target land this turn becomes a Build there instead",[yn.InTargetLand]:async({$:e,land:a})=>{e.terrorLevel<=2&&await a.skipInvaderAction({next:!0,filter:({invaderAction:e})=>e===Hr.Ravage,afterSkip:async({card:e})=>{await a.doExtraBuild(e)}})}}]}]},Cs={name:"Confounding Mists",type:Sn.Minor,speed:rr.Fast,energy:1,elements:[nr.Air,nr.Water],set:a.BranchAndClaw,target:ir.Land,range:1,hasPushOrGather:!0,effects:[{textArea:[.654,.878],text:"Defend 4.<or>Each Invader added to target land this turn may be immediately Pushed to any adjacent land.",[yn.InTargetLand]:async({$:e,you:a,land:t,power:n})=>{await e.chooseBetween({effects:[{actionId:"Defend",textArea:[.66,.7],text:"Defend 4.",[yn.Now]:async()=>{await t.defend(4)}},{actionId:"AddTrigger",textArea:[.745,.877],text:"Each Invader added to target land this turn may be immediately Pushed to any adjacent land.",[yn.Now]:async({effect:r})=>{await e.addSubEffectUntilEndOfTurn({[yn.Reminder]:e=>e===t?r.text:void 0,[yn.AfterAddingPiece]:async r=>{if(r.land===t)for(const i of r.additions)i.location===t&&i.piece.isInvader&&await e.doPowerAction(a,(async()=>{await i.piece.push({quantifier:lr.May})}),n)}})}}]})}}]},Ds={name:"Cycles Of Time And Tide",type:Sn.Minor,speed:rr.Fast,energy:1,elements:[nr.Sun,nr.Moon,nr.Water],set:a.BranchAndClaw,target:ir.Land,targetFilter:[sr.Coastal],range:1,blightWhiteListedPower:!0,effects:[{textArea:[.69,.73],text:"If there are <dahan>, add 1 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{a.has(e.Dahan)&&await a.add(1,e.Dahan)}},{textArea:[.779,.819],text:"If there are no <dahan>, remove 1 <blight>.",[yn.InTargetLand]:async({$:e,land:a})=>{a.has(e.Dahan)||await a.removeBlight()}}]},Bs={name:"Disorienting Landscape",type:Sn.Minor,speed:rr.Fast,energy:1,elements:[nr.Moon,nr.Air,nr.Plant],set:a.BranchAndClaw,target:ir.Land,sourceFilter:[sr.SacredSite],range:2,hasPushOrGather:!0,effects:[{textArea:[.673,.713],text:"Push 1 <explorer>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushOne(e.Explorer)}},{textArea:[.755,.857],text:"If target land is <mountains-jungles>, add 1 <wilds>.",[yn.InTargetLand]:async({$:e,land:a})=>{a.isMountainsOrJungles&&await a.add(1,e.Wilds)}}]},ks={name:"Elusive Ambushes",type:Sn.Minor,speed:rr.Fast,energy:1,elements:[nr.Sun,nr.Fire,nr.Water],set:a.BranchAndClaw,target:ir.Land,targetFilter:[sr.Dahan],range:1,hasDamageInstructions:!0,effects:[{textArea:[.696,.827],text:"1 Damage.<or>Defend 4.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"Damage",textArea:[.696,.736],text:"1 Damage.",[yn.Now]:async()=>{await a.damage(1)}},{actionId:"Defend",textArea:[.784,.824],text:"Defend 4.",[yn.Now]:async()=>{await a.defend(4)}}]})}}]},Ls={name:"Fire In The Sky",type:Sn.Minor,speed:rr.Fast,energy:1,elements:[nr.Sun,nr.Fire,nr.Air],set:a.BranchAndClaw,target:ir.Land,sourceFilter:[sr.SacredSite],range:1,generatesFear:!0,effects:[{textArea:[.722,.762],text:"2 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.773,.813],text:"Add 1 <strife>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Strife)}}]},Fs={name:"Fleshrot Fever",type:Sn.Minor,speed:rr.Slow,energy:1,elements:[nr.Fire,nr.Air,nr.Water,nr.Animal],set:a.BranchAndClaw,target:ir.Land,targetFilter:[sr.Jungle,sr.Sands],range:1,generatesFear:!0,effects:[{textArea:[.722,.762],text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.766,.806],text:"Add 1 <disease>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Disease)}}]},Rs={name:"Gold's Allure",type:Sn.Minor,speed:rr.Slow,energy:0,elements:[nr.Fire,nr.Earth,nr.Animal],set:a.BranchAndClaw,target:ir.Land,targetFilter:[sr.Mountain],range:1,hasPushOrGather:!0,effects:[{textArea:[.722,.762],text:"Gather 1 <explorer> and 1 <town>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherOne(e.Explorer),await a.gatherOne(e.Town)}},{textArea:[.773,.813],text:"Add 1 <strife>.",[yn.InTargetLand]:async({land:e})=>{await e.addStrife(1)}}]},Ns={name:"Growth Through Sacrifice",type:Sn.Minor,speed:rr.Fast,energy:0,elements:[nr.Moon,nr.Fire,nr.Water,nr.Plant],set:a.BranchAndClaw,target:ir.Spirit,banned:!0,hasDestroyInstructions:!0,effects:[{textArea:[.59,.63],text:"Destroy 1 of your <presence>.",[yn.TargetSpirit]:async({you:e})=>{await e.destroyPresence(1)}},{textArea:[.66,.799],text:"Target Spirit chooses to either:<br><br>Remove 1 <blight> from one of their lands.<or>Add 1 <presence> to one of their lands.<br><br>If you have 2 <sun>: They may do both, in the same land.",[yn.TargetSpirit]:async({$:e,you:a,spirit:t})=>{await e.chooseBetween({effects:[{actionId:"RemoveBlight",textArea:[.69,.73],text:"Remove 1 <blight> from one of their lands.",label:"Remove <blight>.",[yn.Now]:async()=>{await t.inLands().pickOne((async e=>{await e.removeBlight()}))}},{actionId:"AddPresence",textArea:[.758,.798],text:"Add 1 <presence> to one of their lands.",label:"Add <presence>.",[yn.Now]:async()=>{await t.addPresence()}},{actionId:"DoBoth",textArea:[.693,.799],text:"Do both, in the same land.",label:"Do both.",[yn.Now]:async()=>{await a.convertElements({[nr.Sun]:2}),await t.inLands().pickOne((async a=>{await e.addSubEffect({textArea:[.69,.73],text:"Remove 1 <blight>.",[yn.Now]:async()=>{await a.removeBlight()}}),await e.addSubEffect({textArea:[.758,.798],text:"Add <presence>.",[yn.Now]:async()=>{await a.addPresence(t)}})}))},condition:()=>a.hasElementsWithConvert({[nr.Sun]:2})&&!e.treatingAllOrsAsAnds}]})}}]},$s={name:"Guardian Serpents",type:Sn.Minor,speed:rr.Fast,energy:1,elements:[nr.Sun,nr.Moon,nr.Earth,nr.Animal],set:a.BranchAndClaw,target:ir.Spirit,effects:[{textArea:[.64,.867],text:"Add 1 <beasts> in one of target Spirit's lands.<br><br>If target Spirit has a <sacred> in that land, Defend 4 there.",[yn.TargetSpirit]:async({$:e,spirit:a})=>{await a.inLands().pickOne((async t=>{await t.add(1,e.Beasts),t.hasSacredSiteOf(a)&&await t.defend(4)}))}}]},Ws={name:"Here There Be Monsters",type:Sn.Minor,speed:rr.Slow,energy:0,elements:[nr.Moon,nr.Air,nr.Animal],set:a.BranchAndClaw,target:ir.Land,targetFilter:[sr.Inland],range:0,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.664,.704],text:"You may Push 1 <explorer>/<town>/<dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.mayPush(e.ExplorerTownOrDahan)}},{textArea:[.706,.746],text:"2 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.795,.883],text:"If target land has any <beasts>, 1 <fear>.",[yn.InTargetLand]:async({$:e,land:a})=>{a.has(e.Beasts)&&await a.fear(1)}}]},Ms={name:"Infested Aquifers",type:Sn.Minor,speed:rr.Slow,energy:1,elements:[nr.Moon,nr.Water,nr.Earth,nr.Animal],set:a.BranchAndClaw,target:ir.Land,range:0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.654,.89],text:"If target land has any <disease>, 1 Damage to each Invader.<or>If target land is <mountains-wetlands>, 1 <fear> and add 1 <disease>.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"DamageToEach",textArea:[.66,.749],text:"If target land has any <disease>, 1 Damage to each Invader.",[yn.Now]:async()=>{a.has(e.Disease)&&await a.damageEach(1)}},{actionId:"FearAndAddDisease",textArea:[.785,.888],text:"If target land is <mountains-wetlands>, 1 <fear> and add 1 <disease>.",[yn.Now]:async()=>{a.isMountainsOrWetlands&&(await a.fear(1),await a.add(1,e.Disease))}}]})}}]},Gs={name:"Inflame The Fires Of Life",type:Sn.Minor,speed:rr.Slow,energy:1,elements:[nr.Moon,nr.Fire,nr.Plant,nr.Animal],set:a.BranchAndClaw,target:ir.Land,sourceFilter:[sr.SacredSite],range:1,generatesFear:!0,effects:[{textArea:[.605,.934],text:"Add 1 <disease>.<or>1 <fear>. Add 1 <strife>.<br><br>If you have 3 <animal>: You may do both.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await e.chooseBetween({effects:[{actionId:"AddDisease",textArea:[.62,.66],text:"Add 1 <disease>.",[yn.Now]:async()=>{await t.add(1,e.Disease)}},{actionId:"FearAndStrife",textArea:[.706,.746],text:"1 <fear>. Add 1 <strife>.",[yn.Now]:async()=>{await t.fear(1),await t.addStrife(1)}},{actionId:"DoBoth",textArea:[.605,.756],text:"Do both.",[yn.Now]:async()=>{await a.convertElements({[nr.Animal]:3}),await e.addSubEffect({textArea:[.62,.66],text:"Add 1 <disease>.",[yn.Now]:async()=>{await t.add(1,e.Disease)}}),await e.addSubEffect({textArea:[.706,.746],text:"1 <fear>. Add 1 <strife>.",[yn.Now]:async()=>{await t.fear(1),await t.addStrife(1)}})},condition:()=>!e.treatingAllOrsAsAnds&&a.hasElementsWithConvert({[nr.Animal]:3})}]})}}]},Hs={name:"Pact Of The Joined Hunt",type:Sn.Minor,speed:rr.Slow,energy:1,elements:[nr.Sun,nr.Plant,nr.Animal],set:a.BranchAndClaw,target:ir.Spirit,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{textArea:[.67,.855],text:"Target Spirit Gathers 1 <dahan> into one of their lands. 1 Damage in that land per <dahan> present.",[yn.TargetSpirit]:async({$:e,spirit:a})=>{await a.inLands().pickOne((async a=>{await a.gatherOne(e.Dahan),await a.damage(a.numberOf(e.Dahan))}))}}]},js={name:"Poisoned Dew",type:Sn.Minor,speed:rr.Slow,energy:1,elements:[nr.Fire,nr.Water,nr.Plant],set:a.BranchAndClaw,target:ir.Land,range:1,hasDestroyInstructions:!0,effects:[{textArea:[.657,.848],text:"Destroy 1 <explorer>.<br><br>If target land is <jungles-wetlands>, destroy all <explorer>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.destroyOne(e.Explorer),a.isJungleOrWetlands&&await a.destroyAll(e.Explorer)}}]},Us={name:"Portents Of Disaster",type:Sn.Minor,speed:rr.Fast,energy:0,elements:[nr.Sun,nr.Moon,nr.Air],set:a.BranchAndClaw,target:ir.Land,sourceFilter:[sr.SacredSite],targetFilter:[sr.Invaders],range:1,generatesFear:!0,effects:[{textArea:[.661,.701],text:"2 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.75,.881],text:"The next time an Invader is destroyed in target land this turn, 1 <fear>.",[yn.InTargetLand]:async({$:e,land:a,...t})=>{const n={triggerId:e.nextTriggerId(),[yn.Now]:async()=>{await e.sendEvent({type:fn.GenericMain,text:"<p>PortentsOfDisaster</p> triggered from destroying an Invader."}),await a.fear(1)}};await e.addSubEffectUntilEndOfTurn({[yn.Reminder]:e=>e===a?t.effect.text:void 0,[yn.AfterRemovePiece]:async({piece:r,location:i,removement:s})=>{r.isInvader&&i===a&&pr[s].isDestroyLike&&(await e.addTrigger(n,t.effect,t.action),e.removeThisEffect())}})}}]},qs={name:"Promises Of Protection",type:Sn.Minor,speed:rr.Fast,energy:0,elements:[nr.Sun,nr.Earth,nr.Animal],set:a.BranchAndClaw,target:ir.Land,sourceFilter:[sr.SacredSite],range:2,hasPushOrGather:!0,effects:[{textArea:[.703,.743],text:"Gather up to 2 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(2,e.Dahan)}},{textArea:[.746,.834],text:"<dahan> have +2 Health while in target land.",[yn.InTargetLand]:async({$:e,land:a,effect:t})=>{await e.addSubEffectUntilEndOfTurn({[yn.AdjustHealth]:({piece:t})=>t.isA(e.Dahan)&&t.location===a?2:0,[yn.Reminder]:e=>e===a?t.text:void 0})}}]},_s={name:"Prowling Panthers",type:Sn.Minor,speed:rr.Slow,energy:1,elements:[nr.Moon,nr.Fire,nr.Animal],set:a.BranchAndClaw,target:ir.Land,targetFilter:[sr.Mountain,sr.Jungle],range:1,generatesFear:!0,hasDestroyInstructions:!0,effects:[{textArea:[.67,.864],text:"1 <fear>. Add 1 <beasts>.<or>If target land has <beasts>, destroy 1 <explorer>/<town>.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"FearAndBeasts",textArea:[.684,.724],text:"1 <fear>. Add 1 <beasts>.",[yn.Now]:async()=>{await a.fear(1),await a.add(1,e.Beasts)}},{actionId:"Destroy",textArea:[.766,.86],text:"If target land has <beasts>, destroy 1 <explorer>/<town>.",[yn.Now]:async()=>{a.has(e.Beasts)&&await a.destroyOne(e.ExplorerOrTown)}}]})}}]},Js={name:"Razorsharp Undergrowth",type:Sn.Minor,speed:rr.Fast,energy:1,elements:[nr.Moon,nr.Plant],set:a.BranchAndClaw,target:ir.Land,targetFilter:[sr.NonBlight],range:0,hasDestroyInstructions:!0,effects:[{textArea:[.699,.739],text:"Destroy 1 <explorer> and 1 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.destroyOne(e.Explorer),await a.destroyOne(e.Dahan)}},{textArea:[.739,.779],text:"Add 1 <wilds>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Wilds)}},{textArea:[.785,.825],text:"Defend 2.",[yn.InTargetLand]:async({land:e})=>{await e.defend(2)}}]},Vs={name:"Renewing Rain",type:Sn.Minor,speed:rr.Slow,energy:1,elements:[nr.Water,nr.Earth,nr.Plant],set:a.BranchAndClaw,target:ir.Land,sourceFilter:[sr.SacredSite],range:1,effects:[{textArea:[.625,.732],text:"If target land is <jungles-sands>, remove 1 <blight>.",[yn.InTargetLand]:async({land:e})=>{e.isJungleOrSands&&await e.removeBlight()}},{textArea:[.884,.924],text:"If you ave 3 <plant>: Add 1 <wilds>.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[nr.Plant]:3})&&await t.add(1,e.Wilds)}}]},Ys={name:"Rites Of The Lands Rejection",type:Sn.Minor,speed:rr.Fast,energy:1,elements:[nr.Moon,nr.Fire,nr.Earth],set:a.BranchAndClaw,target:ir.Land,sourceFilter:[sr.SacredSite],targetFilter:[sr.Dahan],range:2,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.638,.867],text:"Invaders do not Build in target land this turn. 1 <fear> per <town>/<city> or 1 <fear> per <dahan>, whichever is less.<or>Push up to 3 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"NoBuild",textArea:[.638,.784],text:"Invaders do not Build in target land this turn. 1 <fear> per <town>/<city> or 1 <fear> per <dahan>, whichever is less.",label:"Invaders do not Build...",[yn.Now]:async()=>{await a.skipInvaderAction({all:!0,filter:({invaderAction:e})=>e===Hr.Build}),await a.fear(Math.min(a.numberOf(e.TownOrCity),a.numberOf(e.Dahan)))}},{actionId:"Push",textArea:[.822,.862],text:"Push up to 3 <dahan>.",[yn.Now]:async()=>{await a.pushUpTo(3,e.Dahan)}}]})}}]},zs={name:"Scour The Land",type:Sn.Minor,speed:rr.Slow,energy:1,elements:[nr.Air,nr.Earth],set:a.BranchAndClaw,target:ir.Land,sourceFilter:[sr.SacredSite],range:2,hasDestroyInstructions:!0,mayBeSpeed:{effect:{textArea:[.817,.927],text:"If you have 3 <air>: This power may be <fast>.",[yn.Now]:async({action:e})=>{await e.spirit.convertElements({[nr.Air]:3}),await e.power.makeFast()}},condition:({spirit:e,speed:a})=>a===rr.Fast&&e.hasElementsWithConvert({[nr.Air]:3})},blightWhiteListedPower:!0,effects:[{textArea:[.631,.671],text:"Destroy 3 <town> and all <explorer>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.destroy({amount:3,pieces:e.Town}),await a.destroyAll(e.Explorer)}},{textArea:[.676,.716],text:"Add 1 <blight>.",[yn.InTargetLand]:async({land:e})=>{await e.addBlight(1)}}]},Qs={name:"Sky Stretches To Shore",type:Sn.Minor,speed:rr.Fast,energy:1,elements:[nr.Sun,nr.Air,nr.Water,nr.Earth],set:a.BranchAndClaw,target:ir.Spirit,effects:[{textArea:[.656,.792],text:"This turn, Target Spirit may use 1 <slow> Power as if it were <fast>, or vice versa.",[yn.TargetSpirit]:async({spirit:e})=>{await e.gainMakeFastBuff({alsoMakeSlow:!0})}},{textArea:[.786,.886],text:"Target Spirit gains <range+3> for measuring Range to Coastal lands.",[yn.TargetSpirit]:async({$:e,spirit:a})=>{await e.addSubEffectUntilEndOfTurn({[yn.GlobalReminder]:()=>({icon:"Coastal<br><range+3>",players:[a]}),[yn.ExtraRangeToLand]:e=>({extraRangeToLand:e.spirit===a?3:0,landFilter:e=>e.isCoastal})})}}]},Ks={name:"Spur On With Words Of Fire",type:Sn.Minor,speed:rr.Fast,energy:1,elements:[nr.Sun,nr.Fire,nr.Air],set:a.BranchAndClaw,target:ir.Spirit,effects:[{textArea:[.617,.706],text:"If you target a Spirit other than yourself, they gain +1 Energy.",[yn.TargetSpirit]:async({you:e,spirit:a})=>{a!==e&&await a.gainEnergy(1)}},{textArea:[.705,.927],text:"Target Spirit may immediately play another Power Card by paying its cost. (If it is <slow>, it does not resolve until later.)",[yn.TargetSpirit]:async({spirit:e})=>{await e.playAPowerCardByPayingItsCost()}}]},Xs={name:"Swarming Wasps",type:Sn.Minor,speed:rr.Fast,energy:0,elements:[nr.Fire,nr.Air,nr.Animal],set:a.BranchAndClaw,target:ir.Land,targetFilter:[sr.NonBlight],range:1,hasPushOrGather:!0,effects:[{textArea:[.663,.851],text:"Add 1 <beasts>.<or>If target land has <beasts>, Push up to 2 <explorer>.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"AddBeasts",textArea:[.67,.71],text:"Add 1 <beasts>.",[yn.Now]:async()=>{await a.add(1,e.Beasts)}},{actionId:"PushExplorer",textArea:[.804,.844],text:"Push up to 2 <explorer>.",[yn.Now]:async()=>{await a.pushUpTo(2,e.Explorer)},condition:()=>a.has(e.Beasts)&&a.has(e.Explorer)}]})}}]},Zs={name:"Teeming Rivers",type:Sn.Minor,speed:rr.Slow,energy:1,elements:[nr.Sun,nr.Water,nr.Plant,nr.Animal],set:a.BranchAndClaw,target:ir.Land,sourceFilter:[sr.SacredSite],targetFilter:[sr.Mountain,sr.Wetlands],range:2,blightWhiteListedPower:!0,effects:[{textArea:[.654,.749],text:"If target land has no <blight>, add 1 <beasts>.",[yn.InTargetLand]:async({$:e,land:a})=>{a.isLand&&!a.has(e.Blight)&&await a.add(1,e.Beasts)}},{textArea:[.788,.877],text:"If target land has exactly 1 <blight>, remove it.",[yn.InTargetLand]:async({$:e,land:a})=>{a.hasExactly(1,e.Blight)&&await a.removeBlight()}}]},eo={name:"Tormenting Rotflies",type:Sn.Minor,speed:rr.Slow,energy:1,elements:[nr.Air,nr.Plant,nr.Animal],set:a.BranchAndClaw,target:ir.Land,targetFilter:[sr.Sands,sr.Wetlands],range:2,generatesFear:!0,effects:[{textArea:[.647,.883],text:"Add 1 <disease>.<or>If target land has Invaders, 2 <fear>.<br>If <disease> is present, +1 <fear>.<br>If <blight> is present, +1 <fear>.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"Disease",textArea:[.657,.697],text:"Add 1 <disease>.",[yn.Now]:async()=>{await a.add(1,e.Disease)}},{actionId:"Fear",label:"Gain <fear>.",effects:[{textArea:[.746,.786],text:"If target land has Invaders, 2 <fear>.",[yn.Now]:async()=>{a.hasInvaders&&await a.fear(2)}},{textArea:[.789,.829],text:"If <disease> is present, +1 <fear>.",[yn.Now]:async()=>{a.has(e.Disease)&&await a.fear(1)}},{textArea:[.831,.871],text:"If <blight> is present, +1 <fear>.",[yn.Now]:async()=>{a.has(e.Blight)&&await a.fear(1)}}]}]})}}]},ao={name:"Twilight Fog Brings Madness",type:Sn.Minor,speed:rr.Slow,energy:0,elements:[nr.Sun,nr.Moon,nr.Air,nr.Water],set:a.BranchAndClaw,target:ir.Land,range:1,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{textArea:[.71,.75],text:"Add 1 <strife>. Push 1 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.addStrife(1),await a.pushOne(e.Dahan)}},{textArea:[.752,.841],text:"Each remaining <dahan> takes 1 Damage.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.damageEach(1,e.Dahan)}}]},to={name:"Bats Scout For Raids By Darkness",type:Sn.Minor,speed:rr.Slow,energy:1,elements:[nr.Moon,nr.Air,nr.Animal],set:a.JaggedEarth,target:ir.Land,range:2,hasPushOrGather:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.641,.88],text:"For each <dahan>, 1 Damage to <town>/<city>.<or>1 <fear>. Gather up to 2 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"Damage",textArea:[.641,.749],text:"For each <dahan>, 1 Damage to <town>/<city>.",[yn.Now]:async()=>{await a.damage(a.numberOf(e.Dahan),e.TownOrCity)}},{actionId:"Fear",textArea:[.83,.87],text:"1 <fear>. Gather up to 2 <dahan>.",[yn.Now]:async()=>{await a.fear(1),await a.gatherUpTo(2,e.Dahan)}}]})}}]},no={name:"Birds Cry Warning",type:Sn.Minor,speed:rr.Fast,energy:1,elements:[nr.Sun,nr.Air,nr.Animal],set:a.JaggedEarth,target:ir.Land,targetFilter:[sr.Dahan],range:3,hasPushOrGather:!0,effects:[{textArea:[.634,.903],text:"The next time <dahan> would be Destroyed in target land, Destroy 2 fewer <dahan>.<or>Push up to 3 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{let t=0;await e.chooseBetween({effects:[{actionId:"ProtectDahan",textArea:[.634,.768],text:"The next time <dahan> would be Destroyed in target land, Destroy 2 fewer <dahan>.",[yn.Now]:async n=>{await e.addSubEffectUntilEndOfTurn({[yn.OrderOfRemoveAllMightMatter]:()=>!0,[yn.Reminder]:e=>e===a?n.effect.text:void 0,[yn.PreventRemovePiece]:async({piece:n,removement:r})=>!!(n.isA(e.Dahan)&&n.location===a&&pr[r].isDestroyLike&&t<2)&&(t+=1,await e.sendEvent({type:fn.GenericSub,text:"The <dahan> is saved from destruction by <p>BirdsCryWarning</p>."}),2===t&&e.removeThisEffect(),!0)})}},{actionId:"PushDahan",textArea:[.855,.895],text:"Push up to 3 <dahan>.",[yn.Now]:async()=>{await a.pushUpTo(3,e.Dahan)}}]})}}]},ro={name:"Blood Draws Predators",type:Sn.Minor,speed:rr.Fast,energy:1,elements:[nr.Sun,nr.Fire,nr.Water,nr.Animal],set:a.JaggedEarth,target:ir.Land,range:1,hasDamageInstructions:!0,effects:[{textArea:[.676,.854],text:"After the next time Invaders are Destroyed in target land: Add 1 <beasts>, then 1 Damage per <beasts> (max. 3 Damage).",[yn.InTargetLand]:async({$:e,land:a,...t})=>{const n={triggerId:e.nextTriggerId(),[yn.Now]:async()=>{await a.add(1,e.Beasts),await a.damage(Math.min(a.numberOf(e.Beasts),3))}};await e.addSubEffectUntilEndOfTurn({[yn.Reminder]:e=>e===a?t.effect.text:void 0,[yn.AfterRemovePiece]:async({piece:r,location:i,removement:s})=>{r.isInvader&&i===a&&pr[s].isDestroyLike&&(await e.addTrigger(n,t.effect,t.action),e.removeThisEffect())}})}}]},io={name:"Call To Guard",type:Sn.Minor,speed:rr.Fast,energy:0,elements:[nr.Sun,nr.Air,nr.Earth],set:a.JaggedEarth,target:ir.Land,range:1,hasPushOrGather:!0,effects:[{textArea:[.6,.64],text:"Gather up to 1 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(1,e.Dahan)}},{textArea:[.636,.939],text:"Then, if <dahan> are present, either:<br>Defend 1 per <dahan>.<or>After Invaders are added or moved to target land, 1 Damage to each added or moved Invader.",[yn.InTargetLand]:async({$:e,land:a})=>{a.has(e.Dahan)&&await e.chooseBetween({effects:[{actionId:"DefendPerDahan",textArea:[.71,.75],text:"Defend 1 per <dahan>",[yn.Now]:async()=>{await a.defend(a.numberOf(e.Dahan))}},{actionId:"AddTrigger",textArea:[.807,.939],text:"After Invaders are added or moved to target land, 1 Damage to each added or moved Invader.",[yn.Now]:async t=>{await a.afterPiecesAreAddedOrMovedAddTrigger({pieces:e.Invader,trigger:{triggerId:e.nextTriggerId(),[yn.Now]:async({action:e})=>{for(const t of e.parentData.piecesAddedOrMoved)t.location===a&&await t.takeDamage(1)}},effect:t.effect,action:t.action})}}]})}}]},so={name:"Carapaced Land",type:Sn.Minor,speed:rr.Fast,energy:0,elements:[nr.Earth,nr.Plant,nr.Animal],set:a.JaggedEarth,target:ir.Land,range:0,modifiesRangePerLand:{range:1,condition:({$:e,land:a})=>a.has(e.Beasts)},effects:[{textArea:[.713,.753],text:"Defend 3.",[yn.InTargetLand]:async({land:e})=>{await e.defend(3)}},{textArea:[.878,.918],text:"If you have 2 <earth>:<br>Defend +3.",[yn.InTargetLand]:async({you:e,land:a})=>{await e.askToConvertElements({[nr.Earth]:2})&&await a.defend(3)}}]},oo={name:"Desiccating Winds",type:Sn.Minor,speed:rr.Slow,energy:1,elements:[nr.Fire,nr.Air,nr.Earth],set:a.JaggedEarth,target:ir.Land,sourceFilter:[sr.SacredSite],targetFilter:[sr.Mountain,sr.Sands],range:1,hasDamageInstructions:!0,effects:[{textArea:[.679,.772],text:"If target land has <badlands>, 1 Damage.",[yn.InTargetLand]:async({$:e,land:a})=>{a.has(e.Badlands)&&await a.damage(1)}},{textArea:[.785,.825],text:"Add 1 <badlands>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Badlands)}}]},co={name:"Dire Metamorphosis",type:Sn.Minor,speed:rr.Slow,energy:1,elements:[nr.Moon,nr.Air,nr.Earth,nr.Animal],set:a.JaggedEarth,target:ir.Land,range:1,blightWhiteListedPower:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.653,.693],text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.653,.693],text:"1 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(1)}},{textArea:[.707,.747],text:"1 Damage to <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.damage(1,e.Dahan)}},{textArea:[.756,.871],text:"Add 1 <badlands>, 1 <beasts>, 1 <disease>, 1 <strife>, 1 <wilds>, and 1 <blight>.",[yn.InTargetLand]:async({$:e,land:a})=>{a.isLand&&(await a.add(1,e.Badlands),await a.add(1,e.Beasts),await a.add(1,e.Disease),await a.add(1,e.Strife),await a.add(1,e.Wilds)),await a.addBlight(1)}}]},lo={name:"Domesticated Animals Go Berserk",type:Sn.Minor,speed:rr.Fast,energy:1,elements:[nr.Moon,nr.Fire,nr.Animal],set:a.JaggedEarth,target:ir.Land,targetFilter:[sr.Town,sr.City],range:0,generatesFear:!0,effects:[{textArea:[.659,.699],text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.659,.699],text:"Defend 5.",[yn.InTargetLand]:async({land:e})=>{await e.defend(5)}},{textArea:[.87,.91],text:"If you have 3 <moon>:<br>Add 1 <beasts>.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[nr.Moon]:3})&&await t.add(1,e.Beasts)}}]},ho={name:"Dry Wood Explodes In Smoldering Splinters",type:Sn.Minor,speed:rr.Slow,energy:1,elements:[nr.Fire,nr.Air,nr.Plant],set:a.JaggedEarth,target:ir.Land,targetFilter:[sr.NotWetlands],range:0,generatesFear:!0,hasDamageInstructions:!0,mayBeSpeed:{effect:{text:"You may spend 1 Energy to make this Power <fast>.",[yn.Now]:async({action:e})=>{await e.spirit.payEnergy(1),await e.power.makeFast()}},condition:({speed:e,spirit:a})=>e===rr.Fast&&a.energy>=1},effects:[{textArea:[.768,.808],text:"2 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.824,.864],text:"1 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(1)}}]},uo={name:"Entrap The Forces Of Corruption",type:Sn.Minor,speed:rr.Fast,energy:1,elements:[nr.Earth,nr.Plant,nr.Air],set:a.JaggedEarth,target:ir.Land,range:1,hasPushOrGather:!0,blightWhiteListedPower:!0,effects:[{textArea:[.659,.699],text:"Gather up to 1 <blight>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(1,e.Blight)}},{textArea:[.715,.755],text:"Isolate target land.",[yn.InTargetLand]:async({land:e})=>{e.isLand&&await e.isolate()}},{textArea:[.766,.86],text:"When <blight> is added to target land, it doesn't cascade.",[yn.InTargetLand]:async({$:e,land:a,effect:t})=>{await e.addSubEffectUntilEndOfTurn({[yn.Reminder]:e=>e===a?t.text:void 0,[yn.PreventCascade]:({location:e})=>Promise.resolve(e===a)})}}]},go={name:"Favor Of The Sun And Star-lit Dark",type:Sn.Minor,speed:rr.Fast,energy:1,elements:[nr.Sun,nr.Moon,nr.Plant],set:a.JaggedEarth,target:ir.Land,sourceFilter:[sr.SacredSite],range:1,hasPushOrGather:!0,blightWhiteListedPower:!0,generatesFear:!0,effects:[{textArea:[.624,.664],text:"Defend 4",[yn.InTargetLand]:async({land:e})=>{e.isLand&&await e.defend(4)}},{textArea:[.682,.722],text:"Push up to 1 <blight>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(1,e.Blight)}},{textArea:[.871,.911],text:"If you have 2 <sun>:<br>1 <fear>.",[yn.InTargetLand]:async({you:e,land:a})=>{await e.askToConvertElements({[nr.Sun]:2})&&await a.fear(1)}}]},fo={name:"Flow Downriver Blow Downwind",type:Sn.Minor,speed:rr.Slow,energy:0,elements:[nr.Air,nr.Water,nr.Plant],set:a.JaggedEarth,target:ir.Land,sourceFilter:[sr.SacredSite],range:2,hasPushOrGather:!0,blightWhiteListedPower:!0,effects:[{textArea:[.746,.786],text:"Push up to 1 <blight>/<explorer>/<town>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(1,e.BlightExplorerOrTown)}}]},po={name:"Gift Of Natures Connection",type:Sn.Minor,speed:rr.Fast,energy:0,elements:[],set:a.JaggedEarth,target:ir.Spirit,effects:[{textArea:[.636,.772],text:"Target Spirit gains either 2 Energy or 2 of a single Element (their choice).",[yn.TargetSpirit]:async({$:e,spirit:a})=>{await e.chooseBetween({players:[a],effects:[{actionId:"GainEnergy",text:"Gain 2 Energy.",players:[a],[yn.Now]:async()=>{await a.gainEnergy(2)}},{actionId:"GainElement",text:"Gain 2 of a single Element.",players:[a],[yn.Now]:async()=>{await a.gainElements({amount:2,same:!0})}}]})}},{textArea:[.779,.877],text:"If you target another Spirit, you gain an Element of your choice.",[yn.TargetSpirit]:async({you:e,spirit:a})=>{a!==e&&await e.gainElements()}}]},wo={name:"Gift Of Twinned Days",type:Sn.Minor,speed:rr.Fast,energy:1,elements:[nr.Sun,nr.Moon],set:a.JaggedEarth,target:ir.Spirit,targetFilter:[ur.Another],effects:[{textArea:[.644,.88],text:"Once this turn, target Spirit may Repeat the lowest-cost Power Card they have in play by paying its cost again. You may do likewise.",[yn.TargetSpirit]:async({$:e,spirit:a,you:t,...n})=>{n.isRepeat||await a.andAnotherSpirit(t,{now:async(a,t)=>{await e.addSubEffectUntilEndOfTurn({textArea:t?[.647,.822]:[.838,.878],text:(t?"Target Spirit":"You")+" may Repeat the lowest-cost Power Card you have in play by paying its cost again.",[yn.GlobalReminder]:()=>({power:n.power.power,players:[a]}),[yn.MayRepeatPowercard]:({power:e,speed:t})=>e.owner===a&&e.costToPlay<=a.energy&&e.data.type!==Sn.Innate&&e.isLowestCostOfPlayedCards&&e.possibleToRepeatAtSpeed(t),[yn.RepeatPowerCard]:async({power:t,speed:n})=>{t.owner===a&&e.removeThisEffect(),await t.payForPlay(),await t.replay(n)}})}})}}]},yo={name:"Haunted By Primal Memories",type:Sn.Minor,speed:rr.Fast,energy:1,elements:[nr.Moon,nr.Air,nr.Earth],set:a.JaggedEarth,target:ir.Land,sourceFilter:[sr.SacredSite],targetFilter:[sr.Invaders],range:2,generatesFear:!0,effects:[{textArea:[.71,.75],text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.71,.75],text:"Defend 3.",[yn.InTargetLand]:async({land:e})=>{await e.defend(3)}},{textArea:[.768,.808],text:"If <beasts> are present, +2 <fear>.",[yn.InTargetLand]:async({$:e,land:a})=>{a.has(e.Beasts)&&await a.fear(2)}}]},mo={name:"Hazards Spread Across The Island",type:Sn.Minor,speed:rr.Fast,energy:0,elements:[nr.Fire,nr.Air,nr.Earth,nr.Plant],set:a.JaggedEarth,target:ir.Land,sourceFilter:[sr.SacredSite],range:2,effects:[{textArea:[.624,.9],text:"Choose a type of token from <badlands>/<beasts>/<disease>/<strife>/<wilds> that exists in an adjacent land; choosing <disease> costs 1 Energy.<br>Add 1 of that type of token to target land.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await e.chooseBetween({effects:[e.Badlands,e.Beasts,e.Disease,e.Strife,e.Wilds].map((n=>({actionId:n,text:Kn[n].text,[yn.Now]:async()=>{n===e.Disease&&await a.payEnergy(1),await t.add(1,n)},condition:()=>t.hasAdjacentLandWithPiece(n)&&a.energy>=(n===e.Disease?1:0)})))},{orChoice:!1})}}]},vo={name:"Like Calls To Like",type:Sn.Minor,speed:rr.Slow,energy:1,elements:[nr.Sun,nr.Water,nr.Plant],set:a.JaggedEarth,target:ir.Land,range:1,hasPushOrGather:!0,blightWhiteListedPower:!0,effects:[Qn.Explorer,Qn.Town,Qn.Dahan,Qn.Blight,Qn.Beasts].map((e=>({textArea:[.661,.863],text:`If target land has ${Kn[e].text}, Gather up to 1 ${Kn[e].text}.`,[yn.InTargetLand]:async({land:a})=>{a.has(e)&&await a.gatherUpTo(1,e)}})))},Ao={name:"Mesmerized Tranquility",type:Sn.Minor,speed:rr.Fast,energy:0,elements:[nr.Water,nr.Earth,nr.Animal],set:a.JaggedEarth,target:ir.Land,range:0,effects:[{textArea:[.713,.753],text:"Isolate target land.",[yn.InTargetLand]:async({land:e})=>{await e.isolate()}},{textArea:[.769,.809],text:"Each Invader does -1 Damage.",[yn.InTargetLand]:async({$:e,land:a,effect:t})=>{await e.addSubEffectUntilEndOfTurn({[yn.Reminder]:e=>e===a?t.text:void 0,[yn.AdjustDamage]:({piece:e})=>e.isInvader&&e.location===a?-1:0})}}]},Io={name:"Renewing Boon",type:Sn.Minor,speed:rr.Slow,energy:1,elements:[nr.Sun,nr.Earth,nr.Plant],set:a.JaggedEarth,target:ir.Spirit,targetFilter:[ur.Another],effects:[{textArea:[.648,.883],text:"Choose a land where you and target Spirit both have <presence>.<br>In that land: Remove 1 <blight>, and target Spirit may add 1 of their Destroyed <presence>.",[yn.TargetSpirit]:({you:e,spirit:a})=>e.inLandsWhere((e=>e.hasPresenceOf(a))).pickOne((async e=>{await e.removeBlight(),await e.addPresence(a,{destroyed:!0})}))}]};var xo;!function(e){e.Jungles="Jungles",e.Mountains="Mountains",e.Sands="Sands",e.Wetlands="Wetlands"}(xo||(xo={}));const bo={name:"A",set:a.Base,thematic:!1,terrain:[xo.Mountains,xo.Wetlands,xo.Jungles,xo.Sands,xo.Wetlands,xo.Mountains,xo.Sands,xo.Jungles],setupSymbols:[[],[Bn.City,Bn.Dahan],[Bn.Dahan,Bn.Dahan],[Bn.Blight],[],[Bn.Dahan],[Bn.Dahan,Bn.Dahan],[Bn.Town]],adjacency:[[5,4,3,1,8],[8,0,3,2],[8,1,3],[2,1,0,4],[3,0,5,7,6],[7,4,0],[4,7],[6,4,5],[0,1,2]],outerBorders:[[0,0,5,5,7,7,7],[7,7,7,6,6,6,6],[6,4,3,3,2,2,2]]},To={name:"B",set:a.Base,thematic:!1,terrain:[xo.Wetlands,xo.Mountains,xo.Sands,xo.Jungles,xo.Sands,xo.Wetlands,xo.Mountains,xo.Jungles],setupSymbols:[[Bn.Dahan],[Bn.City],[Bn.Dahan,Bn.Dahan],[Bn.Blight],[],[Bn.Town],[Bn.Dahan],[Bn.Dahan,Bn.Dahan]],adjacency:[[5,4,3,1,8],[8,0,3,2],[8,1,3],[2,1,0,4,6],[0,5,6,3],[7,6,4,0],[3,4,5,7],[6,5],[0,1,2]],outerBorders:[[0,5,5,5,7,7,7],[7,7,7,6,6,6,6],[6,3,3,2,2,2,2]]},Eo={name:"C",set:a.Base,thematic:!1,terrain:[xo.Jungles,xo.Sands,xo.Mountains,xo.Jungles,xo.Wetlands,xo.Sands,xo.Mountains,xo.Wetlands],setupSymbols:[[Bn.Dahan],[Bn.City],[Bn.Dahan,Bn.Dahan],[],[Bn.Blight,Bn.Dahan,Bn.Dahan],[Bn.Dahan],[Bn.Town],[]],adjacency:[[5,4,1,8],[8,0,4,3,2],[8,1,3],[2,1,4,6],[0,5,6,3,1],[7,6,4,0],[3,4,5,7],[6,5],[0,1,2]],outerBorders:[[0,0,5,5,7,7,7],[7,7,7,7,6,6,3],[3,3,3,3,2,2,2]]},Po={name:"D",set:a.Base,thematic:!1,terrain:[xo.Wetlands,xo.Jungles,xo.Wetlands,xo.Sands,xo.Mountains,xo.Jungles,xo.Sands,xo.Mountains],setupSymbols:[[Bn.Dahan,Bn.Dahan],[Bn.City,Bn.Dahan],[],[],[Bn.Blight,Bn.Dahan],[],[Bn.Town,Bn.Dahan,Bn.Dahan],[]],adjacency:[[7,6,4,1,8],[8,0,4,3,2],[8,1,3],[2,1,4,5],[0,6,5,3,1],[3,4,6],[5,4,0,7],[6,0],[0,1,2]],outerBorders:[[0,0,0,0,0,0,7],[7,7,7,6,6,6,5],[5,5,3,3,3,2,2]]},So={name:"E",set:a.JaggedEarth,thematic:!1,terrain:[xo.Sands,xo.Mountains,xo.Jungles,xo.Wetlands,xo.Mountains,xo.Sands,xo.Jungles,xo.Wetlands],setupSymbols:[[Bn.Dahan],[Bn.City],[Bn.Dahan,Bn.Dahan],[Bn.Blight],[Bn.Dahan],[],[Bn.Town],[Bn.Dahan,Bn.Dahan]],adjacency:[[6,4,1,8],[8,0,4,2],[8,1,4,3],[2,4,6,5],[0,6,3,2,1],[3,6,7],[7,5,3,4,0],[5,6],[0,1,2]],outerBorders:[[0,0,0,6,6,7,7],[7,7,7,7,7,5,5],[5,3,3,3,2,2,2]]},Oo={name:"F",set:a.JaggedEarth,thematic:!1,terrain:[xo.Sands,xo.Jungles,xo.Wetlands,xo.Mountains,xo.Jungles,xo.Mountains,xo.Wetlands,xo.Sands],setupSymbols:[[Bn.Dahan,Bn.Dahan],[Bn.City],[Bn.Dahan],[Bn.Blight],[Bn.Dahan],[Bn.Dahan,Bn.Dahan],[],[Bn.Town]],adjacency:[[5,4,1,8],[8,0,4,3,2],[8,1,3],[2,1,4,7,6],[0,5,7,3,1],[7,4,0],[3,7],[6,3,4,5],[0,1,2]],outerBorders:[[0,0,0,5,5,5,7],[7,7,7,7,6,6,6],[6,6,3,3,3,2,2]]},Co={name:"G",set:a.HorizonsOfSpiritIsland,thematic:!1,terrain:[xo.Mountains,xo.Wetlands,xo.Sands,xo.Wetlands,xo.Sands,xo.Jungles,xo.Jungles,xo.Mountains],setupSymbols:[[Bn.Dahan,Bn.Dahan],[Bn.City],[Bn.Dahan],[Bn.Dahan],[Bn.Blight],[],[Bn.Dahan,Bn.Dahan],[Bn.Town]],adjacency:[[5,1,8],[8,0,5,4,3,2],[8,1,3],[2,1,4,6],[5,7,6,3,1],[7,4,1,0],[3,4,7],[6,4,5],[0,1,2]],outerBorders:[[0,0,0,5,5,7,7],[7,7,7,7,6,6,6],[6,3,3,2,2,2,2]]},Do={name:"H",set:a.HorizonsOfSpiritIsland,thematic:!1,terrain:[xo.Jungles,xo.Sands,xo.Mountains,xo.Mountains,xo.Jungles,xo.Wetlands,xo.Wetlands,xo.Sands],setupSymbols:[[Bn.Dahan],[Bn.City],[Bn.Dahan],[],[Bn.Blight],[Bn.Dahan,Bn.Dahan],[Bn.Town],[Bn.Dahan,Bn.Dahan]],adjacency:[[7,5,1,8],[8,0,5,4,2],[8,1,4,3],[2,4,6],[1,5,6,3,2],[0,7,6,4,1],[3,4,5,7],[6,5,0],[0,1,2]],outerBorders:[[0,0,0,0,7,7,7],[7,7,6,6,6,6,3],[3,3,3,3,2,2,2]]},Bo={name:"EA",set:a.Base,thematic:!0,terrain:[xo.Jungles,xo.Wetlands,xo.Wetlands,xo.Wetlands,xo.Sands,xo.Mountains,xo.Mountains,xo.Mountains,xo.Wetlands,xo.Wetlands],setupSymbols:[[Bn.Explorer],[Bn.Disease,Bn.Disease,Bn.Town,Bn.Strife],[Bn.Dahan,Bn.Dahan,Bn.Blight,Bn.Disease,Bn.City,Bn.Town,Bn.Strife],[Bn.Explorer,Bn.Dahan,Bn.Dahan,Bn.Dahan],[],[Bn.Badlands],[Bn.Vitality],[Bn.Explorer],[Bn.Dahan,Bn.Dahan],[Bn.Dahan,Bn.Dahan]],adjacency:[[10,1,4,5],[10,2,3,4,0],[6,3,1,10],[2,6,7,8,4,1],[1,3,8,5,0],[0,4,8,9],[7,3,2],[8,3,6],[9,5,4,3,7],[5,8],[2,1,0]],outerBorders:[[0,0,5,5,5,5,9],[9,9,9,8,7,7,6],[6,6,6,2,2,2,2]]},ko={name:"NE",set:a.Base,thematic:!0,terrain:[xo.Sands,xo.Jungles,xo.Jungles,xo.Wetlands,xo.Jungles,xo.Mountains,xo.Mountains,xo.Sands,xo.Wetlands],setupSymbols:[[Bn.City],[Bn.Wilds],[Bn.Dahan],[Bn.Dahan],[Bn.Town],[Bn.Dahan,Bn.Dahan],[Bn.Explorer,Bn.Explorer,Bn.Explorer,Bn.Dahan,Bn.Dahan,Bn.Dahan],[],[Bn.Beasts,Bn.Disease]],adjacency:[[9,1,4],[9,2,4,0],[9,3,6,4,1],[6,2,9],[0,1,2,6,7,8],[6],[5,7,4,2,3],[8,4,6],[4,7],[3,2,1,0]],outerBorders:[[0,0,4,4,8,8,8],[8,8,7,7,6,6,5],[5,5,6,3,3,3,3]]},Lo={name:"NW",set:a.Base,thematic:!0,terrain:[xo.Sands,xo.Sands,xo.Wetlands,xo.Jungles,xo.Mountains,xo.Sands,xo.Wetlands,xo.Mountains,xo.Mountains],setupSymbols:[[Bn.Explorer,Bn.Explorer,Bn.Dahan,Bn.Vitality],[Bn.City],[Bn.Town,Bn.Disease],[],[Bn.Vitality],[Bn.Dahan,Bn.Dahan,Bn.Vitality],[Bn.Dahan,Bn.Badlands],[Bn.Explorer,Bn.Dahan],[Bn.Dahan]],adjacency:[[9,1,4,5],[9,2,3,4,0],[3,1,9],[6,4,1,2],[1,3,6,7,5,0],[0,4,7,8],[7,4,3],[8,5,4,6],[5,7],[2,1,0]],outerBorders:[[0,5,5,8,8,8,8],[8,8,7,6,6,6,6],[6,3,3,2,2,2,2]]},Fo={name:"SE",set:a.JaggedEarth,thematic:!0,terrain:[xo.Jungles,xo.Jungles,xo.Wetlands,xo.Mountains,xo.Jungles,xo.Wetlands,xo.Sands,xo.Mountains,xo.Mountains],setupSymbols:[[Bn.Town,Bn.Dahan,Bn.Dahan],[Bn.Dahan,Bn.Dahan],[Bn.Dahan],[],[Bn.Beasts],[Bn.Town,Bn.Town,Bn.Dahan,Bn.Disease],[Bn.Explorer],[Bn.Blight,Bn.Wilds],[]],adjacency:[[9,1,4,5],[9,2,3,4,0],[3,1,9],[6,4,1,2],[1,3,6,7,5,0],[0,4,7,8],[7,4,3],[8,5,4,6],[5,7],[2,1,0]],outerBorders:[[0,0,5,5,8,8,8],[8,8,7,7,6,6,6],[6,3,3,3,2,2,2]]},Ro={name:"SW",set:a.JaggedEarth,thematic:!0,terrain:[xo.Sands,xo.Wetlands,xo.Sands,xo.Jungles,xo.Jungles,xo.Jungles,xo.Mountains,xo.Mountains,xo.Sands,xo.Jungles],setupSymbols:[[Bn.Beasts],[Bn.Town,Bn.Dahan],[Bn.Dahan,Bn.Blight,Bn.Town,Bn.Strife],[Bn.Explorer,Bn.Town,Bn.Beasts],[Bn.Wilds,Bn.Beasts],[Bn.Explorer,Bn.Badlands],[Bn.Explorer],[Bn.Blight,Bn.Wilds],[],[]],adjacency:[[10,1,3,4],[10,2,3,0],[6,3,1,10],[1,2,6,5,4,0],[0,3,5,9],[3,6,8,9,4],[7,8,5,3,2],[8,6],[9,5,6,7],[4,5,8],[2,1,0]],outerBorders:[[0,0,4,4,4,4,9],[9,9,8,8,7,7,7],[7,7,6,6,2,2,2]]},No={name:"WE",set:a.Base,thematic:!0,terrain:[xo.Jungles,xo.Sands,xo.Sands,xo.Sands,xo.Jungles,xo.Mountains,xo.Wetlands,xo.Jungles,xo.Sands,xo.Mountains],setupSymbols:[[Bn.Town,Bn.Town,Bn.Dahan,Bn.Dahan],[Bn.Town],[Bn.Wilds],[Bn.Beasts],[Bn.Explorer],[Bn.Explorer,Bn.Dahan],[Bn.Dahan,Bn.Dahan],[Bn.Dahan,Bn.Dahan],[Bn.Badlands,Bn.Badlands],[Bn.Beasts]],adjacency:[[10,1,4,6,7,8],[10,2,3,4,0],[3,1,10],[5,4,1,2],[1,3,5,6,0],[6,4,3],[7,0,4,5],[9,8,0,6],[0,7,9],[8,7],[2,1,0]],outerBorders:[[0,0,8,8,9,9,9],[9,9,9,7,6,6,5],[5,5,5,3,3,2,2]]},$o={[e.BalancedA]:bo,[e.BalancedB]:To,[e.BalancedC]:Eo,[e.BalancedD]:Po,[e.BalancedE]:So,[e.BalancedF]:Oo,[e.BalancedG]:Co,[e.BalancedH]:Do,[e.ThematicEA]:Bo,[e.ThematicNE]:ko,[e.ThematicNW]:Lo,[e.ThematicSE]:Fo,[e.ThematicSW]:Ro,[e.ThematicWE]:No};var Wo;!function(e){e.CoastalLands="CoastalLands",e.Jungles="Jungles",e.JunglesAndSands="JunglesAndSands",e.JunglesAndWetlands="JunglesAndWetlands",e.JunglesEscalation="JunglesEscalation",e.Mountains="Mountains",e.MountainsAndJungles="MountainsAndJungles",e.MountainsAndWetlands="MountainsAndWetlands",e.MountainsEscalation="MountainsEscalation",e.Sands="Sands",e.SandsAndMountains="SandsAndMountains",e.SandsAndWetlands="SandsAndWetlands",e.SandsEscalation="SandsEscalation",e.SaltDeposits="SaltDeposits",e.WaveOfImmigration="WaveOfImmigration",e.Wetlands="Wetlands",e.WetlandsEscalation="WetlandsEscalation"}(Wo||(Wo={}));const Mo={[Wo.CoastalLands]:{name:"Coastal Lands",text:"Coastal Lands",stage:2,terrains:[],saltDeposits:!1,coastal:!0,escalation:!1,set:a.Base},[Wo.Jungles]:{name:"Jungles",text:"<jungles>",stage:1,terrains:[xo.Jungles],saltDeposits:!1,coastal:!1,escalation:!1,set:a.Base},[Wo.JunglesAndSands]:{name:"Jungles and Sands",text:"<jungles-sands>",stage:3,terrains:[xo.Jungles,xo.Sands],saltDeposits:!1,coastal:!1,escalation:!1,set:a.Base},[Wo.JunglesAndWetlands]:{name:"Jungles and Wetlands",text:"<jungles-wetlands>",stage:3,terrains:[xo.Jungles,xo.Wetlands],saltDeposits:!1,coastal:!1,escalation:!1,set:a.Base},[Wo.JunglesEscalation]:{name:"Jungles Escalation",text:"<jungles><escalation>",stage:2,terrains:[xo.Jungles],saltDeposits:!1,coastal:!1,escalation:!0,set:a.Base},[Wo.Mountains]:{name:"Mountains",text:"<mountains>",stage:1,terrains:[xo.Mountains],saltDeposits:!1,coastal:!1,escalation:!1,set:a.Base},[Wo.MountainsAndJungles]:{name:"Mountains and Jungles",text:"<mountains-jungles>",stage:3,terrains:[xo.Mountains,xo.Jungles],saltDeposits:!1,coastal:!1,escalation:!1,set:a.Base},[Wo.MountainsAndWetlands]:{name:"Mountains and Wetlands",text:"<mountains-wetlands>",stage:3,terrains:[xo.Mountains,xo.Wetlands],saltDeposits:!1,coastal:!1,escalation:!1,set:a.Base},[Wo.MountainsEscalation]:{name:"Mountains Escalation",text:"<mountains><escalation>",stage:2,terrains:[xo.Mountains],saltDeposits:!1,coastal:!1,escalation:!0,set:a.Base},[Wo.Sands]:{name:"Sands",text:"<sands>",stage:1,terrains:[xo.Sands],saltDeposits:!1,coastal:!1,escalation:!1,set:a.Base},[Wo.SandsAndMountains]:{name:"Sands and Mountains",text:"<mountains-sands>",stage:3,terrains:[xo.Sands,xo.Mountains],saltDeposits:!1,coastal:!1,escalation:!1,set:a.Base},[Wo.SandsAndWetlands]:{name:"Sands and Wetlands",text:"<sands-wetlands>",stage:3,terrains:[xo.Sands,xo.Wetlands],saltDeposits:!1,coastal:!1,escalation:!1,set:a.Base},[Wo.SandsEscalation]:{name:"Sands Escalation",text:"<sands><escalation>",stage:2,terrains:[xo.Sands],saltDeposits:!1,coastal:!1,escalation:!0,set:a.Base},[Wo.SaltDeposits]:{name:"Salt Deposits",text:"Salt Deposits",stage:2,terrains:[],saltDeposits:!0,coastal:!1,escalation:!1,set:a.NatureIncarnate},[Wo.WaveOfImmigration]:{name:"Wave of Immigration",text:"Wave of Immigration",stage:0,terrains:[],saltDeposits:!1,coastal:!1,escalation:!1,set:a.JaggedEarth},[Wo.Wetlands]:{name:"Wetlands",text:"<wetlands>",stage:1,terrains:[xo.Wetlands],saltDeposits:!1,coastal:!1,escalation:!1,set:a.Base},[Wo.WetlandsEscalation]:{name:"Wetlands Escalation",text:"<wetlands><escalation>",stage:2,terrains:[xo.Wetlands],saltDeposits:!1,coastal:!1,escalation:!0,set:a.Base}},Go={[Fr.Bring]:{verb:"Bring"},[Fr.Gather]:{verb:"Gather"},[Fr.Move]:{verb:"Move"},[Fr.Push]:{verb:"Push"},[Fr.Relocate]:{verb:"Relocate"}};var Ho,jo;!function(e){e.AdversaryAction="AdversaryAction",e.BlightCardAction="BlightCardAction",e.DahanEventAction="DahanEventAction",e.ExtraInvaderAction="ExtraInvaderAction",e.FearAction="FearAction",e.GameAction="GameAction",e.MainEventAction="MainEventAction",e.NormalInvaderAction="NormalInvaderAction",e.PowerAction="PowerAction",e.ScenarioAction="ScenarioAction",e.SpiritAction="SpiritAction",e.TokenEventAction="TokenEventAction"}(Ho||(Ho={})),function(e){e.Land="Land",e.Ocean="Ocean",e.EndlessDark="EndlessDark"}(jo||(jo={}));const Uo=(e,a)=>{let t=0;for(let n=0,r=e.length;n<r;n+=1)t+=a(e[n],n);return t},qo=(e,a)=>{let t=Number.MIN_SAFE_INTEGER;for(const n of e){const e=a(n);t=e>t?e:t}return t},_o=(e,a)=>0===e.length?0:e.reduce(((e,t)=>Math.min(e,a(t))),1/0),Jo=(e,a)=>{let t=0;for(const n of e)a(n)&&(t+=1);return t},Vo=(e,a)=>{let t="[";return e.forEach(((e,n)=>{n>0&&(t+=", "),t+=a?a(e):e})),t+="]",t};class Yo{items;$;query;order;constructor(e,a,t=[],n=!1){this.$=e,this.query=a,this.items=[...t],this.order=n}get anyOne(){return this.isEmpty?null:this.items[0]}get count(){return this.items.length}get isEmpty(){return 0===this.count}add(e){return this.items.push(e),this}addAll(e){return this.items.push(...e),this}autoPickOne(e,a){return this.pickOne(e,{...a,autoPlayOneOption:!0})}copy(){return new Yo(this.$,this.query,[...this.items],this.order)}filteredByAllInPriority(...e){for(const a of e){const e=this.items.filter(a);e.length>0&&(this.items=e)}return this}filteredByAnyInPriority(...e){for(const a of e){const e=this.items.filter(a);if(e.length>0)return this.items=e,this}return this}firstOneWhere(e){return this.items.find(e)??null}async forEach(e,a){let t=[...this.items];const n=this.order&&(void 0===a?.autoPlayOneOption||this.itemsInFirstPosition.length>1);if(t.length>0)for(;t.length>0;){const r=n?await this.$.query({query:this.query,items:t,actionIds:t.map((e=>e.serialized)),...a}):0;await e(t[r]),t.splice(r,1),this.query===pn.SelectPiece&&(t=t.filter((e=>null!==e.location)))}else a?.noOptions&&await this.$.clickToContinue(a)}has(e){return this.items.includes(e)}hasAtLeast(e,a){let t=0;for(const n of this.items)if(a(n)&&(t+=1,t>=e))return!0;return t>=e}hasExactlyOneWhere(e,a){return this.numberOf(a)===e}hasNoneWhere(e){return!this.items.some(e)}hasOneWhere(e){return this.items.some(e)}async inDifferent(e,a){0===this.count&&a?.noOptions?await this.$.clickToContinue(a):await e(((e,a)=>this.pickOne((async a=>{await e(a),this.remove(a)}),a)))}maxNumberOf(e){return qo(this.items,e)}minNumberOf(e){return _o(this.items,e)}numberOf(e){return Jo(this.items,e)}async optionallyPickOne(e,a){await this.pickOne(e,a,!0)}async pickMultiple(e){const{amount:a,forPickedItem:t,beforeNextItem:n,where:r,effect:i,optional:s=!1,repeatSame:o=!1,together:d=!1,autoplayIfPickingAll:c=!1}=e;if(r&&this.where(r),0===this.count)i?.noOptions&&await this.$.clickToContinue({...i});else if((void 0===a||a>=this.count)&&c&&!o&&!d)for(;this.count>0;)await t(this.items[0]),this.remove(this.items[0]);else for(let e=0;void 0===a||e<a;e+=1){let c=!1;if(await this.pickOne((async e=>{c=!0,await t(e),o||d||this.remove(e),d&&this.where((a=>a===e)),r&&this.where(r)}),{...i,noOptions:void 0,prompt:`${i?.prompt??this.$.defaultPromptForQueryType(this.query)}${void 0!==a&&a>1?` (${a-e} left.)`:""}`},s),!c||e===a)break;n?.()}}async pickOne(e,a,t=!1){const n=this.itemsInFirstPosition;if(n.length>0)if(t){const t=await this.$.queryOptional({query:this.query,items:n,actionIds:n.map((e=>e.serialized)),...a});null!=t&&await e(n[t])}else{const t=await this.$.query({query:this.query,items:n,actionIds:n.map((e=>e.serialized)),...a});await e(n[t])}else a?.noOptions&&await this.$.clickToContinue(a)}remove(e){return qr(this.items,e),this}removeAllButFirst(){return this.items.length>1&&(this.items.length=1),this}selectOrder(e=!0){return this.order=e,this}sort(e){return this.items.sort(e),this}sum(e){return Uo(this.items,e)}toString(){return Vo(this.items)}where(e){return this.items=this.items.filter(e),this}withLeast(e){const a=_o(this.items,e);return this.where((t=>e(t)===a))}withMost(e){const a=qo(this.items,e);return this.where((t=>e(t)===a))}get itemsInFirstPosition(){let e=this.items;return this.query===pn.SelectPiece&&(e=this.items.filter((e=>e.isTopInStackOfPieces(this.items)))),e}}var zo;!function(e){e.Amorphous="Amorphous",e.DarkFire="DarkFire",e.Deeps="Deeps",e.Encircle="Encircle",e.Enticing="Enticing",e.Foreboding="Foreboding",e.Haven="Haven",e.Immense="Immense",e.Intensify="Intensify",e.Lair="Lair",e.Locus="Locus",e.Madness="Madness",e.Mentor="Mentor",e.Might="Might",e.Nourishing="Nourishing",e.Pandemonium="Pandemonium",e.Reach="Reach",e.Regrowth="Regrowth",e.Resilience="Resilience",e.Sparking="Sparking",e.SpreadingHostility="SpreadingHostility",e.Stranded="Stranded",e.Sunshine="Sunshine",e.Tactician="Tactician",e.Tangles="Tangles",e.Transforming="Transforming",e.Travel="Travel",e.Unconstrained="Unconstrained",e.Violence="Violence",e.Warrior="Warrior",e.Wind="Wind"}(zo||(zo={}));const Qo=Symbol("annotationCache"),Ko=Object.prototype;class Xo{static reactivity=!0;static makeObservable(e){this.reactivity&&mt(e)}static observableClass(e,a){if(this.reactivity){this.makeAutoObservable(e);const t=Object.getOwnPropertyDescriptor(e,"dataStore");if(void 0!==a&&t?.get){const t=`sid-${a}`,n=localStorage.getItem(t);if(n){const a=JSON.parse(n,((e,a)=>"undefined"===a?void 0:a));e.dataStore=a}setTimeout((()=>{Ua((()=>{localStorage.setItem(t,JSON.stringify(dt(e.dataStore),((e,a)=>void 0===a?"undefined":a)))}))}),1)}}}static makeAutoObservable(e){if(this.reactivity){if(it(e))throw new Error("Target must not be observable");let a=e[Qo];if(!a){a={};const t=Object.getPrototypeOf(e);let n=e;for(;n&&n!==Ko;)Reflect.ownKeys(n).forEach((e=>{e!==J&&"constructor"!==e&&"toString"!==e&&(a[e]=!0)})),n=Object.getPrototypeOf(n);t&&t!==Ko&&Object.defineProperty(t,Qo,{value:a})}mt(e,a,{autoBind:!0})}}}var Zo=function(e,a,t,n){var r,i=arguments.length,s=i<3?a:null===n?n=Object.getOwnPropertyDescriptor(a,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,a,t,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(i<3?r(s):i>3?r(a,t,s):r(a,t))||s);return i>3&&s&&Object.defineProperty(a,t,s),s};class ed{baseHealth;baseStrife=0;damage=0;doesNotParticipateInRavage=!1;fightsBeforeInvaders=!1;id;isIncarna;location;marked;piece;positionIndex;scenarioNumber;shadowDamage=0;spiritNumber;$;constructor(e,a,t,n,r){Xo.makeObservable(this),this.$=e,this.id=this.$.generatePieceId(),this.piece=a,this.location=t,this.spiritNumber=r,this.positionIndex=n,this.isIncarna=Kn[Qn.Incarna].pieces.includes(a),this.baseHealth=ed.pieceBaseHealth(this.piece)}get adjustedIndividualInvaderRavageDamage(){return({normal:e,towardsLand:a})=>this.$.sumEffects(yn.AdjustIndividualInvaderRavageDamage,{normal:e,piece:this,towardsLand:a})}get extraHealth(){if(!this.isInvader&&!this.isDahan)return 0;const e=this.$.sumEffects(yn.AdjustHealth,{piece:this});return Math.max(e,1-this.baseHealth)}get fearFromDestruction(){switch(this.piece){case Bn.City:return 2;case Bn.Town:return 1;default:return 0}}get health(){return this.baseHealth+this.extraHealth}get healthSurplus(){return Math.max(this.health-this.totalDamage,0)}get index(){return null===this.location?0:this.location.pieces.filter((e=>e.piece===this.piece)).indexOf(this)}get isAlive(){return this.healthSurplus>0}get isAliveIgnoringHealthBonuses(){return this.totalDamage<this.baseHealth}get isBadlands(){return this.piece===Bn.Badlands||this.mustCountAsBadlands||this.mayCountAsBadlands}get isBeasts(){return this.piece===Bn.Beasts||this.mayCountAsBeast}get isBlight(){return this.piece===Bn.Blight}get isCity(){return this.piece===Bn.City}get isDahan(){return this.piece===Bn.Dahan}get isEmpowered(){return null!=this.owner&&this.owner.hasEmpoweredIncarna}get isExplorer(){return this.piece===Bn.Explorer||this.mayCountAsExplorer}get isInvader(){return this.piece===Bn.Explorer||this.piece===Bn.Town||this.piece===Bn.City||this.piece===Bn.Thief&&this.mayCountAsExplorer}get isPresence(){return this.piece===Bn.Presence||this.isIncarna&&!this.$.action.dontCountAs.has(Bn.Presence)}get isTopInStack(){if(null===this.location&&this.positionIndex>=0)return!1;const e=this.location.piecesByGroup[this.positionIndex];return e[e.length-1]===this}get isTown(){return this.piece===Bn.Town}get mayCountAsBadlands(){return!(this.piece!==Bn.Presence&&!this.isIncarna||!this.owner.presenceMayCountAsBadlandsOrBeasts)||(!(this.piece!==Bn.IncarnaLocus||!this.isEmpowered)||!(this.piece!==Bn.Presence||this.owner.aspect!==zo.SpreadingHostility||!this.isTopInStack||!this.location.hasSacredSiteOf(this.owner)))}get mayCountAsBeast(){return this.piece===Bn.IncarnaDarkness||(!(this.piece!==Bn.Presence&&!this.isIncarna||!this.owner.presenceMayCountAsBadlandsOrBeasts)||!(this.piece!==Bn.Presence||this.owner.spirit!==n.ManyMinds||!this.isTopInStack||!this.location.hasSacredSiteOf(this.owner)))}get mayCountAsExplorer(){return this.piece===Bn.Thief&&void 0!==this.$.action.spirit&&(this.$.action.type===Ho.PowerAction||this.$.action.type===Ho.SpiritAction)}get mustCountAsBadlands(){return!(this.piece!==Bn.Beasts||!this.$.beastsCountAsBadlands)||this.piece===Bn.Blight&&this.$.action.spirit?.spirit===n.Vengeance&&(this.$.action.type===Ho.PowerAction||this.$.action.type===Ho.SpiritAction)}get owner(){return void 0===this.spiritNumber?null:this.$.spirits[this.spiritNumber]}get scenarioNumberVisible(){if(void 0!==this.location){if(this.piece===Bn.Thief)return this.location.numberOfDahan>=2||this.location.isOcean||!!this.$.config.controlledFate;if(this.piece===Bn.HiddenLocation)return void 0!==this.scenarioNumber}return!1}get serialized(){return`${this.piece}-${this.id}`}get strengthDuringRavage(){return this.strength(!0)}get strengthOutOfRavage(){return this.strength(!1)}get strife(){return Math.max(this.baseStrife+(this.$.ignoreOneStrife?-1:0),0)}get targetable(){return!this.$.someEffect(yn.PreventTargetPiece,{piece:this})}get totalDamage(){return this.damage+this.shadowDamage}static createCollection(e,a){return new Yo(e,pn.SelectPiece,a)}static pieceBaseHealth(e){switch(e){case Bn.City:return 3;case Bn.Town:case Bn.Dahan:return 2;case Bn.Explorer:case Bn.Thief:return 1;default:return 0}}async abduct(){await this.move({locations:{target:Jn.ToThisLocation,location:this.$.theEndlessDark}})}async addStrife(e={}){const{amount:a=1,add:t=!0,pieceFilter:n=Qn.Invader}=e;await this.$.waitForAnimationsToFinish(),this.baseStrife+=a,this.placeInGroup(),await this.$.sendEvent({type:fn.StrifeAdded,piece:this,location:this.location,amount:a}),t&&await this.$.doEffects(yn.AfterAddingStrife,{piece:this,amount:a,pieceFilter:n})}areSameGroupAs(e){return e.piece===this.piece&&e.spiritNumber===this.spiritNumber&&e.damage===this.damage&&e.shadowDamage===this.shadowDamage&&e.doesNotParticipateInRavage===this.doesNotParticipateInRavage&&e.fightsBeforeInvaders===this.fightsBeforeInvaders&&e.baseStrife===this.baseStrife&&e.targetable===this.targetable&&e.scenarioNumber===this.scenarioNumber&&e.marked===this.marked&&!this.scenarioNumberVisible}damageOnlyThis(e,a){return this.location.damage(e,a??Qn[this.piece],{filter:void 0===a?e=>e===this:void 0,firstTarget:void 0===a?void 0:this,autoPlayOneOption:!0})}async dealDamageToOtherInvaders(){await this.$.addSubEffect({highlightPieces:[this],[yn.Now]:async()=>{await this.location.damage(this.strengthOutOfRavage,this.$.Invader,{filter:e=>e!==this})}})}destroy(){return this.remove(Nn.DirectDestroy)}async downgrade(){return this.isCity?this.replace([Bn.Town]):this.isTown?this.replace([Bn.Explorer]):this.isExplorer?{removed:await this.remove(),added:[]}:{removed:[],added:[]}}drown(){return this.remove(Nn.Drown)}isA(e){if(Kn[e].pieces.includes(this.piece))return!0;if(!Kn[e].ignoreCountAs){const a=this.$.action.dontCountAs;return Kn[e].pieces.some((e=>{if(a.has(e))return!1;switch(e){case Bn.Presence:return this.isIncarna;case Bn.Beasts:return this.mayCountAsBeast;case Bn.Badlands:return this.mustCountAsBadlands||this.mayCountAsBadlands;case Bn.Explorer:return this.mayCountAsExplorer;default:return!1}}))}return!1}isAPresenceOf(e){return this.isPresence&&this.owner===e}isIgnoringCountAsA(e){return Kn[e].pieces.some((e=>e===this.piece))}isOneOf(...e){return e.some((e=>this.isA(e)))}isOneOfIgnoringCountAs(...e){return e.some((e=>this.isIgnoringCountAsA(e)))}isPieceWithOptionallyCountAs(e){if(Kn[e].pieces.includes(this.piece))return!0;if(!Kn[e].ignoreCountAs){const a=this.$.action.dontCountAs;return Kn[e].pieces.some((e=>{if(a.has(e))return!1;switch(e){case Bn.Presence:return this.isIncarna;case Bn.Beasts:return this.mayCountAsBeast;case Bn.Badlands:return this.mayCountAsBadlands;case Bn.Explorer:return this.mayCountAsExplorer;default:return!1}}))}return!1}isTopInStackOfPieces(e){if(null===this.location||-1===this.positionIndex)return!1;const a=e.filter((e=>e.positionIndex===this.positionIndex)),t=this.location.piecesByGroup[this.positionIndex],n=Math.max(...a.map((e=>t.indexOf(e))));return t.indexOf(this)===n}mark(){return this.marked=!0,Promise.resolve()}move(e={}){return this.location?this.location.move({pieces:Qn[this.piece],piece:this,...e}):Promise.resolve([])}async moveTo(e){const{location:a,movement:t=Fr.Move,pieceFilter:n,withoutWait:r=!1}=e;let i=r;const s=this.location;if(null===s)return;const o=null!=this.owner?s.numberOfPresenceOf(this.owner):0,d=null!=this.owner?a.numberOfPresenceOf(this.owner):0;a!==s&&(await this.$.doEffects(yn.BeforeMoving,{piece:this,source:s,destination:a,pieceFilter:n,movement:t}),i=i||void 0!==this.$.someEffect(yn.MoveWithoutWaiting,{piece:this,source:s,pieceFilter:n})),Ha((()=>{s.removePiece({piece:this,removement:Nn.Silent,pieceFilter:n}),a.pieces.push(this),this.location=a,this.placeInGroup()})),await this.$.sendEvent({type:fn.PieceMoved,piece:this,pieceType:this.piece,fromLocation:s,toLocation:a,movement:t,withoutWait:i}),await s.healthCheck(),await a.healthCheck(),await this.$.doEffectsWithPriority(yn.AfterMoving,{source:s,destination:a,piece:this,movement:t,pieceFilter:n});const c=null!=this.owner?s.numberOfPresenceOf(this.owner):0,l=null!=this.owner?a.numberOfPresenceOf(this.owner):0;o!==c&&this.owner&&await this.$.doEffects(yn.AfterLandChangesAmountOfPresence,{amountBefore:o,amountAfter:c,land:s,spirit:this.owner}),d!==l&&this.owner&&await this.$.doEffects(yn.AfterLandChangesAmountOfPresence,{amountBefore:d,amountAfter:l,land:a,spirit:this.owner})}placeInGroup(){if(this.location.pieces.includes(this)){const e=this.location.groupToBe(this.piece,this.damage,this.shadowDamage,this.baseStrife,this.doesNotParticipateInRavage,this.fightsBeforeInvaders,this.targetable,this.spiritNumber,this.positionIndex,this.scenarioNumber,this.marked);this.location.removePieceFromItsPosition(this),this.location.insertPieceIntoPosition(this,e),this.location.possiblyReorderPieces()}}async possiblyDontCountAs(e){if(this.piece!==e&&this.isPieceWithOptionallyCountAs(Qn[e])){const a=this.piece===Bn.Presence&&this.location.hasSacredSiteOf(this.owner)&&(e===Bn.Beasts&&this.owner.spirit===n.ManyMinds||e===Bn.Badlands&&this.owner.aspect===zo.SpreadingHostility);return await this.$.may({prompt:`Count ${a?"<sacred>":Kn[this.piece].text} as ${Kn[e].text}?`})||this.$.dontCountAs(e),!0}return!1}push(e){return this.move({movement:Fr.Push,...e})}remove(e=Nn.Remove){return this.location?this.location.removePiece({piece:this,removement:e,pieceFilter:Qn[this.piece]}):Promise.resolve([])}async removeStrife(e=1){this.baseStrife=Math.max(this.baseStrife-e,0),await this.$.sendEvent({type:fn.StrifeRemoved,location:this.location,piece:this,amount:e}),this.placeInGroup()}async replace(e,a=Nn.Replace){const t=this.location,n={removed:[],added:[]},r=this.piece;if(await this.$.oneEffectActivates(yn.PreventReplacePiece,{piece:this.piece,location:t,withPieces:e}))return n;if(await this.$.oneEffectActivates(yn.PreventRemovePiece,{piece:this,location:t,removement:Nn.Replace}))return n;if(1===e.length)this.piece===Bn.Presence&&(this.owner.destroyedPresence+=1),this.piece===Bn.Blight&&await this.$.addBlightToBlightCard(1),this.location.removePieceFromItsPosition(this),this.piece=e[0],(r===Bn.Presence||this.isIncarna)&&(this.location.hasPresenceOf(this.owner)||this.owner.removeLand(this.location)),this.baseHealth=ed.pieceBaseHealth(this.piece),n.removed.push({piece:this,location:t,removement:a}),n.added.push({piece:this,location:t}),this.placeInGroup(),this.isInvader||(this.baseStrife=0);else{const r=this.damage,i=this.strife;n.removed=await t.removePiece({piece:this,removement:a,pieceFilter:Qn[this.piece]});for(const a of e)n.added.push(...await t.add(1,Qn[a]));r>0&&await ed.createCollection(this.$,n.added.map((e=>e.piece))).pickMultiple({where:e=>e.isAlive,amount:r,repeatSame:!0,effect:{text:"Reallocate damage to replaced pieces."},forPickedItem:async e=>{await e.takeDamage(1,{mayPrevent:!1})}}),i>0&&await ed.createCollection(this.$,n.added.map((e=>e.piece)).filter((e=>e.isInvader))).pickMultiple({amount:i,repeatSame:!0,effect:{text:"Reallocate <strife> to replaced pieces."},forPickedItem:async e=>{await e.addStrife({add:!1})}})}return await this.$.sendEvent({type:fn.PieceReplaced,piece:this,pieceTypeFrom:r,pieceTypesTo:e,location:t}),n}async setDoesNotParticipateInRavage(e){this.doesNotParticipateInRavage=e,this.placeInGroup(),e&&await this.$.sendEvent({type:fn.DoNotParticipateInRavage,piece:this,location:this.location})}setFightsBeforeInvaders(e){return this.fightsBeforeInvaders=e,this.placeInGroup(),Promise.resolve()}async takeDamage(e,a={}){const{mayPrevent:t=!0,fromBadlands:n=!1}=a,r=[],i=Math.min(e,this.healthSurplus),s=i<=0||t&&await this.$.oneEffectActivates(yn.PreventDamagingPiece,{piece:this,damage:i});return i>0&&this.isInvader&&this.$.setHasAttemptedDamagingInvaderThisInstruction(),s?[]:(await this.$.waitForAnimationsToFinish(),this.damage+=i,await this.$.sendEvent({type:fn.PieceDamaged,amount:e,location:this.location??void 0,piece:this,pieceType:this.piece,fromBadlands:n}),!this.isAlive||!this.isAliveIgnoringHealthBonuses&&this.$.damageIgnoreHealthBonuses?r.push(...await(this.location?this.location.removePiece({piece:this,removement:Nn.DestroyByDamageOrBlight,byDamage:!0,pieceFilter:Qn[this.piece]}):Promise.resolve([]))):this.placeInGroup(),r)}async timePasses(){this.damage>0&&!this.$.someEffect(yn.PreventClearDamage,{piece:this})&&(this.damage=0,await this.$.sendEvent({type:fn.DamageCleared,location:this.location??void 0,piece:this}),this.placeInGroup())}toString(){return`${Bn[this.piece]}[${this.damage}]`}upgrade(){return this.isTown?this.replace([Bn.City]):this.isExplorer?this.replace([Bn.Town]):Promise.resolve({removed:[],added:[]})}get adjustedStrength(){return this.$.sumEffects(yn.AdjustDamage,{piece:this})}get adjustedStrengthDuringRavage(){return this.$.sumEffects(yn.AdjustDamageDuringRavage,{piece:this})}get strength(){return e=>(e=>{switch(this.piece){case Bn.City:return 3;case Bn.Town:case Bn.Dahan:return 2;case Bn.Explorer:return 1;default:return 0}})()+this.adjustedStrength+(e?this.adjustedStrengthDuringRavage:0)}}Zo([Re],ed.prototype,"baseStrife",void 0),Zo([Re],ed.prototype,"damage",void 0),Zo([Re],ed.prototype,"doesNotParticipateInRavage",void 0),Zo([Re],ed.prototype,"fightsBeforeInvaders",void 0),Zo([Re],ed.prototype,"id",void 0),Zo([Re],ed.prototype,"location",void 0),Zo([Re],ed.prototype,"marked",void 0),Zo([Re],ed.prototype,"piece",void 0),Zo([Re],ed.prototype,"positionIndex",void 0),Zo([Re],ed.prototype,"scenarioNumber",void 0),Zo([Re],ed.prototype,"shadowDamage",void 0),Zo([Re],ed.prototype,"spiritNumber",void 0),Zo([Ma],ed.prototype,"placeInGroup",null);class ad{board;boardIndex;locations;position;boardDistance=[];destroyed=!1;$;constructor(e,a,t,n,r,i){const s=$o[i];this.$=e,this.boardIndex=a,this.board=i,this.position={x:t,y:n,r},this.locations=s.adjacency.map(((t,n)=>new id({$:e,boardIndex:a,board:this,landIndex:n,type:n===s.adjacency.length-1?jo.Ocean:jo.Land})))}get corners(){return this.$.corners.filter((e=>e.board===this))}get data(){return $o[this.board]}get existingLocations(){return(this.$.someBoardsHasExtraLocations?this.locations.concat(this.extraLocations):this.locations).filter((e=>e.exists))}get extraLocations(){const e=[],a=this.$.effectsMappedWithFilter(yn.BoardHasExtraLocation,{board:this});for(const t of a)e.includes(t)||e.push(t);return e}get ignoreInvaderAndBlightInSetup(){return this.$.boardCount>this.$.spiritCount&&(this.$.phase===Wi.Setup||this.$.phase===Wi.RoyalBacking||this.$.phase===Wi.InitialExplore)&&void 0===this.$.config.boards[this.boardIndex].spirit}get lands(){return this.existingLocations.filter((e=>e.isLand))}get landsExcludingExtraLocations(){return this.locations.filter((e=>e.exists&&e.isLand))}get landsOrderedByHighestNumber(){return this.lands.sort(((e,a)=>Math.max(...a.landNumbers)-Math.max(...e.landNumbers)))}get landsOrderedByLowestNumber(){return this.lands.sort(((e,a)=>Math.min(...e.landNumbers)-Math.min(...a.landNumbers)))}get name(){return this.data.name}get numberOfBlight(){return Uo(this.existingLocations,(e=>Jo(e.pieces,(e=>e.isBlight))))}get ocean(){return this.existingLocations.find((e=>e.isOcean))}get pieces(){const e=[];return this.existingLocations.forEach((a=>{e.push(...a.pieces)})),e.sort(((e,a)=>e.id-a.id)),e}get preventAdversaryActions(){return this.$.someEffect(yn.PreventAdversaryActionOnBoard,{board:this})}get serialized(){return this.board}static createCollection(e,a){return new Yo(e,pn.SelectBoard,a)}addPresence(e,a){return e.addPresence({locations:Jn.AnyLands,filter:e=>(void 0===a?.filter||a.filter(e))&&e.board===this,...a})}async addRandomBoard(){const e=await this.$.randomFreePositionFromBoard(this);if(null===e)return null;const a=await this.$.addBoard(e);return this.$.invalidateBoardCache(),this.$.setupAdjacencies(),this.$.setupCorners(),a}async destroy(){const e={board:this,removement:Nn.DirectDestroy};if(await this.$.oneEffectActivates(yn.PreventRemoveBoard,e))return[];this.destroyed=!0;for(const e of this.locations)e.exists=!1;return this.$.invalidateBoardCache(),this.$.migrateCornerCornersFromBoard(this),this.$.setupAdjacencies(),this.$.setupCorners(),await this.$.sendEvent({type:fn.BoardRemoved,board:e.board,removement:e.removement}),[e]}async destroyPresence(e){await this.forPieces().where((e=>e.isPresence)).pickMultiple({amount:e,forPickedItem:async e=>{await e.destroy()},effect:{prompt:"Pick <presence> to destroy."}})}firstLandWhere(e){return this.lands.find(e)??null}forPieces(){return ed.createCollection(this.$,this.pieces)}forPiecesThatIs(e,a){return this.forPieces().where((t=>t.isA(e)&&(void 0===a||a(t.location))))}forPiecesWhere(e){return this.forPieces().where(e)}hasOneLandWhere(e){return this.lands.some(e)}hasOneLandWith(e){return this.hasOneLandWhere((a=>a.has(e)))}hasOneLocationWhere(e){return this.existingLocations.some(e)}highestNumberedLand(e=(()=>!0)){return this.landsOrderedByHighestNumber.find(e)}highestNumberedLandMatching(e,a){return this.landsOrderedByHighestNumber.find((t=>t.matchesInvaderCard(e,a)))}highestNumberedTerrain(e){return this.highestNumberedLand((a=>a.hasTerrain(e)))}inCoastalLands(){return this.inLandsWhere((e=>e.isCoastal))}inCoastalLocations(){return this.inLocationsWhere((e=>e.isCoastal))}inCornerLands(){return this.inLocationsWhere((e=>e.isCornerLand))}inInlandLands(){return this.inLandsWhere((e=>e.isInland))}inJungles(){return this.inLandsWhere((e=>e.isJungle))}inLandNumber(e){return this.firstLandWhere((a=>a.hasNumber(e)))}inLands(){return id.createCollection(this.$,this.lands)}inLandsFilteredByAllInPriority(...e){return this.inLands().filteredByAllInPriority(...e)}inLandsFilteredByAnyInPriority(...e){return this.inLands().filteredByAnyInPriority(...e)}inLandsWhere(e){return this.inLands().where(e)}inLandsWith(e){return this.inLands().where((a=>a.has(e)))}inLandsWithAllOf(...e){return this.inLands().where((a=>a.hasAllOf(...e)))}inLandsWithLeast(e){return this.inLands().withLeast(e)}inLandsWithMost(e){return this.inLands().withMost(e)}inLandsWithMostMinimumOne(e){return this.inLandsWith(e).withMost((a=>a.numberOf(e)))}inLandsWithNoneOf(...e){return this.inLands().where((a=>!a.hasOneOf(...e)))}inLandsWithOneOf(...e){return this.inLands().where((a=>a.hasOneOf(...e)))}inLandsWithOrAdjacentTo(e){return this.inLandsWhere((a=>a.hasOrIsAdjacentToLandsWith(e)))}inLandsWithStrife(){return this.inLands().where((e=>e.hasStrife))}inLandsWithout(e){return this.inLands().where((a=>a.doesntHave(e)))}inLocations(){return id.createCollection(this.$,this.existingLocations)}inLocationsWhere(e){return this.inLocations().where(e)}inLocationsWith(e){return this.inLocations().where((a=>a.has(e)))}inLocationsWithOrAdjacentTo(e){return this.inLocationsWhere((a=>a.hasOrIsAdjacentToLocationsWith(e)))}inMountains(){return this.inLandsWhere((e=>e.isMountains))}inSands(){return this.inLandsWhere((e=>e.isSands))}inWetlands(){return this.inLandsWhere((e=>e.isWetlands))}lowestNumberedLand(e=(()=>!0)){return this.landsOrderedByLowestNumber.find(e)}lowestNumberedLandMatching(e,a){return this.landsOrderedByLowestNumber.find((t=>t.matchesInvaderCard(e,a)))}lowestNumberedTerrain(e){return this.lowestNumberedLand((a=>a.hasTerrain(e)))}numberOf(e){return Uo(this.existingLocations,(a=>a.numberOf(e)))}presence(){return this.forPieces().where((e=>e.isPresence))}spiritsWithPresence(){return this.$.spiritsWhich((e=>this.hasOneLocationWhere((a=>a.hasPresenceOf(e)))))}toString(){return`${$o[this.board].name}: ${this.locations}`}}const td=(e,a)=>{if(!e.length)return-1;if(!a)return e.length-1;for(let t=e.length-1;t>=0;t-=1)if(a(e[t],t))return t;return-1},nd=(...e)=>{const a={Sun:0,Moon:0,Fire:0,Air:0,Water:0,Earth:0,Plant:0,Animal:0,Any:0,SunOrMoon:0,WaterOrAnimal:0,FireOrPlant:0,DarkFire:0};return e.forEach((e=>{Object.keys(e).forEach((t=>{a[t]+=e[t]}))})),a};var rd=function(e,a,t,n){var r,i=arguments.length,s=i<3?a:null===n?n=Object.getOwnPropertyDescriptor(a,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,a,t,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(i<3?r(s):i>3?r(a,t,s):r(a,t))||s);return i>3&&s&&Object.defineProperty(a,t,s),s};class id{adjacentLocations;board;boardData;boardIndex;landIndex;locationsWithinBase=[];pieces;piecesByGroup=[];type;exists;$;constructor({$:e,boardIndex:a,board:t,landIndex:n,type:r}){Xo.makeObservable(this),this.$=e,this.type=r,this.exists=this.type!==jo.EndlessDark||this.$.theEndlessDarkExists,this.pieces=[],this.adjacentLocations=[],this.boardIndex=a,this.landIndex=n,this.board=t,this.boardData=null!==this.board?$o[this.board.board]:null}get adjacentLands(){return this.adjacentLocations.filter((e=>e.isLand))}get blightAlwaysCascades(){return this.$.someEffect(yn.BlightAlwaysCascadesInLand,{land:this})}get buildCardsAffectLandsWithoutInvaders(){return this.$.someEffect(yn.BuildCardsAffectLandsWithoutInvaders,{land:this})}get buildPlans(){const e=this.$.resultFromFirstEffectOfType(yn.AdjustBuildPlans,{land:this});return e||(Jo(this.pieces,(e=>e.isTown))>Jo(this.pieces,(e=>e.isCity))?Qn.City:Qn.Town)}get coordinate(){return null!==this.boardData?`${this.boardData.name}${this.landNumber}`:"TED"}get coordinateLink(){return this.isTheEndlessDark?"<endless-dark>":this.isOcean?"The Ocean":`${this.terrainIcon}<l>${this.boardData.name}${this.landNumber}</l>`}get corners(){return this.$.corners.filter((e=>e.inAdjacentLocations().has(this)))}get dahanFightSimultaneously(){return this.$.someEffect(yn.DahanFightSimultaneously,{land:this})}get defense(){if(!this.isLand)return 0;return this.$.sumEffects(yn.DefendFromSpirits,{land:this})+this.$.sumEffects(yn.DefendFromGame,{land:this})}get defenseSource(){const e=this.$.firstEffectOfType(yn.DefendFromSpirits,{land:this});return e?.spirit}get distanceToNearestOcean(){for(let e=0;e<this.locationsWithinBase.length;e+=1)if(this.locationsWithinBase[e].some((e=>e.isOcean)))return e;return 999}get distanceToThisBoardsOcean(){for(let e=0;e<this.locationsWithinBase.length;e+=1)if(this.locationsWithinBase[e].some((e=>e.isOcean&&e.board===this.board)))return e;return 999}get elements(){const e=[];return this.corners.forEach((a=>{a.element&&e.push({[a.element]:1})})),nd(...e)}get explorersFightWithDahan(){return this.$.someEffect(yn.ExplorersFightWithDahan,{land:this})}get hasBlight(){return this.pieces.some((e=>e.isBlight))}get hasCity(){return this.pieces.some((e=>e.isCity))}get hasDahan(){return this.pieces.some((e=>e.isDahan))}get hasExploringSource(){const e=this.$.exploreDistance;let a=this.inLocationsWithin(1,null).hasOneWhere((e=>e.isExploringSource));return a||2!==e||(a=this.hasAdjacentLocationWhere((e=>!e.isIsolated&&e.hasAdjacentLocationWhere((e=>e.isExploringSource))))),!(this.$.phase===Wi.InitialExplore&&this.$.boardCount>this.$.spiritCount&&void 0===this.$.config.boards[this.boardIndex].spirit&&1===this.$.spiritCount)&&a}get hasInvaders(){return this.pieces.some((e=>e.isInvader))}get hasPresenceFromTwoDifferentSpirits(){const e=this.pieces.map((e=>e.spiritNumber)).filter((e=>void 0!==e));return Cr(e).length>1}get hasSacredSite(){return this.$.spirits.some((e=>this.hasSacredSiteOf(e)))}get hasSetupSymbols(){return this.setupSymbols.length>0}get hasSomeTerrain(){return this.isSandsOrWetlands||this.isMountainsOrJungles}get hasStrife(){return this.pieces.some((e=>e.strife>0))}get hasTownsOrCities(){return this.pieces.some((e=>e.isTown||e.isCity))}get isCoastal(){return this.isOcean||this.adjacentLocations.some((e=>e.isOcean))}get isCornerLand(){return this.type!==jo.Ocean&&(this.isWestern&&this.isSouthern||this.isSouthern&&this.isEastern||this.isEastern&&this.isNorthern||this.isNorthern&&this.isWestern)&&"NE7"!==this.coordinate}get isCornerLandOrNumberOne(){return this.isCornerLand||1===this.landNumber}get isEastern(){return this.boardData?.outerBorders[1].includes(this.landIndex)??!1}get isEndlessDark(){return this.type===jo.EndlessDark}get isExploringSource(){return!this.isIsolated&&!this.$.someEffect(yn.PreventExploreSourceInLand,{land:this})&&(this.isOcean||this.hasTownsOrCities||this.$.someEffect(yn.LandIsExploringSource,{land:this}))}get isFlooded(){return this.$.someEffect(yn.Flooded,{location:this})}get isInland(){return!this.isCoastal&&!this.isOcean}get isIsolated(){return this.$.someEffect(yn.Isolated,{land:this})}get isJungle(){return this.hasTerrain(xo.Jungles)}get isJungleOrSands(){return this.isJungle||this.isSands}get isJungleOrWetlands(){return this.isJungle||this.isWetlands}get isLand(){return this.type===jo.Land||this.isOceanAndLand||this.isTheEndlessDarkAndLand}get isLandForBlight(){return this.isLand||this.isOcean&&this.oceanIsLandForBlightOnThisBoard}get isMiningLand(){return this.hasAtLeast(3,this.$.Invader)}get isMountains(){return this.hasTerrain(xo.Mountains)}get isMountainsOrJungles(){return this.isMountains||this.isJungle}get isMountainsOrSands(){return this.isMountains||this.isSands}get isMountainsOrWetlands(){return this.isMountains||this.isWetlands}get isNorthern(){return!this.$.config.thematic&&null!==this.boardData&&this.landIndex===this.boardData.adjacency.length-1||null!==this.boardData&&this.boardData.outerBorders[this.$.config.thematic?2:0].includes(this.landIndex)}get isOcean(){return this.type===jo.Ocean||this.$.someNonOceanIsOcean&&this.$.someEffect(yn.LocationIsOcean,{location:this})}get isOceanAndLand(){return this.isOcean&&(this.$.oceanIsAllowedForBlight||this.$.someEffectMakesOceanALand&&this.$.someEffect(yn.OceanIsLand,{location:this}))}get isSands(){return this.hasTerrain(xo.Sands)}get isSandsOrWetlands(){return this.isSands||this.isWetlands}get isSouthern(){return!(!this.$.config.thematic||null===this.boardData||this.landIndex!==this.boardData.adjacency.length-1)||null!==this.boardData&&this.boardData.outerBorders[this.$.config.thematic?0:2].includes(this.landIndex)}get isTheEndlessDark(){return this.type===jo.EndlessDark}get isTheEndlessDarkAndLand(){return this.isTheEndlessDark&&(this.$.action.type===Ho.FearAction||this.$.action.type===Ho.TokenEventAction)}get isWestern(){return null!==this.boardData&&this.landIndex===this.boardData.adjacency.length-1||null!==this.boardData&&this.boardData.outerBorders[2][this.boardData.outerBorders[2].length-1]===this.landIndex}get isWetlands(){return this.hasTerrain(xo.Wetlands)}get landNumber(){return this.landIndex+1}get landNumbers(){return[this.landNumber,...this.$.effectsMappedWithFilter(yn.ExtraLandNumber,{location:this})]}get numberOfBlight(){return Jo(this.pieces,(e=>e.isBlight))}get numberOfBuildings(){return Jo(this.pieces,(e=>e.isTown||e.isCity))}get numberOfDahan(){return Jo(this.pieces,(e=>e.isDahan))}get numberOfInvaders(){return Jo(this.pieces,(e=>e.isInvader))}get numberOfParticipatingDahan(){return Jo(this.pieces,(e=>e.isDahan&&!e.doesNotParticipateInRavage))}get numberOfSacredSites(){return Jo(this.$.spirits,(e=>this.hasSacredSiteOf(e)))}get numberOfStrife(){return Uo(this.pieces,(e=>e.strife))}get oceanIsLandForBlightOnThisBoard(){return this.$.oceanIsLandForBlight(this)}get reminderEffects(){return this.$.reminderEffects.map((e=>this.isLand&&void 0!==e[yn.DefendFromGame]?e[yn.DefendFromGame]({land:this})>0&&this.defense>0?[e.text,e.spirit]:void 0:this.isLand&&void 0!==e[yn.DefendFromSpirits]?e[yn.DefendFromSpirits]({land:this})>0&&this.defense>0?[e.text,e.spirit]:void 0:void 0!==e[yn.Reminder]?[e[yn.Reminder](this),e.spirit]:void 0)).filter((e=>void 0!==e&&void 0!==e[0]))}get reminderSpirit(){const e=this.reminderEffects.find((([,e])=>void 0!==e));return e?.[1]}get reminders(){return this.reminderEffects.map((([e])=>e))}get serialized(){return this.coordinate}get setupSymbols(){return this.landIndex>=0&&this.landIndex<this.boardData.setupSymbols.length?this.boardData.setupSymbols[this.landIndex]:[]}get sumAdjustedCollectiveDahanRavageDamage(){return this.$.sumEffects(yn.AdjustCollectiveDahanRavageDamage,{land:this})}get targetingIsPrevented(){return this.$.someEffect(yn.PreventTargetLand,{land:this})}get terrain(){return this.landIndex>=0&&this.landIndex<this.boardData.terrain.length?this.boardData.terrain[this.landIndex]:null}get terrainIcon(){switch(this.terrain){case xo.Jungles:return"<jungles>";case xo.Mountains:return"<mountains>";case xo.Sands:return"<sands>";case xo.Wetlands:return"<wetlands>";default:return""}}get the(){return e=>({outnumber:a=>this.numberOf(e)>this.numberOf(a),isAtLeastAsManyAs:a=>this.numberOf(e)>=this.numberOf(a)})}static createCollection(e,a){return new Yo(e,pn.SelectLand,a)}abduct(e,a=Qn.Invader,t){return this.move({amount:e,pieces:a,locations:{target:Jn.ToThisLocation,location:this.$.theEndlessDark},...t})}async add(e,a,t){const n=Kn[a],r=[];if(n.pieces.length>1)await _r(e,(async()=>{await this.$.chooseBetween({autoPlayOneOption:!0,prompt:"Select piece to add",effects:n.pieces.map((e=>({actionId:e,label:Kn[e].text,[yn.Now]:async()=>{e===Bn.Strife?await this.addStrife(1,t):r.push(...await this.createPiece(1,e))}})))})}));else{if(n.pieces[0]!==Bn.Strife)return this.createPiece(e,n.pieces[0]);await this.addStrife(e)}return r}async addBlight(e,a={}){const{mayCascade:t=!0,isCascade:n=!1,fromRavage:r=!1}=a,i=[];if(await this.$.oneEffectActivates(yn.PreventAddBlight,{location:this}))return i;const s=Math.min(e,this.numberOf(this.$.Vitality)),o=e-s;if(await this.$.addSubEffect({text:`${s} <blight> in land ${this.coordinateLink} is prevented by ${s} <vitality>.`,[yn.Now]:async()=>{await this.remove({amount:s,pieces:this.$.Vitality})}}),this.$.blightOnBlightCard>0&&o>0){await this.$.removeBlightFromBlightCard(o,this);const e=this.numberOfBlight;await this.add(o,this.$.Blight);for(let e=0;e<o;e+=1)i.push(this);if(!this.isTheEndlessDark)for(const e of this.$.spirits)this.blightIsPreventedFromDestroyingPresenceOf(e)||(await this.possiblyDontCountPiecesAs(Bn.Presence,e),await this.remove({pieces:Qn.Presence,owner:e,removement:Nn.DestroyByDamageOrBlight}));await this.$.doEffects(yn.WhenAddingBlight,{land:this,blightedLands:i,isCascade:n,fromRavage:r}),(e>0||this.blightAlwaysCascades)&&this.hasAtLeast(e+1,this.$.Blight)&&t&&(await this.$.oneEffectActivates(yn.PreventCascade,{location:this,fromRavage:r})||(await this.$.sendEvent({type:fn.Cascade,location:this}),i.push(...await this.cascade({fromRavage:r}))))}return i}addIncarna(e,a){return this.createPiece(1,e,a.spiritNumber)}addPresence(e,a){return e.addPresence({locations:Jn.AnyLands,filter:e=>e===this,autoPlayOneOption:!0,...a})}async addStrife(e,a=Qn.Invader,t=!1){const n=[];return await this.piecesThatAre(a).pickMultiple({amount:e,optional:t,forPickedItem:async e=>{n.push(e),await e.addStrife({pieceFilter:a})},repeatSame:!0,effect:{prompt:`Pick one ${Kn[a].text} to add <strife>.`,highlightLocations:[this]}}),n}adjacentLandsSortedByNorthernmost(){return this.inAdjacentLands().sort(((e,a)=>{if(this.board===e.board&&this.board===a.board)return this.boardData.adjacency[this.landIndex].indexOf(e.landIndex)<this.boardData.adjacency[this.landIndex].indexOf(a.landIndex)?-1:1;if(this.board===e.board&&this.board!==a.board)return this.isNorthern?1:-1;if(this.board===a.board&&this.board!==e.board)return this.isNorthern?-1:1;if(this.board!==e.board&&this.board!==a.board){if(this.isNorthern){const t=this.$.config.thematic?0:2,n=this.$.config.thematic?-1:1;return e.boardData.outerBorders[t].indexOf(e.landIndex)<a.boardData.outerBorders[t].indexOf(a.landIndex)?n:-n}if(this.isSouthern){const t=this.$.config.thematic?2:0,n=this.$.config.thematic?1:-1;return e.boardData.outerBorders[t].indexOf(e.landIndex)>a.boardData.outerBorders[t].indexOf(a.landIndex)?-n:n}}return 0}))}adjacentPiecesInLandsWhere(e){return this.piecesInAdjacentLands().where(e)}adjacentPiecesInLocations(){const e=[];return this.adjacentLocations.forEach((a=>e.push(...a.pieces))),ed.createCollection(this.$,e)}adjacentPiecesInLocationsWhere(e){return this.adjacentPiecesInLocations().where(e)}afterPiecesAreAddedOrMovedAddTrigger(e){return this.$.afterPiecesAreAddedOrMovedAddTrigger({...e,reminder:!0,locationFilter:e=>e===this})}blightIsPreventedFromDestroyingPresenceOf(e){return this.$.someEffect(yn.PreventBlightDestroyingPresence,{location:this,spirit:e})}boards(){const e=null!==this.board?[this.board]:[];return e.push(...this.$.effectsMappedWithFilter(yn.ExtraBoard,{location:this})),ad.createCollection(this.$,e)}boardsHasPresenceOf(e){return this.boards().hasOneWhere((a=>a.hasOneLocationWhere((a=>a.hasPresenceOf(e)))))}async calculateDoNotParticipateInRavage(){await this.$.doEffects(yn.DoesNotParticipateInRavage,{location:this})}async cascade(e={}){const a=[];return await this.inAdjacentLocations().where((e=>e.isLandForBlight)).pickOne((async t=>{a.push(...await t.addBlight(1,{fromRavage:e.fromRavage??!1,isCascade:!0}))}),{prompt:`Blight cascades in ${this.coordinate}!<br>Add a <blight> to one adjacent land.`,noOptions:"No adjacent land to cascade into.",highlightLocations:[this]}),a}async createPiece(e,a,t){const n=this.groupToBe(a,0,0,0,!1,!1,!0,t),r=[];return await _r(e,(async()=>{await this.$.waitForAnimationsToFinish();const e=new ed(this.$,a,this,n,t),i=void 0!==t?this.numberOfPresenceOf(this.$.spirits[t]):0;if(!await this.$.oneEffectActivates(yn.PreventAddPiece,{piece:a,location:this})){this.pieces.push(e),this.insertPieceIntoPosition(e,n),r.push({piece:e,location:this}),await this.$.sendEvent({type:fn.PieceAdded,piece:e,pieceType:e.piece,location:this}),this.$.phase!==Wi.Setup&&this.$.phase!==Wi.SetupPresence&&await this.$.doEffects(yn.AfterAddingPiece,{land:this,additions:r});const a=void 0!==t?this.numberOfPresenceOf(this.$.spirits[t]):0;i!==a&&await this.$.doEffects(yn.AfterLandChangesAmountOfPresence,{amountBefore:i,amountAfter:a,land:this,spirit:this.$.spirits[t]})}})),r}damage(e,a,t={}){return this.$.doInstruction((async()=>{if(e<=0)return[];const{efficiently:n=!1,maxTargets:r,autoPlayOneOption:i=!1}=t,s=e=>(!t.filter||t.filter(e))&&(a?e.isA(a):e.isInvader),o=a??Qn.Invader,d={mustBe:t.firstTarget},c=[];let l=e;const h=n||o===Qn.Dahan&&this.$.currentActionType!==Ho.SpiritAction&&this.$.currentActionType!==Ho.PowerAction,u=[];for(;l>=0;){let e=!1;const a=this.piecesWhere((e=>(void 0===d.mustBe||d.mustBe===e)&&s(e)&&e.targetable&&(void 0===r||u.includes(e)||u.length<r)));if(a.isEmpty)break;if(0===l&&u.some((e=>e.isDahan))){let e=0;for(;;){const a=this.piecesWhere((e=>e.isBadlands&&!this.$.action.data.usedBadlandsForDahan?.includes(e)));if(a.isEmpty)break;{e+=1,void 0===this.$.action.data.usedBadlandsForDahan&&(this.$.action.data.usedBadlandsForDahan=[]);const t=a.anyOne;t&&this.$.action.data.usedBadlandsForDahan.push(t)}}if(e>0)for(await this.$.sendEvent({type:fn.GenericSub,text:`<badlands> increase damage done to <dahan> by ${e}.`});e>0;){const t=a.copy().where((e=>e.isDahan&&e.isAlive)).withLeast((e=>e.healthSurplus));await t.pickOne((async e=>{u.push(e),c.push(...await e.takeDamage(1))}),{autoPlayOneOption:i,text:`<badlands> increase damage done to <dahan> by ${e}.`,prompt:`Pick one <dahan> to damage. ${e} Damage left.`,highlightLocations:[this]}),e-=1}}if(0===l&&this.$.currentActionType===Ho.PowerAction&&await this.$.doEffects(yn.DamageBoost,{spirit:this.$.action.spirit,filter:o,onUse:async()=>{let e=!1;const t=this.$.currentStackEffect.name;return await a.optionallyPickOne((async a=>{e=!0,u.push(a),c.push(...await a.takeDamage(1))}),{prompt:`Do 1 additional damage to ${Kn[o].text} from ${t}?`,highlightLocations:[this]}),e}}),0===l&&u.some((e=>e.isInvader))){const t=this.piecesWhere((e=>e.isBadlands&&!this.$.action.data.usedBadlands?.includes(e)));if(!t.isEmpty){const n=a.copy().where((e=>e.isInvader));await n.optionallyPickOne((async a=>{e=!0,u.push(a),c.push(...await a.takeDamage(1,{fromBadlands:!0})),void 0===this.$.action.data.usedBadlands&&(this.$.action.data.usedBadlands=[]);const n=t.anyOne;n&&this.$.action.data.usedBadlands.push(n)}),{prompt:`Do 1 additional damage to ${Kn[o===Qn.InvaderOrDahan?Qn.Invader:o].text} from <badlands>?`,highlightLocations:[this]})}}if(!e){if(0===l)break;if(h){const e=a.copy().where((e=>e.isDahan)).withLeast((e=>e.healthSurplus)),t=a.copy().where((e=>e.isInvader)).withLeast((e=>e.healthSurplus));a.where((a=>e.has(a)||t.has(a)))}const e=a.hasOneWhere((e=>e.isInvader))?Kn[o].text:Kn[this.$.Dahan].text;await a.pickOne((async e=>{u.push(e),c.push(...await e.takeDamage(1)),d.mustBe=void 0}),{autoPlayOneOption:i,prompt:`Pick one ${e} to damage. ${l} Damage left.`,highlightLocations:[this]}),l-=1}}return c}))}async damageDifferent(e,a=Qn.Invader){const t=[];return await this.piecesThatAre(a).pickMultiple({amount:e,repeatSame:!1,forPickedItem:async e=>{t.push(...await e.damageOnlyThis(1))},effect:{prompt:`Pick a different ${Kn[a].text}.`}}),t}damageEach(e,a=Qn.Invader){return this.$.doInstruction((async()=>{const t=[],n=this.piecesWhere((e=>e.isA(a)));return this.$.orderOfRemoveAllMightMatter&&n.selectOrder(),await n.forEach((async a=>{a.isAlive&&t.push(...await a.damageOnlyThis(e))})),t}))}damageInAdjacentLands(e,a=this.$.Invader){return this.$.doInstruction((async()=>{await this.piecesInAdjacentLands().where((e=>e.isA(a))).pickMultiple({repeatSame:!0,amount:e,where:e=>null!==e.location&&e.location.isAdjacentTo(this),forPickedItem:async e=>{await e.damageOnlyThis(1,a)},effect:{prompt:"Pick Invader to damage."}})}))}damageInThisAndAdjacentLands(e,a=this.$.Invader){return this.$.doInstruction((async()=>{await this.piecesInThisAndAdjacentLands().where((e=>e.isA(a))).pickMultiple({repeatSame:!0,amount:e,forPickedItem:async e=>{await e.damageOnlyThis(1,a)},effect:{prompt:"Pick Invader to damage."}})}))}async damageLand(e){const a=Math.max(2+this.adjustedLandHealth,1);if(e>=a){const t=1+this.$.sumEffects(yn.ExtraBlightFromDamage,{damageExceedingHealth:e-a}),n=await this.addBlight(t,{fromRavage:!0});await this.$.doEffects(yn.AfterRavagingDamageLand,{land:this,blightedLands:n,damageToLand:e,damageExceedingHealth:e-a})}}async defend(e,a={}){const{reminder:t=!0,singleLand:n=!0}=a,r=this.$.action.type===Ho.PowerAction||this.$.action.type===Ho.SpiritAction?this.$.action.spirit:null;await this.$.waitForAnimationsToFinish();const i=t?this.$.currentStackEffect.text:void 0;null===r?(await this.$.addSubEffectUntilEndOfTurn({text:`Defend ${e}.`,[yn.DefendFromGame]:({land:a})=>a===this?e:0,[yn.Reminder]:e=>e===this?i:void 0}),await this.$.sendEvent({type:fn.DefendAdded,location:this,amount:e})):(await this.$.oneEffectActivates(yn.ExtraDefense,{location:this})&&(e+=2),await this.$.addSubEffectUntilEndOfTurn({text:`Defend ${e}.`,[yn.DefendFromSpirits]:({land:a})=>a===this?e:0,[yn.Reminder]:e=>e===this?i:void 0}),await this.$.sendEvent({type:fn.DefendAdded,location:this,amount:e}),await this.$.doEffects(yn.AfterPowerAddsDefense,{land:this,spirit:r,singleLand:n}))}destroy(e){return this.remove({...e,removement:Nn.DirectDestroy})}destroyAll(e,a={}){return this.remove({pieces:e,removement:Nn.DirectDestroy,quantifier:lr.All,...a})}destroyOne(e,a){return this.remove({pieces:e,removement:Nn.DirectDestroy,...a})}destroyUpTo(e,a){return this.remove({quantifier:lr.UpTo,amount:e,pieces:a,removement:Nn.DirectDestroy})}distanceToLocation(e){for(let a=0;a<this.locationsWithinBase.length;a+=1)if(this.locationsWithinBase[a].includes(e))return a;return 999}doExtraBuild(e){return this.build(!1,e)}doExtraExplore(e){return this.explore(!1,e)}doExtraRavage(e={}){const{calculateDoNotParticipateInRavage:a=!0}=e;return this.ravage({normal:!1,calculateDoNotParticipateInRavage:a})}doNormalBuild(e){return this.build(!0,e)}doNormalExplore(e){return this.explore(!0,e)}async doNotParticipateInRavage(e){const{pieceFilter:a=(()=>!0),amount:t=1,pieces:n=this.$.InvaderOrDahan,pickPiecesEffect:r}=e;let{quantifier:i=lr.All}=e;const s=[];i===lr.UpTo&&this.$.upToMustBeUsedAtMaximum&&(i=lr.Exactly),i===lr.May&&(i=lr.UpTo);const o=()=>this.piecesThatAre(n).where((e=>!e.doesNotParticipateInRavage&&a(e)));if(i===lr.AtLeast)await this.doNotParticipateInRavage({...e,quantifier:lr.Exactly}),await this.doNotParticipateInRavage({...e,quantifier:lr.Any});else if(i===lr.UpToMinimumOne)await this.doNotParticipateInRavage({...e,amount:1,quantifier:lr.Exactly}),await this.doNotParticipateInRavage({...e,amount:(e.amount??1)-1,quantifier:lr.UpTo});else if(i===lr.Any)await this.doNotParticipateInRavage({...e,quantifier:lr.May,amount:o().count});else if(i===lr.UpTo||i===lr.All||i===lr.Exactly)for(;i===lr.UpTo&&s.length<t||i===lr.All&&o().count>0||i===lr.Exactly&&s.length!==t;){const e=s.length,a=o();if(i===lr.All&&a.removeAllButFirst(),await a.pickOne((async e=>{s.push(e),await e.setDoesNotParticipateInRavage(!0)}),{autoPlayOneOption:!0,prompt:`Pick one ${Kn[n].text} to not participate in ravage. (${t-s.length} left.)`,...r},i===lr.UpTo),s.length===e)break}}doesntHave(e){return!this.pieces.some((a=>a.isA(e)))}doesntHaveIgnoringCountAs(e){return!this.hasIgnoringCountAs(e)}dontHaveAnyOf(...e){return!this.hasOneOf(...e)}downgrade(e={}){return this.upOrDowngrade({...e,downgrade:!0})}downgradeUpTo(e,a){return this.upOrDowngrade({quantifier:lr.UpTo,amount:e,pieces:a,downgrade:!0})}drown(e){return this.remove({...e,removement:Nn.Drown})}fear(e){return this.isLand||this.isEndlessDark?this.$.generateFear({amount:e,location:this,fromDestroyingBuildings:!1}):Promise.resolve(null)}forEvery(e,a){return Math.floor(this.numberOf(a)/e)}forPieces(){return ed.createCollection(this.$,this.pieces)}forPiecesWithin(e,a,t={}){const n=[];return this.landsWithin(e,a,t).forEach((e=>n.push(...e.pieces))),ed.createCollection(this.$,n)}gather(e){return this.$.doInstruction((async()=>{const{pieces:a,owner:t,filter:n=(()=>!0),pieceFilter:r=(()=>!0),oceanIsAllowed:i=!1,pickPiecesEffect:s,single:o=!1}=e;let{amount:d=1}=e;const c=[],l=a===Qn.Blight&&this.oceanIsLandForBlightOnThisBoard;if(!this.isLand&&!i&&!l)return Promise.resolve(c);l&&this.$.startAllowOceanForBlight(this);const h=a.includes(this.$.Beasts)&&this.$.extraBeastAdjacency?this.forPiecesWithin(2,null,{mayIncrease:!1}).where((e=>(e.isBeasts||e.isA(a)&&e.location.isAdjacentTo(this))&&e.location!==this)):this.piecesInAdjacentLands().where((e=>e.isA(a)));h.where((e=>r(e)&&null!==e.location&&n(e.location)&&!this.$.someEffect(yn.PreventMovePiece,{source:e.location,destination:this,piece:e,movement:Fr.Gather})&&(void 0===t||e.owner===t)));const u=()=>{c.length>0&&(h.remove(c[c.length-1].piece),o&&h.where((e=>e.location===c[0].source)))};let{quantifier:g=lr.Exactly}=e;if(g===lr.Exactly&&Kn[a].includesInvaders&&this.isIsolated?g=lr.UpTo:g===lr.UpTo&&this.$.upToMustBeUsedAtMaximum&&(g=lr.Exactly),g===lr.May&&(g=lr.UpTo),g===lr.AtLeast)c.push(...await this.gather({...e,quantifier:lr.Exactly})),c.push(...await this.gather({...e,quantifier:lr.Any}));else if(g===lr.UpToMinimumOne)c.push(...await this.gather({...e,amount:1,quantifier:lr.Exactly})),c.push(...await this.gather({...e,amount:(e.amount??1)-1,quantifier:lr.UpTo}));else if(g===lr.Any)c.push(...await this.gather({...e,quantifier:lr.May,amount:h.count}));else if(g===lr.UpTo)for(d<h.count&&await this.$.oneEffectActivates(yn.ExtraMove,{movement:Fr.Gather,pieces:a,location:this,possiblePieces:h.items})&&(d+=1);c.length<d;){const e=c.length;if(await h.optionallyPickOne((async e=>{const t={piece:e,source:e.location,destination:this,movement:Fr.Gather,pieceFilter:a};c.push(t),this.$.reportMovement(t),await e.moveTo({location:this,movement:Fr.Gather,pieceFilter:a})}),{prompt:`Pick one ${Kn[a].text} to Gather.${d>1?` (${d-c.length} left.)`:""}`,highlightLocations:[this],...s}),c.length===e)break;u()}else if(g===lr.Exactly||g===lr.All){let e=g===lr.All?h.count:d;e<h.count&&await this.$.oneEffectActivates(yn.ExtraMove,{movement:Fr.Gather,pieces:a,location:this,possiblePieces:h.items})&&(e+=1),await h.pickMultiple({amount:e,forPickedItem:async e=>{const t={piece:e,source:e.location,destination:this,movement:Fr.Gather,pieceFilter:a};c.push(t),this.$.reportMovement(t),await e.moveTo({location:this,movement:Fr.Gather,pieceFilter:a})},beforeNextItem:()=>{u()},effect:{prompt:`Pick one ${Kn[a].text} to Gather.`,highlightLocations:[this],...s}})}return this.$.stopAllowOceanForBlight(),c}))}gatherAll(e){return this.gather({quantifier:lr.All,pieces:e})}gatherOne(e){return this.gather({amount:1,pieces:e})}gatherUpTo(e,a){return this.gather({quantifier:lr.UpTo,amount:e,pieces:a})}groupToBe(e,a,t,n,r,i,s,o,d,c,l){const h=this.piecesByGroup.findIndex((d=>d.length>0&&d[0].areSameGroupAs({piece:e,damage:a,shadowDamage:t,baseStrife:n,spiritNumber:o,doesNotParticipateInRavage:r,fightsBeforeInvaders:i,targetable:s,scenarioNumber:c,marked:l})));return void 0===(h>=0?this.piecesByGroup[h]:void 0)?void 0!==d&&d>=0&&(d>=this.piecesByGroup.length||0===this.piecesByGroup[d].length)?d:this.firstFreePosition:h}has(e){return this.pieces.some((a=>a.isA(e)))}hasAdjacentLandWhere(e){return this.adjacentLands.some(e)}hasAdjacentLandWithPiece(e){return this.hasAdjacentLandWhere((a=>a.has(e)))}hasAdjacentLocationWhere(e){return this.adjacentLocations.some(e)}hasAdjacentLocationWithPiece(e){return this.hasAdjacentLocationWhere((a=>a.has(e)))}hasAdjacentPresenceOf(e){return!this.adjacentPiecesInLandsWhere((a=>a.isPresence&&e.includes(a.owner))).isEmpty}hasAllOf(...e){return!e.some((e=>this.doesntHave(e)))}hasAtLeast(e,a){let t=0;for(const n of this.pieces)if(n.isA(a)&&(t+=1,t>=e))return!0;return t>=e}hasAtMost(e,a){return this.numberOf(a)<=e}hasExactly(e,a){return this.numberOf(a)===e}hasIgnoringCountAs(e){return this.pieces.some((a=>a.isIgnoringCountAsA(e)))}hasIncarnaOf(e){return this.pieces.some((a=>a.isIncarna&&a.owner===e))}hasNumber(e){return e===this.landNumber}hasOneOf(...e){return e.some((e=>this.has(e)))}hasOnePieceWhere(e){return this.pieces.some(e)}hasOrIsAdjacentToLandsWith(e){return this.has(e)||this.hasAdjacentLandWithPiece(e)}hasOrIsAdjacentToLocationsWith(e){return this.has(e)||this.hasAdjacentLocationWithPiece(e)}hasPresenceOf(e,a){return this.pieces.some((t=>t.isPresence&&(t.owner===e||a?.includes(t))))}hasSacredSiteOf(e,a=[]){return!this.isEndlessDark&&(this.numberOfPresenceOf(e,a)>=2||this.$.someEffect(yn.HasSacredSiteOf,{land:this,spirit:e,helpers:a}))}hasSameTerrainAs(e){return this.isSands&&e.isSands||this.isMountains&&e.isMountains||this.isJungle&&e.isJungle||this.isWetlands&&e.isWetlands}hasTerrain(e,a=!1){return this.terrain===e||this.$.someLocationHasExtraTerrains&&this.$.someEffect(yn.LocationIsTerrain,{location:this,terrain:e,isSpecialRule:a})}async healthCheck(){let e=!0;for(;e;){e=!1;for(const a of this.pieces)a.isAlive||!a.isInvader&&!a.isDahan||(await a.remove(Nn.DestroyByHealthChange),e=!0)}}inAdjacentLands(){return id.createCollection(this.$,this.adjacentLands)}inAdjacentLandsWhere(e){return this.inAdjacentLands().where(e)}inAdjacentLocations(){return id.createCollection(this.$,this.adjacentLocations)}inLands(e,a){if(e.target===Jn.ToThisLocation)return id.createCollection(this.$,[e.location]);if(e.target===Jn.WithinRange)return this.inLandsWithin(e.range,e.spirit);if(e.target===Jn.Adjacent)return 1===a?this.inAdjacentLands():this.inLandsWithin(a,null,{mayIncrease:!1}).remove(this);if(e.target===Jn.OnThisBoard)return null!==this.board?this.board.inLands():id.createCollection(this.$,[]);if(e.target===Jn.ToClosestLegalLand){for(let a=0;a<this.locationsWithinBase.length;a+=1){const t=this.inLandsWithin(a,null,{mayIncrease:!1}).where((a=>a.exists&&a.board!==e.notOnBoard));if(t.count>0)return t}return id.createCollection(this.$,[])}return e.target===Jn.AnyLocations?this.$.inLocations():this.$.inLands()}inLandsWithin(e,a=null,t={}){return id.createCollection(this.$,this.landsWithin(e,a,t))}inLocationsWithin(e,a){return id.createCollection(this.$,this.landsWithin(e,a,{allLocations:!0}))}inThisAndAdjacentLands(){return this.inAdjacentLands().add(this)}inThisAndAdjacentLocations(){return this.inAdjacentLocations().add(this)}insertPieceIntoPosition(e,a){for(;a>=this.piecesByGroup.length;)this.piecesByGroup.push([]);const t=this.piecesByGroup[a];for(let a=0;a<t.length+1;a+=1)if(a===t.length||e.id<t[a].id){t.splice(a,0,e);break}e.positionIndex=a,e.location=this,(e.piece===Bn.Presence||e.isIncarna)&&e.owner.addLand(this),this.$.pieceCount[e.piece]=(this.$.pieceCount[e.piece]??0)+1}invaders(){return this.piecesWhere((e=>e.isInvader))}isAdjacentTo(e){return this.adjacentLands.includes(e)}async isolate(){await this.$.sendEvent({type:fn.LandIsolated,location:this}),await this.$.addSubEffectUntilEndOfTurn({[yn.Reminder]:e=>e===this?"Isolated Land.":void 0,[yn.Isolated]:({land:e})=>e===this})}landsContiguouslyConnectedBy(e){if(!this.hasPresenceOf(e))return[];const a=[],t=[this];for(;t.length>0;){const n=t.pop();a.push(n);for(const r of n.adjacentLands)!r.hasPresenceOf(e)||t.includes(r)||a.includes(r)||t.push(r)}return a}landsWithin(e,a,t={}){const{allLocations:n=!1,mayIncrease:r=!0,filter:i=(()=>!0),targetingLands:s=!1}=t,o=null!==a&&r?a.extraRange(this):0,d=this.locationsWithinBase.length>0?this.locationsWithinBase[Math.min(e+o,this.locationsWithinBase.length-1)].filter((e=>(e.isLand||n)&&i(e))):[];if(r&&null!==a){const t=[];for(const e of this.$.effectsMappedWithFilter(yn.ExtraRangeToLand,{spirit:a,targetingLands:s}))e&&e.extraRangeToLand>0&&t.push(e);if(t.length>0){const a=e+o+Uo(t,(e=>e.extraRangeToLand));this.locationsWithinBase[Math.min(a,this.locationsWithinBase.length-1)].forEach((a=>{if(d.includes(a)||!a.isLand&&!n)return;let r=e+o;for(const e of t)e.landFilter(a)&&(r+=e.extraRangeToLand);r=Math.min(r,this.locationsWithinBase.length-1),this.locationsWithinBase[r].includes(a)&&d.push(a)}))}}return d}matchesInvaderCard(e,a){const t=Mo[e],n=this.$.resultFromFirstEffectOfType(yn.OverrideMatchesInvaderCard,{land:this,card:e,invaderAction:a});return void 0!==n?n:this.terrainsMatchesInvaderCard(e)||t.coastal&&this.isCoastal||t.saltDeposits&&(a===Hr.Explore||a===Hr.Build)&&!this.isMiningLand||t.saltDeposits&&a===Hr.Ravage&&this.isMiningLand}matchesInvaderCards(e,a){return e.some((e=>this.matchesInvaderCard(e,a)))}mayGather(e){return this.gather({quantifier:lr.May,pieces:e})}mayPush(e){return this.move({movement:Fr.Push,quantifier:lr.May,pieces:e})}move(e){return this.$.doInstruction((async()=>{const{piece:a,pieces:t=Qn.AllPieces,together:n=this.$.alwaysPushToSameDestination,pieceFilter:r=(()=>!0),destinationFilter:i=(()=>!0),owner:s,movement:o=Fr.Move,locations:d={target:Jn.Adjacent},differentLands:c=!1,pickPiecesEffect:l,pickDestinationEffect:h,oceanIsAllowed:u=!1,withoutWait:g=!1,evenly:f=!1}=e;let{amount:p=1}=e;const w=t===Qn.Blight&&this.oceanIsLandForBlightOnThisBoard;if(o===Fr.Gather&&!this.isLand&&!u&&!w)return Promise.resolve([]);w&&this.$.startAllowOceanForBlight(this);let{quantifier:y=lr.Exactly}=e,m=!1;y===lr.Exactly&&Kn[t].includesInvaders&&this.isIsolated?(y=lr.UpTo,m=!0):y===lr.UpTo&&this.$.upToMustBeUsedAtMaximum&&(y=lr.Exactly),y===lr.May&&(y=lr.UpTo);const v=[],A=Go[o].verb,I=()=>this.piecesWhere((e=>(void 0===a?e.isA(t)&&r(e)&&(void 0===s||e.owner===s):e===a)&&!v.some((a=>a.piece===e))));let x=I();const b=(e,a,t=!1)=>i(e)&&!this.$.someEffect(yn.PreventMovePiece,{source:this,destination:e,piece:a,movement:o})&&(!n||0===v.length||v.some((a=>a.destination===e)))&&(!c&&!f||!v.some((a=>a.destination===e))||t)&&(!f&&!t||!v.some((a=>v.filter((e=>e.destination===a.destination)).length+1===v.filter((a=>a.destination===e)).length)));if(y===lr.AtLeast)v.push(...await this.move({...e,quantifier:lr.Exactly})),v.push(...await this.move({...e,quantifier:lr.Any}));else if(y===lr.UpToMinimumOne)v.push(...await this.move({...e,amount:1,quantifier:lr.Exactly})),v.push(...await this.move({...e,amount:(e.amount??1)-1,quantifier:lr.UpTo}));else{if(y===lr.Any)return this.move({...e,quantifier:lr.May,amount:x.count});if(y===lr.UpTo||y===lr.All||y===lr.Exactly)for(y!==lr.All&&p<x.count&&await this.$.oneEffectActivates(yn.ExtraMove,{movement:o,pieces:t,location:this,possiblePieces:x.items})&&(p+=1);y===lr.UpTo&&v.length<p||y===lr.All&&x.count>0||y===lr.Exactly&&v.length!==p;){const e=v.length;if(x=I(),y===lr.All&&x.removeAllButFirst(),await x.pickOne((async a=>{const r=a.isBeasts&&o===Fr.Push&&this.$.extraBeastAdjacency;let i=this.inLands(d,r?2:1).where((e=>b(e,a)));0===i.count&&(i=this.inLands(d,r?2:1).where((e=>b(e,a,!0)))),await i.pickOne((async e=>{const n={piece:a,source:this,destination:e,movement:o,pieceFilter:t};v.push(n),this.$.reportMovement(n),await a.moveTo({location:e,movement:o,pieceFilter:t,withoutWait:g})}),{autoPlayOneOption:e>0&&n||d.target===Jn.ToThisLocation,highlightPieces:[a],prompt:`Pick land to ${A} ${Kn[t].text}.${p>1?` (${p-v.length} left.)`:""}`,...h})}),{autoPlayOneOption:!0,prompt:`Pick one ${Kn[t].text} to ${A}.${p>1?` (${p-v.length} left.)`:""}${m?" <br>(This is optional because land is Isolated)":""}`,...l},y===lr.UpTo),v.length===e)break}}return this.$.stopAllowOceanForBlight(),v}))}moveBetween({upToAmount:e,pieces:a,destination:t}){return this.$.doInstruction((async()=>{const n=!this.$.upToMustBeUsedAtMaximum;await this.$.inLandsWhere(t).pickOne((async t=>{const r=this.$.forPiecesThatIs(a,(e=>e===this||e===t));let i=e;i<r.count&&await this.$.oneEffectActivates(yn.ExtraMove,{movement:Fr.Move,pieces:a,location:this,possiblePieces:r.items})&&(i+=1),await this.$.forPiecesThatIs(a,(e=>e===this||e===t)).pickMultiple({amount:i,optional:n,effect:{highlightLocations:[this,t]},forPickedItem:async e=>{const n=e.location===this?t:this,r={piece:e,source:e.location,destination:n,movement:Fr.Move,pieceFilter:a};this.$.reportMovement(r),await e.moveTo({location:n,pieceFilter:a})}})}))}))}numberOf(e){return Jo(this.pieces,(a=>a.isA(e)))}numberOfPiecesInAdjacentLands(e){return this.inAdjacentLands().sum((a=>a.numberOf(e)))}get adjacentNumberOfStrife(){return this.inAdjacentLands().sum((e=>e.numberOfStrife))}numberOfPiecesInThisOrAdjacentLands(e,a){let t=0;for(const n of[this,...this.adjacentLands])for(const r of n.pieces)(r.isA(e)&&void 0===a||r.owner===a)&&(t+=1);return t}numberOfPresenceOf(e,a=[]){return Jo(this.pieces,(a=>a.isPresence&&a.owner===e))+a.filter((e=>e.location===this)).length}participatingDahan(){return this.piecesWhere((e=>!e.doesNotParticipateInRavage&&(e.isDahan||e.isExplorer&&this.explorersFightWithDahan)))}participatingInvaders(){return this.invaders().where((e=>!(e.doesNotParticipateInRavage||e.isExplorer&&this.explorersFightWithDahan)))}async pickOnePieceToNotParticipateInRavage(e){await this.doNotParticipateInRavage({quantifier:lr.Exactly,amount:1,pieces:e})}piecesInAdjacentLands(){const e=[];return this.adjacentLands.forEach((a=>e.push(...a.pieces))),ed.createCollection(this.$,e)}piecesInThisAndAdjacentLands(){const e=[...this.pieces];return this.adjacentLands.forEach((a=>e.push(...a.pieces))),ed.createCollection(this.$,e)}piecesInThisAndAdjacentLocations(){const e=[...this.pieces];return this.adjacentLocations.forEach((a=>e.push(...a.pieces))),ed.createCollection(this.$,e)}piecesThatAre(e){return this.piecesWhere((a=>a.isA(e)))}piecesWhere(e){return this.forPieces().where(e)}piecesWithStrife(){return this.piecesWhere((e=>e.strife>0))}async piecesWithStrifeDealsDamageToOtherInvaders(){await this.piecesWithStrife().forEach((async e=>{await e.dealDamageToOtherInvaders()}),{noOptions:"No Invaders with <strife>."})}async possiblyDontCountPiecesAs(e,a){const t=void 0===a?this.pieces:this.pieces.filter((e=>e.owner===a));for(const a of t)if(await a.possiblyDontCountAs(e))return}possiblyReorderPieces(){for(;;){const e=this.firstOccupiedPositionInNextPage;if(!e)break;const a=this.firstFreePosition;if(a>=7)break;for(;this.piecesByGroup[e].length>0;){const t=this.piecesByGroup[e][0];this.removePieceFromItsPosition(t),this.insertPieceIntoPosition(t,a)}}}presenceOf(e){return this.piecesWhere((a=>a.owner===e&&a.isPresence))}push(e){return this.move({...e,movement:Fr.Push})}pushAll(e){return this.move({movement:Fr.Push,quantifier:lr.All,pieces:e})}pushOne(e){return this.move({movement:Fr.Push,amount:1,pieces:e})}pushUpTo(e,a){return this.move({movement:Fr.Push,quantifier:lr.UpTo,amount:e,pieces:a})}async putIncarna(e,a){const[t]=await this.createPiece(1,e,a.spiritNumber);return a.destroyedIncarna=null,t}putPresence(e,a){return this.createPiece(e,Bn.Presence,a.spiritNumber)}async ravage(e={}){if(this.isTheEndlessDark)return;const{normal:a=!0,card:t,calculateDoNotParticipateInRavage:n=!0}=e;await this.$.doInvaderAction(a?Ho.NormalInvaderAction:Ho.ExtraInvaderAction,(async()=>{await this.$.addEffect({name:"Ravage",text:`Ravage in land ${this.coordinate}.`,highlightLocations:[this],[yn.Now]:async()=>{const e={land:this,normal:a,card:t,invaderAction:Hr.Ravage};let r=await this.$.oneEffectActivates(yn.PreventInvaderActionInLand,e);if(r||(n&&await this.calculateDoNotParticipateInRavage(),r=await this.$.oneEffectActivates(yn.AlterInvaderActionInLand,e)),r)return void await this.resetDoNotParticipateInRavage();await this.$.sendEvent({type:fn.InvadersRavageInLand,location:this});let i=this.participatingInvaders();const s=this.participatingDahan();await this.$.doEffects(yn.DahanFightBeforeInvaders,{land:this});const o=this.participatingDahan().where((e=>e.fightsBeforeInvaders)),d=s.sum((e=>e.fightsBeforeInvaders?0:e.strengthDuringRavage));if(this.$.beastsCountAsBadlands&&await this.possiblyDontCountPiecesAs(Bn.Beasts),await this.possiblyDontCountPiecesAs(Bn.Badlands),o.count>0){const e=o.sum((e=>e.strengthDuringRavage));if(e>0){const a=e+this.sumAdjustedCollectiveDahanRavageDamage;await this.damage(a,Qn.Invader,{filter:e=>i.has(e)}),i=this.participatingInvaders()}}let c=i.sum((a=>a.strife>0?0:a.strengthDuringRavage+a.adjustedIndividualInvaderRavageDamage({towardsLand:!1,normal:e.normal}))),l=i.sum((a=>a.strife>0?0:a.strengthDuringRavage+a.adjustedIndividualInvaderRavageDamage({towardsLand:!0,normal:e.normal})));const h=this.sumAdjustedCollectiveInvaderRavageDamage({normal:e.normal,towardsLand:!1}),u=this.sumAdjustedCollectiveInvaderRavageDamage({normal:e.normal,towardsLand:!0});await i.forEach((async e=>{e.strife>0&&await e.removeStrife()}));let g=0;if(c>0&&(c+=h,c-=this.defense,g=c),l>0&&(l+=u,l-=this.defense),g>0){const e=await this.damage(g,Qn.InvaderOrDahan,{filter:e=>s.has(e),efficiently:!0});e.length>0&&await this.$.doEffects(yn.AfterDahanDestroyedInRavage,{land:this,amount:e.length})}l>0&&await this.damageLand(l);const f=s.where((e=>!e.fightsBeforeInvaders));if(f.count>0){const e=f.where((e=>e.isAlive)),a=this.dahanFightSimultaneously?d:e.sum((e=>e.strengthDuringRavage));if(a>0){const e=a+this.sumAdjustedCollectiveDahanRavageDamage;await this.damage(e,Qn.Invader,{filter:e=>i.has(e)})}}await this.resetDoNotParticipateInRavage(),await this.resetDahanFightBefore()}})}),{land:this}),await this.$.doEffects(yn.AfterRavaging,{land:this})}remove(e){return this.$.doInstruction((async()=>{const{amount:a=1,pieces:t=Qn.AllPieces,owner:n,filter:r=(()=>!0),removement:i=Nn.Remove}=e,s=e.autoPlay??(e.quantifier===lr.All&&!this.$.orderOfRemoveAllMightMatter),o=()=>this.piecesWhere((e=>e.isA(t)&&r(e)&&e.targetable&&(void 0===n||e.owner===n))),d=pr[i].verb,c=[];let{quantifier:l=lr.Exactly}=e;if(l===lr.UpTo&&this.$.upToMustBeUsedAtMaximum&&(l=lr.Exactly),l===lr.May&&(l=lr.UpTo),l===lr.UpToMinimumOne)c.push(...await this.remove({...e,amount:1,quantifier:lr.Exactly})),c.push(...await this.remove({...e,amount:(e.amount??1)-1,quantifier:lr.UpTo}));else if(l===lr.AtLeast)c.push(...await this.remove({...e,quantifier:lr.Exactly})),c.push(...await this.remove({...e,quantifier:lr.Any}));else{if(l===lr.Any)return this.remove({...e,amount:o().count,quantifier:lr.May});{const e=o();let n=l===lr.All?e.count:a;n<e.count&&await this.$.oneEffectActivates(yn.ExtraRemove,{removement:i,pieces:t,location:this,possiblePieces:e.items})&&(n+=1),await e.pickMultiple({amount:n,optional:l===lr.UpTo,forPickedItem:async e=>{c.push(...await this.removePiece({piece:e,removement:i,removeAll:l===lr.All,pieceFilter:t}))},autoplayIfPickingAll:s,effect:{autoPlayOneOption:s,prompt:`Pick one ${Kn[t].text} to ${d}.`}})}}return c}))}async removeAllStrife(){await this.piecesWithStrife().forEach((async e=>{await e.removeStrife(e.baseStrife)}))}async removeBlight(e={}){const{amount:a=1,quantifier:t=lr.Exactly,toTheBox:n=!1}=e,r=Math.min(this.numberOf(this.$.Blight),a),i=await this.remove({amount:r,pieces:this.$.Blight,quantifier:t,autoPlay:!0});return i.length>0&&!n&&!await this.$.oneEffectActivates(yn.PreventAddRemovedBlightToBlightCard)&&await this.$.addBlightToBlightCard(i.length),i}removeInvadersWorthOfHealthUpTo(e,a={}){return this.$.doInstruction((async()=>{const{extraRemoveAllowed:t=!0,singleInvader:n=!1}=a,r=[],i=()=>this.invaders().where((a=>a.health<=e&&a.targetable));return await i().optionallyPickOne((async a=>{r.push(...await a.remove()),n||r.push(...await this.removeInvadersWorthOfHealthUpTo(e-a.health,{extraRemoveAllowed:!1}))}),{prompt:n?`Remove an Invader with ${e} health or less.`:`${e} health left to remove.`}),t&&await this.$.oneEffectActivates(yn.ExtraRemove,{removement:Nn.Remove,pieces:this.$.Invader,location:this,possiblePieces:i().items})&&r.push(...await this.removeInvadersWorthOfHealthUpTo(e,{extraRemoveAllowed:!1,singleInvader:!0})),r}))}removeOne(e){return this.remove({pieces:e})}async removePiece(e){const{piece:a,removement:t,pieceFilter:n,byDamage:r=!1,removeAll:i=!1}=e;if(t!==Nn.Silent){const e={piece:a,location:this,removement:t,byDamage:r,removeAll:i};if(await this.$.oneEffectActivates(yn.AdjustRemovePiece,e))return[];const n=await this.$.oneEffectActivates(yn.PreventRemovePiece,e);if(pr[t].isDestroyLike&&a.isInvader&&this.$.setHasAttemptedDestroyingInvaderThisInstruction(),n)return r&&(a.damage=0),await this.$.addEffectUntilEndOfAction({[yn.PreventTargetPiece]:e=>a===e.piece,[yn.PreventDamagingPiece]:e=>Promise.resolve(a===e.piece),[yn.AdjustRemovePiece]:e=>Promise.resolve(a===e.piece),[yn.ActionEnds]:()=>(a.placeInGroup(),Promise.resolve())}),a.placeInGroup(),[]}t!==Nn.Silent&&await this.$.waitForAnimationsToFinish();const s=qr(this.pieces,(e=>e.id===a.id));if(s){const e=s.positionIndex;this.removePieceFromItsPosition(s),0===this.piecesByGroup[e].length&&this.possiblyReorderPieces()}if(t!==Nn.Silent){if(s){if(!0!==pr[t].skipEvent&&await this.$.sendEvent({type:fn.PieceRemoved,piece:a,pieceType:a.piece,location:this,removement:t}),pr[t].isDestroyLike&&await this.$.generateFear({amount:a.fearFromDestruction,location:this,fromDestroyingBuildings:!0}),a.piece===Bn.Presence){[Nn.DirectDestroy,Nn.DestroyByDamageOrBlight,Nn.Replace,Nn.Remove].includes(t)&&(a.owner.destroyedPresence+=1);const e=this.numberOfPresenceOf(a.owner);await this.$.doEffects(yn.AfterLandChangesAmountOfPresence,{amountBefore:e+1,amountAfter:e,land:this,spirit:a.owner})}a.isIncarna&&![Nn.Relocate,Nn.Silent].includes(t)&&(a.owner.destroyedIncarna=a.piece)}await this.$.doEffects(yn.AfterRemovePiece,{piece:a,location:this,removement:t,pieceFilter:n})}return s?[{piece:s,location:this,removement:t}]:[]}removePieceFromItsPosition(e){e.positionIndex>=0&&(e.positionIndex<this.piecesByGroup.length&&(qr(this.piecesByGroup[e.positionIndex],e),0!==this.piecesByGroup[e.positionIndex].length||e.piece!==Bn.Presence&&!e.isIncarna||this.hasPresenceOf(e.owner)||e.owner.removeLand(this),this.$.pieceCount[e.piece]=(this.$.pieceCount[e.piece]??0)-1),e.positionIndex=-1)}async removeStrife(e){await this.piecesWithStrife().pickMultiple({amount:e,where:e=>e.strife>0,forPickedItem:async e=>{await e.removeStrife()},repeatSame:!0,effect:{noOptions:"No <strife> to remove."}})}replaceIndividually(e){return this.$.doInstruction((async()=>{const{pieces:a,withPiece:t,owner:n,removement:r=Nn.Replace}=e;let{amount:i}=e;const s=this.piecesWhere((e=>e.isA(a)&&(void 0===n||e.owner===n))),o={removed:[],added:[]};return i<s.count&&await this.$.oneEffectActivates(yn.ExtraRemove,{removement:r,pieces:a,location:this,possiblePieces:s.items})&&(i+=1),await s.pickMultiple({amount:i,forPickedItem:async e=>{const a=await e.replace([t],r);o.removed.push(...a.removed),o.added.push(...a.added)},effect:{autoPlayOneOption:!0}}),await this.$.doEffects(yn.AfterReplacePieces,o),o}))}replaceOne(e){return this.$.doInstruction((async()=>{const{pieces:a,withAmount:t=1,withPiece:n,owner:r}=e,i={removed:[],added:[]};let s=1;const o=this.piecesWhere((e=>e.isA(a)&&(void 0===r||e.owner===r)));return s<o.count&&await this.$.oneEffectActivates(yn.ExtraRemove,{removement:Nn.Replace,pieces:a,location:this,possiblePieces:o.items})&&(s+=1),await o.pickMultiple({amount:s,forPickedItem:async e=>{const a=await e.replace([...Array(t).keys()].map((()=>n)));i.removed.push(...a.removed),i.added.push(...a.added)}}),await this.$.doEffects(yn.AfterReplacePieces,i),i}))}async resetDahanFightBefore(){for(const e of this.pieces)await e.setFightsBeforeInvaders(!1)}async resetDoNotParticipateInRavage(){for(const e of this.pieces)await e.setDoesNotParticipateInRavage(!1)}async restoreToSetupSymbols(e={}){const{exceptPieces:a=[],removeFirst:t=!0}=e,{setupSymbols:n}=this;n.length>0&&await this.$.sendEvent({type:fn.RestoringLandToSetupSymbols,location:this}),t&&await this.remove({quantifier:lr.All,autoPlay:!0,pieces:Qn.AllPieces});let r=[...n];if(null!==this.board&&this.board.ignoreInvaderAndBlightInSetup){if(this.$.spiritCount<=4&&(r=r.filter((e=>![Bn.City,Bn.Town,Bn.Explorer].includes(e)))),3===this.$.spiritCount){let e=this.board.data.setupSymbols.findIndex((e=>e.includes(Bn.City)));e>=0?e===this.landIndex&&r.push(Bn.City):(e=this.board.data.setupSymbols.findIndex((e=>e.includes(Bn.Town))),e===this.landIndex&&r.push(Bn.Town))}if(4===this.$.spiritCount){td(this.board.data.setupSymbols,(e=>e.includes(Bn.Town)))===this.landIndex&&r.push(Bn.Town)}}for(const e of r)if(!a.some((a=>Kn[a].pieces.includes(e))))if(e!==Bn.Strife)(e!==Bn.Dahan||this.numberOfDahan<r.filter((e=>e===Bn.Dahan)).length)&&await this.createPiece(1,e);else{const e=n.indexOf(Bn.Strife)-1;if(e>=0){const a=n[e],t=this.pieces.find((e=>e.piece===a));void 0!==t&&await t.addStrife()}}}sharesCornerWith(e){return!!(this.isCornerLandOrNumberOne&&e.isCornerLandOrNumberOne&&e.boardIndex!==this.boardIndex&&e.isAdjacentTo(this))&&(2!==this.adjacentLocations.filter((a=>a.boardIndex===e.boardIndex&&a.isCornerLandOrNumberOne)).length||2!==e.adjacentLocations.filter((e=>e.boardIndex===this.boardIndex&&e.isCornerLandOrNumberOne)).length)}async skipInvaderAction(e={}){const{all:a=!1,next:t=!1,amount:n=1,textArea:r,text:i=this.$.currentStackEffect?.text,afterSkip:s,filter:o=(()=>!0)}=e,d=Re.box(0);await this.$.addSubEffectUntilEndOfTurn({[yn.Reminder]:e=>e===this?`${i}${a?"":`<br><br>(${n-d.get()} left.)`}`:void 0,[yn.PreventInvaderActionInLand]:async e=>!(e.land!==this||!o(e)||!(a||t||await this.$.may({textArea:r,highlightLocations:[this],prompt:`Skip ${e.invaderAction} Action?`})))&&(d.set(d.get()+1),a||d.get()!==n||this.$.removeThisEffect(),void 0!==s&&await s(e),!0)})}spiritsWithPresence(){return this.$.spiritsWhich((e=>this.hasPresenceOf(e)))}sumAdjustedCollectiveInvaderRavageDamage({normal:e,towardsLand:a}){return this.$.sumEffects(yn.AdjustCollectiveInvaderRavageDamage,{land:this,normal:e,towardsLand:a})}terrainsMatchesInvaderCard(e){return Mo[e].terrains.some((e=>this.hasTerrain(e)))}terrainsMatchesInvaderCards(e){return e.some((e=>this.terrainsMatchesInvaderCard(e)))}async timePasses(){for(const e of this.pieces)await e.timePasses()}toString(){return`${Vo(this.pieces.map((e=>e.piece)))}`}upOrDowngrade(e){return this.$.doInstruction((async()=>{const{downgrade:a=!0,amount:t=1,pieces:n=this.$.Invader,filter:r=(()=>!0),pickPiecesEffect:i,different:s=!1}=e;let{quantifier:o=lr.Exactly}=e;o===lr.UpTo&&this.$.upToMustBeUsedAtMaximum&&(o=lr.Exactly),o===lr.May&&(o=lr.UpTo);const d=[],c=()=>this.piecesWhere((e=>e.isA(n)&&r(e)&&(!s||0===d.length||!d.includes(e))));if(o===lr.AtLeast)await this.upOrDowngrade({...e,quantifier:lr.Exactly}),await this.upOrDowngrade({...e,quantifier:lr.Any});else if(o===lr.UpToMinimumOne)await this.upOrDowngrade({...e,amount:1,quantifier:lr.Exactly}),await this.upOrDowngrade({...e,amount:(e.amount??1)-1,quantifier:lr.UpTo});else if(o===lr.Any)await this.upOrDowngrade({...e,quantifier:lr.May,amount:c().count});else if(o===lr.UpTo||o===lr.All||o===lr.Exactly)for(;o===lr.UpTo&&d.length<t||o===lr.All&&c().count>0||o===lr.Exactly&&d.length!==t;){const e=d.length,r=c();if(o===lr.All&&r.removeAllButFirst(),await r.pickOne((async e=>{d.push(e),a?await e.downgrade():await e.upgrade()}),{autoPlayOneOption:o===lr.All,prompt:`Pick one ${Kn[n].text} to ${a?"downgrade":"upgrade"}. (${t-d.length} left.)`,...i},o===lr.UpTo),d.length===e)break}}))}upgrade(e){return this.upOrDowngrade({...e,downgrade:!1})}upgradeUpTo(e,a){return this.upOrDowngrade({quantifier:lr.UpTo,amount:e,pieces:a,downgrade:!1})}get adjustedLandHealth(){return this.$.sumEffects(yn.AdjustLandHealth,{land:this})}get firstFreePosition(){let e=0;for(;e<this.piecesByGroup.length&&this.piecesByGroup[e].length>0;)e+=1;return e}get firstOccupiedPositionInNextPage(){let e=7;for(;;){if(e>=this.piecesByGroup.length)return;if(this.piecesByGroup[e].length>0)break;e+=1}return e}async build(e,a){this.isTheEndlessDark||await this.$.doInvaderAction(e?Ho.NormalInvaderAction:Ho.ExtraInvaderAction,(async()=>{await this.$.addEffect({name:"Build",text:`Build in land ${this.coordinateLink}.`,highlightLocations:[this],[yn.Now]:async()=>{const t={land:this,normal:e,card:a,invaderAction:Hr.Build};let n=await this.$.oneEffectActivates(yn.PreventInvaderActionInLand,t);if(!n&&this.has(Qn.Disease)&&(await this.$.oneEffectActivates(yn.PreventDiseasePreventingBuilds,{location:this})||(n=!0,await this.$.addSubEffect({text:`The Build in land ${this.coordinateLink} is prevented by <disease>.`,[yn.Now]:async()=>{await this.removeOne(this.$.Disease)}}))),!n&&(await this.$.doEffects(yn.BeforeSuccessfulBuild,{land:this}),n=await this.$.oneEffectActivates(yn.AlterInvaderActionInLand,t),!n)){const e=await this.add(1,this.buildPlans);await this.$.doEffects(yn.AfterSuccessfulBuild,{land:this,additions:e})}}})}),{land:this})}async explore(e,a){this.isTheEndlessDark||await this.$.doInvaderAction(e?Ho.NormalInvaderAction:Ho.ExtraInvaderAction,(async()=>{await this.$.addEffect({name:"Explore",text:`Explore in land ${this.coordinate}.`,highlightLocations:[this],[yn.Now]:async()=>{const t={land:this,normal:e,card:a,invaderAction:Hr.Explore};this.isIsolated||await this.$.oneEffectActivates(yn.PreventInvaderActionInLand,t)||(await this.$.doEffects(yn.BeforeSuccessfulExplore,{land:this}),this.has(Qn.Wilds)&&!this.$.ignoreWildsDuringExplore?await this.removeOne(this.$.Wilds):await this.$.oneEffectActivates(yn.AlterInvaderActionInLand,t)||await this.add(1,Qn.Explorer),await this.$.doEffects(yn.AfterSuccessfulExplore,t),a&&await this.$.escalate(a,{afterExploringLand:this}))}})}),{land:this})}}rd([Re],id.prototype,"pieces",void 0),rd([Re],id.prototype,"piecesByGroup",void 0),rd([Me],id.prototype,"elements",null);const sd={name:"Scream Disease Into The Wind",type:Sn.Minor,speed:rr.Fast,energy:1,elements:[nr.Air,nr.Water,nr.Animal],set:a.JaggedEarth,target:ir.Spirit,targetFilter:[ur.Another],effects:[{textArea:[.607,.696],text:"Target Spirit gets <range+1> with all their Powers.",[yn.TargetSpirit]:async({$:e,spirit:a})=>{await e.addSubEffectUntilEndOfTurn({[yn.GlobalReminder]:()=>({icon:"<range+1>",players:[a]}),[yn.ExtraRange]:e=>e.spirit===a?1:0})}},{textArea:[.703,.929],text:"Once this turn, after target Spirit uses a Power targeting a land, they may add 1 <disease> to that land. (Hand them a <disease> token as a reminder.)",[yn.TargetSpirit]:async({$:e,power:a,spirit:t,...n})=>{const r=Re.box(!1),i={triggerId:e.nextTriggerId(),[yn.Now]:async({action:a})=>{a.parentData.targetLands.some((e=>e.exists))&&await e.may({prompt:"Add 1 <disease> to target land?"})&&(r.set(!0),await id.createCollection(e,a.parentData.targetLands).pickOne((async a=>{await a.add(1,e.Disease)}),{autoPlayOneOption:!0}))}};await e.addSubEffectUntilEndOfTurn({[yn.GlobalReminder]:()=>({icon:`<disease><br>${r.get()?"1":"0"} / 1`,players:[t]}),[yn.AfterTargetingLands]:async a=>{a.power.owner!==t||r.get()||(e.action.data.targetLands=a.lands,await e.addTrigger(i,n.effect,n.action))}})}}]},od={name:"Sear Anger Into The Wild Lands",type:Sn.Minor,speed:rr.Slow,energy:0,elements:[nr.Sun,nr.Fire,nr.Plant],set:a.JaggedEarth,target:ir.Land,range:1,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.644,.877],text:"Add 1 <badlands>.<or>If <wilds> and Invaders are present, 1 <fear> and 1 Damage.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"Badlands",textArea:[.651,.691],text:"Add 1 <badlands>.",[yn.Now]:async()=>{await a.add(1,e.Badlands)}},{actionId:"Wilds",textArea:[.778,.874],text:"If <wilds> and Invaders are present, 1 <fear> and 1 Damage.",[yn.Now]:async()=>{a.hasAllOf(e.Wilds,e.Invader)&&(await a.fear(1),await a.damage(1))}}]})}}]},dd={name:"Set Them On An Ever-Twisting Trail",type:Sn.Minor,speed:rr.Fast,energy:1,elements:[nr.Air,nr.Plant,nr.Animal],set:a.JaggedEarth,target:ir.Land,sourceFilter:[sr.SacredSite],range:1,hasPushOrGather:!0,effects:[{textArea:[.712,.752],text:"Gather or Push 1 <explorer>.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"Gather",text:"Gather 1 <explorer>.",[yn.Now]:async()=>{await a.gatherOne(e.Explorer)}},{actionId:"Push",text:"Push 1 <explorer>",[yn.Now]:async()=>{await a.pushOne(e.Explorer)}}]},{orChoice:!1})}},{textArea:[.768,.808],text:"Isolate target land.",[yn.InTargetLand]:async({land:e})=>{await e.isolate()}}]},cd={name:"Skies Herald The Season Of Return",type:Sn.Minor,speed:rr.Fast,energy:1,elements:[nr.Sun,nr.Moon,nr.Plant,nr.Animal],set:a.JaggedEarth,target:ir.Land,range:1,hasPushOrGather:!0,blightWhiteListedPower:!0,effects:[{textArea:[.657,.745],text:"A Spirit with <presence> on target board may add 1 of their Destroyed <presence>.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.spiritsWhich((e=>a.boards().hasOneWhere((a=>a.spiritsWithPresence().has(e))))).pickOne((async e=>{await a.addPresence(e,{destroyed:!0})}),{noOptions:"No Spirits with <presence> on target board."})}},{textArea:[.756,.796],text:"Gather up to 2 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(2,e.Dahan)}},{textArea:[.814,.854],text:"Push 1 <blight>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushOne(e.Blight)}}]},ld={name:"Strong And Constant Currents",type:Sn.Minor,speed:rr.Fast,energy:0,elements:[nr.Sun,nr.Water,nr.Earth],set:a.JaggedEarth,target:ir.Land,targetFilter:[sr.Coastal],range:0,hasPushOrGather:!0,effects:[{textArea:[.59,.94],text:"Push 1 <explorer>/<town> to an adjacent Coastal land.<or>Move up to 2 <dahan> between target land and one other Coastal land.<br><br>If you have 2 <water>:<br>You may do both.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await e.chooseBetween({effects:[{actionId:"Push",textArea:[.59,.671],text:"Push 1 <explorer>/<town> to an adjacent Coastal land.",[yn.Now]:async()=>{await t.push({amount:1,pieces:e.ExplorerOrTown,destinationFilter:e=>e.isCoastal})}},{actionId:"Move",textArea:[.719,.808],text:"Move up to 2 <dahan> between target land and one other Coastal land.",[yn.Now]:async()=>{await t.moveBetween({upToAmount:2,pieces:e.Dahan,destination:e=>e.isCoastal&&e!==t})}},{actionId:"DoBoth",text:"Do both.",condition:()=>!e.treatingAllOrsAsAnds&&a.hasElementsWithConvert({[nr.Water]:2}),[yn.Now]:async()=>{await a.convertElements({[nr.Water]:2}),await e.addSubEffect({textArea:[.59,.671],text:"Push 1 <explorer>/<town> to an adjacent Coastal land.",[yn.Now]:async()=>{await t.push({amount:1,pieces:e.ExplorerOrTown,destinationFilter:e=>e.isCoastal})}}),await e.addSubEffect({textArea:[.719,.808],text:"Move up to 2 <dahan> between target land and one other Coastal land.",[yn.Now]:async()=>{await t.moveBetween({upToAmount:2,pieces:e.Dahan,destination:e=>e.isCoastal&&e!==t})}})}}]})}}]},hd={name:"Sucking Ooze",type:Sn.Minor,speed:rr.Fast,energy:0,elements:[nr.Moon,nr.Water,nr.Earth],set:a.JaggedEarth,target:ir.Land,targetFilter:[sr.Sands,sr.Wetlands],range:1,generatesFear:!0,effects:[{textArea:[.719,.759],text:"2 <fear> if Invaders are present.",[yn.InTargetLand]:async({land:e})=>{e.hasInvaders&&await e.fear(2)}},{textArea:[.773,.813],text:"Isolate target land.",[yn.InTargetLand]:async({land:e})=>{await e.isolate()}}]},ud={name:"Sunsets Fire Flows Across The Land",type:Sn.Minor,speed:rr.Slow,energy:1,elements:[nr.Sun,nr.Moon,nr.Fire,nr.Water],set:a.JaggedEarth,target:ir.Land,sourceFilter:[sr.SacredSite],range:1,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.699,.739],text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.699,.739],text:"1 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(1)}},{textArea:[.756,.841],text:"You may pay 1 Energy to deal 1 Damage in an adjacent land.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{a.energy>=1&&await e.may({prompt:"Pay 1 Energy to deal 1 Damage in an adjacent land?"})&&await t.inAdjacentLands().pickOne((async e=>{await e.damage(1)}))}}]},gd={name:"Territorial Strife",type:Sn.Minor,speed:rr.Slow,energy:0,elements:[nr.Sun,nr.Fire,nr.Animal],set:a.JaggedEarth,target:ir.Land,targetFilter:[sr.City],range:1,hasDamageInstructions:!0,effects:[{textArea:[.676,.858],text:"3 Damage to <explorer>/<town><or>Add 1 <strife>.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"Damage",textArea:[.683,.723],text:"3 Damage to <explorer>/<town>.",[yn.Now]:async()=>{await a.damage(3,e.ExplorerOrTown)}},{actionId:"Strife",textArea:[.814,.854],text:"Add 1 <strife>.",[yn.Now]:async()=>{await a.addStrife(1)}}]})}}]},fd={name:"Terror Turns To Madness",type:Sn.Minor,speed:rr.Slow,energy:0,elements:[nr.Moon,nr.Air,nr.Water],set:a.JaggedEarth,target:ir.Land,targetFilter:[sr.Invaders],range:2,generatesFear:!0,effects:[{textArea:[.617,.906],text:"If the Terror Level is I: 3 <fear><br>II: 2 <fear> or add 1 <strife>.<br>III: Add 1 <strife>.",[yn.InTargetLand]:async({$:e,land:a})=>{1===e.terrorLevel?await e.addSubEffect({textArea:[.703,.743],text:"3 <fear>.",[yn.Now]:async()=>{await a.fear(3)}}):2===e.terrorLevel?await e.chooseBetween({effects:[{actionId:"Fear",textArea:[.779,.819],text:"2 <fear>.",[yn.Now]:async()=>{await a.fear(2)}},{actionId:"AddStrife",textArea:[.779,.819],text:"Add 1 <strife>.",[yn.Now]:async()=>{await a.addStrife(1)}}]},{orChoice:!1}):3===e.terrorLevel&&await e.addSubEffect({textArea:[.85,.89],text:"Add 1 <strife>.",[yn.Now]:async()=>{await a.addStrife(1)}})}}]},pd={name:"The Shore Seethes With Hatred",type:Sn.Minor,speed:rr.Slow,energy:1,elements:[nr.Fire,nr.Water,nr.Earth,nr.Plant],set:a.JaggedEarth,target:ir.Land,targetFilter:[sr.Coastal],range:1,generatesFear:!0,effects:[{textArea:[.716,.756],text:"1 <fear>",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.778,.818],text:"Add 1 <badlands> and 1 <wilds>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Badlands),await a.add(1,e.Wilds)}}]},wd={name:"Thriving Chokefungus",type:Sn.Minor,speed:rr.Slow,energy:1,elements:[nr.Moon,nr.Water,nr.Plant],set:a.JaggedEarth,target:ir.Land,sourceFilter:[sr.SacredSite],targetFilter:[sr.Jungle,sr.Wetlands],range:1,effects:[{textArea:[.746,.786],text:"Add 1 <disease> and 1 <badlands>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Disease),await a.add(1,e.Badlands)}}]},yd={name:"Treacherous Waterways",type:Sn.Minor,speed:rr.Fast,energy:0,elements:[nr.Fire,nr.Water,nr.Earth],set:a.JaggedEarth,target:ir.Land,targetFilter:[sr.Mountain,sr.Wetlands],range:1,hasPushOrGather:!0,effects:[{textArea:[.676,.865],text:"Add 1 <wilds>.<or>Push 1 <explorer>.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"Wilds",textArea:[.683,.723],text:"Add 1 <wilds>.",[yn.Now]:async()=>{await a.add(1,e.Wilds)}},{actionId:"Push",textArea:[.814,.854],text:"Push 1 <explorer>.",[yn.Now]:async()=>{await a.pushOne(e.Explorer)}}]})}}]},md={name:"Unquenchable Flames",type:Sn.Minor,speed:rr.Slow,energy:1,elements:[nr.Moon,nr.Fire,nr.Earth],set:a.JaggedEarth,target:ir.Land,sourceFilter:[sr.SacredSite],range:2,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.607,.647],text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.607,.647],text:"1 Damage to <town>/<city>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.damage(1,e.TownOrCity)}},{textArea:[.661,.755],text:"Invaders do not heal Damage at end of turn.",[yn.InTargetLand]:async({$:e,land:a,effect:t})=>{await e.addSubEffectUntilEndOfTurn({[yn.Reminder]:e=>e===a?t.text:void 0,[yn.PreventClearDamage]:({piece:e})=>e.isInvader&&e.location===a})}},{textArea:[.878,.918],text:"If you have 2 <fire>:<br>Add 1 <badlands>.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElements({[nr.Fire]:2})&&await t.add(1,e.Badlands)}}]},vd={name:"Weep For What Is Lost",type:Sn.Minor,speed:rr.Slow,energy:0,elements:[nr.Fire,nr.Water,nr.Animal],set:a.JaggedEarth,target:ir.Land,targetFilter:[sr.Blight],range:1,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.71,.75],text:"1 <fear> per type of Invader present.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.fear((a.has(e.Explorer)?1:0)+(a.has(e.Town)?1:0)+(a.has(e.City)?1:0))}},{textArea:[.771,.811],text:"Push up to 1 <explorer>/<town> per <blight>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(a.numberOf(e.Blight),e.ExplorerOrTown)}}]},Ad={name:"Roiling Bog And Snagging Thorn",type:Sn.Minor,speed:rr.Fast,energy:0,elements:[nr.Moon,nr.Fire,nr.Water,nr.Plant],set:a.NatureIncarnate,target:ir.Land,sourceFilter:[sr.SacredSite],range:1,generatesFear:!0,effects:[{textArea:[.652,.693],text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.652,.693],text:"Isolate.",[yn.InTargetLand]:async({land:e})=>{await e.isolate()}},{textArea:[.652,.693],text:"Defend 2.",[yn.InTargetLand]:async({land:e})=>{await e.defend(2)}},{textArea:[.727,.9],text:"1 <dahan> does not participate in Ravage. (Check when Ravaging; it does not take Damage and does not counterattack.).",[yn.InTargetLand]:async({$:e,land:a,effect:t})=>{await e.addSubEffectUntilEndOfTurn({[yn.Reminder]:e=>e===a?t.text:void 0,[yn.DoesNotParticipateInRavage]:async({location:t})=>{t===a&&await t.pickOnePieceToNotParticipateInRavage(e.Dahan)}})}}]},Id={name:"Ward The Shores",type:Sn.Scenario,speed:rr.Slow,energy:0,elements:[],set:a.BranchAndClaw,target:ir.Land,range:0,sourceFilter:[sr.SacredSite],targetFilter:[sr.WardTheShores],effects:[{text:"Pay 2 Energy per <blight> and 2 Energy per <town>/<city> to add a Warding Pattern.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{const n=2*t.numberOf(e.Blight)+2*t.numberOf(e.TownOrCity);await a.payEnergy(n),await t.add(1,e.WardingPattern)}}]},xd={name:"Call On Midnight's Dream",type:Sn.Unique,speed:rr.Fast,energy:0,elements:[nr.Moon,nr.Animal],set:a.Base,target:ir.Land,range:0,generatesFear:!0,effects:[{textArea:[.628,.91],text:"If target land has <dahan>, gain a Major Power. If you Forget this Power, gain Energy equal to <dahan> and you may play the Major Power immediately, paying its cost.<or>If Invaders are present, 2 <fear>.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await e.chooseBetween({effects:[{actionId:"GainMajor",textArea:[.633,.83],label:"Gain a Major Power.",text:"Gain a Major Power. If you Forget this Power, gain Energy equal to <dahan> and you may play the Major Power immediately, paying its cost.",[yn.Now]:async()=>{const n=await a.gainPowerCard({powerType:Sn.Major});if(n.chosen.length>0){const r=n.chosen[0];if(!a.hasPower(Mi.CallOnMidnightsDream)&&(await a.gainEnergy(t.numberOf(e.Dahan)),null!==n)){const t=sg[r.power].energy??0;a.energy>=t&&await e.may({prompt:`Play the Major Power immediately, paying ${t} energy?`})&&await r.play({withoutUsingCardPlays:!0})}}},condition:()=>t.has(e.Dahan)},{actionId:"Fear",textArea:[.864,.904],text:"If Invaders are present, 2 <fear>.",[yn.Now]:async()=>{await t.fear(2)},condition:()=>t.hasInvaders}]})}}]},bd={name:"Dread Apparitions",type:Sn.Unique,speed:rr.Fast,energy:2,elements:[nr.Moon,nr.Air],set:a.Base,target:ir.Land,targetFilter:[sr.Invaders],range:1,generatesFear:!0,effects:[{textArea:[.624,.709],text:"When Powers generate <fear> in target land, Defend 1 per <fear>.",[yn.InTargetLand]:async({$:e,land:a})=>{const t=Re.box(0);await e.addSubEffectUntilEndOfTurn({[yn.Reminder]:void 0,[yn.DefendFromSpirits]:e=>e.land===a?t.get():0}),await e.addSubEffectUntilEndOfTurn({[yn.AfterPowerGenerateFearInLand]:({fromDestroyingBuildings:n,location:r,amount:i})=>(r!==a||n||e.currentActionType!==Ho.PowerAction||t.set(t.get()+i),Promise.resolve()),[yn.Reminder]:e=>e===a?`${t.get()} <fear> = ${t.get()} Defense.`:void 0})}},{textArea:[.71,.75],text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}}]},Td={name:"Dreams Of The Dahan",type:Sn.Unique,speed:rr.Fast,energy:0,elements:[nr.Moon,nr.Air],set:a.Base,target:ir.Land,range:2,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.673,.855],text:"Gather up to 2 <dahan>.<or>If target land has <town>/<city>, 1 <fear> for each <dahan>, to a maximum of 3 <fear>.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"Gather",textArea:[.679,.719],text:"Gather up to 2 <dahan>.",[yn.Now]:async()=>{await a.gatherUpTo(2,e.Dahan)}},{actionId:"Fear",textArea:[.758,.854],text:"1 <fear> for each <dahan>, to a maximum of 3 <fear>.",[yn.Now]:async()=>{await a.fear(Math.min(a.numberOf(e.Dahan),3))},condition:()=>a.has(e.TownOrCity)}]})}}]},Ed={name:"Night Terrors",type:Sn.Innate,speed:rr.Fast,set:a.Base,target:ir.Land,targetFilter:[sr.Invaders],range:0,generatesFear:!0,effects:[{text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)},threshold:{[nr.Moon]:1,[nr.Air]:1}},{text:"+1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)},threshold:{[nr.Moon]:2,[nr.Air]:1,[nr.Animal]:1}},{text:"+1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)},threshold:{[nr.Moon]:3,[nr.Air]:2,[nr.Animal]:1}}]},Pd={name:"Predatory Nightmares",type:Sn.Unique,speed:rr.Slow,energy:2,elements:[nr.Moon,nr.Fire,nr.Earth,nr.Animal],set:a.Base,target:ir.Land,sourceFilter:[sr.SacredSite],targetFilter:[sr.Invaders],range:1,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{textArea:[.637,.677],text:"2 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(2)}},{textArea:[.679,.719],text:"Push up to 2 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(2,e.Dahan)}}]},Sd=[nr.Sun,nr.Moon,nr.Fire,nr.Air,nr.Water,nr.Earth,nr.Plant,nr.Animal],Od={name:"Spirits May Yet Dream",type:Sn.Innate,speed:rr.Fast,set:a.Base,target:ir.Spirit,effects:[{text:"Turn any face-down Fear Card face-up. (It's earned/resolved normally, but players can see what's coming.)",[yn.TargetSpirit]:async({$:e})=>{const a=await e.pickAFaceDownFearCard();if(null!=a){const t=await e.revealFearCardInDeck(a);null!==t&&await e.query({query:pn.ClickToContinueCard,items:[t],actionIds:[t]})}},threshold:{[nr.Moon]:2,[nr.Air]:2}},{text:"Target Spirit gains an Element they have at least 1 of.",[yn.TargetSpirit]:async({spirit:e})=>{const a=await e.gainElements({possiblyWithConvert:!0,elements:[...Sd].filter((a=>e.hasElementsWithConvert({[a]:1})))});await e.convertElements(a);const t=Object.keys(a).find((e=>1===a[e]));void 0!==t&&1===e.elements[t]&&await e.convertElements({[t]:1})},threshold:{[nr.Moon]:3}}]},Cd={name:"A Year Of Perfect Stillness",type:Sn.Unique,speed:rr.Fast,energy:3,elements:[nr.Sun,nr.Earth],set:a.Base,target:ir.Land,range:1,effects:[{textArea:[.719,.814],text:"Invaders skip all Actions in target land this turn.",[yn.InTargetLand]:async({land:e})=>{await e.skipInvaderAction({all:!0})}}]},Dd={name:"Draw Of The Fruitful Earth",type:Sn.Unique,speed:rr.Slow,energy:1,elements:[nr.Earth,nr.Plant,nr.Animal],set:a.Base,target:ir.Land,range:1,hasPushOrGather:!0,effects:[{textArea:[.722,.762],text:"Gather up to 2 <explorer>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(2,e.Explorer)}},{textArea:[.766,.806],text:"Gather up to 2 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(2,e.Dahan)}}]},Bd={[sr.Beasts]:({$:e,land:a})=>a.has(e.Beasts),[sr.Blight]:({$:e,land:a})=>a.has(e.Blight),[sr.BlightAndInvaders]:({$:e,land:a})=>a.hasAllOf(e.Blight,e.Invader),[sr.City]:({$:e,land:a})=>a.has(e.City),[sr.Coastal]:({land:e})=>e.isCoastal,[sr.CoastalCity]:({$:e,land:a})=>a.isCoastal&&a.has(e.City),[sr.Dahan]:({$:e,land:a})=>a.has(e.Dahan),[sr.Deeps]:({$:e,land:a})=>a.has(e.Deeps),[sr.Disease]:({$:e,land:a})=>a.has(e.Disease),[sr.Incarna]:({$:e,land:a})=>a.has(e.Incarna),[sr.IncarnaAndDahan]:({$:e,land:a})=>a.hasAllOf(e.Incarna,e.Dahan),[sr.IncarnaBehemoth]:({$:e,land:a})=>a.has(e.IncarnaBehemoth),[sr.IncarnaLair]:({$:e,land:a})=>a.has(e.IncarnaLair),[sr.IncarnaRoots]:({$:e,land:a})=>a.has(e.IncarnaRoots),[sr.IncarnaVoice]:({$:e,land:a})=>a.has(e.IncarnaVoice),[sr.Inland]:({land:e})=>e.isInland,[sr.Invaders]:({land:e})=>e.hasInvaders,[sr.InvadersAndIncarnaRoots]:({$:e,land:a})=>a.hasAllOf(e.Invader,e.IncarnaRoots),[sr.Jungle]:({land:e})=>e.isJungle,[sr.JunglesOrWetlands]:({land:e})=>e.isJungleOrWetlands,[sr.Mountain]:({land:e})=>e.isMountains,[sr.MountainOrJungles]:({land:e})=>e.isMountainsOrJungles,[sr.NoInvaders]:({$:e,land:a})=>a.doesntHave(e.Invader),[sr.NonBlight]:({$:e,land:a})=>a.doesntHave(e.Blight),[sr.NonOceanLand]:({land:e})=>!e.isOcean,[sr.NotWetlands]:({land:e})=>!e.isWetlands,[sr.Quake]:({$:e,land:a})=>a.has(e.Quake),[sr.SacredSite]:({land:e,owner:a,helpers:t})=>e.hasSacredSiteOf(a,t),[sr.SacredSiteAndDahan]:({$:e,land:a,owner:t,helpers:n})=>a.hasSacredSiteOf(t,n)&&a.has(e.Dahan),[sr.Sands]:({land:e})=>e.isSands,[sr.Strife]:({land:e})=>e.hasStrife,[sr.TheEndlessDark]:({land:e})=>e.isTheEndlessDark,[sr.Town]:({$:e,land:a})=>a.has(e.Town),[sr.TownOrCity]:({$:e,land:a})=>a.has(e.TownOrCity),[sr.TwoBeasts]:({$:e,land:a})=>a.hasAtLeast(2,e.Beasts),[sr.TwoBeastsAndInvaders]:({$:e,land:a})=>a.hasAtLeast(2,e.Beasts)&&a.hasInvaders,[sr.TwoDahan]:({$:e,land:a})=>a.hasAtLeast(2,e.Dahan),[sr.WardTheShores]:({$:e,land:a,owner:t})=>2*(a.numberOf(e.Blight)+a.numberOf(e.TownOrCity))<=t.energy,[sr.Wetlands]:({land:e})=>e.isWetlands},kd={[En.Minor]:{name:"Minor",text:"Minor Power",cardTypes:[Sn.Minor]},[En.Major]:{name:"Major",text:"Major Power",cardTypes:[Sn.Major]},[En.Unique]:{name:"Unique",text:"Unique Power",cardTypes:[Sn.Unique]},[En.Innate]:{name:"Innate",text:"Innate Power",cardTypes:[Sn.Innate]},[En.NonMinorCard]:{name:"Non-Minor",text:"non-Minor Power",cardTypes:[Sn.Major,Sn.Unique]},[En.NonMajorCard]:{name:"Non-Major",text:"non-Major Power",cardTypes:[Sn.Minor,Sn.Unique]},[En.NonUniqueCard]:{name:"Non-Unique",text:"non-Unique Power",cardTypes:[Sn.Minor,Sn.Major]},[En.AnyCard]:{name:"Any Card",text:"any Power Card",cardTypes:[Sn.Minor,Sn.Major,Sn.Unique,Sn.Scenario]},[En.Any]:{name:"Any",text:"any Power",cardTypes:[Sn.Minor,Sn.Major,Sn.Unique,Sn.Innate]}},Ld={[ur.Another]:({$:e,spirit:a,owner:t})=>a!==t||1===e.spiritCount,[ur.Yourself]:({spirit:e,owner:a})=>e===a};var Fd,Rd;!function(e){e.InHand="InHand",e.PlayedFast="PlayedFast",e.PlayedSlow="PlayedSlow",e.ResolvedFast="ResolvedFast",e.ResolvedSlow="ResolvedSlow",e.Discarded="Discarded",e.Impending="Impending"}(Fd||(Fd={})),function(e){e.ADiversityOfSpirits="ADiversityOfSpirits",e.Blitz="Blitz",e.DahanInsurrection="DahanInsurrection",e.DespicableTheft="DespicableTheft",e.DestinyUnfold="DestinyUnfold",e.ElementalInvocation="ElementalInvocation",e.GuardTheIslesHeart="GuardTheIslesHeart",e.LargerSurges="LargerSurges",e.PowersLongForgotten="PowersLongForgotten",e.RitualsOfTerror="RitualsOfTerror",e.RitualsOfTheDestroyingFlame="RitualsOfTheDestroyingFlame",e.SecondWave="SecondWave",e.SurgesOfColonization="SurgesOfColonization",e.TheGreatRiver="TheGreatRiver",e.VariedTerrain="VariedTerrain",e.WardTheShores="WardTheShores"}(Rd||(Rd={}));var Nd=function(e,a,t,n){var r,i=arguments.length,s=i<3?a:null===n?n=Object.getOwnPropertyDescriptor(a,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,a,t,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(i<3?r(s):i>3?r(a,t,s):r(a,t))||s);return i>3&&s&&Object.defineProperty(a,t,s),s};class $d{data;power;assisted=!1;impendingEnergy=0;status;$;blessed=!1;constructor(e,a,t){Xo.makeObservable(this),this.$=e,this.power=a,this.data=sg[this.power],this.status=t}get availablePresenceForTargeting(){return this.owner.availablePresenceForTargeting}get costTime(){return this.$.sumEffects(yn.PowerCostExtraTime,{power:this})}get costToPlay(){if(this.assisted)return 0;let e=this.data.energy||0;return e+=this.$.scenario===Rd.Blitz&&this.data.speed===rr.Fast?-1:0,e}get estimatedValueOfPower(){const e=[];for(const a of this.data.effects)if(a.threshold&&this.owner.hasElementsWithConvert(a.threshold)){if(a.instead){const t=this.data.effects.indexOf(a)-1,n=this.data.effects[t];e.includes(n)&&qr(e,n)}e.push(a)}return e.map((e=>Math.max(...Object.values(e.threshold))))}get hasThresholds(){return this.data.effects.some((e=>void 0!==e.threshold))}get helpers(){return this.owner.extraPresenceAvailableForTargeting}get isBlessed(){return this.blessed}get isCardWithDamageAndDestroy(){return this.isA(En.AnyCard)&&(!!this.data.hasDamageInstructions||!!this.data.hasDestroyInstructions)}get isFast(){return this.status===Fd.PlayedFast||this.status===Fd.ResolvedFast}get isImpending(){return this.status===Fd.Impending}get isInDiscard(){return this.status===Fd.Discarded}get isInHand(){return this.status===Fd.InHand}get isInPlay(){return[Fd.PlayedFast,Fd.PlayedSlow,Fd.ResolvedFast,Fd.ResolvedSlow].includes(this.status)}get isLowestCostOfPlayedCards(){return!this.owner.powers.filter((e=>e.isInPlay&&e.isA(En.AnyCard)&&!e.assisted)).some((e=>e.costToPlay<this.costToPlay))}get isPlayable(){return this.isInHand&&(this.costToPlay<=this.owner.energy||this.owner.canPlayCardsWithoutCost)&&this.data.type!==Sn.Innate}get isResolved(){return this.status===Fd.ResolvedFast||this.status===Fd.ResolvedSlow}get isSlow(){return this.status===Fd.PlayedSlow||this.status===Fd.ResolvedSlow}get mayChangeSpeed(){return!this.$.someEffect(yn.PreventChangeSpeedOfPower,{power:this})&&this.$.someEffect(yn.MayChangeSpeedOfPower,{power:this})||void 0!==sg[this.power].mayBeSpeed&&sg[this.power].mayBeSpeed.condition({speed:this.isFast?rr.Slow:rr.Fast,spirit:this.owner})}get mayIgnoreRangeWhenTargetingLand(){return(e,a)=>this.$.someEffect(yn.MayIgnoreRangeWhenTargetingLand,{power:this,land:e,afterTargeting:a})}get owner(){const e=this.$.spirits.find((e=>e.powers.includes(this)));return void 0!==e?e:this.$.spirits.find((e=>e.hasPower(this.power)))}get ownerHasEnoughElementsToCastPower(){if(!this.hasThresholds)return!0;let e;for(const a of this.data.effects)if(a.threshold&&!a.dontResolveAlone&&(void 0===e&&(e=this.$.landElements),this.owner.hasElementsWithConvert(a.threshold,this.data.target===ir.Land?e:void 0)))return!0;return!1}get powerLink(){return this.data.type===Sn.Innate?this.data.name:`<p>${this.power}</p>`}get serialized(){return this.power}get sourceFilter(){return this.targetingLandFilter(this.data.sourceFilter??[],this.owner,this.helpers)}get targetingLandFilter(){return(e,a,t)=>n=>0===e.length||e.some((e=>Bd[e]({land:n,$:this.$,owner:a,helpers:t})))}get validOriginSites(){return this.assisted?this.$.inLands():id.createCollection(this.$,this.availablePresenceForTargeting.map((e=>e.location)).filter((e=>this.sourceFilter(e))))}get validTargetSites(){return this.$.inTargetableLandsWhere((e=>this.targetingLandFilter(this.data.targetFilter??[],this.owner,this.helpers)(e)||this.$.someEffect(yn.MayIgnoreTargetFilterWhenTargetingLand,{power:this})))}static createCollection(e,a){return new Yo(e,pn.SelectPower,a)}async bless(){this.blessed=!0,await this.setStatus(this.data.speed===rr.Fast?Fd.PlayedFast:Fd.PlayedSlow)}async changeSpeedIfNeeded(e){if((this.status===Fd.PlayedSlow||this.status===Fd.ResolvedSlow)&&e===rr.Fast||(this.status===Fd.PlayedFast||this.status===Fd.ResolvedFast)&&e===rr.Slow){const a=this.owner,t=[];sg[this.power].mayBeSpeed?.condition({speed:e,spirit:this.owner})&&t.push({...sg[this.power].mayBeSpeed.effect,actionId:`ChangeSpeed${t.length}`,name:sg[this.power].name,card:this.power,highlightPowers:[this],players:[a],spirit:a});for(const a of this.$.effectsOfType(yn.MayChangeSpeedOfPower).filter((e=>e[yn.MayChangeSpeedOfPower]?.({power:this}))))t.push({actionId:`ChangeSpeed${t.length}`,text:a.text,[yn.Now]:async()=>{await this.$.doEffect(a,yn.ChangeSpeedOfPower,{power:this}),await this.$.doEffects(yn.AfterChangingSpeed,{effect:a,power:this,speed:e})}});await this.$.doPowerAction(this.owner,(async()=>{await this.$.chooseBetween({name:`Change speed of ${sg[this.power].name}`,text:"There are multiple ways to change speed of this power.",autoPlayOneOption:!0,effects:t})}),this)}}async discard(){this.assisted?await this.owner.forgetPowerState(this,{canRegain:!1,silent:!0}):(await this.setStatus(Fd.Discarded),await this.$.sendEvent({type:fn.PowerCardDiscarded,powerType:this.power}),await this.didLeavePlay())}async forget(e={}){const a=await(this.owner?.forgetPowerState(this,e))??null;return a&&await a.didLeavePlay(),a}async fulfillsThreshold(e,a,t){return!(t===ir.Land&&void 0!==e.targetLandThresholdCondition&&!e.targetLandThresholdCondition(a))&&(!(void 0!==e.powerOwnerThresholdCondition&&!e.powerOwnerThresholdCondition(this.owner))&&(void 0===e.threshold||!e.noConvertToThreshold&&!this.owner.didNotWantToReachThreshold.some((a=>{return t=a,n=e.threshold,!Object.keys(t).some((e=>void 0===n[e]||t[e]>n[e]));var t,n}))&&!!await this.owner.askToConvertElements(e.threshold,{optionalThreshold:!1})))}isA(e){return kd[e].cardTypes.includes(this.data.type)}landsWhichCanBeShiftedIntoToEnableTarget(e){const{targetLocation:a,range:t}=e;let n=t;return null!==n&&void 0!==this.data.modifiesRangePerLand&&(n+=this.data.modifiesRangePerLand.condition({$:this.$,spirit:this.owner,land:a})?this.data.range:0),a.inThisAndAdjacentLands().where((e=>!this.validOriginSites.has(e)&&(e.hasOnePieceWhere((e=>this.availablePresenceForTargeting.includes(e)))&&(null===n||e.landsWithin(n,this.owner,{targetingLands:!0}).includes(a))&&this.validTargetSites.has(a)&&(this.data.sourceFilter?.includes(sr.SacredSite)&&e.hasPresenceOf(this.owner,this.helpers)||!this.data.sourceFilter?.includes(sr.SacredSite)&&!e.hasPresenceOf(this.owner,this.helpers)&&this.sourceFilter(e)))))}async makeFast(){this.status===Fd.PlayedSlow?await this.setStatus(Fd.PlayedFast):this.status===Fd.ResolvedSlow&&await this.setStatus(Fd.ResolvedFast)}async makeSlow(){this.status===Fd.PlayedFast?await this.setStatus(Fd.PlayedSlow):this.status===Fd.ResolvedFast&&await this.setStatus(Fd.ResolvedSlow)}async maximizedThresholdsForPower(e,a){const t=[];this.owner&&(this.owner.didNotWantToReachThreshold=[]);for(const n of this.data.effects)if(await this.fulfillsThreshold(n,a,e)){if(n.instead){const e=this.data.effects.indexOf(n)-1,a=this.data.effects[e];t.includes(a)&&qr(t,a)}t.push(n)}else n.instead||t.push(n);return t}async payForPlay(e={}){const{payHalfRoundUp:a}=e;this.costToPlay>0?await this.owner.payEnergy(a?Math.ceil(this.costToPlay/2):this.costToPlay):this.costToPlay<0&&await this.owner.gainEnergy(-this.costToPlay)}async pickValidOriginTarget(){const e=this.validOriginSites;!this.assisted&&this.owner.mayShift&&void 0!==this.data.sourceFilter&&this.data.sourceFilter.includes(sr.SacredSite)&&e.addAll(this.$.inLandsWhere((a=>!e.has(a)&&a.inThisAndAdjacentLands().sum((e=>e.numberOfPresenceOf(this.owner,this.helpers)))>=2)).items);let a=null;return await e.autoPickOne((async e=>{a=e,await this.$.doEffects(yn.AfterTargetingSource,{power:this,land:e})}),{text:"Pick origin.",noOptions:"No valid source lands."}),a}async play(e={}){if(this.isInPlay)return;const{payHalfRoundUp:a=!1,withoutPaying:t=!1,withoutUsingCardPlays:n=!1,withoutImpending:r=!1}=e;this.data.type===Sn.Innate||this.blessed||this.assisted||n||(this.owner.cardsPlayedThisTurn.push(this),this.isCardWithDamageAndDestroy||(this.owner.usedCardPlaysForNonDamageAndDestroy+=this.owner.cardPlaysCostToPlayPowerCard));const{data:i,owner:s}=this;r||!await this.$.oneEffectActivates(yn.AdjustPlayPower,{power:this})?(this.data.type!==Sn.Innate&&await this.$.sendEvent({type:fn.PowerCardPlayed,spirit:s,power:this}),await this.setPlayed(),i.type===Sn.Innate||this.blessed||t||0===this.costToPlay||await this.payForPlay({payHalfRoundUp:a})):this.owner.cardsMadeImpendingThisTurn.push(this.power)}possibleToRepeatAtSpeed(e){return this.status===Fd.ResolvedFast&&e===rr.Fast||this.status===Fd.ResolvedSlow&&e===rr.Slow||this.status===Fd.ResolvedFast&&e===rr.Slow&&this.mayChangeSpeed}range(e,a){const t=this.data.ranges,n=this.data.range;if(!t&&void 0===n)return null;const r=this.data.modifiesRange?.({spirit:this.owner,withConvert:!a})??0;return t?t[e]+r:n+r}async reclaim(){await this.setStatus(Fd.InHand),await this.$.sendEvent({type:fn.PowerCardReclaimed,spirit:this.owner,power:this}),await this.didLeavePlay(),this.$.spiritPhase&&(this.owner.hasReclaimedACardDuringSpiritPhase=!0)}async repeat(){await this.$.addEffectUntilEndOfActionTree({[yn.ActionEnds]:async()=>{void 0!==this.owner&&await this.owner.targetAndResolvePower(this,!0)}})}async repeatInLocations(e,a=!0){const t=this.owner;void 0!==t&&(a?await this.$.addEffectUntilEndOfActionTree({[yn.ActionEnds]:async()=>{await t.doPowerAction((async()=>{this.data.type===Sn.Innate&&await t.possiblyDowngradeElements(this),await t.resolvePowerInLocations(this,e,!0)}),this)}}):await t.doPowerAction((async()=>{this.data.type===Sn.Innate&&await t.possiblyDowngradeElements(this),await t.resolvePowerInLocations(this,e,!0)}),this))}async replay(e){await this.changeSpeedIfNeeded(e),await this.setStatus(this.status===Fd.ResolvedFast?Fd.PlayedFast:Fd.PlayedSlow)}async setImpending(e){this.impendingEnergy=e,await this.setStatus(Fd.Impending)}async setPlayed(){await this.$.oneEffectActivates(yn.AdjustPowerSpeedOnPlay,{power:this})||await this.setStatus(this.data.speed===rr.Fast?Fd.PlayedFast:Fd.PlayedSlow)}async setResolved(){await this.setStatus(this.data.speed===rr.Fast?Fd.ResolvedFast:Fd.ResolvedSlow)}setStatus(e){return this.status=e,this.owner?.invalidatePowerElementCache(),Promise.resolve()}async timePasses(){this.blessed?await this.setPlayed():this.isInPlay&&(this.data.type===Sn.Innate?await this.setStatus(Fd.InHand):await this.discard())}toString(){return`${Mi[this.power]} [${Fd[this.status]}]`}validLandTargets(e={}){const{ignorePowerModifiesRange:a=!1,origin:t,targetIndex:n=0,mustTargetAdjacent:r=!1}=e,i=this.validLandTargetsWithoutShift({ignorePowerModifiesRange:a,source:t,targetIndex:n,mustTargetAdjacent:r});if(this.owner.mayShift&&void 0===t){const e=this.$.inLandsWhere((e=>{if(i.has(e))return!1;return!this.landsWhichCanBeShiftedIntoToEnableTarget({targetLocation:e,range:this.range(n,a)}).isEmpty}));i.addAll(e.items)}return i}validLandTargetsWithoutShift(e={}){const{ignorePowerModifiesRange:a=!1,source:t,targetIndex:n=0,mustTargetAdjacent:r=!1}=e,i=new Set;if(this.assisted)return this.$.inLandsWhere((e=>!e.targetingIsPrevented));const s=this.validTargetSites,o=this.range(n,a),d=this.validOriginSites;for(const e of d.items)if(void 0===t||t===e){let a;if(a=r?e.adjacentLands:null===o?this.$.lands:e.landsWithin(o,this.owner,{targetingLands:!0}),a.forEach((e=>{i.add(e)})),void 0!==this.data.modifiesRangePerLand&&null!==o){const a=this.data.modifiesRangePerLand.range;e.landsWithin(o+a,this.owner,{targetingLands:!0}).filter((e=>this.data.modifiesRangePerLand.condition({$:this.$,spirit:this.owner,land:e}))).forEach((e=>{i.add(e)}))}}return this.$.inTargetableLandsWhere((e=>this.mayIgnoreRangeWhenTargetingLand(e,!1))).items.forEach((e=>{i.add(e)})),s.copy().where((e=>i.has(e)&&!e.targetingIsPrevented))}validOriginsGivenTargetLand(e){const a=new Set,t=this.owner,n=t.extraPresenceAvailableForTargeting,r=this.mayIgnoreRangeWhenTargetingLand(e,!0),i=this.data.modifiesRange?.({spirit:t,withConvert:!0})??0;return Cr([...t.lands,...n.map((e=>e.location))]).filter(this.targetingLandFilter(this.data.sourceFilter??[],t,n)).filter((a=>r||a.landsWithin(this.data.range+i,t,{targetingLands:!0}).some((a=>a===e)))).forEach((e=>{a.add(e)})),id.createCollection(this.$,Array.from(a))}validSpiritTargets(){return this.$.spiritsWhich(this.targetingSpiritFilter(this.data.targetFilter??[],this.owner))}get targetingSpiritFilter(){return(e,a)=>t=>{if(e.length>0&&!e.some((e=>Ld[e]({$:this.$,spirit:t,owner:a}))))return!1;if(this.$.config.archipelagos){const e=a.boardDistanceToSpirit(t);if(null===e||a.energy<e)return!1}return!0}}didLeavePlay(){return this.$.doEffects(yn.AfterPowerLeavesPlay,{power:this})}}Nd([Re],$d.prototype,"assisted",void 0),Nd([Re],$d.prototype,"impendingEnergy",void 0),Nd([Re],$d.prototype,"status",void 0),Nd([Re],$d.prototype,"blessed",void 0);const Wd={name:"Earth Moves With Vigor And Might",type:Sn.Innate,speed:rr.Fast,set:a.FeatherAndFlame,target:ir.Spirit,targetFilter:[ur.Yourself],effects:[{text:"You may play an additional Power Card by paying 1 Energy plus its cost. (It's elements apply for the rest of this Innate Power's thresholds.)",[yn.TargetSpirit]:async({$:e,you:a})=>{const t=$d.createCollection(e,a.powers.filter((e=>e.isInHand&&e.costToPlay+1<=e.owner.energy&&e.data.type!==Sn.Innate)));t.count>0&&await e.may({prompt:"Play an additional Power Card by paying 1 Energy plus its cost?"})&&await t.pickOne((async e=>{await e.play({withoutUsingCardPlays:!0}),await a.payEnergy(1)}))},threshold:{[nr.Plant]:1}},{text:"You do +1 Damage with each Damage-dealing Power you use this turn.",[yn.TargetSpirit]:async({spirit:e,you:a})=>{await e.gainDamageBoost({amount:1,source:a})},threshold:{[nr.Sun]:1,[nr.Earth]:2}},{text:"You do +1 Damage with each Damage-dealing Power you use this turn.",[yn.TargetSpirit]:async({spirit:e,you:a})=>{await e.gainDamageBoost({amount:1,source:a})},threshold:{[nr.Plant]:2,[nr.Earth]:3}},{text:"Gain a Power Card.",[yn.TargetSpirit]:async({you:e})=>{await e.gainPowerCard()},threshold:{[nr.Sun]:1,[nr.Plant]:3}}]},Md=async({$:e,maxCost:a,you:t,spirit:n})=>{let r=1;await e.addSubEffectUntilEndOfTurn({[yn.GlobalReminder]:()=>({icon:"Gift Of<br>Strength",spirit:t,players:[n]}),[yn.MayRepeatPowercard]:({power:e,speed:t})=>r>0&&e.owner===n&&(e.costToPlay||0)<=a&&e.data.type!==Sn.Innate&&e.possibleToRepeatAtSpeed(t),[yn.RepeatPowerCard]:async({power:e,speed:a})=>{r-=1,await e.replay(a)}})},Gd={name:"Gift Of Strength",type:Sn.Innate,speed:rr.Fast,set:a.Base,target:ir.Spirit,effects:[{text:"Once this turn, Target Spirit may Repeat 1 Power Card with Energy cost of 1 or less.",[yn.TargetSpirit]:async({$:e,spirit:a,you:t})=>{await Md({$:e,you:t,spirit:a,maxCost:1})},threshold:{[nr.Sun]:1,[nr.Earth]:2,[nr.Plant]:2}},{instead:!0,text:"Instead, the Energy cost limit is 3 or less.",[yn.TargetSpirit]:async({$:e,spirit:a,you:t})=>{await Md({$:e,you:t,spirit:a,maxCost:3})},threshold:{[nr.Sun]:2,[nr.Earth]:3,[nr.Plant]:2}},{instead:!0,text:"Instead, the Energy cost limit is 6 or less.",[yn.TargetSpirit]:async({$:e,spirit:a,you:t})=>(await Md({$:e,you:t,spirit:a,maxCost:6}),Promise.resolve()),threshold:{[nr.Sun]:2,[nr.Earth]:4,[nr.Plant]:3}}]},Hd={name:"Guard The Healing Land",type:Sn.Unique,speed:rr.Fast,energy:3,elements:[nr.Water,nr.Earth,nr.Plant],set:a.Base,target:ir.Land,sourceFilter:[sr.SacredSite],range:1,blightWhiteListedPower:!0,effects:[{textArea:[.722,.762],text:"Remove 1 <blight>.",[yn.InTargetLand]:async({land:e})=>{await e.removeBlight()}},{textArea:[.768,.808],text:"Defend 4.",[yn.InTargetLand]:async({land:e})=>{e.isLand&&await e.defend(4)}}]},jd={name:"Imbue With Nourishing Vitality",type:Sn.Innate,speed:rr.Fast,set:a.NatureIncarnate,target:ir.Land,hasPushOrGather:!0,range:1,sourceFilter:[sr.SacredSite],targetFilter:[sr.NonBlight],effects:[{textArea:[.568,.645],text:"Gather up to 1 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(1,e.Dahan)},threshold:{[nr.Water]:1,[nr.Plant]:1}},{textArea:[.668,.745],text:"Add 1 <vitality>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Vitality)},threshold:{[nr.Water]:1,[nr.Plant]:2}},{textArea:[.747,.889],text:"Each <dahan> has +2 Health while in target land. If target land has at least 2 <dahan>, Add 1 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.addSubEffectUntilEndOfTurn({[yn.Reminder]:e=>e===a?"Each <dahan> has +2 Health while in target land.":void 0,[yn.AdjustHealth]:({piece:t})=>t.location===a&&t.isA(e.Dahan)?2:0}),a.hasAtLeast(2,e.Dahan)&&await a.add(1,e.Dahan)},threshold:{[nr.Water]:1,[nr.Earth]:1,[nr.Plant]:2}}]},Ud={name:"Rituals Of Destruction",type:Sn.Unique,speed:rr.Slow,energy:3,elements:[nr.Sun,nr.Moon,nr.Fire,nr.Earth,nr.Plant],set:a.Base,target:ir.Land,sourceFilter:[sr.SacredSite],targetFilter:[sr.Dahan],range:1,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.68,.72],text:"2 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(2)}},{textArea:[.761,.855],text:"If target land has at least 3 <dahan>, +3 Damage and 2 <fear>.",[yn.InTargetLand]:async({$:e,land:a})=>{a.hasAtLeast(3,e.Dahan)&&(await a.damage(3),await a.fear(2))}}]},qd={name:"All-Enveloping Green",type:Sn.Innate,speed:rr.Fast,set:a.Base,target:ir.Land,sourceFilter:[sr.SacredSite],range:1,blightWhiteListedPower:!0,effects:[{text:"Defend 2.",[yn.InTargetLand]:async({land:e})=>{e.isLand&&await e.defend(2)},threshold:{[nr.Water]:1,[nr.Plant]:3}},{instead:!0,text:"Instead, Defend 4.",[yn.InTargetLand]:async({land:e})=>{e.isLand&&await e.defend(4)},threshold:{[nr.Water]:2,[nr.Plant]:4}},{text:"Also, remove 1 <blight>.",[yn.InTargetLand]:async({land:e})=>{await e.removeBlight()},threshold:{[nr.Water]:3,[nr.Earth]:1,[nr.Plant]:5}}]},_d={name:"Belligerent And Aggressive Crops",type:Sn.Unique,speed:rr.Slow,energy:1,elements:[nr.Sun,nr.Fire,nr.Plant],set:a.NatureIncarnate,target:ir.Land,range:2,sourceFilter:[sr.SacredSite],targetFilter:[sr.TownOrCity],generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.694,.735],text:"Add 1 <wilds>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Wilds)}},{textArea:[.758,.799],text:"1 Damage, to <town>/<city> only.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.damage(1,e.TownOrCity)}},{textArea:[.817,.913],text:"If there are any adjacent <wilds>:<br>1 <fear>. 1 Damage, to <town>/<city> only.",[yn.InTargetLand]:async({$:e,land:a})=>{a.hasAdjacentLandWithPiece(e.Wilds)&&(await a.fear(1),await a.damage(1,e.TownOrCity))}}]},Jd={name:"Creepers Tear Into Mortar",type:Sn.Innate,speed:rr.Slow,set:a.Base,target:ir.Land,range:0,hasDamageInstructions:!0,effects:[{text:"1 Damage to 1 <town>/<city>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.damage(1,e.TownOrCity,{maxTargets:1})},threshold:{[nr.Moon]:1,[nr.Plant]:2}},{text:"Repeat this Power.",[yn.InTargetLand]:async({power:e,isRepeat:a})=>{a||await e.repeat()},threshold:{[nr.Moon]:2,[nr.Plant]:3}},{text:"Repeat this Power again.",[yn.InTargetLand]:async({power:e,isRepeat:a})=>{a||await e.repeat()},threshold:{[nr.Moon]:3,[nr.Plant]:4}}]},Vd={name:"Fields Choked With Growth",type:Sn.Unique,speed:rr.Slow,energy:0,elements:[nr.Sun,nr.Water,nr.Plant],set:a.Base,target:ir.Land,range:1,hasPushOrGather:!0,effects:[{textArea:[.696,.837],text:"Push 1 <town>.<or>Push 3 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"PushTown",textArea:[.703,.743],text:"Push 1 <town>.",[yn.Now]:async()=>{await a.pushOne(e.Town)}},{actionId:"PushDahan",textArea:[.789,.829],text:"Push 3 <dahan>.",[yn.Now]:async()=>{await a.push({amount:3,pieces:e.Dahan})}}]})}}]},Yd={name:"Gift Of Proliferation",type:Sn.Unique,speed:rr.Fast,energy:1,elements:[nr.Moon,nr.Plant],set:a.Base,target:ir.Spirit,targetFilter:[ur.Another],effects:[{textArea:[.72,.817],text:"Target Spirit adds 1 <presence> up to <range-1> from their <presence>.",[yn.TargetSpirit]:async({spirit:e})=>{await e.addPresenceInRange(1)}}]},zd={name:"Impenetrable Tangles Of Greenery",type:Sn.Innate,speed:rr.Fast,set:a.NatureIncarnate,target:ir.Land,hasPushOrGather:!0,range:0,effects:[{textArea:[.51,.563],text:"Add 1 <wilds>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Wilds)},threshold:{[nr.Sun]:1,[nr.Plant]:2}},{textArea:[.626,.679],text:"Push 1 <explorer>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushOne(e.Explorer)},threshold:{[nr.Sun]:2,[nr.Plant]:3}},{textArea:[.739,.792],text:"Isolate target land.",[yn.InTargetLand]:async({land:e})=>{await e.isolate()},threshold:{[nr.Sun]:2,[nr.Plant]:4}},{textArea:[.859,.912],text:"Downgrade 1 <city>. Add 1 <wilds>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.downgrade({pieces:e.City}),await a.add(1,e.Wilds)},threshold:{[nr.Sun]:3,[nr.Plant]:5}}]},Qd={name:"Overgrow In ANight",type:Sn.Unique,speed:rr.Fast,energy:2,elements:[nr.Moon,nr.Plant],set:a.Base,target:ir.Land,range:1,effects:[{textArea:[.676,.857],text:"Add 1 <presence>.<or>If target land has your <presence> and Invaders, 3 <fear>.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await e.chooseBetween({effects:[{actionId:"AddPresence",textArea:[.679,.719],text:"Add 1 <presence>.",[yn.Now]:async()=>{await t.addPresence(a)}},{actionId:"Fear",textArea:[.762,.854],text:"If target land has your <presence> and Invaders, 3 <fear>.",[yn.Now]:async()=>{await t.fear(3)},condition:()=>t.hasPresenceOf(a)&&t.hasInvaders}]})}}]},Kd={name:"Stem The Flow Of Fresh Water",type:Sn.Unique,speed:rr.Slow,energy:0,elements:[nr.Water,nr.Plant],set:a.Base,target:ir.Land,sourceFilter:[sr.SacredSite],range:1,hasDamageInstructions:!0,effects:[{textArea:[.65,.851],text:"1 Damage to 1 <town>/<city>.<br><br>If target land is <mountains-sands>, instead, 1 Damage to each <town>/<city>.",[yn.InTargetLand]:async({$:e,land:a})=>{a.isMountainsOrSands?await e.addSubEffect({textArea:[.739,.855],text:"1 Damage to each <town>/<city>.",[yn.Now]:async()=>{await a.damageEach(1,e.TownOrCity)}}):await e.addSubEffect({textArea:[.661,.701],text:"1 Damage to 1 <town>/<city>.",[yn.Now]:async()=>{await a.damage(1,e.TownOrCity,{maxTargets:1})}})}}]},Xd={name:"Unbelievable Regrowth",type:Sn.Innate,speed:rr.Slow,set:a.NatureIncarnate,target:ir.Land,range:1,targetFilter:[sr.JunglesOrWetlands],effects:[{textArea:[.514,.567],text:"This Power may target any terrain.",[yn.InTargetLand]:async({you:e,land:a})=>{a.isJungleOrWetlands||await e.convertElements({[nr.Water]:2,[nr.Plant]:3})}},{[yn.InTargetLand]:()=>Promise.resolve(),threshold:{[nr.Water]:2,[nr.Plant]:3},noConvertToThreshold:!0,dontResolveAlone:!0},{textArea:[.626,.679],text:"Add 1 <broken>.",[yn.InTargetLand]:async({you:e,land:a})=>{await a.addPresence(e,{destroyed:!0})},threshold:{[nr.Water]:1,[nr.Plant]:3}},{textArea:[.739,.792],text:"Add 1 <broken>.",[yn.InTargetLand]:async({you:e,land:a})=>{await a.addPresence(e,{destroyed:!0})},threshold:{[nr.Water]:2,[nr.Plant]:4}},{textArea:[.863,.916],text:"Add 1 <broken> to an adjacent land.",[yn.InTargetLand]:async({you:e,land:a})=>{await a.inAdjacentLands().pickOne((async a=>{await a.addPresence(e,{destroyed:!0})}))},threshold:{[nr.Water]:3,[nr.Plant]:5}}]},Zd={name:"Exaltation Of The Storm-Wind",type:Sn.Innate,speed:rr.Fast,set:a.JaggedEarth,target:ir.Spirit,targetFilter:[ur.Another],hasPushOrGather:!0,effects:[{textArea:[.389,.513],text:"You and target Spirit may each make one of your non-Major <slow> Powers <fast>.",[yn.TargetSpirit]:async({$:e,...a})=>{await e.clickToContinue();for(const e of[a.spirit,a.you])await e.gainMakeFastBuff({filter:e=>e.data.type!==Sn.Major})},threshold:{[nr.Air]:1}},{textArea:[.526,.651],text:"You and target Spirit each gain <range+1> with all your Powers this turn.",[yn.TargetSpirit]:async({$:e,you:a,spirit:t})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({[yn.GlobalReminder]:()=>({icon:"<range+1>",spirit:a,players:[t,a]}),[yn.ExtraRange]:e=>(e.spirit===t?1:0)+(e.spirit===a?1:0)})},threshold:{[nr.Air]:3}},{textArea:[.661,.796],text:"You and target Spirit may each Push up to 2 <explorer> from one of your lands.",[yn.TargetSpirit]:async({$:e,you:a,spirit:t})=>{for(const n of[a,t])await n.inLandsWith(e.Explorer).optionallyPickOne((async a=>{await a.pushUpTo(2,e.Explorer)}),{players:[n],noOptions:`No <explorer> in lands of ${n.nameLink}.`})},threshold:{[nr.Air]:4,[nr.Water]:1}},{textArea:[.81,.887],text:"Repeat this Power.",[yn.TargetSpirit]:async({power:e,isRepeat:a})=>{a||await e.repeat()},threshold:{[nr.Air]:5,[nr.Water]:2}}]},ec={name:"Gift Of The Sparking Sky",type:Sn.Innate,speed:rr.Fast,set:a.NatureIncarnate,target:ir.Spirit,hasDamageInstructions:!0,effects:[{text:"Once this turn, after target Spirit uses a Power that targets a land, they may do 1 Damage to each Invader in that land. (This is their Action and get all benefits and penalties that apply to their Powers.).",textArea:[.259,.505],[yn.TargetSpirit]:async({$:e,spirit:a,...t})=>{const n=Re.box(!1),r={triggerId:e.nextTriggerId(),[yn.Now]:async({action:r})=>{const i=r.parentData.targetLands.filter((e=>e.exists));i.length>0&&await e.may({highlightLocations:i,prompt:`Do 1 Damage to each Invader in ${1===i.length?"this land":"in one of these lands"}?`})&&(n.set(!0),await id.createCollection(e,r.parentData.targetLands).pickOne((async e=>{await a.doPowerAction((async()=>{await e.damageEach(1)}),t.power)}),{autoPlayOneOption:!0}))}};await e.addSubEffectUntilEndOfTurn({[yn.GlobalReminder]:()=>({icon:`+1<damage><br>${n.get()?"1":"0"} / 1`,players:[a]}),[yn.AfterTargetingLands]:async i=>{i.power.owner!==a||n.get()||(e.action.data.targetLands=i.lands,await e.addTrigger(r,t.effect,t.action))}})},threshold:{[nr.Sun]:2,[nr.Fire]:5,[nr.Air]:3}},{textArea:[.545,.599],text:"Target Spirit gains a Minor Power.",[yn.TargetSpirit]:async({spirit:e})=>{await e.gainPowerCard({powerType:Sn.Minor})},threshold:{[nr.Fire]:2,[nr.Air]:2}},{textArea:[.63,.835],text:"Target Spirit may play a Power Card by paying its cost. (If you target yourself, its Elements arrive too late to apply to prior thresholds of this Power.).",[yn.TargetSpirit]:async({spirit:e})=>{await e.playAPowerCardByPayingItsCost()},threshold:{[nr.Sun]:1,[nr.Fire]:3,[nr.Air]:2}}]},ac={name:"Harbingers of the Lightning",type:Sn.Unique,speed:rr.Slow,energy:0,elements:[nr.Fire,nr.Air],set:a.Base,target:ir.Land,range:1,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.669,.86],text:"Push up to 2 <dahan>.<br><br>1 <fear> if you pushed any <dahan> into a land with <town>/<city>.",[yn.InTargetLand]:async({$:e,land:a})=>{(await a.pushUpTo(2,e.Dahan)).some((({destination:a})=>a.has(e.TownOrCity)))&&await a.fear(1)}}]},tc={name:"Lightnings Boon",type:Sn.Unique,speed:rr.Fast,energy:1,elements:[nr.Fire,nr.Air],set:a.Base,target:ir.Spirit,effects:[{textArea:[.709,.847],text:"Target Spirit may use up to 2 <slow> Powers as if they were <fast> Powers this turn.",[yn.TargetSpirit]:async({spirit:e})=>{await e.gainMakeFastBuff({amount:2})}}]},nc={name:"Lightning-Torn Skies Incite Pandemonium",type:Sn.Innate,speed:rr.Slow,set:a.JaggedEarth,target:ir.Land,sourceFilter:[sr.SacredSite],targetFilter:[sr.Invaders],range:1,generatesFear:!0,effects:[{textArea:[.413,.49],effects:[{text:"2 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(2)}},{text:"Add 1 <strife>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Strife)}}],threshold:{[nr.Fire]:3,[nr.Air]:2}},{textArea:[.496,.573],effects:[{text:"2 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(2)}},{text:"Add 1 <strife>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Strife)}}],threshold:{[nr.Fire]:4,[nr.Air]:3}},{textArea:[.6,.677],effects:[{text:"3 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(3)}},{text:"Add 1 <strife>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Strife)}}],threshold:{[nr.Fire]:5,[nr.Air]:4,[nr.Moon]:1}},{textArea:[.699,.776],effects:[{text:"4 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(4)}},{text:"Add 1 <strife>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Strife)}}],threshold:{[nr.Fire]:5,[nr.Air]:5,[nr.Moon]:2}}]},rc={name:"Raging Storm",type:Sn.Unique,speed:rr.Slow,energy:3,elements:[nr.Fire,nr.Air,nr.Water],set:a.Base,target:ir.Land,range:1,hasDamageInstructions:!0,effects:[{textArea:[.755,.795],text:"1 Damage to each Invader.",[yn.InTargetLand]:async({land:e})=>{await e.damageEach(1)}}]},ic={name:"Shatter Homesteads",type:Sn.Unique,speed:rr.Slow,energy:2,elements:[nr.Fire,nr.Air],set:a.Base,sourceFilter:[sr.SacredSite],target:ir.Land,range:2,generatesFear:!0,hasDestroyInstructions:!0,effects:[{textArea:[.722,.762],text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.766,.806],text:"Destroy 1 <town>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.destroyOne(e.Town)}}]},sc={name:"Smite The Land With Fulmination",type:Sn.Unique,speed:rr.Slow,energy:2,elements:[nr.Sun,nr.Fire,nr.Air],set:a.NatureIncarnate,target:ir.Land,range:1,hasDamageInstructions:!0,effects:[{textArea:[.739,.78],text:"1 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(1)}},{textArea:[.803,.844],text:"Add 1 <badlands>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Badlands)}}]},oc={name:"Thundering Destruction",type:Sn.Innate,speed:rr.Slow,set:a.Base,target:ir.Land,sourceFilter:[sr.SacredSite],range:1,hasDestroyInstructions:!0,effects:[{text:"Destroy 1 <town>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.destroyOne(e.Town)},threshold:{[nr.Fire]:3,[nr.Air]:2}},{instead:!0,text:"Destroy 1 <town>/<city>.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{let n=1;a.hasElements({[nr.Fire]:5,[nr.Air]:5,[nr.Water]:2})?n=3:a.hasElements({[nr.Fire]:5,[nr.Air]:4,[nr.Water]:1})&&(n=2),await e.addSubEffect({text:`Destroy ${n} <town>/<city>.`,[yn.Now]:async()=>{await t.destroyUpTo(n,e.TownOrCity)}})},threshold:{[nr.Fire]:4,[nr.Air]:3}},{threshold:{[nr.Fire]:5,[nr.Air]:4,[nr.Water]:1}},{threshold:{[nr.Fire]:5,[nr.Air]:5,[nr.Water]:2}}]},dc={name:"Call Of The Deeps",type:Sn.Unique,speed:rr.Fast,energy:0,elements:[nr.Moon,nr.Air,nr.Water],set:a.Base,target:ir.Land,targetFilter:[sr.Coastal],range:0,hasPushOrGather:!0,effects:[{textArea:[.679,.719],text:"Gather 1 <explorer>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherOne(e.Explorer)}},{textArea:[.766,.857],text:"If target land is the Ocean, you may Gather another <explorer>.",[yn.InTargetLand]:async({$:e,land:a})=>{a.isOcean&&await a.mayGather(e.Explorer)}}]},cc={name:"Grasping Tide",type:Sn.Unique,speed:rr.Fast,energy:1,elements:[nr.Moon,nr.Water],set:a.Base,target:ir.Land,targetFilter:[sr.Coastal],range:1,generatesFear:!0,effects:[{textArea:[.722,.762],text:"2 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.768,.808],text:"Defend 4.",[yn.InTargetLand]:async({land:e})=>{await e.defend(4)}}]},lc={name:"Ocean Breaks The Shore",type:Sn.Innate,speed:rr.Slow,set:a.Base,target:ir.Land,targetFilter:[sr.Coastal],range:0,effects:[{text:"Drown 1 <town>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.drown({amount:1,pieces:e.Town})},threshold:{[nr.Water]:2,[nr.Earth]:1}},{instead:!0,text:"You may instead Drown 1 <city>.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{const n=a.hasElements({[nr.Water]:4,[nr.Earth]:3})?2:1;await e.addSubEffect({text:`Drown ${n} <city>.`,[yn.Now]:async()=>{await t.drown({amount:n,pieces:e.TownOrCity})}})},threshold:{[nr.Water]:3,[nr.Earth]:2}},{threshold:{[nr.Water]:4,[nr.Earth]:3}}]},hc={name:"Pound Ships To Splinters",type:Sn.Innate,speed:rr.Fast,set:a.Base,target:ir.Land,targetFilter:[sr.Coastal],range:0,generatesFear:!0,effects:[{text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)},threshold:{[nr.Moon]:1,[nr.Air]:1,[nr.Water]:2}},{text:"+1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)},threshold:{[nr.Moon]:2,[nr.Air]:1,[nr.Water]:3}},{text:"+2 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(2)},threshold:{[nr.Moon]:3,[nr.Air]:2,[nr.Water]:4}}]},uc={name:"Reclaimed By The Deeps",type:Sn.Innate,speed:rr.Slow,set:a.NatureIncarnate,target:ir.Land,range:1,targetFilter:[sr.Deeps],hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{textArea:[.279,.341],text:"1 Damage per <deeps>, to <town>/<city> only.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.damage(a.numberOf(e.Deeps),e.TownOrCity)},threshold:{[nr.Water]:2}},{[yn.InTargetLand]:async({$:e,land:a})=>{a.hasAtLeast(3,e.Deeps)&&a.doesntHave(e.TownOrCity)&&await e.addSubEffect({effects:[{textArea:[.381,.568],text:"If at least 3 <deeps> and no <town>/<city> are present:<br>Drown all <explorer>/<dahan>.",[yn.Now]:async()=>{await a.drown({quantifier:lr.All,pieces:e.ExplorerOrDahan})}},{textArea:[.5,.562],text:"Push all but 2 <deeps>.",[yn.Now]:async()=>{await a.push({amount:a.numberOf(e.Deeps)-2,pieces:e.Deeps}),await a.remove({quantifier:lr.All,pieces:e.Deeps,removement:Nn.Silent})}},{textArea:[.555,.797],text:"Target land permanently becomes part of the Ocean on its board. Flip all remaining <deeps>; they are reminder markers for the expanded Ocean.",[yn.Now]:async()=>{if(!a.isOcean){const t=a.board.ocean,n=a.adjacentLocations.filter((e=>!t.isAdjacentTo(e)&&t!==e)).map((e=>({land1:t,land2:e})));await a.move({quantifier:lr.All,pieces:e.AllPieces,movement:Fr.Relocate,locations:{target:Jn.ToThisLocation,location:t}}),a.exists=!1,await e.addSubEffect({[yn.Flooded]:e=>e.location===a,[yn.ExtraAdjacency]:()=>n}),e.setupAdjacencies()}}}]})},threshold:{[nr.Water]:4,[nr.Earth]:2}},{textArea:[.802,.929],text:"Repeat this Power in target land or in a land with your <presence>.",[yn.InTargetLand]:async({land:e,you:a,isRepeat:t,power:n})=>{if(!t){const t=a.inLands();t.has(e)||t.add(e),await t.pickOne((async e=>{await n.repeatInLocations([e])}))}},threshold:{[nr.Moon]:2,[nr.Water]:3}}]},gc={name:"Swallow The Land-Dwellers",type:Sn.Unique,speed:rr.Slow,energy:0,elements:[nr.Water,nr.Earth],set:a.Base,target:ir.Land,targetFilter:[sr.Coastal],range:0,effects:[{textArea:[.756,.796],text:"Drown 1 <explorer>, 1 <town> and 1 <dahan>",[yn.InTargetLand]:async({$:e,land:a})=>{await a.drown({pieces:e.Explorer}),await a.drown({pieces:e.Town}),await a.drown({pieces:e.Dahan})}}]},fc={name:"Tidal Boon",type:Sn.Unique,speed:rr.Slow,energy:1,elements:[nr.Moon,nr.Water,nr.Earth],set:a.Base,target:ir.Spirit,targetFilter:[ur.Another],hasPushOrGather:!0,effects:[{textArea:[.615,.927],text:"Target Spirit gains 2 Energy and may Push 1 <town> and up to 2 <dahan> from one of their lands.<br><br>If <dahan> are pushed to your Ocean, you may move them to any Coastal land instead of Drowning them.",[yn.TargetSpirit]:async({$:e,spirit:a,you:t})=>{await a.gainEnergy(2),await a.inLands().pickOne((async a=>{await a.mayPush(e.Town);const n=(await a.pushUpTo(2,e.Dahan)).filter((({destination:e})=>e.isOcean&&e.hasPresenceOf(t)));n.length>0&&await e.may({textArea:[.781,.926],text:"If <dahan> are pushed to your Ocean, you may move them to any Coastal land instead of Drowning them.",prompt:"Move the <dahan>?"})&&await e.inLandsWhere((e=>e.isCoastal)).pickOne((async e=>{for(const{piece:a}of n)await a.move({locations:{target:Jn.ToThisLocation,location:e}})}))}))}}]},pc={name:"Water Eats Away The Deep Roots Of Earth",type:Sn.Innate,speed:rr.Slow,set:a.NatureIncarnate,target:ir.Land,range:1,targetFilter:[sr.Coastal],effects:[{textArea:[.296,.358],text:"Add 1 <deeps>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Deeps)},threshold:{[nr.Water]:2}},{textArea:[.398,.529],text:"Add 1 <deeps> to a different Coastal land (on any board).",[yn.InTargetLand]:async({$:e,land:a,action:t})=>{await e.inCoastalLands().where((e=>e!==a)).pickOne((async a=>{t.data.secondLand=a,await a.add(1,e.Deeps)}))},threshold:{[nr.Water]:3}},{textArea:[.551,.755],text:"Add 1 <deeps> to a third Coastal land (on any board).",[yn.InTargetLand]:async({$:e,land:a,action:t})=>{await e.inCoastalLands().where((e=>e!==a&&e!==t.data.secondLand)).pickOne((async a=>{t.data.secondLand=a,await a.add(1,e.Deeps)}))},threshold:{[nr.Moon]:3,[nr.Water]:4,[nr.Earth]:3}}]},wc={name:"Boon Of Sunshines Promise",type:Sn.Innate,speed:rr.Fast,set:a.Base,target:ir.Spirit,targetFilter:[ur.Another],effects:[{text:"Target Spirit gains Energy equal to 1 less than the highest uncovered number on your Energy track.",[yn.TargetSpirit]:async({you:e,spirit:a})=>{await a.gainEnergy(Math.max(e.trackEnergy-1,0))},threshold:{[nr.Sun]:2}},{text:"You also gain that much Energy.",[yn.TargetSpirit]:async({you:e})=>{await e.gainEnergy(Math.max(e.trackEnergy-1,0))},threshold:{[nr.Sun]:3,[nr.Water]:3}},{text:"Target Spirit may remove 1 <blight> from any one of their lands with <dahan>.",[yn.TargetSpirit]:async({$:e,spirit:a})=>{await a.inLandsWithAllOf(e.Dahan,e.Blight).optionallyPickOne((async e=>{await e.removeBlight()}),{noOptions:`${a.nameLink} has no lands with <blight> and <dahan>.`})},threshold:{[nr.Sun]:4,[nr.Water]:2}}]},yc={name:"Boon Of Vigor",type:Sn.Unique,speed:rr.Fast,energy:0,elements:[nr.Sun,nr.Water,nr.Plant],set:a.Base,target:ir.Spirit,effects:[{textArea:[.631,.904],text:"If you target yourself, gain 1 Energy.<br><br>If you target another Spirit, they gain 1 Energy per Power Card they played this turn.",[yn.TargetSpirit]:async({you:e,spirit:a})=>{a===e?await e.gainEnergy(1):await a.gainEnergy(a.powerCardsInPlayNotBlessed.length)}}]},mc={name:"Call To A Sunlit Haven",type:Sn.Innate,speed:rr.Fast,set:a.NatureIncarnate,target:ir.Land,hasPushOrGather:!0,range:0,sourceFilter:[sr.SacredSite],effects:[{textArea:[.228,.356],text:"E is the highest uncovered number on your Energy track.",[yn.InTargetLand]:({you:e,action:a})=>(a.data.energy=e.trackEnergy,Promise.resolve())},{textArea:[.378,.432],text:"Defend E.",[yn.InTargetLand]:async({land:e,action:a})=>{await e.defend(a.data.energy)},threshold:{[nr.Sun]:1,[nr.Water]:1}},{textArea:[.458,.572],text:"In an adjacent land with your <presence>, Defend E.",[yn.InTargetLand]:async({you:e,land:a,action:t})=>{await a.inAdjacentLandsWhere((a=>a.hasPresenceOf(e))).pickOne((async e=>{await e.defend(t.data.energy)}))},threshold:{[nr.Sun]:1,[nr.Water]:2,[nr.Earth]:1}},{textArea:[.594,.766],text:"In target land or an adjacent land with your <presence>, Gather up to E <dahan>.",[yn.InTargetLand]:async({$:e,land:a,you:t,action:n})=>{await a.inThisAndAdjacentLands().where((e=>e===a||e.hasPresenceOf(t))).pickOne((async a=>{await a.gatherUpTo(n.data.energy,e.Dahan)}))},threshold:{[nr.Sun]:1,[nr.Animal]:1}},{textArea:[.781,.898],text:"Remove up to E Health worth of Invaders.",[yn.InTargetLand]:async({land:e,action:a})=>{await e.removeInvadersWorthOfHealthUpTo(a.data.energy)},threshold:{[nr.Sun]:1,[nr.Water]:1,[nr.Plant]:2}}]},vc={name:"Flash Floods",type:Sn.Unique,speed:rr.Fast,energy:2,elements:[nr.Sun,nr.Water],set:a.Base,target:ir.Land,range:1,hasDamageInstructions:!0,effects:[{textArea:[.679,.719],text:"1 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(1)}},{textArea:[.762,.854],text:"If target land is Coastal, +1 Damage.",[yn.InTargetLand]:async({land:e})=>{e.isCoastal&&await e.damage(1)}}]},Ac={name:"Massive Flooding",type:Sn.Innate,speed:rr.Slow,set:a.Base,target:ir.Land,sourceFilter:[sr.SacredSite],range:1,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{text:"Push 1 <explorer>/<town>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushOne(e.ExplorerOrTown)},threshold:{[nr.Sun]:1,[nr.Water]:2}},{instead:!0,text:"Instead, 2 Damage. Push up to 3 <explorer>/<town>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.damage(2),await a.pushUpTo(3,e.ExplorerOrTown)},threshold:{[nr.Sun]:2,[nr.Water]:3}},{instead:!0,text:"Instead, 2 Damage to each Invader.",[yn.InTargetLand]:async({land:e})=>{await e.damageEach(2)},threshold:{[nr.Sun]:3,[nr.Water]:4,[nr.Earth]:1}}]},Ic={name:"River's Bounty",type:Sn.Unique,speed:rr.Slow,energy:0,elements:[nr.Sun,nr.Water,nr.Animal],set:a.Base,target:ir.Land,range:0,hasPushOrGather:!0,effects:[{textArea:[.679,.719],text:"Gather up to 2 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(2,e.Dahan)}},{textArea:[.756,.854],text:"If there are now at least 2 <dahan>, add 1 <dahan> and gain 1 Energy.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{t.hasAtLeast(2,e.Dahan)&&(await t.add(1,e.Dahan),await a.gainEnergy(1))}}]},xc={name:"Wash Away",type:Sn.Unique,speed:rr.Slow,energy:1,elements:[nr.Water,nr.Earth],set:a.Base,target:ir.Land,range:1,hasPushOrGather:!0,effects:[{textArea:[.75,.79],text:"Push up to 3 <explorer>/<town>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(3,e.ExplorerOrTown)}}]},bc={name:"Concealing Shadows",type:Sn.Unique,speed:rr.Fast,energy:0,elements:[nr.Moon,nr.Air],set:a.Base,target:ir.Land,range:0,effects:[{textArea:[.71,.75],text:"1 fear.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.748,.84],text:"<dahan> take no Damage from Ravaging Invaders this turn.",[yn.InTargetLand]:async({$:e,land:a,effect:t})=>{await e.addSubEffectUntilEndOfTurn({[yn.Reminder]:e=>e===a?t.text:void 0,[yn.PreventDamagingPiece]:({piece:t})=>Promise.resolve(t.isA(e.Dahan)&&t.location===a&&e.action.type===Ho.NormalInvaderAction)})}}]},Tc={name:"Crops Wither And Fade",type:Sn.Unique,speed:rr.Slow,energy:1,elements:[nr.Moon,nr.Fire,nr.Plant],set:a.Base,target:ir.Land,range:0,effects:[{textArea:[.667,.707],text:"2 fear.",[yn.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.745,.894],text:"Replace 1 <town> with 1 <explorer>.<or>Replace 1 <city> with 1 <town>.",[yn.InTargetLand]:({$:e,land:a})=>e.chooseBetween({effects:[{actionId:"ReplaceTown",textArea:[.755,.795],text:"Replace 1 <town> with 1 <explorer>.",[yn.Now]:async()=>{await a.replaceOne({pieces:e.Town,withPiece:Bn.Explorer})}},{actionId:"ReplaceCity",textArea:[.842,.882],text:"Replace 1 <city> with 1 <town>.",[yn.Now]:async()=>{await a.replaceOne({pieces:e.City,withPiece:Bn.Town})}}]})}]},Ec={name:"Darkness Swallows The Unwary",type:Sn.Innate,speed:rr.Fast,set:a.Base,target:ir.Land,sourceFilter:[sr.SacredSite],range:1,hasPushOrGather:!0,generatesFear:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{text:"Gather 1 <explorer>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherOne(e.Explorer)},threshold:{[nr.Moon]:2,[nr.Fire]:1}},{text:"Destroy up to 2 <explorer>. 1 <fear> per <explorer> destroyed.",[yn.InTargetLand]:async({$:e,land:a})=>{if(a.has(e.Explorer)){const t=await a.destroyUpTo(2,e.Explorer);await a.fear(t.length)}},threshold:{[nr.Moon]:3,[nr.Fire]:2}},{text:"3 Damage. 1 <fear> per Invader destroyed by this Damage.",[yn.InTargetLand]:async({$:e,land:a})=>{const t=await a.damage(3,e.Invader);await a.fear(t.length)},threshold:{[nr.Moon]:4,[nr.Fire]:3,[nr.Air]:2}}]},Pc={name:"Enticing And Lulling Dreams",type:Sn.Innate,speed:rr.Fast,set:a.NatureIncarnate,target:ir.Land,range:1,hasPushOrGather:!0,effects:[{textArea:[.401,.517],text:"Each Invader/<dahan> does -1 Damage while in target land.",[yn.InTargetLand]:async({$:e,land:a,effect:t})=>{await e.addSubEffectUntilEndOfTurn({[yn.Reminder]:e=>e===a?t.text:void 0,[yn.AdjustIndividualInvaderRavageDamage]:e=>e.piece.location===a&&e.piece.isInvader?-1:0})},threshold:{[nr.Moon]:2,[nr.Air]:1}},{textArea:[.551,.606],text:"Gather up to 1 <explorer>/<town>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(1,e.ExplorerOrTown)},threshold:{[nr.Moon]:2,[nr.Animal]:2}},{textArea:[.633,.808],text:"Each Invader/<dahan> does -1 Damage while in target land.",[yn.InTargetLand]:async({$:e,land:a,effect:t})=>{await e.addSubEffectUntilEndOfTurn({[yn.Reminder]:e=>e===a?t.text:void 0,[yn.AdjustIndividualInvaderRavageDamage]:e=>e.piece.location===a&&e.piece.isInvader?-1:0})},threshold:{[nr.Moon]:3,[nr.Air]:2,[nr.Animal]:1}},{textArea:[.845,.9],text:"Gather up to 4 <explorer>/<town>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(4,e.ExplorerOrTown)},threshold:{[nr.Moon]:4,[nr.Air]:3,[nr.Animal]:2}}]},Sc={name:"Favors Called Due",type:Sn.Unique,speed:rr.Slow,energy:1,elements:[nr.Moon,nr.Air,nr.Animal],set:a.Base,target:ir.Land,range:1,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.68,.72],text:"Gather up to 4 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(4,e.Dahan)}},{textArea:[.756,.86],text:"If Invaders are present and <dahan> now outnumber them, 3 <fear>.",[yn.InTargetLand]:async({$:e,land:a})=>{a.hasInvaders&&a.the(e.Dahan).outnumber(e.Invader)&&await a.fear(3)}}]},Oc={name:"Mantle Of Dread",type:Sn.Unique,speed:rr.Slow,energy:1,elements:[nr.Moon,nr.Fire,nr.Air],set:a.Base,target:ir.Spirit,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.71,.75],text:"2 <fear>.",[yn.TargetSpirit]:async({$:e})=>{await e.fear(2)}},{textArea:[.745,.848],text:"Target Spirit may Push 1 <explorer> and <town> from a land where it has <presence>.",[yn.TargetSpirit]:({$:e,spirit:a})=>a.inLands().optionallyPickOne((async a=>{await a.pushOne(e.Explorer),await a.pushOne(e.Town)}))}]},Cc={name:"Stretch Out Coils of Foreboding Dread",type:Sn.Innate,speed:rr.Fast,set:a.FeatherAndFlame,target:ir.Land,range:2,hasPushOrGather:!0,generatesFear:!0,effects:[{text:"Your other Powers may ignore Range when targeting the target land.",[yn.InTargetLand]:async({$:e,you:a,land:t,effect:n})=>{await e.addSubEffectUntilEndOfTurn({[yn.Reminder]:e=>e===t?n.text:void 0,[yn.MayIgnoreRangeWhenTargetingLand]:e=>e.land===t&&e.power.owner===a})},threshold:{[nr.Air]:2}},{text:"After an action generates <fear> in target land, including from destroying <town>/<city>: Push up to 1 <explorer> per <fear> / 1 <town> per 2 <fear>. (You may mix-and-match.)",[yn.InTargetLand]:async({$:e,land:a,...t})=>{const n=e.nextTriggerId(),r={triggerId:n,[yn.Now]:async({action:t})=>{let r=t.parentData.generatedFear[n];for(;r>=1;){const t=r>1?Qn.ExplorerOrTown:Qn.Explorer,n=await a.push({quantifier:lr.UpTo,pieces:t,pickPiecesEffect:{prompt:`Pick one ${Kn[t].text} to Push. (${r} <fear> left.)`,noOptions:"No more valid Invaders to Push."}});if(0===n.length)break;n[0].piece.isA(e.Explorer)?r-=1:r-=2}}};await e.addSubEffectUntilEndOfTurn({[yn.Reminder]:e=>e===a?t.effect.text:void 0,[yn.AfterPowerGenerateFearInLand]:async({location:i,amount:s})=>{i===a&&(void 0===e.action.data.generatedFear&&(e.action.data.generatedFear={}),e.action.data.generatedFear[n]=(e.action.data.generatedFear[n]??0)+s,await e.addTrigger(r,t.effect,t.action))}})},threshold:{[nr.Moon]:1}},{text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)},threshold:{[nr.Fire]:2}},{text:"+2 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(2)},threshold:{[nr.Moon]:2,[nr.Air]:4}}]},Dc={name:"Gather The Warriors",type:Sn.Innate,speed:rr.Slow,set:a.Base,target:ir.Land,range:1,hasPushOrGather:!0,mayBeSpeed:{effect:{text:"If you have 4 <air>: This power may be <fast>.",[yn.Now]:async({action:e})=>{await e.spirit.convertElements({[nr.Air]:4}),await e.power.makeFast()}},condition:({spirit:e,speed:a})=>a===rr.Fast&&e.hasElementsWithConvert({[nr.Air]:4}),noDowngrade:({element:e,spirit:a,speed:t})=>t===rr.Fast&&e===nr.Air&&!a.hasElementsWithConvert({[nr.Air]:5})},effects:[{text:"This Power may be <fast>.",[yn.InTargetLand]:()=>Promise.resolve(),threshold:{[nr.Air]:4},noConvertToThreshold:!0,dontResolveAlone:!0},{text:"Gather up to 1 <dahan> per <air> you have.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElementsToCombo({[nr.Air]:1}),await t.gatherUpTo(a.elements[nr.Air],e.Dahan)},threshold:{[nr.Animal]:1}},{text:"Push up to 1 <dahan> per <sun> you have.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElementsToCombo({[nr.Sun]:1}),await t.pushUpTo(a.elements[nr.Sun],e.Dahan)},threshold:{[nr.Animal]:1}}]},Bc={name:"Lead The Furious Assault",type:Sn.Innate,speed:rr.Slow,set:a.Base,target:ir.Land,range:0,mayBeSpeed:{effect:{text:"If you have 4 <air>: This power may be <fast>.",[yn.Now]:async({action:e})=>{await e.spirit.convertElements({[nr.Air]:4}),await e.power.makeFast()}},condition:({spirit:e,speed:a})=>a===rr.Fast&&e.hasElementsWithConvert({[nr.Air]:4}),noDowngrade:({element:e,spirit:a,speed:t})=>t===rr.Fast&&e===nr.Air&&!a.hasElementsWithConvert({[nr.Air]:5})},hasDestroyInstructions:!0,effects:[{text:"This Power may be <fast>.",[yn.InTargetLand]:()=>Promise.resolve(),threshold:{[nr.Air]:4},noConvertToThreshold:!0,dontResolveAlone:!0},{text:"Destroy 1 <town> for every 2 <dahan> in target land.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.destroy({amount:a.forEvery(2,e.Dahan),pieces:e.Town})},threshold:{[nr.Sun]:2,[nr.Fire]:1}},{text:"Destroy 1 <city> for every 3 <dahan> in target land.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.destroy({amount:a.forEvery(3,e.Dahan),pieces:e.City})},threshold:{[nr.Sun]:4,[nr.Fire]:3}}]},kc={name:"Lead The Warriors To Battle",type:Sn.Innate,speed:rr.Slow,set:a.NatureIncarnate,target:ir.Land,targetFilter:[sr.IncarnaAndDahan],generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.736,.855],text:"1 <fear> if <town>/<city> are present. 1 Damage.",[yn.InTargetLand]:async({$:e,land:a})=>{a.has(e.TownOrCity)&&await a.fear(1),await a.damage(1)},threshold:{[nr.Sun]:1,[nr.Fire]:2}},{textArea:[.875,.925],text:"1 Damage per <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.damage(a.numberOf(e.Dahan))},threshold:{[nr.Sun]:3,[nr.Fire]:3}}]},Lc={name:"Manifestation Of Power And Glory",type:Sn.Unique,speed:rr.Slow,energy:3,elements:[nr.Sun,nr.Fire,nr.Air],set:a.Base,target:ir.Land,targetFilter:[sr.Dahan],range:0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.679,.719],text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.716,.853],text:"Each <dahan> deals Damage equal to the number of your <presence> in target land.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await t.damage(t.numberOf(e.Dahan)*t.numberOfPresenceOf(a))}}]},Fc={name:"Sudden Ambush",type:Sn.Unique,speed:rr.Fast,energy:2,elements:[nr.Fire,nr.Air,nr.Animal],set:a.Base,target:ir.Land,range:1,hasPushOrGather:!0,hasDestroyInstructions:!0,effects:[{textArea:[.722,.762],text:"You may Gather 1 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.mayGather(e.Dahan)}},{textArea:[.768,.808],text:"Each <dahan> destroys 1 <explorer>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.destroy({amount:a.numberOf(e.Dahan),pieces:e.Explorer})}}]},Rc={name:"Voice Of Thunder",type:Sn.Unique,speed:rr.Slow,energy:0,elements:[nr.Sun,nr.Air],set:a.Base,target:ir.Land,range:1,hasPushOrGather:!0,effects:[{textArea:[.7,.848],text:"Push up to 4 <dahan>.<or>If Invaders are present, 2 <fear>.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"PushDahan",textArea:[.71,.75],text:"Push up to 4 <dahan>.",[yn.Now]:async()=>{await a.pushUpTo(4,e.Dahan)}},{actionId:"Fear",textArea:[.798,.838],text:"If Invaders are present, 2 <fear>.",[yn.Now]:async()=>{a.hasInvaders&&await a.fear(2)}}]})}}]},Nc={name:"Words Of Warning",type:Sn.Unique,speed:rr.Fast,energy:1,elements:[nr.Sun,nr.Air,nr.Animal],set:a.Base,target:ir.Land,targetFilter:[sr.Dahan],range:1,effects:[{textArea:[.68,.72],text:"Defend 3.",[yn.InTargetLand]:async({land:e})=>{await e.defend(3)}},{textArea:[.716,.854],text:"During Ravage, <dahan> in target land deal Damage simultaneously with Invaders.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.addSubEffectUntilEndOfTurn({[yn.DahanFightSimultaneously]:e=>e.land===a})}}]},$c={name:"Encircle The Unsuspecting Prey",type:Sn.Innate,speed:rr.Slow,set:a.NatureIncarnate,target:ir.Land,range:1,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{textArea:[.266,.478],text:"You may Gather 1 <beasts> into target or an adjacent land. If you do, 1 Damage in that land.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.inThisAndAdjacentLands().where((a=>a.numberOfPiecesInAdjacentLands(e.Beasts)>0)).pickOne((async a=>{(await a.gatherOne(e.Beasts)).length>0&&await a.damage(1)}))},threshold:{[nr.Plant]:1,[nr.Animal]:2}},{textArea:[.5,.712],text:"If at least 2 <beasts> are within <range-1> (of target land), 1 Damage.",[yn.InTargetLand]:async({$:e,land:a,you:t})=>{a.forPiecesWithin(1,t).where((a=>a.isA(e.Beasts))).count>=2&&await a.damage(1)},threshold:{[nr.Moon]:1,[nr.Animal]:3}},{textArea:[.738,.878],text:"For each adjacent land with <beasts>, 1 Damage.",[yn.InTargetLand]:async({$:e,land:a})=>{const t=a.inAdjacentLands().where((a=>a.has(e.Beasts))).count;await a.damage(t)},threshold:{[nr.Moon]:1,[nr.Plant]:2,[nr.Animal]:4}}]},Wc={name:"Frenzied Assault",type:Sn.Innate,speed:rr.Slow,set:a.BranchAndClaw,target:ir.Land,targetFilter:[sr.Beasts],range:1,generatesFear:!0,hasDamageInstructions:!0,effects:[{effects:[{text:"1 <fear> and 2 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1),await e.damage(2)}},{text:"Remove 1 <beasts>.",[yn.InTargetLand]:async({$:e,land:a})=>{e.dontCountAs(Bn.Beasts),await a.remove({amount:1,pieces:e.Beasts})}}],threshold:{[nr.Moon]:1,[nr.Fire]:1,[nr.Animal]:4}},{text:"+1 <fear> and +1 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1),await e.damage(1)},threshold:{[nr.Moon]:1,[nr.Fire]:2,[nr.Animal]:5}}]},Mc={name:"Prey On The Builders",type:Sn.Unique,speed:rr.Fast,energy:1,elements:[nr.Moon,nr.Fire,nr.Animal],set:a.BranchAndClaw,target:ir.Land,range:0,hasPushOrGather:!0,effects:[{textArea:[.664,.704],text:"You may Gather 1 <beasts>",[yn.InTargetLand]:async({$:e,land:a})=>{await a.mayGather(e.Beasts)}},{textArea:[.742,.88],text:"If target land has <beasts>, Invaders do not Build there this turn.",[yn.InTargetLand]:async({$:e,land:a})=>{a.has(e.Beasts)&&await a.skipInvaderAction({all:!0,filter:({invaderAction:e})=>e===Hr.Build})}}]},Gc={name:"Ranging Hunt",type:Sn.Innate,speed:rr.Fast,set:a.BranchAndClaw,target:ir.Land,targetFilter:[sr.NonBlight],range:1,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{text:"You may Gather 1 <beasts>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.mayGather(e.Beasts)},threshold:{[nr.Animal]:2}},{text:"1 Damage per <beasts>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.damage(a.numberOf(e.Beasts))},threshold:{[nr.Plant]:2,[nr.Animal]:3}},{text:"You may Push up to 2 <beasts>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(2,e.Beasts)},threshold:{[nr.Animal]:2}}]},Hc={name:"Teeth Gleam From Darkness",type:Sn.Unique,speed:rr.Slow,energy:1,elements:[nr.Moon,nr.Plant,nr.Animal],set:a.BranchAndClaw,target:ir.Land,sourceFilter:[sr.Jungle],targetFilter:[sr.NonBlight],range:1,generatesFear:!0,effects:[{textArea:[.669,.863],text:"1 <fear>. Add 1 <beasts><or>If target land has both <beasts> and Invaders: 3 <fear>.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"Beasts",textArea:[.679,.719],text:"1 <fear>. Add 1 <beasts>",[yn.Now]:async()=>{await a.fear(1),await a.add(1,e.Beasts)}},{actionId:"Fear",textArea:[.762,.854],text:"If target land has both <beasts> and Invaders: 3 <fear>.",[yn.Now]:async()=>{a.hasAllOf(e.Beasts,e.Invader)&&await a.fear(3)}}]})}}]},jc={name:"Terrifying Chase",type:Sn.Unique,speed:rr.Slow,energy:1,elements:[nr.Sun,nr.Animal],set:a.BranchAndClaw,target:ir.Land,range:0,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.641,.681],text:"Push 2 <explorer>/<town>/<dahan>",[yn.InTargetLand]:async({action:e,$:a,land:t})=>{e.data.movement=await t.push({amount:2,pieces:a.ExplorerTownOrDahan})}},{textArea:[.684,.779],text:"Push another 2 <explorer>/<town>/<dahan> per <beasts> in target land.",[yn.InTargetLand]:async({action:e,$:a,land:t})=>{e.data.movement.push(...await t.push({amount:2*t.numberOf(a.Beasts),pieces:a.ExplorerTownOrDahan}))}},{textArea:[.814,.906],text:"If you Pushed any Invaders, 2 <fear>.",[yn.InTargetLand]:async({action:e,land:a})=>{e.data.movement.some((({piece:e})=>e.isInvader))&&await a.fear(2)}}]},Uc={name:"Too Near The Jungle",type:Sn.Unique,speed:rr.Slow,energy:0,elements:[nr.Plant,nr.Animal],set:a.BranchAndClaw,target:ir.Land,sourceFilter:[sr.Jungle],range:1,generatesFear:!0,hasDestroyInstructions:!0,effects:[{textArea:[.705,.745],text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.75,.79],text:"Destroy 1 <explorer>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.destroyOne(e.Explorer)}}]},qc={name:"Boon Of Growing Power",type:Sn.Unique,speed:rr.Slow,energy:1,elements:[nr.Sun,nr.Moon,nr.Plant],set:a.BranchAndClaw,target:ir.Spirit,effects:[{textArea:[.68,.72],text:"Target Spirit gains a Power Card.",[yn.TargetSpirit]:async({spirit:e})=>{await e.gainPowerCard()}},{textArea:[.765,.854],text:"If you target another Spirit, they also gain 1 Energy.",[yn.TargetSpirit]:async({spirit:e,you:a})=>{e!==a&&await e.gainEnergy(1)}}]},_c={name:"Punish Those Who Trespass",type:Sn.Innate,speed:rr.Slow,set:a.BranchAndClaw,target:ir.Land,range:0,hasDestroyInstructions:!0,effects:[{text:"You may split this Power's Damage however desired between target land and one of your lands.",[yn.InTargetLand]:async({you:e,action:a})=>{e.hasElements({[nr.Plant]:4})&&await e.inLands().optionallyPickOne((e=>(a.data.otherLand=e,Promise.resolve())))}},{effects:[{text:"2 Damage",[yn.InTargetLand]:async({$:e,land:a,action:t})=>{await e.splittedDamage({amount:2,lands:[a,...[t.data.otherLand]??0]})}},{text:"Destroy 1 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.destroyOne(e.Dahan)}}],threshold:{[nr.Sun]:2,[nr.Fire]:1,[nr.Plant]:2}},{text:"+1 Damage per <sun><plant> you have.",[yn.InTargetLand]:async({$:e,action:a,you:t,land:n})=>{await t.askToConvertElementsToCombo({[nr.Sun]:1,[nr.Plant]:1}),await e.splittedDamage({amount:t.numberOfElementCombos({[nr.Sun]:1,[nr.Plant]:1}),lands:[n,...[a.data.otherLand]??0]})},threshold:{[nr.Sun]:2,[nr.Fire]:2,[nr.Plant]:3}},{threshold:{[nr.Plant]:4}}]},Jc={name:"Regrow From Roots",type:Sn.Unique,speed:rr.Slow,energy:1,elements:[nr.Water,nr.Earth,nr.Plant],set:a.BranchAndClaw,target:ir.Land,targetFilter:[sr.Jungle,sr.Wetlands],range:1,blightWhiteListedPower:!0,effects:[{textArea:[.71,.817],text:"If there are 2 <blight> or fewer in target land, remove 1 <blight>.",[yn.InTargetLand]:async({$:e,land:a})=>{a.hasAtMost(2,e.Blight)&&await a.removeBlight()}}]},Vc={name:"Sacrosanct Wilderness",type:Sn.Unique,speed:rr.Fast,energy:2,elements:[nr.Sun,nr.Earth,nr.Plant],set:a.BranchAndClaw,target:ir.Land,targetFilter:[sr.NonBlight],range:1,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{textArea:[.636,.676],text:"Push 2 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.push({amount:2,pieces:e.Dahan})}},{textArea:[.719,.897],text:"2 Damage per <wilds> in target land.<or>Add 1 <wilds>.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"Damage",textArea:[.716,.808],text:"2 Damage per <wilds> in target land.",[yn.Now]:async()=>{await a.damage(2*a.numberOf(e.Wilds))}},{actionId:"AddWilds",textArea:[.851,.891],text:"Add 1 <wilds>.",[yn.Now]:async()=>{await a.add(1,e.Wilds)}}]})}}]},Yc={name:"Spreading Wilds",type:Sn.Innate,speed:rr.Slow,set:a.BranchAndClaw,target:ir.Land,targetFilter:[sr.NonBlight],range:1,modifiesRange:({spirit:e,withConvert:a})=>e.hasElements({[nr.Plant]:3,[nr.Air]:1},a)?2:e.hasElements({[nr.Plant]:3},a)||e.hasElements({[nr.Air]:1},a)?1:0,payForRange:async({$:e,spirit:a})=>{await e.chooseBetween({text:"To cast Spreading Wilds in this land, you need to convert elements.",effects:[{actionId:"ConvertPlant",text:"Convert to 3 <plant>",[yn.Now]:async()=>{await a.convertElements({[nr.Plant]:3})},condition:()=>!a.hasElements({[nr.Plant]:3})&&a.hasElementsWithConvert({[nr.Plant]:3})},{actionId:"ConvertAir",text:"Convert to 1 <air>",[yn.Now]:async()=>{await a.convertElements({[nr.Air]:1})},condition:()=>!a.hasElements({[nr.Air]:1})&&a.hasElementsWithConvert({[nr.Air]:1})}]})},hasPushOrGather:!0,effects:[{text:"Push 1 <explorer> from target land per 2 <sun> you have.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElementsToCombo({[nr.Sun]:2}),await t.push({amount:Math.floor(a.elements[nr.Sun]/2),pieces:e.Explorer})},threshold:{[nr.Sun]:2}},{text:"If target land has no <explorer>, add 1 <wilds>.",[yn.InTargetLand]:async({$:e,land:a})=>{a.doesntHave(e.Explorer)&&await a.add(1,e.Wilds)},threshold:{[nr.Plant]:1}},{text:"This Power has <range+1>.",threshold:{[nr.Plant]:3},noConvertToThreshold:!0,dontResolveAlone:!0},{text:"This Power has <range+1>.",threshold:{[nr.Air]:1},noConvertToThreshold:!0,dontResolveAlone:!0}]},zc={name:"Towering Wrath",type:Sn.Unique,speed:rr.Slow,energy:3,elements:[nr.Sun,nr.Fire,nr.Plant],set:a.BranchAndClaw,target:ir.Land,sourceFilter:[sr.SacredSite],range:1,generatesFear:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{textArea:[.661,.701],text:"2 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.7,.835],text:"For each of your <sacred> in/adjacent to target land, 2 Damage.",[yn.InTargetLand]:async({you:e,land:a})=>{const t=a.inThisAndAdjacentLands().where((a=>a.hasSacredSiteOf(e))).count;await a.damage(2*t)}},{textArea:[.838,.878],text:"Destroy all <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.destroyAll(e.Dahan)}}]},Qc={name:"Dark Skies Loose A Stinging Rain",type:Sn.Unique,speed:rr.Fast,energy:1,elements:[nr.Moon,nr.Air,nr.Water],set:a.FeatherAndFlame,target:ir.Land,sourceFilter:[sr.Wetlands],range:1,hasPushOrGather:!0,effects:[{textArea:[.699,.739],text:"Isolate target land.",[yn.InTargetLand]:async({land:e})=>{await e.isolate()}},{textArea:[.762,.802],text:"Push up to 1 <explorer>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(1,e.Explorer)}},{textArea:[.762,.802],text:"Push up to 2 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(2,e.Dahan)}}]},Kc={name:"Foundations Sink Into Mud",type:Sn.Unique,speed:rr.Slow,energy:1,elements:[nr.Water,nr.Earth],set:a.FeatherAndFlame,target:ir.Land,range:0,hasDamageInstructions:!0,effects:[{textArea:[.654,.878],text:"2 Damage to <town>.<br><br>If target land is <wetlands>, you may instead deal 1 Damage to each <town>/<city>.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"DamageToTown",textArea:[.666,.706],text:"2 Damage to <town>.",[yn.Now]:async()=>{await a.damage(2,e.Town)}},{actionId:"DamageToEach",textArea:[.779,.876],text:"1 Damage to each <town>/<city>.",condition:()=>a.isWetlands,[yn.Now]:async()=>{await a.damageEach(1,e.TownOrCity)}}]},{orChoice:!1})}}]},Xc={name:"Gift Of Abundance",type:Sn.Unique,speed:rr.Fast,energy:1,elements:[nr.Sun,nr.Air,nr.Water,nr.Plant],set:a.FeatherAndFlame,target:ir.Spirit,targetFilter:[ur.Another],effects:[{textArea:[.64,.758],text:"Target Spirit either gains 2 Energy, or may Repeat one Power Card this turn by paying its cost.",[yn.TargetSpirit]:async({$:e,spirit:a,isRepeat:t,...n})=>{await e.chooseBetween({effects:[{actionId:"GainEnergy",textArea:[.64,.68],text:"Gain 2 Energy",[yn.Now]:async()=>{await a.gainEnergy(2)}},{actionId:"Repeat",textArea:[.68,.763],text:"Repeat one Power Card this turn by paying its cost.",[yn.Now]:async()=>{t||await e.addSubEffectUntilEndOfTurn({[yn.GlobalReminder]:()=>({power:n.power.power,players:[a]}),[yn.MayRepeatPowercard]:({power:e,speed:t})=>e.owner===a&&e.costToPlay<=a.energy&&e.data.type!==Sn.Innate&&e.possibleToRepeatAtSpeed(t),[yn.RepeatPowerCard]:async({power:a,speed:t})=>{e.removeThisEffect(),await a.payForPlay(),await a.replay(t)}})}}]},{orChoice:!1})}},{textArea:[.772,.901],text:"Either you or target Spirit may add 1 Destroyed <presence> to a <wetlands> where you have <presence>.",[yn.TargetSpirit]:async({$:e,you:a,spirit:t})=>{await e.chooseBetween({autoPlayOneOption:!0,effects:[{actionId:"YouAddPresence",textArea:[.814,.854],text:"You may add 1 Destroyed <presence>.",[yn.Now]:async()=>{await a.addPresence({locations:Jn.AnyLands,destroyed:!0,filter:e=>e.isWetlands&&e.hasPresenceOf(a)})}},{actionId:"TargetAddPresence",textArea:[.814,.854],text:`${t.nameLink} adds 1 Destroyed <presence>.`,condition:()=>a!==t,[yn.Now]:async()=>{await t.addPresence({locations:Jn.AnyLands,destroyed:!0,filter:e=>e.isWetlands&&e.hasPresenceOf(a)})}}]})}}]},Zc={name:"Rain And Mud Suppress Conflict",type:Sn.Innate,speed:rr.Fast,set:a.FeatherAndFlame,target:ir.Spirit,targetFilter:[ur.Yourself],generatesFear:!0,effects:[{text:"Each of your <presence> grants Defend 1 and lowers <dahan> counterattack Damage by 1. (Total, in its land.)",[yn.TargetSpirit]:async({$:e,you:a})=>{await e.addSubEffectUntilEndOfTurn({[yn.GlobalReminder]:()=>({icon:"<presence><br>Defend",spirit:a,players:[a]}),[yn.DefendFromSpirits]:({land:e})=>e.numberOfPresenceOf(a),[yn.AdjustCollectiveDahanRavageDamage]:({land:e})=>-e.numberOfPresenceOf(a)})},threshold:{[nr.Air]:1,[nr.Water]:3}},{text:"Each of your <presence> grants Defend 1 and lowers <dahan> counterattack Damage by 1. (Total, in its land.)",[yn.TargetSpirit]:async({$:e,you:a})=>{await e.addSubEffectUntilEndOfTurn({[yn.GlobalReminder]:()=>({icon:"<presence><br>Defend",spirit:a,players:[a]}),[yn.DefendFromSpirits]:({land:e})=>e.numberOfPresenceOf(a),[yn.AdjustCollectiveDahanRavageDamage]:({land:e})=>-e.numberOfPresenceOf(a)})},threshold:{[nr.Water]:5,[nr.Earth]:1}},{effects:[{text:"2 <fear>. In your lands, Invaders and <dahan> have -1 Health (min 1).",[yn.TargetSpirit]:async({$:e,you:a})=>{await e.fear(2),await e.addSubEffectUntilEndOfTurn({[yn.GlobalReminder]:()=>({text:"In your lands, Invaders and <dahan> have -1 Health (min 1).",icon:"<dahan><br>-1 HP",spirit:a,players:[a]}),[yn.AdjustHealth]:({piece:t})=>null!=t.location&&t.location.hasPresenceOf(a)&&t.isA(e.InvaderOrDahan)?-1:0,[yn.AfterAddingPiece]:async({land:e})=>{await e.healthCheck()}}),await a.inLands().forEach((async e=>{await e.healthCheck()}))}}],threshold:{[nr.Air]:3,[nr.Water]:9,[nr.Earth]:2}}]},el={name:"Unbearable Deluge",type:Sn.Unique,speed:rr.Fast,energy:0,elements:[nr.Air,nr.Water,nr.Earth],set:a.FeatherAndFlame,target:ir.Land,range:0,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.703,.743],text:"1 <fear>",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.703,.743],text:"Push 2 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.push({amount:2,pieces:e.Dahan})}},{textArea:[.703,.743],text:"Defend 3.",[yn.InTargetLand]:async({land:e})=>{await e.defend(3)}},{textArea:[.785,.825],text:"If target land is <wetlands>, Isolate it.",[yn.InTargetLand]:async({land:e})=>{e.isWetlands&&await e.isolate()}}]},al={name:"Water Nourishes Lifes Growth",type:Sn.Innate,speed:rr.Fast,set:a.FeatherAndFlame,target:ir.Land,range:0,hasPushOrGather:!0,blightWhiteListedPower:!0,effects:[{effects:[{text:"Gain 1 Energy.",[yn.InTargetLand]:async({you:e})=>{await e.gainEnergy(1)}},{text:"You may Remove 1 <blight> by Removing 1 of your <presence> (from target land).",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{t.has(e.Blight)&&t.hasPresenceOf(a)&&(await t.remove({quantifier:lr.UpTo,amount:1,pieces:e.Presence,owner:a})).length>0&&await t.removeBlight()}}],threshold:{[nr.Water]:3,[nr.Plant]:2}},{effects:[{text:"Gain +1 Energy.",[yn.InTargetLand]:async({you:e})=>{await e.gainEnergy(1)}},{text:"Gather up to 1 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(1,e.Dahan)}}],threshold:{[nr.Water]:5,[nr.Earth]:1,[nr.Plant]:2}},{text:"When <blight> would be added to target land instead leave it on the card.",[yn.InTargetLand]:async({$:e,land:a,effect:t})=>{await e.addSubEffectUntilEndOfTurn({[yn.Reminder]:e=>e===a?t.text:void 0,[yn.PreventAddBlight]:({location:e})=>Promise.resolve(e===a)})},threshold:{[nr.Water]:7,[nr.Earth]:2,[nr.Plant]:3}}]},tl={name:"A Circuitous And Wending Journey",type:Sn.Unique,speed:rr.Slow,energy:0,elements:[nr.Moon,nr.Air],set:a.FeatherAndFlame,target:ir.Land,range:0,hasPushOrGather:!0,effects:[{textArea:[.67,.765],text:"Push up to half (round up) of Invaders from target land.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(Math.ceil(a.numberOf(e.Invader)/2),e.Invader)}},{textArea:[.775,.87],text:"Push up to half (round up) of <dahan> from target land.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(Math.ceil(a.numberOf(e.Dahan)/2),e.Dahan)}},{textArea:[.775,.87],text:"Push up to half (round up) of <presence> from target land.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(Math.ceil(a.numberOf(e.Presence)/2),e.Presence)}},{textArea:[.775,.87],text:"Push up to half (round up) of <beasts> from target land.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(Math.ceil(a.numberOf(e.Beasts)/2),e.Beasts)}}]},nl={name:"Aid From The Spirit-Speakers",type:Sn.Unique,speed:rr.Fast,energy:2,elements:[nr.Sun,nr.Fire,nr.Air,nr.Animal],set:a.FeatherAndFlame,target:ir.Land,range:1,effects:[{textArea:[.682,.825],text:"For each <dahan>, you may move 1 Invader/<dahan>/<presence>/<beasts> to a land within <range-2> that has <dahan>.",[yn.InTargetLand]:async({$:e,land:a,you:t})=>{await a.move({quantifier:lr.May,amount:a.numberOf(e.Dahan),pieces:e.InvaderDahanPresenceOrBeast,locations:{target:Jn.WithinRange,range:2,spirit:t},destinationFilter:a=>a.has(e.Dahan),together:!0})}}]},rl={name:"Close The Ways",type:Sn.Innate,speed:rr.Fast,set:a.FeatherAndFlame,target:ir.Land,range:1,effects:[{text:"Target each level of this as a separate Power. Isolate target land.",[yn.InTargetLand]:async({you:e,power:a,land:t})=>{const n=[{[nr.Air]:1,[nr.Water]:2},{[nr.Air]:2,[nr.Earth]:2},{[nr.Air]:3,[nr.Plant]:2}].filter((a=>e.hasElements(a))).length;for(let e=0;e<n;e+=1)0===e?await t.isolate():await a.validLandTargets().pickOne((async e=>{await e.isolate()}))}},{threshold:{[nr.Air]:1,[nr.Water]:2}},{threshold:{[nr.Air]:2,[nr.Earth]:2}},{threshold:{[nr.Air]:3,[nr.Plant]:2}}]},il={name:"Lay Paths They Cannot Help But Walk",type:Sn.Innate,speed:rr.Fast,set:a.FeatherAndFlame,target:ir.Land,range:0,hasPushOrGather:!0,blightWhiteListedPower:!0,effects:[{[yn.InTargetLand]:async({$:e,land:a})=>{await e.addSubEffect({effects:[e.Invader,e.Dahan,e.Presence,e.Beasts].map((e=>({text:`Push up to half (round down) of ${Kn[e].text} from target land.`,[yn.Now]:async()=>{await a.pushUpTo(Math.floor(a.numberOf(e)/2),e)}})))})},threshold:{[nr.Moon]:2,[nr.Air]:2}},{text:"Push up to 1 Invader/<dahan>/<presence>/<beasts>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(1,e.InvaderDahanPresenceOrBeast)},threshold:{[nr.Sun]:2,[nr.Air]:2}},{text:"Repeat this Power.",[yn.InTargetLand]:async({power:e,isRepeat:a})=>{a||await e.repeat()},threshold:{[nr.Moon]:2,[nr.Air]:4,[nr.Water]:3}}]},sl={name:"Offer Passage Between Worlds",type:Sn.Unique,speed:rr.Fast,energy:1,elements:[nr.Sun,nr.Moon,nr.Air],set:a.FeatherAndFlame,target:ir.Land,range:1,effects:[{textArea:[.614,.929],text:"Move up to 4 <dahan> between target land and one of your lands<or>The next time <dahan> would be Destroyed in target land, Destroy 2 fewer <dahan>.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await e.chooseBetween({effects:[{actionId:"MoveDahan",textArea:[.613,.716],text:"Move up to 4 <dahan> between target land and one of your lands",[yn.Now]:async()=>{await t.moveBetween({upToAmount:4,pieces:e.Dahan,destination:e=>e.hasPresenceOf(a)})}},{actionId:"ProtectDahan",textArea:[.782,.923],text:"The next time <dahan> would be Destroyed in target land, Destroy 2 fewer <dahan>.",[yn.Now]:async a=>{let n=0;await e.addSubEffectUntilEndOfTurn({[yn.Reminder]:e=>e===t?a.effect.text:void 0,[yn.OrderOfRemoveAllMightMatter]:()=>!0,[yn.PreventRemovePiece]:async({piece:a,removement:r})=>!!(a.isA(e.Dahan)&&a.location===t&&n<2&&pr[r].isDestroyLike)&&(n+=1,await e.sendEvent({type:fn.GenericSub,text:"The <dahan> is saved from destruction by <p>OfferPassageBetweenWorlds</p>."}),2===n&&e.removeThisEffect(),!0)})}}]})}}]},ol={name:"Paths Tied By Nature",type:Sn.Unique,speed:rr.Slow,energy:0,elements:[nr.Sun,nr.Air,nr.Earth,nr.Plant],set:a.FeatherAndFlame,target:ir.Land,range:1,effects:[{textArea:[.692,.842],text:"Move up to 2 Invaders/<dahan><presence><beasts> to a land within <range-2> that has the same terrain.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await t.move({quantifier:lr.UpTo,amount:2,locations:{target:Jn.WithinRange,range:2,spirit:a},destinationFilter:e=>e.hasSameTerrainAs(t),pieces:e.InvaderDahanPresenceOrBeast,together:!0})}}]},dl={name:"Travelers Boon",type:Sn.Unique,speed:rr.Fast,energy:0,elements:[nr.Moon,nr.Air,nr.Water],set:a.FeatherAndFlame,target:ir.Spirit,targetFilter:[ur.Another],effects:[{textArea:[.648,.743],text:"Target Spirit moves up to 3 of their <presence> to one of your lands.",[yn.TargetSpirit]:async({$:e,you:a,spirit:t})=>{const n=[e.Invader,e.Dahan,e.Beasts];await a.inLands().pickOne((async e=>{await t.presence().pickMultiple({amount:3,optional:!0,forPickedItem:async a=>{const t=a.location;await a.move({locations:{target:Jn.ToThisLocation,location:e}}),await t.forPieces().pickMultiple({amount:n.length,optional:!0,where:e=>n.some((a=>e.isA(a))),forPickedItem:async a=>{qr(n,(e=>a.isA(e))),await a.move({locations:{target:Jn.ToThisLocation,location:e}})},effect:{textArea:[.756,.89],text:"They may move up to 1 Invader, 1 <dahan>, and 1 <beasts> along with their <presence>. (Total, not for each <presence>.)."}})},repeatSame:!0})}),{prompt:"Select destination land."})}}]},cl={name:"Ways Of Shore And Heartland",type:Sn.Unique,speed:rr.Slow,energy:1,elements:[nr.Air,nr.Water,nr.Earth],set:a.FeatherAndFlame,target:ir.Land,range:2,hasPushOrGather:!0,effects:[{textArea:[.696,.842],text:"Push up to 2 Invaders/<dahan>/<presence>/<beasts> to a land that is also Coastal/Inland (whichever the target land is).",[yn.InTargetLand]:async({$:e,land:a})=>{await a.push({quantifier:lr.UpTo,amount:2,destinationFilter:e=>e.isCoastal===a.isCoastal,pieces:e.InvaderDahanPresenceOrBeast,together:!0})}}]},ll={name:"Absorb Essence",type:Sn.Unique,speed:rr.Fast,energy:2,elements:[nr.Moon,nr.Fire,nr.Water,nr.Earth],set:a.FeatherAndFlame,target:ir.Spirit,targetFilter:[ur.Another],effects:[{textArea:[.634,.674],text:"Gain 3 Energy",[yn.TargetSpirit]:async({you:e})=>{await e.gainEnergy(3)}},{textArea:[.676,.853],text:'Move 1 of target Spirit\'s <presence> from the board to your "Deep Slumber" Track. Absorbed <presence> cannot be returned to play.',[yn.TargetSpirit]:async({you:e,spirit:a})=>{e.spirit===n.Serpent&&await a.presence().pickOne((async a=>{const t=await a.remove(Nn.RemoveFromGame);t.length>0&&t[0].piece.piece===Bn.Presence&&await e.absorb(t[0].piece.owner)}))}},{textArea:[.809,.9],text:"Target Spirit gains 1 <any> and 1 Energy.",[yn.TargetSpirit]:async({spirit:e})=>{await e.gainElements(),await e.gainEnergy(1)}}]},hl={name:"Elemental Aegis",type:Sn.Unique,speed:rr.Fast,energy:1,elements:[nr.Fire,nr.Water,nr.Earth],set:a.FeatherAndFlame,target:ir.Land,range:0,effects:[{textArea:[.653,.881],text:'Defend 2 in target land and all adjacent lands. For every <presence> on your "Deep Slumber" Track, Defend 1 in target land and all adjacent lands.',[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await e.addSubEffectUntilEndOfTurn({[yn.DefendFromSpirits]:e=>e.land===t||e.land.isAdjacentTo(t)?2+a.absorbedPresence.length:0})}}]},ul={name:"Gift Of Flowing Power",type:Sn.Unique,speed:rr.Fast,energy:1,elements:[nr.Fire,nr.Water],set:a.FeatherAndFlame,target:ir.Spirit,targetFilter:[ur.Another],effects:[{textArea:[.618,.658],text:"Target Spirit gains 1 Energy.",[yn.TargetSpirit]:async({spirit:e})=>{await e.gainEnergy(1)}},{textArea:[.7,.932],text:"Target Spirit chooses to either:<br>Play another Power Card by paying its cost.<or>Gain 1 <fire> and 1 <water>.",[yn.TargetSpirit]:async({$:e,spirit:a})=>{await e.chooseBetween({effects:[{actionId:"PlayPowerCard",textArea:[.745,.837],text:"Play another Power Card by paying its cost.",[yn.Now]:async()=>{await a.playAPowerCardByPayingItsCost()}},{actionId:"GainElements",textArea:[.881,.921],text:"Gain 1 <fire> and 1 <water>.",[yn.Now]:async()=>{await a.gainElementsUntilEndOfTurn({[nr.Fire]:1,[nr.Water]:1})}}]})}}]},gl={name:"Gift Of The Primordial Deeps",type:Sn.Unique,speed:rr.Fast,energy:1,elements:[nr.Moon,nr.Earth],set:a.FeatherAndFlame,target:ir.Spirit,targetFilter:[ur.Another],effects:[{textArea:[.615,.655],text:"Target Spirit gains a Minor Power.",[yn.TargetSpirit]:async({spirit:e,action:a})=>{a.data.powerGain=await e.gainPowerCard({powerType:Sn.Minor})}},{textArea:[.7,.926],text:"Target Spirit chooses to either: Play it immediately by paying its cost.<or>Gain 1 <moon> and 1 <earth>.",[yn.TargetSpirit]:async({$:e,spirit:a,action:t})=>{const n=t.data.powerGain.chosen;await e.chooseBetween({effects:[{actionId:"Play",textArea:[.746,.834],text:"Play it immediately by paying its cost.",condition:()=>n.length>0&&n[0].isPlayable,[yn.Now]:async()=>{await n[0].play({withoutUsingCardPlays:!0})}},{actionId:"GainElements",textArea:[.88,.92],text:"Gain 1 <moon> and 1 <earth>.",[yn.Now]:async()=>{await a.gainElementsUntilEndOfTurn({[nr.Moon]:1,[nr.Earth]:1})}}]})}}]},fl={name:"Serpent Rouses In Anger",type:Sn.Innate,speed:rr.Slow,set:a.FeatherAndFlame,target:ir.Land,range:0,hasPushOrGather:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{text:"For each <fire><earth> you have, 1 Damage to 1 <town>/<city>.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElementsToCombo({[nr.Fire]:1,[nr.Earth]:1});const n=a.numberOfElementCombos({[nr.Fire]:1,[nr.Earth]:1});await t.damage(n,e.TownOrCity,{maxTargets:n})},threshold:{[nr.Fire]:1,[nr.Earth]:1}},{text:"For each 2 <moon><earth> you have, 2 <fear> and you may Push 1 <town> from target land.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElementsToCombo({[nr.Moon]:2,[nr.Earth]:2});const n=a.numberOfElementCombos({[nr.Moon]:2,[nr.Earth]:2});await t.fear(2*n),await t.pushUpTo(n,e.Town)},threshold:{[nr.Moon]:2,[nr.Earth]:2}},{text:"Cost 7 Energy: In every land in the game: X Damage, where X is the number of <presence> you have in and adjacent to that land.",[yn.InTargetLand]:async({$:e,you:a})=>{a.energy>=7&&await e.may({prompt:"Pay 7 Energy to do this effect?"})&&(await a.payEnergy(7),await e.inLands().forEach((async t=>{await t.damage(t.numberOfPiecesInThisOrAdjacentLands(e.Presence,a))})))},threshold:{[nr.Moon]:5,[nr.Fire]:6,[nr.Earth]:6}}]},pl={name:"Serpent Wakes In Power",type:Sn.Innate,speed:rr.Slow,set:a.FeatherAndFlame,target:ir.Spirit,targetFilter:[ur.Yourself],effects:[{effects:[{text:"Gain 1 Energy.",[yn.TargetSpirit]:async({you:e})=>{await e.gainEnergy(1)}},{text:"Other spirits with any Absorbed Presence also gain 1 Energy.",[yn.TargetSpirit]:async({$:e,you:a})=>{await e.spiritsWhich((e=>e!==a&&a.absorbedPresence.includes(e.spiritNumber))).forEach((async e=>{await e.gainEnergy(1)}))}}],threshold:{[nr.Fire]:2,[nr.Water]:1,[nr.Plant]:1}},{effects:[{text:"Add 1 <presence> at <range-1>.",[yn.TargetSpirit]:async({you:e})=>{await e.addPresenceInRange(1)}},{text:"Other spirits with 2 or more Absorbed Presence may do likewise.",[yn.TargetSpirit]:async({$:e,you:a})=>{await e.spiritsWhich((e=>e!==a&&a.numberOfAbsorbedPresenceOf(e)>=2)).forEach((async e=>{await e.addPresenceInRange(1)}))}}],threshold:{[nr.Water]:2,[nr.Earth]:3,[nr.Plant]:2}},{effects:[{text:"Gain a Major Power without Forgetting.",[yn.TargetSpirit]:async({you:e})=>{await e.gainPowerCard({powerType:Sn.Major,withoutForgetting:!0})}},{text:"Other Spirits with 3 or more Absorbed Presence may do likewise.",[yn.TargetSpirit]:async({$:e,you:a})=>{await e.spiritsWhich((e=>e!==a&&a.numberOfAbsorbedPresenceOf(e)>=3)).forEach((async e=>{await e.gainPowerCard({powerType:Sn.Major,withoutForgetting:!0})}))}}],threshold:{[nr.Fire]:3,[nr.Water]:3,[nr.Earth]:3,[nr.Plant]:3}}]},wl={name:"Strength Of The Waking Island",type:Sn.Innate,speed:rr.Fast,set:a.NatureIncarnate,target:ir.Spirit,targetFilter:[ur.Yourself],effects:[{textArea:[.396,.7],text:"After a Spirit uses a land-targeting Power Card, they may Repeat it at <incarna-locus> by paying its cost. (Max. 1 Power Card per turn for each of their absorbed <presence>.) You may help pay some or all of this cost. (These Repeats ignore Range and target requirements.)",[yn.TargetSpirit]:async({$:e,you:a,...t})=>{let n=0;const r={triggerId:e.nextTriggerId(),[yn.Now]:async({action:t})=>{const r=t.parentData.wakingIslandPower,i=r.owner===a,s=i?a.energy:r.owner.energy+a.energy;if(null!=a.incarna&&s>=r.costToPlay&&n<a.numberOfAbsorbedPresenceOf(r.owner)&&await e.may({prompt:`Repeat ${r.powerLink} at <incarna-locus>?`})){if(n+=1,i)await a.payEnergy(r.costToPlay);else{const t=Math.max(r.costToPlay-r.owner.energy,0),n=0===a.energy||0===r.costToPlay?0:await e.selectX(t,Math.min(a.energy,r.costToPlay),{players:[a],text:"You may help pay some or all of this cost.",prompt:"How much of the cost would you like to pay?"});await a.payEnergy(n),await r.owner.payEnergy(r.costToPlay-n)}await r.owner.resolvePowerInLocations(r,[a.incarna.location],!0,!0)}}};await e.addEffectUntilEndOfTurn({[yn.AfterResolvingLandTargetingPower]:async({power:a,isRepeat:n})=>{!n&&a.isA(En.AnyCard)&&(e.action.data.wakingIslandPower=a,await e.addTrigger(r,t.effect,t.action))}})},threshold:{[nr.Water]:2,[nr.Earth]:1}},{textArea:[.718,.938],text:"Add 1 <vitality> at <incarna-locus>. If a Spirit has 2 or more absorbed <presence>, you may instead Add 1 <vitality> in one of their lands without <blight>.",[yn.TargetSpirit]:async({$:e,you:a,spirit:t})=>{const n=Cr(a.absorbedPresence.filter((e=>a.absorbedPresence.filter((a=>a===e)).length>=2)));await e.inLandsWhere((a=>a===t.incarna?.location||a.doesntHave(e.Blight)&&a.hasOnePieceWhere((e=>e.isPresence&&n.includes(e.spiritNumber))))).pickOne((async a=>{await a.add(1,e.Vitality)}))},threshold:{[nr.Moon]:2,[nr.Earth]:2,[nr.Plant]:1}}]},yl={name:"Asphyxiating Smoke",type:Sn.Unique,speed:rr.Slow,energy:2,elements:[nr.Fire,nr.Air,nr.Plant],set:a.FeatherAndFlame,target:ir.Land,sourceFilter:[sr.SacredSite],range:2,hasPushOrGather:!0,generatesFear:!0,hasDestroyInstructions:!0,effects:[{textArea:[.716,.756],text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.756,.796],text:"Destroy 1 <town>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.destroyOne(e.Town)}},{textArea:[.799,.839],text:"Push 1 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushOne(e.Dahan)}}]},ml={name:"Exaltation Of The Transforming Flame",type:Sn.Innate,speed:rr.Fast,set:a.NatureIncarnate,target:ir.Spirit,targetFilter:[ur.Another],blightWhiteListedPower:!0,effects:[{textArea:[.259,.413],text:"Target Spirit may Forget a Power Card to gain a Power Card and 1 <any>. You may do likewise.",[yn.TargetSpirit]:async({you:e,spirit:a})=>{await a.andAnotherSpirit(e,{text:e=>(e?"Target Spirit":"You")+" may Forget a Power Card to gain a Power Card and 1 <any>.",now:async e=>{if(e.numberOfPowerCards>0){(await e.forgetPowers({optional:!0})).length>0&&(await e.gainPowerCard(),await e.gainElements())}}})},threshold:{[nr.Fire]:4,[nr.Plant]:1}},{textArea:[.413,.567],text:"Target Spirit may pay 1 Energy to Replace 1 <blight> with 1 <badlands> in one of their lands. You may do likewise.",[yn.TargetSpirit]:async({$:e,you:a,spirit:t})=>{await t.andAnotherSpirit(a,{text:e=>(e?"Target Spirit":"You")+" may pay 1 Energy to Replace 1 <blight> with 1 <badlands> in one of their lands.",now:async a=>{a.energy>0&&await a.forPiecesThatIs(e.Blight).optionallyPickOne((async e=>{await a.payEnergy(1),await e.replace([Bn.Badlands])}))}})},threshold:{[nr.Fire]:3,[nr.Earth]:1,[nr.Plant]:2}},{textArea:[.571,.733],text:"Target Spirit may Replace 1 <explorer> with 1 <beasts> in one of their lands. You may do likewise.",[yn.TargetSpirit]:async({$:e,spirit:a,you:t})=>{await a.andAnotherSpirit(t,{text:e=>(e?"Target Spirit":"You")+" may Replace 1 <explorer> with 1 <beasts> in one of their lands.",now:async a=>{await a.forPiecesThatIs(e.Explorer).optionallyPickOne((async e=>{await e.replace([Bn.Beasts])}))}})},threshold:{[nr.Sun]:1,[nr.Fire]:3,[nr.Animal]:1}}]},vl={name:"Firestorm",type:Sn.Innate,speed:rr.Fast,set:a.FeatherAndFlame,target:ir.Land,targetFilter:[sr.Blight],range:0,hasPushOrGather:!0,mayAlwaysDowngrade:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{text:"1 Damage per 2 <fire> you have.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElementsToCombo({[nr.Fire]:2});const n=Math.floor(a.elements[nr.Fire]/2);a.hasElements({[nr.Fire]:4,[nr.Air]:2})?await e.splittedDamage({amount:n,lands:a.inLandsWhere((a=>a.has(e.Blight)||a===t)).items,effect:{text:"Split this Power's Damage however desired between target land and any number of your lands with <blight>."}}):await t.damage(n)},threshold:{[nr.Plant]:1,[nr.Fire]:2}},{instead:!0,text:"Instead, 1 Damage per <fire> you have.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElementsToCombo({[nr.Fire]:1});const n=a.elements[nr.Fire];a.hasElements({[nr.Fire]:4,[nr.Air]:2})?await e.splittedDamage({amount:n,lands:a.inLandsWhere((a=>a.has(e.Blight)||a===t)).items,effect:{text:"Split this Power's Damage however desired between target land and any number of your lands with <blight>."}}):await t.damage(n)},threshold:{[nr.Plant]:3,[nr.Fire]:1}},{[yn.InTargetLand]:async()=>{},threshold:{[nr.Fire]:4,[nr.Air]:2}},{text:"In a land with <blight> where you have <presence>, Push all <dahan>. Destroy all Invaders and <beasts>. Add 1 <blight>.",[yn.InTargetLand]:async({$:e,you:a})=>{await a.inLandsWith(e.Blight).pickOne((async a=>{e.dontCountAs(Bn.Beasts),await a.pushAll(e.Dahan),await a.destroyAll(e.Invader),await a.destroyAll(e.Beasts),await a.addBlight(1)}))},threshold:{[nr.Fire]:7}}]},Al={name:"Flames Fury",type:Sn.Unique,speed:rr.Fast,energy:0,elements:[nr.Sun,nr.Fire,nr.Plant],set:a.FeatherAndFlame,target:ir.Spirit,effects:[{textArea:[.627,.667],text:"Target Spirit gains 1 Energy.",[yn.TargetSpirit]:async({spirit:e})=>{await e.gainEnergy(1)}},{textArea:[.627,.906],text:"Target Spirit does +1 Damage with each Damage dealing Power they use this turn.<br><br>Powers which Damage multiple lands or each Invader only get 1 extra Damage total. Repeated Powers keep the +1 boost. Destroy effects don't get any bonus.)",[yn.TargetSpirit]:async({spirit:e,you:a})=>{await e.gainDamageBoost({amount:1,source:a})}}]},Il={name:"Flash-Fires",type:Sn.Unique,speed:rr.Slow,energy:2,elements:[nr.Fire,nr.Air],set:a.FeatherAndFlame,target:ir.Land,range:1,generatesFear:!0,hasDamageInstructions:!0,mayBeSpeed:{effect:{textArea:[.826,.936],text:"If you have 2 <air>:<br>This Power is <fast>.",[yn.Now]:async({action:e})=>{await e.spirit.convertElements({[nr.Air]:2})}},condition:({speed:e,spirit:a})=>e===rr.Fast&&a.hasElementsWithConvert({[nr.Air]:2})},effects:[{textArea:[.65,.69],text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.696,.736],text:"1 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(1)}}]},xl={name:"The Burned Land Regrows",type:Sn.Innate,speed:rr.Slow,set:a.FeatherAndFlame,target:ir.Land,range:0,blightWhiteListedPower:!0,effects:[{text:"If target land has 2 <blight> or more, remove 1 <blight>.",[yn.InTargetLand]:async({$:e,land:a})=>{a.hasAtLeast(2,e.Blight)&&await a.removeBlight()},threshold:{[nr.Fire]:4,[nr.Plant]:1}},{instead:!0,text:"Instead, remove 1 <blight>.",[yn.InTargetLand]:async({land:e})=>{await e.removeBlight()},threshold:{[nr.Fire]:4,[nr.Plant]:2}},{text:"Remove another <blight>.",[yn.InTargetLand]:async({land:e})=>{await e.removeBlight()},threshold:{[nr.Fire]:5,[nr.Plant]:2,[nr.Earth]:2}}]},bl={name:"Threatening Flames",type:Sn.Unique,speed:rr.Fast,energy:0,elements:[nr.Fire,nr.Plant],set:a.FeatherAndFlame,target:ir.Land,targetFilter:[sr.BlightAndInvaders],range:0,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.607,.647],text:"2 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(2)}},{text:"Push 1 <explorer>/<town> per Terror Level from target land to adjacent lands without your <presence>.<br><br>If there are no such adjacent lands, +2 <fear>.",[yn.InTargetLand]:async({$:e,land:a,you:t})=>{a.inAdjacentLandsWhere((e=>!e.hasPresenceOf(t))).count>0?await e.addSubEffect({textArea:[.647,.798],text:"Push 1 <explorer>/<town> per Terror Level from target land to adjacent lands without your <presence>.",[yn.Now]:async()=>{await a.push({amount:e.terrorLevel,pieces:e.ExplorerOrTown,destinationFilter:e=>!e.hasPresenceOf(t)})}}):await e.addSubEffect({textArea:[.832,.923],text:"If there are no such adjacent lands, +2 <fear>.",[yn.Now]:async()=>{await a.fear(2)}})}}]},Tl={name:"Boon Of Watchful Guarding",type:Sn.Unique,speed:rr.Fast,energy:0,elements:[nr.Earth,nr.Plant,nr.Animal],set:a.HorizonsOfSpiritIsland,target:ir.Spirit,effects:[{textArea:[.601,.794],text:"In one of Target Spirit's lands, Defend 4.<br><br>Target Spirit may pay 1 Energy to instead Defend 8.",[yn.TargetSpirit]:async({$:e,spirit:a})=>{await e.chooseBetween({effects:[{actionId:"Defend",textArea:[.601,.692],text:"In one of Target Spirit's lands, Defend 4.",[yn.Now]:async()=>{await a.inLands().pickOne((async e=>{await e.defend(4)}))}},{actionId:"PayEnergy",textArea:[.703,.791],text:"Target Spirit may pay 1 Energy to instead Defend 8.",condition:()=>a.energy>=1,[yn.Now]:async()=>{await a.payEnergy(1),await a.inLands().pickOne((async e=>{await e.defend(8)}))}}]})}}]},El={name:"Eerie Noises And Moving Trees",type:Sn.Unique,speed:rr.Slow,energy:2,elements:[nr.Moon,nr.Air,nr.Plant],set:a.HorizonsOfSpiritIsland,target:ir.Land,range:1,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.71,.75],text:"2 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.798,.838],text:"Push up to 2 <explorer>/<town>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(2,e.ExplorerOrTown)}}]},Pl={name:"Mischief And Sabotage",type:Sn.Innate,speed:rr.Fast,set:a.HorizonsOfSpiritIsland,target:ir.Land,sourceFilter:[sr.SacredSite],targetFilter:[sr.Invaders],range:1,generatesFear:!0,effects:[{text:"1 <fear> and Defend 2.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1),await e.defend(2)},threshold:{[nr.Moon]:1,[nr.Plant]:2}},{instead:!0,text:"Instead, 1 <fear> and Defend 4.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1),await e.defend(4)},threshold:{[nr.Moon]:2,[nr.Plant]:3}},{instead:!0,text:"Instead, 3 <fear> and Defend 6.",[yn.InTargetLand]:async({land:e})=>{await e.fear(3),await e.defend(6)},threshold:{[nr.Moon]:2,[nr.Air]:2,[nr.Plant]:4}},{instead:!0,text:"Instead, 5 <fear> and Defend 12.",[yn.InTargetLand]:async({land:e})=>{await e.fear(5),await e.defend(12)},threshold:{[nr.Moon]:3,[nr.Air]:3,[nr.Plant]:5}}]},Sl={name:"Mysterious Abductions",type:Sn.Unique,speed:rr.Fast,energy:1,elements:[nr.Moon,nr.Fire,nr.Plant],set:a.HorizonsOfSpiritIsland,target:ir.Land,range:0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.705,.745],text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.794,.834],text:"1 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(1)}}]},Ol={name:"Whispered Guidance Through The Night",type:Sn.Unique,speed:rr.Slow,energy:0,elements:[nr.Moon,nr.Air,nr.Plant],set:a.HorizonsOfSpiritIsland,target:ir.Land,sourceFilter:[sr.Jungle],range:1,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.682,.722],text:"Gather up to 3 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(3,e.Dahan)}},{textArea:[.762,.855],text:"If Invaders and <dahan> are present, 1 <fear>.",[yn.InTargetLand]:async({$:e,land:a})=>{a.hasAllOf(e.Invader,e.Dahan)&&await a.fear(1)}}]},Cl={name:"Call On Herders For Aid",type:Sn.Unique,speed:rr.Slow,energy:1,elements:[nr.Sun,nr.Fire,nr.Earth,nr.Animal],set:a.HorizonsOfSpiritIsland,target:ir.Land,range:2,hasPushOrGather:!0,effects:[{textArea:[.684,.724],text:"Gather up to 2 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(2,e.Dahan)}},{textArea:[.762,.861],text:"For each <dahan> present, Push up to 1 <explorer>/<town>/<dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(a.numberOf(e.Dahan),e.ExplorerTownOrDahan)}}]},Dl={name:"Gift Of Searing Heat",type:Sn.Unique,speed:rr.Fast,energy:0,elements:[nr.Sun,nr.Fire,nr.Air],set:a.HorizonsOfSpiritIsland,target:ir.Spirit,targetFilter:[ur.Another],hasDamageInstructions:!0,effects:[{textArea:[.679,.86],text:"Target Spirit gains 2 Energy.<or>Target Spirit may pay 1 Energy to do 1 Damage in one of their lands.",[yn.TargetSpirit]:async({$:e,spirit:a})=>{await e.chooseBetween({effects:[{actionId:"GainEnergy",textArea:[.682,.722],text:"Target Spirit gains 2 Energy.",[yn.Now]:async()=>{await a.gainEnergy(2)}},{actionId:"Damage",textArea:[.768,.86],text:"Target Spirit may pay 1 Energy to do 1 Damage in one of their lands.",players:[a],condition:()=>a.energy>=1,[yn.Now]:async()=>{await a.payEnergy(1),await a.inLands().pickOne((async e=>{await e.damage(1)}))}}]})}}]},Bl={name:"Scorch With Waves Of Heat",type:Sn.Innate,speed:rr.Slow,set:a.HorizonsOfSpiritIsland,target:ir.Land,sourceFilter:[sr.SacredSite],range:1,hasDamageInstructions:!0,effects:[{text:"2 Damage, to <explorer> only.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.damage(2,e.Explorer)},threshold:{[nr.Fire]:2,[nr.Air]:2}},{text:"2 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(2)},threshold:{[nr.Fire]:3,[nr.Earth]:2}},{text:"2 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(2)},threshold:{[nr.Fire]:4,[nr.Air]:1,[nr.Earth]:3}},{text:"1 Damage to each Invader.",[yn.InTargetLand]:async({land:e})=>{await e.damageEach(1)},threshold:{[nr.Fire]:5,[nr.Air]:2,[nr.Earth]:3}}]},kl={name:"Stinging Sandstorm",type:Sn.Unique,speed:rr.Slow,energy:1,elements:[nr.Fire,nr.Air,nr.Earth],set:a.HorizonsOfSpiritIsland,target:ir.Land,range:1,hasPushOrGather:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.605,.645],text:"Gather up to 1 of your <presence>.",[yn.InTargetLand]:async({$:e,owner:a,land:t})=>{await t.gather({quantifier:lr.UpTo,amount:1,pieces:e.Presence,owner:a})}},{textArea:[.662,.702],text:"1 <fear> and 1 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1),await e.damage(1)}}]},Ll={name:"Sweltering Exhaustion",type:Sn.Unique,speed:rr.Fast,energy:2,elements:[nr.Fire,nr.Air],set:a.HorizonsOfSpiritIsland,target:ir.Land,sourceFilter:[sr.SacredSite],range:2,generatesFear:!0,effects:[{textArea:[.709,.749],text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.798,.838],text:"Skip up to 1 Ravage/Build Action.",[yn.InTargetLand]:async({land:e})=>{await e.skipInvaderAction({filter:({invaderAction:e})=>e===Hr.Build||e===Hr.Ravage})}}]},Fl={name:"Exaltation Of Tangled Growth",type:Sn.Unique,speed:rr.Slow,energy:0,elements:[nr.Water,nr.Earth,nr.Plant],set:a.HorizonsOfSpiritIsland,target:ir.Spirit,targetFilter:[ur.Another],effects:[{textArea:[.67,.762],text:"Target Spirit may pay 1 Energy to Gain a Power Card.",[yn.TargetSpirit]:async({$:e,spirit:a})=>{a.energy>=1&&await e.may({prompt:"Pay 1 Energy to Gain a Power Card?"})&&(await a.payEnergy(1),await a.gainPowerCard())}},{textArea:[.798,.887],text:"You may pay 2 Energy to Gain a Power Card.",[yn.TargetSpirit]:async({$:e,you:a})=>{a.energy>=2&&await e.may({prompt:"Pay 2 Energy to Gain a Power Card?"})&&(await a.payEnergy(2),await a.gainPowerCard())}}]},Rl={name:"Foul Vapors And Fetid Muck",type:Sn.Unique,speed:rr.Slow,energy:0,elements:[nr.Fire,nr.Air,nr.Water,nr.Earth],set:a.HorizonsOfSpiritIsland,target:ir.Land,sourceFilter:[sr.SacredSite],targetFilter:[sr.Invaders],range:2,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.712,.752],text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.799,.839],text:"Push up to 2 <explorer>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(2,e.Explorer)}}]},Nl={name:"Intractable Thickets And Thorns",type:Sn.Unique,speed:rr.Fast,energy:2,elements:[nr.Moon,nr.Water,nr.Earth,nr.Plant],set:a.HorizonsOfSpiritIsland,target:ir.Land,range:1,generatesFear:!0,effects:[{textArea:[.71,.75],text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.801,.841],text:"Defend 5.",[yn.InTargetLand]:async({land:e})=>{await e.defend(5)}}]},$l={name:"Open Shifting Waterways",type:Sn.Unique,speed:rr.Slow,energy:1,elements:[nr.Moon,nr.Water,nr.Animal],set:a.HorizonsOfSpiritIsland,target:ir.Land,range:1,hasPushOrGather:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.679,.719],text:"Gather up to 2 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(2,e.Dahan)}},{textArea:[.758,.854],text:"If <dahan> and Invaders are present, 1 <fear> and 1 Damage.",[yn.InTargetLand]:async({$:e,land:a})=>{a.hasAllOf(e.Dahan,e.Invader)&&(await a.fear(1),await a.damage(1))}}]},Wl={name:"Spreading And Dreadful Mire",type:Sn.Innate,speed:rr.Slow,set:a.HorizonsOfSpiritIsland,target:ir.Land,sourceFilter:[sr.SacredSite],targetFilter:[sr.Invaders],range:1,hasPushOrGather:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{text:"Move 1 <presence> from the origin <sacred> to the target land. (This is required.)",[yn.InTargetLand]:async({$:e,owner:a,land:t,power:n})=>{await n.validOriginsGivenTargetLand(t).pickOne((async n=>{await n.move({amount:1,pieces:e.Presence,owner:a,locations:{target:Jn.ToThisLocation,location:t}})}),{prompt:"Select origin land."})},threshold:{[nr.Water]:1}},{text:"1 <fear>. 1 Damage. Push 1 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.addSubEffectUntilEndOfTurn({effects:[{text:"1 <fear>",[yn.Now]:async()=>{await a.fear(1)}},{text:"1 Damage.",[yn.Now]:async()=>{await a.damage(1)}},{text:"Push 1 <dahan>.",[yn.Now]:async()=>{await a.pushOne(e.Dahan)}}]})},threshold:{[nr.Moon]:1,[nr.Water]:2,[nr.Earth]:1}},{text:"1 <fear>. 1 Damage. Push 1 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.addSubEffectUntilEndOfTurn({effects:[{text:"1 <fear>",[yn.Now]:async()=>{await a.fear(1)}},{text:"1 Damage.",[yn.Now]:async()=>{await a.damage(1)}},{text:"Push 1 <dahan>.",[yn.Now]:async()=>{await a.pushOne(e.Dahan)}}]})},threshold:{[nr.Moon]:2,[nr.Water]:3,[nr.Earth]:2}},{text:"2 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(2)},threshold:{[nr.Moon]:3,[nr.Water]:4,[nr.Earth]:3,[nr.Plant]:2}}]},Ml={name:"Death Approaches From Beneath The Surface",type:Sn.Innate,speed:rr.Slow,set:a.HorizonsOfSpiritIsland,target:ir.Land,targetFilter:[sr.Invaders],range:1,hasPushOrGather:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{text:"If you don't have <presence> in target land, Gather 1 of your <presence>. (This is required.)",[yn.InTargetLand]:async({$:e,owner:a,land:t})=>{t.hasPresenceOf(a)||await t.gather({amount:1,pieces:e.Presence,owner:a})},threshold:{[nr.Fire]:1,[nr.Animal]:1}},{text:'1 Damage. (+1 for your "Territorial Aggression" Special Rule)',[yn.InTargetLand]:async({$:e,land:a})=>{await a.damage(1,e.Invader)},threshold:{[nr.Fire]:2,[nr.Earth]:1,[nr.Animal]:2}},{text:"2 Damage.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.damage(2,e.Invader)},threshold:{[nr.Fire]:3,[nr.Earth]:1,[nr.Animal]:3}},{effects:[{text:"2 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(2)}},{text:"4 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(4)}}],threshold:{[nr.Fire]:4,[nr.Earth]:2,[nr.Animal]:5}}]},Gl={name:"Ferocious Rampage",type:Sn.Unique,speed:rr.Slow,energy:2,elements:[nr.Fire,nr.Animal],set:a.HorizonsOfSpiritIsland,target:ir.Land,range:0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.637,.677],text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.726,.766],text:"3 Damage to <explorer>/<town> only.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.damage(3,e.ExplorerOrTown)}}]},Hl={name:"Gift Of Furious Might",type:Sn.Unique,speed:rr.Fast,energy:1,elements:[nr.Moon,nr.Fire,nr.Animal],set:a.HorizonsOfSpiritIsland,target:ir.Spirit,targetFilter:[ur.Another],effects:[{textArea:[.621,.756],text:"Once this turn, Target Spirit may deal +3 Damage when using a Damage-dealing Power.",[yn.TargetSpirit]:async({spirit:e,you:a})=>{await e.gainDamageBoost({amount:3,source:a,once:!0})}}]},jl={name:"Herd Towards The Lurking Maw",type:Sn.Unique,speed:rr.Slow,energy:1,elements:[nr.Water,nr.Earth,nr.Animal],set:a.HorizonsOfSpiritIsland,target:ir.Land,range:0,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.71,.75],text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.796,.836],text:"Gather up to 1 <explorer>/<town>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(1,e.ExplorerOrTown)}}]},Ul={name:"Mark Territory With Scars And Teeth",type:Sn.Unique,speed:rr.Fast,energy:2,elements:[nr.Sun,nr.Earth,nr.Animal],set:a.HorizonsOfSpiritIsland,target:ir.Land,range:0,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.664,.704],text:"Defend 9.",[yn.InTargetLand]:async({land:e})=>{await e.defend(9)}},{textArea:[.753,.793],text:"2 <fear> if Invaders are present.",[yn.InTargetLand]:async({land:e})=>{e.hasInvaders&&await e.fear(2)}},{textArea:[.837,.877],text:"Push 2 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.push({amount:2,pieces:e.Dahan})}}]},ql={name:"Gift Of The Sunlit Air",type:Sn.Unique,speed:rr.Fast,energy:0,elements:[nr.Sun,nr.Fire,nr.Air],set:a.HorizonsOfSpiritIsland,target:ir.Spirit,effects:[{textArea:[.638,.745],text:"Target Spirit gets <range+1> with all their Powers.",[yn.TargetSpirit]:async({$:e,you:a,spirit:t})=>{await e.addSubEffectUntilEndOfTurn({[yn.GlobalReminder]:()=>({icon:"<range+1>",spirit:a,players:[t]}),[yn.ExtraRange]:e=>e.spirit===t?1:0})}},{textArea:[.779,.877],text:"If you target another Spirit they gain 1 Energy.",[yn.TargetSpirit]:async({you:e,spirit:a})=>{a!==e&&await a.gainEnergy(1)}}]},_l={name:"Gift Of Wind-Sped Steps",type:Sn.Unique,speed:rr.Fast,energy:1,elements:[nr.Sun,nr.Air,nr.Animal],set:a.HorizonsOfSpiritIsland,target:ir.Spirit,hasPushOrGather:!0,effects:[{textArea:[.64,.778],text:'Once this turn, Target Spirit may choose 1 of their <slow> Powers with a "Push" or "Gather" instruction and make that Power <fast> (for this turn).',[yn.TargetSpirit]:async({spirit:e})=>{await e.gainMakeFastBuff({filter:e=>!0===e.data.hasPushOrGather})}},{textArea:[.815,.91],text:"If you target another Spirit, they gain 1 Energy.",[yn.TargetSpirit]:async({you:e,spirit:a})=>{a!==e&&await a.gainEnergy(1)}}]},Jl={name:"Scatter To The Winds",type:Sn.Unique,speed:rr.Slow,energy:1,elements:[nr.Fire,nr.Air,nr.Water],set:a.HorizonsOfSpiritIsland,target:ir.Land,range:2,hasPushOrGather:!0,effects:[{textArea:[.693,.842],text:"Choose up to 5 <explorer>/<town>/<dahan>.<br>Push them to as many different lands as possible.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.push({amount:5,pieces:e.ExplorerTownOrDahan,quantifier:lr.UpTo,differentLands:!0})}}]},Vl={name:"Tempest Of Leaves And Branches",type:Sn.Unique,speed:rr.Fast,energy:2,elements:[nr.Sun,nr.Air,nr.Plant],set:a.HorizonsOfSpiritIsland,target:ir.Land,sourceFilter:[sr.SacredSite],range:1,hasDamageInstructions:!0,effects:[{textArea:[.679,.863],text:"Choose up to 5 different Invaders (in target land).<br><br>1 Damage to each of them.",[yn.InTargetLand]:async({land:e})=>{await e.damageDifferent(5)}}]},Yl={name:"Violent Windstorms",type:Sn.Innate,speed:rr.Slow,set:a.HorizonsOfSpiritIsland,target:ir.Land,range:1,hasPushOrGather:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{text:"Push up to 1 <explorer>.",[yn.InTargetLand]:async({$:e,land:a,action:t})=>{t.data.moved=await a.pushUpTo(1,e.Explorer)},threshold:{[nr.Sun]:1,[nr.Air]:2}},{effects:[{text:"1 <fear>. Push up to 2 <explorer>/<town>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{text:"Push up to 2 <explorer>/<town>.",[yn.InTargetLand]:async({$:e,land:a,action:t})=>{t.data.moved.push(...await a.pushUpTo(2,e.ExplorerOrTown))}}],threshold:{[nr.Sun]:2,[nr.Air]:3}},{text:"For each Invader Pushed by this Power, 1 Damage in the land it was Pushed to.",[yn.InTargetLand]:async({action:e})=>{if(e.data.moved.length>0){const a=Cr(e.data.moved.map((e=>e.destination)));for(const t of a){const a=e.data.moved.filter((e=>e.destination===t&&e.piece.isInvader&&e.movement===Fr.Push)).length;await t.damage(a)}}},threshold:{[nr.Sun]:2,[nr.Air]:4}},{text:"4 Damage (in target land).",[yn.InTargetLand]:async({land:e})=>{await e.damage(4)},threshold:{[nr.Sun]:3,[nr.Air]:5}}]},zl={name:"Absolute Stasis",type:Sn.Unique,speed:rr.Fast,energy:1,elements:[nr.Sun,nr.Air,nr.Earth],set:a.JaggedEarth,target:ir.Land,sourceFilter:[sr.SacredSite],targetFilter:[sr.NonOceanLand],range:2,mayUse:({spirit:e})=>e.time>=1,effects:[{textArea:[.601,.641],text:"Cost to use: 1 Time.",[yn.InTargetLand]:async({you:e})=>{await e.spendTime(1)}},{textArea:[.644,.921],text:"Until the end of the <slow> phase, target land and everything in it cease to exist for all purposes except checking victory/defeat.<br><br>(You cannot target into, out of, or through where the land was.) This cannot target an Ocean even if Oceans are in play.",[yn.InTargetLand]:async({$:e,...a})=>{a.land.exists=!1,await e.addSubEffectUntilEndOfTurn({[yn.Reminder]:e=>e===a.land?a.effect.text:void 0,[yn.AfterSlowPhase]:()=>(e.removeThisEffect(),a.land.exists=!0,e.setupAdjacencies(),Promise.resolve())}),e.setupAdjacencies()}}]},Ql={name:"Blur The Arc Of Years",type:Sn.Unique,speed:rr.Fast,energy:1,elements:[nr.Sun,nr.Moon,nr.Air],set:a.JaggedEarth,target:ir.Land,range:1,hasPushOrGather:!0,blightWhiteListedPower:!0,effects:[{textArea:[.59,.676],text:"If no <dahan>/Invaders are present: Remove 1 <blight>.",[yn.InTargetLand]:async({$:e,land:a})=>{a.dontHaveAnyOf(e.Dahan,e.Invader)&&await a.removeBlight()}},{textArea:[.684,.761],text:"If Invaders are present: they Build, then Ravage.",[yn.InTargetLand]:async({land:e})=>{e.hasInvaders&&(await e.doExtraBuild(),await e.doExtraRavage())}},{textArea:[.768,.854],text:"If <dahan> are present: Add 1 <dahan>. Push up to 2 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{a.has(e.Dahan)&&(await a.add(1,e.Dahan),await a.pushUpTo(2,e.Dahan))}},{textArea:[.863,.939],text:"You may Repeat this Power (once) on the same land by spending 1 Time.",[yn.InTargetLand]:async({$:e,power:a,land:t,you:n,isRepeat:r})=>{!r&&n.time>=1&&await e.may({prompt:"Spend 1 Time to Repeat this Power?"})&&(await n.spendTime(1),await a.repeatInLocations([t]))}}]},Kl={name:"Pour Time Sideways",type:Sn.Unique,speed:rr.Fast,energy:1,elements:[nr.Moon,nr.Air,nr.Water],set:a.JaggedEarth,target:ir.Spirit,targetFilter:[ur.Yourself],mayUse:({spirit:e})=>e.time>=3,effects:[{textArea:[.602,.642],text:"Cost to Use: 3 Time.",[yn.TargetSpirit]:async({you:e})=>{await e.spendTime(3)}},{textArea:[.643,.94],text:'Move 1 of your <presence> to a different land with your <presence>.<br><br>On the board moved from: During the Invader Phase, Resolve Invader and "Each board / Each land..." Actions one fewer time.<br><br>On the board moved to: During the Invader Phase, Resolve Invader and "Each board / Each land..." Actions one more time.',[yn.TargetSpirit]:async({$:e,power:a,spirit:t})=>{await t.presence().pickOne((async n=>{const r=n.location;await t.inLandsWhere((e=>e!==r)).pickOne((async n=>{await r.move({pieces:e.Presence,owner:t,locations:{target:Jn.ToThisLocation,location:n}}),await r.boards().pickOne((async t=>{await n.boards().pickOne((async n=>{t!==n&&await e.addSubEffectUntilEndOfTurn({[yn.GlobalReminder]:()=>({textArea:[.722,.937],text:`On board ${t.name}: During the Invader Phase, Resolve Invader and "Each board / Each land..." Actions one fewer time.<br><br>On board ${n.name}: During the Invader Phase, Resolve Invader and "Each board / Each land..." Actions one more time.`,power:a.power}),[yn.AdjustNumberOfActions]:({land:a,board:r})=>{let i=0;return![Wi.BlightedIsland,Wi.Event,Wi.Fear,Wi.HighImmigration,Wi.Ravage,Wi.Build,Wi.Explore].includes(e.phase)||void 0===a&&void 0===r||((void 0!==a&&a.boards().has(t)||r===t)&&(i-=1),(void 0!==a&&a.boards().has(n)||r===n)&&(i+=1)),i}})}))}))}))}))}}]},Xl={name:"Slip The Flow Of Time",type:Sn.Innate,speed:rr.Fast,set:a.JaggedEarth,target:ir.Spirit,mayUse:({power:e,spirit:a})=>a.time>=e.costTime,effects:[{text:"You may use this Power any number of times. Cost to use: 1 Time per previous use this turn.",[yn.TargetSpirit]:async({power:e,you:a})=>{await a.spendTime(e.costTime)}},{text:"Target Spirit may Resolve 1 <slow> Power now.",[yn.TargetSpirit]:async({spirit:e})=>{await e.powersWhere((e=>e.isA(En.Any)&&e.status===Fd.PlayedSlow)).optionallyPickOne((async a=>{await e.targetAndResolvePower(a)}))},threshold:{[nr.Moon]:3,[nr.Air]:1}},{text:"Target Spirit may Reclaim 1 Power Card from their discarded or played cards. (If they Reclaim a card from play, they lose its Elements.)",[yn.TargetSpirit]:async({spirit:e})=>{await e.powersWhere((e=>e.isA(En.AnyCard)&&!e.isInHand)).optionallyPickOne((async e=>{await e.reclaim()}))},threshold:{[nr.Sun]:2,[nr.Moon]:2}},{text:"Target Spirit may play a Power Card by paying its cost.",[yn.TargetSpirit]:async({spirit:e})=>{await e.playAPowerCardByPayingItsCost()},threshold:{[nr.Sun]:3,[nr.Air]:2}},{text:"You may use this Power any number of times. Cost to use: 1 Time per previous use this turn.",[yn.TargetSpirit]:async({$:e,power:a})=>{await e.addEffectUntilEndOfAction({[yn.ActionEnds]:async()=>{await a.setStatus(Fd.PlayedFast),await e.addEffectUntilEndOfTurn({[yn.PowerCostExtraTime]:e=>e.power===a?1:0})}})}}]};var Zl;!function(e){e.Discard="Discard",e.HighImmigration="HighImmigration",e.Ravage="Ravage",e.Build="Build",e.Explore="Explore",e.Deck="Deck"}(Zl||(Zl={}));const eh={name:"The Past Returns Again",type:Sn.Unique,speed:rr.Fast,energy:0,elements:[nr.Sun,nr.Moon],set:a.JaggedEarth,target:ir.Spirit,targetFilter:[ur.Yourself],mayUse:({$:e,spirit:a})=>e.playersCanJointlyPayEnergyAidedBy({energy:e.spiritCount})&&a.time>=e.spiritCount,effects:[{textArea:[.608,.684],text:"Cost to Use: N Time, and Spirits jointly pay N Energy (where N = # of players).",[yn.TargetSpirit]:async({$:e,spirit:a})=>{await a.spendTime(e.spiritCount),await e.payEnergyJointlyAidedBy({energy:e.spiritCount})}},{textArea:[.692,.913],text:"Swap the top card of the Invader Deck with a card in the Invader discard that is within 1 Invader Stage of it.<br>The discarded card stays face-down. The card going onto the deck turns face-down. You can't swap cards that don't exist.)",[yn.TargetSpirit]:async({$:e})=>{const a=e.invaderDeckInSlot(Zl.Discard),t=e.stageNumbersInSlot(Zl.Discard),n=[1,2,3].filter((a=>Math.abs(e.stage-a)<=1));e.invaderCardsInExploreDeck.length>0&&await e.chooseBetween({text:"Choose card from discard to swap.",effects:a.cards.map(((r,i)=>({actionId:null!==r?r:`Stage${t[i]}Card`,label:null!==r?`${Mo[r].text}`:`Stage ${t[i]} Card`,[yn.Now]:async()=>{const t=e.invaderDeckInSlot(Zl.Discard).possibleCardsAt(i);a.removeCard(i);const n=e.actualExploreCardIndex(0),r=e.exploreDeck.possibleCardsAt(n);await e.removeInvaderCard(0,{swapping:!0}),e.invaderDeckInSlot(Zl.Discard).insertAtBottomOneOf(r),await e.addExploreCardToTop(t,n)},condition:()=>n.includes(t[i])})))})}}]},ah={name:"Visions Of A Shifting Future",type:Sn.Innate,speed:rr.Slow,set:a.JaggedEarth,target:ir.Spirit,targetFilter:[ur.Yourself],effects:[{effects:[{text:"Look at the top card of either the Invader Deck or (if relevant) the Event Deck.",[yn.TargetSpirit]:async({$:e,you:a})=>{const t={[nr.Sun]:2,[nr.Moon]:3,[nr.Air]:2},n=a.hasElementsWithConvert(t);await e.chooseBetween({effects:[{actionId:"Invader",text:"Look at the top card of the Invader Deck.",[yn.Now]:async()=>{null!==await e.revealTopInvaderCard()&&await e.chooseBetween({text:"Return it, then shuffle that deck's top 2 cards. (For the Invader Deck, differing Invader Stages may give away which card is next.)<br><br>If you have 2 <sun>, 3 <moon>, and 2 <air>: Instead of returning-and-shuffling, you may put the card you looked at on the bottom of its deck. You may not do this for cards specially placed during Setup.",effects:[{actionId:"ReturnAndShuffle",text:"Return it, then shuffle that deck's top 2 cards.",[yn.Now]:async()=>{await e.shuffleTopTwoInvaderCards()}},{actionId:"PutOnBottom",label:"Put the card on the bottom of its deck",text:"Instead of returning-and-shuffling, you may put the card you looked at on the bottom of its deck. You may not do this for cards specially placed during Setup.",condition:()=>n&&!e.invaderCardAtIndexIsSpecial(0),[yn.Now]:async()=>{await a.convertElements(t),await e.putTopInvaderCardToBottom()}}]})},condition:()=>e.invaderCardsInExploreDeck.length>0},{actionId:"Event",text:"Look at the top card of the Event Deck.",condition:()=>!!e.config.events&&!e.eventCardsInDeck.isEmpty,[yn.Now]:async()=>{await e.revealTopEventCard(),await e.chooseBetween({effects:[{actionId:"ReturnAndShuffle",text:"Return it, then shuffle that deck's top 2 cards.",[yn.Now]:async()=>{await e.shuffleTopTwoEventCards()}},{actionId:"PutOnBottom",label:"Put the card on the bottom of its deck",text:"Instead of returning-and-shuffling, you may put the card you looked at on the bottom of its deck. You may not do this for cards specially placed during Setup.",condition:()=>n&&!e.eventCardAtIndexIsSpecial(0),[yn.Now]:async()=>{await a.convertElements(t),e.putTopEventCardToBottom()}}]})}}]})}}],threshold:{[nr.Sun]:1,[nr.Moon]:2,[nr.Air]:2}},{threshold:{[nr.Sun]:2,[nr.Moon]:3,[nr.Air]:2},[yn.TargetSpirit]:async()=>{}}]},th={name:"Forsake Society To Chase After Dreams",type:Sn.Innate,speed:rr.Slow,set:a.JaggedEarth,target:ir.Land,targetFilter:[sr.Invaders],range:1,hasPushOrGather:!0,generatesFear:!0,effects:[{text:"After this Power Replaces pieces with <explorer>: Gather any number of those <explorer> into your lands. If target land has any <town>/<city> remaining, 1 <fear>.",[yn.InTargetLand]:async({$:e,you:a,land:t,power:n,...r})=>{const i={triggerId:e.nextTriggerId(),[yn.Now]:async({action:n})=>{await t.piecesWhere((e=>n.parentData.replacedExplorer.includes(e))).pickMultiple({optional:!0,repeatSame:!1,amount:n.parentData.replacedExplorer.length,forPickedItem:async e=>{await e.move({destinationFilter:e=>e.hasPresenceOf(a),movement:Fr.Gather})}}),t.has(e.TownOrCity)&&(await e.sendEvent({type:fn.GenericSub,text:"Target land had <town>/<city> remaining."}),await t.fear(1))}};await e.addSubEffectUntilEndOfAction({[yn.AfterReplacePieces]:async({added:a})=>{if(e.action.power===n)for(const{piece:n,location:s}of a)s===t&&n.isA(e.Explorer)&&(void 0===e.action.data.replacedExplorer&&(e.action.data.replacedExplorer=[]),e.action.data.replacedExplorer.push(n),await e.addTrigger(i,r.effect,r.action))}})}},{text:"Replace 1 <explorer> with 1 <explorer>",[yn.InTargetLand]:async({$:e,land:a})=>{await a.replaceOne({pieces:e.Explorer,withPiece:Bn.Explorer})},threshold:{[nr.Moon]:2}},{instead:!0,text:"Instead, Replace 1 <town> with 2 <explorer>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.replaceOne({pieces:e.Town,withAmount:2,withPiece:Bn.Explorer})},threshold:{[nr.Moon]:2,[nr.Air]:1}},{instead:!0,text:"Instead, Replace 1 <city> with 3 <explorer>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.replaceOne({pieces:e.City,withAmount:3,withPiece:Bn.Explorer})},threshold:{[nr.Moon]:3,[nr.Air]:2,[nr.Animal]:1}},{text:"Repeat this Power.",[yn.InTargetLand]:async({power:e,isRepeat:a})=>{a||await e.repeat()},threshold:{[nr.Air]:4},dontResolveAlone:!0}]},nh={name:"Gift Of The Untamed Wild",type:Sn.Unique,speed:rr.Slow,energy:0,elements:[nr.Moon,nr.Fire,nr.Air,nr.Plant],set:a.JaggedEarth,target:ir.Spirit,effects:[{textArea:[.647,.855],text:"Target Spirit chooses to either:<br><br>Add 1 <wilds> to one of their lands.<or>Replace 1 of their <presence> with 1 <disease>.",[yn.TargetSpirit]:async({$:e,spirit:a})=>{await e.chooseBetween({effects:[{actionId:"AddWilds",textArea:[.715,.755],text:"Add 1 <wilds> to one of their lands.",[yn.Now]:async()=>{await a.inLands().pickOne((async a=>{await a.add(1,e.Wilds)}))}},{actionId:"Replace",textArea:[.802,.842],text:"Replace 1 of their <presence> with 1 <disease>.",[yn.Now]:async()=>{await a.presence().pickOne((async e=>{await e.replace([Bn.Disease])}))}}]})}}]},rh={name:"Never Heard From Again",type:Sn.Innate,speed:rr.Slow,set:a.JaggedEarth,target:ir.Land,targetFilter:[sr.Inland],range:0,generatesFear:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{text:"Add 1 <badlands>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Badlands)},threshold:{[nr.Fire]:1,[nr.Plant]:3}},{text:"Destroy up to 2 <explorer> per <badlands>/<beasts>/<disease>/<wilds>",[yn.InTargetLand]:async({$:e,land:a,action:t})=>{t.data.removed=await a.destroyUpTo(2*(a.numberOf(e.Badlands)+a.numberOf(e.Beasts)+a.numberOf(e.Disease)+a.numberOf(e.Wilds)),e.Explorer)},threshold:{[nr.Plant]:2}},{text:"2 Damage.",[yn.InTargetLand]:async({land:e,action:a})=>{a.data.removed.push(...await e.damage(2))},threshold:{[nr.Plant]:4,[nr.Animal]:1}},{text:"If this Power Destroys any <explorer>, 1 <fear>.<br>If this Power Destroys 5 or more <explorer>, +1 <fear>.",[yn.InTargetLand]:async({$:e,action:a,land:t})=>{const n=a.data.removed.filter((a=>a.piece.isA(e.Explorer)&&pr[a.removement].isDestroyLike)).length;n>0&&n<5?(await e.sendEvent({type:fn.GenericSub,text:"Never Heard From Again Destroyed at least one <explorer>."}),await t.fear(1)):n>=5&&(await e.sendEvent({type:fn.GenericSub,text:"Never Heard From Again Destroyed at least 5 <explorer>."}),await t.fear(2))}},{text:"Repeat this Power.",[yn.InTargetLand]:async({power:e,isRepeat:a})=>{a||await e.repeat()},threshold:{[nr.Plant]:6}}]},ih={name:"Perils Of The Deepest Island",type:Sn.Unique,speed:rr.Slow,energy:1,elements:[nr.Moon,nr.Plant,nr.Animal],set:a.JaggedEarth,target:ir.Land,targetFilter:[sr.Inland],range:0,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.679,.719],text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.679,.719],text:"Add 1 <badlands>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Badlands)}},{textArea:[.722,.762],text:"Add 1 <beasts> within <range-1>.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await t.inLandsWithin(1,a).pickOne((async a=>{await a.add(1,e.Beasts)}))}},{textArea:[.802,.842],text:"Push up to 2 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(2,e.Dahan)}}]},sh={name:"Society Dissolves At The Beckoning Heart",type:Sn.Innate,speed:rr.Fast,set:a.NatureIncarnate,target:ir.Land,targetFilter:[sr.IncarnaLair],hasPushOrGather:!0,effects:[{textArea:[.271,.401],text:"For every 3 <explorer>/<dahan>, Downgrade a different <town>/<city>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.downgrade({amount:a.forEvery(3,e.ExplorerOrDahan),pieces:e.TownOrCity,different:!0})},threshold:{[nr.Moon]:1}},{textArea:[.436,.492],text:"Gather 1 <explorer>/<town> and 1 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherOne(e.ExplorerOrTown),await a.gatherOne(e.Dahan)},threshold:{[nr.Moon]:3,[nr.Air]:1}},{textArea:[.543,.712],text:"Once for every 6 <explorer>/<dahan> present (at <incarna-lair>): Gather any Invader within <range-air> one land towards <incarna-lair>.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElementsToCombo({[nr.Air]:1}),await t.forPiecesWithin(a.elements[nr.Air],a).where((e=>e.location!==t&&e.isInvader)).pickMultiple({amount:t.forEvery(6,e.ExplorerOrDahan),forPickedItem:async e=>{await e.location.inAdjacentLands().withLeast((e=>e.distanceToLocation(t))).where((a=>a.distanceToLocation(t)<e.location.distanceToLocation(t))).pickOne((async a=>{await e.move({locations:{target:Jn.ToThisLocation,location:a},movement:Fr.Gather})}),{prompt:`Pick land to Gather ${Kn[e.piece].text}`,highlightPieces:[e]})}})},threshold:{[nr.Moon]:4,[nr.Air]:1}}]},oh={name:"Softly Beckon Ever Inward",type:Sn.Unique,speed:rr.Slow,energy:2,elements:[nr.Moon,nr.Air],set:a.JaggedEarth,target:ir.Land,targetFilter:[sr.Inland],range:0,hasPushOrGather:!0,effects:[{textArea:[.657,.697],text:"Gather up to 2 <explorer>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(2,e.Explorer)}},{textArea:[.716,.756],text:"Gather up to 2 <town>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(2,e.Town)}},{textArea:[.779,.819],text:"Gather up to 2 <beasts>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(2,e.Beasts)}},{textArea:[.84,.88],text:"Gather up to 2 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(2,e.Dahan)}}]},dh={name:"Swallowed By The Wilderness",type:Sn.Unique,speed:rr.Fast,energy:1,elements:[nr.Fire,nr.Air,nr.Plant,nr.Animal],set:a.JaggedEarth,target:ir.Land,targetFilter:[sr.Inland],range:0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.687,.727],text:"2 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.742,.837],text:"1 Damage per <beasts>/<disease>/<wilds>/<badlands>. (Count max. 5 tokens.)",[yn.InTargetLand]:async({$:e,land:a})=>{await a.damage(Math.min(a.numberOf(e.Badlands)+a.numberOf(e.Beasts)+a.numberOf(e.Disease)+a.numberOf(e.Wilds),5))}}]},ch={name:"A Dreadful Tide Of Scurrying Flesh",type:Sn.Unique,speed:rr.Fast,energy:0,elements:[nr.Moon,nr.Air,nr.Water,nr.Animal],set:a.JaggedEarth,target:ir.Land,sourceFilter:[sr.SacredSite],targetFilter:[sr.TwoBeasts],range:1,generatesFear:!0,effects:[{textArea:[.664,.867],text:"Remove up to half (round down) of <beasts> in target land.<br><br>For each <beasts> Removed, 2 <fear> and skip one Invader Action.",[yn.InTargetLand]:async({$:e,land:a})=>{const t=(await a.remove({quantifier:lr.UpTo,amount:Math.floor(a.numberOf(e.Beasts)/2),pieces:e.Beasts})).length;await a.fear(2*t),await a.skipInvaderAction({textArea:[.819,.859],amount:t})}}]},lh={name:"Beset And Confound The Invaders",type:Sn.Innate,speed:rr.Fast,set:a.JaggedEarth,target:ir.Land,targetFilter:[sr.TwoBeastsAndInvaders],range:2,generatesFear:!0,effects:[{text:"<beasts> (below) checks the number of <beasts> in target land.<br><br>2 <beasts>: 2 <fear> and Defend 2",[yn.InTargetLand]:async({land:e})=>{await e.fear(2),await e.defend(2)},threshold:{[nr.Air]:1,[nr.Animal]:2},targetLandThresholdCondition:e=>e.numberOf(Qn.Beasts)>=2},{instead:!0,text:"3 <beasts>: Instead, 3 <fear> and Defend 4.",[yn.InTargetLand]:async({land:e})=>{await e.fear(3),await e.defend(4)},threshold:{[nr.Air]:2,[nr.Animal]:3},targetLandThresholdCondition:e=>e.numberOf(Qn.Beasts)>=3},{instead:!0,text:"4 <beasts>: Instead, 4 <fear> and Defend 7.",[yn.InTargetLand]:async({land:e})=>{await e.fear(4),await e.defend(7)},threshold:{[nr.Air]:3,[nr.Animal]:4},targetLandThresholdCondition:e=>e.numberOf(Qn.Beasts)>=4},{instead:!0,text:"6 <beasts>: Instead, 6 <fear> and Defend 10.",[yn.InTargetLand]:async({land:e})=>{await e.fear(6),await e.defend(10)},threshold:{[nr.Air]:4,[nr.Earth]:1,[nr.Animal]:5},targetLandThresholdCondition:e=>e.numberOf(Qn.Beasts)>=5}]},hh={name:"Boon Of Swarming Bedevilment",type:Sn.Unique,speed:rr.Fast,energy:0,elements:[nr.Air,nr.Water,nr.Animal],set:a.JaggedEarth,target:ir.Spirit,targetFilter:[ur.Another],hasPushOrGather:!0,effects:[{textArea:[.653,.785],text:"For the rest of this turn, each of target Spirit's <presence> grants Defend 1 in its land.",[yn.TargetSpirit]:async({$:e,power:a,spirit:t})=>{await e.addEffectUntilEndOfTurn({[yn.GlobalReminder]:()=>({icon:"Defend<br><presence",power:a.power,players:[t]}),[yn.DefendFromSpirits]:({land:e})=>e.numberOfPresenceOf(t)})}},{textArea:[.802,.888],text:"Target Spirit may Push up to 1 of their <presence>.",[yn.TargetSpirit]:({spirit:e})=>e.presence().optionallyPickOne((async e=>{await e.push()}))}]},uh={name:"Ever-Multiplying Swarm",type:Sn.Unique,speed:rr.Slow,energy:1,elements:[nr.Fire,nr.Earth,nr.Animal],set:a.JaggedEarth,target:ir.Land,range:0,effects:[{textArea:[.743,.783],text:"Add 2 <beasts>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.add(2,e.Beasts)}}]},gh={name:"Guide The Way On Feathered Wings",type:Sn.Unique,speed:rr.Fast,energy:0,elements:[nr.Sun,nr.Air,nr.Animal],set:a.JaggedEarth,target:ir.Land,range:1,effects:[{textArea:[.646,.886],text:"Move 1 <beasts> up to two lands. As it moves, up to 2 <dahan> may move with it, for part or all of the way.<br><br>The <beasts>/<dahan> may move to an adjacent land and then back.)",[yn.InTargetLand]:async({$:e,land:a})=>{const t=await a.move({pieces:e.Beasts});if(t.length>0){const n=t[0].destination;await a.move({quantifier:lr.UpTo,amount:2,pieces:e.Dahan,locations:{target:Jn.ToThisLocation,location:n}});const r=await n.move({pieces:e.Beasts});if(r.length>0){const a=r[0].destination;await n.move({quantifier:lr.UpTo,amount:2,pieces:e.Dahan,locations:{target:Jn.ToThisLocation,location:a}})}}}}]},fh={name:"Pursue With Scratches Pecks And Stings",type:Sn.Unique,speed:rr.Fast,energy:0,elements:[nr.Sun,nr.Fire,nr.Air,nr.Animal],set:a.JaggedEarth,target:ir.Land,targetFilter:[sr.Beasts],range:2,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.677,.717],text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.732,.831],text:"For each <beasts> past the first, Push 1 <explorer>/<town>.",[yn.InTargetLand]:async({$:e,land:a})=>{a.has(e.Beasts)&&(await a.possiblyDontCountPiecesAs(Bn.Beasts),await a.push({amount:Math.max(a.numberOf(e.Beasts)-1,0),pieces:e.ExplorerOrTown}))}}]},ph={name:"The Teeming Host Arrives",type:Sn.Innate,speed:rr.Fast,set:a.JaggedEarth,target:ir.Land,range:2,hasPushOrGather:!0,effects:[{text:"Gather up to 1 <beasts>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(1,e.Beasts)},threshold:{[nr.Air]:2,[nr.Animal]:1}},{instead:!0,text:"Instead, Gather up to 1 <beasts> per <air> you have.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await a.askToConvertElementsToCombo({[nr.Air]:1}),await t.gatherUpTo(a.elements[nr.Air],e.Beasts)},threshold:{[nr.Air]:3,[nr.Water]:1,[nr.Animal]:2}},{text:"Push up to 3 <beasts>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(3,e.Beasts)},threshold:{[nr.Fire]:1,[nr.Air]:4,[nr.Animal]:2}}]},wh={name:"Boon Of Ancient Memories",type:Sn.Unique,speed:rr.Slow,energy:1,elements:[nr.Moon,nr.Water,nr.Earth,nr.Plant],set:a.JaggedEarth,target:ir.Spirit,effects:[{textArea:[.618,.907],text:"If you target yourself, gain a Minor Power. Otherwise: Target Spirit gains a Power Card. If it's a Major Power, they may pay 2 Energy instead of Forgetting a Power Card.",[yn.TargetSpirit]:async({$:e,you:a,spirit:t})=>{t===a?await t.gainPowerCard({powerType:Sn.Minor}):await e.chooseBetween({effects:[{actionId:"MinorPower",textArea:[.723,.817],text:"Gain a Minor Power",[yn.Now]:async()=>{await t.gainPowerCard({powerType:Sn.Minor})}},{actionId:"MajorPower",textArea:[.723,.817],text:"Gain a Major Power",[yn.Now]:async()=>{await t.gainPowerCard({powerType:Sn.Major})}},{actionId:"PayEnergy",textArea:[.814,.906],text:"Pay 2 Energy to Gain a Major Power without Forgetting a Power Card.",[yn.Now]:async()=>{await t.payEnergy(2),await t.gainPowerCard({powerType:Sn.Major,withoutForgetting:!0})},condition:()=>t.energy>=2}]})}}]},yh={name:"Elemental Teachings",type:Sn.Unique,speed:rr.Fast,energy:0,elements:[nr.Moon,nr.Air,nr.Earth],set:a.JaggedEarth,target:ir.Spirit,effects:[{textArea:[.64,.68],text:"Prepare 1 Element Marker.",[yn.TargetSpirit]:async({you:e})=>{await e.prepareElement()}},{textArea:[.699,.897],text:"Discard up to 3 Element Markers. Target Spirit gains those Elements. (They can be any combination of Elements - the same or different.)",[yn.TargetSpirit]:async({you:e,spirit:a})=>{const t=await e.discardElements(3,{optional:!0});await a.gainElementsUntilEndOfTurn(t)}}]},mh={name:"Learn The Invaders Tactics",type:Sn.Innate,speed:rr.Fast,set:a.JaggedEarth,target:ir.Land,targetFilter:[sr.Invaders],range:1,effects:[{text:"Defend 2",[yn.InTargetLand]:async({land:e})=>{await e.defend(2)},threshold:{[nr.Earth]:2}},{instead:!0,text:"Instead, Defend 3",[yn.InTargetLand]:async({land:e})=>{await e.defend(3)},threshold:{[nr.Air]:1,[nr.Earth]:2}},{instead:!0,text:"Instead, Defend 2 per card in the Invader discard pile.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.defend(Math.max(e.invaderCardsInSlot(Zl.Discard).length))},threshold:{[nr.Moon]:2,[nr.Air]:3,[nr.Earth]:4}}]},vh={name:"Observe The Ever Changing World",type:Sn.Innate,speed:rr.Fast,set:a.JaggedEarth,target:ir.Land,range:1,effects:[{text:"Prepare 1 Element Marker.",[yn.InTargetLand]:async({you:e})=>{await e.prepareElement()},threshold:{[nr.Moon]:1}},{instead:!0,text:"After each of the next three Actions that change which pieces are in target land, Prepare 1 Element Marker.",[yn.InTargetLand]:async({$:e,you:a,land:t,...n})=>{let r=0;const i={triggerId:e.nextTriggerId(),[yn.Now]:async()=>{r<3&&(await a.prepareElement(),r+=1)}};await e.addSubEffectUntilEndOfTurn({[yn.Reminder]:e=>e===t?`${n.effect.text}<br><br>(${3-r} left.)`:void 0,[yn.AfterAddingPiece]:async a=>{a.land===t&&a.additions.length>0&&await e.addTrigger(i,n.effect,n.action)},[yn.AfterRemovePiece]:async a=>{a.location===t&&await e.addTrigger(i,n.effect,n.action)},[yn.AfterAddingStrife]:async({piece:a})=>{a.location===t&&await e.addTrigger(i,n.effect,n.action)},[yn.AfterMoving]:async a=>{a.source!==t&&a.destination!==t||a.movement===Fr.Relocate||await e.addTrigger(i,n.effect,n.action)}})},threshold:{[nr.Moon]:2,[nr.Air]:1}}]},Ah={name:"Share Mentorship And Expertise",type:Sn.Innate,speed:rr.Fast,set:a.NatureIncarnate,target:ir.Spirit,targetFilter:[ur.Another],effects:[{textArea:[.252,.358],text:"Put a Power Card from your hand or discard into target Spirit's hand.",[yn.TargetSpirit]:async({you:e,spirit:a,action:t})=>{await e.powersWhere((e=>e.isInHand||e.isInDiscard)).pickOne((async n=>{a!==e&&await a.givePower(n),t.data.givenPower=n}))},threshold:{[nr.Air]:1}},{textArea:[.365,.479],text:"Target Spirit may play that Power Card now by paying its cost.",[yn.TargetSpirit]:async({spirit:e,action:a})=>{const t=a.data.givenPower;void 0!==t&&await e.playAPowerCardByPayingItsCost((e=>e===t))},threshold:{[nr.Air]:3,[nr.Earth]:2}},{textArea:[.483,.645],text:"Target Spirit may Repeat that Power Card once this turn by paying its cost.",[yn.TargetSpirit]:async({$:e,spirit:a,action:t})=>{const n=t.data.givenPower;await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({[yn.GlobalReminder]:()=>({power:n.power,players:[a]}),[yn.MayRepeatPowercard]:({power:e,speed:t})=>e===n&&e.costToPlay<=a.energy&&e.possibleToRepeatAtSpeed(t),[yn.RepeatPowerCard]:async({power:a,speed:t})=>{a===n&&e.removeThisEffect(),await a.payForPlay(),await a.replay(t)}})},threshold:{[nr.Sun]:1,[nr.Air]:4,[nr.Earth]:3}},{textArea:[.652,.813],text:"Prepare 1 Element Marker matching an Element on that Power Card. Prepare 1 Element Marker of your choice.",[yn.TargetSpirit]:async({you:e,action:a})=>{const t=a.data.givenPower,n=t.power===Mi.ElementalBoon?Sd:t.data.elements;void 0!==n&&n.length>0&&await e.prepareElement(n),await e.prepareElement()},threshold:{[nr.Air]:1}}]},Ih={name:"Share Secrets Of Survival",type:Sn.Unique,speed:rr.Fast,energy:0,elements:[nr.Sun,nr.Air,nr.Earth],set:a.JaggedEarth,target:ir.Land,sourceFilter:[sr.SacredSite],range:1,hasPushOrGather:!0,effects:[{textArea:[.592,.939],text:"Each time <dahan> would be Destroyed in target land, Destroy 2 fewer <dahan>.<or>Gather up to 2 <dahan>.<br><br>If you have 3 <air>:<br>You may do both.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{const n={actionId:"DestroyFewer",textArea:[.588,.692],text:"Each time <dahan> would be Destroyed in target land, Destroy 2 fewer <dahan>",[yn.Now]:async({effect:a})=>{await e.addSubEffectUntilEndOfTurn({[yn.Reminder]:e=>e===t?a.text:void 0,[yn.OrderOfRemoveAllMightMatter]:()=>!0,[yn.PreventRemovePiece]:async a=>{const n=e.action.data.savedDahanThisAction??0;return!!(a.location===t&&a.piece.isA(e.Dahan)&&pr[a.removement].isDestroyLike&&n<2)&&(e.action.data.savedDahanThisAction=(n??0)+1,await e.sendEvent({type:fn.GenericSub,text:"<p>ShareSecretsOfSurvival</p> saved the <dahan> from Destruction."}),!0)}})}},r={actionId:"GatherDahan",textArea:[.739,.779],text:"Gather up to 2 <dahan>.",[yn.Now]:async()=>{await t.gatherUpTo(2,e.Dahan)}};await e.chooseBetween({effects:[n,r,{actionId:"DoBoth",textArea:[.893,.933],text:"Do both.",condition:()=>!e.treatingAllOrsAsAnds&&a.hasElementsWithConvert({[nr.Air]:3}),[yn.Now]:async()=>{await a.convertElements({[nr.Air]:3}),await e.addSubEffectUntilEndOfTurn({effects:[n,r]})}}]})}}]},xh={name:"Study The Invader's Fears",type:Sn.Unique,speed:rr.Fast,energy:0,elements:[nr.Moon,nr.Air,nr.Animal],set:a.JaggedEarth,target:ir.Land,targetFilter:[sr.Town,sr.City],range:0,generatesFear:!0,effects:[{textArea:[.692,.732],text:"2 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.748,.841],text:"Turn the top card of the Fear Deck face-up.",[yn.InTargetLand]:async({$:e})=>{const a=await e.revealTopFearCard();null!==a&&await e.query({query:pn.ClickToContinueCard,items:[a],actionIds:[a]})}}]},bh={name:"Dissolving Vapors",type:Sn.Unique,speed:rr.Slow,energy:2,elements:[nr.Air,nr.Water],set:a.JaggedEarth,target:ir.Land,range:0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.68,.72],text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.745,.785],text:"1 Damage to each Invader.",[yn.InTargetLand]:async({land:e})=>{await e.damageEach(1)}},{textArea:[.807,.847],text:"1 Damage to each <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.damageEach(1,e.Dahan)}}]},Th={name:"Flowing And Silent Forms Dart By",type:Sn.Unique,speed:rr.Fast,energy:0,elements:[nr.Moon,nr.Air,nr.Water],set:a.JaggedEarth,target:ir.Land,range:0,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.598,.638],text:"2 <fear> if Invaders are present.",[yn.InTargetLand]:async({land:e})=>{e.hasInvaders&&await e.fear(2)}},{textArea:[.657,.789],text:"When <presence> in target land would be Destroyed, its owner may if possible, instead Push that <presence>.",[yn.InTargetLand]:async({$:e,land:a,effect:t})=>{await e.addSubEffectUntilEndOfTurn({[yn.Reminder]:e=>e===a?t.text:void 0,[yn.PreventRemovePiece]:async({piece:e,location:t,removement:n})=>{if(t===a&&pr[n].isDestroyLike&&e.isPresence){return(await a.push({piece:e,quantifier:lr.May})).length>0}return!1}})}},{textArea:[.805,.939],text:"You may Gather 1 <presence>/<sacred> of another Spirit (with their permission).",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{const n=await t.gather({quantifier:lr.May,amount:1,pieces:e.Presence,pieceFilter:e=>e.owner!==a,pickPiecesEffect:{prompt:"Pick 1 <presence>/<sacred> to Gather. 2 <presence> left"}});n.length>0&&await t.gather({quantifier:lr.May,amount:1,pieces:e.Presence,pieceFilter:e=>e.location===n[0].source&&e.owner===n[0].piece.owner})}}]},Eh={name:"Lost In The Swirling Haze",type:Sn.Innate,speed:rr.Slow,set:a.JaggedEarth,target:ir.Land,range:0,hasPushOrGather:!0,effects:[{text:"Push up to 1 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(1,e.Dahan)},threshold:{[nr.Air]:1,[nr.Water]:2}},{text:"Push up to 2 <explorer>/<dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(2,e.ExplorerOrDahan)},threshold:{[nr.Air]:2,[nr.Water]:3}},{text:"Push up to 2 <explorer>/<dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(2,e.ExplorerOrDahan)},threshold:{[nr.Air]:3,[nr.Water]:4}}]},Ph={name:"Suffocating Shroud",type:Sn.Innate,speed:rr.Slow,set:a.JaggedEarth,target:ir.Land,range:0,hasDamageInstructions:!0,effects:[{text:"1 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(1)},threshold:{[nr.Moon]:1,[nr.Air]:2,[nr.Water]:1}},{text:"For each adjacent land with your <presence>, 1 Damage to a different Invader.",[yn.InTargetLand]:async({you:e,land:a})=>{const t=a.inAdjacentLandsWhere((a=>a.hasPresenceOf(e))).count;await a.damageDifferent(t)},threshold:{[nr.Moon]:2,[nr.Air]:3,[nr.Water]:2}},{text:"1 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(1)},threshold:{[nr.Moon]:4,[nr.Air]:4,[nr.Water]:3}},{text:"1 Damage to each Invader.",[yn.InTargetLand]:async({land:e})=>{await e.damageEach(1)},threshold:{[nr.Moon]:5,[nr.Air]:6,[nr.Water]:4}}]},Sh={name:"The Fog Closes In",type:Sn.Unique,speed:rr.Slow,energy:1,elements:[nr.Moon,nr.Air,nr.Water],set:a.JaggedEarth,target:ir.Land,range:0,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{textArea:[.674,.807],text:"For each adjacent land with your <presence>, 1 Damage to a different Invader.",[yn.InTargetLand]:async({you:e,land:a})=>{const t=a.inAdjacentLandsWhere((a=>a.hasPresenceOf(e))).count;await a.damageDifferent(t)}},{textArea:[.824,.864],text:"Push 2 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.push({amount:2,pieces:e.Dahan})}}]},Oh={name:"Unnerving Pall",type:Sn.Unique,speed:rr.Fast,energy:1,elements:[nr.Moon,nr.Air,nr.Animal],set:a.JaggedEarth,target:ir.Land,targetFilter:[sr.Invaders],range:0,generatesFear:!0,effects:[{textArea:[.607,.921],text:"1 <fear>. Up to 3 damaged Invaders do not participate in Ravage.<or>1 <fear>. Defend 1 per <presence> you have in target land (when this Power is used).",[yn.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"DoNotParticipate",textArea:[.613,.706],text:"1 <fear>. Up to 3 damaged Invaders do not participate in Ravage.",effects:[{text:"1 <fear>.",[yn.Now]:async()=>{await a.fear(1)}},{text:"Up to 3 damaged Invaders do not participate in Ravage.",[yn.Now]:async({effect:t})=>{await a.fear(1),await e.addSubEffectUntilEndOfTurn({[yn.Reminder]:e=>e===a?t.text:void 0,[yn.DoesNotParticipateInRavage]:async({location:t})=>{t===a&&await t.doNotParticipateInRavage({quantifier:lr.UpTo,pieceFilter:e=>e.damage>0,amount:3,pieces:e.Dahan})}})}}]},{actionId:"Defend",textArea:[.776,.917],text:"1 <fear>. Defend 1 per <presence> you have in target land (when this Power is used).",[yn.Now]:async({you:e})=>{await a.fear(1),await a.defend(a.numberOfPresenceOf(e))}}]})}}]},Ch={name:"Air Moves Earth Endures",type:Sn.Innate,speed:rr.Fast,set:a.JaggedEarth,target:ir.Land,range:1,hasPushOrGather:!0,effects:[{text:"Push up to 2 <explorer> or 1 <town>.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"PushExplorer",text:"Push up to 2 <explorer>",[yn.Now]:async()=>{await a.pushUpTo(2,e.Explorer)}},{actionId:"PushTown",text:"Push 1 <town>",[yn.Now]:async()=>{await a.pushOne(e.Town)}}]})},threshold:{[nr.Air]:3}},{text:"Defend 5.",[yn.InTargetLand]:async({land:e})=>{await e.defend(5)},threshold:{[nr.Earth]:3}}]},Dh={name:"Boon Of Reimagining",type:Sn.Unique,speed:rr.Slow,energy:1,elements:[nr.Moon],set:a.JaggedEarth,target:ir.Spirit,effects:[{textArea:[.631,.805],text:"Target Spirit may Forget a Power Card from hand or discard to draw 6 Minor Power Cards and gain 2 of them.",[yn.TargetSpirit]:async({spirit:e})=>{(await e.forgetPowers({filter:e=>!e.isInPlay,optional:!0})).length>0&&await e.gainPowerCard({powerType:Sn.Minor,drawAmount:6,keepAmount:2})}},{textArea:[.821,.911],text:"If you target another Spirit, they gain 1 Energy.",[yn.TargetSpirit]:async({you:e,spirit:a})=>{a!==e&&await a.gainEnergy(1)}}]},Bh={name:"Fire Burns Water Soothes",type:Sn.Innate,speed:rr.Slow,set:a.JaggedEarth,target:ir.Land,sourceFilter:[sr.SacredSite],range:1,blightWhiteListedPower:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{effects:[{text:"1 <fear>",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{text:"2 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(2)}}],threshold:{[nr.Fire]:3}},{text:"Remove 1 <blight>.",[yn.InTargetLand]:async({land:e})=>{await e.removeBlight()},threshold:{[nr.Water]:3}}]},kh={name:"Gather The Scattered Light Of Stars",type:Sn.Unique,speed:rr.Slow,energy:0,elements:[nr.Moon],set:a.JaggedEarth,target:ir.Spirit,targetFilter:[ur.Yourself],effects:[{textArea:[.653,.743],text:"At the end of turn after discarding: Reclaim up to 2 cards to your hand.",[yn.TargetSpirit]:async({$:e,spirit:a})=>{await e.addSubEffectUntilEndOfTimePasses({[yn.AtTimePassesEnds]:async()=>{await a.reclaim(2),a.powersWhere((e=>e.isA(En.Unique))).count>0&&await e.addSubEffect({textArea:[.756,.888],[yn.Now]:async()=>{await e.may({textArea:[.756,.888],prompt:"Forget a Unique Power Card to Reclaim up to 3 additional cards?"})&&(await a.forgetPowers({powerFilter:En.Unique}),await a.reclaimCards({amount:3,optional:!0}))}})}})}}]},Lh={name:"Peace Of The Nighttime Sky",type:Sn.Unique,speed:rr.Fast,energy:1,elements:[nr.Moon],set:a.JaggedEarth,target:ir.Land,sourceFilter:[sr.SacredSite],range:1,effects:[{textArea:[.621,.755],text:"If the Terror Level is I, Invaders do not Ravage in target land this turn.",[yn.InTargetLand]:async({$:e,land:a})=>{1===e.terrorLevel&&await a.skipInvaderAction({text:"Invaders do not Ravage here this turn.",all:!0,filter:({invaderAction:e})=>e===Hr.Ravage})}},{textArea:[.769,.906],text:"You may Repeat this Power. If you choose to do so, Forget this Power Card and gain <moon>.",[yn.InTargetLand]:async({$:e,isRepeat:a,you:t,power:n})=>{!a&&await e.may({prompt:"Repeat this Power, Forget this Power Card and gain <moon>?"})&&(await t.targetAndResolvePower(n,!0),await n.forget(),await t.gainElementsUntilEndOfTurn({[nr.Moon]:1}))}}]},Fh={name:"Shape The Self Anew",type:Sn.Unique,speed:rr.Slow,energy:0,elements:[nr.Moon],set:a.JaggedEarth,target:ir.Spirit,targetFilter:[ur.Yourself],effects:[{textArea:[.595,.934],text:"Gain a Minor Power. If you have 4 <moon>:<br>You may gain a Major Power instead of a Minor Power.",[yn.TargetSpirit]:async({spirit:e})=>{e.hasElementsWithConvert({[nr.Moon]:4})?await e.gainPowerCard():await e.gainPowerCard({powerType:Sn.Minor})}},{textArea:[.659,.752],text:"You may Forget this Power Card to gain 3 Energy.",[yn.TargetSpirit]:async({$:e,spirit:a,power:t})=>{t.owner===a&&await e.may({prompt:"Forget this Power Card to gain 3 Energy?"})&&(await t.forget(),await a.gainEnergy(3))}}]},Rh={name:"Sidereal Guidance",type:Sn.Innate,speed:rr.Slow,set:a.JaggedEarth,target:ir.Land,range:1,hasPushOrGather:!0,effects:[{text:"Gather up to 1 <explorer>/<dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(1,e.ExplorerOrDahan)},threshold:{[nr.Moon]:2}},{instead:!0,text:"Instead, Gather up to 3 <explorer>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(3,e.Explorer)},threshold:{[nr.Moon]:3}}]},Nh={name:"Stars Blaze In The Daytime Sky",type:Sn.Innate,speed:rr.Slow,set:a.JaggedEarth,target:ir.Spirit,targetFilter:[ur.Yourself],generatesFear:!0,effects:[{effects:[{text:"3 <fear>.",[yn.TargetSpirit]:async({$:e})=>{await e.fear(3)}},{text:"Gain 1 Energy.",[yn.TargetSpirit]:async({spirit:e})=>{await e.gainEnergy(1)}},{text:"Reclaim up to 1 Power Card from play or your discard pile.",[yn.TargetSpirit]:async({spirit:e})=>{await e.reclaimCards({amount:1,filter:e=>e.isInDiscard||e.isInPlay})}}],threshold:{[nr.Sun]:4}}]},$h={name:"Wood Seeks Growth, Humans Seek Freedom",type:Sn.Innate,speed:rr.Slow,set:a.JaggedEarth,target:ir.Land,range:2,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{text:"Choose a Spirit with <presence> in target land. They gain a Power Card.",[yn.InTargetLand]:async({land:e})=>{await e.spiritsWithPresence().pickOne((async e=>{await e.gainPowerCard()}),{autoPlayOneOption:!0,noOptions:"No Spirits with <presence> in target Land."})},threshold:{[nr.Plant]:3}},{text:"1 Damage per <dahan><or>Push up to 3 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"Damage",text:"1 Damage per <dahan>",[yn.Now]:async()=>{await a.damage(a.numberOf(e.Dahan))}},{actionId:"Dahan",text:"Push up to 3 <dahan>.",[yn.Now]:async()=>{await a.pushUpTo(3,e.Dahan)}}]})},threshold:{[nr.Animal]:3}}]},Wh={name:"Hold The Island Fast With A Bulwark Of Will",type:Sn.Innate,speed:rr.Fast,set:a.JaggedEarth,target:ir.Spirit,targetFilter:[ur.Yourself],effects:[{[yn.TargetSpirit]:async({$:e,spirit:a})=>{const t=a.hasElements({[nr.Earth]:4})?1:2;await e.addSubEffectUntilEndOfTurn({[yn.GlobalReminder]:()=>({icon:`<blight><br>Pay ${t}`,spirit:a,players:[a]}),text:`When <blight> is added to one of your lands, you may pay ${t} Energy per <blight> to take it from the box instead of from the Blight Card. (Handle any cascade separately.)`,[yn.PreventRemoveBlightFromBlightCard]:async({location:n})=>!!(void 0!==n&&n.hasPresenceOf(a)&&a.energy>=t&&await e.may({prompt:`Pay ${t} Energy to take <blight> from the box instead of from the Blight Card?`}))&&(await a.payEnergy(t),!0)})},threshold:{[nr.Earth]:2}},{[yn.TargetSpirit]:async()=>{},threshold:{[nr.Earth]:4}},{text:'When an Event or Blight Card directly Destroys <presence> (yours or others), you may prevent any number of <presence> from being Destroyed by paying 1 Energy each. ("Directly" means "not by adding <blight>".)',[yn.TargetSpirit]:async({$:e,spirit:a})=>{await e.addSubEffectUntilEndOfTurn({[yn.GlobalReminder]:()=>({icon:"<blight><br><broken>",spirit:a,players:[a]}),[yn.PreventRemovePiece]:async({piece:t,removement:n})=>!!([Ho.MainEventAction,Ho.DahanEventAction,Ho.TokenEventAction,Ho.BlightCardAction].includes(e.action.type)&&t.isPresence&&n===Nn.DirectDestroy&&a.energy>=1&&await e.may({prompt:"Pay 1 Energy to prevent <presence> from being Destroyed?"}))&&(await a.payEnergy(1),!0)})},threshold:{[nr.Earth]:6,[nr.Plant]:1}}]},Mh={name:"Jagged Shards Push From The Earth",type:Sn.Unique,speed:rr.Slow,energy:0,elements:[nr.Fire,nr.Earth],set:a.JaggedEarth,target:ir.Land,range:1,hasPushOrGather:!0,effects:[{textArea:[.706,.746],text:"Add 1 <badlands>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Badlands)}},{textArea:[.768,.808],text:"Push up to 2 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(2,e.Dahan)}}]},Gh={name:"Let Them Break Themselves Against The Stone",type:Sn.Innate,speed:rr.Fast,set:a.JaggedEarth,target:ir.Land,range:0,hasDamageInstructions:!0,effects:[{text:"After Invaders deal 1 or more Damage to target land, 2 Damage.",[yn.InTargetLand]:async({$:e,you:a,land:t,...n})=>{const r={triggerId:e.nextTriggerId(),[yn.Now]:async({action:n})=>{await t.damage(2),await e.addSubEffect({text:"Also deal half of the Damage Invaders did to the land (rounding down).",[yn.Now]:async()=>{a.hasElements({[nr.Earth]:5})&&await t.damage(Math.floor(n.parentData.damageToLand/2))}})}};await e.addSubEffectUntilEndOfTurn({[yn.Reminder]:e=>e===t?n.effect.text:void 0,[yn.AfterRavagingDamageLand]:async a=>{a.land===t&&a.damageToLand>=1&&(e.action.data.damageToLand=a.damageToLand,await e.addTrigger(r,n.effect,n.action))}})},threshold:{[nr.Earth]:3}},{[yn.InTargetLand]:async({$:e,land:a})=>{await e.addSubEffectUntilEndOfTurn({[yn.Reminder]:e=>e===a?"Also deal half of the Damage Invaders did to the land (rounding down).":void 0})},threshold:{[nr.Earth]:5}},{text:"Repeat this Power.",[yn.InTargetLand]:async({power:e,isRepeat:a})=>{a||await e.repeat()},threshold:{[nr.Earth]:7,[nr.Sun]:2}}]},Hh={name:"Plows Shatter On Rocky Ground",type:Sn.Unique,speed:rr.Slow,energy:2,elements:[nr.Earth],set:a.JaggedEarth,target:ir.Land,range:1,hasPushOrGather:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{textArea:[.644,.876],text:"1 Damage to each <town>/<city>.<br>Push up to 1 <town>.<or>Destroy 1 <town>.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"DamageEach",textArea:[.647,.748],text:"1 Damage to each <town>/<city>.<br>Push up to 1 <town>.",[yn.Now]:async()=>{await e.addSubEffect({effects:[{textArea:[.66,.7],text:"1 Damage to each <town>/<city>.",[yn.Now]:async()=>{await a.damageEach(1,e.TownOrCity)}},{textArea:[.703,.743],text:"Push up to 1 <town>.",[yn.Now]:async()=>{await a.pushUpTo(1,e.Town)}}]})}},{actionId:"DestroyTown",textArea:[.828,.868],text:"Destroy 1 <town>.",[yn.Now]:async()=>{await a.destroyOne(e.Town)}}]})}}]},jh={name:"Scarred And Stony Land",type:Sn.Unique,speed:rr.Slow,energy:2,elements:[nr.Moon,nr.Earth],set:a.JaggedEarth,target:ir.Land,sourceFilter:[sr.SacredSite],targetFilter:[sr.Blight],range:1,blightWhiteListedPower:!0,hasDamageInstructions:!0,effects:[{textArea:[.641,.681],text:"2 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(2)}},{textArea:[.7,.74],text:"Add 1 <badlands>.",[yn.InTargetLand]:async({$:e,land:a})=>{a.isLand&&await a.add(1,e.Badlands)}},{text:"Remove 1 <blight> in target land from the game. (It goes to the box, not the Blight Card.)",textArea:[.755,.894],[yn.InTargetLand]:async({land:e})=>{await e.removeBlight({toTheBox:!0})}}]},Uh={name:"Stubborn Solidity",type:Sn.Unique,speed:rr.Fast,energy:1,elements:[nr.Sun,nr.Earth,nr.Animal],set:a.JaggedEarth,target:ir.Land,range:1,effects:[{textArea:[.624,.664],text:"Defend 1 per <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.defend(a.numberOf(e.Dahan))}},{textArea:[.676,.92],text:"<dahan> in target land cannot be changed.<br><br>(When they would be Damaged, Destroyed, Removed, Replaced, or moved, instead don't.)",[yn.InTargetLand]:async({$:e,land:a,effect:t})=>{await e.addSubEffectUntilEndOfTurn({[yn.Reminder]:e=>e===a?t.text:void 0,[yn.PreventDamagingPiece]:({piece:t})=>Promise.resolve(t.location===a&&t.isA(e.Dahan)),[yn.PreventRemovePiece]:({piece:t})=>Promise.resolve(t.location===a&&t.isA(e.Dahan)),[yn.PreventMovePiece]:({piece:t,source:n})=>n===a&&t.isA(e.Dahan)})}}]},qh={name:"Impersonate Authority",type:Sn.Unique,speed:rr.Slow,energy:0,elements:[nr.Sun,nr.Air,nr.Animal],set:a.JaggedEarth,target:ir.Land,range:1,effects:[{textArea:[.745,.785],text:"Add 1 <strife>.",[yn.InTargetLand]:async({land:e})=>{await e.addStrife(1)}}]},_h={name:"Incite The Mob",type:Sn.Unique,speed:rr.Slow,energy:1,elements:[nr.Moon,nr.Fire,nr.Air],set:a.JaggedEarth,target:ir.Land,targetFilter:[sr.Invaders],range:1,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.644,.89],text:"1 Invader with <strife> deals Damage to other Invaders (not to each Invader). 1 <fear> per Invader this Power Destroyed.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.piecesWithStrife().pickOne((async t=>{await e.addSubEffect({highlightPieces:[t],[yn.Now]:async()=>{const n=(await a.damage(t.strengthOutOfRavage,e.Invader,{filter:e=>e!==t})).filter((({piece:e,removement:a})=>pr[a].isDestroyLike&&e.isInvader)).length;await a.fear(n)}})}),{autoPlayOneOption:!0,prompt:"Pick 1 Invader with <strife>.",noOptions:"No Invaders with <strife>."})}}]},Jh={name:"Lets See What Happens",type:Sn.Innate,speed:rr.Fast,set:a.JaggedEarth,target:ir.Land,targetFilter:[sr.Invaders],range:1,effects:[{text:'Discard Minor Powers from the deck until you get one that targets a land. Use its text effects on target land immediately, ignoring normal Range and targeting restrictions. All "up to" instructions must be used at max. value. Treat all "OR"s as "AND"s.<br>It is not considered a card of yours or a card in play. Its effects are treated as performed by this Power, as if its text were copied here.)',[yn.InTargetLand]:async({$:e,you:a,land:t,power:n,action:r})=>{let i;for(;i=await e.drawAndDiscardPower(Sn.Minor),void 0===i||sg[i].target!==ir.Land;);void 0!==i&&(r.data.letsSeeCard=i,await e.addSubEffect({textArea:void 0,card:i,[yn.Now]:async()=>{await e.clickToContinue(),await e.addEffectUntilEndOfAction({[yn.UpToMustBeUsedAtMaximum]:()=>e.action===r,[yn.TreatAllORsAsANDs]:()=>e.action===r});for(const r of sg[i].effects)await e.addEffect({name:sg[i].name,effects:[r],card:i,highlightLocations:[t],players:[a],spirit:a}),await e.doEffectsWithContext(yn.InTargetLand,{power:n,land:t,owner:a,isRepeat:!1},(e=>e.card===i))}}))},threshold:{[nr.Moon]:1,[nr.Fire]:1,[nr.Air]:2}},{text:"You may Forget a Power Card to gain the just-used Power Card (to hand) and 1 Energy.",[yn.InTargetLand]:async({$:e,you:a,action:t})=>{const n=t.data.letsSeeCard;n&&await e.may({card:n,prompt:`Forget a Power Card to gain <p>${n}</p> (to hand) and 1 Energy?`})&&(await a.forgetPowers(),await a.gainPower(n),await a.gainEnergy(1))},threshold:{[nr.Moon]:2,[nr.Fire]:1,[nr.Air]:2}}]},Vh={name:"Overenthusiastic Arson",type:Sn.Unique,speed:rr.Fast,energy:1,elements:[nr.Fire,nr.Air],set:a.JaggedEarth,target:ir.Land,range:1,generatesFear:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{textArea:[.677,.717],text:"Destroy 1 <town>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.destroyOne(e.Town)}},{textArea:[.733,.871],text:"Discard the top card of the Minor Power Deck. If it provides <fire>: 1 <fear>, 2 Damage, and add 1 <blight>.",[yn.InTargetLand]:async({$:e,land:a})=>{const t=await e.drawAndDiscardPower(Sn.Minor);await e.addSubEffect({[yn.Now]:async()=>{await e.clickToContinue({card:t,textArea:void 0}),void 0!==t&&sg[t].elements.includes(nr.Fire)?(await e.sendEvent({type:fn.GenericSub,text:"The top card of the Minor Power Deck provided <fire>."}),await a.fear(1),await a.damage(2),await a.addBlight(1)):await e.sendEvent({type:fn.GenericSub,text:"The top card of the Minor Power Deck did not provide <fire>."})}})}}]},Yh={name:"Unexpected Tigers",type:Sn.Unique,speed:rr.Slow,energy:0,elements:[nr.Moon,nr.Fire,nr.Animal],set:a.JaggedEarth,target:ir.Land,range:1,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.653,.693],text:"1 <fear> if Invaders are present.",[yn.InTargetLand]:async({land:e})=>{e.hasInvaders&&await e.fear(1)}},{textArea:[.713,.871],text:"If you can Gather 1 <beasts>, do so, then Push 1 <explorer>. Otherwise, add 1 <beasts>.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.countPieceOptionally(Bn.Beasts,(()=>a.inAdjacentLandsWhere((a=>a.has(e.Beasts)))));(await a.gatherOne(e.Beasts)).length>0?await e.addSubEffect({textArea:[.712,.804],text:"If you can Gather 1 <beasts>, do so, then Push 1 <explorer>.",[yn.Now]:async()=>{await a.pushOne(e.Explorer)}}):await e.addSubEffect({textArea:[.824,.864],text:"Otherwise, add 1 <beasts>.",[yn.Now]:async()=>{await a.add(1,e.Beasts)}})}}]},zh={text:"1 Invader and 1 <dahan> deal Damage to each other.",[yn.InTargetLand]:async({$:e,land:a})=>{a.hasAllOf(e.Dahan,e.Invader)&&await a.invaders().pickOne((async t=>{await a.piecesThatAre(e.Dahan).pickOne((async n=>{await e.addSubEffect({highlightPieces:[t,n],[yn.Now]:async()=>{const e=t.strengthOutOfRavage-a.defense,r=n.strengthOutOfRavage;t.strife>0?await t.removeStrife():await n.damageOnlyThis(e),await t.damageOnlyThis(r)}})}))}))}},Qh={name:"Why Dont You And Them Fight",type:Sn.Innate,speed:rr.Fast,set:a.JaggedEarth,target:ir.Land,targetFilter:[sr.Invaders],range:0,hasDamageInstructions:!0,mayBeSpeed:{effect:{text:"If you have 3 <moon>:<br>This Power may be <slow>.",[yn.Now]:async({action:e})=>{await e.spirit.convertElements({[nr.Moon]:3})}},condition:({speed:e,spirit:a})=>e===rr.Slow&&a.hasElementsWithConvert({[nr.Moon]:3}),noDowngrade:({element:e,spirit:a,speed:t})=>t===rr.Slow&&e===nr.Moon&&!a.hasElementsWithConvert({[nr.Moon]:4})},effects:[{[yn.InTargetLand]:async()=>{},threshold:{[nr.Moon]:3},dontResolveAlone:!0,noConvertToThreshold:!0},{text:"Add 1 <strife>.",[yn.InTargetLand]:async({land:e})=>{await e.addStrife(1)},threshold:{[nr.Air]:3}},{...zh,threshold:{[nr.Sun]:3}},{instead:!0,...zh,threshold:{[nr.Fire]:3}},{text:"If target land has <beasts>, 2 Damage. Otherwise, you may Gather 1 <beasts>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.possiblyDontCountPiecesAs(Bn.Beasts),a.has(e.Beasts)?await a.damage(2):await a.mayGather(e.Beasts)},threshold:{[nr.Animal]:3}}]},Kh={name:"Epidemics Run Rampant",type:Sn.Innate,speed:rr.Fast,set:a.JaggedEarth,target:ir.Land,targetFilter:[sr.Disease],range:1,generatesFear:!0,hasDamageInstructions:!0,effects:[{text:"This Power's Damage is done (separately) to both Invaders and <dahan><br><br>1 Damage per <disease>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.damage(a.numberOf(e.Disease)),await a.damage(a.numberOf(e.Disease),e.Dahan)},threshold:{[nr.Fire]:1,[nr.Animal]:3}},{text:"+1 Damage per <disease>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.damage(a.numberOf(e.Disease)),await a.damage(a.numberOf(e.Disease),e.Dahan)},threshold:{[nr.Water]:1,[nr.Fire]:2,[nr.Animal]:4}},{effects:[{text:"+1 Damage per <disease>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.damage(a.numberOf(e.Disease)),await a.damage(a.numberOf(e.Disease),e.Dahan)}},{text:"+1 <fear> per <disease> (max. 5).",[yn.InTargetLand]:async({$:e,land:a})=>{await a.fear(Math.min(a.numberOf(e.Disease),5))}},{text:"Remove 1 <disease>",[yn.InTargetLand]:async({$:e,land:a})=>{await a.removeOne(e.Disease)}}],threshold:{[nr.Water]:3,[nr.Fire]:3,[nr.Animal]:5}}]},Xh={name:"Fetid Breath Spreads Infection",type:Sn.Unique,speed:rr.Slow,energy:2,elements:[nr.Air,nr.Water,nr.Animal],set:a.JaggedEarth,target:ir.Land,targetFilter:[sr.Invaders],range:1,generatesFear:!0,effects:[{textArea:[.712,.752],text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.772,.812],text:"Add 1 <disease>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Disease)}}]},Zh={name:"Fiery Vengeance",type:Sn.Unique,speed:rr.Fast,energy:0,elements:[nr.Sun,nr.Fire],set:a.JaggedEarth,target:ir.Spirit,mayUse:({spirit:e})=>e.destroyedPresence>0,generatesFear:!0,hasDamageInstructions:!0,effects:[{textArea:[.605,.917],text:"Cost to Use: Target Spirit Removes 1 of their Destroyed <presence> from the game.<br><br>1 <fear> and 1 Damage in one of target Spirit's lands.<br><br>(This is your Power, so <blight> counts as <badlands> even if target is another Spirit.)",[yn.TargetSpirit]:async({spirit:e})=>{e.destroyedPresence-=1,await e.inLands().pickOne((async e=>{await e.fear(1),await e.damage(1)}))}}]},eu={name:"Plaguebearers",type:Sn.Unique,speed:rr.Slow,energy:1,elements:[nr.Fire,nr.Water,nr.Animal],set:a.JaggedEarth,target:ir.Land,targetFilter:[sr.Disease],range:2,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.653,.693],text:"1 <fear> if Invaders are present.",[yn.InTargetLand]:async({land:e})=>{e.hasInvaders&&await e.fear(1)}},{textArea:[.709,.868],text:"For each <disease>, Push 2 <explorer>/<town>/<dahan>. 1 <disease> may move with each Pushed piece.",[yn.InTargetLand]:async({$:e,land:a})=>{const t=await a.push({amount:2*a.numberOf(e.Disease),pieces:e.ExplorerTownOrDahan});for(;a.has(e.Disease)&&t.length>0;){const n=await a.move({quantifier:lr.May,pieces:e.Disease,destinationFilter:e=>t.some((a=>a.destination===e)),movement:Fr.Bring});if(!(n.length>0))break;qr(t,(e=>e.destination===n[0].destination))}}}]},au={name:"Savage Revenge",type:Sn.Innate,speed:rr.Slow,set:a.JaggedEarth,target:ir.Land,targetFilter:[sr.Town,sr.City],range:0,modifiesRange:({spirit:e,withConvert:a})=>e.hasElements({[nr.Air]:3},a)?1:0,payForRange:async({spirit:e})=>{await e.convertElements({[nr.Air]:3})},hasDamageInstructions:!0,effects:[{[yn.InTargetLand]:async()=>{},threshold:{[nr.Air]:3},noConvertToThreshold:!0,dontResolveAlone:!0},{instead:!0,text:"1 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(1)},threshold:{[nr.Fire]:3,[nr.Animal]:1}},{text:"+2 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(2)},threshold:{[nr.Fire]:4,[nr.Animal]:2}},{text:"+3 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(3)},threshold:{[nr.Fire]:5,[nr.Air]:2,[nr.Animal]:2}}]},tu={name:"Strike Low With Sudden Fevers",type:Sn.Unique,speed:rr.Fast,energy:2,elements:[nr.Fire,nr.Air,nr.Earth,nr.Animal],set:a.JaggedEarth,target:ir.Land,targetFilter:[sr.Disease],range:1,generatesFear:!0,effects:[{textArea:[.713,.753],text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.776,.816],text:"Invaders skip Ravage Actions.",[yn.InTargetLand]:async({land:e})=>{await e.skipInvaderAction({all:!0,filter:({invaderAction:e})=>e===Hr.Ravage})}}]},nu={name:"Exaltation Of Molten Stone",type:Sn.Unique,speed:rr.Fast,energy:1,elements:[nr.Moon,nr.Fire,nr.Earth],set:a.JaggedEarth,target:ir.Spirit,targetFilter:[ur.Another],effects:[{textArea:[.604,.784],text:"Split 1 Energy per <fire> you have between yourself and target Spirit, as evenly as possible. (Gained from the supply.)",[yn.TargetSpirit]:async({$:e,you:a,spirit:t})=>{await a.askToConvertElementsToCombo({[nr.Fire]:1});const n=a.elements[nr.Fire];t===a?await a.gainEnergy(n):n%2==0?(await a.gainEnergy(n/2),await t.gainEnergy(n/2)):await e.chooseBetween({effects:[{actionId:"YouGetLess",text:`${a.nameLink} gain ${Math.floor(n/2)} energy, ${t.nameLink} gain ${Math.ceil(n/2)} energy.`,[yn.Now]:async()=>{await a.gainEnergy(Math.floor(n/2)),await t.gainEnergy(Math.ceil(n/2))}},{actionId:"TargetGetLess",text:`${a.nameLink} gain ${Math.ceil(n/2)} energy, ${t.nameLink} gain ${Math.floor(n/2)} energy.`,[yn.Now]:async()=>{await a.gainEnergy(Math.ceil(n/2)),await t.gainEnergy(Math.floor(n/2))}}]})}},{textArea:[.772,.916],text:"Target Spirit gains <range+1> with their Powers that originate from a <mountains>.",[yn.TargetSpirit]:async({$:e,power:a,spirit:t})=>{await e.addSubEffectUntilEndOfTurn({[yn.GlobalReminder]:()=>({power:a.power,players:[t]}),[yn.ExtraRange]:e=>e.spirit===t&&e.location.isMountains?1:0})}}]},ru={name:"Explosive Eruption",type:Sn.Innate,speed:rr.Fast,set:a.JaggedEarth,target:ir.Land,range:0,generatesFear:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{text:"Destroy X (1 or more) of your <presence> in target land. <broken> (below) checks how many were Destroyed. This Power's Damage is done (separately) to both Invaders and <dahan>. The Ranges below can't be increased.",[yn.InTargetLand]:async({$:e,you:a,land:t,action:n})=>{const r=await e.selectX(1,t.numberOfPresenceOf(a)),i=await t.destroy({amount:r,pieces:e.Presence,owner:a});n.data.explosiveEruptionCount=i.length},threshold:{}},{text:"2 <broken>: In one land within <range-1>, X Damage.",[yn.InTargetLand]:async({$:e,land:a,you:t,action:n})=>{const r=n.data.explosiveEruptionCount;r>=2&&await a.inLandsWithin(1,t,{mayIncrease:!1}).pickOne((async a=>{await a.damage(r),await a.damage(r,e.Dahan)}))},threshold:{[nr.Fire]:2,[nr.Earth]:2}},{text:"4 <broken>: X <fear>.",[yn.InTargetLand]:async({land:e,action:a})=>{const t=a.data.explosiveEruptionCount;t>=4&&await e.fear(t)},threshold:{[nr.Fire]:3,[nr.Earth]:3}},{effects:[{text:"6 <broken>: In each land within <range-1>, 4 Damage.",[yn.InTargetLand]:async({$:e,you:a,land:t,action:n})=>{n.data.explosiveEruptionCount>=6&&await t.inLandsWithin(1,a,{mayIncrease:!1}).forEach((async a=>{await a.damage(4),await a.damage(4,e.Dahan)}))}},{text:"Add 1 <blight> to target land; doing so does not Destroy your <presence>.",[yn.InTargetLand]:async({$:e,you:a,land:t,action:n})=>{n.data.explosiveEruptionCount>=6&&(await e.addEffectUntilEndOfAction({[yn.PreventBlightDestroyingPresence]:({location:e,spirit:n})=>e===t&&n===a}),await t.addBlight(1))}}],threshold:{[nr.Fire]:4,[nr.Air]:2,[nr.Earth]:4}},{effects:[{text:"10 <broken>: In each land within <range-2>, +4 Damage.",[yn.InTargetLand]:async({$:e,you:a,land:t,action:n})=>{n.data.explosiveEruptionCount>=10&&await t.inLandsWithin(2,a,{mayIncrease:!1}).forEach((async a=>{await a.damage(4),await a.damage(4,e.Dahan)}))}},{text:"In each land adjacent to the target, add 1 <blight> if it doesn't have any.",[yn.InTargetLand]:async({$:e,land:a,action:t})=>{t.data.explosiveEruptionCount>=10&&await a.inAdjacentLocations().forEach((async a=>{a.isLandForBlight&&a.doesntHave(e.Blight)&&await a.addBlight(1)}))}}],threshold:{[nr.Fire]:5,[nr.Air]:3,[nr.Earth]:5}}]},iu={name:"Lava Flows",type:Sn.Unique,speed:rr.Slow,energy:1,elements:[nr.Fire,nr.Moon],set:a.JaggedEarth,target:ir.Land,range:1,hasDamageInstructions:!0,effects:[{textArea:[.673,.851],text:"Add 1 <badlands> and 1 <wilds>.<or>1 Damage.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"BadlandsAndWilds",textArea:[.68,.72],text:"Add 1 <badlands> and 1 <wilds>.",[yn.Now]:async()=>{await a.add(1,e.Badlands),await a.add(1,e.Wilds)}},{actionId:"Damage",textArea:[.805,.845],text:"1 Damage.",[yn.Now]:async()=>{await a.damage(1)}}]})}}]},su={name:"Powered By The Furnace Of The Earth",type:Sn.Innate,speed:rr.Slow,set:a.JaggedEarth,target:ir.Land,range:0,effects:[{text:"Add 1 of your Destroyed <presence>.",[yn.InTargetLand]:async({you:e,land:a})=>{await a.addPresence(e,{destroyed:!0})},threshold:{[nr.Earth]:3}},{text:"Cost 2 Energy: Gain a Power Card.",[yn.InTargetLand]:async({$:e,you:a})=>{a.energy>=2&&await e.may({prompt:"Pay 2 Energy to Gain a Power Card ?"})&&(await a.payEnergy(2),await a.gainPowerCard())},threshold:{[nr.Fire]:3}},{text:"Move up to 2 of your <presence> from other lands to target land.",[yn.InTargetLand]:async({you:e,land:a})=>{await e.presence().pickMultiple({optional:!0,amount:2,where:e=>e.location!==a,forPickedItem:async e=>{await e.move({locations:{target:Jn.ToThisLocation,location:a}})}})},threshold:{[nr.Earth]:4,[nr.Fire]:4}},{text:"Return up to 2 of your Destroyed <presence> to your <presence> tracks.",[yn.InTargetLand]:async({you:e})=>{await e.returnPresenceToTracks(2,{optional:!0,destroyed:!0})},threshold:{[nr.Fire]:5}}]},ou={name:"Pyroclastic Bombardment",type:Sn.Unique,speed:rr.Fast,energy:3,elements:[nr.Fire,nr.Air,nr.Earth],set:a.JaggedEarth,target:ir.Land,sourceFilter:[sr.SacredSite],range:2,hasDamageInstructions:!0,effects:[{textArea:[.692,.732],text:"1 Damage to each <town>/<city>/<dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.damageEach(1,e.TownCityOrDahan)}},{textArea:[.755,.795],text:"1 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(1)}},{textArea:[.812,.852],text:"1 Damage to <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.damage(1,e.Dahan)}}]},du={name:"Rain Of Ash",type:Sn.Unique,speed:rr.Slow,energy:2,elements:[nr.Fire,nr.Air,nr.Earth],set:a.JaggedEarth,target:ir.Land,range:1,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.693,.733],text:"2 <fear> if Invaders are present.",[yn.InTargetLand]:async({land:e})=>{e.hasInvaders&&await e.fear(2)}},{textArea:[.746,.842],text:"Push 2 <dahan> and 2 <explorer>/<town> to land(s) without your <presence>.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await t.push({amount:2,pieces:e.Dahan,destinationFilter:e=>!e.hasPresenceOf(a)}),await t.push({amount:2,pieces:e.ExplorerOrTown,destinationFilter:e=>!e.hasPresenceOf(a)})}}]},cu={name:"Blazing Intimidation",type:Sn.Unique,speed:rr.Fast,energy:2,elements:[nr.Fire,nr.Plant,nr.Animal],set:a.NatureIncarnate,target:ir.Land,range:1,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.637,.677],text:"1 <fear>",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.757,.848],text:"Push 2 <explorer>/<town> to a<br>land without <incarna-behemoth>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.push({amount:2,pieces:e.ExplorerOrTown,destinationFilter:a=>a.doesntHave(e.IncarnaBehemoth)})}}]},lu={name:"Exaltation Of Grasping Roots",type:Sn.Unique,speed:rr.Slow,energy:0,elements:[nr.Moon,nr.Fire,nr.Earth,nr.Plant],set:a.NatureIncarnate,target:ir.Spirit,targetFilter:[ur.Another],effects:[{textArea:[.699,.79],text:"Target Spirit may Add 1 <wilds> in one of their lands.",[yn.TargetSpirit]:async({$:e,spirit:a})=>{await a.inLands().optionallyPickOne((async a=>{await a.add(1,e.Wilds)}),{players:[a]})}},{textArea:[.807,.848],text:"You may do likewise.",[yn.TargetSpirit]:async({$:e,you:a})=>{await a.inLands().optionallyPickOne((async a=>{await a.add(1,e.Wilds)}))}}]},hu={name:"Smash, Stomp, And Flatten",type:Sn.Innate,speed:rr.Slow,set:a.NatureIncarnate,target:ir.Land,targetFilter:[sr.IncarnaBehemoth],range:0,hasPushOrGather:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{text:"2 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(2)},threshold:{[nr.Fire]:2,[nr.Earth]:1}},{effects:[{text:"1 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(1)}},{text:"Push 1 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushOne(e.Dahan)}}],threshold:{[nr.Fire]:3,[nr.Earth]:1,[nr.Plant]:1}},{effects:[{text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{text:"1 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(1)}}],threshold:{[nr.Fire]:4,[nr.Earth]:2,[nr.Plant]:1}},{effects:[{text:"2 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(2)}},{text:"2 Damage to <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.damage(2,e.Dahan)}}],threshold:{[nr.Fire]:5,[nr.Earth]:2,[nr.Plant]:2}},{text:"If <incarna-behemoth> is empowered, you may Repeat this Power once each turn. (You may take other Actions before repeating, including the Behemoth Rises.)",[yn.InTargetLand]:async({$:e,you:a,isRepeat:t,...n})=>{!t&&a.hasEmpoweredIncarna&&null!=a.incarna&&(e.hasEffectNamed("Prevent Repeat Smash and Stomp")||(await e.addEffectUntilEndOfTurn({name:"Prevent Repeat Smash and Stomp"}),await e.addEffectUntilEndOfActionTree({[yn.ActionEnds]:async()=>{await n.power.replay(rr.Slow)}})))}}]},uu={name:"Surging Lahar",type:Sn.Unique,speed:rr.Slow,energy:2,elements:[nr.Fire,nr.Water,nr.Earth],set:a.NatureIncarnate,target:ir.Land,range:1,sourceFilter:[sr.SacredSite],hasDamageInstructions:!0,effects:[{textArea:[.724,.765],text:"2 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(2)}},{textArea:[.788,.829],text:"If your <presence> is present, Add 1 <badlands>.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{t.hasPresenceOf(a)&&await t.add(1,e.Badlands)}}]},gu={name:"Terrifying Rampage",type:Sn.Unique,speed:rr.Fast,energy:1,elements:[nr.Moon,nr.Fire,nr.Earth],set:a.NatureIncarnate,target:ir.Land,range:1,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.637,.677],text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.631,.858],text:"2 Invaders don't participate in Ravage. (Choose the Invaders when ravaging; they don't deal Damage or take counterattack Damage.)",[yn.InTargetLand]:async({$:e,land:a,effect:t})=>{await e.addSubEffectUntilEndOfTurn({[yn.Reminder]:e=>e===a?t.text:void 0,[yn.DoesNotParticipateInRavage]:async({location:t})=>{t===a&&await t.doNotParticipateInRavage({quantifier:lr.Exactly,amount:2,pieces:e.Invader})}})}},{textArea:[.871,.911],text:"Push 3 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.push({amount:3,pieces:e.Dahan})}}]},fu={name:"Emerge From The Dread Night Wind",type:Sn.Unique,speed:rr.Slow,energy:1,elements:[nr.Moon,nr.Air],set:a.NatureIncarnate,target:ir.Land,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.651,.692],text:"Add/Move <incarna-darkness> to target land.",[yn.InTargetLand]:async({you:e,land:a})=>{e.hasIncarna?await e.incarna.move({locations:{target:Jn.ToThisLocation,location:a}}):await a.addIncarna(Bn.IncarnaDarkness,e)}},{textArea:[.71,.751],text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.715,.843],text:"If exactly 1 Invader is present, Abduct it. Otherwise, Push up to 2 <explorer>/<town> to different lands.",[yn.InTargetLand]:async({$:e,land:a})=>{a.hasExactly(1,e.Invader)?await a.invaders().anyOne.abduct():await a.push({amount:2,quantifier:lr.UpTo,pieces:e.ExplorerOrTown,differentLands:!0})}},{textArea:[.857,.898],text:"Push up to 2 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(2,e.Dahan)}}]},pu={name:"Leave A Trail Of Deathly Silence",type:Sn.Innate,speed:rr.Fast,set:a.NatureIncarnate,target:ir.Spirit,targetFilter:[ur.Yourself],hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{effects:[{text:"1 Damage at <incarna-darkness>.",[yn.TargetSpirit]:async({spirit:e})=>{await(e.incarna?.location?.damage(1))}},{text:"You may Push <incarna-darkness>.",[yn.TargetSpirit]:async({spirit:e})=>{await(e.incarna?.push({quantifier:lr.May}))}}],threshold:{[nr.Moon]:2,[nr.Animal]:1}},{effects:[{text:"1 Damage at <incarna-darkness>.",[yn.TargetSpirit]:async({spirit:e})=>{await(e.incarna?.location?.damage(1))}},{text:"You may Push <incarna-darkness>.",[yn.TargetSpirit]:async({spirit:e})=>{await(e.incarna?.push({quantifier:lr.May}))}}],threshold:{[nr.Moon]:3,[nr.Air]:1,[nr.Animal]:1}},{effects:[{text:"1 Damage at <incarna-darkness>.",[yn.TargetSpirit]:async({spirit:e})=>{await(e.incarna?.location?.damage(1))}},{text:"You may Push <incarna-darkness>.",[yn.TargetSpirit]:async({spirit:e})=>{await(e.incarna?.push({quantifier:lr.May}))}}],threshold:{[nr.Moon]:4,[nr.Air]:2,[nr.Animal]:2}},{text:"Move <incarna-darkness> to the <endless-dark>. It Brings 1 Invader (from it's land).",[yn.TargetSpirit]:async({$:e,spirit:a})=>{const t=await(a.incarna?.move({locations:{target:Jn.ToThisLocation,location:e.theEndlessDark}}));void 0!==t&&t.length>0&&await t[0].source.move({amount:1,pieces:e.Invader,locations:{target:Jn.ToThisLocation,location:e.theEndlessDark}})},threshold:{[nr.Moon]:5,[nr.Air]:2,[nr.Animal]:3}}]},wu={name:"Lost In The Endless Dark",type:Sn.Innate,speed:rr.Slow,set:a.NatureIncarnate,target:ir.Land,targetFilter:[sr.TheEndlessDark],range:0,generatesFear:!0,effects:[{effects:[{text:"1 <fear> per Invader (max. 4).",[yn.InTargetLand]:async({$:e,land:a})=>{await a.fear(Math.min(a.numberOf(e.Invader),4))}},{text:"You may Downgrade 1 Invader. (Downgrading Removes <explorer>.)",[yn.InTargetLand]:async({$:e,land:a})=>{await a.downgrade({amount:1,quantifier:lr.May,pieces:e.Invader})}}],threshold:{[nr.Moon]:2,[nr.Air]:1}},{effects:[{text:"1 <fear> per Invader (max. 4).",[yn.InTargetLand]:async({$:e,land:a})=>{await a.fear(Math.min(a.numberOf(e.Invader),4))}},{text:"Downgrade any number of Invaders",[yn.InTargetLand]:async({$:e,land:a})=>{await a.downgrade({quantifier:lr.Any,pieces:e.Invader})}}],threshold:{[nr.Moon]:4,[nr.Air]:3}},{text:"Add <beasts>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Beasts)},threshold:{[nr.Moon]:3,[nr.Animal]:2}}]},yu={name:"Reach From The Infinite Darkness",type:Sn.Unique,speed:rr.Fast,energy:0,elements:[nr.Moon,nr.Air,nr.Animal],set:a.NatureIncarnate,target:ir.Spirit,targetFilter:[ur.Yourself],effects:[{textArea:[.607,.792],text:"Abduct up to 2 <presence> (of any Spirits, with their permission) from any lands on the island, ignoring land type restrictions on moving <presence>.",[yn.TargetSpirit]:async({$:e})=>{await e.forPiecesThatIs(e.Presence).pickMultiple({amount:2,optional:!0,forPickedItem:async e=>{await e.abduct()}})}},{textArea:[.802,.94],text:"Each Spirit's <presence> in the <endless-dark> grants them <range+1> with all their Powers (this turn).",[yn.TargetSpirit]:async({$:e,power:a})=>{await e.addSubEffectUntilEndOfTurn({[yn.GlobalReminder]:()=>({power:a.power}),[yn.ExtraRange]:a=>e.theEndlessDark.numberOfPresenceOf(a.spirit)})}}]},mu={name:"Swallowed By The Endless Dark",type:Sn.Unique,speed:rr.Fast,energy:1,elements:[nr.Moon,nr.Air,nr.Water],set:a.NatureIncarnate,target:ir.Land,targetFilter:[sr.Invaders],range:0,generatesFear:!0,effects:[{textArea:[.674,.715],text:"2 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.674,.715],text:"Abduct 1 <explorer>",[yn.InTargetLand]:async({$:e,land:a})=>{await a.abduct(1,e.Explorer)}},{textArea:[.79,.938],text:"If you have 3 <moon> 3 <air>:<br>Abduct 1 Invader.",[yn.InTargetLand]:async({you:e,land:a})=>{await e.askToConvertElements({[nr.Moon]:3,[nr.Air]:3})&&await a.abduct(1)}}]},vu={name:"Terror Of The Hunted",type:Sn.Unique,speed:rr.Slow,energy:1,elements:[nr.Moon,nr.Fire,nr.Animal],set:a.NatureIncarnate,target:ir.Land,targetFilter:[sr.Invaders],range:0,generatesFear:!0,effects:[{textArea:[.624,.718],text:"If <beasts> are present, 1 <fear> and Add 1 <strife>.",[yn.InTargetLand]:async({$:e,land:a})=>{a.has(e.Beasts)&&(await a.fear(1),await a.addStrife(1))}},{textArea:[.729,.77],text:"Add 1 <strife> per Terror Level.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.addStrife(e.terrorLevel)}},{textArea:[.791,.923],text:"If target land is the <endless-dark>, Add 1 <strife>. (<strife> only Escapes with the Invader it's attached to.)",[yn.InTargetLand]:async({land:e})=>{e.isEndlessDark&&await e.addStrife(1)}}]},Au={name:"Earth Shudders Buildings Fall",type:Sn.Innate,speed:rr.Slow,set:a.NatureIncarnate,target:ir.Land,targetFilter:[sr.Quake],range:0,generatesFear:!0,hasDamageInstructions:!0,effects:[{text:"3 Power Cards: 2 Damage per <quake>, to <town>/<city> only.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.damage(2*a.numberOf(e.Quake),e.TownOrCity)},threshold:{[nr.Fire]:2,[nr.Earth]:3},powerOwnerThresholdCondition:e=>e.numberOfPowerCardsInPlay>=3},{effects:[{text:"5 Power Cards: 1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{text:"5 Power Cards: In any number of lands with <quake>: 2 Damage per <quake>, to <town>/<city> only. Remove 1 <quake>.",[yn.InTargetLand]:async({$:e,action:a})=>{a.data.removement=[],await e.inLandsWithAllOf(e.Quake,e.Invader).pickMultiple({optional:!0,amount:e.inLandsWithAllOf(e.Quake,e.Invader).count,forPickedItem:async t=>{await t.damage(2*t.numberOf(e.Quake),e.TownOrCity),a.data.removement.push(...await t.removeOne(e.Quake))}})}}],threshold:{[nr.Fire]:3,[nr.Earth]:4},powerOwnerThresholdCondition:e=>e.numberOfPowerCardsInPlay>=5},{effects:[{text:"7 Power Cards: 2 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(2)}},{text:"7 Power Cards: In each land where you removed <quake>: 1 Damage to each Invader.",[yn.InTargetLand]:async({$:e,action:a})=>{const t=id.createCollection(e,a.data.removement.map((e=>e.location)));await t.selectOrder().forEach((async e=>{await e.damageEach(1)}))}}],threshold:{[nr.Fire]:4,[nr.Earth]:5},powerOwnerThresholdCondition:e=>e.numberOfPowerCardsInPlay>=7}]},Iu={name:"Exaltation Of Echoed Steps",type:Sn.Unique,speed:rr.Slow,energy:1,elements:[nr.Moon,nr.Water,nr.Earth],set:a.NatureIncarnate,target:ir.Spirit,targetFilter:[ur.Another],hasPushOrGather:!0,effects:[{textArea:[.702,.791],text:"Target Spirit may Push 1 <presence>, Bringing up to 1 <explorer>/<town>/<dahan>/<beasts>.",[yn.TargetSpirit]:async({$:e,spirit:a})=>{await a.presence().optionallyPickOne((async a=>{const t=a.location,n=await a.push();n.length>0&&await t.push({quantifier:lr.UpTo,amount:1,pieces:e.ExplorerTownOrDahan,locations:{target:Jn.ToThisLocation,location:n[0].destination}})}))}},{textArea:[.808,.848],text:"You may do likewise.",[yn.TargetSpirit]:async({$:e,you:a})=>{await a.presence().optionallyPickOne((async a=>{const t=a.location,n=await a.push();n.length>0&&await t.push({quantifier:lr.UpTo,amount:1,pieces:e.ExplorerTownDahanOrBeasts,locations:{target:Jn.ToThisLocation,location:n[0].destination}})}))}}]},xu={name:"Gift Of Seismic Energy",type:Sn.Unique,speed:rr.Fast,energy:3,elements:[nr.Sun,nr.Fire,nr.Earth,nr.Plant],set:a.NatureIncarnate,target:ir.Spirit,effects:[{textArea:[.624,.713],text:"If you target yourself, gain 3 Energy.",[yn.TargetSpirit]:async({you:e,spirit:a})=>{a===e&&await a.gainEnergy(3)}},{textArea:[.726,.929],text:"Otherwise, target Spirit gains 1 Energy per Power Card you have in play (max. 6).<br>(Don't count <impending>.)",[yn.TargetSpirit]:async({you:e,spirit:a})=>{a!==e&&await a.gainEnergy(Math.min(e.numberOfPowerCardsInPlay,6))}}]},bu={name:"Inspire A Winding Dance",type:Sn.Unique,speed:rr.Slow,energy:0,elements:[nr.Moon,nr.Water,nr.Earth,nr.Animal],set:a.NatureIncarnate,target:ir.Land,targetFilter:[sr.Invaders],range:1,hasPushOrGather:!0,effects:[{textArea:[.724,.765],text:"Push up to 1 <explorer>/<town>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(1,e.ExplorerOrTown)}},{textArea:[.785,.826],text:"Gather up to 1 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(1,e.Dahan)}}]},Tu={name:"Land Creaks With Tension",type:Sn.Innate,speed:rr.Fast,set:a.NatureIncarnate,target:ir.Spirit,targetFilter:[ur.Yourself],effects:[{text:"If you have at least 1 <impending>, Add 1 <quake> in one of your lands.",[yn.TargetSpirit]:async({$:e,spirit:a})=>{a.numberOfImpendingCards>=1&&await a.inLands().pickOne((async a=>{await a.add(1,e.Quake)}))},threshold:{[nr.Earth]:1}},{text:"In one of your lands, Defend 1 per <impending> (max. 3).",[yn.TargetSpirit]:async({spirit:e})=>{e.numberOfImpendingCards>=1&&await e.inLands().pickOne((async a=>{await a.defend(Math.min(e.numberOfImpendingCards,3))}))},threshold:{[nr.Moon]:1,[nr.Earth]:1}},{text:"If you have at least 3 <impending>, Add 1 <quake> in one of your lands.",[yn.TargetSpirit]:async({$:e,spirit:a})=>{a.numberOfImpendingCards>=3&&await a.inLands().pickOne((async a=>{await a.add(1,e.Quake)}))},threshold:{[nr.Moon]:1,[nr.Earth]:2}},{text:"In one of your lands, Defend 1 per <impending> (max. 3).",[yn.TargetSpirit]:async({spirit:e})=>{e.numberOfImpendingCards>=1&&await e.inLands().pickOne((async a=>{await a.defend(Math.min(e.numberOfImpendingCards,3))}))},threshold:{[nr.Moon]:2,[nr.Earth]:3}}]},Eu={name:"Radiating Tremors",type:Sn.Unique,speed:rr.Slow,energy:2,elements:[nr.Moon,nr.Fire,nr.Earth],set:a.NatureIncarnate,target:ir.Land,range:0,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{textArea:[.679,.72],text:"2 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(2)}},{textArea:[.738,.871],text:"You may Push any number of <quake>, dividing them as evenly as possible between adjacent lands.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.push({quantifier:lr.Any,pieces:e.Quake,evenly:!0})}}]},Pu={name:"Resounding Footfalls Sow Dismay",type:Sn.Unique,speed:rr.Fast,energy:3,elements:[nr.Fire,nr.Air,nr.Earth],set:a.NatureIncarnate,target:ir.Land,range:0,generatesFear:!0,effects:[{textArea:[.693,.734],text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.752,.793],text:"Add 1 <quake>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Quake)}},{textArea:[.815,.856],text:"Skip all Ravage Actions.",[yn.InTargetLand]:async({land:e})=>{await e.skipInvaderAction({all:!0,filter:({invaderAction:e})=>e===Hr.Ravage})}}]},Su={name:"Rumblings Portend A Greater Quake",type:Sn.Unique,speed:rr.Fast,energy:1,elements:[nr.Sun,nr.Moon,nr.Air,nr.Earth],set:a.NatureIncarnate,target:ir.Land,range:1,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.679,.818],text:"If you have at least as many <impending> as Power Cards in play, 1 <fear> and Add 1 <quake>.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{a.numberOfImpendingCards>=a.numberOfPowerCardsInPlay&&(await t.fear(1),await t.add(1,e.Quake))}},{textArea:[.829,.87],text:"Push up to 3 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushUpTo(3,e.Dahan)}}]},Ou={name:"Blinding Glare",type:Sn.Unique,speed:rr.Fast,energy:0,elements:[nr.Sun,nr.Air],set:a.NatureIncarnate,target:ir.Land,range:0,targetFilter:[sr.Invaders],generatesFear:!0,effects:[{textArea:[.59,.946],text:"2 <fear>.<or>Skip up to one Ravage Action.<br><br>If you have 5 <sun><br>Instead, 3 <fear>.<or>Skip up to one Invader Action.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{const n=await a.askToConvertElements({[nr.Sun]:5})?3:2;await e.chooseBetween({effects:[{actionId:"Fear",text:`${n} <fear>.`,textArea:2===n?[.593,.634]:[.815,.856],[yn.Now]:async()=>{await t.fear(n)}},{actionId:"SkipRavage",textArea:2===n?[.682,.723]:[.896,.937],text:`Skip up to one ${2===n?"Ravage":"Invader"} Action.`,[yn.Now]:async()=>{await t.skipInvaderAction({filter:({invaderAction:e})=>2===n&&e===Hr.Ravage||3===n})}}]})}}]},Cu={name:"Consider A Harmonious Nature",type:Sn.Innate,speed:rr.Fast,set:a.NatureIncarnate,target:ir.Spirit,targetFilter:[ur.Yourself],hasDestroyInstructions:!0,effects:[{text:"When your Powers would add <blight> you may Destroy 1 <presence> instead (there or elsewhere).",[yn.TargetSpirit]:async({$:e,you:a})=>{await e.addSubEffectUntilEndOfTurn({[yn.GlobalReminder]:()=>({icon:"-1 <blight><br>+1 <broken>",spirit:a,players:[a]}),[yn.PreventAddBlight]:async()=>!(e.action.spirit!==a||!await e.may({prompt:"Destroy 1 <presence> to prevent <blight>?"}))&&(await a.destroyPresence(1),!0)})},threshold:{[nr.Sun]:3,[nr.Moon]:1}},{text:"Your Powers don't damage or destroy <dahan>.",[yn.TargetSpirit]:async({$:e,you:a})=>{await e.addSubEffectUntilEndOfTurn({[yn.GlobalReminder]:()=>({icon:"<dahan><br>No <damage>",spirit:a,players:[a]}),[yn.PreventRemovePiece]:({piece:t,removement:n})=>Promise.resolve(e.action.spirit===a&&t.isA(e.Dahan)&&pr[n].isDestroyLike),[yn.PreventDamagingPiece]:({piece:t})=>Promise.resolve(e.action.spirit===a&&t.isA(e.Dahan))})},threshold:{[nr.Sun]:3,[nr.Water]:1}},{text:"Choose another Spirit. They Add 1 <broken> to one of your lands.",[yn.TargetSpirit]:async({$:e,you:a,action:t})=>{await e.fromAllSpirits().pickOne((async e=>{t.data.harmoniousSpirit=e,await e.addPresence({locations:Jn.AnyLands,destroyed:!0,filter:e=>e.hasPresenceOf(a)})}))},threshold:{[nr.Sun]:3,[nr.Plant]:1}},{text:"Give up to 3 of your Energy to the chosen Spirit.",[yn.TargetSpirit]:async({$:e,you:a,action:t})=>{await e.chooseBetween({effects:[0,1,2,3].map((e=>({actionId:`Give${e}Energy`,text:`Give ${e} Energy`,[yn.Now]:async()=>{await a.loseEnergy(e),await t.data.harmoniousSpirit.gainEnergy(e)},condition:()=>a.energy>=e})))})},threshold:{[nr.Sun]:3,[nr.Water]:1,[nr.Plant]:1}}]},Du={name:"Focus The Suns Rays",type:Sn.Unique,speed:rr.Slow,energy:0,elements:[nr.Sun,nr.Fire,nr.Air],set:a.NatureIncarnate,target:ir.Land,sourceFilter:[sr.SacredSite],range:2,hasDamageInstructions:!0,effects:[{textArea:[.659,.699],text:"1 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(1)}},{textArea:[.659,.699],text:"2 Damage to <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.damage(2,e.Dahan)}},{textArea:[.717,.894],text:"Move up to 3 <presence> directly to target land (from anywhere on the island). You may Bring 1 <badlands> (total) with those <presence>.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{let n=!1;await a.presence().pickMultiple({amount:3,optional:!0,forPickedItem:async a=>{const r=a.location;if(await a.move({locations:{target:Jn.ToThisLocation,location:t}}),!n){(await r.move({quantifier:lr.May,amount:1,pieces:e.Badlands,locations:{target:Jn.ToThisLocation,location:t},pickPiecesEffect:{text:"You may Bring 1 <badlands> (total) with those <presence>."}})).length>0&&(n=!0)}},repeatSame:!0})}}]},Bu={name:"Scorching Convergence",type:Sn.Innate,speed:rr.Slow,set:a.NatureIncarnate,target:ir.Land,sourceFilter:[sr.SacredSite],range:1,generatesFear:!0,hasDamageInstructions:!0,specifyOrigin:!0,effects:[{effects:[{text:"Move all of your <presence> from origin land directly to target land.",[yn.InTargetLand]:async({$:e,you:a,land:t,origin:n})=>{await(n?.move({quantifier:lr.All,pieces:e.Presence,owner:a,locations:{target:Jn.ToThisLocation,location:t}}))}},{text:"1 Damage, to <town>/<city> only.",[yn.InTargetLand]:async({$:e,land:a,action:t})=>{const n=await a.damage(1,e.TownOrCity);t.data.destroyedInvaders=t.data.destroyedInvaders||n.length>0}}],threshold:{[nr.Sun]:2}},{effects:[{text:"3 Damage to Invaders.",[yn.InTargetLand]:async({land:e,action:a})=>{const t=await e.damage(3);a.data.destroyedInvaders=a.data.destroyedInvaders||t.length>0}},{text:"3 Damage to Dahan.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.damage(3,e.Dahan)}},{text:"Add 1 <blight> without cascading.",[yn.InTargetLand]:async({land:e})=>{await e.addBlight(1,{mayCascade:!1})}}],threshold:{[nr.Sun]:3,[nr.Fire]:1}},{text:"3 <fear> if this Power destroyed any Invaders.",[yn.InTargetLand]:async({land:e,action:a})=>{a.data.destroyedInvaders&&await e.fear(3)},threshold:{[nr.Sun]:4,[nr.Fire]:2,[nr.Air]:1}},{text:"1 Damage per remaining <presence> of yours in target land.",[yn.InTargetLand]:async({you:e,land:a})=>{await a.damage(a.numberOfPresenceOf(e))},threshold:{[nr.Sun]:5,[nr.Fire]:3,[nr.Air]:2}}]},ku={name:"Unbearable Gaze",type:Sn.Unique,speed:rr.Slow,energy:1,elements:[nr.Sun,nr.Fire],set:a.NatureIncarnate,target:ir.Land,range:1,sourceFilter:[sr.SacredSite],hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.693,.734],text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{textArea:[.763,.854],text:"Push 2 <explorer>/<town> from origin or target land (or 1 <explorer>/<town> from each).",[yn.InTargetLand]:async({$:e,land:a,power:t})=>{let n=t.validOriginsGivenTargetLand(a).items;const r=[];await _r(2,(async()=>{await e.forPiecesWhere((t=>t.isA(e.ExplorerOrTown)&&!r.includes(t)&&(t.location===a||n.includes(t.location)))).pickOne((async e=>{e.location!==a&&(n=[e.location]),await e.push(),r.push(e)}))}))}}]},Lu={name:"Wither Bodies Scar Stones",type:Sn.Unique,speed:rr.Slow,energy:1,elements:[nr.Sun,nr.Fire,nr.Earth],set:a.NatureIncarnate,target:ir.Land,sourceFilter:[sr.SacredSite],range:2,hasDamageInstructions:!0,effects:[{textArea:[.685,.868],text:"1 Damage.<or>Add 1 <badlands>.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{textArea:[.69,.731],actionId:"Damage",text:"1 Damage.",[yn.Now]:async()=>{await a.damage(1)}},{textArea:[.815,.856],actionId:"Badlands",text:"Add 1 <badlands>",[yn.Now]:async()=>{await a.add(1,e.Badlands)}}]})}}]},Fu={name:"Call To Vigilance",type:Sn.Unique,speed:rr.Slow,energy:2,elements:[nr.Sun,nr.Air,nr.Animal],set:a.NatureIncarnate,target:ir.Land,range:1,sourceFilter:[sr.Dahan],hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.701,.742],text:"2 <fear> if Invaders are present.",[yn.InTargetLand]:async({land:e})=>{e.hasInvaders&&await e.fear(2)}},{textArea:[.763,.852],text:"For each <dahan> in origin land, Push up to 1 <explorer>/<town>.",[yn.InTargetLand]:async({$:e,land:a,power:t})=>{await t.validOriginsGivenTargetLand(a).autoPickOne((async t=>{await a.pushUpTo(t.numberOf(e.Dahan),e.ExplorerOrTown)}),{prompt:"Select origin land."})}}]},Ru={name:"Coordinated Raid",type:Sn.Unique,speed:rr.Slow,energy:1,elements:[nr.Sun,nr.Earth,nr.Animal],set:a.NatureIncarnate,target:ir.Land,sourceFilter:[sr.Dahan],range:1,hasDamageInstructions:!0,effects:[{textArea:[.718,.759],text:"1 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(1)}},{textArea:[.785,.826],text:"If <dahan> are present, 1 Damage.",[yn.InTargetLand]:async({$:e,land:a})=>{a.has(e.Dahan)&&await a.damage(1)}}]},Nu={name:"Favors Of Story And Season",type:Sn.Unique,speed:rr.Fast,energy:1,elements:[nr.Sun,nr.Earth,nr.Plant,nr.Animal],set:a.NatureIncarnate,target:ir.Spirit,targetFilter:[ur.Another],hasPushOrGather:!0,effects:[{textArea:[.629,.718],text:"Target Spirit may Gather up to 3 <dahan> into one of their lands.",[yn.TargetSpirit]:async({$:e,spirit:a})=>{await a.inLands().optionallyPickOne((async a=>{await a.gatherUpTo(3,e.Dahan)}))}},{textArea:[.738,.913],text:"If they have at least 3 <dahan> among their lands, they gain 1 Energy and may Reclaim 1 Power Card instead of discarding it at the end of turn.",[yn.TargetSpirit]:async({$:e,power:a,spirit:t})=>{t.numberOfPiecesInLands(e.Dahan)>=3&&(await t.gainEnergy(1),await t.mayReclaimPowerCardInsteadOfDiscarding(a))}}]},$u={name:"Keep Watch For New Incursions",type:Sn.Innate,speed:rr.Fast,set:a.NatureIncarnate,target:ir.Land,sourceFilter:[sr.SacredSiteAndDahan],range:1,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{text:"Gather up to 2 <dahan>, from your lands only.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await t.gather({quantifier:lr.UpTo,amount:2,pieces:e.Dahan,filter:e=>e.hasPresenceOf(a)})},threshold:{[nr.Animal]:1}},{text:"Once this turn after Invaders are added or moved into target land, 1 Damage per <dahan> in target land, to those added/moved Invaders only.",[yn.InTargetLand]:async({$:e,land:a,...t})=>{await a.afterPiecesAreAddedOrMovedAddTrigger({pieces:e.Invader,trigger:{triggerId:e.nextTriggerId(),[yn.Now]:async({action:t})=>{await a.damage(a.numberOf(e.Dahan),e.Invader,{filter:e=>t.parentData.piecesAddedOrMoved.includes(e)&&e.location===a})}},effect:t.effect,action:t.action,removeAfterTrigger:!0})},threshold:{[nr.Sun]:1,[nr.Air]:2,[nr.Animal]:3}},{text:"Repeat this Power.",[yn.InTargetLand]:async({power:e,isRepeat:a})=>{a||await e.repeat()},threshold:{[nr.Sun]:2,[nr.Air]:3,[nr.Animal]:4}}]},Wu={name:"Surrounded By The Dahan",type:Sn.Unique,speed:rr.Fast,energy:0,elements:[nr.Moon,nr.Air,nr.Animal],set:a.NatureIncarnate,target:ir.Land,targetFilter:[sr.Dahan],range:0,generatesFear:!0,effects:[{textArea:[.693,.733],text:"2 <fear> if Invaders are present.",[yn.InTargetLand]:async({land:e})=>{e.hasInvaders&&await e.fear(2)}},{textArea:[.754,.795],text:"1 <fear> if <dahan> outnumber <town>/<city>.",[yn.InTargetLand]:async({$:e,land:a})=>{a.the(e.Dahan).outnumber(e.TownOrCity)&&await a.fear(1)}},{textArea:[.817,.857],text:"Isolate target land.",[yn.InTargetLand]:async({land:e})=>{await e.isolate()}}]},Mu={name:"Warn Of Impending Conflict",type:Sn.Innate,speed:rr.Fast,set:a.NatureIncarnate,target:ir.Spirit,targetFilter:[ur.Yourself],effects:[{text:"In one of your lands, 1 <dahan> deals Damage before Invaders during Ravages. (Choose a land when Invaders Ravage there.)",[yn.TargetSpirit]:async({$:e,spirit:a})=>{await e.addSubEffectUntilEndOfTurn({[yn.GlobalReminder]:()=>({icon:"Ravage<br>1 <dahan>",spirit:a,players:[a]}),[yn.DahanFightBeforeInvaders]:async t=>{t.land.hasPresenceOf(a)&&await t.land.piecesThatAre(e.Dahan).optionallyPickOne((async a=>{e.removeThisEffect(),await a.setFightsBeforeInvaders(!0)}))}})},threshold:{[nr.Sun]:2,[nr.Earth]:1}},{instead:!0,text:"In that land, another <dahan> deals Damage before Invaders during Ravages.",[yn.TargetSpirit]:async({$:e,spirit:a})=>{await e.addSubEffectUntilEndOfTurn({[yn.GlobalReminder]:()=>({icon:"Ravage<br>2 <dahan>",spirit:a,players:[a]}),[yn.DahanFightBeforeInvaders]:async t=>{t.land.hasPresenceOf(a)&&await t.land.piecesThatAre(e.Dahan).pickMultiple({optional:!0,amount:2,forPickedItem:async a=>{e.removeThisEffect(),await a.setFightsBeforeInvaders(!0)},effect:{noOptions:`${a.nameLink} has no lands with <dahan>.`}})}})},threshold:{[nr.Sun]:3,[nr.Earth]:1}},{instead:!0,text:"In that land, all <dahan> deal Damage before Invaders during Ravages.",[yn.TargetSpirit]:async({$:e,spirit:a})=>{await e.addSubEffectUntilEndOfTurn({[yn.GlobalReminder]:()=>({icon:"Ravage<br>All <dahan>",spirit:a,players:[a]}),[yn.DahanFightBeforeInvaders]:async t=>{t.land.hasPresenceOf(a)&&t.land.has(e.Dahan)&&await e.may({prompt:"Do damage before Invaders?"})&&(e.removeThisEffect(),await t.land.piecesThatAre(e.Dahan).forEach((async e=>{await e.setFightsBeforeInvaders(!0)})))}})},threshold:{[nr.Sun]:4,[nr.Earth]:2}},{instead:!0,text:"Instead, all <dahan> in all your lands does Damage before Invaders during Ravages.",label:"All <dahan> in all your lands.",[yn.TargetSpirit]:async({$:e,spirit:a})=>{await e.addSubEffectUntilEndOfTurn({[yn.GlobalReminder]:()=>({icon:"Ravage<br>All <dahan>",spirit:a,players:[a]}),[yn.DahanFightBeforeInvaders]:async t=>{t.land.hasPresenceOf(a)&&await t.land.piecesThatAre(e.Dahan).forEach((async e=>{await e.setFightsBeforeInvaders(!0)}))}})},threshold:{[nr.Sun]:5,[nr.Earth]:3}}]},Gu={name:"Blooming Of The Rocks And Trees",type:Sn.Unique,speed:rr.Slow,energy:0,elements:[nr.Sun,nr.Air,nr.Earth,nr.Plant],set:a.NatureIncarnate,target:ir.Land,sourceFilter:[sr.SacredSite],range:1,effects:[{textArea:[.601,.934],text:"If no <blight> is present, Add 1 <vitality>.<or>If no Invaders are present, Add 1 <wilds>.<br><br>If you have 3 <plant>:<br>You may do both.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await e.chooseBetween({effects:[{actionId:"Vitality",textArea:[.612,.653],text:"If no <blight> is present, Add 1 <vitality>.",[yn.Now]:async()=>{t.doesntHave(e.Blight)&&await t.add(1,e.Vitality)}},{actionId:"Wilds",textArea:[.732,.773],text:"If no Invaders are present, Add 1 <wilds>.",[yn.Now]:async()=>{t.doesntHave(e.Invader)&&await t.add(1,e.Wilds)}},{actionId:"Both",textArea:[.891,.932],text:"Do both.",condition:()=>!e.treatingAllOrsAsAnds&&a.hasElementsWithConvert({[nr.Plant]:3}),[yn.Now]:async()=>{await a.convertElements({[nr.Plant]:3}),t.doesntHave(e.Blight)&&await e.addSubEffect({textArea:[.612,.653],text:"If no <blight> is present, Add 1 <vitality>.",[yn.Now]:async()=>{await t.add(1,e.Vitality)}}),t.doesntHave(e.Invader)&&await e.addSubEffect({textArea:[.732,.773],text:"If no Invaders are present, Add 1 <wilds>.",[yn.Now]:async()=>{await t.add(1,e.Wilds)}})}}]})}}]},Hu={name:"Boon Of Resilient Power",type:Sn.Unique,speed:rr.Slow,energy:1,elements:[nr.Sun,nr.Moon,nr.Water,nr.Plant],set:a.NatureIncarnate,target:ir.Spirit,effects:[{textArea:[.649,.752],text:"Target Spirit may Add 1 <broken> to one of your lands.",[yn.TargetSpirit]:async({you:e,spirit:a})=>{await a.addPresence({filter:a=>a.hasPresenceOf(e),destroyed:!0,locations:Jn.AnyLands})}},{textArea:[.763,.899],text:"If you target yourself, gain a Major Power. Otherwise target Spirit gains a Power Card.",[yn.TargetSpirit]:async({you:e,spirit:a})=>{a===e?await e.gainPowerCard({powerType:Sn.Major}):await a.gainPowerCard()}}]},ju={name:"Entwine The Fates Of All",type:Sn.Unique,speed:rr.Fast,energy:1,elements:[nr.Moon,nr.Water,nr.Earth,nr.Plant],set:a.NatureIncarnate,target:ir.Spirit,effects:[{textArea:[.735,.821],text:"In one of target Spirit's lands, Defend 2 per <presence> (from all Spirits).",[yn.TargetSpirit]:async({$:e,spirit:a})=>{await a.inLands().pickOne((async a=>{await a.defend(2*a.numberOf(e.Presence))}))}}]},Uu={name:"Radiant And Hallowed Grove",type:Sn.Unique,speed:rr.Fast,energy:2,elements:[nr.Sun,nr.Moon,nr.Fire,nr.Plant],set:a.NatureIncarnate,target:ir.Land,targetFilter:[sr.IncarnaRoots],generatesFear:!0,effects:[{textArea:[.607,.701],text:"2 <fear> if Invaders are present or adjacent.",[yn.InTargetLand]:async({land:e})=>{e.piecesInThisAndAdjacentLocations().where((e=>e.isInvader)).count>0&&await e.fear(2)}},{textArea:[.718,.935],text:"In both target and one adjacent land, you may Remove an Invader with Health less than or equal to the Terror Level. (Damage doesn't reduce Health.)",[yn.InTargetLand]:async({$:e,land:a})=>{await a.removeInvadersWorthOfHealthUpTo(e.terrorLevel),await a.inAdjacentLands().pickOne((async a=>{await a.removeInvadersWorthOfHealthUpTo(e.terrorLevel)}))}}]},qu={name:"Revoke Sanctuary And Cast Out",type:Sn.Innate,speed:rr.Slow,set:a.NatureIncarnate,target:ir.Land,sourceFilter:[sr.SacredSite],targetFilter:[sr.InvadersAndIncarnaRoots],range:0,generatesFear:!0,effects:[{effects:[{text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{text:"Remove 1 <explorer>/<town>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.removeOne(e.ExplorerOrTown)}}],threshold:{[nr.Sun]:1,[nr.Moon]:1,[nr.Plant]:2}},{effects:[{text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{text:"Remove 1 <explorer>/<town>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.removeOne(e.ExplorerOrTown)}}],threshold:{[nr.Sun]:2,[nr.Moon]:1,[nr.Plant]:3}},{effects:[{text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{text:"Remove 1 Invader.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.removeOne(e.Invader)}}],threshold:{[nr.Sun]:2,[nr.Moon]:2,[nr.Plant]:4}}]},_u={name:"Shelter Under Towering Branches",type:Sn.Innate,speed:rr.Slow,set:a.NatureIncarnate,target:ir.Land,sourceFilter:[sr.SacredSite],range:0,hasPushOrGather:!0,effects:[{text:"Gather up to 1 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(1,e.Dahan)},threshold:{[nr.Sun]:1,[nr.Plant]:1}},{text:"Gather up to 1 <explorer>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(1,e.Explorer)},threshold:{[nr.Sun]:1,[nr.Earth]:1,[nr.Plant]:2}},{text:"Gather up to 1 <town>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(1,e.Town)},threshold:{[nr.Sun]:2,[nr.Earth]:1,[nr.Plant]:3}},{text:"Gather up to 1 <city>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(1,e.City)},threshold:{[nr.Sun]:3,[nr.Earth]:2,[nr.Plant]:4}}]},Ju={name:"Exhale Confusion And Delirium",type:Sn.Unique,speed:rr.Fast,energy:0,elements:[nr.Sun,nr.Moon,nr.Air,nr.Animal],set:a.NatureIncarnate,target:ir.Land,targetFilter:[sr.Strife],range:1,generatesFear:!0,effects:[{textArea:[.624,.665],text:"2 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.683,.924],text:"Invaders with <strife> don't participate in Ravage. (Check when Ravaging; they don't do Damage or take counterattack Damage.)",[yn.InTargetLand]:async({$:e,land:a,effect:t})=>{await e.addSubEffectUntilEndOfTurn({[yn.Reminder]:e=>e===a?t.text:void 0,[yn.DoesNotParticipateInRavage]:async({location:t})=>{t===a&&await t.doNotParticipateInRavage({pieces:e.Invader,pieceFilter:e=>e.strife>0})}})}}]},Vu={name:"Frightful Keening",type:Sn.Unique,speed:rr.Slow,energy:1,elements:[nr.Sun,nr.Fire,nr.Air],set:a.NatureIncarnate,target:ir.Land,targetFilter:[sr.IncarnaVoice],hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.674,.715],text:"Push <incarna-voice>.",[yn.InTargetLand]:async({$:e,you:a,action:t})=>{a.incarna&&(await e.addSubEffectUntilEndOfAction({textArea:[.74,.874],text:"If this pushes <incarna-voice> into a land with Invaders, 2 <fear> there (before adding <strife>).",highPriority:!0,[yn.AfterMoving]:async({piece:t,destination:n})=>{t.isA(e.IncarnaVoice)&&t.owner===a&&n.hasInvaders&&await n.fear(2)}}),t.data.movement=await a.incarna.push())}}]},Yu={name:"Inscrutable Journeying",type:Sn.Innate,speed:rr.Fast,set:a.NatureIncarnate,target:ir.Spirit,targetFilter:[ur.Yourself],hasPushOrGather:!0,effects:[{text:"You may Push <incarna-voice>.",[yn.TargetSpirit]:async({spirit:e})=>{await(e.incarna?.push({quantifier:lr.May}))},threshold:{[nr.Air]:1}},{text:"You may Push <incarna-voice>.",[yn.TargetSpirit]:async({spirit:e})=>{await(e.incarna?.push({quantifier:lr.May}))},threshold:{[nr.Air]:3}},{text:"You may Push <incarna-voice>.",[yn.TargetSpirit]:async({spirit:e})=>{await(e.incarna?.push({quantifier:lr.May}))},threshold:{[nr.Air]:5}},{text:"Empower <incarna-voice>.",[yn.TargetSpirit]:async({spirit:e})=>{await e.empowerIncarna()},threshold:{[nr.Moon]:2,[nr.Fire]:1,[nr.Air]:4,[nr.Plant]:1}}]},zu={name:"Mind Shattering Song",type:Sn.Innate,speed:rr.Slow,set:a.NatureIncarnate,target:ir.Land,sourceFilter:[sr.SacredSite],targetFilter:[sr.Strife],range:1,mayAlwaysDowngrade:!0,generatesFear:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{text:"1 <fear> per <moon> you have.",[yn.InTargetLand]:async({you:e,land:a})=>{await e.askToConvertElementsToCombo({[nr.Moon]:1}),await a.fear(e.elements[nr.Moon])},threshold:{[nr.Moon]:1,[nr.Air]:2}},{text:"1 Damage per <sun> you have, to Invaders with <strife> only.",[yn.InTargetLand]:async({$:e,you:a,land:t})=>{await t.damage(a.elements[nr.Sun],e.Invader,{filter:e=>e.strife>0})},threshold:{[nr.Sun]:1,[nr.Air]:2}},{text:"For each <sun><moon> pair you have, Destroy 1 Invader with <strife>.",[yn.InTargetLand]:async({you:e,land:a})=>{await e.askToConvertElementsToCombo({[nr.Sun]:1,[nr.Moon]:1}),await a.destroy({amount:e.numberOfElementCombos({[nr.Sun]:1,[nr.Moon]:1}),filter:e=>e.strife>0})},threshold:{[nr.Moon]:1,[nr.Sun]:1,[nr.Air]:4}}]},Qu={name:"Turmoil's Touch",type:Sn.Unique,speed:rr.Slow,energy:0,elements:[nr.Sun,nr.Moon,nr.Air,nr.Plant],set:a.NatureIncarnate,target:ir.Spirit,targetFilter:[ur.Another],effects:[{textArea:[.66,.896],text:"Target Spirit may either pay 1 Energy or discard a Power Card (from hand) to Take a Minor Power into their discard. You  may do likewise.",[yn.TargetSpirit]:async({$:e,you:a,spirit:t})=>{await t.andAnotherSpirit(a,{now:async(a,t)=>{await e.chooseBetween({text:`${t?"Target Spirit":"You"} may either pay 1 Energy or discard a Power Card (from hand) to Take a Minor Power into ${t?"their":"your"} discard.`,textArea:t?[.663,.832]:[.852,.893],effects:[{actionId:"Energy",text:"Pay 1 Energy to Take a Minor Power into their discard.",[yn.Now]:async()=>{await a.payEnergy(1);const e=await a.gainPowerCard({powerType:Sn.Minor,drawAmount:1,taken:!0});for(const a of e.chosen)await a.discard()},condition:()=>a.energy>=1},{actionId:"DiscardPowerCard",text:"Discard a Power Card (from hand) to Take a Minor Power into their discard.",[yn.Now]:async()=>{await a.discardPowerCards(1);const e=await a.gainPowerCard({powerType:Sn.Minor,drawAmount:1,taken:!0});for(const a of e.chosen)await a.discard()},condition:()=>a.numberOfPowerCardsInHand>0},{actionId:"Neither",text:"Neither.",[yn.Now]:async()=>{}}]})}})}}]},Ku={name:"Twist Perceptions",type:Sn.Unique,speed:rr.Slow,energy:1,elements:[nr.Moon,nr.Air,nr.Animal],set:a.NatureIncarnate,target:ir.Land,targetFilter:[sr.Invaders],range:1,hasPushOrGather:!0,effects:[{textArea:[.632,.673],text:"Add 1 <strife>.",[yn.InTargetLand]:async({$:e,land:a})=>{const t=await a.addStrife(1);t.length>0&&await e.addSubEffect({textArea:[.629,.916],text:"You may Push the Invader you added <strife> to.<br><br>(If you add <strife> to <explorer>/<town>, you can push that Invader first with Senseless Roaming before pushing it with this Power.)",[yn.Now]:async()=>{for(const e of t)await e.push({quantifier:lr.May,pickPiecesEffect:{}})}})}}]},Xu={name:"Afflict With Bloodthirst",type:Sn.Innate,speed:rr.Fast,set:a.NatureIncarnate,target:ir.Land,range:1,hasPushOrGather:!0,hasDamageInstructions:!0,effects:[{textArea:[.341,.381],text:"Gather 1 <beasts>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherOne(e.Beasts)},threshold:{[nr.Animal]:1}},{textArea:[.423,.463],text:"2 <fear> if Invaders are present.",[yn.InTargetLand]:async({land:e})=>{e.hasInvaders&&await e.fear(2)},threshold:{[nr.Fire]:1,[nr.Animal]:3}},{textArea:[.478,.597],text:"1 <explorer> and 1 <town>/<dahan> do Damage, to other Invaders only.",[yn.InTargetLand]:async({$:e,land:a})=>{const t=[];for(const n of[e.Explorer,e.TownOrDahan])await a.piecesThatAre(n).autoPickOne((e=>(t.push(e),Promise.resolve())),{prompt:`Pick which ${Kn[n].text} to do Damage to other Invaders.`});for(const n of t)await e.addSubEffect({highlightPieces:[n],[yn.Now]:async()=>{await a.damage(n.strengthOutOfRavage,e.Invader,{filter:e=>e!==n})}})},threshold:{[nr.Sun]:1,[nr.Fire]:2,[nr.Animal]:4}},{textArea:[.614,.698],text:"For each <beasts>: Push 1 <explorer> and 1 <town>/<dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.push({amount:a.numberOf(e.Beasts),pieces:e.Explorer}),await a.push({amount:a.numberOf(e.Beasts),pieces:e.TownOrDahan})},threshold:{[nr.Fire]:1,[nr.Animal]:2}}]},Zu={name:"Blood Water And Bloodlust",type:Sn.Unique,speed:rr.Slow,energy:1,elements:[nr.Fire,nr.Water,nr.Animal],set:a.NatureIncarnate,target:ir.Land,sourceFilter:[sr.Blight],range:1,effects:[{textArea:[.752,.793],text:"Add 1 <beasts> and 1 <disease>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Beasts),await a.add(1,e.Disease)}}]},eg={name:"Boon Of Corrupted Blood",type:Sn.Unique,speed:rr.Fast,energy:1,elements:[nr.Sun,nr.Fire,nr.Animal],set:a.NatureIncarnate,target:ir.Spirit,hasPushOrGather:!0,hasDestroyInstructions:!0,hasDamageInstructions:!0,effects:[{textArea:[.635,.724],text:"1 Damage in one of target Spirit's lands",[yn.TargetSpirit]:async({$:e,you:a,spirit:t})=>{await t.inLands().pickOne((async n=>{await n.damage(1),t!==a&&await e.addSubEffect({effects:[{textArea:[.74,.871],text:"If you target another Spirit, in that land also: Destroy 1 of their <presence>.",[yn.Now]:async()=>{await n.destroy({pieces:e.Presence,owner:t})}},{textArea:[.871,.912],text:"1 Damage.",[yn.Now]:async()=>{await n.damage(1)}},{textArea:[.871,.912],text:"Gather 1 <beasts>.",[yn.Now]:async()=>{await n.gatherOne(e.Beasts)}}]})}))}}]},ag={name:"Call To A Fastness Of Renewal",type:Sn.Innate,speed:rr.Fast,set:a.NatureIncarnate,target:ir.Land,range:1,hasPushOrGather:!0,effects:[{textArea:[.348,.388],text:"Gather up to 2 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gatherUpTo(2,e.Dahan)},threshold:{[nr.Water]:1}},{textArea:[.423,.463],text:"Defend 3 or Downgrade 1 Invader.",[yn.InTargetLand]:async({$:e,land:a})=>{await e.chooseBetween({effects:[{actionId:"Defend",text:"Defend 3",[yn.Now]:async()=>{await a.defend(3)}},{actionId:"Downgrade",text:"Downgrade 1 Invader.",[yn.Now]:async()=>{await a.downgrade()}}]})},threshold:{[nr.Water]:2,[nr.Plant]:1}},{textArea:[.504,.544],text:"Add 1 <beasts>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Beasts)},threshold:{[nr.Water]:3,[nr.Plant]:1}},{textArea:[.565,.657],text:"If at least 2 <dahan> are present, Replace 1 Invader with 1 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{a.hasAtLeast(2,e.Dahan)&&await a.replaceOne({pieces:e.Invader,withPiece:Bn.Dahan})},threshold:{[nr.Sun]:1,[nr.Water]:4,[nr.Plant]:2}}]},tg={name:"Draw To The Water's Edge",type:Sn.Unique,speed:rr.Fast,energy:1,elements:[nr.Sun,nr.Water,nr.Plant],set:a.NatureIncarnate,target:ir.Land,range:0,hasPushOrGather:!0,effects:[{textArea:[.729,.818],text:"Gather up to 2 <town> from a single land.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.gather({quantifier:lr.UpTo,pieces:e.Town,amount:2,single:!0})}}]},ng={name:"Sanguinary Taint",type:Sn.Innate,speed:rr.Slow,set:a.NatureIncarnate,target:ir.Land,range:1,hasPushOrGather:!0,generatesFear:!0,hasDamageInstructions:!0,effects:[{effects:[{text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{text:"1 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(1)}},{text:"Push 1 <dahan>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushOne(e.Dahan)}}],threshold:{[nr.Animal]:2}},{effects:[{text:"1 Damage",[yn.InTargetLand]:async({land:e})=>{await e.damage(1)}},{text:"Add 1 <beasts>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Beasts)}}],threshold:{[nr.Water]:1,[nr.Animal]:3}},{effects:[{text:"1 <fear>",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{text:"4 Damage.",[yn.InTargetLand]:async({land:e})=>{await e.damage(4)}},{text:"Add 1 <disease>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.add(1,e.Disease)}}],threshold:{[nr.Fire]:2,[nr.Water]:2,[nr.Animal]:5}}]},rg={name:"Swirl And Spill",type:Sn.Innate,speed:rr.Slow,set:a.NatureIncarnate,target:ir.Land,range:1,hasPushOrGather:!0,generatesFear:!0,effects:[{text:"Push up to 2 <explorer>/<dahan>/<blight>.",[yn.InTargetLand]:async({$:e,land:a,action:t})=>{t.data.movements=[],t.data.movements.push(...await a.pushUpTo(2,e.ExplorerDahanOrBlight))},threshold:{[nr.Water]:2}},{effects:[{text:"1 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(1)}},{text:"Push up to 2 <town>/<presence>/<beasts>.",[yn.InTargetLand]:async({$:e,land:a,action:t})=>{t.data.movements.push(...await a.pushUpTo(2,e.TownPresenceOrBeasts))}}],threshold:{[nr.Water]:3,[nr.Animal]:1}},{text:"In one land pushed into, Downgrade all <town> and all <city>.",[yn.InTargetLand]:async({$:e,action:a})=>{const t=a.data.movements.map((e=>e.destination));await id.createCollection(e,t).pickOne((async a=>{await a.downgrade({quantifier:lr.All,pieces:e.TownOrCity})}))},threshold:{[nr.Water]:5,[nr.Plant]:2,[nr.Animal]:2}}]},ig={name:"Wrack With Pain And Grief",type:Sn.Unique,speed:rr.Slow,energy:1,elements:[nr.Water,nr.Plant,nr.Animal],set:a.NatureIncarnate,target:ir.Land,sourceFilter:[sr.Blight],targetFilter:[sr.Invaders],range:1,hasPushOrGather:!0,generatesFear:!0,effects:[{textArea:[.724,.765],text:"2 <fear>.",[yn.InTargetLand]:async({land:e})=>{await e.fear(2)}},{textArea:[.782,.823],text:"Push 1 <explorer> and 1 <town>.",[yn.InTargetLand]:async({$:e,land:a})=>{await a.pushOne(e.Explorer),await a.pushOne(e.Town)}}]},sg={[Mi.ACircuitousAndWendingJourney]:tl,[Mi.ADreadfulTideOfScurryingFlesh]:ch,[Mi.AYearOfPerfectStillness]:Cd,[Mi.AbsoluteStasis]:zl,[Mi.AbsorbCorruption]:Es,[Mi.AbsorbEssence]:ll,[Mi.AcceleratedRot]:or,[Mi.AfflictWithBloodthirst]:Xu,[Mi.AidFromTheSpiritspeakers]:nl,[Mi.AirMovesEarthEndures]:Ch,[Mi.AllEnvelopingGreen]:qd,[Mi.AngryBears]:ni,[Mi.AnimatedWrackroot]:Ps,[Mi.AsphyxiatingSmoke]:yl,[Mi.BargainOfCoursingPaths]:Si,[Mi.BargainsOfPowerAndProtection]:ri,[Mi.BatsScoutForRaidsByDarkness]:to,[Mi.BelligerentAndAggressiveCrops]:_d,[Mi.BesetAndConfoundTheInvaders]:lh,[Mi.BirdsCryWarning]:no,[Mi.BlazingIntimidation]:cu,[Mi.BlazingRenewal]:dr,[Mi.BlindingGlare]:Ou,[Mi.BloodDrawsPredators]:ro,[Mi.BloodWaterAndBloodlust]:Zu,[Mi.BloodwrackPlague]:Lr,[Mi.BloomingOfTheRocksAndTrees]:Gu,[Mi.BlurTheArcOfYears]:Ql,[Mi.BombardWithBouldersAndStingingSeeds]:Oi,[Mi.BoonOfAncientMemories]:wh,[Mi.BoonOfCorruptedBlood]:eg,[Mi.BoonOfGrowingPower]:qc,[Mi.BoonOfReimagining]:Dh,[Mi.BoonOfResilientPower]:Hu,[Mi.BoonOfSunshinesPromise]:wc,[Mi.BoonOfSwarmingBedevilment]:hh,[Mi.BoonOfVigor]:yc,[Mi.BoonOfWatchfulGuarding]:Tl,[Mi.CallOfTheDahanWays]:Ui,[Mi.CallOfTheDeeps]:dc,[Mi.CallOnHerdersForAid]:Cl,[Mi.CallOnMidnightsDream]:xd,[Mi.CallToAFastnessOfRenewal]:ag,[Mi.CallToASunlitHaven]:mc,[Mi.CallToBloodshed]:qi,[Mi.CallToFerocity]:Ss,[Mi.CallToGuard]:io,[Mi.CallToIsolation]:_i,[Mi.CallToMigrate]:Ji,[Mi.CallToTend]:Vi,[Mi.CallToTrade]:Os,[Mi.CallToVigilance]:Fu,[Mi.CarapacedLand]:so,[Mi.CastDownIntoTheBrinyDeep]:Rr,[Mi.CleansingFloods]:cr,[Mi.CloseTheWays]:rl,[Mi.ConcealingShadows]:bc,[Mi.ConfoundingMists]:Cs,[Mi.ConsiderAHarmoniousNature]:Cu,[Mi.CoordinatedRaid]:Ru,[Mi.CreepersTearIntoMortar]:Jd,[Mi.CropsWitherAndFade]:Tc,[Mi.CyclesOfTimeAndTide]:Ds,[Mi.DarkAndTangledWoods]:Yi,[Mi.DarkSkiesLooseAStingingRain]:Qc,[Mi.DarknessSwallowsTheUnwary]:Ec,[Mi.DeathApproachesFromBeneathTheSurface]:Ml,[Mi.DeathFallsGentlyFromOpenBlossoms]:Nr,[Mi.DelusionsOfDanger]:zi,[Mi.DesiccatingWinds]:oo,[Mi.DevouringAnts]:Qi,[Mi.DireMetamorphosis]:co,[Mi.DisorientingLandscape]:Bs,[Mi.DissolveTheBondsOfKinship]:hr,[Mi.DissolvingVapors]:bh,[Mi.DomesticatedAnimalsGoBerserk]:lo,[Mi.DrawOfTheFruitfulEarth]:Dd,[Mi.DrawToTheWatersEdge]:tg,[Mi.DrawTowardsAConsumingVoid]:ii,[Mi.DreadApparitions]:bd,[Mi.DreamOfTheUntouchedLand]:si,[Mi.DreamsOfTheDahan]:Td,[Mi.DriftDownIntoSlumber]:Ki,[Mi.Drought]:Xi,[Mi.DryWoodExplodesInSmolderingSplinters]:ho,[Mi.EarthMovesWithVigorAndMight]:Wd,[Mi.EarthShuddersBuildingsFall]:Au,[Mi.EerieNoisesAndMovingTrees]:El,[Mi.ElementalAegis]:hl,[Mi.ElementalBoon]:Zi,[Mi.ElementalTeachings]:yh,[Mi.ElusiveAmbushes]:ks,[Mi.EmergeFromTheDreadNightWind]:fu,[Mi.EncircleTheUnsuspectingPrey]:$c,[Mi.EncompassingWard]:es,[Mi.EnticingAndLullingDreams]:Pc,[Mi.EnticingSplendor]:as,[Mi.EntrancingApparitions]:ts,[Mi.EntrapTheForcesOfCorruption]:uo,[Mi.EntwineTheFatesOfAll]:ju,[Mi.EntwinedPower]:gr,[Mi.EpidemicsRunRampant]:Kh,[Mi.EvermultiplyingSwarm]:uh,[Mi.ExaltationOfEchoedSteps]:Iu,[Mi.ExaltationOfGraspingRoots]:lu,[Mi.ExaltationOfMoltenStone]:nu,[Mi.ExaltationOfTangledGrowth]:Fl,[Mi.ExaltationOfTheIncandescentSky]:Ci,[Mi.ExaltationOfTheStormWind]:Zd,[Mi.ExaltationOfTheTransformingFlame]:ml,[Mi.ExhaleConfusionAndDelirium]:Ju,[Mi.ExplosiveEruption]:ru,[Mi.FavorOfTheSunAndStarlitDark]:go,[Mi.FavorsCalledDue]:Sc,[Mi.FavorsOfStoryAndSeason]:Nu,[Mi.FerociousRampage]:Gl,[Mi.FetidBreathSpreadsInfection]:Xh,[Mi.FieldsChokedWithGrowth]:Vd,[Mi.FieryVengeance]:Zh,[Mi.FireAndFlood]:$r,[Mi.FireBurnsWaterSoothes]:Bh,[Mi.FireInTheSky]:Ls,[Mi.Firestorm]:vl,[Mi.FlamesFury]:Al,[Mi.FlashFloods]:vc,[Mi.Flashfires]:Il,[Mi.FleshrotFever]:Fs,[Mi.FlockingRedTalons]:Di,[Mi.FlowDownriverBlowDownwind]:fo,[Mi.FlowLikeWaterReachLikeAir]:Wr,[Mi.FlowingAndSilentFormsDartBy]:Th,[Mi.FocusTheLandsAnguish]:oi,[Mi.FocusTheSunsRays]:Du,[Mi.ForestsOfLivingObsidian]:di,[Mi.ForsakeSocietyToChaseAfterDreams]:th,[Mi.FoulVaporsAndFetidMuck]:Rl,[Mi.FoundationsSinkIntoMud]:Kc,[Mi.FragmentsOfYesteryear]:Bi,[Mi.FrenziedAssault]:Wc,[Mi.FrightfulKeening]:Vu,[Mi.GatherTheScatteredLightOfStars]:kh,[Mi.GatherTheWarriors]:Dc,[Mi.GiftOfAbundance]:Xc,[Mi.GiftOfConstancy]:ns,[Mi.GiftOfFlowingPower]:ul,[Mi.GiftOfFuriousMight]:Hl,[Mi.GiftOfLivingEnergy]:rs,[Mi.GiftOfNaturesConnection]:po,[Mi.GiftOfPower]:is,[Mi.GiftOfProliferation]:Yd,[Mi.GiftOfSearingHeat]:Dl,[Mi.GiftOfSeismicEnergy]:xu,[Mi.GiftOfStrength]:Gd,[Mi.GiftOfThePrimordialDeeps]:gl,[Mi.GiftOfTheSparkingSky]:ec,[Mi.GiftOfTheSunlitAir]:ql,[Mi.GiftOfTheUntamedWild]:nh,[Mi.GiftOfTwinnedDays]:wo,[Mi.GiftOfWindspedSteps]:_l,[Mi.GnawingRootbiters]:ss,[Mi.GoldsAllure]:Rs,[Mi.GrantHatredARavenousForm]:Mr,[Mi.GraspingTide]:cc,[Mi.GrowthThroughSacrifice]:Ns,[Mi.GuardTheHealingLand]:Hd,[Mi.GuardianSerpents]:$s,[Mi.GuideTheWayOnFeatheredWings]:gh,[Mi.HarbingersOfTheLightning]:ac,[Mi.HauntedByPrimalMemories]:yo,[Mi.HazardsSpreadAcrossTheIsland]:mo,[Mi.HerdTowardsTheLurkingMaw]:jl,[Mi.HereThereBeMonsters]:Ws,[Mi.HoldTheIslandFastWithABulwarkOfWill]:Wh,[Mi.ImbueWithNourishingVitality]:jd,[Mi.ImpenetrableTanglesOfGreenery]:zd,[Mi.ImpersonateAuthority]:qh,[Mi.InciteTheMob]:_h,[Mi.IndomitableClaim]:fr,[Mi.InfestationOfVenomousSpiders]:ci,[Mi.InfestedAquifers]:Ms,[Mi.InfiniteVitality]:wr,[Mi.InflameTheFiresOfLife]:Gs,[Mi.InsatiableHungerOfTheSwarm]:Gr,[Mi.InscrutableJourneying]:Yu,[Mi.InspireAWindingDance]:bu,[Mi.InspireTheReleaseOfStolenLands]:ki,[Mi.InstrumentsOfTheirOwnRuin]:jr,[Mi.IntractableThicketsAndThorns]:Nl,[Mi.IrresistibleCall]:li,[Mi.JaggedShardsPushFromTheEarth]:Mh,[Mi.KeepWatchForNewIncursions]:$u,[Mi.LandCreaksWithTension]:Tu,[Mi.LandOfHauntsAndEmbers]:os,[Mi.LavaFlows]:iu,[Mi.LayPathsTheyCannotHelpButWalk]:il,[Mi.LeadTheFuriousAssault]:Bc,[Mi.LeadTheWarriorsToBattle]:kc,[Mi.LearnTheInvadersTactics]:mh,[Mi.LeaveATrailOfDeathlySilence]:pu,[Mi.LetThemBreakThemselvesAgainstTheStone]:Gh,[Mi.LetsSeeWhatHappens]:Jh,[Mi.LightningTornSkiesIncitePandemonium]:nc,[Mi.LightningsBoon]:tc,[Mi.LikeCallsToLike]:vo,[Mi.LostInTheEndlessDark]:wu,[Mi.LostInTheSwirlingHaze]:Eh,[Mi.LureOfTheUnknown]:ds,[Mi.ManifestIncarnation]:Ur,[Mi.ManifestationOfPowerAndGlory]:Lc,[Mi.MantleOfDread]:Oc,[Mi.MarkTerritoryWithScarsAndTeeth]:Ul,[Mi.MassiveFlooding]:Ac,[Mi.MeltEarthIntoQuicksand]:hi,[Mi.MesmerizedTranquility]:Ao,[Mi.MindShatteringSong]:zu,[Mi.MischiefAndSabotage]:Pl,[Mi.MistsOfOblivion]:yr,[Mi.MysteriousAbductions]:Sl,[Mi.NaturesResilience]:cs,[Mi.NeverHeardFromAgain]:rh,[Mi.NightTerrors]:Ed,[Mi.ObserveTheEverChangingWorld]:vh,[Mi.OceanBreaksTheShore]:lc,[Mi.OfferPassageBetweenWorlds]:sl,[Mi.OpenShiftingWaterways]:$l,[Mi.OverenthusiasticArson]:Vh,[Mi.OvergrowInANight]:Qd,[Mi.PactOfTheJoinedHunt]:Hs,[Mi.ParalyzingFright]:mr,[Mi.PathsTiedByNature]:ol,[Mi.PeaceOfTheNighttimeSky]:Lh,[Mi.PentupCalamity]:Jr,[Mi.PerilsOfTheDeepestIsland]:ih,[Mi.PillarOfLivingFlame]:vr,[Mi.PlagueShipsSailToDistantPorts]:Li,[Mi.Plaguebearers]:eu,[Mi.PlowsShatterOnRockyGround]:Hh,[Mi.PoisonedDew]:js,[Mi.PoisonedLand]:Ar,[Mi.PortentsOfDisaster]:Us,[Mi.PoundShipsToSplinters]:hc,[Mi.PourTimeSideways]:Kl,[Mi.PoweredByTheFurnaceOfTheEarth]:su,[Mi.Powerstorm]:Ir,[Mi.PredatoryNightmares]:Pd,[Mi.PreyOnTheBuilders]:Mc,[Mi.PromisesOfProtection]:qs,[Mi.ProwlingPanthers]:_s,[Mi.PullBeneathTheHungryEarth]:ls,[Mi.PunishThoseWhoTrespass]:_c,[Mi.PurifyingFlame]:hs,[Mi.PursueWithScratchesPecksAndStings]:fh,[Mi.PyroclasticBombardment]:ou,[Mi.PyroclasticFlow]:Vr,[Mi.QuickenTheEarthsStruggles]:us,[Mi.RadiantAndHallowedGrove]:Uu,[Mi.RadiatingTremors]:Eu,[Mi.RagingStorm]:rc,[Mi.RainAndMudSuppressConflict]:Zc,[Mi.RainOfAsh]:du,[Mi.RainOfBlood]:gs,[Mi.RangingHunt]:Gc,[Mi.RavagedUndergrowthSlithersBackToLife]:Fi,[Mi.RazorsharpUndergrowth]:Js,[Mi.ReachFromTheInfiniteDarkness]:yu,[Mi.ReachingGrasp]:fs,[Mi.ReclaimedByTheDeeps]:uc,[Mi.RegrowFromRoots]:Jc,[Mi.RenewingBoon]:Io,[Mi.RenewingRain]:Vs,[Mi.ResoundingFootfallsSowDismay]:Pu,[Mi.RevokeSanctuaryAndCastOut]:qu,[Mi.RitesOfTheLandsRejection]:Ys,[Mi.RitualsOfDestruction]:Ud,[Mi.RiversBounty]:Ic,[Mi.RoilingBogAndSnaggingThorn]:Ad,[Mi.RouseTheTreesAndStones]:ps,[Mi.RumblingEarthquakes]:Ri,[Mi.RumblingsPortendAGreaterQuake]:Su,[Mi.SacrosanctWilderness]:Vc,[Mi.SanguinaryTaint]:ng,[Mi.SapTheStrengthOfMultitudes]:ws,[Mi.SavageMawbeasts]:ys,[Mi.SavageRevenge]:au,[Mi.SavageTransformation]:Yr,[Mi.ScarredAndStonyLand]:jh,[Mi.ScatterToTheWinds]:Jl,[Mi.ScorchWithWavesOfHeat]:Bl,[Mi.ScorchingConvergence]:Bu,[Mi.ScourTheLand]:zs,[Mi.ScreamDiseaseIntoTheWind]:sd,[Mi.SeaMonsters]:ui,[Mi.SearAngerIntoTheWildLands]:od,[Mi.SerpentRousesInAnger]:fl,[Mi.SerpentWakesInPower]:pl,[Mi.SetThemOnAnEvertwistingTrail]:dd,[Mi.SettleIntoHuntinggrounds]:gi,[Mi.ShadowsOfTheBurningForest]:ms,[Mi.ShapeTheSelfAnew]:Fh,[Mi.ShareMentorshipAndExpertise]:Ah,[Mi.ShareSecretsOfSurvival]:Ih,[Mi.ShatterHomesteads]:ic,[Mi.ShelterUnderToweringBranches]:_u,[Mi.SiderealGuidance]:Rh,[Mi.SkiesHeraldTheSeasonOfReturn]:cd,[Mi.SkyStretchesToShore]:Qs,[Mi.SleepAndNeverWaken]:fi,[Mi.SlipTheFlowOfTime]:Xl,[Mi.SmashStompAndFlatten]:hu,[Mi.SmiteTheLandWithFulmination]:sc,[Mi.SmotheringInfestation]:zr,[Mi.SocietyDissolvesAtTheBeckoningHeart]:sh,[Mi.SoftlyBeckonEverInward]:oh,[Mi.SolidifyEchoesOfMajestyPast]:Ni,[Mi.SongOfSanctity]:vs,[Mi.SpillBitternessIntoTheEarth]:pi,[Mi.SpiritsMayYetDream]:Od,[Mi.SpreadingAndDreadfulMire]:Wl,[Mi.SpreadingWilds]:Yc,[Mi.SpurOnWithWordsOfFire]:Ks,[Mi.StarsBlazeInTheDaytimeSky]:Nh,[Mi.SteamVents]:As,[Mi.StemTheFlowOfFreshWater]:Kd,[Mi.StingingSandstorm]:kl,[Mi.Stormswath]:wi,[Mi.StranglingFirevine]:Qr,[Mi.StrengthOfTheWakingIsland]:wl,[Mi.StretchOutCoilsOfForebodingDread]:Cc,[Mi.StrikeLowWithSuddenFevers]:tu,[Mi.StrongAndConstantCurrents]:ld,[Mi.StubbornSolidity]:Uh,[Mi.StudyTheInvadersFears]:xh,[Mi.SuckingOoze]:hd,[Mi.SuddenAmbush]:Fc,[Mi.SuffocatingShroud]:Ph,[Mi.SunsetsFireFlowsAcrossTheLand]:ud,[Mi.SurgingLahar]:uu,[Mi.SurroundedByTheDahan]:Wu,[Mi.SwallowTheLanddwellers]:gc,[Mi.SwallowedByTheEndlessDark]:mu,[Mi.SwallowedByTheWilderness]:dh,[Mi.SwarmingWasps]:Xs,[Mi.SweepIntoTheSea]:Kr,[Mi.SwelteringExhaustion]:Ll,[Mi.SwirlAndSpill]:rg,[Mi.TalonsOfLightning]:xr,[Mi.TeemingRivers]:Zs,[Mi.TeethGleamFromDarkness]:Hc,[Mi.TempestOfLeavesAndBranches]:Vl,[Mi.TerrifyingChase]:jc,[Mi.TerrifyingNightmares]:br,[Mi.TerrifyingRampage]:gu,[Mi.TerritorialStrife]:gd,[Mi.TerrorOfTheHunted]:vu,[Mi.TerrorTurnsToMadness]:fd,[Mi.TheBurnedLandRegrows]:xl,[Mi.TheFogClosesIn]:Sh,[Mi.TheJungleHungers]:Tr,[Mi.TheLandThrashesInFuriousPain]:Er,[Mi.ThePastReturnsAgain]:eh,[Mi.TheShoreSeethesWithHatred]:pd,[Mi.TheTeemingHostArrives]:ph,[Mi.TheTreesAndStonesSpeakOfWar]:Pr,[Mi.TheWoundedWildTurnsOnItsAssailants]:yi,[Mi.ThicketsEruptWithEveryTouchOfBreeze]:mi,[Mi.ThreateningFlames]:bl,[Mi.ThrivingChokefungus]:wd,[Mi.ThunderingDestruction]:oc,[Mi.TidalBoon]:fc,[Mi.TigersHunting]:Xr,[Mi.TooNearTheJungle]:Uc,[Mi.TormentingRotflies]:eo,[Mi.ToweringWrath]:zc,[Mi.TransformToAMurderousDarkness]:vi,[Mi.TransformativeSacrifice]:$i,[Mi.TravelersBoon]:dl,[Mi.TreacherousWaterways]:yd,[Mi.TreesRadiateCelestialBrilliance]:Ai,[Mi.Tsunami]:Sr,[Mi.TurmoilsTouch]:Qu,[Mi.TwilightFogBringsMadness]:ao,[Mi.TwistPerceptions]:Ku,[Mi.TwistedFlowersMurmurUltimatums]:Zr,[Mi.UnbearableDeluge]:el,[Mi.UnbearableGaze]:ku,[Mi.UnbelievableRegrowth]:Xd,[Mi.UncannyMelting]:Is,[Mi.UnearthABeastOfWrathfulStone]:ji,[Mi.UnexpectedTigers]:Yh,[Mi.UnleashATorrentOfTheSelfsOwnEssence]:Ii,[Mi.UnlockTheGatesOfDeepestPower]:ei,[Mi.UnnervingPall]:Oh,[Mi.UnquenchableFlames]:md,[Mi.UnrelentingGrowth]:ai,[Mi.UtterACurseOfDreadAndBone]:xi,[Mi.VanishSoftlyAwayForgottenByAll]:bi,[Mi.VeilTheNightsHunt]:xs,[Mi.VengeanceOfTheDead]:Or,[Mi.VigorOfTheBreakingDawn]:Dr,[Mi.ViolentWindstorms]:Yl,[Mi.VisionsOfAShiftingFuture]:ah,[Mi.VisionsOfFieryDoom]:bs,[Mi.VoiceOfCommand]:Ti,[Mi.VoiceOfThunder]:Rc,[Mi.VolcanicEruption]:ti,[Mi.VoraciousGrowth]:Ts,[Mi.WallsOfRockAndThorn]:Ei,[Mi.WardTheShores]:Id,[Mi.WarnOfImpendingConflict]:Mu,[Mi.WashAway]:xc,[Mi.WaterEatsAwayTheDeepRootsOfEarth]:pc,[Mi.WaterNourishesLifesGrowth]:al,[Mi.WaysOfShoreAndHeartland]:cl,[Mi.WeaveTogetherTheFabricOfPlace]:Pi,[Mi.WeepForWhatIsLost]:vd,[Mi.WhisperedGuidanceThroughTheNight]:Ol,[Mi.WhyDontYouAndThemFight]:Qh,[Mi.WindsOfRustAndAtrophy]:Br,[Mi.WitherBodiesScarStones]:Lu,[Mi.WoodSeeksGrowthHumansSeekFreedom]:$h,[Mi.WordsOfWarning]:Nc,[Mi.WrackWithPainAndGrief]:ig,[Mi.WrapInWingsOfSunlight]:kr};var og;!function(e){e.HealthyIsland="HealthyIsland",e.BlightedIsland="BlightedIsland"}(og||(og={}));const dg=e=>{let a=0;for(let t=0,n=e.length;t<n;t+=1)a+=e[t];return a},cg=(e,a)=>Math.exp(-e/a),lg=(e,a)=>1-Math.exp(-e/a),hg=(e,a,t)=>{const n=Math.min(Math.max(e,Math.min(a,t)),Math.max(a,t));return a===t?a:Math.abs((n-a)/(t-a))},ug=[wn.ProudAndMightCapital,wn.BuildingBoom,wn.IndenturedServantsEarnLand,wn.HighImmigrationI,wn.HighImmigrationFull,wn.LocalAutonomy,wn.IndependentResolve,wn.SprawlingPlantation,wn.DemandForNewCashCrops,wn.FrontierExplorers,wn.SlaveLabor,wn.TriangleTrade,wn.SlowHealingEcosystem,wn.PersistentExplorers,wn.IrreparableDamage,wn.SeekPrimeTerritory,wn.MigratoryHerders,wn.MoreRuralThanUrban,wn.HerdsThriveInVerdantLands,wn.WaveOfImmigration,wn.FarFlungHerds,wn.LandRush,wn.HuntersSwarmTheIsland,wn.StalkThePredators,wn.HuntersSeekShellAndHide,wn.ASenseForImpendingDisaster,wn.CompetitionAmongHunters,wn.PressureForFastProfit,wn.LandStrippedBare,wn.MiningTunnels,wn.AvariceRewarded,wn.CeaselessMining,wn.MiningBoomI,wn.UntappedSaltDeposits,wn.MiningBoomII,wn.TheEmpireAscendant,wn.TradeHub,wn.PortsSprawlOutward,wn.TradingPort,wn.ChartTheCoastline,wn.RunoffAndBilgewater,wn.ExportsFuelInwardGrowth,wn.SwayedByTheInvaders,wn.HeavyMining,wn.FineSteelForToolsAndGuns,wn.RoyalBacking,wn.MiningRush,wn.ShadowsPartake,wn.Immense,wn.Travel,wn.Madness,wn.Reach,wn.Resilience,wn.DarkFire,wn.Encircle,wn.Intensify,wn.Lair,wn.Locus,wn.Mentor,wn.Nourishing,wn.Regrowth,wn.SpreadingHostility,wn.Stranded,wn.Tactician,wn.Transforming,wn.Unconstrained,wn.Violence,wn.Warrior,wn.DownwardSpiral,wn.MemoryFadesToDust,wn.BackAgainstTheWall,wn.AllThingsWeaken,wn.PowerCorrodesTheSpirit,wn.UntendedLandCrumbles,wn.AttenuatedEssence,wn.BlightCorrodesTheSpirit,wn.IntensifyingExploitation,wn.TheBorderOfLifeAndDeath,wn.RoilingWaters,wn.SereneWaters,wn.DreamOfTheUntouchedLand,wn.BargainsOfPowerAndProtection,wn.BargainsOfCoursingPath,wn.Bringer,wn.Earth,wn.GreenChokeTheLandWithGreen,wn.GreenSteadyRegeneration,wn.Lightning,wn.Ocean,wn.River,wn.Shadows,wn.Thunderspeaker,wn.FangsAllyOfTheBeasts,wn.FangsCallForthPredators,wn.Keeper,wn.Downpour,wn.Finder,wn.Serpent,wn.Wildfire,wn.Eyes,wn.Heat,wn.Mud,wn.Teeth,wn.Whirlwind,wn.Fractured,wn.LureHomeOfTheIslandsHeart,wn.LureEnthrallTheForeignExplorers,wn.ManyMinds,wn.MemoryKnowledge,wn.MemoryInsight,wn.ShroudGatherPowerFromTheCoolAndDark,wn.ShroudMistsShiftAndFlow,wn.SlowAndSilentDeath,wn.Starlight,wn.Stone,wn.Trickster,wn.Vengeance,wn.Volcano,wn.Behemoth,wn.Darkness,wn.Earthquakes,wn.Gaze,wn.HearthVigil,wn.Roots,wn.Voice,wn.WoundedSeekingAPathTowardsHealing],gg={[Wi.Setup]:0,[Wi.SetupPresence]:0,[Wi.InitialExplore]:0,[Wi.RoyalBacking]:0,[Wi.Grow]:0,[Wi.GainEnergy]:0,[Wi.PlayPowers]:0,[Wi.FastPowers]:0,[Wi.BlightedIsland]:.5,[Wi.Event]:.5,[Wi.Fear]:.5,[Wi.HighImmigration]:.5,[Wi.Ravage]:.5,[Wi.Build]:.5,[Wi.Explore]:.5,[Wi.AdvanceCards]:.5,[Wi.SlowPowers]:1,[Wi.TimePasses]:1},fg={[Qn.City]:1,[Qn.Town]:.5};class pg{static inputNames=["Blight lost, healthy island","Blight lost, blighted island","Slow healing blight","Capital size","Coastal lands with cities","Max towns allowed","Fear","Terror level","Stage","Turn","Phase",...["1","2","3","4","5","6","7","8"].flatMap((e=>["Building","Ravaging","Strength","Health","Coastalness","Badlands","Blight","Cities","Dahan","Disease","Explorers","Presence","Towns","Vitality","Wilds","Defense","Incarna","Presence","Adjacent Presence","Adjacent Buildings"].map((a=>`${e}: ${a}`)))),"Energy","Energy Income","Cardplays","Destroyed Presence","Absorbed Presence","Presence in Ocean","Incarna","Empowered Incarna","Sun Elements","Moon Elements","Fire Elements","Air Elements","Water Elements","Earth Elements","Plant Elements","Animal Elements","Minor Powers","Major Powers","Forgotten Uniques","Number of discarded cards",...ug,...Object.keys(sg)];static getInputs(e,a){const{effectIds:t,startingBlight:n,fearCardsInLevelCount:r,fearPool:i,currentFear:s}=e,o=e.spirits[a],d=o.startingBoard,c=o.elements,l=e.invaderCardsInVisibleSlot(Zl.Build),h=e.invaderCardsInVisibleSlot(Zl.Ravage);return[e.blightStatus===og.HealthyIsland?hg(e.blightOnBlightCard,n,0):0,e.blightStatus===og.BlightedIsland?hg(e.blightOnBlightCard,tr[e.blightCardActive].blightPerPlayer*e.spiritCount,0):0,hg(e.slowHealingBlight,0,3),hg(e.capitalSize,0,7),hg(e.coastalLandsWithCities,0,2*e.boardCount+1),hg(e.townsCount,0,e.maxTownsAllowed+1),cg(dg(r)*i-s,30),hg(e.terrorLevel,1,3),hg(e.stage,1,3),lg(e.turn,5),gg[e.phase],...d.locations.flatMap((e=>e.type===jo.Ocean?[]:[l.some((a=>e.matchesInvaderCard(a,Hr.Build)))?fg[e.buildPlans]:0,h.some((a=>e.matchesInvaderCard(a,Hr.Ravage)))?1:0,lg(e.invaders().where((e=>0===e.strife&&!e.doesNotParticipateInRavage)).sum((e=>e.strengthDuringRavage)),2),lg(e.invaders().where((e=>0===e.strife&&!e.doesNotParticipateInRavage)).sum((e=>e.health)),2),e.isCoastal?1:0,...[Qn.Badlands,Qn.Blight,Qn.City,Qn.Dahan,Qn.Disease,Qn.Explorer,Qn.Presence,Qn.Town,Qn.Vitality,Qn.Wilds].map((a=>lg(e.numberOf(a),1))),lg(e.defense,3),e.hasIncarnaOf(o)?1:0,lg(e.numberOfPresenceOf(o),1),lg(e.numberOfPiecesInAdjacentLands(Qn.Presence),1),lg(e.numberOfPiecesInAdjacentLands(Qn.TownOrCity),1)])),lg(o.energy,5),lg(o.trackEnergy,3),hg(o.cardPlays,1,6),lg(o.destroyedPresence,1),hg(o.absorbedPresence.length,0,6),lg(d.ocean.numberOfPresenceOf(o),1),o.hasIncarna?1:0,o.hasEmpoweredIncarna?1:0,...[nr.Sun,nr.Moon,nr.Fire,nr.Air,nr.Water,nr.Earth,nr.Plant,nr.Animal].map((e=>lg(c[e],2))),lg(Jo(o.powers,(e=>e.isA(En.Minor))),2),lg(Jo(o.powers,(e=>e.isA(En.Major))),2),cg(Jo(o.powers,(e=>e.isA(En.Unique))),2),1-o.numberOfPowerCardsInHand/o.numberOfPowerCards,...ug.map((e=>t.includes(e)?1:0)),...Object.keys(sg).map((e=>o.hasPower(e)?1:0))]}}var wg,yg;function mg(e,a,t=" "){if(e.length>=a)return e;const n=a-e.length;return t.repeat(n)+e}!function(e){e.BrandenburgPrussia="BrandenburgPrussia",e.Sweden="Sweden",e.England="England",e.France="France",e.Scotland="Scotland",e.Habsburg="Habsburg",e.Russia="Russia",e.Saltburg="Saltburg"}(wg||(wg={})),function(e){e.Covered="Covered",e.Uncovered="Uncovered",e.UncoveredPlayed="UncoveredPlayed"}(yg||(yg={}));class vg{static weights={absorbedPresence:1.5,badlandsWithInvaders:.38,bargainEffects:2,beneficialPiecesInOcean:-1,blightLeft:2.5,blightLeftImportant:2.8,boardsWithLessThanFiveDahan:-.6,boardsWithLessThanFourDahan:-1.2,boardsWithLessThanSixDahan:-1.2,cityBuildingLands:-2,coastalLandsWithThieves:-2,coastalLandsWithWarding:3,damage:.1,destroyedSerpentPresence:1,discardedCards:-.1,earnedFearCardsAtTL1:1,earnedFearCardsAtTL2:3,earnedFearCardsAtTL3:5,elementsInCorners:1,emptyLands:.3,energy:.09,energyMismatch:-.2,explorersLeftAtTL1:-1,explorersLeftBeyondTL1:-.5,fearLeft:-1.5,fearPool:0,floodedLands:5,highImmigrationLands:-1,islandIsBlighted:-9.375,landsAdjacentToFlameMarker:1,landsAdjacentToPresence:.3,landsAdjacentToSacredSite:.4,landsWithBuildings:0,landsWithCities:0,landsWithConvertableDahan:-1,landsWithDahanAndInvader:.1275,landsWithExplorersAndBeasts:.75,landsWithInvaders:-.2,landsWithInvadersAndDisease:.51,landsWithPresence:.4,landsWithSacredSite:.51,landsWithTwoDahan:.19,landsWithTwoDahanAndInvader:.3,majorPowerCards:5.625,minPresenceOnIsland:1.5,minPresenceOnIslandDuringDownwardSpiral:4,minorPowerCards:2.1,numberOfBadLands:1,numberOfBeasts:.4,numberOfBlight:-1,numberOfCardsInExploreDeck:2,numberOfCities:-4,numberOfDahan:1,numberOfDeeps:.5,numberOfDisease:.4,numberOfOmen:-2.5,numberOfQuake:.3,numberOfThieves:-1,numberOfVitality:.8,numberOfWardingPattern:2,numberOfWilds:.8,preparedElements:.2,presenceOnIsland:.1,quakesWithBuildings:.3,ravagingLandsNoBlightBlighted:-1.6,ravagingLandsNoBlightHealthy:-1,ravagingLandsWithBlightBlighted:-3.2,ravagingLandsWithBlightHealthy:-2,spiritsWithAtLeast1Dahan:.2,spiritsWithAtLeast2Dahan:1.3,spiritsWithAtLeast3Dahan:1.2,spiritsWithAtLeast4Dahan:.5,stage:0,strifeHealth:.3,sumEnergyCostOfCards:0,terrorLevel:1,townBuildingLandsAtTL3:-.75,townBuildingLandsBeforeTL3:-1.5,townsLeftAtTL3:-1,townsLeftBeforeTL3:-2,uncoveredPresence:3,uniquePowerCards:2.8};lastValue={};static extractFeatures(e){const{blightOnBlightCard:a,blightCardActive:t,blightStatus:r,currentFear:i,fearCardsEarned:s,fearCardsInLevelCount:o,fearPool:d,pieceCount:c,spiritCount:l,spirits:h,stage:u,terrorLevel:g,invaderCardsInExploreDeck:f}=e,p=Math.min(_o(h,(e=>e.presence().count)),4)*l,w=Uo(h,(e=>e.presence().count)),y=t&&[Zn.BlightCorrodesTheSpirit,Zn.DownwardSpiral,Zn.MemoryFadesToDust,Zn.SlowDissolutionOfWill,Zn.UntendedLandCrumbles].includes(t)?p:0,m=e.spirits.find((e=>e.spirit===n.Serpent)),v=m?m.absorbedPresence.length:0,A=m?m.destroyedPresence:0,I=e.spirits.find((e=>e.spirit===n.Memory)),x=I?dg(Object.values(I.preparedElements)):0;let b=0;for(const a of e.invaderCardsInSlot(Zl.HighImmigration))null!==a&&(b+=e.inLandsWhere((e=>e.matchesInvaderCard(a,Hr.Build)&&(e.has(Qn.Invader)||e.buildCardsAffectLandsWithoutInvaders))).count);let T=0;e.adversaryLeading?.adversary===wg.Sweden&&e.stage<=2&&(T+=e.inLandsWhere((e=>e.hasDahan&&e.numberOfDahan<=e.numberOfInvaders+1)).count);let E=0;for(const a of e.invaderCardsInVisibleSlot(Zl.Build))E+=e.inLandsWhere((e=>e.matchesInvaderCard(a,Hr.Build)&&e.buildPlans===Qn.City&&!e.has(Qn.Disease)&&(e.has(Qn.Invader)||e.buildCardsAffectLandsWithoutInvaders))).count;let P=0;for(const a of e.invaderCardsInVisibleSlot(Zl.Build))P+=e.inLandsWhere((e=>e.matchesInvaderCard(a,Hr.Build)&&e.buildPlans===Qn.Town&&!e.has(Qn.Disease)&&(e.has(Qn.Invader)||e.buildCardsAffectLandsWithoutInvaders))).count;let S=0,O=0;for(const a of e.invaderCardsInVisibleSlot(Zl.Ravage)){const t=e.inLandsWhere((e=>e.matchesInvaderCard(a,Hr.Ravage)&&e.invaders().where((e=>0===e.strife&&!e.doesNotParticipateInRavage)).sum((e=>e.strengthDuringRavage))>=2));O+=t.copy().where((e=>!e.hasBlight&&!e.has(Qn.Vitality))).count,S+=t.copy().where((e=>e.hasBlight&&!e.has(Qn.Vitality))).count}const C=r===og.BlightedIsland?O:0,D=r===og.HealthyIsland?O:0,B=r===og.BlightedIsland?S:0,k=r===og.HealthyIsland?S:0,L=dg(h.map((e=>e.lands.length))),F=dg(h.map((e=>this.spiritCaresAboutSacredSite(e)?e.numberOfSacredSites:1))),R=dg(h.map((a=>e.inLandsWhere((e=>e.hasPresenceOf(a)||e.hasAdjacentPresenceOf([a]))).count))),N=e.effectsOfType(yn.EnergyDebt).length,$=e.inLandsWhere((e=>e.hasDahan&&e.hasInvaders)).count,W=e.inLandsWhere((e=>e.numberOfDahan>=2&&e.hasInvaders)).count,M=e.inLandsWhere((e=>e.numberOfDahan>=2)).count;let G=0,H=0,j=0,U=0;e.spirits.forEach((e=>{const a=e.numberOfPiecesInLands(Qn.Dahan);a>=1&&(G+=1),a>=2&&(H+=1),a>=3&&(j+=1),a>=4&&(U+=1)}));let q=0,_=0,J=0;e.boards.forEach((e=>{e.numberOf(Qn.Dahan)<6&&(J+=1),e.numberOf(Qn.Dahan)<5&&(q+=1),e.numberOf(Qn.Dahan)<4&&(_+=1)}));const V=dg(h.map((a=>this.spiritCaresAboutSacredSite(a)?e.inLandsWhere((e=>e.hasSacredSiteOf(a)||e.hasAdjacentLandWhere((e=>e.hasSacredSiteOf(a))))).count:5))),Y=e.scenario===Rd.RitualsOfTheDestroyingFlame?e.inLandsWithOrAdjacentTo(Qn.FlameMarker).count:0,z=e.scenario===Rd.WardTheShores?e.inCoastalLands().numberOf((e=>e.has(Qn.WardingPattern))):0,Q=e.scenario===Rd.DespicableTheft?e.inCoastalLands().sum((e=>e.numberOf(Qn.Thief))):0,K=e.scenario===Rd.ElementalInvocation?e.inCornersWhere((e=>void 0!==e.element)).count:0,X=Uo(h,(e=>Jo(e.trackStatus,(e=>e!==yg.Covered)))),Z=Uo(h,(e=>e.powersWhere((e=>e.isA(En.Major))).count)),ee=Uo(h,(e=>e.powersWhere((e=>e.isA(En.Minor))).count)),ae=Uo(h,(e=>e.powersWhere((e=>e.isA(En.Unique))).count)),te=Uo(h,(e=>Math.abs(e.cardPlays*e.averageEnergyCost-e.trackEnergy))),ne=Uo(h,(e=>e.powersWhere((e=>e.isInDiscard)).count)),re=Uo(h,(e=>dg(e.powers.map((e=>e.costToPlay))))),ie=Uo(h,(e=>e.energy)),se=r===og.HealthyIsland?0:1,oe=a,de=Math.min(se?oe:3*l,3*l),ce=dg(o)*d-i,le=1===g?s.length*l:0,he=2===g?s.length*l:0,ue=3===g?s.length*l:0,ge=f.length*l,[fe,pe,we,ye,me,ve,Ae,Ie,xe,be,Te,Ee,Pe,Se,Oe]=[Bn.Badlands,Bn.Beasts,Bn.Blight,Bn.City,Bn.Dahan,Bn.Deeps,Bn.Disease,Bn.Explorer,Bn.Omen,Bn.Quake,Bn.Thief,Bn.Town,Bn.Vitality,Bn.WardingPattern,Bn.Wilds].map((e=>c[e]||0)),Ce=e.forPieces().sum((e=>e.strife?e.baseHealth:0)),De=e.inOceans().sum((e=>e.piecesWhere((e=>e.isOneOf(Qn.BadlandsBeastsDiseaseOrWilds,Qn.Deeps,Qn.Quake))).count)),Be=e.inLandsWhere((e=>e.hasInvaders&&e.has(Qn.Disease))).count,ke=e.inLandsWhere((e=>e.hasInvaders&&e.has(Qn.Badlands))).sum((e=>e.numberOf(Qn.Badlands))),Le=e.inLandsWhere((e=>e.has(Qn.Quake)&&e.hasTownsOrCities)).sum((e=>e.numberOf(Qn.Quake))),Fe=e.inLandsWhere((e=>e.has(Qn.Explorer)&&e.has(Qn.Beasts))).count,Re=e.inLandsWhere((e=>e.isFlooded)).count,Ne=1===g?Ie:0,$e=g>1?Ie:0,We=g<3?Ee:0,Me=3===g?Ee:0,Ge=g<3?P:0,He=3===g?P:0,je=e.inLandsWhere((e=>!e.hasTownsOrCities)).count,Ue=e.inLandsWhere((e=>e.hasTownsOrCities)).count,qe=e.inLandsWhere((e=>e.hasCity)).count,_e=e.inLandsWhere((e=>e.hasInvaders)).count,Je=dg(e.pieces.map((e=>e.damage)));return{absorbedPresence:v,badlandsWithInvaders:ke,bargainEffects:N,beneficialPiecesInOcean:De,blightLeft:oe,blightLeftImportant:de,boardsWithLessThanFiveDahan:q,boardsWithLessThanFourDahan:_,boardsWithLessThanSixDahan:J,cityBuildingLands:E,coastalLandsWithThieves:Q,coastalLandsWithWarding:z,damage:Je,destroyedSerpentPresence:A,discardedCards:ne,earnedFearCardsAtTL1:le,earnedFearCardsAtTL2:he,earnedFearCardsAtTL3:ue,elementsInCorners:K,emptyLands:je,energy:ie,energyMismatch:te,explorersLeftAtTL1:Ne,explorersLeftBeyondTL1:$e,fearLeft:ce,fearPool:d,floodedLands:Re,highImmigrationLands:b,islandIsBlighted:se,landsAdjacentToFlameMarker:Y,landsAdjacentToPresence:R,landsAdjacentToSacredSite:V,landsWithBuildings:Ue,landsWithCities:qe,landsWithConvertableDahan:T,landsWithDahanAndInvader:$,landsWithExplorersAndBeasts:Fe,landsWithInvaders:_e,landsWithInvadersAndDisease:Be,landsWithPresence:L,landsWithSacredSite:F,landsWithTwoDahan:M,landsWithTwoDahanAndInvader:W,majorPowerCards:Z,minPresenceOnIsland:p,minPresenceOnIslandDuringDownwardSpiral:y,minorPowerCards:ee,numberOfBadLands:fe,numberOfBeasts:pe,numberOfBlight:we,numberOfCardsInExploreDeck:ge,numberOfCities:ye,numberOfDahan:me,numberOfDeeps:ve,numberOfDisease:Ae,numberOfOmen:xe,numberOfQuake:be,numberOfThieves:Te,numberOfVitality:Pe,numberOfWardingPattern:Se,numberOfWilds:Oe,preparedElements:x,presenceOnIsland:w,quakesWithBuildings:Le,ravagingLandsNoBlightBlighted:C,ravagingLandsNoBlightHealthy:D,ravagingLandsWithBlightBlighted:B,ravagingLandsWithBlightHealthy:k,spiritsWithAtLeast1Dahan:G,spiritsWithAtLeast2Dahan:H,spiritsWithAtLeast3Dahan:j,spiritsWithAtLeast4Dahan:U,stage:u,strifeHealth:Ce,sumEnergyCostOfCards:re,terrorLevel:g,townBuildingLandsAtTL3:He,townBuildingLandsBeforeTL3:Ge,townsLeftAtTL3:Me,townsLeftBeforeTL3:We,uncoveredPresence:X,uniquePowerCards:ae}}estimateValue(e,a=!1,t){const n=vg.extractFeatures(e),r=t||vg.weights;let i=0;for(const[e,t]of Object.entries(n))a&&this.row(e,r[e]??0,t),i+=(r[e]??0)*t;return i/=e.spiritCount,Promise.resolve(i)}async estimateValueWithReward(e,a=!1,t){let n=await this.estimateValue(e,a,t);return n+=1e3*this.reward(e),Promise.resolve(n)}reward(e){const{winReason:a,lostReason:t}=e;return void 0!==a?1:void 0!==t?-1:0}static spiritCaresAboutSacredSite(e){return void 0!==e.powers.find((e=>e.data.sourceFilter?.includes(sr.SacredSite)||e.data.sourceFilter?.includes(sr.SacredSiteAndDahan)))}row(e,a,t){const n=this.lastValue[e]??null,r=a*t;console.log(`${mg(e,34)} | ${mg(""+Math.round(10*a)/10,5)} | ${mg(""+Math.round(10*t)/10,5)} | ${mg(`${r.toFixed(2)}`,6)} | ${null!==n?mg(`${(r-n).toFixed(2)}`,6):""}`),this.lastValue[e]=r}}var Ag=function(e,a,t,n){var r,i=arguments.length,s=i<3?a:null===n?n=Object.getOwnPropertyDescriptor(a,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,a,t,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(i<3?r(s):i>3?r(a,t,s):r(a,t))||s);return i>3&&s&&Object.defineProperty(a,t,s),s};class Ig{$;cardMap={};deck;stacked;unused;constructor(e,a){Xo.makeObservable(this),this.$=e,this.unused=a?a.slice():[],this.deck=this.unused.map((()=>[])),this.stacked=[]}get cardAt(){return e=>{if(e>=this.deck.length)return null;if(1===this.deck[e].length){const a=this.deck[e][0];if("number"!=typeof a)return a}return null}}get cards(){return this.deck.map(((e,a)=>this.cardAt(a)))}get count(){return this.deck.length}get hasRevealed(){return e=>!this.includes(e)||this.deck.some((a=>1===a.length&&a[0]===e||a.some((a=>a===e))&&a.some((e=>"number"==typeof e))))}get includes(){return e=>this.deck.some((a=>a.includes(e)))||this.unused.includes(e)}get isEmpty(){return 0===this.count}get possibleCards(){return this.deck.map(((e,a)=>this.possibleCardsAt(a)))}get possibleCardsAt(){return e=>{if(e>=this.deck.length)return[];if(0===this.deck[e].length)return[...this.unused];{const a=[...this.deck[e]];for(;;){const e=a.findIndex((e=>"number"==typeof e));if(e<0)break;const t=a[e],n=this.cardMap[t];a.splice(e,1,...n&&n.length>0?n:this.unused)}return Cr(a)}}}get unusedCards(){return this.unused}addStackedCard(e){this.stacked.push(e)}async draw(e=0){await this.reveal(e);const[a]=this.deck.splice(e,1);return void 0!==a?a[0]:void 0}async drawFromBottom(){await this.reveal(this.count-1);const e=this.deck.pop();return void 0!==e?e[0]:void 0}insert(e,a=0){this.insertOneOf([e],a)}insertAtBottom(e){this.insertOneOf([e],this.count)}insertAtBottomOneOf(e){this.insertOneOf(e,this.count)}insertOneOf(e,a=0){this.deck.splice(a,0,e)}putBottomCardToTop(){const e=this.removeCard(this.deck.length-1);void 0!==e&&this.insertOneOf(e)}remove(e){if("number"!=typeof e){const a=this.unused.indexOf(e);a>=0&&this.unused.splice(a,1)}Object.values(this.cardMap).forEach((a=>{const t=a.indexOf(e);t>=0&&a.splice(t,1)})),this.deck.forEach((a=>{const t=a.indexOf(e);t>=0&&a.splice(t,1)}))}removeCard(e){if(e<this.deck.length){const[a]=this.deck.splice(e,1);return a}}async reveal(e){if(e<this.deck.length){const a=this.possibleCardsAt(e);this.$.config.controlledFate&&a.length>1&&await this.$.addEffect({[yn.Now]:async()=>{const e=await this.$.query({name:"Controlled Fate",text:"Select Card",query:pn.SelectCard,items:a,actionIds:a.map((e=>`Fate-${e}`))});this.addStackedCard(a[e])}});const t=this.stacked.length>0&&a.includes(this.stacked[0]);let n=await this.getCardFromPossibilities(this.deck[e],t);return await Ha((async()=>{for(this.deck[e].length=0,this.remove(n);"number"==typeof n;){const e=await this.getCardFromPossibilities(this.cardMap[n],t);delete this.cardMap[n],this.remove(e),n=e}this.deck[e].push(n)})),n}return null}async shuffleTopNCards(e,a){if(a){const a=[this.deck[e[0]][0]];for(let t=1;t<e.length;t+=1){let n=0;for(;n in this.cardMap;)n+=1;this.cardMap[n]=this.deck[e[t]],a.push(n)}for(let t=0;t<e.length;t+=1)this.deck[e[t]]=[...a]}else{let a=e.map((e=>this.deck[e]));this.$.config.controlledFate?await this.$.may({name:"Controlled Fate",text:"Reverse order?"},!0)&&(a=a.reverse()):a=this.$.shuffle(a);for(let t=0;t<e.length;t+=1)this.deck.splice(e[t],1,a[t])}}get getCardFromPossibilities(){return(e,a)=>{const t=e.length;if(1===t)return Promise.resolve(e[0]);if(0===t)return a&&this.unused.includes(this.stacked[0])?Promise.resolve(this.stacked.shift()):this.$.drawFrom(this.unused,[]);if(a){if(e.includes(this.stacked[0]))return Promise.resolve(this.stacked.shift());{const a=e.find((e=>"number"==typeof e));if(void 0!==a)return Promise.resolve(a)}}return Promise.resolve(this.$.randomFromArray(e))}}}Ag([Re],Ig.prototype,"deck",void 0);const xg=Object.keys(a),bg=(e,a=1)=>{let t="\n";return Object.entries(e).forEach((([n,r],i)=>{for(let e=0;e<a;e+=1)t+="  ";t+=`${n}: ${null!=r?r:"None"}`,i<Object.entries(e).length-1&&(t+="\n")})),t};var Tg=function(e,a,t,n){var r,i=arguments.length,s=i<3?a:null===n?n=Object.getOwnPropertyDescriptor(a,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,a,t,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(i<3?r(s):i>3?r(a,t,s):r(a,t))||s);return i>3&&s&&Object.defineProperty(a,t,s),s};class Eg{blightCardActive;blightCardsInDeck;blightCardsInDiscard=[];blightOnBlightCard=0;blightPool=0;revealedBlightCards=0;slowHealingBlight=0;static allBlightCards=Object.keys(tr).filter((e=>!tr[e].banned));$;currentBlightCardEffect;constructor(e){Xo.makeObservable(this),this.$=e;const a=this.$.playingWithCommandBeasts,t=e.config.sets??xg;this.blightCardsInDeck=new Ig(e,(t.length===xg.length?Eg.allBlightCards:Eg.allBlightCards.filter((e=>t.includes(tr[e].set)))).filter((e=>!a||!tr[e].requireEvents))),this.blightOnBlightCard=this.startingBlight}get blightStatus(){return this.blightCardData&&!this.blightCardData.stillHealthy?og.BlightedIsland:og.HealthyIsland}get startingBlight(){return this.$.config.boards.length*(this.$.config.blightCards?2:5)+1}get willTakeFromBlightPool(){return this.revealedBlightCards>0}async addBlightToBlightCard(e){e>0&&(this.blightOnBlightCard+=e,await this.$.sendEvent({type:fn.BlightAdded,amount:e}))}addBlightToBlightPool(e){return e>0&&(this.blightPool+=e),Promise.resolve()}addOneToRevealedBlightCards(){this.revealedBlightCards+=1}async addSlowHealingBlight(e){this.slowHealingBlight+=e,await this.$.sendEvent({type:fn.SlowHealingBlightAdded,amount:e}),await this.$.doEffects(yn.AfterAddingSlowHealingBlight)}discardBlightCard(e){return this.blightCardsInDeck.remove(e),this.blightCardsInDiscard.push(e),Promise.resolve()}async removeBlightFromBlightCard(e,a){await _r(e,(async()=>{if(this.blightOnBlightCard>0){if(await this.$.oneEffectActivates(yn.PreventRemoveBlightFromBlightCard,{location:a}))return;this.blightOnBlightCard-=1,await this.$.sendEvent({type:fn.BlightRemoved,amount:1})}0===this.blightOnBlightCard&&this.blightStatus===og.HealthyIsland&&this.$.config.blightCards&&await this.drawNewBlightCard()}))}removeBlightFromBlightPool(e){return e>0&&(this.blightPool=Math.max(this.blightPool-e,0)),Promise.resolve()}removeSlowHealingBlight(e){return this.slowHealingBlight=Math.max(this.slowHealingBlight-e,0),Promise.resolve()}toString(){return bg({blightCardsInDeck:this.blightCardsInDeck.count,blightCardActive:this.blightCardActive??"None",blightCardsInDiscard:Vo(this.blightCardsInDiscard,(e=>e)),blightOnBlightCard:this.blightOnBlightCard,blightPool:this.blightPool},2)}get blightCardData(){return void 0!==this.blightCardActive?tr[this.blightCardActive]:void 0}async drawNewBlightCard(){if(this.blightCardsInDeck.count>0){this.currentBlightCardEffect&&(this.$.removeEffectsWithName(this.currentBlightCardEffect.name),this.currentBlightCardEffect=void 0);const e=await this.blightCardsInDeck.draw();this.blightCardActive&&this.blightCardsInDiscard.push(this.blightCardActive),this.blightCardActive=e,await this.$.sendEvent({type:fn.BlightCardFlipped,blightCard:e});const a={...tr[e],card:e};if(this.willTakeFromBlightPool){const e=Math.min(this.blightPool,a.blightPerPlayer*this.$.boardCount);this.blightPool-=e,this.blightOnBlightCard+=e,this.revealedBlightCards-=1,0===this.revealedBlightCards&&(this.blightOnBlightCard+=this.blightPool,this.blightPool=0)}else this.blightOnBlightCard+=a.blightPerPlayer*this.$.boardCount;await this.$.doEffects(yn.BeforeRevealingBlightCard,{blightCard:e}),await this.$.query({query:pn.ClickToContinueCard,items:[e],actionIds:[e]}),await this.$.addEffect({name:a.name,text:`${a.name} drawn.<br><br>When playing solo, if you get a Blight Card which has only 2 Blight per player, you may choose to draw a random replacement.`,card:this.blightCardActive,[yn.Now]:async()=>{await this.$.chooseBetween({autoPlayOneOption:!0,effects:[{actionId:"Keep",text:`Keep ${a.name}.`,[yn.Now]:async()=>{this.currentBlightCardEffect=a,await this.$.addEffect(a),await this.$.doEffects(yn.AfterDrawingBlightCard,{blightCard:e})}},{actionId:"DrawNew",text:"Draw a new blight card.",[yn.Now]:async()=>{this.blightOnBlightCard=0,await this.drawNewBlightCard()},condition:()=>1===this.$.spiritCount&&!a.stillHealthy&&2===a.blightPerPlayer}]})}}),0===this.blightOnBlightCard&&this.blightStatus===og.HealthyIsland&&this.$.config.blightCards&&await this.drawNewBlightCard()}}}Tg([Re],Eg.prototype,"blightCardActive",void 0),Tg([Re],Eg.prototype,"blightCardsInDeck",void 0),Tg([Re],Eg.prototype,"blightCardsInDiscard",void 0),Tg([Re],Eg.prototype,"blightOnBlightCard",void 0),Tg([Re],Eg.prototype,"blightPool",void 0),Tg([Re],Eg.prototype,"revealedBlightCards",void 0),Tg([Re],Eg.prototype,"slowHealingBlight",void 0);const Pg={set:a.BranchAndClaw,banned:!0,name:"A Strange Madness Among The Beasts",events:[{name:"A Strange Madness Among the Beasts",fullText:["&nbsp;&nbsp;They grow even wilder and more savage. You may:","Let them Rampage unto Death","&nbsp;&nbsp;• Each <beasts> destroys 1 <dahan>.","&nbsp;&nbsp;• Remove 1 <beasts> from each board.","Guide the Madness","&nbsp;&nbsp;Cost: 3 Energy per <beasts> you decide to keep on the Island (min 3 Energy). Aided by <animal>","&nbsp;&nbsp;• Remove any number of <beasts>.","&nbsp;&nbsp;• Each Spirit may Push 1 <beasts> to an adjacent land."],effects:[{textArea:[.168,.521],text:"You may:<br><br>Let them Rampage unto Death <or>Guide the Madness",[yn.Now]:async({$:e})=>{await e.chooseBetween({effects:[{actionId:"RampageUntoDeath",label:"Let them Rampage unto Death",effects:[{textArea:[.213,.253],text:"Each <beasts> destroys 1 <dahan>.",[yn.Now]:async()=>{await e.inLandsWithAllOf(e.Beasts,e.Dahan).selectOrder().forEach((async a=>{await e.doMainEventAction((async()=>{e.dontCountAs(Bn.Beasts),await a.destroy({amount:a.numberOf(e.Beasts),pieces:e.Dahan})}),{land:a})}),{noOptions:"No lands with <beasts> and <dahan>."})}},{textArea:[.25,.29],text:"Remove 1 <beasts> from each board.",[yn.Now]:()=>e.doMainEventActionOnEachBoard((a=>e.countPieceOnlyIfHavingPiece(Bn.Beasts,(()=>a.forPiecesThatIs(e.Beasts))).pickOne((async e=>{await e.remove()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No <beasts> to remove.`})))}]},{actionId:"GuideTheMadness",label:"Guide the Madness",effects:[{textArea:[.36,.473],text:"Cost: 3 Energy per <beasts> you decide to keep on the Island (min 3 Energy).<br>Aided by <animal>",[yn.Now]:async()=>{await e.doMainEventAction((async()=>{const a=e.forPiecesThatIs(e.Beasts);let t=a.count;for(;!e.playersCanJointlyPayEnergyAidedBy({energy:3*t,element:nr.Animal});)t-=1;for(const e of[!1,!0])await a.pickMultiple({optional:e,amount:a.count-(e?0:t),forPickedItem:async e=>{await e.remove()},effect:{prompt:"Pick <beasts> to remove."}});await e.payEnergyJointlyAidedBy({energy:Math.max(3*a.count,3),element:nr.Animal}),await e.eachSpirit((a=>e.doMainEventAction((()=>e.forPiecesThatIs(e.Beasts).optionallyPickOne((async e=>{await e.push()}),{textArea:[.466,.506],players:[a],text:"Each Spirit may Push 1 <beasts> to an adjacent land.",noOptions:"No lands with <beasts>."})),{spirit:a})))}))}}],condition:()=>e.playersCanJointlyPayEnergyAidedBy({energy:3,element:nr.Animal})}]})}}]},{name:"Savage Frenzy",tokenEvent:!0,effects:[{textArea:[.64,.729],text:"Each <beasts> destroys 1 <explorer> and deals 2 Damage.",[yn.Now]:({$:e})=>e.inLandsWith(e.Beasts).selectOrder().forEach((a=>e.doTokenEventAction((async()=>{await a.destroy({amount:a.numberOf(e.Beasts),pieces:e.Explorer}),await a.damage(2*a.numberOf(e.Beasts))}),{land:a})),{noOptions:"No lands with <beasts>."})}]},{name:"Seek a Safer Home",dahanEvent:!0,effects:[{textArea:[.799,.924],text:"On Each Board: Push 2 <dahan> from a land with <beasts>/<disease>/<wilds> to a land without any of these tokens.",[yn.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((async a=>(await e.countPieceOptionally(Bn.Beasts,(()=>a.inLandsWith(e.Dahan).where((a=>a.hasOneOf(e.Beasts,e.Disease,e.Wilds)&&a.hasAdjacentLandWhere((a=>a.dontHaveAnyOf(e.Beasts,e.Disease,e.Wilds))))).filteredByAnyInPriority((a=>a.hasAtLeast(2,e.Dahan)))))).pickOne((async a=>{await a.push({amount:2,pieces:e.Dahan,together:!0,destinationFilter:a=>a.dontHaveAnyOf(e.Beasts,e.Disease,e.Wilds)})}),{highlightBoards:[a],noOptions:`On board ${a.name}: No applicable lands.`})))}]}]},Sg={name:"Beasts Attack",tokenEvent:!0,effects:[{textArea:[.649,.729],text:"Each <beasts> deals 2 Damage. Remove any token that destroys <town>/<city>.",[yn.Now]:({$:e})=>e.inLandsWithAllOf(e.Beasts,e.Invader).selectOrder().forEach((a=>e.doTokenEventAction((async()=>{await a.possiblyDontCountPiecesAs(Bn.Beasts),await _r(a.numberOf(e.Beasts),(async()=>{(await a.damage(2,e.Invader)).some((a=>pr[a.removement].isDestroyLike&&a.piece.isA(e.TownOrCity)))&&await a.removeOne(e.Beasts)}))}),{land:a})),{noOptions:"No lands with <beasts> and Invaders."})}]},Og={set:a.BranchAndClaw,name:"Cultural Assimilation",events:[{name:"Cultural Assimilation",terrorLevels:[1,2],effects:[{textArea:[.103,.217],text:"On Each Board: In a land with exactly 1 <dahan> that has or is adjacent to a <city>, replace that <dahan> with 1 <town>.",[yn.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>a.forPiecesThatIs(e.Dahan).where((a=>a.location.hasExactly(1,e.Dahan)&&(a.location.has(e.City)||a.location.hasAdjacentLandWhere((a=>a.has(e.City)&&!a.isIsolated))&&!a.location.isIsolated))).pickOne((async e=>{await e.replace([Bn.Town])}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with exactly 1 <dahan> that has or is adjacent to a <city>.`})))}]},{name:"Reprisal Against the Dahan",terrorLevels:[3],effects:[{textArea:[.373,.48],text:"On Each Board: Choose a land with <dahan> and <town>/<city>. Invaders do 3 Damage to <dahan> there, ignoring Defend Powers.",[yn.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>a.inLandsWithAllOf(e.Dahan,e.TownOrCity).pickOne((async a=>{await a.damage(3,e.Dahan)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <dahan> and <town>/<city>.`})))}]},Sg,{name:"Reckless Offensive",dahanEvent:!0,effects:[{textArea:[.79,.939],text:"On Each Board: Choose a land with at least 2 <dahan> and at least 2 <town>/<city>. Each <dahan> destroys 1 <town>/<city>. Add 1 <blight>.",[yn.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((a=>a.inLandsWhere((a=>a.hasAtLeast(2,e.Dahan)&&a.hasAtLeast(2,e.TownOrCity))).pickOne((async a=>{await a.destroy({amount:a.numberOf(e.Dahan),pieces:e.TownOrCity}),await a.addBlight(1)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with at least 2 <dahan> and at least 2 <town>/<city>.`})),{selectOrder:!0})}]}]},Cg={name:"Fierce Mien",dahanEvent:!0,effects:[{textArea:[.821,.905],text:"1 <fear> per land with Invaders where <dahan> outnumber <town>/<city>.",[yn.Now]:async({$:e})=>{const a=e.inLandsWithAllOf(e.Invader,e.Dahan).where((a=>a.the(e.Dahan).outnumber(e.TownOrCity)));await e.clickToContinue({highlightLocations:a.items,noOptions:`${a.count} land${a.count>1?"s":""} = ${a.count} <fear>.`}),await a.forEach((async a=>{await e.doDahanEventAction((async()=>{await a.fear(1)}),{land:a})}),{noOptions:"No lands with Invaders where <dahan> outnumber <town>/<city>"})}}]},Dg={name:"Grim Toll",tokenEvent:!0,effects:[{textArea:[.636,.754],text:"On Each Board: Choose a land with <disease>. In that land, do 2 Damage to Invaders and 2 Damage to <dahan>.",[yn.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((a=>a.inLandsWith(e.Disease).pickOne((async a=>{await a.damage(2),await a.damage(2,e.Dahan)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <disease>.`})),{selectOrder:!0})}]},Bg={set:a.BranchAndClaw,name:"Distant Exploration",events:[{name:"Distant Exploration",terrorLevels:[1],effects:[{textArea:[.107,.284],text:"During the Explore step, Invaders Explore at +1 distance.<br><br>(So a land 2 away from a <town>/<city>/Ocean will be Explored into.)",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.DistantExploration,[yn.ExtraExploreDistance]:()=>!0,[yn.GlobalReminder]:()=>({icon:"<range+1><br>Explore"})})}}]},{name:"Fearful Mobs",terrorLevels:[2,3],effects:[{textArea:[.372,.447],text:"When Ravaging, Invaders do +3 Damage (per land) in lands with 3 or more Invaders.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.FearfulMobs,[yn.AdjustCollectiveInvaderRavageDamage]:({land:e})=>e.participatingInvaders().count>=3?3:0,[yn.GlobalReminder]:()=>({icon:"Ravage<br>+3 <damage>"})})}}]},Dg,Cg]},kg=e=>({name:"New diseases",tokenEvent:!0,effects:[{textArea:e?[.797,.939]:[.615,.76],text:"On half of the boards (rounding up), add 1 <disease> to a land with both <dahan> and Invaders. Do 2 Damage to <dahan> there.",[yn.Now]:({$:e})=>e.inBoards().pickMultiple({amount:Math.ceil(e.boards.length/2),forPickedItem:a=>e.doTokenEventAction((()=>a.inLandsWithAllOf(e.Dahan,e.Invader).pickOne((async a=>{await a.add(1,e.Disease),await a.damage(2,e.Dahan)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with both <dahan> and Invaders.`})),{board:a}),effect:{prompt:"Pick board to add <disease>."}})}]}),Lg={set:a.BranchAndClaw,name:"Farmers Seek The Dahan For Aid",events:[{name:"Farmers Seek the Dahan for Aid",fullText:["&nbsp;&nbsp;The Dahan are uncertain whether to teach the Invaders farming techniques more in tune with the Island's life. You recommend they:","Spurn The Invaders","&nbsp;&nbsp;• On Each Board: 2 Damage to <dahan> in a land with <town>/<city> and <dahan>.","&nbsp;&nbsp;• On Each Board: Add 1 <blight> to a land with at least 2 <town>/<city>.","&nbsp;&nbsp;• <town>/<city> have -1 Health (to a minimum of 1) until the end of the turn.","Teach The Invaders","&nbsp;&nbsp;• On Each Board: Add 1 <town> to a land with <dahan>.","&nbsp;&nbsp;• The next normal Ravage becomes a Build. (This could be on a future turn.)"],effects:[{textArea:[.247,.681],text:"You may:<br><br>Spurn The Invaders<or>Teach The Invaders",[yn.Now]:async({$:e})=>{await e.chooseBetween({effects:[{actionId:"SpurnTheInvaders",label:"Spurn The Invaders",effects:[{textArea:[.284,.359],text:"On Each Board: 2 Damage to <dahan> in a land with <town>/<city> and <dahan>.",[yn.Now]:()=>e.doMainEventActionOnEachBoard((a=>a.inLandsWithAllOf(e.Dahan,e.TownOrCity).pickOne((async a=>{await a.damage(2,e.Dahan)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <dahan> and <town>/<city>.`})))},{textArea:[.355,.429],text:"On Each Board: Add 1 <blight> to a land with at least 2 <town>/<city>.",[yn.Now]:()=>e.doMainEventActionOnEachBoard((a=>a.inLandsWhere((a=>a.hasAtLeast(2,e.TownOrCity))).pickOne((async e=>{await e.addBlight(1)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with at least 2 <town>/<city>.`})))},{textArea:[.418,.495],text:"<town>/<city> have -1 Health (to a minimum of 1) until the end of the turn.",[yn.Now]:async()=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.SpurnTheInvaders,[yn.AdjustHealth]:({piece:a})=>a.isA(e.TownOrCity)?-1:0,[yn.GlobalReminder]:()=>({icon:"<town>/<city><br>-1 HP"})}),await e.globalHealthCheck()}}]},{actionId:"TeachTheInvaders",label:"Teach The Invaders",effects:[{textArea:[.564,.604],text:"On Each Board: Add 1 <town> to a land with <dahan>.",[yn.Now]:()=>e.doMainEventActionOnEachBoard((a=>a.inLandsWith(e.Dahan).pickOne((async a=>{await a.add(1,e.Town)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <dahan>.`})))},{textArea:[.6,.674],text:"The next normal Ravage becomes a Build. (This could be on a future turn.)",[yn.Now]:async()=>{await e.clickToContinue(),await e.addSubEffect({effectId:wn.TeachTheInvaders,[yn.GlobalReminder]:()=>({icon:"Ravage<br>=Build"}),[yn.SkipNextRavageCard]:async({card:a})=>(await e.clickToContinue({name:"Ravage",text:`The Ravage in ${Mo[a].text} becomes a Build.`,textArea:void 0,card:a}),await e.buildFromCard(a,Zl.Ravage,{noIntro:!0}),e.removeThisEffect(),!0)})}}]}]})}}]},kg(!0)]},Fg=e=>({name:"Prey on the Unwary",tokenEvent:!0,effects:[{textArea:e?[.82,.9]:[.649,.729],text:"Each <beasts> destroys 1 <explorer>.",[yn.Now]:async({$:e})=>{await e.inLandsWith(e.Beasts).selectOrder().forEach((a=>e.doTokenEventAction((async()=>{await a.destroy({amount:a.numberOf(e.Beasts),pieces:e.Explorer})}),{land:a})),{noOptions:"No lands with <beasts>."})}},{textArea:e?[.86,.9]:[.689,.729],text:"Add 1 <beasts> on a board without one.",[yn.Now]:({$:e})=>e.doTokenEventAction((async()=>{e.dontCountAs(Bn.Beasts),await e.inBoardsWithout(e.Beasts).pickOne((a=>a.inLands().pickOne((async a=>{await a.add(1,e.Beasts)}),{highlightBoards:[a]})),{noOptions:"No boards without <beasts>."})}))}]}),Rg={set:a.BranchAndClaw,name:"Heavy Farming",events:[{name:"Heavy Farming",blightStatus:og.HealthyIsland,effects:[{textArea:[.107,.25],text:"During the next normal Ravage, each <town> does +1 Damage. (If there is no Ravage this Phase, leave this card by the Ravage Space until one happens.)",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffect({effectId:wn.HeavyFarming,[yn.AdjustIndividualInvaderRavageDamage]:({normal:a,piece:t})=>a&&t.isA(e.Town)?1:0,[yn.AfterResolvingRavageCard]:()=>(e.removeThisEffect(),Promise.resolve()),[yn.GlobalReminder]:()=>({icon:"<town><br>+1 <damage>"})})}}]},{name:"Overcrowded Cities",blightStatus:og.BlightedIsland,effects:[{textArea:[.372,.58],text:"On Each Board with <city>: Add 1 <blight> to a land with <city>.<br><br>Spirits may prevent this on any/all boards by destroying 2 <presence> from each board to be protected.",[yn.Now]:({$:e})=>e.inBoardsWith(e.City).forEach((a=>e.doMainEventAction((()=>e.chooseBetween({effects:[{actionId:"AddBlight",textArea:[.372,.443],text:"Add 1 <blight> to a land with <city>.",[yn.Now]:()=>a.inLandsWith(e.City).pickOne((async e=>{await e.addBlight(1)}),{prompt:"Pick a land to add 1 <blight>.",highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <city>.`})},{actionId:"PreventByDestroyingPresence",textArea:[.474,.58],text:"Prevent this by destroying 2 <presence>.",[yn.Now]:()=>a.destroyPresence(2),condition:()=>a.numberOf(e.Presence)>=2}]})),{board:a})),{noOptions:"No boards with <city>."})}]},Fg(!1),{name:"Coming of Age",dahanEvent:!0,effects:[{textArea:[.827,.9],text:"On Each Board: Add 1 <dahan> to a Jungle or Wetland with <dahan>.",[yn.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((a=>a.inLandsWith(e.Dahan).where((e=>e.isJungleOrWetlands)).pickOne((async a=>{await a.add(1,e.Dahan)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <dahan> in Jungles or Wetlands.`})))}]}]},Ng={set:a.BranchAndClaw,name:"Interesting Discoveries",events:[{name:"Interesting Discoveries",stages:[1],effects:[{textArea:[.105,.179],text:"On Each Board: Choose a <sacred>. Gather 1 <explorer> into its land, and add 1 additional <explorer>.",[yn.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>a.inLandsWhere((e=>e.hasSacredSite)).pickOne((async a=>{await a.gatherOne(e.Explorer),await a.add(1,e.Explorer)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <sacred>.`})),{selectOrder:!0})}]},{name:"Increasing Aggression",stages:[2,3],effects:[{textArea:[.372,.447],text:"Invaders do +1 Damage (per land) when Ravaging.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.IncreasingAggression,[yn.AdjustCollectiveInvaderRavageDamage]:()=>1,[yn.GlobalReminder]:()=>({icon:"+1 <damage>"})})}}]},{name:"Wheezlelung Outbreak",tokenEvent:!0,effects:[{textArea:[.634,.74],text:"On Each Board: Add 1 <disease> to the Jungle/Wetland with the most <town>/<city> (minimum 1).",[yn.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((a=>a.inLandsWith(e.TownOrCity).where((e=>e.isJungleOrWetlands)).withMost((a=>a.numberOf(e.TownOrCity))).pickOne((async a=>{await a.add(1,e.Disease)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No Jungle/Wetland with <town>/<city>.`})))}]},{name:"Tend the Land",dahanEvent:!0,effects:[{textArea:[.823,.9],text:"On Each Board: Remove 1 <blight> from a land with at least 2 <dahan>.",[yn.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((a=>a.forPiecesThatIs(e.Blight,(a=>a.hasAtLeast(2,e.Dahan))).pickOne((async e=>{await e.location.removeBlight()}),{prompt:"Pick a <blight> to remove.",highlightBoards:[a]})))}]}]},$g={name:"Canny Defense",dahanEvent:!0,effects:[{textArea:[.824,.9],text:"During Ravage, in every land, Defend 1 per <dahan> in the land.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.CannyDefense,[yn.GlobalReminder]:()=>({icon:"Defend<br><dahan>"}),[yn.DefendFromGame]:({land:e})=>e.numberOfParticipatingDahan})}}]},Wg={set:a.BranchAndClaw,name:"Invaders Surge Inland",events:[{name:"Invaders Surge Inland",blightStatus:og.HealthyIsland,effects:[{textArea:[.107,.183],text:"On a Coastal land on Each Board: Move 1 <town> one or two lands Inland.",[yn.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>a.forPiecesThatIs(e.Town,(e=>e.isCoastal)).pickOne((async e=>{const a=await e.move({destinationFilter:a=>a.distanceToNearestOcean>e.location.distanceToNearestOcean,pickDestinationEffect:{noOptions:"Picked land has no land that is more Inland."}});if(a.length>0){const{destination:t}=a[0];await e.move({quantifier:lr.May,destinationFilter:e=>e.distanceToNearestOcean>t.distanceToNearestOcean,pickDestinationEffect:{noOptions:"Town can not move further. No lands are more Inland."}})}}),{highlightBoards:[a],noOptions:`On board ${a.name}: No Coastal lands with <town>.`})),{selectOrder:!0})}]},{name:"Widening Destruction",blightStatus:og.BlightedIsland,effects:[{textArea:[.371,.579],text:"On Each Board: Add 1 <blight> to a land with/adjacent to <town>/<city>.<br><br>Spirits may prevent this on any/all boards by destroying 2 <presence> from each board to be protected.",[yn.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>e.chooseBetween({effects:[{actionId:"AddBlight",textArea:[.373,.446],text:"Add 1 <blight> to a land with/adjacent to <town>/<city>.",[yn.Now]:()=>a.inLocationsWithOrAdjacentTo(e.TownOrCity).where((e=>e.isLandForBlight)).pickOne((async e=>{await e.addBlight(1)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with/adjacent to <town>/<city>.`})},{actionId:"PreventByDestroyingPresence",textArea:[.474,.58],text:"Prevent this by destroying 2 <presence>.",[yn.Now]:()=>a.destroyPresence(2),condition:()=>a.numberOf(e.Presence)>=2}]})),{selectOrder:!0})}]},Dg,$g]},Mg={set:a.BranchAndClaw,name:"Investigation Of Dangers",events:[{name:"Investigation of Dangers",terrorLevels:[1],effects:[{textArea:[.107,.181],text:"On Each Board: Add 1 <explorer> to a land without Invaders or <dahan>.",[yn.Now]:({$:e})=>e.onEachBoard((a=>a.inLandsWithout(e.InvaderOrDahan).pickOne((async a=>{await a.add(1,e.Explorer)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands without Invaders or <dahan>.`})))}]},{name:"Destroy the Unnatural!",terrorLevels:[2,3],effects:[{textArea:[.371,.447],text:"Invaders do +3 Damage (per land) when Ravaging in lands with <presence>.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.DestroyTheUnnatural,[yn.AdjustCollectiveInvaderRavageDamage]:({land:a})=>a.hasIgnoringCountAs(e.Presence)?3:0,[yn.GlobalReminder]:()=>({icon:"+3 <damage><br><presence>"})})}}]},Fg(!1),{name:"Rouse the Spirits",dahanEvent:!0,effects:[{textArea:[.804,.916],text:"Each Spirit with at least 3 <dahan> among all its lands may use a <slow> Power now (instead of later).",[yn.Now]:({$:e})=>e.spiritsWhich((a=>a.numberOfPiecesInLands(e.Dahan)>=3)).selectOrder().forEach((a=>e.doDahanEventAction((async()=>{await $d.createCollection(e,a.resolvableCardsWithSpeed(rr.Slow)).optionallyPickOne((async e=>{await e.owner.targetAndResolvePower(e,!1)}),{players:[a],noOptions:`${a.nameLink} does not have a <slow> Power in play.`})}))),{noOptions:"No spirits have at least 3 <dahan> among all its lands."})}]}]},Gg={set:a.BranchAndClaw,name:"Missionaries Arrive",events:[{name:"Missionaries Arrive",fullText:["&nbsp;&nbsp;They teach and spread lessons of a foreign god. You may:","Ignore their contact with the Dahan","&nbsp;&nbsp;• For each board, discard the top Minor Power. If it has <sun>, Push 1 <explorer> from a land with <dahan>. Otherwise, replace 1 <dahan> with 1 <town>.","&nbsp;&nbsp;• After resolving this card, return it to the Event Deck under the top 2 cards.","Curse the tongues of the foreigners","&nbsp;&nbsp;Cost: 4 Energy per player. Aided by <sun>.","&nbsp;&nbsp;• Each Spirit adds 1 <disease> to a land with <city>.","&nbsp;&nbsp;• 2 <fear> per player.","&nbsp;&nbsp;• During the next normal Ravage, <city> do +3 Damage."],effects:[{textArea:[.212,.683],text:"You may:<br><br>Ignore their contact with the Dahan<or>Curse the tongues of the foreigners",[yn.Now]:async({$:e})=>{await e.chooseBetween({effects:[{actionId:"IgnoreContact",label:"Ignore their contact with the Dahan",effects:[{textArea:[.25,.363],text:"For each board, discard the top Minor Power. If it has <sun>, Push 1 <explorer> from a land with <dahan>. Otherwise, replace 1 <dahan> with 1 <town>.",[yn.Now]:async()=>{await e.clickToContinue(),await e.doMainEventActionOnEachBoard((async a=>{const t=await e.drawAndDiscardPower(Sn.Minor);if(void 0!==t){let n=!1;t===Mi.ElementalBoon&&(n=await e.may({text:"Do you want Elemental Boon to have <sun>?"})),sg[t].elements?.includes(nr.Sun)||n?await e.addSubEffect({textArea:void 0,card:t,text:"If it has <sun>, Push 1 <explorer> from a land with <dahan>.",[yn.Now]:()=>a.forPiecesThatIs(e.Explorer,(a=>a.has(e.Dahan))).pickOne((async e=>{await e.push()}),{prompt:"Pick a <explorer> to Push.",highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <dahan> and <explorer>.`})}):await e.addSubEffect({textArea:void 0,card:t,text:"Card does not have <sun>:<br><br>Replace 1 <dahan> with 1 <town>.",[yn.Now]:()=>a.forPiecesThatIs(e.Dahan).pickOne((async e=>{await e.replace([Bn.Town])}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <dahan>.`})})}}))}},{textArea:[.358,.433],text:"After resolving this card, return it to the Event Deck under the top 2 cards.",[yn.Now]:async()=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({[yn.AfterResolvingEventCard]:({eventCard:a})=>(e.removeThisEffect(),e.removeEventCardFromDiscard(a),e.insertEventCard(a).underCards(2),Promise.resolve())})}}]},{actionId:"CurseTheTongues",label:"Curse the tongues of the foreigners",condition:()=>e.playersCanJointlyPayEnergyAidedBy({energy:4*e.spiritCount,element:nr.Sun}),effects:[{textArea:[.509,.549],text:"Cost: 4 Energy per player. Aided by <sun>.",[yn.Now]:async()=>{await e.payEnergyJointlyAidedBy({energy:4*e.spiritCount,element:nr.Sun})}},{textArea:[.541,.581],text:"Each Spirit adds 1 <disease> to a land with <city>.",[yn.Now]:()=>e.eachSpirit((()=>e.doMainEventAction((()=>e.inLandsWith(e.City).pickOne((async a=>{await a.add(1,e.Disease)}),{noOptions:"No lands with <city>."})))))},{textArea:[.577,.617],text:"2 <fear> per player.",[yn.Now]:async()=>{await e.clickToContinue({noOptions:`${e.spiritCount} player${e.spiritCount>1?"s":""} = ${2*e.spiritCount} <fear>.`}),await e.doMainEventAction((async()=>{await e.fear(2*e.spiritCount)}))}},{textArea:[.611,.682],text:"During the next normal Ravage, <city> do +3 Damage.",[yn.Now]:async()=>{await e.clickToContinue(),await e.addSubEffect({effectId:wn.CurseTheTongues,[yn.AdjustIndividualInvaderRavageDamage]:({normal:a,piece:t})=>a&&t.isA(e.City)?3:0,[yn.AfterResolvingRavageCard]:()=>(e.removeThisEffect(),Promise.resolve()),[yn.GlobalReminder]:()=>({icon:"<city><br>+3 <damage>"})})}}]}]})}}]},Fg(!0)]},Hg={name:"Offerings of Pattern and Dance",dahanEvent:!0,effects:[{textArea:[.848,.92],text:"Each Spirit with at least 2 <dahan> among all its lands gains 1 Energy.",[yn.Now]:async({$:e})=>{const a=e.spiritsWhich((a=>a.numberOfPiecesInLands(e.Dahan)>=2));await e.clickToContinue({noOptions:a.count>0?`${a.count} out of ${e.spiritCount} Spirits ${a.count>1?"have":"has"} at least 2 <dahan> among all its lands:<br>${a.items.map((e=>e.nameLink)).join(" ")}`:"No spirits have at least 2 <dahan> among all its lands."}),await a.forEach((a=>e.doDahanEventAction((async()=>{await a.gainEnergy(1)}))))}}]},jg={set:a.BranchAndClaw,name:"New Species Spread",events:[{name:"New Species Spread",fullText:["&nbsp;&nbsp;New plants and animals brought by the Invaders Damage the local ecology. You may:","Let the Invasive Species Bloom","&nbsp;&nbsp;• For each board, discard the top Minor Power. If it is <fast>, add 1 <blight> to a land with <town>/<city>.","&nbsp;&nbsp;• After resolving this card, return it to the Event Deck under the top 2 cards.","Transmute the Worst of the Species","&nbsp;&nbsp;Cost: 4 Energy per player. Aided by <moon>.","&nbsp;&nbsp;• 1 <fear> per player. On Each Board: Add 1 <beasts> to a land with <town>/<city>."],effects:[{textArea:[.212,.584],text:"You may:<br><br>Let the Invasive Species Bloom<or>Transmute the Worst of the Species",[yn.Now]:async({$:e})=>{await e.chooseBetween({effects:[{actionId:"LetThemBloom",label:"Let the Invasive Species Bloom",effects:[{textArea:[.253,.329],text:"For each board, discard the top Minor Power. If it is <fast>, add 1 <blight> to a land with <town>/<city>.",[yn.Now]:async()=>{await e.clickToContinue(),await e.doMainEventActionOnEachBoard((async a=>{const t=await e.drawAndDiscardPower(Sn.Minor);void 0!==t&&(sg[t].speed===rr.Fast?await e.addSubEffect({card:t,textArea:void 0,highlightBoards:[a],text:"If it is <fast>, add 1 <blight> to a land with <town>/<city>.",[yn.Now]:()=>a.inLandsWith(e.TownOrCity).pickOne((async e=>{await e.addBlight(1)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <town>/<city>.`})}):await e.clickToContinue({card:t,textArea:void 0,highlightBoards:[a],text:"The discarded Power is <slow>:<br><br>Nothing happens."}))}))}},{textArea:[.319,.393],text:"After resolving this card, return it to the Event Deck under the top 2 cards.",[yn.Now]:async()=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({[yn.AfterResolvingEventCard]:({eventCard:a})=>(e.removeThisEffect(),e.insertEventCard(a).underCards(2),Promise.resolve())})}}]},{actionId:"TransmuteTheWorst",label:"Transmute the Worst of the Species",condition:()=>e.playersCanJointlyPayEnergyAidedBy({energy:4*e.spiritCount,element:nr.Moon}),effects:[{textArea:[.47,.51],text:"Cost: 4 Energy per player. Aided by <moon>.",[yn.Now]:async()=>{await e.payEnergyJointlyAidedBy({energy:4*e.spiritCount,element:nr.Moon})}},{textArea:[.506,.546],text:"1 <fear> per player.",[yn.Now]:async()=>{await e.clickToContinue({noOptions:`${e.spiritCount} player${e.spiritCount>1?"s":""} = ${e.spiritCount} <fear>.`}),await e.doMainEventAction((async()=>{await e.fear(e.spiritCount)}))}},{textArea:[.506,.578],text:"On Each Board: Add 1 <beasts> to a land with <town>/<city>.",[yn.Now]:()=>e.doMainEventActionOnEachBoard((a=>a.inLandsWith(e.TownOrCity).pickOne((async a=>{await a.add(1,e.Beasts)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <town>/<city>.`})))}]}]})}}]},kg(!1),Hg]},Ug={name:"Lingering Plagues",tokenEvent:!0,effects:[{textArea:[.641,.71],text:"On Each Board: Add 1 <disease>.",[yn.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((a=>a.inLands().pickOne((async a=>{await a.add(1,e.Disease)}))))},{textArea:[.673,.746],text:"Ignore <disease> during Builds this Invader Phase.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.LingeringPlagues,[yn.GlobalReminder]:()=>({icon:"Ignore<br><disease>"}),[yn.PreventDiseasePreventingBuilds]:()=>Promise.resolve(!0)})}}]},qg={set:a.BranchAndClaw,banned:!0,name:"Outpaced",events:[{name:"Outpaced",fullText:["&nbsp;&nbsp;Humanity has always been faster than you, but the Invaders' terrifying speed catches you off guard. Each Spirit chooses independently for each of their Slow Power Cards played this turn:","Stay Steady and Slow","&nbsp;&nbsp;• Discard the Power Card.","&nbsp;&nbsp;• Gain 1 Energy, plus the card's printed Energy cost.","Work to Match their Pace","&nbsp;&nbsp;• Pay 3 Energy.<or>Destroy 2 <presence>.","&nbsp;&nbsp;• You may choose to resolve the Power Card now. (Instead of during the <slow> Phase.)"],effects:[{textArea:[.279,.581],text:"Each Spirit chooses independently for each of their Slow Power Cards played this turn:<br><br>Stay Steady and Slow<or>Work to Match their Pace",[yn.Now]:({$:e})=>e.resolvablePowers(rr.Slow,!0).where((e=>e.isA(En.AnyCard))).selectOrder().forEach((a=>e.doMainEventAction((async()=>{const t=[];a.isSlow&&a.mayChangeSpeed?t.push({actionId:"MakeFastToAvoidEffect",label:"Make <fast> to avoid effect.",effects:[{[yn.Now]:async()=>{await a.changeSpeedIfNeeded(rr.Fast)}}]}):a.isFast&&t.push({actionId:"LeaveItFastToAvoidEffect",label:"Leave it <fast> to avoid effect.",[yn.Now]:async()=>{}}),(a.isSlow||a.mayChangeSpeed)&&t.push({actionId:"StaySteadyAndSlow",label:"Stay Steady and Slow",effects:[{textArea:[.318,.358],text:"Discard the Power Card.",[yn.Now]:async()=>{await a.changeSpeedIfNeeded(rr.Slow),await a.discard()}},{textArea:[.354,.394],text:"Gain 1 Energy, plus the card's printed Energy cost.",[yn.Now]:async()=>{await a.owner.gainEnergy(1+a.costToPlay)}}],condition:()=>a.isSlow||a.mayChangeSpeed},{actionId:"WorkToMatchTheirPace",label:"Work to Match their Pace",effects:[{textArea:[.462,.502],text:"Pay 3 Energy.<or>Destroy 2 <presence>.",[yn.Now]:async()=>{await a.changeSpeedIfNeeded(rr.Slow),await e.chooseBetween({effects:[{actionId:"PayEnergy",text:"Pay 3 Energy.",condition:()=>a.owner.energy>=3,[yn.Now]:()=>a.owner.payEnergy(3)},{actionId:"DestroyPresence",text:"Destroy 2 <presence>.",[yn.Now]:async()=>{await a.owner.destroyPresence(2)}}]})}},{textArea:[.498,.572],text:"You may choose to resolve the Power Card now. (Instead of during the <slow> Phase.)",[yn.Now]:async()=>{!a.isResolved&&await e.may({prompt:`Resolve ${a.powerLink} now?`})&&await a.owner.targetAndResolvePower(a)}}],condition:()=>a.isSlow||a.mayChangeSpeed}),await e.chooseBetween({effects:t})}))),{noOptions:"No resolvable Slow Power Cards."})}]},Ug,{name:"Raids in Force",dahanEvent:!0,effects:[{textArea:[.814,.917],text:"Each Spirit chooses a different land where <dahan> outnumber <town>/<city>. Each <dahan> there does 1 Damage.",[yn.Now]:({$:e})=>e.inLandsWhere((a=>a.the(e.Dahan).outnumber(e.TownOrCity))).inDifferent((a=>e.eachSpirit((()=>e.doDahanEventAction((()=>a((async a=>{await a.damage(a.numberOf(e.Dahan))}))))))),{noOptions:"No lands where <dahan> outnumber <town>/<city>."})}]}]},_g={set:a.BranchAndClaw,name:"Population Rises",events:[{name:"Population Rises",blightStatus:og.HealthyIsland,effects:[{textArea:[.102,.18],text:"On Each Board: Add 1 <town> to a land with <explorer>/<town>.",[yn.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>a.inLandsWith(e.ExplorerOrTown).pickOne((async a=>{await a.add(1,e.Town)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <explorer>/<town>.`})))}]},{name:"Power Fades",blightStatus:og.BlightedIsland,effects:[{textArea:[.365,.611],text:"Each Spirit chooses independently to: Destroy 2 of their <presence><or>Forget 2 of their Powers<or>Take 1 <blight> from the Blight Card and remove it from the game.",[yn.Now]:({$:e})=>e.eachSpirit((a=>e.doMainEventAction((async()=>{await e.chooseBetween({effects:[{actionId:"DestroyPresence",textArea:[.401,.441],text:"Destroy 2 of their <presence>",[yn.Now]:async()=>{await a.destroyPresence(2)},condition:()=>a.numberOfPresenceInLands>=2},{actionId:"ForgetPowers",textArea:[.47,.51],text:"Forget 2 of their Powers",condition:()=>a.hasAtLeastNonBlessed(2,En.AnyCard),[yn.Now]:async()=>{await a.forgetPowers({amount:2})}},{actionId:"RemoveBlight",textArea:[.538,.608],text:"Take 1 <blight> from the Blight Card and remove it from the game.",[yn.Now]:async()=>{await e.removeBlightFromBlightCard(1)}}]})}))))}]},{name:"Sandfever Outbreak",tokenEvent:!0,effects:[{textArea:[.636,.745],text:"On Each Board: Add 1 <disease> to the Sands or Mountains with most <town>/<city> (minimum 1).",[yn.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((a=>a.inLandsWith(e.TownOrCity).where((e=>e.isMountainsOrSands)).withMost((a=>a.numberOf(e.TownOrCity))).pickOne((async a=>{await a.add(1,e.Disease)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <town>/<city>.`})))}]},Hg]},Jg={[xo.Jungles]:{plural:"Jungles",text:"<jungles>"},[xo.Mountains]:{plural:"Mountains",text:"<mountains>"},[xo.Sands]:{plural:"Sands",text:"<sands>"},[xo.Wetlands]:{plural:"Wetlands",text:"<wetlands>"}},Vg={set:a.BranchAndClaw,name:"Promising Farmland",events:[{name:"Promising Farmland",blightStatus:og.HealthyIsland,effects:[{textArea:[.105,.179],text:"When Exploring, once per board, place 1 <town> instead of 1 <explorer>.",[yn.Now]:async({$:e})=>{await e.clickToContinue();const a=[];await e.addSubEffectUntilEndOfTurn({effectId:wn.PromisingFarmland,[yn.GlobalReminder]:()=>({icon:"Explore<br>+1 <town>"}),[yn.ExploreOrderMatters]:()=>!0,[yn.AlterInvaderActionInLand]:async({land:t,invaderAction:n})=>{const r=t.boards().where((e=>!a.includes(e.boardIndex)));return n===Hr.Explore&&r.count>0&&(await t.add(1,e.Town),a.push(r.anyOne.boardIndex),!0)}})}}]},{name:"New Cash Crops take Hold",blightStatus:og.BlightedIsland,effects:[{textArea:[.373,.582],text:"Invaders immediately Ravage in 1 terrain type not showing under any Invader Action<br><br>Spirits may prevent this on any/all boards by destroying 2 <presence> from each board to be protected.",[yn.Now]:({$:e})=>e.doMainEventAction((async()=>{const a=await e.pickTerrainsWhere((a=>!e.showingTerrainTypes.includes(a)),{noOptions:"No terrain types are not showing."});if(!a)return;const t=[];await e.onEachBoard((n=>e.chooseBetween({highlightBoards:[n],prompt:`On board ${n.name}, choose between:`,effects:[{actionId:"Ravage",textArea:[.371,.446],text:`Let Invaders Ravage in ${Jg[a].text}.`,[yn.Now]:()=>Promise.resolve()},{actionId:"PreventRavage",textArea:[.475,.579],text:"Prevent ravage by destroying 2 <presence>.",[yn.Now]:async()=>{t.push(n),await n.destroyPresence(2)},condition:()=>n.numberOf(e.Presence)>=2}]}))),await e.addEffectUntilEndOfAction({[yn.PreventInvaderActionInLand]:({land:e})=>Promise.resolve(e.boards().hasOneWhere((e=>t.includes(e))))}),await e.doExtraRavageInTerrain(a)}))}]},{name:"Beasts Provoked",tokenEvent:!0,effects:[{textArea:[.648,.727],text:"On Each Board: Add 1 <beasts> to a land without <blight> that has <town>.",[yn.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((a=>a.inLandsWithout(e.Blight).where((a=>a.has(e.Town))).pickOne((async a=>{await a.add(1,e.Beasts)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands without <blight> that has <town>.`})))}]},$g]},Yg={name:"Stricken",tokenEvent:!0,effects:[{textArea:[.656,.73],text:"In lands with <disease>/<strife>, Invaders skip Ravage Actions.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.Stricken,[yn.GlobalReminder]:()=>({icon:"Skip<br>Ravage"}),[yn.PreventInvaderActionInLand]:({land:a,invaderAction:t})=>Promise.resolve(t===Hr.Ravage&&(a.has(e.Disease)||a.participatingInvaders().hasOneWhere((e=>e.strife>0))))})}}]},zg={set:a.BranchAndClaw,name:"Putting Down Roots",events:[{name:"Putting Down Roots",blightStatus:og.HealthyIsland,effects:[{textArea:[.107,.181],text:"On an Inland land on Each Board: Replace 1 <explorer> with 1 <town>.",[yn.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>a.forPiecesThatIs(e.Explorer,(e=>e.isInland)).pickOne((async e=>{await e.upgrade()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No Inland lands with <explorer>.`})))}]},{name:"The Center Crumbles",blightStatus:og.BlightedIsland,effects:[{textArea:[.371,.581],text:"On Each Board with Invaders: Add 1 <blight> to an Inland land.<br><br>Spirits may prevent this on any/all boards by destroying 3 <presence> from each board to be protected.",[yn.Now]:({$:e})=>e.inBoardsWith(e.Invader).selectOrder().forEach((a=>e.doMainEventAction((()=>e.chooseBetween({highlightBoards:[a],prompt:`On board ${a.name}, choose between:`,effects:[{actionId:"AddBlight",textArea:[.371,.442],text:"Add 1 <blight> to an Inland land.",prompt:"Pick a land to add <blight>.",[yn.Now]:()=>a.inInlandLands().pickOne((async e=>{await e.addBlight(1)}))},{actionId:"PreventBlight",textArea:[.472,.582],text:"Prevent <blight> by destroying 3 <presence>.",[yn.Now]:()=>a.destroyPresence(3),condition:()=>a.numberOf(e.Presence)>=3}]})),{board:a})),{autoPlayOneOption:!0})}]},Yg,{name:"Drive Off the Interlopers",dahanEvent:!0,effects:[{textArea:[.824,.901],text:"Each player may Push 1 <explorer>/<town> from a land with <dahan>.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doDahanEventAction((()=>e.forPiecesThatIs(e.ExplorerOrTown,(a=>a.has(e.Dahan))).optionallyPickOne((async e=>{await e.push()}),{noOptions:"No lands with <explorer>/<town> and <dahan>."})))))}]}]},Qg={set:a.BranchAndClaw,name:"Rising Interest In The Island",events:[{name:"Rising Interest In The Island",fullText:["&nbsp;&nbsp;Your Island is unlike any the Invaders have seen. Their leaders begin to take interest in tales of strangeness. You may:","Ignore the Curiosity","&nbsp;&nbsp;• Return the top card of the Invader Deck to the box. (Skip cards specially placed during Setup.)","&nbsp;&nbsp;• On Each Board: Add 1 <town> to a land without one.","Weave Lies in the Minds of their Observers","&nbsp;&nbsp;Cost: 4 Energy per player. Aided by <air>.","&nbsp;&nbsp;• Return the top Fear Card to the box.","&nbsp;&nbsp;• During the next normal Ravage, each <town>/<city> does +1 Damage."],effects:[{textArea:[.227,.567],text:"You may:<br><br>Ignore the Curiosity<or>Weave Lies in the Minds of their Observers",[yn.Now]:async({$:e})=>{await e.doMainEventAction((async()=>{await e.chooseBetween({effects:[{actionId:"IgnoreTheCuriosity",label:"Ignore the Curiosity",effects:[{textArea:[.265,.337],text:"Return the top card of the Invader Deck to the box. (Skip cards specially placed during Setup.)",[yn.Now]:async()=>{await e.clickToContinue(),await e.removeTopNonSpecialExploreCard()}},{textArea:[.332,.372],text:"On Each Board: Add 1 <town> to a land without one.",[yn.Now]:()=>e.doMainEventActionOnEachBoard((a=>a.inLandsWithout(e.Town).pickOne((async a=>{await a.add(1,e.Town)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands without <town>.`})))}]},{actionId:"WeaveLies",label:"Weave Lies in the Minds of their Observers",condition:()=>e.playersCanJointlyPayEnergyAidedBy({energy:4*e.spiritCount,element:nr.Air}),effects:[{textArea:[.423,.463],text:"Cost: 4 Energy per player. Aided by <air>.",[yn.Now]:async()=>{await e.payEnergyJointlyAidedBy({energy:4*e.spiritCount,element:nr.Air})}},{textArea:[.456,.496],text:"Return the top Fear Card to the box.",[yn.Now]:async()=>{await e.clickToContinue(),await e.removeTopFearCard()}},{textArea:[.49,.565],text:"During the next normal Ravage, each <town>/<city> does +1 Damage.",[yn.Now]:async()=>{await e.clickToContinue(),await e.addSubEffect({effectId:wn.WeaveLies,[yn.AdjustIndividualInvaderRavageDamage]:({normal:a,piece:t})=>a&&t.isA(e.TownOrCity)?1:0,[yn.AfterResolvingRavageCard]:()=>(e.removeThisEffect(),Promise.resolve()),[yn.GlobalReminder]:()=>({icon:"<town>/<city><br>+1 <damage>"})})}}]}]})}))}}]},{name:"Beasts of the Jungle",tokenEvent:!0,effects:[{textArea:[.63,.739],text:"On Each Board: Add 1 <beasts> to a Jungle without <blight>. 1 <fear> if Invaders are present.",[yn.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((a=>a.inLandsWithout(e.Blight).where((e=>e.isJungle)).pickOne((async a=>{await a.add(1,e.Beasts),a.hasInvaders&&await a.fear(1)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No Jungle without <blight>.`})))}]},{name:"Traps and Snares",dahanEvent:!0,effects:[{textArea:[.822,.897],text:"On Each Board: Add 1 <wilds> to a land with <dahan>.",[yn.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((a=>a.inLandsWith(e.Dahan).pickOne((async a=>{await a.add(1,e.Wilds)}),{highlightBoards:[a],noOptions:`On board ${a.name}: no lands with <dahan>.`})))}]}]},Kg={name:"Beasts Prowl",tokenEvent:!0,effects:[{textArea:[.634,.746],text:"Each <beasts> generates 1 <fear> if Invaders are present, and moves to an adjacent land if not.",[yn.Now]:async({$:e})=>{const a=new Set;await e.inLandsWith(e.Beasts).selectOrder().forEach((t=>e.doTokenEventAction((async()=>{const n=t.piecesWhere((t=>t.isA(e.Beasts)&&!a.has(t)));t.hasInvaders?await t.fear(n.count):await n.forEach((async a=>{await a.move({quantifier:a.isIgnoringCountAsA(e.Beasts)?lr.Exactly:lr.UpTo})}));for(const e of n.items)a.add(e)}),{land:t})),{noOptions:"No lands with <beasts>."})}}]},Xg={set:a.BranchAndClaw,name:"Sacred Sites Under Threat",events:[{name:"Sacred Sites Under Threat",fullText:["&nbsp;&nbsp;Invaders have begun to find hidden places of natural power. You may:","Let the Island's Strength Repulse Them","&nbsp;&nbsp;• Each <sacred> Pushes 1 <explorer>/<town> to an adjacent land.","&nbsp;&nbsp;• Remove 1 <blight> per player from the Blight Card, returning it to the box.","Guard Them Yourself, for Well or Ill","&nbsp;&nbsp;Cost: 3 Energy per land where you do Damage.<br>Aided by <fire>.","&nbsp;&nbsp;In Each land with <sacred> and Invaders:","&nbsp;&nbsp;Either do 2 Damage.<or>Destroy 1 <presence> from each Spirit."],effects:[{textArea:[.194,.602],text:"You may:<br><br>Let the Island's Strength Repulse Them<or>Guard Them Yourself, for Well or Ill",[yn.Now]:async({$:e})=>{await e.doMainEventAction((async()=>{await e.chooseBetween({effects:[{actionId:"Repulse",label:"Let the Island's Strength Repulse Them",effects:[{textArea:[.23,.27],text:"Each <sacred> Pushes 1 <explorer>/<town> to an adjacent land.",[yn.Now]:()=>e.inLandsWhere((e=>e.hasSacredSite)).selectOrder().forEach((a=>e.doMainEventAction((async()=>{await a.push({amount:a.numberOfSacredSites,pieces:e.ExplorerOrTown})}),{land:a})))},{textArea:[.266,.34],text:"Remove 1 <blight> per player from the Blight Card, returning it to the box.",[yn.Now]:async()=>{await e.clickToContinue({noOptions:`${e.spiritCount} player${e.spiritCount>1?"s":""} = ${e.spiritCount} <blight>.`}),await e.removeBlightFromBlightCard(1)}}]},{actionId:"GuardThem",label:"Guard Them Yourself, for Well or Ill",effects:[{textArea:[.39,.604],text:"In Each land with <sacred> and Invaders:<br><br>Either do 2 Damage.<or>Destroy 1 <presence> from each Spirit.",[yn.Now]:async()=>{let a=0;await e.inLandsWith(e.Invader).where((e=>e.hasSacredSite)).selectOrder().forEach((t=>e.doMainEventAction((async()=>{await e.chooseBetween({effects:[{actionId:"Damage",textArea:[.496,.536],text:"Do 2 Damage.",[yn.Now]:async()=>{a+=1,await t.damage(2)},condition:()=>e.playersCanJointlyPayEnergyAidedBy({energy:3*(a+1)*e.spiritCount,element:nr.Fire})},{actionId:"DestroyPresence",textArea:[.561,.601],text:"Destroy 1 <presence> from each Spirit.",[yn.Now]:async()=>{await e.eachSpirit((async a=>{await t.destroy({pieces:e.Presence,owner:a})}))}}]})}),{land:t}))),await e.addSubEffect({textArea:[.39,.467],text:"Cost: 3 Energy per land where you do Damage.<br>Aided by <fire>.",[yn.Now]:async()=>{await e.payEnergyJointlyAidedBy({energy:3*a*e.spiritCount,element:nr.Fire})}})}}]}]})}))}}]},Kg,{name:"Spirit Speakers Solve Riddles of Power",dahanEvent:!0,effects:[{textArea:[.845,.913],text:"Each Spirit with at least 4 <dahan> among it lands gains a Minor Power.",[yn.Now]:({$:e})=>e.spiritsWhich((a=>a.numberOfPiecesInLands(e.Dahan)>=4)).forEach((a=>e.doDahanEventAction((async()=>{await a.gainPowerCard({powerType:Sn.Minor})}))),{noOptions:"No spirits has at least 4 <dahan> among it lands."})}]}]},Zg={set:a.BranchAndClaw,name:"Search For New Lands",events:[{name:"Search For New Lands",blightStatus:og.HealthyIsland,effects:[{textArea:[.107,.186],text:"In Each land with at least 2 <explorer>: Push 1 <explorer> to an adjacent land without Invaders.",[yn.Now]:({$:e})=>e.inLandsWhere((a=>a.hasAtLeast(2,e.Explorer))).selectOrder().forEach((a=>e.doMainEventAction((async()=>{await a.push({amount:1,pieces:e.Explorer,destinationFilter:a=>a.doesntHave(e.Invader)})}),{land:a})),{noOptions:"No lands with at least 2 <explorer>"})}]},{name:"Devastated Shores",blightStatus:og.BlightedIsland,effects:[{textArea:[.371,.579],text:"On Each Board with Invaders: Add 1 <blight> to a Coastal land.<br><br>Spirits may prevent this on any/all boards by destroying 2 <presence> from each board to be protected.",[yn.Now]:({$:e})=>e.inBoardsWith(e.Invader).selectOrder().forEach((a=>e.doMainEventAction((async()=>{await e.chooseBetween({prompt:`On board ${a.name}, choose between:`,highlightBoards:[a],effects:[{actionId:"AddBlight",textArea:[.371,.442],text:"Add 1 <blight> to a Coastal land.",prompt:"Pick a land to add <blight>.",[yn.Now]:()=>a.inCoastalLocations().where((e=>e.isLandForBlight)).pickOne((async e=>{await e.addBlight(1)}))},{actionId:"PreventByDestroyingPresence",textArea:[.473,.584],text:"Prevent <blight> by destroying 2 <presence>.",[yn.Now]:()=>a.destroyPresence(2),condition:()=>a.numberOf(e.Presence)>=2}]})}),{board:a})))}]},{name:"Distant Hunt",tokenEvent:!0,effects:[{textArea:[.638,.748],text:"On Each Board: Push 1 <beasts> to an adjacent land with no <blight>. It deals 1 Damage there.",[yn.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((async a=>(await e.countPieceOptionally(Bn.Beasts,(()=>a.forPiecesThatIs(e.Beasts,(a=>a.hasAdjacentLandWhere((a=>a.doesntHave(e.Blight)))))))).pickOne((async a=>{const t=await a.push({destinationFilter:a=>a.doesntHave(e.Blight)});t.length>0&&await t[0].destination.damage(1)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <beasts> adjacent to a land with no <blight>.`})),{selectOrder:!0})}]},$g]},ef={set:a.BranchAndClaw,name:"Seeking The Interior",events:[{name:"Seeking The Interior",stages:[1],effects:[{textArea:[.107,.18],text:"In each Coastal land, Push 1 <explorer> one land Inland.",[yn.Now]:({$:e})=>e.inCoastalLands().forEach((a=>e.doMainEventAction((async()=>{await a.push({amount:1,pieces:e.Explorer,destinationFilter:e=>e.distanceToNearestOcean>a.distanceToNearestOcean})}),{land:a})))}]},{name:"Local Diaspora",stages:[2,3],effects:[{textArea:[.367,.444],text:"In the single land with the most Invaders, Push 1 <explorer>/<town> to each adjacent land.",[yn.Now]:({$:e})=>e.doMainEventAction((()=>e.inLands().withMost((a=>a.numberOf(e.Invader))).pickOne((async a=>{await a.push({amount:a.adjacentLands.length,pieces:e.ExplorerOrTown,differentLands:!0})}))))}]},Kg,{name:"Forsake the Barren Land",dahanEvent:!0,effects:[{textArea:[.805,.917],text:"On Each Board: Push 2 <dahan> from a land with <blight> to a land without <blight>.",[yn.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((a=>a.inLandsWithAllOf(e.Dahan,e.Blight).where((a=>a.hasAdjacentLandWhere((a=>a.doesntHave(e.Blight))))).filteredByAnyInPriority((a=>a.hasAtLeast(2,e.Dahan))).pickOne((async a=>{await a.push({amount:2,pieces:e.Dahan,together:!0,destinationFilter:a=>a.doesntHave(e.Blight)})}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <dahan> and <blight> adjacent to a land without <blight>.`})),{selectOrder:!0})}]}]};var af;!function(e){e.AccumulatedDevastation="AccumulatedDevastation",e.AnOminousDawn="AnOminousDawn",e.AStrangeMadnessAmongTheBeasts="AStrangeMadnessAmongTheBeasts",e.BureaucratsAdjustFunding="BureaucratsAdjustFunding",e.CitiesRise="CitiesRise",e.CivicEngagement="CivicEngagement",e.CoastalTownsMultiply="CoastalTownsMultiply",e.CulturalAssimilation="CulturalAssimilation",e.DahanTradeWithTheInvaders="DahanTradeWithTheInvaders",e.DistantExploration="DistantExploration",e.EagerExplorers="EagerExplorers",e.EtherealConjunction="EtherealConjunction",e.FarOffWarsTouchTheIsland="FarOffWarsTouchTheIsland",e.FarmersSeekTheDahanForAid="FarmersSeekTheDahanForAid",e.FocusedFarming="FocusedFarming",e.Fortuneseekers="Fortuneseekers",e.GradualCorruption="GradualCorruption",e.HardworkingSettlers="HardworkingSettlers",e.HarvestBountyHarvestDust="HarvestBountyHarvestDust",e.HeavyFarming="HeavyFarming",e.InfluxOfSettlers="InfluxOfSettlers",e.InterestingDiscoveries="InterestingDiscoveries",e.InvadersSurgeInland="InvadersSurgeInland",e.InvestedAristocracy="InvestedAristocracy",e.InvestigationOfDangers="InvestigationOfDangers",e.LesserSpiritsImperiled="LesserSpiritsImperiled",e.LifesBalanceTilts="LifesBalanceTilts",e.MapmakersChartTheWild="MapmakersChartTheWild",e.MissionariesArrive="MissionariesArrive",e.NewSpeciesSpread="NewSpeciesSpread",e.NoBraveryWithoutNumbers="NoBraveryWithoutNumbers",e.NuminousCrisis="NuminousCrisis",e.Outpaced="Outpaced",e.Overconfidence="Overconfidence",e.PopulationRises="PopulationRises",e.PromisingFarmland="PromisingFarmland",e.ProvincialSeat="ProvincialSeat",e.PullTogetherInAdversity="PullTogetherInAdversity",e.PuttingDownRoots="PuttingDownRoots",e.RelentlessOptimism="RelentlessOptimism",e.RemnantsOfASpiritsHeart="RemnantsOfASpiritsHeart",e.ResourcefulPopulace="ResourcefulPopulace",e.RisingInterestInTheIsland="RisingInterestInTheIsland",e.SacredSitesUnderThreat="SacredSitesUnderThreat",e.SearchForNewLands="SearchForNewLands",e.SearchForUnclaimedLand="SearchForUnclaimedLand",e.SeekNewFarmland="SeekNewFarmland",e.SeekingTheInterior="SeekingTheInterior",e.SlaveRebellion="SlaveRebellion",e.SmallerPortsSpringUp="SmallerPortsSpringUp",e.SprawlContainedByTheWilds="SprawlContainedByTheWilds",e.StrangeTalesAttractExplorers="StrangeTalesAttractExplorers",e.TemporaryTruce="TemporaryTruce",e.TerrorSpikesUpwards="TerrorSpikesUpwards",e.TheFrontierCalls="TheFrontierCalls",e.TheStrugglesOfGrowth="TheStrugglesOfGrowth",e.ThrivingTrade="ThrivingTrade",e.TightknitCommunities="TightknitCommunities",e.UrbanDevelopment="UrbanDevelopment",e.VisionsOutOfTime="VisionsOutOfTime",e.WarTouchesTheIslandsShores="WarTouchesTheIslandsShores",e.WaveOfReconnaissance="WaveOfReconnaissance",e.WellpreparedExplorers="WellpreparedExplorers",e.WoundedLandsAttractExplorers="WoundedLandsAttractExplorers",e.YearsOfLittleRain="YearsOfLittleRain"}(af||(af={}));const tf={set:a.BranchAndClaw,name:"Slave Rebellion",events:[{name:"Small Uprising",stages:[1,2],effects:[{textArea:[.239,.279],text:"On Each Board: Add <strife> to 1 <town>.",[yn.Now]:async({$:e})=>{await e.doMainEventActionOnEachBoard((a=>a.forPiecesThatIs(e.Town).pickOne((async e=>{await e.addStrife()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No <town>.`})))}},{textArea:[.239,.383],text:"After finishing the Event Card, draw another one, then return this card to the Event Deck as per Setup.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({[yn.AfterResolvingEventCard]:async()=>{await e.clickToContinue(),e.removeThisEffect(),e.config.events&&(await e.drawEventCard(),e.config.thematicRebellion?(e.insertEventCard(af.SlaveRebellion).underCards(0),await e.shuffleTopThreeEventCards(),e.putBottomEventCardToTop(),e.putBottomEventCardToTop()):e.insertEventCard(af.SlaveRebellion).underCards(3))}})}}]},{name:"Rebellion",stages:[3],effects:[{textArea:[.503,.578],text:"On Each Board: Destroy 1 <town>. Add <strife> to any 2 <town>/<city>.",[yn.Now]:async({$:e})=>{await e.doMainEventActionOnEachBoard((async a=>{await a.forPiecesThatIs(e.Town).pickOne((async e=>{await e.destroy()}),{prompt:"Pick a <town> to Destroy.",highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <town>.`}),await a.forPiecesThatIs(e.TownOrCity).pickMultiple({amount:2,forPickedItem:async e=>{await e.addStrife()},effect:{prompt:"Pick <town>/<city> to add <strife>.",highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <town>/<city>.`}})}))}},{textArea:[.539,.608],text:"Then, every Invader takes 1 Damage per <strife> it has.",[yn.Now]:async({$:e})=>{await e.inLandsWithStrife().selectOrder().forEach((a=>e.doMainEventAction((()=>a.piecesWithStrife().forEach((async e=>{await e.damageOnlyThis(e.strife)}))),{land:a})),{noOptions:"No lands with <strife>."})}},{textArea:[.575,.679],text:"After finishing this Event Card, draw another one. This card is discarded.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({[yn.AfterResolvingEventCard]:async()=>{await e.clickToContinue(),e.removeThisEffect(),e.config.events&&await e.drawEventCard()}})}}]},{name:"Aid the Uprising",dahanEvent:!0,effects:[{textArea:[.809,.914],text:"Invaders with <strife> take 1 Damage per <dahan> present. Add 1 <dahan> per <town>/<city> this destroys.",[yn.Now]:async({$:e})=>{await e.inLandsWithStrife().where((a=>a.has(e.Dahan))).selectOrder().forEach((async a=>{const t=a.numberOf(e.Dahan);await e.doDahanEventAction((()=>a.piecesWithStrife().forEach((async n=>{const r=await n.damageOnlyThis(t);for(const{piece:t,removement:n}of r)t.isA(e.TownOrCity)&&pr[n].isDestroyLike&&await a.add(1,e.Dahan)}))),{land:a})}),{noOptions:"No lands with <strife> and <dahan>."})}}]}]},nf={set:a.BranchAndClaw,name:"Strange Tales Attract Explorers",events:[{name:"Strange Tales Attract Explorers",stages:[1],effects:[{textArea:[.107,.147],text:"Now: 1 <fear> per Spirit that has at least 1 <sacred>.",[yn.Now]:({$:e})=>e.doMainEventAction((async()=>{const a=e.spiritsWhich((e=>e.numberOfSacredSites>0)).count;await e.clickToContinue({noOptions:`${a} Spirit${a>1?"s":""} with <sacred> = ${a} <fear>.`}),await e.fear(a)}))},{textArea:[.14,.216],text:"After advancing Invaders Cards: Add 1 <explorer> to each land with <sacred>.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.StrangeTalesAttractExplorers,[yn.AfterAdvancingCards]:()=>e.inLandsWhere((e=>e.hasSacredSite)).forEach((a=>e.doMainEventAction((async()=>{await a.add(1,e.Explorer)}),{land:a}))),[yn.GlobalReminder]:()=>({icon:"+1 <explorer><br><sacred>"})})}}]},{name:"Fortification",stages:[2,3],effects:[{textArea:[.373,.518],text:"After advancing Invader Cards: Invaders Build in one terrain not shown under any Invader Action. (If there's no such terrain, nothing happens.)",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.Fortification,[yn.AfterAdvancingCards]:async()=>{const a=await e.pickTerrainsWhere((a=>!e.showingTerrainTypes.includes(a)),{noOptions:"No terrain types are not showing."});a&&await e.doExtraBuildInTerrain(a)},[yn.GlobalReminder]:()=>({icon:"Extra<br>Build"})})}}]},Sg,{name:"Coming of Age",dahanEvent:!0,effects:[{textArea:[.824,.904],text:"On Each Board: Add 1 <dahan> to a Mountain or Sands with <dahan>.",[yn.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((a=>a.inLandsWith(e.Dahan).where((e=>e.isMountainsOrSands)).pickOne((async a=>{await a.add(1,e.Dahan)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No Mountain or Sands with <dahan>.`})))}]}]},rf={name:"Blight Spreads",blightStatus:og.BlightedIsland,effects:[{textArea:[.371,.585],text:"On Each Board: Add 1 <blight> to a land adjacent to a land with <blight>.<br><br>Spirits may prevent this on any/all boards by destroying 2 <presence> from each board to be protected.",[yn.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>e.chooseBetween({highlightBoards:[a],prompt:`On board ${a.name}: choose between:`,effects:[{actionId:"AddBlight",textArea:[.371,.446],text:"Add 1 <blight> to a land adjacent to a land with <blight>",[yn.Now]:()=>a.inLocationsWhere((a=>a.isLandForBlight&&a.hasAdjacentLocationWhere((a=>a.isLandForBlight&&a.has(e.Blight))))).pickOne((async e=>{await e.addBlight(1)}),{prompt:"Pick land to add <blight>.",highlightBoards:[a],noOptions:`On board ${a.name}: No lands adjacent to a land with <blight>.`})},{actionId:"PreventByDestroyingPresence",textArea:[.472,.585],text:"Prevent this by destroying 2 <presence>.",[yn.Now]:()=>a.destroyPresence(2),condition:()=>a.numberOf(e.Presence)>=2}]})),{selectOrder:!0})}]},sf={set:a.BranchAndClaw,name:"Tight-Knit Communities",events:[{name:"Tight-Knit Communities",blightStatus:og.HealthyIsland,effects:[{textArea:[.107,.181],text:"For the rest of the turn, <town>/<city> have +1 Health.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.TightknitCommunities,[yn.AdjustHealth]:({piece:a})=>a.isA(e.TownOrCity)?1:0,[yn.GlobalReminder]:()=>({icon:"<town>/<city><br>+1 HP"})})}}]},rf,Fg(!1),{name:"Coming of Age",dahanEvent:!0,effects:[{textArea:[.821,.903],text:"On Each Board: Add 1 <dahan> to a Coastal land with <dahan>.",[yn.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((a=>a.inCoastalLands().where((a=>a.has(e.Dahan))).pickOne((async a=>{await a.add(1,e.Dahan)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No Coastal lands with <dahan>.`})))}]}]},of={set:a.BranchAndClaw,name:"Urban Development",events:[{name:"Urban Development",blightStatus:og.HealthyIsland,effects:[{textArea:[.107,.25],text:"During the next normal Ravage, each <city> does +2 Damage. (If there is no Ravage this Phase, leave this card by the Ravage Space until one happens.)",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffect({effectId:wn.UrbanDevelopment,[yn.AdjustIndividualInvaderRavageDamage]:({normal:a,piece:t})=>a&&t.isA(e.City)?2:0,[yn.AfterResolvingRavageCard]:()=>(e.removeThisEffect(),Promise.resolve()),[yn.GlobalReminder]:()=>({icon:"<city><br>+2 <damage>"})})}}]},{name:"Festering Pits of Blight",blightStatus:og.BlightedIsland,effects:[{textArea:[.371,.447],text:"On Each Board with Invaders: Add 1 <blight> to a land with at least 2 <blight>, but do not cascade.",[yn.Now]:({$:e})=>e.inBoardsWith(e.Invader).selectOrder().forEach((a=>e.doMainEventAction((()=>a.inLocationsWhere((a=>a.isLandForBlight&&a.hasAtLeast(2,e.Blight))).pickOne((async e=>{await e.addBlight(1,{mayCascade:!1})}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with at least 2 <blight>.`})),{board:a})))}]},Ug,Cg]},df={set:a.BranchAndClaw,banned:!0,name:"War Touches The Islands Shores",events:[{name:"War Touches The Islands Shores",fullText:["&nbsp;&nbsp;Invaders from a different faraway land assault the ones here, torching farms and bombarding Cities. You may:","Allow the Attacks","&nbsp;&nbsp;• For each board, discard the top Major Power. Deal its Energy in Damage to Invaders and the land in the Coastal land with the most <town>/<city> (minimum 1). Defend reduces the Damage to both Invaders and the Land.","Help Repel the Newcomers","&nbsp;&nbsp;Cost: 1 Energy per player.","&nbsp;&nbsp;• Add a Fear Card to the top of the Fear Deck."],effects:[{textArea:[.245,.607],text:"You may:<br><br>Allow the Attacks<or>Help Repel the Newcomers",[yn.Now]:async({$:e})=>{await e.chooseBetween({effects:[{actionId:"AllowTheAttacks",label:"Allow the Attacks",textArea:[.285,.462],text:"For each board, discard the top Major Power. Deal its Energy in Damage to Invaders and the land in the Coastal land with the most <town>/<city> (minimum 1). Defend reduces the Damage to both Invaders and the Land.",[yn.Now]:()=>e.doMainEventActionOnEachBoard((async a=>{await a.inCoastalLands().where((a=>a.has(e.TownOrCity))).withMost((a=>a.numberOf(e.TownOrCity))).pickOne((async a=>{const t=await e.drawAndDiscardPower(Sn.Major);if(void 0!==t){const n=sg[t].energy-a.defense;await e.addSubEffect({card:t,textArea:void 0,text:"Deal its Energy in Damage to Invaders and the land in the Coastal land with the most <town>/<city> (minimum 1). Defend reduces the Damage to both Invaders and the Land.",[yn.Now]:async()=>{n>0?(await a.damage(n),await a.damageLand(n)):await e.clickToContinue({noOptions:"Defend reduced the Damage to 0."})}})}}),{highlightBoards:[a],noOptions:`On board ${a.name}: no Coastal land with <town>/<city>.`})}),{selectOrder:!0})},{actionId:"RepelTheNewcomers",label:"Help Repel the Newcomers",condition:()=>e.playersCanJointlyPayEnergyAidedBy({energy:e.spiritCount}),effects:[{textArea:[.532,.572],text:"Cost: 1 Energy per player.",[yn.Now]:async()=>{await e.payEnergyJointlyAidedBy({energy:e.spiritCount})}},{textArea:[.567,.607],text:"Add a Fear Card to the top of the Fear Deck.",[yn.Now]:async()=>{await e.clickToContinue(),await e.addFearCards(1).toLevel(e.terrorLevel)}}]}]})}}]},{name:"Beasts Find New Homes",tokenEvent:!0,effects:[{textArea:[.627,.743],text:"On Each Board: Push 1 <beasts> to an adjacent land without <blight>. 1 <fear> if Invaders are present there.",[yn.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((async a=>(await e.countPieceOptionally(Bn.Beasts,(()=>a.forPiecesThatIs(e.Beasts,(a=>a.hasAdjacentLandWhere((a=>a.doesntHave(e.Blight)))))))).pickOne((async a=>{const t=await a.push({destinationFilter:a=>a.doesntHave(e.Blight)});t.length>0&&t[0].destination.hasInvaders&&await t[0].destination.fear(1)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No <beasts> adjacent to a land without <blight>.`})),{selectOrder:!0})}]},{name:"Reclaim Territory",dahanEvent:!0,effects:[{textArea:[.814,.923],text:"Each player may Push 1 <dahan> to an adjacent land, doing 1 Damage there.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doDahanEventAction((()=>e.forPiecesThatIs(e.Dahan).optionallyPickOne((async e=>{const a=await e.push();a.length>0&&await a[0].destination.damage(1)}),{noOptions:"No <dahan>."})))))}]}]},cf={set:a.BranchAndClaw,name:"Wave Of Reconnaissance",events:[{name:"Wave Of Reconnaissance",stages:[1],effects:[{textArea:[.108,.179],text:"When Exploring: Add 1 additional <explorer> to each land Explored.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.WaveOfReconnaissance,[yn.AfterSuccessfulExplore]:async({land:a})=>{await a.add(1,e.Explorer)},[yn.GlobalReminder]:()=>({icon:"+1 <explorer>"})})}}]},{name:"Urbanization",stages:[2,3],effects:[{textArea:[.371,.446],text:"In each land with at least 2 <town>, replace half the <town> (rounding up) with <city>.",[yn.Now]:({$:e})=>e.inLandsWhere((a=>a.hasAtLeast(2,e.Town))).selectOrder().forEach((a=>e.doMainEventAction((async()=>{const t=Math.ceil(a.numberOf(e.Town)/2);await a.replaceIndividually({amount:t,pieces:e.Town,withPiece:Bn.City})}),{land:a})),{noOptions:"No lands with at least 2 <town>."})}]},Yg,{name:"Retreat",dahanEvent:!0,effects:[{textArea:[.821,.899],text:"On Each Board: Push 2 <dahan> from a land with <city> to a land without <city>.",[yn.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((a=>a.forPiecesThatIs(e.Dahan,(a=>a.has(e.City)&&a.hasAdjacentLandWhere((a=>a.doesntHave(e.City))))).filteredByAnyInPriority((a=>a.location.hasAtLeast(2,e.Dahan))).pickOne((async a=>{const t=a.location,n=await a.push({withoutWait:t.numberOf(e.Dahan)>=2,destinationFilter:a=>a.doesntHave(e.City)});n.length>0&&t.has(e.Dahan)&&await t.piecesThatAre(e.Dahan).autoPickOne((async e=>{await e.push({pickDestinationEffect:{autoPlayOneOption:!0},destinationFilter:e=>e===n[0].destination})}))}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <dahan> and <city> adjacent to a land without <city>.`})),{selectOrder:!0})}]}]},lf={set:a.BranchAndClaw,name:"Well-prepared Explorers",events:[{name:"Well-prepared Explorers",blightStatus:og.HealthyIsland,effects:[{textArea:[.105,.145],text:"For the rest of this turn, <explorer> have +1 Health.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.WellpreparedExplorers,[yn.AdjustHealth]:({piece:a})=>a.isIgnoringCountAsA(e.Explorer)?1:0,[yn.GlobalReminder]:()=>({icon:"<explorer><br>+1 HP"})})}}]},rf,Kg,{name:"Coming of Age",dahanEvent:!0,effects:[{textArea:[.828,.904],text:"On Each Board: Add 1 <dahan> to an Inland with <dahan>.",[yn.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((a=>a.inInlandLands().where((a=>a.has(e.Dahan))).pickOne((async a=>{await a.add(1,e.Dahan)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No Inland lands with <dahan>.`})),{selectOrder:!0})}]}]},hf={set:a.BranchAndClaw,name:"Years Of Little Rain",events:[{name:"Years Of Little Rain",fullText:["&nbsp;&nbsp;A terrible drought parches the Island. You may:","Let the Plants die and the Land Wither","&nbsp;&nbsp;• For each board, discard the top Minor Power. If it lacks <water>, add 1 <blight> to a Sands.","&nbsp;&nbsp;• <town>, <city>, and <dahan> have -1 Health (minimum 1) until the end of the turn.","Act to Ease the Drought","&nbsp;&nbsp;Cost: 4 Energy per player. Aided by <water>.","&nbsp;&nbsp;• Each Spirit may add 1 <presence> to one of their lands with <dahan>."],effects:[{textArea:[.179,.549],text:"You may:<br><br>Let the Plants die and the Land Wither<or>Act to Ease the Drought",[yn.Now]:async({$:e})=>{await e.chooseBetween({effects:[{actionId:"LetThePlantsDie",label:"Let the Plants die and the Land Wither",effects:[{textArea:[.219,.299],text:"For each board, discard the top Minor Power. If it lacks <water>, add 1 <blight> to a Sands.",[yn.Now]:()=>e.doMainEventActionOnEachBoard((async a=>{const t=await e.drawAndDiscardPower(Sn.Minor);if(void 0===t)return;let n=!1;t===Mi.ElementalBoon&&(n=await e.may({text:"Do you want Elemental Boon to have <water>?"})),sg[t].elements.includes(nr.Water)||n?await e.clickToContinue({card:t,textArea:void 0,highlightBoards:[a],text:"The discarded Power has <water>:<br><br>Nothing happens."}):await e.addSubEffect({card:t,textArea:void 0,highlightBoards:[a],text:"If it lacks <water>, add 1 <blight> to a Sands.",[yn.Now]:()=>a.inSands().pickOne((async e=>{await e.addBlight(1)}))})}),{selectOrder:!0})},{textArea:[.294,.365],text:"<town>, <city>, and <dahan> have -1 Health (minimum 1) until the end of the turn.",[yn.Now]:async()=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.YearsOfLittleRain,[yn.AdjustHealth]:({piece:a})=>a.isOneOf(e.Town,e.City,e.Dahan)?-1:0,[yn.GlobalReminder]:()=>({icon:"-1 HP"})}),await e.globalHealthCheck()}}]},{actionId:"ActToEase",label:"Act to Ease the Drought",condition:()=>e.playersCanJointlyPayEnergyAidedBy({energy:4*e.spiritCount,element:nr.Water}),effects:[{textArea:[.44,.48],text:"Cost: 4 Energy per player. Aided by <water>.",[yn.Now]:async()=>{await e.payEnergyJointlyAidedBy({energy:4*e.spiritCount,element:nr.Water})}},{textArea:[.475,.544],text:"Each Spirit may add 1 <presence> to one of their lands with <dahan>.",[yn.Now]:()=>e.eachSpirit((a=>e.doMainEventAction((async()=>{a.presence().hasOneWhere((a=>a.location.has(e.Dahan)))?await a.addPresence({filter:a=>a.has(e.Dahan)}):await e.clickToContinue({noOptions:`${a.nameLink} has no lands with <dahan>.`})}))))}]}]})}}]},Sg,$g]},uf={name:"Coordinated Defense",dahanEvent:!0,effects:[{textArea:[.805,.918],text:"When Invaders Ravage, if the land has both <dahan> and <presence>, Defend 5.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.CoordinatedDefense,[yn.GlobalReminder]:()=>({icon:"Defend<br><dahan>+<presence>"}),[yn.DefendFromGame]:({land:a})=>a.has(e.Presence)&&a.numberOfParticipatingDahan>0?5:0})}}]},gf={set:a.JaggedEarth,name:"Bureaucrats Adjust Funding",events:[{name:"Bureaucrats Adjust Funding",terrorLevels:[1,2],effects:[{textArea:[.104,.177],text:"On Each Board with 9 or more <town>/<city>: Build Cards skip the highest-numbered matching land.",[yn.Now]:({$:e})=>e.inBoardsWhere((a=>a.numberOf(e.TownOrCity)>=9)).forEach((async a=>{for(const t of e.invaderCardsInVisibleSlot(Zl.Build)){const n=a.highestNumberedLandMatching(t,Hr.Build);await e.addSubEffectUntilEndOfTurn({effectId:wn.BureaucratsAdjustFunding,[yn.Reminder]:e=>e===n?"Build Cards skip the highest-numbered matching land.":void 0,[yn.PreventInvaderActionInLand]:async({land:a,invaderAction:r,card:i})=>r===Hr.Build&&i===t&&a===n&&(await e.sendEvent({type:fn.GenericSub,text:`The Build in land ${a.coordinateLink} was prevented by <e>BureaucratsAdjustFunding</e>.`}),!0)})}}),{noOptions:"No boards with 9 or more <town>/<city>."})},{textArea:[.168,.305],text:"On Each Board with 3 or fewer <town>/<city>: Build Cards cause 1 extra Build Action in the highest-numbered matching land. (This can affect a land without Invaders.)",[yn.Now]:({$:e})=>e.inBoardsWhere((a=>a.numberOf(e.TownOrCity)<=3)).forEach((async a=>{for(const t of e.invaderCardsInVisibleSlot(Zl.Build)){const n=a.highestNumberedLandMatching(t,Hr.Build);n&&await e.addSubEffectUntilEndOfTurn({effectId:wn.BureaucratsAdjustFunding,[yn.Reminder]:e=>e===n?"Build Cards cause 1 extra Build Action in the highest-numbered matching land.":void 0,[yn.AfterResolvingBuildCard]:async({card:a,normal:t})=>{t&&(await e.sendEvent({type:fn.GenericSub,text:`<e>BureaucratsAdjustFunding</e> caused an extra Build in land ${n.coordinateLink}.`}),await n.doNormalBuild(a),e.removeThisEffect())}})}}),{noOptions:"No boards with 3 or fewer <town>/<city>."})}]},{name:"Ransack and Run",terrorLevels:[3],effects:[{textArea:[.393,.5],text:"After the Ravage Step, On Each Board: In the land with the most <city> (min. 1), Ravage, then Remove 1 <city>.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.RansackAndRun,[yn.GlobalReminder]:()=>({icon:"Extra<br>Ravage"}),[yn.AfterTheNormalRavageStep]:()=>e.doMainEventActionOnEachBoard((a=>a.inLandsWithMostMinimumOne(e.City).pickOne((async a=>{await a.doExtraRavage(),await a.remove({amount:1,pieces:e.City})}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <city>.`})))})}}]},{name:"Terrifying Beasts",tokenEvent:!0,effects:[{textArea:[.64,.732],text:"2 <fear> per board with 2 or more <beasts>.",[yn.Now]:async({$:e})=>{const a=e.inBoardsWhere((a=>a.numberOf(e.Beasts)>=2));await e.clickToContinue({highlightBoards:a.items,noOptions:`${a.count} board${a.count>1?"s":""} = ${2*a.count} <fear>.`}),await e.doTokenEventAction((async()=>{await e.fear(2*a.count)}))}}]},uf]},ff={name:"Beasts chase off Homesteaders",tokenEvent:!0,effects:[{textArea:[.668,.738],text:"On Each Board: Push up to 2 <explorer> or 1 <town> from a land with <beasts>.",[yn.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((a=>a.forPiecesThatIs(e.ExplorerOrTown,(a=>a.has(e.Beasts))).optionallyPickOne((async a=>{const t=await a.push();t.length>0&&t[0].piece.isA(e.Explorer)&&await t[0].source.pushUpTo(1,e.Explorer)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No <explorer>/<town> in a land with <beasts>.`})),{selectOrder:!0})}]},pf={name:"Careful Defense",dahanEvent:!0,effects:[{textArea:[.82,.896],text:"When Invaders Ravage, if the land has <dahan>, Defend 2.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.CarefulDefense,[yn.GlobalReminder]:()=>({icon:"Defend<br><dahan>"}),[yn.DefendFromGame]:({land:e})=>e.numberOfParticipatingDahan>0?2:0})}}]},wf={set:a.JaggedEarth,name:"Cities Rise",events:[{name:"Cities Rise",blightStatus:og.HealthyIsland,effects:[{textArea:[.104,.223],text:"On Each Board: In the land with the most <town>, Replace 2 <town> with 2 <city>. (If there is only 1 <town>, instead Replace it with 1 <city>.)",[yn.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>a.inLandsWithMostMinimumOne(e.Town).pickOne((async a=>{const t=Math.min(a.numberOf(e.Town),2);await a.replaceIndividually({amount:t,pieces:e.Town,withPiece:Bn.City})}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <town>.`})))}]},{name:"Depleted Soil",blightStatus:og.BlightedIsland,effects:[{textArea:[.372,.451],text:"In lands with <town>/<city>, it only takes 1 Damage to add <blight>.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.DepletedSoil,[yn.AdjustLandHealth]:({land:a})=>a.has(e.TownOrCity)?-1:0,[yn.GlobalReminder]:()=>({icon:"Lands<br>-1 HP"})})}}]},ff,pf]},yf={set:a.JaggedEarth,name:"Civic Engagement",events:[{name:"Civic Engagement",blightStatus:og.HealthyIsland,effects:[{textArea:[.104,.221],text:"On Each Board: Remove 1 <strife>. If you can't Invaders do +1 Damage (per land) when Ravaging in lands with <town>/<city>.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.doMainEventActionOnEachBoard((async a=>{const t=a.forPiecesWhere((e=>e.strife>0));t.count>0?await t.pickOne((async e=>{await e.removeStrife()})):await e.addSubEffectUntilEndOfTurn({effectId:wn.CivicEngagement,[yn.GlobalReminder]:()=>({icon:`${a.name}<br>+1 <damage>`,text:`On board ${a.name}: +1 Damage (per land) when Ravaging in lands with <town>/<city>.`}),[yn.AdjustCollectiveInvaderRavageDamage]:({land:t})=>t.boards().has(a)&&t.participatingInvaders().where((a=>a.isA(e.TownOrCity))).count>0?1:0})}))}}]},{name:"Life's Web Torn Asunder",blightStatus:og.BlightedIsland,effects:[{textArea:[.373,.452],text:"On Each Board with 6 or more <blight>: Add 1 <blight> to a land adjacent to <blight>.",[yn.Now]:({$:e})=>e.inBoardsWhere((a=>a.numberOf(e.Blight)>=6)).selectOrder().forEach((a=>e.doMainEventAction((()=>a.inLocationsWhere((a=>a.isLandForBlight&&a.hasAdjacentLocationWithPiece(e.Blight))).pickOne((async e=>{await e.addBlight(1)}))),{board:a})),{noOptions:"No boards with 6 or more <blight>."})}]},{name:"Casualties of Fang and Sting",tokenEvent:!0,effects:[{textArea:[.667,.743],text:"On Each Board: Destroy 1 <explorer>/<town> in a land with <beasts>.",[yn.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((a=>a.forPiecesThatIs(e.ExplorerOrTown,(a=>a.has(e.Beasts))).pickOne((async e=>{await e.destroy()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <explorer>/<town> and <beasts>.`})),{selectOrder:!0})}]},{name:"Keep Far from the Lands of Plague",dahanEvent:!0,effects:[{textArea:[.839,.914],text:"On Each Board: Push 3 <dahan> from lands with <disease> to lands without <disease>.",[yn.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((a=>a.forPiecesThatIs(e.Dahan,(a=>a.has(e.Disease)&&a.hasAdjacentLandWhere((a=>a.doesntHave(e.Disease))))).pickMultiple({amount:3,effect:{highlightBoards:[a],noOptions:`On board ${a.name}: No such lands.`},forPickedItem:async a=>{await a.push({destinationFilter:a=>a.doesntHave(e.Disease)})}})))}]}]},mf={name:"Explorers Blunder",tokenEvent:!0,effects:[{textArea:[.651,.735],text:"On Each Board: Destroy 2 <explorer> among lands with <beasts>.",[yn.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((a=>a.forPiecesThatIs(e.Explorer,(a=>a.has(e.Beasts))).pickMultiple({amount:2,forPickedItem:async e=>{await e.destroy()},effect:{prompt:"Destroy <explorer> among lands with <beasts>.",highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <beasts> and <explorer>.`},repeatSame:!0})),{selectOrder:!0})}]},vf={set:a.JaggedEarth,name:"Coastal Towns Multiply",events:[{name:"Coastal Towns Multiply",blightStatus:og.HealthyIsland,effects:[{textArea:[.107,.183],text:"On Each Board: Add 1 <town> to a Coastal land adjacent to a Coastal <town>.",[yn.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>a.inCoastalLands().where((a=>!a.isIsolated&&a.hasAdjacentLandWhere((a=>a.isCoastal&&a.has(e.Town)&&!a.isIsolated)))).pickOne((async a=>{await a.add(1,e.Town)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No Coastal lands adjacent to a Coastal <town>.`})),{selectOrder:!0})}]},{name:"Cooperation Among Towns",blightStatus:og.BlightedIsland,effects:[{textArea:[.375,.453],text:"Invaders do +1 Damage (per land) when Ravaging in lands with <town>/<city> and no <strife>.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.CooperationAmongTowns,[yn.GlobalReminder]:()=>({icon:"<town>/<city><br>+1 <damage>"}),[yn.AdjustCollectiveInvaderRavageDamage]:({land:a})=>a.participatingInvaders().where((a=>a.isA(e.TownOrCity))).count>0&&!a.hasStrife?1:0})}}]},mf,{name:"Coming of Age",dahanEvent:!0,effects:[{textArea:[.82,.893],text:"On Each Board: Add 1 <dahan> to a land with <dahan> and no <blight>/<disease>.",[yn.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((a=>a.inLandsWith(e.Dahan).where((a=>a.dontHaveAnyOf(e.Blight,e.Disease))).pickOne((async a=>{await a.add(1,e.Dahan)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <dahan> and no <blight>/<disease>.`})))}]}]},Af={set:a.JaggedEarth,name:"Dahan Trade With The Invaders",events:[{name:"Dahan Trade With The Invaders",fullText:["&nbsp;&nbsp;Some seek knowledge, others are interested in tools and trade goods, still others simply curious. All hope to avoid violence, and the Invaders seem amenable - at least for now. You may:","Ignore their Interest","&nbsp;&nbsp;<dahan> do not participate in Ravages this turn.","Display Your Wrath at this Betrayal","&nbsp;&nbsp;Cost: 2 Energy per player, aided by <fire>.","&nbsp;&nbsp;Each Spirit with <dahan> in their lands Destroys 1 of them and generates 1 <fear>.","Change and Help them Learn from the Enemy","&nbsp;&nbsp;Cost: 6 Energy per player, aided by <air>.","&nbsp;&nbsp;<dahan> do not participate in Ravages this turn.","&nbsp;&nbsp;Each Spirit Forgets a Power Card.","&nbsp;&nbsp;From next turn on, each <dahan> provides Defend 1 in its land. (There is a Reminder Card for this.)"],effects:[{textArea:[.263,.743],text:"You may:<br><br>Ignore Their Interest<or>Display Your Wrath at this Betrayal<or>Change and Help them Learn from the Enemy",[yn.Now]:async({$:e})=>{await e.chooseBetween({effects:[{actionId:"IgnoreTheirInterest",label:"Ignore Their Interest",textArea:[.309,.349],text:"<dahan> do not participate in Ravages this turn.",[yn.Now]:async()=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.IgnoreTheirInterest,[yn.GlobalReminder]:()=>({icon:"<dahan><br>DNPIR"}),[yn.DoesNotParticipateInRavage]:async({location:a})=>{await a.doNotParticipateInRavage({pieces:e.Dahan})}})}},{actionId:"DisplayYourWrath",label:"Display Your Wrath at this Betrayal",textArea:[.436,.508],text:"Each Spirit with <dahan> in their lands Destroys 1 of them and generates 1 <fear>.",condition:()=>e.playersCanJointlyPayEnergyAidedBy({energy:2*e.spiritCount,element:nr.Fire}),[yn.Now]:async()=>{await e.addSubEffect({effects:[{textArea:[.399,.439],text:"Cost: 2 Energy per player, aided by <fire>.",[yn.Now]:async()=>{await e.payEnergyJointlyAidedBy({energy:2*e.spiritCount,element:nr.Fire})}},{[yn.Now]:()=>e.spiritsWhich((a=>a.hasPieceInLands(e.Dahan))).selectOrder().forEach((a=>e.doMainEventAction((async()=>{await a.forPiecesThatIs(e.Dahan).pickOne((async e=>{await e.destroy()}),{prompt:"Pick <dahan> to Destroy.",noOptions:`${a.nameLink} has no lands with <dahan>.`}),await e.fear(1)}))),{noOptions:"No spirits with <dahan> in their lands."})}]})}},{actionId:"ChangeAndHelp",label:"Change and Help them Learn from the Enemy",condition:()=>e.playersCanJointlyPayEnergyAidedBy({energy:6*e.spiritCount,element:nr.Air}),effects:[{textArea:[.561,.601],text:"Cost: 6 Energy per player, aided by <air>.",[yn.Now]:async()=>{await e.payEnergyJointlyAidedBy({energy:6*e.spiritCount,element:nr.Air})}},{textArea:[.594,.634],text:"<dahan> do not participate in Ravages this turn.",[yn.Now]:async()=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.ChangeAndHelp,[yn.GlobalReminder]:()=>({icon:"<dahan><br>DNPIR"}),[yn.DoesNotParticipateInRavage]:async({location:a})=>{await a.doNotParticipateInRavage({pieces:e.Dahan})}})}},{textArea:[.627,.667],text:"Each Spirit Forgets a Power Card.",[yn.Now]:()=>e.eachSpirit((a=>e.doMainEventAction((async()=>{await a.forgetPowers()}))))},{textArea:[.661,.731],text:"From next turn on, each <dahan> provides Defend 1 in its land.",[yn.Now]:async()=>{await e.clickToContinue();const a=e.turn+1;await e.addSubEffect({[yn.GlobalReminder]:()=>({icon:"Defend<br><dahan>",ongoing:!0}),[yn.DefendFromGame]:({land:t})=>e.turn>=a?t.numberOfParticipatingDahan:0})}}]}]})}}]},{name:"Outbreaks Shift",tokenEvent:!0,effects:[{textArea:[.839,.913],text:"On Each Board: Push 1 <disease> to the adjacent land with the most Invaders (min. 1).",[yn.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((a=>a.forPiecesThatIs(e.Disease,(a=>a.hasAdjacentLandWithPiece(e.Invader))).pickOne((async a=>{const t=a.location.inAdjacentLands().maxNumberOf((a=>a.numberOf(e.Invader)));await a.push({destinationFilter:a=>a.numberOf(e.Invader)===t})}),{prompt:"Pick a <disease> to Push."})),{selectOrder:!0})}]}]},If={set:a.JaggedEarth,name:"Eager Explorers",events:[{name:"Eager Explorers",terrorLevels:[1],effects:[{textArea:[.106,.217],text:"On Each Board: After the first successful Build Action, add 1 <explorer> to an adjacent land without Invaders.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.onEachBoard((async a=>{await e.addSubEffectUntilEndOfTurn({effectId:wn.EagerExplorers,[yn.GlobalReminder]:()=>({icon:"+1 <explorer>"}),[yn.AfterSuccessfulBuild]:async({land:t})=>{t.boards().has(a)&&(t.isIsolated||await t.inAdjacentLandsWhere((a=>a.doesntHave(e.Invader)&&!a.isIsolated)).pickOne((async a=>{await a.add(1,e.Explorer)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No adjacent lands without Invaders.`}),e.removeThisEffect())}})}))}}]},{name:"Xenophobia",terrorLevels:[2,3],effects:[{textArea:[.372,.485],text:"When Ravaging in lands with <dahan>, each individual Invader does -1 Damage to the land and +1 Damage to <dahan>.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.Xenophobia,[yn.GlobalReminder]:()=>({icon:"-1/+1 <damage>"}),[yn.AdjustIndividualInvaderRavageDamage]:({piece:e,towardsLand:a})=>e.isInvader&&e.location.numberOfParticipatingDahan>0?a?-1:1:0})}}]},ff,{name:"At Their Gates Demanding Redress",dahanEvent:!0,effects:[{textArea:[.857,.897],text:"2 <fear> per land with <dahan> and <city>.",[yn.Now]:async({$:e})=>{const a=e.inLandsWithAllOf(e.Dahan,e.City);await e.clickToContinue({highlightLocations:a.items,noOptions:`${a.count} land${a.count>1?"s":""} = ${2*a.count} <fear>.`}),await a.forEach((a=>e.doDahanEventAction((async()=>{await a.fear(2)}),{land:a})))}}]}]},xf={set:a.JaggedEarth,name:"Fortune-Seekers",events:[{name:"Fortune-Seekers",blightStatus:og.HealthyIsland,effects:[{textArea:[.106,.218],text:"The next Explore Card matches all lands without <town>/<city> instead of the printed land type. Ignore any <escalation> on it.",[yn.Now]:async({$:e})=>{await e.clickToContinue();let a=null;await e.addSubEffectUntilEndOfTurn({effectId:wn.Fortuneseekers,[yn.GlobalReminder]:()=>({icon:"Explore<br>Changed"}),[yn.OverrideMatchesInvaderCard]:({land:a,invaderAction:t})=>t===Hr.Explore?!a.has(e.TownOrCity):void 0,[yn.PreventEscalation]:({card:e})=>null===a?(a=e,Promise.resolve(!0)):Promise.resolve(!1),[yn.AfterResolvingExploreCard]:()=>(e.removeThisEffect(),Promise.resolve())})}}]},{name:"The land's Bounty Exhausted",blightStatus:og.BlightedIsland,effects:[{textArea:[.369,.442],text:"In lands without <presence>, it only takes 1 Damage to add <blight>.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.TheLandsBountyExhausted,[yn.AdjustLandHealth]:({land:a})=>a.doesntHave(e.Presence)?-1:0,[yn.GlobalReminder]:()=>({icon:"Land<br>-1 HP"})})}}]},Dg,{name:"Tell the Old Stories",dahanEvent:!0,effects:[{textArea:[.789,.93],text:"Each Spirit with at least 2 <dahan> among its lands either Reclaims 1 Power Card or re-gains a Unique Power it previously Forgot.",[yn.Now]:({$:e})=>e.spiritsWhich((a=>a.numberOfPiecesInLands(e.Dahan)>=2)).forEach((a=>e.doDahanEventAction((async()=>{await e.chooseBetween({players:[a],noOptions:`${a.nameLink} has no reclaimable/forgotten cards.`,effects:[{actionId:"Reclaim",text:"Reclaim 1 Power Card.",[yn.Now]:async()=>{await a.reclaim(1)},condition:()=>a.hasReclaimableCards},{actionId:"Regain",text:"Re-gain a previously Forgotten Unique Power.",condition:()=>a.availableRememberedUniques.length>0,[yn.Now]:async()=>{await a.gainPowerCard({fromSelection:a.availableRememberedUniques,taken:!0})}}]})}))),{noOptions:"No Spirit has at least 2 <dahan> among its lands."})}]}]},bf={set:a.JaggedEarth,name:"Gradual Corruption",events:[{name:"Gradual Corruption",blightStatus:og.HealthyIsland,effects:[{textArea:[.107,.352],text:"On Each Board: Add 1 <blight> to a land with <town>/<city>.<br><br>Spirits may prevent this on any/all boards py paying X Energy per board to protect where X is the number of cards in the Invader discard. (This may be 0.)",[yn.Now]:async({$:e})=>{const a=e.invaderCardsInVisibleSlot(Zl.Discard).length;await e.doMainEventActionOnEachBoard((t=>e.chooseBetween({prompt:`On board ${t.name}, choose between:`,highlightBoards:[t],effects:[{actionId:"AddBlight",text:"Add 1 <blight> to a land with <town>/<city>.",[yn.Now]:()=>t.inLandsWith(e.TownOrCity).pickOne((async e=>{await e.addBlight(1)}),{noOptions:"No lands with <town>/<city>."})},{actionId:"PreventByPayingEnergy",text:`Prevent <blight> by jointly paying ${a} Energy.`,[yn.Now]:async()=>{await e.payEnergyJointlyAidedBy({energy:a})},condition:()=>e.playersCanJointlyPayEnergyAidedBy({energy:a})}]})))}}]},{name:"Ravaged Wilderness",blightStatus:og.BlightedIsland,effects:[{textArea:[.418,.494],text:"On Each Board: Remove 1 <beasts> from a land with <blight>. Remove 1 <wilds> from a land with <blight>.",[yn.Now]:({$:e})=>e.doMainEventActionOnEachBoard((async a=>{await e.addSubEffect({effects:[{textArea:[.418,.494],text:"Remove 1 <beasts> from a land with <blight>.",[yn.Now]:()=>e.countPieceOnlyIfHavingPiece(Bn.Beasts,(()=>a.forPiecesThatIs(e.Beasts,(a=>a.has(e.Blight))))).pickOne((async e=>{await e.remove()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <beasts> and <blight>.`})},{textArea:[.452,.492],text:"Remove 1 <wilds> from a land with <blight>.",[yn.Now]:()=>a.forPiecesThatIs(e.Wilds,(a=>a.has(e.Blight))).pickOne((async e=>{await e.remove()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <wilds> and <blight>.`})}]})}))}]},{name:"Fatalities Rise",tokenEvent:!0,effects:[{textArea:[.617,.76],text:"In each land with <disease>, 1 Damage to each Invader and 1 Damage to each <dahan>. Remove 1 <disease> from each land where this Destroys any <town>/<city>.",[yn.Now]:({$:e})=>e.inLandsWith(e.Disease).selectOrder().forEach((a=>e.doTokenEventAction((async()=>{const t=await a.damageEach(1);await a.damageEach(1,e.Dahan),t.some((({removement:a,piece:t})=>pr[a].isDestroyLike&&t.isA(e.TownOrCity)))&&await a.removeOne(e.Disease)}),{land:a})),{noOptions:"No lands with <disease>."})}]},{name:"Blessings of Bounty and Health",dahanEvent:!0,effects:[{textArea:[.838,.914],text:"Each Spirit may add 1 <dahan> to one of its lands with <dahan>.",[yn.Now]:({$:e})=>e.eachSpirit((a=>e.doDahanEventAction((()=>a.inLandsWith(e.Dahan).optionallyPickOne((async a=>{await a.add(1,e.Dahan)}),{noOptions:`${a.nameLink} has no lands with <dahan>.`})))))}]}]},Tf={set:a.JaggedEarth,name:"Hard-Working Settlers",events:[{name:"Hard-Working Settlers",fullText:["&nbsp;&nbsp;The latest round of settlers are regrettably diligent, focused, and curious. You may:","Act Cautiously in the Background","&nbsp;&nbsp;• Push up to 2 <dahan>.","&nbsp;&nbsp;• Add 1 <town> to a land without <town>.","&nbsp;&nbsp;• Immediately Ravage in the land with the most Invaders that matches a Ravage Card.","Create Unnerving Distractions at the cost of piquing their interest.","&nbsp;&nbsp;• Ravage Cards skip up to one matching land on each board. (Players choose which.)","&nbsp;&nbsp;• 1 <fear> per player.","&nbsp;&nbsp;• Remove the bottommost Stage II and Stage III Cards in the Invader Deck from the game."],effects:[{textArea:[.197,.708],text:"You may:<br><br>Act Cautiously in the Background<or>Create Unnerving Distractions",[yn.Now]:async({$:e})=>{await e.doMainEventAction((async()=>{await e.chooseBetween({effects:[{actionId:"ActCautiously",label:"Act Cautiously in the Background",[yn.Now]:()=>e.doMainEventActionOnEachBoard((async a=>{await e.addSubEffect({highlightBoards:[a],effects:[{textArea:[.274,.314],text:"Push up to 2 <dahan>.",[yn.Now]:async()=>{const t=[];await a.forPiecesThatIs(e.Dahan).pickMultiple({amount:2,forPickedItem:async e=>{t.push(e),await e.push()},where:e=>!t.includes(e),optional:!0,repeatSame:!0,effect:{highlightBoards:[a],prompt:"Pick <dahan> to Push.",noOptions:`On board ${a.name}: No lands with <dahan>.`}})}},{textArea:[.308,.348],text:"Add 1 <town> to a land without <town>.",[yn.Now]:()=>a.inLandsWithout(e.Town).pickOne((async a=>{await a.add(1,e.Town)}),{prompt:"Pick a land to add 1 <town>.",highlightBoards:[a],noOptions:`On board ${a.name}: No lands without <town>.`})},{textArea:[.345,.418],text:"Immediately Ravage in the land with the most Invaders that matches a Ravage Card.",[yn.Now]:()=>a.inLandsWhere((a=>a.hasInvaders&&a.matchesInvaderCards(e.invaderCardsInVisibleSlot(Zl.Ravage),Hr.Ravage))).withMost((a=>a.numberOf(e.Invader))).pickOne((async e=>{await e.doExtraRavage()}),{prompt:"Pick a land to Ravage.",highlightBoards:[a],noOptions:`On board ${a.name}: No lands with Invaders match a Ravage Card.`})}]})}),{selectOrder:!0})},{actionId:"CreateUnnervingDistractions",label:"Create Unnerving Distractions",effects:[{textArea:[.523,.594],text:"Ravage Cards skip up to one matching land on each board. (Players choose which.)",[yn.Now]:async()=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.CreateUnnervingDistractions,[yn.GlobalReminder]:()=>({icon:"Skip<br>Ravage"}),[yn.BeforeResolvingInvaderCard]:async({card:a,invaderAction:t})=>{t===Hr.Ravage&&await e.doMainEventActionOnEachBoard((t=>t.inLandsWhere((e=>e.matchesInvaderCard(a,Hr.Ravage))).optionallyPickOne((async t=>{await e.addEffectUntilEndOfTurn({[yn.OverrideMatchesInvaderCard]:e=>(e.land!==t||e.card!==a||e.invaderAction!==Hr.Ravage)&&void 0})}))))}})}},{textArea:[.589,.629],text:"1 <fear> per player.",[yn.Now]:async()=>{await e.clickToContinue({noOptions:`${e.spiritCount} player${e.spiritCount>1?"s":""} = ${e.spiritCount} <fear>.`}),await e.doMainEventAction((async()=>{await e.fear(e.spiritCount)}))}},{textArea:[.624,.697],text:"Remove the bottommost Stage II and Stage III Cards in the Invader Deck from the game.",[yn.Now]:async()=>{await e.clickToContinue(),await e.removeBottomMostInvaderCardOfStage(2),await e.removeBottomMostInvaderCardOfStage(3)}}]}]})}))}}]},{name:"Beasts Prey on the Injured",tokenEvent:!0,effects:[{textArea:[.828,.868],text:"This turn, <beasts> also count as <badlands>.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.BeastsPreyOnTheInjured,[yn.BeastsCountAsBadlands]:()=>!0,[yn.GlobalReminder]:()=>({icon:"<beasts>=<badlands>"})})}},{textArea:[.863,.933],text:"On Each Board: Destroy a Damaged Invader in a land with <beasts>.",[yn.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((async a=>(await e.countPieceOptionally(Bn.Beasts,(()=>a.forPiecesWhere((a=>a.isInvader&&a.damage>0&&a.location.has(e.Beasts)))))).pickOne((async e=>{await e.destroy()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No Damaged Invader in a land with <beasts>.`})))}]}]},Ef={set:a.JaggedEarth,name:"Harvest Bounty, Harvest Dust",events:[{name:"Harvest Bounty, Harvest Dust",stages:[1,2],effects:[{textArea:[.106,.32],text:"If the island is Healthy, On Each Board: Choose a land with <town>/<city>. Ravage there.<br><br>If the island is Blighted, On Each Board: Push 1 <town> from a land with 2 or more <town>/<city> to a land without <town>/<city>.",[yn.Now]:async({$:e})=>{e.blightStatus===og.HealthyIsland?await e.addSubEffect({textArea:[.106,.187],text:"If the island is Healthy, On Each Board: Choose a land with <town>/<city>. Ravage there.",[yn.Now]:()=>e.doMainEventActionOnEachBoard((a=>a.inLandsWith(e.TownOrCity).pickOne((async e=>{await e.doExtraRavage()}))),{selectOrder:!0})}):await e.addSubEffect({textArea:[.21,.32],text:"If the island is Blighted, On Each Board: Push 1 <town> from a land with 2 or more <town>/<city> to a land without <town>/<city>.",[yn.Now]:()=>e.doMainEventActionOnEachBoard((a=>a.forPiecesThatIs(e.Town,(a=>a.hasAtLeast(2,e.TownOrCity)&&a.hasAdjacentLandWhere((a=>a.doesntHave(e.TownOrCity))))).pickOne((async a=>{await a.push({destinationFilter:a=>a.doesntHave(e.TownOrCity)})}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with 2 or more <town>/<city> adjacent to a land without <town>/<city>.`})),{selectOrder:!0})})}}]},{name:"Widespread Clearcutting",stages:[3],effects:[{textArea:[.394,.537],text:"On Each Board: Choose a land with <town>/<city>. Add 1 <blight> there, without cascading. Players may Destroy 2 <presence>/<dahan> in that land to prevent adding <blight>.",[yn.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>a.inLandsWith(e.TownOrCity).pickOne((async a=>{await e.chooseBetween({effects:[{actionId:"AddBlight",textArea:[.426,.466],text:"Add 1 <blight> there, without cascading.",[yn.Now]:async()=>{await a.addBlight(1,{mayCascade:!1})}},{actionId:"PreventByDestroyingPresence",textArea:[.429,.541],text:"Prevent adding <blight> by Destroying 2 <presence>/<dahan> in this land.",condition:()=>a.piecesWhere((a=>a.isPresence||a.isA(e.Dahan))).count>=2,[yn.Now]:async()=>{await a.destroy({amount:2,filter:a=>a.isPresence||a.isA(e.Dahan)})}}]})}))))}]},mf,{name:"Coordinated Strikes",dahanEvent:!0,effects:[{textArea:[.821,.894],text:"In each land with 3 or more <dahan>, 2 Damage and Defend 2.",[yn.Now]:async({$:e})=>{await e.inLandsWhere((a=>a.hasAtLeast(3,e.Dahan))).selectOrder().forEach((async e=>{await e.damage(2)}),{noOptions:"No lands with 3 or more <dahan>."}),await e.addSubEffectUntilEndOfTurn({effectId:wn.CoordinatedStrikes,[yn.GlobalReminder]:()=>({icon:"3 <dahan><br>Defend"}),[yn.DefendFromGame]:({land:e})=>e.numberOfParticipatingDahan>=3?2:0})}}]}]},Pf=e=>({name:"Prey on the Heedless",tokenEvent:!0,effects:[{textArea:e?[.66,.735]:[.653,.727],text:"In each land with <beasts>, 1 Damage per <beasts>.",[yn.Now]:({$:e})=>e.inLandsWith(e.Beasts).selectOrder().forEach((a=>e.doTokenEventAction((async()=>{await a.damage(a.numberOf(e.Beasts))}),{land:a})),{noOptions:"No lands with <beasts>."})}]}),Sf={set:a.JaggedEarth,name:"Invested Aristocracy",events:[{name:"Invested Aristocracy",stages:[1,2],effects:[{textArea:[.105,.217],text:"After the Ravage Step, On Each Board: If no <blight> was added to this board, add 1 <town> to the highest-numbered land with no Invaders.",[yn.Now]:async({$:e})=>{let a=[];await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.InvestedAristocracy,[yn.GlobalReminder]:()=>({icon:"+1 <town>"}),[yn.StartOfRavageStep]:()=>(a=e.boards.map((a=>a.numberOf(e.Blight))),Promise.resolve()),[yn.AfterTheNormalRavageStep]:()=>e.doMainEventActionOnEachBoard((async t=>{t.numberOf(e.Blight)<=a[t.boardIndex]&&await t.inLandsWhere((a=>a===t.highestNumberedLand((a=>a.doesntHave(e.Invader))))).pickOne((async a=>{await a.add(1,e.Town)}),{prompt:"Pick a land to add <town>.",highlightBoards:[t],noOptions:`On board ${t.name}: No lands without Invaders.`})}))})}}]},{name:"Foreign Dignitaries Visit",stages:[3],effects:[{textArea:[.369,.576],text:"If the island is Healthy, Ravages do +2 Damage (total) in the lowest-numbered matching land on each board.<br><br>If the island is Blighted, add 1 Fear Card to the top of the Fear Deck.",[yn.Now]:async({$:e})=>{e.blightStatus===og.HealthyIsland?await e.addSubEffect({textArea:[.369,.477],text:"If the island is Healthy, Ravages do +2 Damage (total) in the lowest-numbered matching land on each board.",[yn.Now]:async()=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.ForeignDignitariesVisit,[yn.GlobalReminder]:()=>({icon:"Ravage<br>+2 <damage>"}),[yn.BeforeResolvingInvaderCard]:async({card:a,invaderAction:t})=>{t===Hr.Ravage&&await e.onEachBoard((async t=>{const n=t.lowestNumberedLandMatching(a,Hr.Ravage);await e.addSubEffectUntilEndOfTurn({[yn.Reminder]:e=>e===n?"Ravages do +2 Damage (total).":void 0,[yn.AdjustCollectiveInvaderRavageDamage]:e=>e.land===n?2:0,[yn.AfterResolvingRavageCard]:()=>(e.removeThisEffect(),Promise.resolve())})}))}})}}):await e.addSubEffect({textArea:[.502,.576],text:"If the island is Blighted, add 1 Fear Card to the top of the Fear Deck.",[yn.Now]:async()=>{await e.clickToContinue(),await e.doMainEventAction((async()=>{await e.addFearCards(1).toLevel(e.terrorLevel)}))}})}}]},Pf(!1),{name:"Coming of Age",dahanEvent:!0,effects:[{textArea:[.821,.891],text:"On Each Board: Add 1 <dahan> to an land with 2 or more <dahan>.",[yn.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((a=>a.inLandsWhere((a=>a.hasAtLeast(2,e.Dahan))).pickOne((async a=>{await a.add(1,e.Dahan)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with 2 or more <dahan>.`})))}]}]},Of={name:"Return to Old Pillars",dahanEvent:!0,effects:[{textArea:[.803,.915],text:"On Each Board: Gather 1 or 2 <dahan> into a land with <dahan> Setup symbols.",[yn.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((a=>a.inLandsWhere((a=>a.setupSymbols.includes(Bn.Dahan)&&a.hasAdjacentLandWithPiece(e.Dahan))).pickOne((async a=>{await a.gather({quantifier:lr.UpToMinimumOne,amount:2,pieces:e.Dahan})}),{highlightBoards:[a]})),{selectOrder:!0})}]},Cf={set:a.JaggedEarth,name:"Lesser Spirits Imperiled",events:[{name:"Lesser Spirits Imperiled",fullText:["&nbsp;&nbsp;The Invaders' spread is threatening many of the island's smaller Spirits. You may:","Tend to your own Strength","&nbsp;&nbsp;• Each Spirit gains 1 Energy.","&nbsp;&nbsp;• Discard 1 Minor Power per player from the deck. For each with <plant>, Remove 1 <blight> from the Blight Card, returning it to the box. For each with <animal>, Destroy 1 <dahan> in a land with <blight>.","Forge a Web of Mutual Support","&nbsp;&nbsp;Cost: 4 Energy per player, aided by <plant>.","&nbsp;&nbsp;• Each Spirit Destroys 1 of their <presence>.","&nbsp;&nbsp;• Each Spirit gains 1 permanent Element for the rest of the game. (Choose separately, now.)"],effects:[{textArea:[.196,.6],text:"You may:<br><br>Tend to your own Strength<or>Forge a Web of Mutual Support",[yn.Now]:async({$:e})=>{await e.chooseBetween({effects:[{actionId:"TendToYourOwnStrength",label:"Tend to your own Strength",effects:[{textArea:[.23,.27],text:"Each Spirit gains 1 Energy.",[yn.Now]:async()=>{await e.clickToContinue(),await e.eachSpirit((a=>e.doMainEventAction((async()=>{await a.gainEnergy(1)}))))}},{textArea:[.265,.403],text:"Discard 1 Minor Power per player from the deck. For each with <plant>, Remove 1 <blight> from the Blight Card, returning it to the box. For each with <animal>, Destroy 1 <dahan> in a land with <blight>.",[yn.Now]:async()=>{await e.clickToContinue(),await e.eachSpirit((()=>e.doMainEventAction((async()=>{const a=await e.drawAndDiscardPower(Sn.Minor);void 0!==a&&await e.addSubEffect({textArea:[.265,.403],text:"Discard 1 Minor Power per player from the deck. For each with <plant>, Remove 1 <blight> from the Blight Card, returning it to the box. For each with <animal>, Destroy 1 <dahan> in a land with <blight>.",[yn.Now]:async()=>{const t=sg[a].elements?.includes(nr.Plant),n=sg[a].elements?.includes(nr.Animal);t&&await e.addSubEffect({card:a,textArea:void 0,text:"For each with <plant>, Remove 1 <blight> from the Blight Card, returning it to the box.",[yn.Now]:async()=>{await e.clickToContinue(),await e.removeBlightFromBlightCard(1)}}),n&&await e.addSubEffect({card:a,textArea:void 0,text:"For each with <animal>, Destroy 1 <dahan> in a land with <blight>.",[yn.Now]:async()=>{await e.clickToContinue(),await e.inLandsWithAllOf(e.Blight,e.Dahan).pickOne((async a=>{await a.destroyOne(e.Dahan)}),{noOptions:"No lands with <dahan> and <blight>."})}}),t||n||await e.clickToContinue({card:a,textArea:void 0,text:"The discarded Power has neither <plant> nor <animal>."})}})}))))}}]},{actionId:"ForgeAWeb",label:"Forge a Web of Mutual Support",condition:()=>e.playersCanJointlyPayEnergyAidedBy({energy:4*e.spiritCount,element:nr.Plant}),effects:[{textArea:[.457,.497],text:"Cost: 4 Energy per player, aided by <plant>.",[yn.Now]:async()=>{await e.payEnergyJointlyAidedBy({energy:4*e.spiritCount,element:nr.Plant})}},{textArea:[.49,.53],text:"Each Spirit Destroys 1 of their <presence>.",[yn.Now]:()=>e.eachSpirit((a=>e.doMainEventAction((async()=>{await a.destroyPresence(1)}))))},{textArea:[.523,.597],text:"Each Spirit gains 1 permanent Element for the rest of the game. (Choose separately, now.)",[yn.Now]:()=>e.eachSpirit((a=>e.doMainEventAction((async()=>{await a.gainElements({amount:1,forTheRestOfTheGame:!0})}))))}]}]})}}]},{name:"Quit the Farmed Lands",tokenEvent:!0,effects:[{textArea:[.633,.745],text:"On Each Board: Push 1 <beasts> to a land without <town>/<city>. 1 <fear> if <explorer> are present there.",[yn.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((async a=>(await e.countPieceOptionally(Bn.Beasts,(()=>a.forPiecesThatIs(e.Beasts,(a=>a.hasAdjacentLandWhere((a=>a.doesntHave(e.TownOrCity)))))))).pickOne((async a=>{const t=await a.push({destinationFilter:a=>a.doesntHave(e.TownOrCity)});t.length>0&&t[0].destination.has(e.Explorer)&&await t[0].destination.fear(1)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <beasts> adjacent to a land without <town>/<city>.`})),{selectOrder:!0})}]},Of]},Df={name:"A Thousand Small Struggles",tokenEvent:!0,effects:[{textArea:[.825,.934],text:"On Each Board with 4 or more <town>/<city> and 4 or fewer <dahan>: Add 1 <blight> to a land without <dahan>.",[yn.Now]:({$:e})=>e.inBoardsWhere((a=>a.numberOf(e.TownOrCity)>=4&&a.numberOf(e.Dahan)<=4)).selectOrder().forEach((a=>e.doTokenEventAction((()=>a.inLandsWithout(e.Dahan).pickOne((async e=>{await e.addBlight(1)}),{highlightBoards:[a]})),{board:a})),{noOptions:"No board with 4 or more <town>/<city> and 4 or fewer <dahan>."})}]},Bf={set:a.JaggedEarth,name:"Life's Balance Tilts",events:[{name:"Life's Balance Tilts",fullText:["&nbsp;&nbsp;The energies of life shift towards destruction, bringing wasting and disease to the animals of the island. Death is a part of life, but does this go too far? You may:","Let Destruction Have its Day","&nbsp;&nbsp;• On Each Board: Remove 1 <beasts>. Add 1 <disease>.","&nbsp;&nbsp;• For Each Board: Discard the top Minor Power. If it is <fast>, add 1 <blight>.","&nbsp;&nbsp;• Invaders and <dahan> have -1 Health (min. 1) this turn.","Fortify the Resilience of Life","&nbsp;&nbsp;Cost: 4 Energy per player, aided by <animal>.","&nbsp;&nbsp;• On Each Board: Add 1 <beasts>. Remove 1 <disease>.","&nbsp;&nbsp;• For Each Board: Discard the top Minor Power. If it is <slow>, Remove 1 <blight>.","&nbsp;&nbsp;• Invaders and <dahan> have +1 Health this turn."],effects:[{textArea:[.273,.709],text:"You may:<br><br>Let Destruction Have its Day<or>Fortify the Resilience of Life",[yn.Now]:async({$:e})=>{await e.chooseBetween({effects:[{actionId:"LetDestructionHaveItsDay",label:"Let Destruction Have its Day",effects:[{textArea:[.311,.351],text:"On Each Board: Remove 1 <beasts>. Add 1 <disease>.",[yn.Now]:()=>e.doMainEventActionOnEachBoard((async a=>{await e.countPieceOnlyIfHavingPiece(Bn.Beasts,(()=>a.forPiecesThatIs(e.Beasts))).pickOne((async e=>{await e.remove()}),{highlightBoards:[a],text:"Remove 1 <beasts>.",noOptions:`On board ${a.name}: No lands with <beasts>.`}),await a.inLands().pickOne((async a=>{await a.add(1,e.Disease)}),{highlightBoards:[a],text:"Add 1 <disease>."})}))},{textArea:[.348,.419],text:"For Each Board: Discard the top Minor Power. If it is <fast>, add 1 <blight>.",[yn.Now]:async()=>{await e.clickToContinue(),await e.doMainEventActionOnEachBoard((async a=>{const t=await e.drawAndDiscardPower(Sn.Minor);void 0!==t&&sg[t].speed===rr.Fast?await e.addSubEffect({card:t,textArea:void 0,text:"If it is <fast>, add 1 <blight>.",[yn.Now]:()=>a.inLocationsWhere((e=>e.isLandForBlight)).pickOne((async e=>{await e.addBlight(1)}),{highlightBoards:[a]})}):await e.clickToContinue({text:"Discarded Power was <slow>. Nothing happens.",card:t,textArea:void 0,highlightBoards:[a]})}))}},{textArea:[.414,.454],text:"Invaders and <dahan> have -1 Health (min. 1) this turn.",[yn.Now]:async()=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.LetDestructionHaveItsDay,[yn.GlobalReminder]:()=>({icon:"-1 HP"}),[yn.AdjustHealth]:({piece:a})=>a.isOneOf(e.Invader,e.Dahan)?-1:0}),await e.globalHealthCheck()}}]},{actionId:"FortifyTheResilienceOfLife",label:"Fortify the Resilience of Life",condition:()=>e.playersCanJointlyPayEnergyAidedBy({energy:4*e.spiritCount,element:nr.Animal}),effects:[{textArea:[.525,.565],text:"Cost: 4 Energy per player, aided by <animal>.",[yn.Now]:async()=>{await e.payEnergyJointlyAidedBy({energy:4*e.spiritCount,element:nr.Animal})}},{textArea:[.558,.598],text:"On Each Board: Add 1 <beasts>. Remove 1 <disease>.",[yn.Now]:()=>e.doMainEventActionOnEachBoard((async a=>{await a.inLands().pickOne((async a=>{await a.add(1,e.Beasts)}),{text:"Add 1 <beasts>.",highlightBoards:[a]}),await a.forPiecesThatIs(e.Disease).pickOne((async e=>{await e.remove()}),{text:"Remove 1 <disease>.",highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <disease>.`})}))},{textArea:[.59,.661],text:"For Each Board: Discard the top Minor Power. If it is <slow>, Remove 1 <blight>.",[yn.Now]:async()=>{await e.clickToContinue(),await e.doMainEventActionOnEachBoard((async a=>{const t=await e.drawAndDiscardPower(Sn.Minor);void 0!==t&&sg[t].speed===rr.Slow?await e.addSubEffect({card:t,text:"If it is <slow>, Remove 1 <blight>.",textArea:void 0,[yn.Now]:()=>a.forPiecesThatIs(e.Blight).pickOne((async e=>{await e.location.removeBlight()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <blight>.`})}):await e.clickToContinue({text:"Discarded Power was <fast>. Nothing happens.",card:t,textArea:void 0,highlightBoards:[a]})}))}},{textArea:[.66,.7],text:"Invaders and <dahan> have +1 Health this turn.",[yn.Now]:async()=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.FortifyTheResilienceOfLife,[yn.GlobalReminder]:()=>({icon:"+1 HP"}),[yn.AdjustHealth]:({piece:a})=>a.isOneOf(e.Invader,e.Dahan)?1:0})}}]}]})}}]},Df]},kf={set:a.JaggedEarth,name:"Mapmakers Chart The Wild",events:[{name:"Mapmakers Chart The Wild",stages:[1,2],effects:[{textArea:[.107,.147],text:"Ignore <wilds> during the Explore Step.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.MapmakersChartTheWild,[yn.GlobalReminder]:()=>({icon:"Ignore<br><wilds>"}),[yn.IgnoreWildsDuringExplore]:()=>!0})}},{textArea:[.141,.216],text:"On Each Board without <wilds>: Explore Actions add +1 <explorer> (in each land successfully Explored).",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.inBoardsWhere((a=>0===a.numberOf(e.Wilds))).forEach((async a=>{await e.addSubEffectUntilEndOfTurn({text:`On board ${a.name}: Explore Actions add +1 <explorer> (in each land successfully Explored).`,[yn.GlobalReminder]:()=>({icon:`${a.name}<br>+1 <explorer>`}),[yn.AfterSuccessfulExplore]:async({land:t})=>{t.boards().has(a)&&await t.add(1,e.Explorer)}})}))}}]},{name:"Increasing Aggression",stages:[3],effects:[{textArea:[.367,.442],text:"Invaders do +1 Damage (per land) when Ravaging.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.IncreasingAggression,[yn.GlobalReminder]:()=>({icon:"+1 <damage>"}),[yn.AdjustCollectiveInvaderRavageDamage]:()=>1})}}]},Pf(!1),{name:"Coming of Age",dahanEvent:!0,effects:[{textArea:[.819,.9],text:"On Each Board: Add 1 <dahan> to a land with <dahan> and no <badlands>/<beasts>/<disease>/<wilds>.",[yn.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((async a=>{e.dontCountAs(Bn.Badlands),e.dontCountAs(Bn.Beasts),await a.inLandsWith(e.Dahan).where((a=>!a.hasOneOf(e.Badlands,e.Beasts,e.Disease,e.Wilds))).pickOne((async a=>{await a.add(1,e.Dahan)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <dahan> and no <badlands>/<beasts>/<disease>/<wilds>.`})}))}]}]},Lf={set:a.JaggedEarth,name:"No Bravery Without Numbers",events:[{name:"No Bravery Without Numbers",stages:[1,2],effects:[{textArea:[.107,.216],text:"Invaders do not Ravage in lands unless there are more Invaders than the current Terror Level.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.NoBraveryWithoutNumbers,[yn.GlobalReminder]:()=>({icon:"Skip<br>Ravage"}),[yn.PreventInvaderActionInLand]:({land:a,invaderAction:t})=>Promise.resolve(a.participatingInvaders().count<=e.terrorLevel&&t===Hr.Ravage)})}}]},{name:"Courage of the Crowd",stages:[3],effects:[{textArea:[.368,.476],text:"Invaders do not Ravage in lands unless there are more Invaders than the current Terror Level.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.CourageOfTheCrowd,[yn.GlobalReminder]:()=>({icon:"Skip<br>Ravage"}),[yn.PreventInvaderActionInLand]:({land:a,invaderAction:t})=>Promise.resolve(a.participatingInvaders().count<=e.terrorLevel&&t===Hr.Ravage)})}},{textArea:[.502,.542],text:"Ravage actions do +2 Damage (per land).",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.CourageOfTheCrowd,[yn.GlobalReminder]:()=>({icon:"+2 <damage>"}),[yn.AdjustCollectiveInvaderRavageDamage]:()=>2})}}]},Pf(!1),{name:"Leave the Hostile Land",dahanEvent:!0,effects:[{textArea:[.807,.914],text:"In each land, Push 1 <dahan> per <badlands>/<disease> to lands without <badlands>/<disease>.",[yn.Now]:({$:e})=>e.inLands().where((a=>a.hasAllOf(e.Dahan,e.BadlandsOrDisease))).selectOrder().forEach((a=>e.doDahanEventAction((async()=>{await a.possiblyDontCountPiecesAs(Bn.Badlands),await a.push({amount:a.numberOf(e.BadlandsOrDisease),pieces:e.Dahan,destinationFilter:a=>a.doesntHave(e.BadlandsOrDisease)})}),{land:a})),{noOptions:"No lands with <dahan> and <badlands>/<disease>."})}]}]},Ff={name:"Plagues Bring Fear and Death",tokenEvent:!0,effects:[{textArea:[.667,.707],text:"1 <fear> per board with <disease>.",[yn.Now]:async({$:e})=>{const a=e.inBoardsWith(e.Disease);await e.clickToContinue({highlightBoards:a.items,noOptions:`${a.count} board${a.count>1?"s":""} = ${a.count} <fear>.`}),await e.doTokenEventAction((async()=>{await e.fear(a.count)}))}},{textArea:[.699,.739],text:"On Each Board: 2 Damage to <dahan> in a land with <disease>.",[yn.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((a=>a.inLandsWithAllOf(e.Disease,e.Dahan).pickOne((async a=>{await a.damage(2,e.Dahan)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <dahan> and <disease>.`})))}]},Rf={set:a.JaggedEarth,name:"Numinous Crisis",events:[{name:"Numinous Crisis",fullText:["&nbsp;&nbsp;The spiritual energy of the island weakens as life's connections grow ever more tattered. You may:","Draw Strength from it while you can","&nbsp;&nbsp;• Remove 1 <blight> per player from the Blight Card. Then if the Blight Card has not flipped, keep Removing <blight> until it flips. Gain 3 Energy per <blight> Removed, divided as evenly as possible among all Spirits.","Pour your Strength into the Island","&nbsp;&nbsp;• Each Spirit either pays 3 Energy, Forgets 2 Power Cards, or return 1 <presence> to their <presence> tracks.","&nbsp;&nbsp;• Add 1 <blight> per Spirit to the Blight Card (from the box)."],effects:[{textArea:[.193,.601],text:"You may:<br><br>Draw Strength from it while you can<or>Pour your Strength into the Island",[yn.Now]:async({$:e})=>{await e.chooseBetween({effects:[{actionId:"DrawStrength",label:"Draw Strength from it while you can",textArea:[.229,.404],text:"Remove 1 <blight> per player from the Blight Card. Then if the Blight Card has not flipped, keep Removing <blight> until it flips. Gain 3 Energy per <blight> Removed, divided as evenly as possible among all Spirits.",[yn.Now]:async()=>{await e.clickToContinue(),await e.doMainEventAction((async()=>{let a=e.spiritCount;for(await e.removeBlightFromBlightCard(a);void 0===e.blightCardActive;)await e.removeBlightFromBlightCard(1),a+=1;await e.clickToContinue({textArea:[.299,.404],text:"Gain 3 Energy per <blight> Removed, divided as evenly as possible among all Spirits.",noOptions:`Removed ${a} <blight> = ${3*a} energy.`}),await e.gainEnergyDividedEvenly(3*a)}))}},{actionId:"PourYourStrength",label:"Pour your Strength into the Island",effects:[{textArea:[.457,.529],text:"Each Spirit either pays 3 Energy, Forgets 2 Power Cards, or return 1 <presence> to their <presence> tracks.",[yn.Now]:()=>e.eachSpirit((a=>e.doMainEventAction((()=>e.chooseBetween({effects:[{actionId:"PayEnergy",textArea:[.457,.497],text:"Pay 3 Energy.",condition:()=>a.energy>=3,[yn.Now]:async()=>{await a.payEnergy(3)}},{actionId:"ForgetPowerCards",textArea:[.457,.528],text:"Forget 2 Power Cards.",condition:()=>a.nonBlessedPowerCards.length>=2,[yn.Now]:async()=>{await a.forgetPowers({amount:2})}},{actionId:"ReturnPresence",textArea:[.492,.532],text:"Return 1 <presence> to the <presence> tracks.",[yn.Now]:async()=>{await a.destroyPresence(1,Nn.Silent),await a.returnPresenceToTracks(1)}}]})))))},{textArea:[.523,.598],text:"Add 1 <blight> per Spirit to the Blight Card (from the box).",[yn.Now]:async()=>{await e.clickToContinue({noOptions:`${e.spiritCount} Spirit${e.spiritCount>1?"s":""} = ${e.spiritCount} <blight>.`}),await e.doMainEventAction((async()=>{await e.addBlightToBlightCard(e.spiritCount)}))}}]}]})}}]},Ff,pf]},Nf={set:a.JaggedEarth,name:"Overconfidence",events:[{name:"Overconfidence",terrorLevels:[1],effects:[{textArea:[.107,.317],text:"If you have any Earned Fear Cards, discard 2 of them now (so you don't get their text benefits).<br><br>Otherwise, move 2 Earned <fear> Markers per player to the top of the Fear pool.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.doMainEventAction((async()=>{e.fearCardsEarnedCount>0?await e.discardEarnedFearCards(2):await e.loseFear(2)}))}}]},{name:"Terror Breeds Aggression",terrorLevels:[2,3],effects:[{textArea:[.383,.495],text:"For every 2 Fear Cards currently in the Earned Fear Cards pile, Invaders do +1 Damage (per land) when Ravaging.",[yn.Now]:async({$:e})=>{await e.clickToContinue();const a=Math.floor(e.fearCardsEarnedCount/2);a>0&&await e.addSubEffectUntilEndOfTurn({effectId:wn.TerrorBreedsAggression,[yn.GlobalReminder]:()=>({icon:`+${a} <damage>`}),[yn.AdjustCollectiveInvaderRavageDamage]:()=>a})}}]},{name:"Beasts Multiply",tokenEvent:!0,effects:[{textArea:[.63,.742],text:"On Each Board: Add 1 <beasts> to a land adjacent to <beasts>, then Destroy 1 <dahan> in a land with <beasts>.",[yn.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((async a=>{await(await e.countPieceOptionally(Bn.Beasts,(()=>a.inLandsWhere((a=>a.hasAdjacentLandWithPiece(e.Beasts)))))).pickOne((async a=>{await a.add(1,e.Beasts)}),{textArea:[.664,.704],text:"Add 1 <beasts> to a land adjacent to <beasts>",highlightBoards:[a],noOptions:`On board ${a.name}: No land adjacent to <beasts>.`}),await a.forPiecesThatIs(e.Dahan,(a=>a.has(e.Beasts))).pickOne((async e=>{await e.destroy()}),{textArea:[.664,.738],text:"Destroy 1 <dahan> in a land with <beasts>.",highlightBoards:[a],noOptions:`On board ${a.name}: No land with <dahan> and <beasts>.`})}),{selectOrder:!0})}]},uf]},$f={set:a.JaggedEarth,name:"Provincial Seat",events:[{name:"Provincial Seat",blightStatus:og.HealthyIsland,effects:[{textArea:[.107,.179],text:"On Each Board: Choose a land with <city>. Build there.",[yn.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>a.inLandsWith(e.City).pickOne((async e=>{await e.doExtraBuild()}))))}]},{name:"Lands Hollow of Promise",blightStatus:og.BlightedIsland,effects:[{textArea:[.373,.579],text:"On Each Board: Add 1 <blight> to a land without <presence>.<br><br>Spirits may prevent this on any/all boards by Destroying 2 <presence> from each board to be protected.",[yn.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>e.chooseBetween({highlightBoards:[a],prompt:`On board ${a.name}, choose between:`,effects:[{actionId:"AddBlight",textArea:[.37,.443],text:"Add 1 <blight> to a land without <presence>.",prompt:"Pick land to add <blight>.",[yn.Now]:()=>a.inLocationsWhere((a=>a.isLandForBlight&&a.doesntHaveIgnoringCountAs(e.Presence))).pickOne((async e=>{await e.addBlight(1)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands without <presence>.`})},{actionId:"PreventByDestroyingPresence",textArea:[.472,.577],text:"Prevent this by destroying 2 <presence>.",[yn.Now]:()=>a.destroyPresence(2),condition:()=>a.numberOf(e.Presence)>=2}]})))}]},ff,{name:"Rally to the Defense of Distant Kin",dahanEvent:!0,effects:[{textArea:[.837,.914],text:"On Each Board: Gather 1 <dahan> into a land with <dahan>. In that land, Defend 1 per <dahan>.",[yn.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((a=>a.inLandsWith(e.Dahan).pickOne((async a=>{await a.gatherOne(e.Dahan),await a.defend(a.numberOf(e.Dahan))}))),{selectOrder:!0})}]}]},Wf={set:a.JaggedEarth,name:"Pull Together In Adversity",events:[{name:"Pull Together In Adversity",terrorLevels:[1,2],effects:[{textArea:[.105,.176],text:"For the rest of this turn, ignore 1 <strife> on each Invader. (This includes not removing that <strife>.)",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.PullTogetherInAdversity,[yn.GlobalReminder]:()=>({icon:"Ignore<br><strife>"}),[yn.IgnoreOneStrife]:()=>!0})}}]},{name:"Purge the Land with Salt and Fire",terrorLevels:[3],effects:[{textArea:[.368,.476],text:"On Each Board in a land with 2 or more <town>:<br>Add 1 <blight> without cascading. Add 2 <badlands>. Remove all <town>.",[yn.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>a.inLandsWhere((a=>a.hasAtLeast(2,e.Town))).pickOne((async a=>{await a.addBlight(1,{mayCascade:!1}),await a.add(2,e.Badlands),await a.remove({quantifier:lr.All,pieces:e.Town})}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with 2 or more <town>.`})),{selectOrder:!0})}]},mf,pf]},Mf={set:a.JaggedEarth,name:"Relentless Optimism",events:[{name:"Relentless Optimism",terrorLevels:[1],effects:[{textArea:[.107,.183],text:"For the rest of this turn, don't generate <fear> for Destroying <town>/<city>.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.RelentlessOptimism,[yn.GlobalReminder]:()=>({icon:"No <fear><br><town>/<city>"}),[yn.PreventFearGeneration]:({fromDestroyingBuildings:e})=>Promise.resolve(e)})}}]},{name:"Cultures Mix and Clash",terrorLevels:[2,3],effects:[{textArea:[.406,.584],text:"On Each Board: If <dahan> outnumber <town>/<city> by 2 or more, Replace 1 <town> with 1 <dahan>.<br><br>If <town>/<city> outnumber <dahan> by 2 or more, Replace 1 <dahan> with 1 <town>.",[yn.Now]:({$:e})=>e.doMainEventActionOnEachBoard((async a=>{a.numberOf(e.Dahan)>=a.numberOf(e.TownOrCity)+2?await a.forPiecesThatIs(e.Town).pickOne((async e=>{await e.replace([Bn.Dahan])}),{textArea:[.407,.48],text:"If <dahan> outnumber <town>/<city> by 2 or more, Replace 1 <town> with 1 <dahan>.",highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <town>.`}):a.numberOf(e.TownOrCity)>=a.numberOf(e.Dahan)+2?await a.forPiecesThatIs(e.Dahan).pickOne((async e=>{await e.replace([Bn.Town])}),{textArea:[.508,.582],text:"If <town>/<city> outnumber <dahan> by 2 or more, Replace 1 <dahan> with 1 <town>.",highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <dahan>.`}):await e.clickToContinue({noOptions:`On board ${a.name}: Neither applies.`})}))}]},{name:"Foreign Diseases",tokenEvent:!0,effects:[{textArea:[.637,.742],text:"On Each Board, in the land with the most combined Invaders + <dahan> (min. 1 of each): Add 1 <disease>. 2 Damage to <dahan>.",[yn.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((a=>a.inLandsWithAllOf(e.Invader,e.Dahan).withMost((a=>a.numberOf(e.InvaderOrDahan))).pickOne((async a=>{await a.add(1,e.Disease),await a.damage(2,e.Dahan)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with Invaders and <dahan>.`})))}]},Hg]},Gf={set:a.JaggedEarth,name:"Remnants Of A Spirits Heart",events:[{name:"Remnants Of A Spirits Heart",fullText:["&nbsp;&nbsp;A group of Dahan find a stony ridge with lingering blessings from an ancient mountain-Spirit. You may:","Leave its Strength with the Dahan","&nbsp;&nbsp;• <dahan> have +10 Health this turn.","&nbsp;&nbsp;• In lands with <dahan>, Invaders have +1 Health this turn.","With Patient Focus Craft a Great Warding","&nbsp;&nbsp;Cost: 4 Energy per player, aided by <earth>.","&nbsp;&nbsp;• Defend from Spirits is 4 lower per land this turn (min.0).","&nbsp;&nbsp;• During one future Spirit Phase, players may jointly decide to grant Defend 4 to all lands that turn. (There is a Reminder Card for this.)"],effects:[{textArea:[.207,.592],text:"You may:<br><br>Leave its Strength with the Dahan<or>With Patient Focus Craft a Great Warding",[yn.Now]:async({$:e})=>{await e.doMainEventAction((async()=>{await e.chooseBetween({effects:[{actionId:"LeaveItsStrength",label:"Leave its Strength with the Dahan",effects:[{textArea:[.242,.282],text:"<dahan> have +10 Health this turn.",[yn.Now]:async()=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.LeaveItsStrength,[yn.GlobalReminder]:()=>({icon:"<dahan><br>+10 HP"}),[yn.AdjustHealth]:({piece:a})=>a.isA(e.Dahan)?10:0})}},{textArea:[.276,.316],text:"In lands with <dahan>, Invaders have +1 Health this turn.",[yn.Now]:async()=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.LeaveItsStrength,[yn.GlobalReminder]:()=>({icon:"Invaders<br>+1 HP"}),[yn.AdjustHealth]:({piece:a})=>a.isInvader&&a.location?.has(e.Dahan)?1:0,[yn.AfterRemovePiece]:async({piece:a,location:t})=>{a.isA(e.Dahan)&&await t.healthCheck()}})}}]},{actionId:"CraftAGreatWarding",label:"With Patient Focus Craft a Great Warding",condition:()=>e.playersCanJointlyPayEnergyAidedBy({energy:4*e.spiritCount,element:nr.Earth}),effects:[{textArea:[.377,.417],text:"Cost: 4 Energy per player, aided by <earth>.",[yn.Now]:async()=>{await e.payEnergyJointlyAidedBy({energy:4*e.spiritCount,element:nr.Earth})}},{textArea:[.414,.483],text:"Defend from Spirits is 4 lower per land this turn (min.0).",[yn.Now]:async()=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.CraftAGreatWardingUntilEndOfTurn,[yn.GlobalReminder]:()=>({icon:"Defend<br>4 lower"}),[yn.DefendFromSpirits]:()=>-4})}},{textArea:[.479,.585],text:"During one future Spirit Phase, players may jointly decide to grant Defend 4 to all lands that turn. (There is a Reminder Card for this.)",[yn.Now]:async()=>{await e.clickToContinue(),await e.addSubEffect({effectId:wn.CraftAGreatWardingOngoing,[yn.GlobalReminder]:()=>({icon:"Defend<br>4 to All",ongoing:!0}),[yn.ExtraAction]:({effect:a})=>({actionId:"GreatWarding",[yn.Now]:async()=>{await e.addSubEffectUntilEndOfTurn({text:"Defend 4 to all lands.",[yn.DefendFromGame]:()=>4}),e.removeEffect(a)}})})}}]}]})}))}}]},{name:"Hunting Parties",tokenEvent:!0,effects:[{textArea:[.653,.73],text:"For each land with <beasts> and <city>: 1 <fear> and Destroy 1 <beasts> there.",[yn.Now]:({$:e})=>e.inLandsWithAllOf(e.Beasts,e.City).selectOrder().forEach((a=>e.doTokenEventAction((async()=>{await a.possiblyDontCountPiecesAs(Bn.Beasts),a.has(e.Beasts)&&(await a.fear(1),await a.destroyOne(e.Beasts,{autoPlay:!0}))}),{land:a})),{noOptions:"No lands with <beasts> and <city>."})}]},Df]},Hf={name:"Offerings of Story and Season",dahanEvent:!0,effects:[{textArea:[.804,.913],text:"Each Spirit with at least 3 <dahan> among its lands gains 1 Energy and may Reclaim 1 Card.",[yn.Now]:({$:e})=>e.spiritsWhich((a=>a.numberOfPiecesInLands(e.Dahan)>=3)).forEach((a=>e.doDahanEventAction((async()=>{await a.gainEnergy(1),await a.reclaim(1)}))),{noOptions:"No Spirits with at least 3 <dahan> among all its lands."})}]},jf={set:a.JaggedEarth,name:"Resourceful Populace",events:[{name:"Resourceful Populace",terrorLevels:[1],effects:[{textArea:[.107,.285],text:"For the rest of this turn, after an Action Destroys 1 or more <town>/<city>, add 1 <town> to an adjacent land. (If there are no adjacent lands - e.g., due to Isolate - don't add anything.)",[yn.Now]:async({$:e,effect:a,...t})=>{await e.clickToContinue();const n={triggerId:e.nextTriggerId(),[yn.Now]:({action:a})=>e.doMainEventAction((()=>e.inLandsWhere((e=>e.hasAdjacentLocationWhere((e=>a.parentData.resourcefulPopulaceLocations.includes(e))))).pickOne((async a=>{await a.add(1,e.Town)}),{noOptions:"No adjacent lands."})))};await e.addSubEffectUntilEndOfTurn({effectId:wn.ResourcefulPopulace,[yn.GlobalReminder]:()=>({icon:"+1 <town>"}),[yn.AfterRemovePiece]:async({piece:r,location:i,removement:s})=>{r.isA(e.TownOrCity)&&pr[s].isDestroyLike&&e.action.type!==Ho.GameAction&&!i.isIsolated&&(void 0===e.action.data.resourcefulPopulaceLocations&&(e.action.data.resourcefulPopulaceLocations=[]),e.action.data.resourcefulPopulaceLocations.push(i),await e.addTrigger(n,a,t.action))}})}}]},{name:"Strip the Land Bare",terrorLevels:[2,3],effects:[{textArea:[.373,.413],text:"<town> each do +1 Damage when Ravaging.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.StripTheLandBare,[yn.GlobalReminder]:()=>({icon:"<town><br>+1 <damage>"}),[yn.AdjustIndividualInvaderRavageDamage]:({piece:a})=>a.isA(e.Town)?1:0})}},{textArea:[.408,.482],text:"After a Ravage Action adds <blight>, Remove 1 <explorer> and 1 <town> from the Ravaged land.",[yn.Now]:async({$:e,...a})=>{await e.clickToContinue();const t={triggerId:e.nextTriggerId(),[yn.Now]:async({action:a})=>{const t=a.parentData.damagedLand;await t.remove({amount:1,pieces:e.Explorer}),await t.remove({amount:1,pieces:e.Town})}};await e.addSubEffectUntilEndOfTurn({effectId:wn.StripTheLandBare,[yn.GlobalReminder]:()=>({icon:"<blight><br>-<explorer><town>"}),[yn.AfterRavagingDamageLand]:async({blightedLands:n,land:r})=>{n.length>0&&(e.action.data.damagedLand=r,await e.addTrigger(t,a.effect,a.action))}})}}]},{name:"Virulence among Close-Packed Homes",tokenEvent:!0,effects:[{textArea:[.664,.74],text:"On Each Board: Add <disease> to the Inland land with the most <town>/<city> (min. 1).",[yn.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((a=>a.inInlandLands().where((a=>a.has(e.TownOrCity))).withMost((a=>a.numberOf(e.TownOrCity))).pickOne((async a=>{await a.add(1,e.Disease)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No Inland land with <town>/<city>.`})))}]},Hf]},Uf={set:a.JaggedEarth,name:"Seek New Farmland",events:[{name:"Seek New Farmland",blightStatus:og.HealthyIsland,effects:[{textArea:[.107,.181],text:"In each land with 2 or more <town>, Push 1 <town> to a land without <town>.",[yn.Now]:({$:e})=>e.inLandsWhere((a=>a.hasAtLeast(2,e.Town))).selectOrder().forEach((a=>e.doMainEventAction((async()=>{await a.push({amount:1,pieces:e.Town,destinationFilter:a=>a.doesntHave(e.Town)})}),{land:a})),{noOptions:"No lands with 2 or more <town>."})}]},{name:"Voracious Consumption",blightStatus:og.BlightedIsland,effects:[{textArea:[.373,.582],text:"On Each Board: After the Ravage Step, add 1 <blight> to a land with <city> and no <blight>.<br><br>Spirits may prevent this on any/all boards by Destroying 2 <presence> from each board to be protected.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.VoraciousConsumption,[yn.GlobalReminder]:()=>({icon:"+1 <blight>"}),[yn.AfterTheNormalRavageStep]:()=>e.doMainEventActionOnEachBoard((async a=>{await e.chooseBetween({prompt:`On board ${a.name}, choose between:`,highlightBoards:[a],effects:[{actionId:"AddBlight",textArea:[.373,.447],text:"Add 1 <blight> to a land with <city> and no <blight>.",prompt:"Pick a land to add <blight>.",[yn.Now]:()=>a.inLandsWith(e.City).where((a=>a.doesntHave(e.Blight))).pickOne((async e=>{await e.addBlight(1)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <city> and no <blight>.`})},{actionId:"PreventByDestroyingPresence",textArea:[.476,.585],text:"Prevent <blight> by destroying 2 <presence>.",[yn.Now]:()=>a.destroyPresence(2),condition:()=>a.numberOf(e.Presence)>=2}]})}),{selectOrder:!0})})}}]},Ff,{name:"Engage on their own Terms",dahanEvent:!0,effects:[{textArea:[.805,.913],text:"During Ravage, <dahan> only do 1 Damage each, but deal Damage before Invaders.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.EngageOnTheirOwnTerms,[yn.GlobalReminder]:()=>({icon:"<dahan><br>1 <damage>"}),[yn.DahanFightBeforeInvaders]:async({land:a})=>{a.has(e.Dahan)&&await e.clickToContinue(),await a.piecesThatAre(e.Dahan).forEach((async e=>{await e.setFightsBeforeInvaders(!0)}))},[yn.AdjustDamageDuringRavage]:({piece:a})=>a.isA(e.Dahan)?-1:0})}}]}]},qf={set:a.JaggedEarth,name:"Smaller Ports Spring Up",events:[{name:"Smaller Ports Spring Up",stages:[1,2],effects:[{textArea:[.105,.187],text:"On Each Board with exactly 1 Coastal <city>: Add 1 <town> to a Coastal land without <city>.",[yn.Now]:({$:e})=>e.inBoardsWhere((a=>a.inCoastalLands().hasExactlyOneWhere(1,(a=>a.has(e.City)))&&1===a.inCoastalLands().firstOneWhere((a=>a.has(e.City))).numberOf(e.City))).forEach((a=>e.doMainEventAction((()=>a.inCoastalLands().where((a=>a.doesntHave(e.City))).pickOne((async a=>{await a.add(1,e.Town)}))),{board:a})),{noOptions:"No boards with exactly 1 Coastal <city>."})}]},{name:"Extensive Building",stages:[3],effects:[{textArea:[.371,.452],text:"On Each Board: Build in a land with Invaders not matching a Build Card.",[yn.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>a.inLandsWith(e.Invader).where((a=>!a.matchesInvaderCards(e.invaderCardsInVisibleSlot(Zl.Build),Hr.Build))).pickOne((async e=>{await e.doExtraBuild()}),{noOptions:`On board ${a.name}: No lands with Invaders not matching a Build Card.`})))}]},Yg,{name:"Settlers Encroach too far",dahanEvent:!0,effects:[{textArea:[.841,.914],text:"On Each Board: Choose a land with <town> and <dahan>. Push 1 <town> per 2 <dahan> there.",[yn.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((a=>a.inLandsWithAllOf(e.Town,e.Dahan).pickOne((async a=>{await a.push({amount:Math.floor(a.numberOf(e.Dahan)/2),pieces:e.Town})}),{highlightBoards:[a],noOptions:`On board ${a.name}: No land with <town> and <dahan>.`})),{selectOrder:!0})}]}]},_f={set:a.JaggedEarth,name:"Sprawl Contained By The Wilds",events:[{name:"Sprawl Contained By The Wilds",blightStatus:og.HealthyIsland,effects:[{textArea:[.107,.21],text:"On Each Board: Add 1 <wilds> to a land without Invaders. Build in the land with the most <town>/<city> (min. 1).",[yn.Now]:({$:e})=>e.doMainEventActionOnEachBoard((async a=>{await e.addSubEffect({effects:[{textArea:[.107,.176],text:"Add 1 <wilds> to a land without Invaders.",[yn.Now]:()=>a.inLandsWithout(e.Invader).pickOne((async a=>{await a.add(1,e.Wilds)}))},{textArea:[.138,.21],text:"Build in the land with the most <town>/<city> (min. 1).",[yn.Now]:()=>a.inLandsWithMostMinimumOne(e.TownOrCity).pickOne((async e=>{await e.doExtraBuild()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <town>/<city>.`})}]})}))}]},{name:"Dissolution Threatens",blightStatus:og.BlightedIsland,effects:[{textArea:[.383,.604],text:"Each Spirit chooses:<br>Accept this Fragmentation<or>Focus your will towards Wholeness",[yn.Now]:({$:e})=>e.eachSpirit((a=>e.doMainEventAction((()=>e.chooseBetween({effects:[{actionId:"AcceptThisFragmentation",label:"Accept this Fragmentation",textArea:[.423,.463],text:"Destroy 2 <presence>, adding 1 <wilds> in place of each.",[yn.Now]:async()=>{const t=await a.destroyPresence(2);for(const{location:a}of t)await a.add(1,e.Wilds)}},{actionId:"FocusYourWill",label:"Focus your will towards Wholeness",effects:[{textArea:[.499,.539],text:"Add 1 of your Destroyed <presence> to one of your lands.",[yn.Now]:async()=>{await a.addPresence({destroyed:!0})}},{textArea:[.534,.604],text:"Next turn, all your Powers are <slow> and cannot be made <fast>.",[yn.Now]:async()=>{await e.clickToContinue();const t=e.turn;await e.addSubEffect({effectId:wn.FocusYourWill,[yn.GlobalReminder]:()=>({players:[a],icon:"Powers<br><slow>"}),[yn.AdjustPowerSpeedOnPlay]:async({power:n})=>n.owner===a&&e.turn===t+1&&(await n.setStatus(Fd.PlayedSlow),!0),[yn.PreventChangeSpeedOfPower]:({power:n})=>n.owner===a&&e.turn===t+1,[yn.TimePasses]:()=>(e.turn===t+1&&e.removeThisEffect(),Promise.resolve())})}}]}]})))))}]},mf,{name:"Lay Ambushes",dahanEvent:!0,effects:[{textArea:[.819,.899],text:"During Ravage, <dahan> deal Damage at the same time as Invaders.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.LayAmbushes,[yn.GlobalReminder]:()=>({icon:"Ravage<br><dahan>"}),[yn.DahanFightSimultaneously]:()=>!0})}}]}]},Jf={set:a.JaggedEarth,name:"Temporary Truce",events:[{name:"Temporary Truce",terrorLevels:[1],effects:[{textArea:[.107,.216],text:"In lands with <dahan>: 1 <dahan> and 1 <town>/<city> do not participate in Ravages. (They neither take nor deal Damage.)",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.TemporaryTruce,[yn.GlobalReminder]:()=>({icon:"DNPIR"}),[yn.DoesNotParticipateInRavage]:async({location:a})=>{a.has(e.Dahan)&&(await a.pickOnePieceToNotParticipateInRavage(e.Dahan),await a.pickOnePieceToNotParticipateInRavage(e.TownOrCity))}})}}]},{name:"Temporary Caution",terrorLevels:[2,3],effects:[{textArea:[.373,.485],text:"During the Ravage Step, On Each Board: Skip 1 Ravage Action in a land where <dahan> outnumber <town>/<city>.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.TemporaryCaution,[yn.GlobalReminder]:()=>({icon:"Skip<br>Ravage"}),[yn.BeforeResolvingInvaderCard]:async({invaderAction:a,card:t})=>{a===Hr.Ravage&&await e.onEachBoard((a=>a.inLandsWhere((a=>a.participatingDahan().count>a.participatingInvaders().where((a=>a.isA(e.TownOrCity))).count)).pickOne((async a=>{await e.addEffectUntilEndOfTurn({[yn.PreventInvaderActionInLand]:e=>Promise.resolve(e.land===a&&e.invaderAction===Hr.Ravage&&e.card===t)})}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands where <dahan> outnumber <town>/<city>.`})))}})}}]},Pf(!1),{name:"Speak of the Spirits' Anger",dahanEvent:!0,effects:[{textArea:[.809,.921],text:"For each board, 1 <fear> if any <dahan> are in lands with <town>/<city>.",[yn.Now]:async({$:e})=>{const a=a=>a.hasOneLandWhere((a=>a.hasAllOf(e.Dahan,e.TownOrCity))),t=e.inBoardsWhere(a).count;await e.clickToContinue({noOptions:`${t} board${1!==t?"s":""} = ${t} <fear>.`}),await e.doDahanEventActionOnEachBoard((async t=>{a(t)&&await e.fear(1)}))}}]}]},Vf={set:a.JaggedEarth,name:"The Frontier Calls",events:[{name:"The Frontier Calls",blightStatus:og.HealthyIsland,effects:[{textArea:[.107,.181],text:"Explore Actions add +1 <explorer> to lands without <town>/<city>.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.TheFrontierCalls,[yn.GlobalReminder]:()=>({icon:"+1 <explorer>"}),[yn.BeforeSuccessfulExplore]:({land:a})=>(a.has(e.TownOrCity)||(e.action.data.hadNoBuilding=!0),Promise.resolve()),[yn.AfterSuccessfulExplore]:async({land:a})=>{e.action.data.hadNoBuilding&&(await e.sendEvent({type:fn.GenericMain,text:"Invaders successfully Explored into a land which had no <town>/<city>."}),await a.add(1,e.Explorer))}})}}]},{name:"Self-Sacrifice Buys Time",blightStatus:og.BlightedIsland,effects:[{textArea:[.374,.414],text:"Destroy 1 <presence> from each Spirit.",[yn.Now]:({$:e})=>e.eachSpirit((a=>e.doMainEventAction((async()=>{await a.destroyPresence(1)}))))},{textArea:[.44,.582],text:"The next X <blight> added to the island this turn come from the box instead of the Blight Card where X is the number of Spirits.",[yn.Now]:async({$:e})=>{const a=Re.box(0);await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.SelfSacrificeBuysTime,[yn.GlobalReminder]:()=>({icon:`<blight><br>${a.get()} / ${e.spiritCount}`}),[yn.PreventRemoveBlightFromBlightCard]:async({location:t})=>void 0!==t&&a.get()<e.spiritCount&&(a.set(a.get()+1),await e.sendEvent({type:fn.GenericMain,text:"Self-Sacrifice Buys Time made <blight> come from the box instead of the Blight Card."}),a.get()===e.spiritCount&&e.removeThisEffect(),!0)})}}]},{name:"Lair in Untamed Lands",tokenEvent:!0,effects:[{textArea:[.648,.729],text:"On Each Board: Add 1 <beasts> to a land without <town>/<city>/<blight>.",[yn.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((a=>a.inLandsWithNoneOf(e.Town,e.City,e.Blight).pickOne((async a=>{await a.add(1,e.Beasts)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands without <town>/<city>/<blight>.`})))}]},{name:"Seek out new Grounds",dahanEvent:!0,effects:[{textArea:[.804,.911],text:"On Each Board: Gather 1 or 2 <dahan> into a land without <dahan> Setup symbols.",[yn.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((a=>a.inLandsWhere((a=>!a.hasSetupSymbols&&a.hasAdjacentLandWithPiece(e.Dahan))).pickOne((async a=>{await a.gather({quantifier:lr.UpToMinimumOne,amount:2,pieces:e.Dahan})}))),{selectOrder:!0})}]}]},Yf=e=>({name:"Irregular Outbreaks",tokenEvent:!0,effects:[{textArea:e?[.638,.71]:[.637,.714],text:"<disease> doesn't prevent Builds this Invader Phase.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.IrregularOutbreaks,[yn.GlobalReminder]:()=>({icon:"Ignore<br><disease>"}),[yn.PreventDiseasePreventingBuilds]:()=>Promise.resolve(!0)})}},{textArea:e?[.704,.745]:[.67,.75],text:"1 <fear> per board with <disease>.",[yn.Now]:async({$:e})=>{const a=e.inBoardsWith(e.Disease);await e.clickToContinue({highlightBoards:a.items,noOptions:`${a.count} board${a.count>1?"s":""} = ${a.count} <fear>.`}),await e.doTokenEventAction((async()=>{await e.fear(a.count)}))}}]}),zf={set:a.JaggedEarth,name:"The Struggles Of Growth",events:[{name:"The Struggles Of Growth",fullText:["&nbsp;&nbsp;A painful crux-point. Each Spirit chooses:","Trade Reach for Deeper Nature","&nbsp;&nbsp;Destroy 2 of your <presence>. Gain a Power Card.","Leave Behind that which restrains you","&nbsp;&nbsp;Forget a Power Card. Gain 2 Energy. Move up to 2 of your <presence> up to <range-4>."],blightStatus:og.HealthyIsland,effects:[{textArea:[.151,.34],text:"Each Spirit chooses: Trade Reach for Deeper Nature<or>Leave Behind that which Restrains you",[yn.Now]:({$:e})=>e.eachSpirit((a=>e.doMainEventAction((()=>e.chooseBetween({effects:[{actionId:"TradeReach",label:"Trade Reach for Deeper Nature",effects:[{textArea:[.184,.224],text:"Destroy 2 of your <presence>.",[yn.Now]:async()=>{await a.destroyPresence(2)}},{textArea:[.184,.224],text:"Gain a Power Card.",[yn.Now]:async()=>{await a.gainPowerCard()}}]},{actionId:"LeaveBehind",label:"Leave Behind that which restrains you",effects:[{textArea:[.265,.305],text:"Forget a Power Card.",[yn.Now]:async()=>{await a.forgetPowers()}},{textArea:[.265,.305],text:"Gain 2 Energy.",[yn.Now]:async()=>{await a.gainEnergy(2)}},{textArea:[.265,.337],text:"Move up to 2 of your <presence> up to <range-4>.",[yn.Now]:async()=>{await a.presence().pickMultiple({amount:2,optional:!0,forPickedItem:async e=>{await e.move({locations:{target:Jn.WithinRange,range:4,spirit:a}})},effect:{prompt:"Pick a <presence> to move."}})}}]}]})))))}]},{name:"Blight Deepens",blightStatus:og.BlightedIsland,effects:[{textArea:[.4,.568],text:"On Each Board: Add 1 <blight> to a land with <blight>, but do not cascade.<br><br>Spirits may prevent this on any/all boards by Destroying 1 <presence> from each board to be protected.",[yn.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>e.chooseBetween({effects:[{actionId:"AddBlight",textArea:[.4,.47],text:"Add 1 <blight> to a land with <blight>, but do not cascade.",[yn.Now]:()=>a.inLocationsWith(e.Blight).where((e=>e.isLandForBlight)).pickOne((async e=>{await e.addBlight(1,{mayCascade:!1})}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <blight>.`})},{actionId:"PreventByDestroyingPresence",textArea:[.493,.567],text:"Prevent adding <blight> by destroying 2 <presence>.",[yn.Now]:()=>a.destroyPresence(2),condition:()=>a.numberOf(e.Presence)>=2}]})),{selectOrder:!0})}]},Yf(!1),pf]},Qf={set:a.JaggedEarth,name:"Thriving Trade",events:[{name:"Thriving Trade",blightStatus:og.HealthyIsland,effects:[{textArea:[.107,.184],text:"On Each Board: Add 1 <city> to a Coastal land with <city>.",[yn.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>a.inCoastalLands().where((a=>a.has(e.City))).pickOne((async a=>{await a.add(1,e.City)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No Coastal lands with <city>.`})))}]},{name:"Partitioned Wilderness",blightStatus:og.BlightedIsland,effects:[{textArea:[.354,.598],text:"On Each Board: If there are 4 or more lands with <town>, add 1 <blight> to a land with or adjacent to <town>.<br><br>Spirits may prevent this on any/all boards by Destroying 3 <presence> from each board to be protected.",[yn.Now]:({$:e})=>e.doMainEventActionOnEachBoard((async a=>{a.inLandsWith(e.Town).count>=4?await e.chooseBetween({highlightBoards:[a],effects:[{actionId:"AddBlight",textArea:[.354,.457],text:"Add 1 <blight> to a land with or adjacent to <town>.",[yn.Now]:()=>a.inLocationsWithOrAdjacentTo(e.Town).where((e=>e.isLandForBlight)).pickOne((async a=>{await a.add(1,e.Blight)}))},{actionId:"PreventByDestroyingPresence",textArea:[.489,.6],text:"Prevent adding <blight> by destroying 3 <presence>.",[yn.Now]:()=>a.destroyPresence(3),condition:()=>a.numberOf(e.Presence)>=3}]}):await e.clickToContinue({noOptions:`On board ${a.name}: There are not 4 or more lands with <town>.`,highlightBoards:[a]})}),{selectOrder:!0})}]},{name:"Pestilence Arrives on Canvas Sails",tokenEvent:!0,effects:[{textArea:[.654,.765],text:"On Each Board: Add 1 <disease> to the Coastal land with the most <town>/<city> (min. 1). In that land, 3 Damage to <dahan>.",[yn.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((a=>a.inCoastalLands().where((a=>a.has(e.TownOrCity))).withMost((a=>a.numberOf(e.TownOrCity))).pickOne((async a=>{await a.add(1,e.Disease),await a.damage(3,e.Dahan)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No Coastal land with <town>/<city>.`})))}]},{name:"Clever Cooperation",dahanEvent:!0,effects:[{textArea:[.805,.914],text:"Each Spirit may Push 1 of their <presence> from a land with <dahan>. 2 Damage in the land Pushed to.",[yn.Now]:({$:e})=>e.eachSpirit((a=>e.doDahanEventAction((()=>a.presence().where((a=>a.location.has(e.Dahan))).optionallyPickOne((async e=>{const a=await e.push();a.length>0&&await a[0].destination.damage(2)}),{prompt:"Pick 1 of your <presence> to Push.",noOptions:`${a.nameLink} has no lands with <dahan>.`})))))}]}]},Kf=e=>({name:"The World's Vibrance Fades",blightStatus:og.BlightedIsland,effects:[{textArea:e?[.407,.571]:[.363,.542],text:"Remove 1 <blight> per player from the Blight Card, returning it to the box.<br><br>Each Spirit may prevent 1 <blight> from being Removed by Destroying 2 of their <presence>.",[yn.Now]:({$:a})=>a.eachSpirit((t=>a.doMainEventAction((()=>a.chooseBetween({effects:[{actionId:"RemoveBlight",textArea:e?[.407,.479]:[.363,.433],text:"Remove 1 <blight> from the Blight Card.",[yn.Now]:async()=>{await a.removeBlightFromBlightCard(1)}},{actionId:"DestroyPresence",textArea:e?[.496,.574]:[.463,.542],text:"Destroy 2 of your <presence>.",[yn.Now]:async()=>{await t.destroyPresence(2)}}]})))))}]}),Xf={set:a.JaggedEarth,name:"Wounded Lands Attract Explorers",events:[{name:"Wounded Lands Attract Explorers",blightStatus:og.HealthyIsland,effects:[{textArea:[.105,.145],text:"On Each Board: Add 1 <explorer> to a land with <blight>.",[yn.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>a.inLandsWith(e.Blight).pickOne((async a=>{await a.add(1,e.Explorer)}),{highlightBoards:[a],noOptions:`On board: ${a.name}: No land with <blight>.`})))}]},Kf(!1),ff,{name:"Raiding and Retaliation",dahanEvent:!0,effects:[{textArea:[.789,.934],text:"In each land with <town>/<city>: 1 Damage per <dahan>, then each surviving <town>/<city> deals 1 Damage to <dahan>. (Defend/<strife> apply normally.)",[yn.Now]:({$:e})=>e.inLandsWith(e.TownOrCity).where((a=>a.has(e.Dahan))).selectOrder().forEach((a=>e.doDahanEventAction((async()=>{if(await a.damage(a.numberOf(e.Dahan)),a.has(e.Dahan)){const t=a.piecesThatAre(e.TownOrCity).sum((e=>e.strife>0?0:1))-a.defense;await a.piecesThatAre(e.TownOrCity).forEach((async e=>{e.strife>0&&await e.removeStrife()})),await a.damage(t,e.Dahan)}}),{land:a})))}]}]},Zf={set:a.NatureIncarnate,name:"Accumulated Devastation",events:[{name:"Accumulated Devastation",blightStatus:og.HealthyIsland,effects:[{textArea:[.106,.348],text:"On Each Board: During the first successful Ravage Action (in one land) this Invader Phase, increase the total Damage ravaging Invaders deal to each land (but not to <dahan>) by the current Invader Stage. Do this for at most one Ravage Action per board (for one Ravage Action in one land).",[yn.Now]:async({$:e})=>{const a=[];await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.AccumulatedDevastation,[yn.AlterInvaderActionInLand]:async({land:t,invaderAction:n,normal:r})=>(n===Hr.Ravage&&r&&!a.includes(t.board)&&(a.push(t.board),await e.addSubEffectUntilEndOfAction({[yn.AdjustCollectiveInvaderRavageDamage]:({towardsLand:a})=>a?e.stage:0,[yn.ActionEnds]:()=>(e.removeThisEffect(),Promise.resolve())})),!1),[yn.GlobalReminder]:()=>({icon:"Extra<br><damage>"})})}}]},Kf(!0),{name:"Territorial Beasts",tokenEvent:!0,effects:[{textArea:[.632,.746],text:"On Each Board: Isolate a land with <beasts>. 1 <fear> if Invaders are present.",[yn.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((async a=>{await a.inLandsWith(e.Beasts).pickOne((async e=>{await e.isolate(),e.hasInvaders&&await e.fear(1)}),{highlightBoards:[a]})}))}]},{name:"Years of Health and Harmony",dahanEvent:!0,effects:[{textArea:[.838,.91],text:"On Each Board with 5 or more <dahan>: Add 1 <dahan> to the land with the most <dahan>.",[yn.Now]:({$:e})=>e.inBoardsWhere((a=>a.numberOf(e.Dahan)>=5)).forEach((a=>e.doDahanEventAction((()=>a.inLandsWithMost((a=>a.numberOf(e.Dahan))).pickOne((async a=>{await a.add(1,e.Dahan)}),{highlightBoards:[a]})),{board:a})),{noOptions:"No boards with 5 ore more <dahan>."})}]}]},ep={set:a.NatureIncarnate,name:"An Ominous Dawn",events:[{name:"An Ominous Dawn",terrorLevels:[1],effects:[{textArea:[.109,.293],text:"1 <fear> per Power Card in play that generates <fear>. (In its instructions, not by destroying <town>/<city>. Count thresholds even if you don't have the Elements. Generated <fear> can't cause Wavering Resolve.)",[yn.Now]:({$:e})=>e.doMainEventAction((async()=>{const a=e.powerCardsInPlayThatGeneratesFear,t=a.length;await e.clickToContinue({highlightPowers:a,noOptions:`${t} Power Card${t>1?"s":""} = ${t} <fear>.`}),await e.fear(t)}))}]},{name:"Wavering Resolve",terrorLevels:[2,3],effects:[{textArea:[.366,.549],text:"Remove 1 Health worth of Invaders per Power Card in play that generates <fear>. (In its instructions, not by destroying <town>/<city>. Count thresholds even if you don't have the Elements.)",[yn.Now]:({$:e})=>e.doMainEventAction((async()=>{const a=e.powerCardsInPlayThatGeneratesFear,t=a.length;await e.clickToContinue({highlightPowers:a,noOptions:`${t} Power Card${t>1?"s":""} = ${t} Health worth.`}),await e.removeInvadersWorthOfHealthUpTo(t)}))}]},{name:"Dangerous Lands",tokenEvent:!0,effects:[{textArea:[.626,.74],text:"On Each Board: 1 Damage in a land with <badlands>/<beasts>. 1 Damage to <dahan> in a land with <badlands>/<beasts> and <dahan>.",[yn.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((async a=>{await a.inLandsWith(e.BadlandsOrBeasts).pickOne((async e=>{await e.damage(1)}),{noOptions:`On board ${a.name}: No land with <badlands>/<beasts>.`}),await a.inLandsWithAllOf(e.BadlandsOrBeasts,e.Dahan).pickOne((async a=>{await a.damage(1,e.Dahan)}),{noOptions:`On board ${a.name}: No land with <badlands>/<beasts> and <dahan>.`})}),{selectOrder:!0})}]},{name:"Waning Support",dahanEvent:!0,effects:[{textArea:[.785,.935],text:"On Each Board with <town>/<city><br>...and 5 or fewer <dahan>: Destroy 1 <presence>.<br>...and 3 or fewer <dahan>: Also Add 1 <blight> to a land with <town>/<city>.",[yn.Now]:({$:e})=>e.inBoardsWhere((a=>a.hasOneLandWith(e.TownOrCity))).forEach((a=>e.doDahanEventAction((async()=>{a.numberOf(e.Dahan)<=5?(await e.addSubEffect({textArea:[.787,.859],text:"On Each Board with <town>/<city> and 5 or fewer <dahan>:<br>Destroy 1 <presence>.",[yn.Now]:async()=>{await a.destroyPresence(1)}}),a.numberOf(e.Dahan)<=3&&await e.addSubEffect({textArea:[.854,.934],text:"...and 3 or fewer <dahan>: Also Add 1 <blight> to a land with <town>/<city>.",[yn.Now]:async()=>{await a.inLandsWith(e.TownOrCity).pickOne((async e=>{await e.addBlight(1)}))}})):await e.clickToContinue({noOptions:`On board ${a.name}: More than 5 <dahan>.`})}),{board:a})),{noOptions:"No boards with <town>/<city."})}]}]},ap={set:a.NatureIncarnate,name:"Ethereal Conjunction",events:[{name:"Ethereal Conjunction:",fullText:["&nbsp;&nbsp;A confluence of spiritual forces gathers into an unformed maelstrom. Each Spirit chooses:","Endure It's Forces as Best you Can","&nbsp;&nbsp;• Destroy 1 <presence> and lose 1 Energy.","Seek to Control it, though it Exhausts you","&nbsp;&nbsp;• Choose any non-Major Power Card of yours (in hand, play or discard). Put it into play (without paying its cost); use it immediately (even if already used this turn); and then Forget it.","&nbsp;&nbsp;• Discard all Power Cards (from hand)."],effects:[{textArea:[.191,.502],text:"Each spirit chooses:<br><br>Endure It's Forces as Best you Can<or>Seek to Control it, though it Exhausts you",[yn.Now]:({$:e})=>e.eachSpirit((a=>e.doMainEventAction((()=>e.chooseBetween({effects:[{actionId:"EndureItsForces",label:"Endure It's Forces as Best you Can",textArea:[.233,.273],text:"Destroy 1 <presence> and lose 1 Energy.",[yn.Now]:async()=>{await a.destroyPresence(1),await a.loseEnergy(1)}},{actionId:"SeekToControlIt",label:"Seek to Control it, though it Exhausts you",effects:[{textArea:[.324,.461],text:"Choose any non-Major Power Card of yours (in hand, play or discard). Put it into play (without paying its cost); use it immediately (even if already used this turn); and then Forget it.",[yn.Now]:()=>a.powersWhere((e=>e.isA(En.NonMajorCard)&&!e.isBlessed&&!e.assisted)).pickOne((async t=>{await e.addSubEffect({effects:[{textArea:[.357,.429],text:"Put it into play (without paying its cost).",[yn.Now]:async()=>{await t.play({withoutPaying:!0,withoutUsingCardPlays:!0})}},{textArea:[.39,.463],text:"Use it immediately (even if already used this turn).",[yn.Now]:async()=>{await a.targetAndResolvePower(t)}},{textArea:[.422,.462],text:"Forget it.",[yn.Now]:async()=>{await a.forgetPowerState(t)}}]})}),{noOptions:`${a.nameLink} has no non-Major Power Card.`})},{textArea:[.454,.494],text:"Discard all Power Cards (from hand).",[yn.Now]:async()=>{await e.clickToContinue(),await a.discardAllPowerCards()}}]}]})))))}]},Yf(!0),{name:"Tend to the Living Earth",dahanEvent:!0,effects:[{textArea:[.81,.921],text:"On Each Board with 5 or more <dahan>, Remove 1 <blight> in a land with <dahan>.",[yn.Now]:({$:e})=>e.inBoardsWhere((a=>a.numberOf(e.Dahan)>=5)).forEach((a=>e.doDahanEventAction((()=>a.forPiecesThatIs(e.Blight,(a=>a.has(e.Dahan))).pickOne((async e=>{await e.location.removeBlight()}),{prompt:"Pick <blight> to Remove.",highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <blight> and <dahan>.`})),{board:a})),{noOptions:"No boards with 5 ore more <dahan>."})}]}]},tp={set:a.NatureIncarnate,name:"Far-Off Wars Touch The Island",events:[{name:"Far Off Wars Touch The Island",fullText:["&nbsp;&nbsp;Invaders from a different, distant land launch an assault upon the island while the Invaders here rally together in a wave of nationalism. Defending the island with them might come at too high a price.","&nbsp;&nbsp;• Add a Fear Card to the top of the Fear Deck","&nbsp;&nbsp;• On Each Board, in the land with the most <town>/<city>, choose (for that board) either:","Encourage the Destruction","&nbsp;&nbsp;• 4 <fear>. Destroy half of <town> (round up) and half of <city> (round up). Add 2 <blight> without cascading.","Blunt the Offensive","&nbsp;&nbsp;• Destroy 1 <town> but do not gain <fear>."],effects:[{textArea:[.269,.31],text:"Add a Fear Card to the top of the Fear Deck",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.doTokenEventAction((async()=>{await e.addFearCards(1).toLevel(e.terrorLevel)}))}},{textArea:[.298,.599],text:"On Each Board, in the land with the most <town>/<city>, choose (for that board) either:<br><br>Encourage the Destruction<or>Blunt the Offensive",[yn.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>a.inLandsWithMost((a=>a.numberOf(e.TownOrCity))).pickOne((t=>e.chooseBetween({highlightBoards:[a],highlightLocations:[t],effects:[{actionId:"EncourageTheDestruction",label:"Encourage the Destruction",effects:[{textArea:[.432,.473],text:"4 <fear>.",[yn.Now]:async()=>{await t.fear(4)}},{textArea:[.432,.513],text:"Destroy half of <town> (round up) and half of <city> (round up).",[yn.Now]:async()=>{await t.destroy({amount:Math.ceil(t.numberOf(e.Town)/2),pieces:e.Town}),await t.destroy({amount:Math.ceil(t.numberOf(e.City)/2),pieces:e.City})}},{textArea:[.463,.503],text:"Add 2 <blight> without cascading.",[yn.Now]:async()=>{await t.addBlight(2,{mayCascade:!1})}}]},{actionId:"BluntTheOffensive",label:"Blunt the Offensive",textArea:[.563,.604],text:"Destroy 1 <town> but do not gain <fear>.",[yn.Now]:async()=>{await e.addEffectUntilEndOfAction({[yn.PreventFearGeneration]:({fromDestroyingBuildings:e})=>Promise.resolve(e)}),await t.destroyOne(e.Town)}}]})),{autoPlayOneOption:!0,highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <town>/<city>.`})))}]},{name:"Ecosystem Damage",tokenEvent:!0,effects:[{textArea:[.654,.732],text:"On Each Board: Add 1 <badlands> to a land with <blight>.",[yn.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((a=>a.inLandsWith(e.Blight).pickOne((async a=>{await a.add(1,e.Badlands)}))),{selectOrder:!0})}]},Of]},np={set:a.NatureIncarnate,name:"Focused Farming",events:[{name:"Focused Farming",blightStatus:og.HealthyIsland,effects:[{textArea:[.112,.19],text:"On Each Board: Add 1 <explorer> and 1 <town> to land with <town>/<blight>.",[yn.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>a.inLandsWhere((a=>a.hasOneOf(e.Town,e.Blight))).pickOne((async a=>{await a.add(1,e.Explorer),await a.add(1,e.Town)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No land with <town>/<blight>.`})))}]},{name:"Essence Disperses",blightStatus:og.BlightedIsland,effects:[{textArea:[.368,.582],text:"Each Spirit chooses independently to:<br><br>Forget 1 Power Card.<or>Lose 2 Energy (to min. 0) and Destroy 1 <presence>. In the land where you destroyed <presence>, return 1 <blight> to the box (if possible).",[yn.Now]:({$:e})=>e.eachSpirit((a=>e.doMainEventAction((()=>e.chooseBetween({effects:[{actionId:"ForgetPowerCard",label:"Forget 1 Power Card.",effects:[{textArea:[.398,.439],text:"Forget 1 Power Card.",[yn.Now]:async()=>{await a.forgetPowers()}}]},{actionId:"DestroyPresence",label:"Lose Energy and Destroy <presence>.",effects:[{textArea:[.473,.582],text:"Lose 2 Energy (to min. 0) and Destroy 1 <presence>. In the land where you destroyed <presence>, return 1 <blight> to the box (if possible).",[yn.Now]:async()=>{await a.loseEnergy(2);const e=await a.destroyPresence(1);e.length>0&&await e[0].location.removeBlight({toTheBox:!0})}}]}]})))))}]},mf,Hf]},rp=async(e,a)=>{await e.addSubEffect({textArea:[.366,.442],text:"On Each Board: Skip the first Ravage Action (in one land matching the Ravage Card).",[yn.Now]:async()=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.InfluxOfSettlers,text:`The first Ravage Action is skipped on Board ${a.name}.`,[yn.GlobalReminder]:()=>({icon:`${a.name}: Skip<br>Ravage`}),[yn.PreventInvaderActionInLand]:async({land:t,invaderAction:n})=>t.board===a&&n===Hr.Ravage&&(await e.sendEvent({type:fn.GenericSub,text:`The Ravage in land ${t.coordinateLink} was skipped from Lethargy and Degeneration.`}),e.removeThisEffect(),!0)})}})},ip=async(e,a)=>{await a.inLandsWith(e.TownOrCity).pickOne((async e=>{await e.addBlight(1)}),{textArea:[.407,.448],text:"Add 1 <blight> to a land with <town>/<city>.",highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <town>/<city>.`})},sp={set:a.NatureIncarnate,name:"Influx Of Settlers",events:[{name:"Influx Of Settlers",blightStatus:og.HealthyIsland,effects:[{textArea:[.116,.257],text:"On the single board with the most <town>/<city>: Add 1 <town> per player, split between as many different lands as possible. (This will usually be 1 <town> per chosen land.)",[yn.Now]:({$:e})=>e.inBoards().withMost((a=>a.numberOf(e.TownOrCity))).pickOne((a=>a.inLands().inDifferent((a=>e.eachSpirit((()=>e.doMainEventAction((()=>a((async a=>{await a.add(1,e.Town)}))))))))))}]},{name:"Lethargy and Degeneration",blightStatus:og.BlightedIsland,effects:[{textArea:[.371,.59],text:"On Each Board: Skip the first Ravage Action (in one land). Add 1 <blight> to a land with <town>/<city>.<br><br>Spirits may prevent either/both effects on any/all boards (choose per board) by Destroying 2 <presence> from each board to be protected.",[yn.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>e.chooseBetween({highlightBoards:[a],effects:[{actionId:"LetBothHappen",textArea:[.371,.585],label:"Let both effects happen.",[yn.Now]:async()=>{await rp(e,a),await ip(e,a)}},{actionId:"PreventRavage",label:"Prevent Ravage skip by Destroying 2 <presence>.",textArea:[.451,.587],[yn.Now]:async()=>{await a.destroyPresence(2),await ip(e,a)},condition:()=>a.numberOf(e.Presence)>=2},{actionId:"PreventBlight",textArea:[.451,.587],label:"Prevent adding <blight> by Destroying 2 <presence>.",[yn.Now]:async()=>{await a.destroyPresence(2),await rp(e,a)},condition:()=>a.numberOf(e.Presence)>=2},{actionId:"PreventBoth",textArea:[.451,.587],label:"Prevent both effect by Destroying 2 <presence>.",[yn.Now]:async()=>{await a.destroyPresence(2)},condition:()=>a.numberOf(e.Presence)>=2}]})))}]},{name:"Sand Stalkers",tokenEvent:!0,effects:[{textArea:[.635,.743],text:"On Each Board: Add 1 <beasts> to the Sands with the most Invaders. 1 <fear> if Invaders are present there.",[yn.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((a=>a.inSands().withMost((a=>a.numberOf(e.Invader))).pickOne((async a=>{await a.add(1,e.Beasts),a.hasInvaders&&await a.fear(1)}))))}]},{name:"Network of Support and Trade",dahanEvent:!0,effects:[{textArea:[.835,.911],text:"When Invaders Ravage, if the land has <dahan>, Defend 1 + Defend 1 per adjacent <dahan>.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.NetworkOfSupportAndTrade,[yn.GlobalReminder]:()=>({icon:"Defend<br><dahan>"}),[yn.DefendFromGame]:({land:a})=>a.has(e.Dahan)?1+a.inAdjacentLands().sum((e=>e.numberOfParticipatingDahan)):0})}}]}]},op={set:a.NatureIncarnate,name:"Search For Unclaimed Land",events:[{name:"Search For Unclaimed Land",blightStatus:og.HealthyIsland,effects:[{textArea:[.115,.19],text:"On Each Board: Explore in the land with the fewest total Invaders/<dahan> (no source required).",[yn.Now]:({$:e})=>e.doMainEventActionOnEachBoard((a=>a.inLandsWithLeast((a=>a.numberOf(e.InvaderOrDahan))).pickOne((async e=>{await e.doExtraExplore()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No land with Invaders/<dahan>.`})))}]},{name:"Widespread Hunting",blightStatus:og.BlightedIsland,effects:[{textArea:[.362,.585],text:"When <town>/<city> Ravage in a land:<br><bullet> If no <beasts> are present, Invaders do +2 Damage (total).<br><bullet> Otherwise, Destroy 1 <beasts>.<br><br>Do this at most once per board (for one Ravage Action in one land).",[yn.Now]:async({$:e})=>{const a=[];await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.WidespreadHunting,[yn.AlterInvaderActionInLand]:async({land:t,invaderAction:n,normal:r})=>(n===Hr.Ravage&&r&&!a.includes(t.board)&&(a.push(t.board),t.has(e.Beasts)?await t.destroyOne(e.Beasts):await e.addSubEffectUntilEndOfAction({[yn.AdjustCollectiveInvaderRavageDamage]:()=>2})),!1),[yn.GlobalReminder]:()=>({icon:"Extra<br><damage>"})})}}]},{name:"Plagues in Populous Lands",tokenEvent:!0,effects:[{textArea:[.635,.74],text:"On Each Board: Add 1 <disease> to a land with 3 or more Invaders.",[yn.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((async a=>{await a.inLandsWhere((a=>a.numberOf(e.Invader)>=3)).pickOne((async a=>{await a.add(1,e.Disease)}),{noOptions:`On board ${a.name}: No land with 3 or more Invaders.`})}))}]},{name:"Spreading Conflict Prompts Caution",dahanEvent:!0,effects:[{textArea:[.827,.935],text:"On Each Board: Push up to 3 <dahan> from a land matching a Ravage card to a land not matching a Ravage card.",[yn.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((async a=>{await a.inLands().where((a=>a.has(e.Dahan)&&a.matchesInvaderCards(e.invaderCardsInVisibleSlot(Zl.Ravage),Hr.Ravage))).pickOne((async a=>{await a.push({amount:3,quantifier:lr.UpTo,pieces:e.Dahan,destinationFilter:a=>!a.matchesInvaderCards(e.invaderCardsInVisibleSlot(Zl.Ravage),Hr.Ravage)})}),{noOptions:`On board ${a.name}: No lands with <dahan> in a land matching a Ravage Card.`})}),{selectOrder:!0})}]}]},dp={set:a.NatureIncarnate,name:"Terror Spikes Upwards",events:[{name:"Terror Spikes Upwards",terrorLevels:[1,2],effects:[{textArea:[.112,.306],text:"If you have any Earned Fear Cards, resolve the first one now as if the Terror Level were 1 higher (then discard it).<br><br>Otherwise, 1 <fear> per player. (Generated <fear> can't cause Final Harvest.)",[yn.Now]:({$:e})=>e.doMainEventAction((async()=>{await e.clickToContinue(),e.fearCardsEarnedCount>0?await e.addSubEffect({textArea:[.112,.219],text:"If you have any Earned Fear Cards, resolve the first one now as if the Terror Level were 1 higher (then discard it).",[yn.Now]:async()=>{await e.resolveNextFearCard({extraTerrorLevel:1})}}):await e.addSubEffect({textArea:[.236,.306],text:"Otherwise, 1 <fear> per player. (Generated <fear> can't cause Final Harvest.)",[yn.Now]:async()=>{await e.fear(e.spiritCount)}})}))}]},{name:"Final Harvest",terrorLevels:[3],effects:[{textArea:[.37,.443],text:"Each <city> does +3 Damage during Ravage Actions.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.FinalHarvest,[yn.GlobalReminder]:()=>({icon:"<city><br>+3 <damage>"}),[yn.AdjustIndividualInvaderRavageDamage]:({piece:a})=>a.isA(e.City)?3:0})}},{textArea:[.462,.538],text:"After each Ravage Action, Remove 1 <town>/<city> from that land.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.FinalHarvest,[yn.GlobalReminder]:()=>({icon:"Remove<br><town>/<city>"}),[yn.AfterRavaging]:({land:a})=>e.doMainEventAction((async()=>{await a.remove({amount:1,pieces:e.TownOrCity})}))})}}]},{name:"Secure Settled Territory",tokenEvent:!0,effects:[{textArea:[.624,.769],text:"On Each Board: In a land with <badlands>/<beasts> and <town>/<city>: Destroy 1 <badlands>/<beasts>. 1 Damage to <dahan>. 1 Damage.",[yn.Now]:({$:e})=>e.doTokenEventActionOnEachBoard((a=>e.countPiecesOnlyIfHavingPieces([Bn.Badlands,Bn.Beasts],(()=>a.inLandsWithAllOf(e.BadlandsOrBeasts,e.TownOrCity))).pickOne((async a=>{await e.addSubEffect({effects:[{textArea:[.696,.736],text:"Destroy 1 <badlands>/<beasts>.",[yn.Now]:async()=>{await a.destroyOne(e.BadlandsOrBeasts)}},{textArea:[.696,.736],text:"1 Damage to <dahan>.",[yn.Now]:async()=>{await a.damage(1,e.Dahan)}},{textArea:[.732,.772],text:"1 Damage.",[yn.Now]:async()=>{await a.damage(1)}}]})}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <badlands>/<beasts> and <town>/<city>.`})),{selectOrder:!0})}]},{name:"War Among the Dahan",dahanEvent:!0,effects:[{textArea:[.811,.917],text:"On Each Board: In the land with the most <dahan> (min. 2), Push half the <dahan> (round down).",[yn.Now]:({$:e})=>e.doDahanEventActionOnEachBoard((a=>a.inLands().where((a=>a.hasAtLeast(2,e.Dahan))).withMost((a=>a.numberOf(e.Dahan))).pickOne((async a=>{await a.push({amount:Math.floor(a.numberOf(e.Dahan)/2),pieces:e.Dahan})}),{noOptions:`On board ${a.name}: No lands with at least 2 <dahan>.`})),{selectOrder:!0})}]}]},cp={set:a.NatureIncarnate,name:"Visions Out Of Time",events:[{name:"Visions Out Of Time",fullText:["&nbsp;&nbsp;A Spirit more loosely time-moored than most warns of catastrophe's subtle seeds. Each Spirit chooses:","Let the Warning Waft into Day's Past","&nbsp;&nbsp;Lose 1 Energy and replace your most expensive non-Unique Power Card in hand or discard pile (combined) with one of the same type: Reveal the top 4 cards of the deck, Take 1, put it where your card is, then put your card in that deck's discard.","Head off the Problems Yourself","&nbsp;&nbsp;Add 1 Omen token (Scenario Marker) to the land without Omens that has the most Invaders (min. 1). After the Ravage Step next turn, at each Omen: 2 <fear>. Invaders Ravage. Remove 1 Omen."],effects:[{textArea:[.195,.601],text:"Each Spirit chooses:<br><br>Let the Warning Waft into Day's Past<or>Head off the Problems Yourself",[yn.Now]:({$:e})=>e.eachSpirit((a=>e.doMainEventAction((()=>e.chooseBetween({effects:[{actionId:"LetTheWarningWaft",label:"Let the Warning Waft into Day's Past",textArea:[.232,.409],text:"Lose 1 Energy and replace your most expensive non-Unique Power Card in hand or discard pile (combined) with one of the same type: Reveal the top 4 cards of the deck, Take 1, put it where your card is, then put your card in that deck's discard.",[yn.Now]:async()=>{await a.loseEnergy(1);const e=a.powersWhere((e=>e.isA(En.NonUniqueCard)&&(e.isInHand||e.isInDiscard))).withMost((e=>e.costToPlay));if(e.count>0){const t=e.anyOne.data.type===Sn.Major,n=await a.gainPowerCard({powerType:t?Sn.Major:Sn.Minor,withoutForgetting:!0,taken:!0});n.chosen.length>0&&await e.pickOne((async e=>{e.isInDiscard&&await n.chosen[0].discard(),await e.forget({silent:!0})}))}}},{actionId:"HeadOffTheProblems",label:"Head off the Problems Yourself",effects:[{textArea:[.46,.599],text:"Add 1 Omen token (Scenario Marker) to the land without Omens that has the most Invaders (min. 1). After the Ravage Step next turn, at each Omen: 2 <fear>. Invaders Ravage. Remove 1 Omen.",[yn.Now]:async()=>{const a=e.turn;await e.inLandsWithout(e.Omen).where((e=>e.hasInvaders)).withMost((a=>a.numberOf(e.Invader))).pickOne((async a=>{await a.add(1,e.Omen)})),e.hasEffectNamed("Head off the Problems Yourself")||await e.addSubEffect({name:"Head off the Problems Yourself",effectId:wn.HeadOffTheProblems,[yn.GlobalReminder]:()=>({icon:"Omen",visible:e.turn<=a+1}),[yn.AfterTheNormalRavageStep]:async()=>{e.turn===a+1&&await e.inLandsWith(e.Omen).selectOrder().forEach((async a=>{await e.doMainEventAction((async()=>{await a.fear(2),await a.doExtraRavage(),await a.removeOne(e.Omen)}))}))}})}}]}]})))))}]},Pf(!0),{name:"Strength from Trade",dahanEvent:!0,effects:[{textArea:[.804,.918],text:"Lands with <dahan> have Defend 2. In lands with <town>/<city> and no <dahan>, Ravage Actions do +1 Damage.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.StrengthFromTrade,[yn.GlobalReminder]:()=>({icon:"Defend<br>+1 <damage>"}),[yn.DefendFromGame]:({land:a})=>a.hasAtLeast(1,e.Dahan)?2:0,[yn.AdjustCollectiveDahanRavageDamage]:({land:a})=>a.has(e.TownOrCity)&&a.doesntHave(e.Dahan)?1:0})}}]}]},lp={[af.AccumulatedDevastation]:Zf,[af.AnOminousDawn]:ep,[af.AStrangeMadnessAmongTheBeasts]:Pg,[af.BureaucratsAdjustFunding]:gf,[af.CitiesRise]:wf,[af.CivicEngagement]:yf,[af.CoastalTownsMultiply]:vf,[af.CulturalAssimilation]:Og,[af.DahanTradeWithTheInvaders]:Af,[af.DistantExploration]:Bg,[af.EagerExplorers]:If,[af.EtherealConjunction]:ap,[af.FarOffWarsTouchTheIsland]:tp,[af.FarmersSeekTheDahanForAid]:Lg,[af.FocusedFarming]:np,[af.Fortuneseekers]:xf,[af.GradualCorruption]:bf,[af.HardworkingSettlers]:Tf,[af.HarvestBountyHarvestDust]:Ef,[af.HeavyFarming]:Rg,[af.InfluxOfSettlers]:sp,[af.InterestingDiscoveries]:Ng,[af.InvadersSurgeInland]:Wg,[af.InvestedAristocracy]:Sf,[af.InvestigationOfDangers]:Mg,[af.LesserSpiritsImperiled]:Cf,[af.LifesBalanceTilts]:Bf,[af.MapmakersChartTheWild]:kf,[af.MissionariesArrive]:Gg,[af.NewSpeciesSpread]:jg,[af.NoBraveryWithoutNumbers]:Lf,[af.NuminousCrisis]:Rf,[af.Outpaced]:qg,[af.Overconfidence]:Nf,[af.PopulationRises]:_g,[af.PromisingFarmland]:Vg,[af.ProvincialSeat]:$f,[af.PullTogetherInAdversity]:Wf,[af.PuttingDownRoots]:zg,[af.RelentlessOptimism]:Mf,[af.RemnantsOfASpiritsHeart]:Gf,[af.ResourcefulPopulace]:jf,[af.RisingInterestInTheIsland]:Qg,[af.SacredSitesUnderThreat]:Xg,[af.SearchForNewLands]:Zg,[af.SearchForUnclaimedLand]:op,[af.SeekNewFarmland]:Uf,[af.SeekingTheInterior]:ef,[af.SlaveRebellion]:tf,[af.SmallerPortsSpringUp]:qf,[af.SprawlContainedByTheWilds]:_f,[af.StrangeTalesAttractExplorers]:nf,[af.TemporaryTruce]:Jf,[af.TerrorSpikesUpwards]:dp,[af.TheFrontierCalls]:Vf,[af.TheStrugglesOfGrowth]:zf,[af.ThrivingTrade]:Qf,[af.TightknitCommunities]:sf,[af.UrbanDevelopment]:of,[af.VisionsOutOfTime]:cp,[af.WarTouchesTheIslandsShores]:df,[af.WaveOfReconnaissance]:cf,[af.WellpreparedExplorers]:lf,[af.WoundedLandsAttractExplorers]:Xf,[af.YearsOfLittleRain]:hf};var hp=function(e,a,t,n){var r,i=arguments.length,s=i<3?a:null===n?n=Object.getOwnPropertyDescriptor(a,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,a,t,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(i<3?r(s):i>3?r(a,t,s):r(a,t))||s);return i>3&&s&&Object.defineProperty(a,t,s),s};class up{eventCardsInDeck;eventCardsInDiscard=[];lastSeenEventCard;static allEventCards=Object.keys(lp).filter((e=>!lp[e].banned));$;constructor(e){Xo.makeObservable(this),this.$=e;const a=e.config.sets??xg;this.eventCardsInDeck=new Ig(e,a.length===xg.length?up.allEventCards:up.allEventCards.filter((e=>a.includes(lp[e].set)))),this.eventCardsInDeck.remove(af.SlaveRebellion)}get activeEventCard(){return this.eventCardIsActive&&this.eventCardsInDiscard.length>0?this.eventCardsInDiscard[this.eventCardsInDiscard.length-1]:void 0}get eventCardAtIndexIsSpecial(){return e=>this.eventCardsInDeck.cardAt(e)===af.SlaveRebellion}get eventCardIsActive(){return[Wi.AdvanceCards,Wi.Build,Wi.Event,Wi.Explore,Wi.Fear,Wi.HighImmigration,Wi.Ravage,Wi.SlowPowers].includes(this.$.phase)}async drawEventCard(){if(this.eventCardsInDeck.count>0){await this.$.setPhase(Wi.Event);const e=await this.eventCardsInDeck.draw();this.lastSeenEventCard=e,this.eventCardsInDiscard.push(e);const a=this.$.blightStatus,t=this.$.terrorLevel,n=this.$.stage;if(await this.$.sendEvent({type:fn.DrawEventCard,eventCard:e}),await this.$.query({query:pn.ClickToContinueCard,items:[e],actionIds:[e]}),this.$.turn>1&&this.$.randomEventsEnabled){const r=lp[e];for(const i of r.events){const{blightStatus:r,terrorLevels:s,stages:o}=i;this.$.gameEnded||void 0!==r&&a!==r||void 0!==s&&!s.includes(t)||void 0!==o&&!o.includes(n)||(await this.$.sendEvent({type:fn.ResolveEventCard,eventData:i}),await this.$.addEffectUntilEndOfTurn({...i,card:e}))}await this.$.doEffects(yn.AfterResolvingEventCard,{eventCard:e})}}}insertEventCard(e){return{underCards:a=>{this.eventCardsInDiscard.includes(e)&&qr(this.eventCardsInDiscard,e),this.eventCardsInDeck.insert(e,a)}}}putBottomEventCardToTop(){if(!this.eventCardsInDeck.isEmpty){const e=this.eventCardsInDeck.removeCard(this.eventCardsInDeck.count-1);this.eventCardsInDeck.insertOneOf(e,0)}}putTopEventCardToBottom(){if(!this.eventCardsInDeck.isEmpty){const e=this.eventCardsInDeck.removeCard(0);this.eventCardsInDeck.insertOneOf(e,this.eventCardsInDeck.count)}}removeEventCardFromDiscard(e){this.eventCardsInDiscard.includes(e)&&qr(this.eventCardsInDiscard,e)}async revealTopEventCard(){const e=await this.eventCardsInDeck.reveal(0);return null!==e&&await this.$.clickToContinue({card:e,text:`The top Event Card is ${lp[e].name}.`}),e}shuffleTopThreeEventCards(){return this.eventCardsInDeck.shuffleTopNCards([0,1,2],!0)}shuffleTopTwoEventCards(){return this.eventCardsInDeck.shuffleTopNCards([0,1],!0)}toString(){return bg({eventCardsInDeck:this.eventCardsInDeck.count,eventCardsInDiscard:Vo(this.eventCardsInDiscard)},2)}}hp([Re],up.prototype,"eventCardsInDeck",void 0),hp([Re],up.prototype,"eventCardsInDiscard",void 0),hp([Re],up.prototype,"lastSeenEventCard",void 0);const gp={name:"Avoid the Dahan",set:a.Base,levels:[{textArea:[.273,.36],text:"Invaders do not Explore into lands with at least 2 <dahan>.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.AvoidTheDahanI,[yn.GlobalReminder]:()=>({icon:"Skip<br>Explore"}),[yn.PreventInvaderActionInLand]:({land:a,invaderAction:t})=>Promise.resolve(t===Hr.Explore&&a.hasAtLeast(2,e.Dahan))})}},{textArea:[.549,.64],text:"Invaders do not Build in lands where <dahan> outnumber <town>/<city>.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.AvoidTheDahanII,[yn.GlobalReminder]:()=>({icon:"Skip<br>Build"}),[yn.PreventInvaderActionInLand]:({land:a,invaderAction:t})=>Promise.resolve(t===Hr.Build&&a.the(e.Dahan).outnumber(e.TownOrCity))})}},{textArea:[.854,.894],text:"Invaders do not Build in lands with <dahan>.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.AvoidTheDahanIII,[yn.GlobalReminder]:()=>({icon:"Skip<br>Build"}),[yn.PreventInvaderActionInLand]:({land:a,invaderAction:t})=>Promise.resolve(t===Hr.Build&&a.has(e.Dahan))})}}]},fp={name:"Belief Takes Root",set:a.Base,levels:[{textArea:[.296,.336],text:"Defend 2 in all lands with <presence>.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.BeliefTakesRootI,[yn.GlobalReminder]:()=>({icon:"Defend<br><presence>"}),[yn.DefendFromGame]:({land:a})=>a.hasAtLeast(1,e.Presence)?2:0})}},{effects:[{textArea:[.538,.578],text:"Defend 2 in all lands with <presence>.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.BeliefTakesRootII,[yn.GlobalReminder]:()=>({icon:"Defend<br><presence>"}),[yn.DefendFromGame]:({land:a})=>a.hasAtLeast(1,e.Presence)?2:0})}},{textArea:[.584,.669],text:"Each Spirit gains 1 Energy per <sacred> they have in lands with Invaders.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.eachSpirit((a=>e.doFearAction((async()=>{await a.gainEnergy(a.inLandsWhere((e=>e.hasSacredSiteOf(a)&&e.hasInvaders)).count)}))))}}]},{textArea:[.819,.949],text:"Each player chooses a different land and removes up to 2 Health worth of Invaders per <presence> there.",[yn.Now]:async({$:e})=>{await e.inDifferentLands((a=>e.eachSpirit((()=>e.doFearAction((()=>a((async a=>{await a.removeInvadersWorthOfHealthUpTo(2*a.numberOf(e.Presence))}))))))))}}]},pp={name:"Dahan Enheartened",set:a.Base,levels:[{textArea:[.252,.383],text:"Each player may Push 1 <dahan> from a land with Invaders or Gather 1 <dahan> into a land with Invaders.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.inLandsWhere((a=>a.hasInvaders&&a.hasOrIsAdjacentToLandsWith(e.Dahan))).optionallyPickOne((a=>e.forPiecesThatIs(e.Dahan,(e=>e.isAdjacentTo(a)||e===a)).pickOne((t=>e.doFearAction((async()=>{t.location===a?await t.push():await a.gather({pieces:e.Dahan,pieceFilter:e=>e===t,pickPiecesEffect:{autoPlayOneOption:!0}})}))),{text:"Push/Gather 1 <dahan> from/into this land.",highlightLocations:[a]})),{text:"Choose a land with Invaders.",noOptions:"No applicable lands."})))},{textArea:[.534,.664],text:"Each player chooses a different land. In chosen lands: Gather up to 2 <dahan>, then 1 Damage if <dahan> are present.",[yn.Now]:({$:e})=>e.inDifferentLands((a=>e.eachSpirit((()=>e.doFearAction((()=>a((async a=>{await a.gatherUpTo(2,e.Dahan),a.has(e.Dahan)&&await a.damage(1)}))))))))},{textArea:[.817,.952],text:"Each player chooses a different land. In chosen lands: Gather up to 2 <dahan>, then 1 Damage per <dahan> present.",[yn.Now]:({$:e})=>e.inDifferentLands((a=>e.eachSpirit((()=>e.doFearAction((()=>a((async a=>{await a.gatherUpTo(2,e.Dahan),a.has(e.Dahan)&&await a.damage(a.numberOf(e.Dahan))}))))))))}]},wp={name:"Dahan On Their Guard",set:a.Base,levels:[{textArea:[.296,.336],text:"In each land, Defend 1 per <dahan>.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.DahanOnTheirGuardI,[yn.GlobalReminder]:()=>({icon:"Defend<br><dahan>"}),[yn.DefendFromGame]:({land:a})=>a.numberOf(e.Dahan)})}},{textArea:[.551,.638],text:"In each land with <dahan>, Defend 1, plus an additional Defend 1 per <dahan>.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.DahanOnTheirGuardII,[yn.GlobalReminder]:()=>({icon:"Defend<br><dahan>"}),[yn.DefendFromGame]:({land:e})=>e.numberOfParticipatingDahan>0?1+e.numberOfParticipatingDahan:0})}},{textArea:[.858,.898],text:"In each land, Defend 2 per <dahan>.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.DahanOnTheirGuardIII,[yn.GlobalReminder]:()=>({icon:"Defend<br><dahan>"}),[yn.DefendFromGame]:({land:e})=>2*e.numberOfParticipatingDahan})}}]},yp={name:"Dahan Raid",set:a.Base,levels:[{textArea:[.279,.367],text:"Each player chooses a different land with <dahan>. 1 Damage there.",[yn.Now]:({$:e})=>e.inLandsWith(e.Dahan).inDifferent((a=>e.eachSpirit((()=>e.doFearAction((()=>a((async e=>{await e.damage(1)}))))))),{noOptions:"No lands with <dahan>."})},{textArea:[.548,.636],text:"Each player chooses a different land with <dahan>. 1 Damage per <dahan> there.",[yn.Now]:({$:e})=>e.inLandsWith(e.Dahan).inDifferent((a=>e.eachSpirit((()=>e.doFearAction((()=>a((async a=>{await a.damage(a.numberOf(e.Dahan))}))))))))},{textArea:[.837,.923],text:"Each player chooses a different land with <dahan>. 2 Damage per <dahan> there.",[yn.Now]:({$:e})=>e.inLandsWith(e.Dahan).inDifferent((a=>e.eachSpirit((()=>e.doFearAction((()=>a((async a=>{await a.damage(2*a.numberOf(e.Dahan))}))))))),{noOptions:"No lands with <dahan>."})}]},mp={name:"Emigration Accelerates",set:a.Base,levels:[{textArea:[.276,.364],text:"Each player removes 1 <explorer> from a Coastal land.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Explorer,(e=>e.isCoastal)).pickOne((async e=>{await e.remove()}),{noOptions:"No Coastal lands with <explorer>."})))))},{textArea:[.549,.636],text:"Each player removes 1 <explorer>/<town> from a Coastal land.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.ExplorerOrTown,(e=>e.isCoastal)).pickOne((async e=>{await e.remove()}),{noOptions:"No Coastal lands with <explorer>/<town>."})))))},{textArea:[.834,.921],text:"Each player removes 1 <explorer>/<town> from any land.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.ExplorerOrTown).pickOne((async e=>{await e.remove()}),{noOptions:"No lands with <explorer>/<town>."})))))}]},vp={name:"Fear Of The Unseen",set:a.Base,levels:[{textArea:[.275,.363],text:"Each player removes 1 <explorer>/<town> from a land with <sacred>.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.ExplorerOrTown,(e=>e.hasSacredSite)).pickOne((async e=>{await e.remove()}),{noOptions:"No lands with <sacred> and <explorer>/<town>."})))))},{textArea:[.548,.638],text:"Each player removes 1 <explorer>/<town> from a land with <presence>.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.ExplorerOrTown,(a=>a.has(e.Presence))).pickOne((async e=>{await e.remove()}),{noOptions:"No lands with <explorer>/<town> and <presence>."})))))},{textArea:[.834,.924],text:"Each player removes 1 <explorer>/<town> from a land with <presence>, or 1 <city> from a land with <sacred>.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesWhere((a=>a.isA(e.ExplorerOrTown)&&a.location.has(e.Presence)||a.isA(e.City)&&a.location.hasSacredSite)).pickOne((async e=>{await e.remove()}),{noOptions:"No applicable lands."})))))}]},Ap={name:"Isolation",set:a.Base,levels:[{textArea:[.276,.361],text:"Each player removes 1 <explorer>/<town> from a land where it is the only Invader.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.ExplorerOrTown,(a=>a.hasExactly(1,e.Invader))).pickOne((async e=>{await e.remove()}),{noOptions:"No lands with <explorer>/<town> where it is the only Invader."})))))},{textArea:[.554,.64],text:"Each player removes 1 <explorer>/<town> from a land with 2 or fewer Invaders.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.ExplorerOrTown,(a=>a.hasAtMost(2,e.Invader))).pickOne((async e=>{await e.remove()}),{noOptions:"No lands with <explorer>/<town> with 2 or fewer Invaders."})))))},{textArea:[.837,.921],text:"Each player removes an Invader from a land with 2 or fewer Invaders.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Invader,(a=>a.hasAtMost(2,e.Invader))).pickOne((async e=>{await e.remove()}),{noOptions:"No lands with 2 or fewer Invaders."})))))}]},Ip={name:"Overseas Trade SeemSafer",set:a.Base,levels:[{textArea:[.296,.336],text:"Defend 3 in all Coastal lands.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.OverseasTradeSeemSaferI,[yn.GlobalReminder]:()=>({icon:"Defend<br>Coastal"}),[yn.DefendFromGame]:({land:e})=>e.isCoastal?3:0})}},{effects:[{textArea:[.552,.592],text:"Defend 6 in all Coastal lands.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.OverseasTradeSeemSaferII,[yn.GlobalReminder]:()=>({icon:"Defend<br>Coastal"}),[yn.DefendFromGame]:({land:e})=>e.isCoastal?6:0})}},{textArea:[.552,.638],text:"Invaders do not Build <city> in Coastal lands this turn.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.OverseasTradeSeemSaferII,[yn.GlobalReminder]:()=>({icon:"Skip<br>Build"}),[yn.PreventInvaderActionInLand]:({land:e,invaderAction:a})=>Promise.resolve(a===Hr.Build&&e.isCoastal&&e.buildPlans===Qn.City)})}}]},{effects:[{textArea:[.838,.878],text:"Defend 9 in all Coastal lands.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.OverseasTradeSeemSaferIII,[yn.GlobalReminder]:()=>({icon:"Defend<br>Coastal"}),[yn.DefendFromGame]:({land:e})=>e.isCoastal?9:0})}},{textArea:[.838,.923],text:"Invaders do not Build in Coastal lands this turn.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.OverseasTradeSeemSaferIII,[yn.GlobalReminder]:()=>({icon:"Skip<br>Build"}),[yn.PreventInvaderActionInLand]:({land:e,invaderAction:a})=>Promise.resolve(a===Hr.Build&&e.isCoastal&&e.buildPlans===Qn.City)})}}]}]},xp={name:"Retreat!",set:a.Base,levels:[{textArea:[.269,.364],text:"Each player may Push up to 2 <explorer> from an Inland land.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.inLandsWith(e.Explorer).where((e=>e.isInland)).optionallyPickOne((async a=>{await a.pushUpTo(2,e.Explorer)}),{noOptions:"No Inland lands with <explorer>."})))))},{textArea:[.549,.638],text:"Each player may Push up to 3 <explorer>/<town> from an Inland land.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.inLandsWith(e.ExplorerOrTown).where((e=>e.isInland)).optionallyPickOne((async a=>{await a.pushUpTo(3,e.ExplorerOrTown)}),{noOptions:"No Inland lands with <explorer>/<town>."})))))},{textArea:[.837,.923],text:"Each player may Push any number of <explorer>/<town> from one land.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.inLandsWith(e.ExplorerOrTown).optionallyPickOne((async a=>{await a.push({quantifier:lr.Any,pieces:e.ExplorerOrTown})}),{noOptions:"No lands with <explorer>/<town>."})))))}]},bp={name:"Scapegoats",set:a.Base,levels:[{textArea:[.296,.336],text:"Each <town> destroys 1 <explorer> in its land.",[yn.Now]:({$:e})=>e.inLandsWith(e.Town).selectOrder().forEach((a=>e.doFearAction((async()=>{await a.destroy({amount:a.numberOf(e.Town),pieces:e.Explorer})}),{land:a})),{noOptions:"No lands with <town>."})},{textArea:[.544,.647],text:"Each <town> destroys 1 <explorer> in its land. Each <city> destroys 2 <explorer> in its land.",[yn.Now]:({$:e})=>e.inLandsWith(e.TownOrCity).selectOrder().forEach((a=>e.doFearAction((async()=>{await a.destroy({amount:a.numberOf(e.Town)+2*a.numberOf(e.City),pieces:e.Explorer})}),{land:a})),{noOptions:"No lands with <town>/<city>."})},{textArea:[.828,.932],text:"Destroy all <explorer> in lands with <town>/<city>. Each <city> destroys 1 <town> in its land.",[yn.Now]:({$:e})=>e.inLandsWith(e.TownOrCity).selectOrder().forEach((a=>e.doFearAction((async()=>{await a.destroyAll(e.Explorer),await a.destroy({amount:a.numberOf(e.City),pieces:e.Town})}),{land:a})),{noOptions:"No lands with <town>/<city>."})}]},Tp={name:"Seek Safety",set:a.Base,levels:[{textArea:[.256,.388],text:"Each player may Push 1 <explorer> into a land with more <town>/<city> than the land it came from.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Explorer,(a=>a.hasAdjacentLandWhere((t=>t.numberOf(e.TownOrCity)>a.numberOf(e.TownOrCity))))).optionallyPickOne((async a=>{await a.push({amount:1,pieces:e.Explorer,destinationFilter:t=>t.numberOf(e.TownOrCity)>a.location.numberOf(e.TownOrCity)})}),{noOptions:"No applicable lands."})))))},{textArea:[.532,.676],text:"Each player may Gather 1 <explorer> into a land with <town>/<city>, or Gather 1 <town> into a land with <city>.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.chooseBetween({effects:[{actionId:"GatherExplorer",text:"Gather 1 <explorer> into a land with <town>/<city>.",[yn.Now]:()=>e.inLandsWith(e.TownOrCity).where((a=>a.hasAdjacentLandWhere((a=>a.has(e.Explorer))))).pickOne((async a=>{await a.gatherOne(e.Explorer)})),condition:()=>e.existLandWhere((a=>a.has(e.TownOrCity)&&a.hasAdjacentLandWhere((a=>a.has(e.Explorer)))))},{actionId:"GatherTown",text:"Gather 1 <town> into a land with <city>.",[yn.Now]:()=>e.inLandsWith(e.City).where((a=>a.hasAdjacentLandWithPiece(e.Town))).pickOne((async a=>{await a.gatherOne(e.Town)})),condition:()=>e.existLandWhere((a=>a.has(e.City)&&a.hasAdjacentLandWithPiece(e.Town)))},{actionId:"Neither",text:"Neither."}]})))))},{textArea:[.819,.957],text:"Each player may remove up to 3 Health worth of Invaders from a land without <city>.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.inLandsWhere((a=>a.has(e.ExplorerOrTown)&&a.doesntHave(e.City))).optionallyPickOne((async e=>{await e.removeInvadersWorthOfHealthUpTo(3)}),{noOptions:"No lands with Invader without <city>."})))))}]},Ep={name:"Tall Tales Of Savagery",set:a.Base,levels:[{textArea:[.276,.365],text:"Each player removes 1 <explorer> from a land with <dahan>.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Explorer,(a=>a.has(e.Dahan))).pickOne((async e=>{await e.remove()}),{noOptions:"No lands with <dahan> and <explorer>."})))))},{textArea:[.549,.638],text:"Each player removes 2 <explorer> or 1 <town> from a land with <dahan>.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((async()=>{await e.forPiecesThatIs(e.ExplorerOrTown,(a=>a.has(e.Dahan))).filteredByAnyInPriority((a=>a.location.hasAtLeast(2,e.Explorer)||a.location.has(e.Town)),(a=>a.location.hasAtLeast(1,e.Explorer))).pickOne((async a=>{await e.doFearAction((async()=>{const t=a.piece,n=a.location;await a.remove(),t===Bn.Explorer&&await n.removeOne(e.Explorer)}))}),{noOptions:"No applicable lands."})}))))},{effects:[{textArea:[.819,.911],text:"Remove 2 <explorer> or 1 <town> from each land with <dahan>.",[yn.Now]:async({$:e})=>{await e.inLandsWith(e.Dahan).selectOrder().forEach((async a=>{await e.doFearAction((async()=>{await a.piecesThatAre(e.ExplorerOrTown).pickOne((async a=>{const t=a.piece,n=a.location;await a.remove(),t===Bn.Explorer&&await n.removeOne(e.Explorer)}))}))}),{noOptions:"No lands with <dahan>."})}},{textArea:[.868,.955],text:"Then, remove 1 <city> from each land with at least 2 <dahan>.",[yn.Now]:async({$:e})=>{await e.inLandsWith(e.City).where((a=>a.hasAtLeast(2,e.Dahan))).forEach((async a=>{await e.doFearAction((async()=>{await a.removeOne(e.City)}))}),{noOptions:"No lands with <city> and at least 2 <dahan>."})}}]}]},Pp={name:"Trade Suffers",set:a.Base,levels:[{textArea:[.305,.345],text:"Invaders do not Build in lands with <city>.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.TradeSuffersI,[yn.GlobalReminder]:()=>({icon:"Skip<br>Build"}),[yn.PreventInvaderActionInLand]:({land:a,invaderAction:t})=>Promise.resolve(t===Hr.Build&&a.has(e.City))})}},{textArea:[.549,.64],text:"Each player may replace 1 <town> with 1 <explorer> in a Coastal land.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Town,(e=>e.isCoastal)).optionallyPickOne((async e=>{await e.replace([Bn.Explorer])}),{noOptions:"No Coastal lands with <town>."})))))},{textArea:[.832,.92],text:"Each player may replace 1 <city> with 1 <town>, or 1 <town> with 1 <explorer> in a Coastal land.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.TownOrCity,(e=>e.isCoastal)).optionallyPickOne((async e=>{await e.downgrade()}),{noOptions:"No Coastal lands with <town>."})))))}]},Sp={name:"Wary Of The Interior",set:a.Base,levels:[{textArea:[.273,.365],text:"Each player removes 1 <explorer> from an Inland land.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Explorer,(e=>e.isInland)).pickOne((async e=>{await e.remove()}),{noOptions:"No Inland lands with <explorer>."})))))},{textArea:[.549,.636],text:"Each player removes 1 <explorer>/<town> from an Inland land.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.ExplorerOrTown,(e=>e.isInland)).pickOne((async e=>{await e.remove()}),{noOptions:"No Inland lands with <explorer>/<town>."})))))},{textArea:[.835,.924],text:"Each player removes 1 <explorer>/<town> from any land.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.ExplorerOrTown).pickOne((async e=>{await e.remove()}),{noOptions:"No lands with <explorer>/<town>."})))))}]},Op={name:"Dahan Attack",set:a.BranchAndClaw,levels:[{textArea:[.276,.361],text:"Each player removes 1 <explorer> from a land with <dahan>.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Explorer,(a=>a.has(e.Dahan))).pickOne((async e=>{await e.remove()}),{noOptions:"No lands with <dahan> and <explorer>."})))))},{textArea:[.552,.643],text:"Each player chooses a different land with <dahan>. 1 Damage per <dahan> there.",[yn.Now]:({$:e})=>e.inLandsWith(e.Dahan).inDifferent((a=>e.eachSpirit((()=>e.doFearAction((()=>a((async a=>{await a.damage(a.numberOf(e.Dahan))}))))))),{noOptions:"No lands with <dahan>."})},{textArea:[.814,.946],text:"Each player chooses a different land with <town>/<city>. Gather 1 <dahan> into that land. Then 2 Damage per <dahan> there.",[yn.Now]:({$:e})=>e.inLandsWith(e.TownOrCity).inDifferent((a=>e.eachSpirit((()=>e.doFearAction((()=>a((async a=>{await a.gatherOne(e.Dahan),await a.damage(2*a.numberOf(e.Dahan))}))))))),{noOptions:"No lands with <town>/<city>."})}]},Cp=({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Invader,(a=>a.has(e.Dahan))).pickOne((async e=>{await e.addStrife()}),{noOptions:"No lands with <dahan> and Invaders."}))))),Dp={name:"Dahan Threaten",set:a.BranchAndClaw,levels:[{textArea:[.288,.328],text:"Each player adds 1 <strife> in a land with <dahan>.",[yn.Now]:Cp},{effects:[{textArea:[.534,.574],text:"Each player adds 1 <strife> in a land with <dahan>.",[yn.Now]:Cp},{textArea:[.579,.666],text:"For the rest of this turn, Invaders have -1 Health per <strife> to a minimum of 1.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.invadersHaveMinusOneHealthPerStrife()}}]},{effects:[{textArea:[.838,.878],text:"Each player adds 1 <strife> in a land with <dahan>.",[yn.Now]:Cp},{textArea:[.881,.921],text:"In every land with <strife>, 1 Damage per <dahan>.",[yn.Now]:({$:e})=>e.inLandsWithStrife().where((a=>a.has(e.Dahan))).selectOrder().forEach((a=>e.doFearAction((async()=>{await a.damage(a.numberOf(e.Dahan))}),{land:a})),{noOptions:"No lands with <dahan> and <strife>."})}]}]},Bp={name:"Demoralized",set:a.BranchAndClaw,levels:[{textArea:[.294,.334],text:"Defend 1 in all lands.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.DemoralizedI,[yn.GlobalReminder]:()=>({icon:"Defend<br>1 to All"}),[yn.DefendFromGame]:()=>1})}},{textArea:[.569,.609],text:"Defend 2 in all lands.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.DemoralizedII,[yn.GlobalReminder]:()=>({icon:"Defend<br>2 to All"}),[yn.DefendFromGame]:()=>2})}},{textArea:[.854,.894],text:"Defend 3 in all lands.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.DemoralizedIII,[yn.GlobalReminder]:()=>({icon:"Defend<br>3 to All"}),[yn.DefendFromGame]:()=>3})}}]},kp={name:"Depart The DangerousLand",set:a.BranchAndClaw,levels:[{textArea:[.269,.364],text:"Each player removes 1 <explorer> from a land with <beasts>, <disease>, or at least 2 <dahan>.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Explorer,(a=>a.hasOneOf(e.Beasts,e.Disease)||a.hasAtLeast(2,e.Dahan))).pickOne((async e=>{await e.remove()}),{noOptions:"No lands with <explorer> and <beasts>/<disease> or at least 2 <dahan>."})))))},{textArea:[.546,.633],text:"Each player removes 1 <explorer>/<town> from a land with <beasts>, <disease>, or at least 2 <dahan>.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.ExplorerOrTown,(a=>a.hasOneOf(e.Beasts,e.Disease)||a.hasAtLeast(2,e.Dahan))).pickOne((async e=>{await e.remove()}),{noOptions:"No lands with <explorer>/<town> and <beasts>/<disease> or at least 2 <dahan>."})))))},{textArea:[.808,.939],text:"Each player removes up to 4 Health worth of Invaders from a land with <beasts>, <disease>, or at least 2 <dahan>.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.inLandsWhere((a=>a.hasOneOf(e.Beasts,e.Disease)||a.hasAtLeast(2,e.Dahan))).pickOne((async e=>{await e.removeInvadersWorthOfHealthUpTo(4)}),{noOptions:"No lands with Invaders and <beasts>/<disease> or at least 2 <dahan>."})))))}]},Lp={name:"Explorers Are Reluctant",set:a.BranchAndClaw,levels:[{textArea:[.252,.384],text:"During the next normal Explore, skip the lowest-numbered land matching the Invader Card on each board.",[yn.Now]:async({$:e})=>{const a=[];await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.ExplorersAreReluctantI,[yn.GlobalReminder]:()=>({icon:"Skip<br>Explore"}),[yn.BeforeResolvingInvaderCard]:({invaderAction:t,card:n,normal:r})=>{if(r&&t===Hr.Explore)for(const t of e.boards){const e=t.lowestNumberedLandMatching(n,Hr.Explore);e&&a.push(e)}return Promise.resolve()},[yn.PreventInvaderActionInLand]:({land:e})=>Promise.resolve(a.includes(e)),[yn.AfterResolvingExploreCard]:()=>(e.removeThisEffect(),Promise.resolve())})}},{effects:[{textArea:[.529,.569],text:"Skip the next normal Explore.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.ExplorersAreReluctantII,[yn.GlobalReminder]:()=>({icon:"Skip<br>Explore"}),[yn.AdjustNumberOfExploreCards]:()=>-1,[yn.SkipNextExploreCard]:()=>(e.removeThisEffect(),Promise.resolve(!0))})}},{textArea:[.529,.661],text:"During the next Invader Phase, draw an additional Explore Card.",[yn.Now]:async({$:e})=>{const a=e.turn;await e.clickToContinue(),await e.addSubEffect({effectId:wn.ExplorersAreReluctantII,highPriority:!0,[yn.GlobalReminder]:()=>({icon:"Extra<br>Explore"}),[yn.AdjustNumberOfExploreCards]:()=>e.turn===a+1?1:0,[yn.AfterTheNormalExploreStep]:async()=>{e.turn===a+1&&(e.removeThisEffect(),await e.explore())}})}}]},{textArea:[.815,.946],text:"Skip the next normal Explore, but still reveal a card. (Perform the <escalation> if relevant.) Cards shift left as usual.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.ExplorersAreReluctantIII,[yn.GlobalReminder]:()=>({icon:"Skip<br>Explore"}),[yn.PreventInvaderActionInLand]:({invaderAction:e,normal:a})=>Promise.resolve(a&&e===Hr.Explore),[yn.AfterResolvingExploreCard]:()=>(e.removeThisEffect(),Promise.resolve())})}}]},Fp={name:"Flee The PestilentLand",set:a.BranchAndClaw,levels:[{textArea:[.271,.358],text:"Each player removes 1 <explorer>/<town> from a land with <disease>.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.ExplorerOrTown,(a=>a.has(e.Disease))).pickOne((async e=>{await e.remove()}),{noOptions:"No lands with <explorer>/<town> and <disease>."})))))},{textArea:[.534,.669],text:"Each player removes up to 3 Health of Invaders from a land with <disease> or 1 <explorer> from an Inland land.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.chooseBetween({noOptions:"No land with <disease> or Inland land with <explorer>.",effects:[{actionId:"RemoveFromDisease",textArea:[.534,.618],text:"Remove up to 3 Health of Invaders from a land with <disease>.",condition:()=>e.existLandWhere((a=>a.hasAllOf(e.Invader,e.Disease))),[yn.Now]:()=>e.inLandsWithAllOf(e.Invader,e.Disease).pickOne((async e=>{await e.removeInvadersWorthOfHealthUpTo(3)}))},{actionId:"RemoveFromInland",textArea:[.624,.664],text:"Remove 1 <explorer> from an Inland land.",[yn.Now]:()=>e.forPiecesThatIs(e.Explorer,(e=>e.isInland)).pickOne((async e=>{await e.remove()})),condition:()=>e.existLandWhere((a=>a.has(e.Explorer)&&a.isInland))}]})))))},{textArea:[.811,.949],text:"Each player removes up to 5 Health of Invaders from a land with <disease> or 1 <explorer>/<town> from an Inland land.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.chooseBetween({effects:[{actionId:"RemoveFromDisease",textArea:[.814,.9],text:"Remove up to 5 Health of Invaders from a land with <disease>.",condition:()=>e.existLandWhere((a=>a.hasInvaders&&a.has(e.Disease))),[yn.Now]:()=>e.inLandsWhere((a=>a.hasInvaders&&a.has(e.Disease))).pickOne((async e=>{await e.removeInvadersWorthOfHealthUpTo(5)}))},{actionId:"RemoveFromInland",textArea:[.903,.943],text:"Remove 1 <explorer>/<town> from an Inland land.",[yn.Now]:()=>e.forPiecesThatIs(e.ExplorerOrTown,(e=>e.isInland)).pickOne((async e=>{await e.remove()})),condition:()=>e.existLandWhere((a=>a.has(e.ExplorerOrTown)&&a.isInland))}]})))))}]},Rp={name:"Immigration Slows",set:a.BranchAndClaw,levels:[{textArea:[.252,.384],text:"During the next normal Build, skip the lowest-numbered land matching the Invader Card on each board.",[yn.Now]:async({$:e})=>{const a=[];await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.ImmigrationSlowsI,[yn.GlobalReminder]:()=>({icon:"Skip<br>Build"}),[yn.BeforeResolvingInvaderCard]:({invaderAction:t,card:n,normal:r})=>{if(r&&t===Hr.Build)for(const t of e.boards){const e=t.lowestNumberedLandMatching(n,Hr.Build);e&&a.push(e)}return Promise.resolve()},[yn.PreventInvaderActionInLand]:({land:e})=>Promise.resolve(a.includes(e)),[yn.AfterResolvingBuildCard]:()=>(e.removeThisEffect(),Promise.resolve())})}},{effects:[{textArea:[.555,.595],text:"Skip the next normal Build.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.ImmigrationSlowsII,[yn.GlobalReminder]:()=>({text:"Skip the next normal Build.<br><br>The Build Card remains in place instead of shifting left.",icon:"Skip<br>Build"}),[yn.SkipNextBuildCard]:()=>(e.removeThisEffect(),Promise.resolve(!0))})}},{textArea:[.555,.64],text:"The Build Card remains in place instead of shifting left.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.ImmigrationSlowsII,[yn.BeforeAdvancingCards]:async()=>{await e.advanceCardsIn(Zl.Explore).to(Zl.Build),await e.advanceCardsIn(Zl.Build).to(Zl.Explore)}})}}]},{textArea:[.834,.919],text:"Skip the next normal Build. The Build Card shifts left as usual.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.ImmigrationSlowsIII,[yn.GlobalReminder]:()=>({icon:"Skip<br>Build"}),[yn.SkipNextBuildCard]:()=>(e.removeThisEffect(),Promise.resolve(!0))})}}]},Np={name:"Panic",set:a.BranchAndClaw,levels:[{textArea:[.271,.357],text:"Each player adds 1 <strife> in a land with <beasts>/<disease>/<dahan>.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Invader,(a=>a.hasOneOf(e.Beasts,e.Disease,e.Dahan))).pickOne((async e=>{await e.addStrife()}),{noOptions:"No lands with Invader and <beasts>/<disease>/<dahan>."})))))},{effects:[{textArea:[.513,.602],text:"Each player adds 1 <strife> in a land with <beasts>/<disease>/<dahan>.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Invader,(a=>a.hasOneOf(e.Beasts,e.Disease,e.Dahan))).pickOne((async e=>{await e.addStrife()}),{noOptions:"No lands with Invader and <beasts>/<disease>/<dahan>."})))))},{textArea:[.559,.689],text:"For the rest of this turn, Invaders have -1 Health per <strife> to a minimum of 1.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.invadersHaveMinusOneHealthPerStrife()}}]},{effects:[{textArea:[.819,.859],text:"Each player adds 1 <strife> to an Invader.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Invader).pickOne((async e=>{await e.addStrife()}))))))},{textArea:[.863,.949],text:"For the rest of this turn, Invaders have -1 Health per <strife> to a minimum of 1.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.invadersHaveMinusOneHealthPerStrife()}}]}]},$p={name:"Panicked By Wild Beasts",set:a.BranchAndClaw,levels:[{textArea:[.273,.361],text:"Each player adds 1 <strife> in a land with or adjacent to <beasts>.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Invader,(a=>a.hasOrIsAdjacentToLandsWith(e.Beasts))).pickOne((async e=>{await e.addStrife()}),{noOptions:"No lands with Invaders in or adjacent to a land with <beasts>."})))))},{effects:[{textArea:[.536,.62],text:"Each player adds 1 <strife> in a land with or adjacent to <beasts>.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.forPiecesThatIs(e.Invader,(a=>a.hasOrIsAdjacentToLandsWith(e.Beasts))).pickOne((async e=>{await e.addStrife()}),{noOptions:"No lands with Invaders in or adjacent to a land with <beasts>."})))},{textArea:[.579,.666],text:"Invader skip their normal Explore and Build in lands with <beasts>.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.PanickedByWildBeastsII,[yn.GlobalReminder]:()=>({icon:"Skip<br><beasts>"}),[yn.PreventInvaderActionInLand]:({land:a,invaderAction:t,normal:n})=>Promise.resolve(n&&[Hr.Explore,Hr.Build].includes(t)&&a.has(e.Beasts))})}}]},{effects:[{textArea:[.818,.903],text:"Each player adds 1 <strife> in a land with or adjacent to <beasts>.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Invader,(a=>a.hasOrIsAdjacentToLandsWith(e.Beasts))).pickOne((async e=>{await e.addStrife()}),{noOptions:"No lands with Invaders in or adjacent to a land with <beasts>."})))))},{textArea:[.864,.949],text:"Invader skip all normal Actions in lands with <beasts>.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.PanickedByWildBeastsIII,[yn.GlobalReminder]:()=>({icon:"Skip<br><beasts>"}),[yn.PreventInvaderActionInLand]:({land:a,normal:t})=>Promise.resolve(t&&a.has(e.Beasts))})}}]}]},Wp={name:"Plan For Departure",set:a.BranchAndClaw,levels:[{textArea:[.276,.361],text:"Each player may Gather 1 <town> into a Coastal land.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.inLandsWhere((a=>a.isCoastal&&a.hasAdjacentLandWithPiece(e.Town))).optionallyPickOne((async a=>{await a.gatherOne(e.Town)}),{noOptions:"No Coastal lands with adjacent <town>."})))))},{effects:[{textArea:[.534,.62],text:"Each player may Gather 1 <explorer>/<town> into a Coastal land.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.inLandsWhere((a=>a.isCoastal&&a.hasAdjacentLandWithPiece(e.ExplorerOrTown))).optionallyPickOne((async a=>{await a.gatherOne(e.ExplorerOrTown)}),{noOptions:"No Coastal lands with adjacent <explorer>/<town>."})))))},{textArea:[.579,.661],text:"Defend 2 in all Coastal lands.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.PlanForDepartureII,[yn.GlobalReminder]:()=>({icon:"Defend<br>Coastal"}),[yn.DefendFromGame]:({land:e})=>e.isCoastal?2:0})}}]},{effects:[{textArea:[.814,.899],text:"Each player may Gather 2 <explorer>/<town> into a Coastal land.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.inLandsWhere((a=>a.isCoastal&&a.hasAdjacentLandWithPiece(e.ExplorerOrTown))).optionallyPickOne((async a=>{await a.gatherUpTo(2,e.ExplorerOrTown)}),{noOptions:"No Coastal lands with adjacent <explorer>/<town>."})))))},{textArea:[.854,.946],text:"Defend 4 in all Coastal lands.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.PlanForDepartureIII,[yn.GlobalReminder]:()=>({icon:"Defend<br>Coastal"}),[yn.DefendFromGame]:({land:e})=>e.isCoastal?4:0})}}]}]},Mp={name:"Quarantine",set:a.BranchAndClaw,levels:[{textArea:[.285,.325],text:"Explore does not affect Coastal lands.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.QuarantineI,[yn.GlobalReminder]:()=>({icon:"Skip<br>Explore"}),[yn.PreventInvaderActionInLand]:({land:e,invaderAction:a})=>Promise.resolve(a===Hr.Explore&&e.isCoastal)})}},{effects:[{textArea:[.534,.574],text:"Explore does not affect Coastal lands.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.QuarantineII,[yn.GlobalReminder]:()=>({icon:"Skip<br>Explore"}),[yn.PreventInvaderActionInLand]:({land:e,invaderAction:a})=>Promise.resolve(a===Hr.Explore&&e.isCoastal)})}},{textArea:[.572,.664],text:"Lands with <disease> are not a source of Invaders when Exploring.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.QuarantineII,[yn.GlobalReminder]:()=>({icon:"<disease>"}),[yn.PreventExploreSourceInLand]:({land:a})=>a.has(e.Disease)})}}]},{effects:[{textArea:[.837,.877],text:"Explore does not affect Coastal lands.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.QuarantineIII,[yn.GlobalReminder]:()=>({icon:"Skip<br>Explore"}),[yn.PreventInvaderActionInLand]:({land:e,invaderAction:a})=>Promise.resolve(a===Hr.Explore&&e.isCoastal)})}},{textArea:[.883,.923],text:"Invaders do not act in lands with <disease>.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.QuarantineIII,[yn.GlobalReminder]:()=>({icon:"<disease>"}),[yn.PreventInvaderActionInLand]:({land:a})=>Promise.resolve(a.has(e.Disease))})}}]}]},Gp={name:"Too Many Monsters",set:a.BranchAndClaw,levels:[{textArea:[.278,.365],text:"Each player removes 1 <explorer>/<town> from a land with <beasts>.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.ExplorerOrTown,(a=>a.has(e.Beasts))).pickOne((async e=>{await e.remove()}),{noOptions:"No lands with <explorer>/<town> and <beasts>."})))))},{textArea:[.532,.664],text:"Each player removes 1 <explorer> and 1 <town> from a land with <beasts> or 1 <explorer> from a land adjacent to <beasts>.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesWhere((a=>a.isA(e.Explorer)&&(a.location.has(e.Beasts)||a.location.hasAdjacentLandWithPiece(e.Beasts))||a.isA(e.Town)&&a.location.has(e.Beasts))).pickOne((async a=>{const t=a.location,n=a.piece;await a.remove(),t.has(e.Beasts)&&await t.removeOne(n===Bn.Explorer?e.Town:e.Explorer)}),{noOptions:"No applicable lands."})))))},{textArea:[.814,.947],text:"Each player removes 2 <explorer> and 2 <town> from a land with <beasts> or 1 <explorer>/<town> from a land adjacent to <beasts>.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.inLandsWhere((a=>a.hasAllOf(e.Beasts,e.ExplorerOrTown)||a.hasAdjacentLandWithPiece(e.Beasts)&&a.has(e.ExplorerOrTown))).pickOne((async a=>{a.has(e.Beasts)?(await a.remove({amount:2,pieces:e.Explorer}),await a.remove({amount:2,pieces:e.Town})):await a.removeOne(e.ExplorerOrTown)}),{noOptions:"No applicable lands."})))))}]},Hp={name:"Tread Carefully",set:a.BranchAndClaw,levels:[{textArea:[.252,.381],text:"Each player may choose a land with <dahan> or adjacent to at least 5 <dahan>. Invaders do not Ravage there this turn.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.inLandsWhere((a=>a.has(e.Dahan)||a.numberOfPiecesInAdjacentLands(e.Dahan)>=5)).pickOne((async e=>{await e.skipInvaderAction({text:"Invaders do not Ravage here this turn.",all:!0,filter:({invaderAction:e})=>e===Hr.Ravage})}),{noOptions:"No lands with <dahan>."})))))},{textArea:[.529,.657],text:"Each player may choose a land with <dahan> or adjacent to at least 3 <dahan>. Invaders do not Ravage there this turn.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.inLandsWhere((a=>a.has(e.Dahan)||a.numberOfPiecesInAdjacentLands(e.Dahan)>=3)).pickOne((async e=>{await e.skipInvaderAction({text:"Invaders do not Ravage here this turn.",all:!0,filter:({invaderAction:e})=>e===Hr.Ravage})}),{noOptions:"No lands with <dahan>."})))))},{textArea:[.812,.943],text:"Each player may choose a land with <dahan> or adjacent to <dahan>. Invaders do not Ravage there this turn.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.inLandsWithOrAdjacentTo(e.Dahan).pickOne((async e=>{await e.skipInvaderAction({text:"Invaders do not Ravage here this turn.",all:!0,filter:({invaderAction:e})=>e===Hr.Ravage})}),{noOptions:"No lands with <dahan>."})))))}]},jp={name:"Unrest",set:a.BranchAndClaw,levels:[{textArea:[.289,.329],text:"Each player adds 1 <strife> to a <town>.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Town).pickOne((async e=>{await e.addStrife()}),{noOptions:"No lands with <town>."})))))},{effects:[{textArea:[.536,.576],text:"Each player adds 1 <strife> to a <town>.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Town).pickOne((async e=>{await e.addStrife()}),{noOptions:"No lands with <town>."})))))},{textArea:[.577,.664],text:"For the rest of this turn, Invaders have -1 Health per <strife> to a minimum of 1.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.invadersHaveMinusOneHealthPerStrife()}}]},{effects:[{textArea:[.821,.861],text:"Each player adds 1 <strife> to an Invader.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Invader).pickOne((async e=>{await e.addStrife()}),{noOptions:"No lands with Invaders."})))))},{textArea:[.865,.95],text:"For the rest of this turn, Invaders have -1 Health per <strife> to a minimum of 1.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.invadersHaveMinusOneHealthPerStrife()}}]}]},Up={name:"Angry Mobs",set:a.FeatherAndFlame,levels:[{textArea:[.272,.363],text:"Each player may Replace 1 <town> with 2 <explorer>. 1 <fear> per player who does.",[yn.Now]:({$:e})=>e.eachSpirit((async()=>{await e.doFearAction((async()=>{await e.forPiecesThatIs(e.Town).optionallyPickOne((async e=>{const a=e.location;await e.replace([Bn.Explorer,Bn.Explorer]),await a.fear(1)}),{noOptions:"No lands with <town>."})}))}))},{textArea:[.549,.643],text:"In each land with 2 or more <explorer>, Destroy 1 <explorer>/<town> per 2 <explorer>.",[yn.Now]:({$:e})=>e.inLandsWhere((a=>a.hasAtLeast(2,e.Explorer))).selectOrder().forEach((a=>e.doFearAction((async()=>{await a.destroy({amount:a.forEvery(2,e.Explorer),pieces:e.ExplorerOrTown})}),{land:a})),{noOptions:"No lands with at least 2 <explorer>."})},{textArea:[.831,.916],text:"In each land with 2 or more <explorer>, Destroy 1 Invader per 2 <explorer>.",[yn.Now]:({$:e})=>e.inLandsWhere((a=>a.hasAtLeast(2,e.Explorer))).selectOrder().forEach((a=>e.doFearAction((async()=>{await a.destroy({amount:a.forEvery(2,e.Explorer),pieces:e.Invader})}),{land:a})),{noOptions:"No lands with at least 2 <explorer>."})}]},qp={name:"Communities In Disarray",set:a.FeatherAndFlame,levels:[{effects:[{textArea:[.262,.302],text:"<city> each deal -1 Damage during Ravage.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.CommunitiesInDisarrayI,[yn.GlobalReminder]:()=>({icon:"<city><br>-1 <damage>"}),[yn.AdjustIndividualInvaderRavageDamage]:({piece:a})=>a.isA(e.City)?-1:0})}},{textArea:[.306,.387],text:"Invaders do not heal Damage at the end of this turn.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.CommunitiesInDisarrayI,[yn.GlobalReminder]:()=>({icon:"Prevent<br>Heal"}),[yn.PreventClearDamage]:({piece:e})=>e.isInvader})}}]},{effects:[{textArea:[.536,.621],text:"<town>/<city> each deal -1 Damage during Ravage.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.CommunitiesInDisarrayII,[yn.GlobalReminder]:()=>({icon:"<town>/<city><br>-1 <damage>"}),[yn.AdjustIndividualInvaderRavageDamage]:({piece:a})=>a.isA(e.TownOrCity)?-1:0})}},{textArea:[.579,.664],text:"Invaders do not heal Damage at the end of this turn.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.CommunitiesInDisarrayII,[yn.GlobalReminder]:()=>({icon:"Prevent<br>Heal"}),[yn.PreventClearDamage]:({piece:e})=>e.isInvader})}}]},{effects:[{textArea:[.821,.906],text:"<town>/<city> each deal -2 Damage during Ravage.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.CommunitiesInDisarrayIII,[yn.GlobalReminder]:()=>({icon:"<town>/<city><br>-2 <damage>"}),[yn.AdjustIndividualInvaderRavageDamage]:({piece:a})=>a.isA(e.TownOrCity)?-2:0})}},{textArea:[.867,.953],text:"Invaders do not heal Damage at the end of this turn.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.CommunitiesInDisarrayIII,[yn.GlobalReminder]:()=>({icon:"Prevent<br>Heal"}),[yn.PreventClearDamage]:({piece:e})=>e.isInvader})}}]}]},_p={name:"Depopulation",set:a.FeatherAndFlame,levels:[{textArea:[.296,.336],text:"On Each Board: Replace 1 <town> with 1 <explorer>.",[yn.Now]:({$:e})=>e.onEachBoard((a=>e.doFearAction((()=>a.forPiecesThatIs(e.Town).pickOne((async e=>{await e.replace([Bn.Explorer])}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <town>.`})),{board:a})))},{textArea:[.572,.612],text:"On Each Board: Remove 1 <town>.",[yn.Now]:({$:e})=>e.onEachBoard((a=>e.doFearAction((()=>a.forPiecesThatIs(e.Town).pickOne((async e=>{await e.remove()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <town>.`})),{board:a})))},{textArea:[.841,.929],text:"On Each Board: Remove 1 <town>, or replace 1 <city> with <town>.",[yn.Now]:({$:e})=>e.onEachBoard((a=>a.forPiecesThatIs(e.TownOrCity).pickOne((a=>e.doFearAction((async()=>{a.isA(e.Town)?await a.remove():await a.replace([Bn.Town])}))),{highlightBoards:[a],noOptions:`On board ${a.name}: No <town>/<city>.`})))}]},Jp={name:"Discord",set:a.FeatherAndFlame,levels:[{textArea:[.272,.355],text:"Each player adds 1 <strife> in a different land with at least 2 Invaders.",[yn.Now]:({$:e})=>e.inLands().where((a=>a.hasAtLeast(2,e.Invader))).inDifferent((a=>e.eachSpirit((()=>e.doFearAction((()=>a((async e=>{await e.addStrife(1)}))))))),{noOptions:"No lands with at least 2 Invaders."})},{effects:[{textArea:[.534,.623],text:"Each player adds 1 <strife> in a different land with at least 2 Invaders.",[yn.Now]:({$:e})=>e.inLands().where((a=>a.hasAtLeast(2,e.Invader))).inDifferent((a=>e.eachSpirit((()=>e.doFearAction((()=>a((async e=>{await e.addStrife(1)}))))))),{noOptions:"No lands with at least 2 Invaders."})},{textArea:[.577,.664],text:"Then, each Invader takes 1 Damage per <strife> it has.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.inLandsWithStrife().forEach((a=>e.doFearAction((()=>a.piecesWithStrife().forEach((async e=>{await e.damageOnlyThis(e.strife)}))),{land:a})),{noOptions:"No lands with <strife>."})}}]},{effects:[{textArea:[.801,.886],text:"Each player adds 1 <strife> in a different land with at least 2 Invaders.",[yn.Now]:({$:e})=>e.inLands().where((a=>a.hasAtLeast(2,e.Invader))).inDifferent((a=>e.eachSpirit((()=>e.doFearAction((()=>a((async e=>{await e.addStrife(1)}))))))),{noOptions:"No lands with at least 2 Invaders."})},{textArea:[.842,.967],text:"Then, each Invader with <strife> deals Damage to other Invaders in its land.",[yn.Now]:({$:e})=>e.inLandsWithStrife().selectOrder().forEach((a=>e.doFearAction((async()=>{await a.piecesWithStrifeDealsDamageToOtherInvaders()}),{land:a})),{noOptions:"No Invader with <strife>."})}]}]},Vp={name:"Mimic The Dahan",set:a.FeatherAndFlame,levels:[{textArea:[.268,.357],text:"Each player Removes 1 <explorer>/<town> from a land with 2 or more <dahan>.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.ExplorerOrTown,(a=>a.hasAtLeast(2,e.Dahan))).pickOne((async e=>{await e.remove()}),{noOptions:"No lands with <explorer>/<town> with 2 or more <dahan>."})))))},{textArea:[.554,.641],text:"Each player Replaces 1 <explorer>/<town> with 1 <dahan> in a land with 2 or more <dahan>.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.ExplorerOrTown,(a=>a.hasAtLeast(2,e.Dahan))).pickOne((async e=>{await e.replace([Bn.Dahan])}),{noOptions:"No lands with <explorer>/<town> with 2 or more <dahan>."})))))},{textArea:[.818,.944],text:"Each player Replaces 1 <explorer>/<town> with 1 <dahan> in a land with <dahan>, or adjacent to 3 or more <dahan>.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.ExplorerOrTown,(a=>a.has(e.Dahan)||a.numberOfPiecesInAdjacentLands(e.Dahan)>=3)).pickOne((async e=>{await e.replace([Bn.Dahan])}),{noOptions:"No lands with <explorer>/<town> with <dahan> or adjacent to 3 or more <dahan>."})))))}]},Yp={name:"Spreading Timidity",set:a.FeatherAndFlame,levels:[{textArea:[.291,.331],text:"Each player chooses a land to Isolate.",[yn.Now]:({$:e})=>e.inDifferentLands((a=>e.eachSpirit((()=>e.doFearAction((()=>a((async e=>{await e.isolate()}))))))))},{textArea:[.552,.637],text:"Each player chooses a different land to Isolate. Also, Defend 2 in those lands.",[yn.Now]:({$:e})=>e.inDifferentLands((a=>e.eachSpirit((()=>e.doFearAction((()=>a((async e=>{await e.isolate(),await e.defend(2)}))))))))},{textArea:[.831,.923],text:"Each player chooses a different land to Isolate. Also, Defend 4 in those lands.",[yn.Now]:({$:e})=>e.inDifferentLands((a=>e.eachSpirit((()=>e.doFearAction((()=>a((async e=>{await e.isolate(),await e.defend(4)}))))))))}]},zp={name:"Beset By Many Troubles",set:a.JaggedEarth,levels:[{textArea:[.278,.363],text:"In each land with <badlands>/<beasts>/<disease>/<wilds>/<strife>, Defend 3.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.BesetByManyTroublesI,[yn.GlobalReminder]:()=>({icon:"Defend"}),[yn.DefendFromGame]:({land:a})=>a.has(e.BadlandsBeastsDiseaseOrWilds)||a.hasStrife?3:0})}},{textArea:[.555,.641],text:"In each land with <badlands>/<beasts>/<disease>/<wilds>/<strife>, or adjacent to 3 or more such tokens, Defend 5.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.BesetByManyTroublesII,[yn.GlobalReminder]:()=>({icon:"Defend"}),[yn.DefendFromGame]:({land:a})=>a.has(e.BadlandsBeastsDiseaseOrWilds)||a.hasStrife||a.numberOfPiecesInAdjacentLands(e.BadlandsBeastsDiseaseOrWilds)+a.adjacentNumberOfStrife>=3?5:0})}},{textArea:[.831,.919],text:"Every <badlands>/<beasts>/<disease>/<wilds>/<strife> grants Defend 3 in its land and adjacent lands.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.BesetByManyTroublesIII,[yn.GlobalReminder]:()=>({icon:"Defend"}),[yn.DefendFromGame]:({land:a})=>3*(a.numberOf(e.BadlandsBeastsDiseaseOrWilds)+a.numberOfStrife+a.numberOfPiecesInAdjacentLands(e.BadlandsBeastsDiseaseOrWilds)+a.adjacentNumberOfStrife)})}}]},Qp={name:"Dahan Reclaim Fishing Grounds",set:a.JaggedEarth,levels:[{textArea:[.255,.388],text:"Each player chooses a different Coastal land with <dahan>. In each: 1 Damage per <dahan>.",[yn.Now]:({$:e})=>e.inCoastalLands().where((a=>a.has(e.Dahan))).inDifferent((a=>e.eachSpirit((()=>e.doFearAction((()=>a((async a=>{await a.damage(a.numberOf(e.Dahan))}))))))),{noOptions:"No Coastal lands with <dahan>."})},{textArea:[.534,.664],text:"Each player chooses a different Coastal land. In each: Gather up to 1 <dahan>. 1 Damage per <dahan>.",[yn.Now]:({$:e})=>e.inCoastalLands().inDifferent((a=>e.eachSpirit((()=>e.doFearAction((()=>a((async a=>{await a.gatherUpTo(1,e.Dahan),await a.damage(a.numberOf(e.Dahan))}))))))))},{textArea:[.818,.952],text:"Each player chooses a different Coastal land. In each: Gather up to 1 <dahan>. 2 Damage per <dahan>.",[yn.Now]:({$:e})=>e.inCoastalLands().inDifferent((a=>e.eachSpirit((()=>e.doFearAction((()=>a((async a=>{await a.gatherUpTo(1,e.Dahan),await a.damage(2*a.numberOf(e.Dahan))}))))))))}]},Kp={name:"Flee From Dangerous Lands",set:a.JaggedEarth,levels:[{textArea:[.273,.365],text:"On Each Board: Push 1 <explorer>/<town> from a land with <badlands>/<wilds>/<dahan>.",[yn.Now]:({$:e})=>e.onEachBoard((a=>e.doFearAction((()=>a.forPiecesThatIs(e.ExplorerOrTown,(a=>a.hasOneOf(e.Badlands,e.Wilds,e.Dahan))).pickOne((async e=>{await e.push()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <explorer>/<town> in a land with <badlands>/<wilds>/<dahan>.`})),{board:a})))},{textArea:[.555,.641],text:"On Each Board: Remove 1 <explorer>/<town> from a land with <badlands>/<wilds>/<dahan>.",[yn.Now]:({$:e})=>e.onEachBoard((a=>e.doFearAction((()=>a.forPiecesThatIs(e.ExplorerOrTown,(a=>a.hasOneOf(e.Badlands,e.Wilds,e.Dahan))).pickOne((async e=>{await e.remove()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with <explorer>/<town> in a land with <badlands>/<wilds>/<dahan>.`})),{board:a})))},{textArea:[.814,.946],text:"On Each Board: Remove 1 <explorer>/<town> from any land, or Remove 1 <city> from a land with <badlands>/<wilds>/<dahan>.",[yn.Now]:({$:e})=>e.onEachBoard((a=>e.doFearAction((()=>a.forPiecesWhere((a=>a.isA(e.ExplorerOrTown)||a.isA(e.City)&&a.location.hasOneOf(e.Badlands,e.Wilds,e.Dahan))).pickOne((async e=>{await e.remove()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No applicable lands.`})),{board:a})))}]},Xp={name:"Nerves Fray",set:a.JaggedEarth,levels:[{textArea:[.276,.364],text:"Each player adds 1 <strife> in a land not matching a Ravage Card.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Invader,(a=>!a.matchesInvaderCards(e.invaderCardsInVisibleSlot(Zl.Ravage),Hr.Ravage))).pickOne((async e=>{await e.addStrife()}),{noOptions:"No lands with Invaders not matching a Ravage Card."})))))},{textArea:[.558,.644],text:"Each player adds 2 <strife> in a single land not matching a Ravage Card.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.inLandsWith(e.Invader).where((a=>!a.matchesInvaderCards(e.invaderCardsInVisibleSlot(Zl.Ravage),Hr.Ravage))).pickOne((async e=>{await e.addStrife(2)}),{noOptions:"No lands with Invaders not matching a Ravage Card."})))))},{effects:[{textArea:[.817,.904],text:"Each player adds 2 <strife> in a single land not matching a Ravage Card.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.inLandsWith(e.Invader).where((a=>!a.matchesInvaderCards(e.invaderCardsInVisibleSlot(Zl.Ravage),Hr.Ravage))).pickOne((async e=>{await e.addStrife(2)}),{noOptions:"No lands with Invaders not matching a Ravage Card."})))))},{textArea:[.907,.947],text:"1 <fear> per player.",[yn.Now]:async({$:e})=>{await e.clickToContinue({noOptions:`${e.spiritCount} player${e.spiritCount>1?"s":""} = ${e.spiritCount} <fear>.`}),await e.doFearAction((async()=>{await e.fear(e.spiritCount)}))}}]}]},Zp={name:"Sense Of Dread",set:a.JaggedEarth,levels:[{textArea:[.269,.367],text:"On Each Board: Remove 1 <explorer> from a land matching a Ravage Card.",[yn.Now]:({$:e})=>e.onEachBoard((a=>e.doFearAction((()=>a.forPiecesThatIs(e.Explorer).where((a=>a.location.matchesInvaderCards(e.invaderCardsInVisibleSlot(Zl.Ravage),Hr.Ravage))).pickOne((async e=>{await e.remove()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No land with <explorer> in a land matching a Ravage Card.`})),{board:a})))},{textArea:[.552,.641],text:"On Each Board: Remove 1 <explorer>/<town> from a land matching a Ravage Card.",[yn.Now]:({$:e})=>e.onEachBoard((a=>e.doFearAction((()=>a.forPiecesThatIs(e.ExplorerOrTown).where((a=>a.location.matchesInvaderCards(e.invaderCardsInVisibleSlot(Zl.Ravage),Hr.Ravage))).pickOne((async e=>{await e.remove()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No land with <explorer>/<town> in a land matching a Ravage Card.`})),{board:a})))},{textArea:[.831,.917],text:"On Each Board: Remove 1 Invader from a land matching a Ravage Card.",[yn.Now]:({$:e})=>e.onEachBoard((a=>e.doFearAction((()=>a.forPiecesThatIs(e.Invader).where((a=>a.location.matchesInvaderCards(e.invaderCardsInVisibleSlot(Zl.Ravage),Hr.Ravage))).pickOne((async e=>{await e.remove()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No land with Invader in a land matching a Ravage Card.`})),{board:a})))}]},ew={name:"Theological Strife",set:a.JaggedEarth,levels:[{textArea:[.302,.342],text:"Each player adds 1 <strife> in a land with <presence>.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Invader,(a=>a.has(e.Presence))).pickOne((async e=>{await e.addStrife()}),{noOptions:"No Invaders in a land with <presence>."})))))},{effects:[{textArea:[.538,.578],text:"Each player adds 1 <strife> in a land with <presence>.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Invader,(a=>a.has(e.Presence))).pickOne((async e=>{await e.addStrife()}),{noOptions:"No Invaders in a land with <presence>."})))))},{textArea:[.582,.664],text:"Each Spirit gains 1 Energy per <sacred> they have in lands with Invaders.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.eachSpirit((a=>e.doFearAction((async()=>{await a.gainEnergy(a.inSacredSites().where((e=>e.hasInvaders)).count)}))))}}]},{effects:[{textArea:[.818,.858],text:"Each player adds 1 <strife> in a land with <presence>.",[yn.Now]:({$:e})=>e.eachSpirit((()=>e.doFearAction((()=>e.forPiecesThatIs(e.Invader,(a=>a.has(e.Presence))).pickOne((async e=>{await e.addStrife()}),{noOptions:"No Invaders in a land with <presence>."})))))},{textArea:[.863,.95],text:"Then, each Invader with <strife> deals Damage to other Invaders in its land.",[yn.Now]:({$:e})=>e.inLandsWithStrife().selectOrder().forEach((a=>e.doFearAction((async()=>{await a.piecesWithStrifeDealsDamageToOtherInvaders()}),{land:a})),{noOptions:"No Invader with <strife>"})}]}]},aw=({$:e})=>e.onEachBoard((a=>e.doFearAction((()=>a.forPiecesThatIs(e.TownOrCity).where((a=>!a.location.matchesInvaderCards(e.invaderCardsInVisibleSlot(Zl.Ravage),Hr.Ravage))).pickOne((async e=>{await e.addStrife()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No land with <town>/<city> in a land not matching a Ravage Card.`})),{board:a}))),tw=async({$:e})=>{await e.clickToContinue(),await e.inLandsWithStrife().forEach((a=>e.doFearAction((()=>a.piecesWithStrife().forEach((async e=>{await e.damageOnlyThis(e.strife)}))),{land:a})),{noOptions:"No lands with <strife>."})},nw={name:"Civil Unrest",set:a.NatureIncarnate,levels:[{textArea:[.284,.373],text:"On Each Board: Add 1 <strife> to a <town>/<city> in a land not matching a Ravage Card.",[yn.Now]:aw},{effects:[{textArea:[.534,.629],text:"On Each Board: Add 1 <strife> to a <town>/<city> in a land not matching a Ravage Card.",[yn.Now]:aw},{textArea:[.632,.673],text:"Each Invader takes 1 Damage per <strife> it has.",[yn.Now]:tw}]},{effects:[{textArea:[.826,.866],text:"On Each Board: Add 1 <strife>.",[yn.Now]:({$:e})=>e.onEachBoard((a=>e.doFearAction((()=>a.forPiecesThatIs(e.Invader).pickOne((async e=>{await e.addStrife()}),{highlightBoards:[a],noOptions:`On board ${a.name}: No land with Invaders.`})),{board:a})))},{textArea:[.865,.905],text:"Each Invader takes 1 Damage per <strife> it has.",[yn.Now]:tw}]}]},rw=(e,a)=>({$:t})=>t.inLandsWith(t.Dahan).inDifferent((n=>t.eachSpirit((r=>t.doFearAction((()=>n((async t=>{e>0&&await t.damage(e),await t.defend(a)}))),{spirit:r})))),{noOptions:"No lands with <dahan>."}),iw={name:"Dahan Gain The Edge",set:a.NatureIncarnate,levels:[{textArea:[.267,.354],text:"Each player chooses a different land with <dahan>. In Each: Defend 2.",[yn.Now]:rw(0,2)},{textArea:[.546,.638],text:"Each player chooses a different land with <dahan>. In Each: 1 Damage and Defend 3.",[yn.Now]:rw(1,3)},{textArea:[.829,.916],text:"Each player chooses a different land with <dahan>. In Each: 2 Damage and Defend 4.",[yn.Now]:rw(2,4)}]},sw=async({$:e})=>{const a=e.inBoardsWhere((a=>a.hasOneLandWith(e.Invader)&&a.hasOneLandWith(e.Dahan))).count;await e.clickToContinue({noOptions:`${a} board${a>1?"s":""} = ${a} <fear>.`}),await e.doFearAction((async()=>{await e.fear(a)}))},ow=async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.DauntedByTheDahan,text:"Invaders do -6 Damage on their Ravage.",[yn.GlobalReminder]:()=>({icon:"-6 <damage><br>to <dahan>"}),[yn.AdjustCollectiveInvaderRavageDamage]:e=>!1===e.towardsLand?-6:0})},dw=async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.DauntedByTheDahan,[yn.GlobalReminder]:()=>({icon:"Defend"}),[yn.DefendFromGame]:({land:a})=>a.has(e.Dahan)?3:0})},cw={name:"Daunted By The Dahan",set:a.NatureIncarnate,levels:[{effects:[{textArea:[.253,.293],text:"1 <fear> per board with both Invaders and <dahan>.",[yn.Now]:sw},{textArea:[.298,.385],text:"Invaders do -6 Damage to <dahan> (per land) during Ravage.",[yn.Now]:ow}]},{effects:[{textArea:[.531,.571],text:"1 <fear> per board with both Invaders and <dahan>.",[yn.Now]:sw},{textArea:[.573,.613],text:"Lands with <dahan> have Defend 3.",[yn.Now]:dw},{textArea:[.573,.66],text:"Invaders do -6 Damage to <dahan> (per land) during Ravage.",[yn.Now]:ow}]},{effects:[{textArea:[.798,.838],text:"1 <fear> per board with both Invaders and <dahan>.",[yn.Now]:sw},{textArea:[.845,.885],text:"Lands with <dahan> have Defend 3.",[yn.Now]:dw},{textArea:[.837,.927],text:"Invaders do -6 Damage to <dahan> (per land) during Ravage.",[yn.Now]:ow},{textArea:[.927,.967],text:"Isolate all lands with <dahan>.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.DauntedByTheDahan,[yn.GlobalReminder]:()=>({icon:"Isolate<br><dahan>"}),[yn.Reminder]:a=>a.has(e.Dahan)?"Isolated Land.":void 0,[yn.Isolated]:({land:a})=>a.has(e.Dahan)})}}]}]},lw={name:"Distracted By Local Troubles",set:a.NatureIncarnate,levels:[{textArea:[.279,.363],text:"On Each Board, in a land matching a Ravage Card: 1 Damage.",[yn.Now]:({$:e})=>e.onEachBoard((a=>e.doFearAction((()=>a.forPiecesThatIs(e.Invader,(a=>a.matchesInvaderCards(e.invaderCardsInVisibleSlot(Zl.Ravage),Hr.Ravage))).pickOne((async a=>{await a.damageOnlyThis(1,e.Invader)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with invaders matching a Ravage Card.`})),{board:a})))},{effects:[{textArea:[.525,.604],text:"Invaders each do -1 Damage per Damage they have taken.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.DistractedByLocalTroublesII,[yn.GlobalReminder]:()=>({icon:"Reduce<br><damage>"}),[yn.AdjustDamage]:({piece:e})=>e.isInvader?-e.damage:0})}},{textArea:[.562,.688],text:"On Each Board, in a land matching a Ravage Card: 1 Damage each to up to 2 Invaders",[yn.Now]:({$:e})=>e.onEachBoard((a=>e.doFearAction((()=>a.inLandsWhere((a=>a.hasInvaders&&a.matchesInvaderCards(e.invaderCardsInVisibleSlot(Zl.Ravage),Hr.Ravage))).pickOne((async a=>{await a.piecesWhere((e=>e.isInvader)).pickMultiple({amount:2,forPickedItem:async a=>{await a.damageOnlyThis(1,e.Invader)},optional:!0})}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with invaders matching a Ravage Card.`})),{board:a})))}]},{effects:[{textArea:[.806,.888],text:"Invaders each do -1 Damage per Damage they have taken.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffectUntilEndOfTurn({effectId:wn.DistractedByLocalTroublesIII,[yn.GlobalReminder]:()=>({icon:"Reduce<br><damage>"}),[yn.AdjustDamage]:({piece:e})=>e.isInvader?-e.damage:0})}},{textArea:[.843,.963],text:"On Each Board, in two lands matching a Ravage Card: 2 Damage (per land).",[yn.Now]:({$:e})=>e.onEachBoard((a=>e.doFearAction((()=>a.inLandsWhere((a=>a.hasInvaders&&a.matchesInvaderCards(e.invaderCardsInVisibleSlot(Zl.Ravage),Hr.Ravage))).pickMultiple({amount:2,forPickedItem:async e=>{await e.damage(2)},effect:{highlightBoards:[a],noOptions:`On board ${a.name}: No lands with invaders matching a Ravage Card.`}})),{board:a})))}]}]},hw=(e,a)=>({$:t})=>t.eachSpirit((n=>t.doFearAction((async()=>{let r=null;await t.forPiecesThatIs(t.ExplorerOrTown).where((e=>!e.location.matchesInvaderCards(t.invaderCardsInVisibleSlot(Zl.Build),Hr.Build))).pickMultiple({amount:a,optional:!0,where:e=>null===r||e.location===r,forPickedItem:async a=>{r=a.location,e?await a.push():await a.remove()},effect:{players:[n],noOptions:"No land with <town>/<city> in a land not matching a Build Card."}})}),{spirit:n}))),uw={name:"Restlessness",set:a.NatureIncarnate,levels:[{textArea:[.276,.362],text:"Each player Pushes up to 1 <explorer>/<town> form a land not matching a Build card.",[yn.Now]:hw(!0,1)},{textArea:[.551,.635],text:"Each player Pushes up to 3 <explorer>/<town> from a land not matching a Build card.",[yn.Now]:hw(!0,3)},{textArea:[.818,.913],text:"Each player Removes up to 3 <explorer>/<town> from a land not matching a Build card.",[yn.Now]:hw(!1,3)}]},gw=(e,a)=>({$:t})=>t.onEachBoard((n=>t.doFearAction((()=>n.inLandsWhere((e=>e.hasAtLeast(2,t.Invader))).pickOne((async t=>{await t.gather({quantifier:lr.UpTo,amount:e,pieces:a,single:!0})}),{prompt:"Pick a land to gather into.",noOptions:"No land with at least 2 Invaders."})),{board:n}))),fw={name:"Seek Company",set:a.NatureIncarnate,levels:[{textArea:[.279,.363],text:"On Each Board: Gather up to 1 <explorer> into a land with 2 or more Invaders.",[yn.Now]:gw(1,Qn.Explorer)},{textArea:[.537,.669],text:"On Each Board: Gather up to 3 <explorer>/<town> from a single land into a land with 2 or more Invaders.",[yn.Now]:gw(3,Qn.ExplorerOrTown)},{textArea:[.837,.927],text:"On Each Board: Gather up to 4 <explorer>/<town> (total) into lands with 2 or more Invaders.",[yn.Now]:({$:e})=>e.onEachBoard((a=>e.doFearAction((async()=>{const t=[];await a.inLandsWhere((a=>a.hasAtLeast(2,e.Invader))).pickMultiple({amount:4,repeatSame:!0,optional:!0,forPickedItem:async a=>{t.push(...await a.gather({amount:1,pieceFilter:e=>!t.some((a=>a.piece===e)),pieces:e.ExplorerOrTown}))}})}),{board:a})))}]},pw={name:"Struggles Over Farmland",set:a.NatureIncarnate,levels:[{textArea:[.298,.339],text:"Each player Adds 1 <strife> in a land with <blight>.",[yn.Now]:({$:e})=>e.eachSpirit((a=>e.doFearAction((()=>e.forPiecesThatIs(e.Invader,(a=>a.has(e.Blight))).pickOne((async e=>{await e.addStrife()}),{noOptions:"No Invaders in land with <blight>."})),{spirit:a})))},{textArea:[.554,.649],text:"Each player Adds 1 <strife> to a <town> or Adds 1 <strife> in a land with <blight>.",[yn.Now]:({$:e})=>e.eachSpirit((a=>e.doFearAction((()=>e.forPiecesWhere((a=>a.isA(e.Town)||a.isInvader&&a.location.has(e.Blight))).pickOne((async e=>{await e.addStrife()}),{noOptions:"No <town> or Invaders in a land with <blight>."})),{spirit:a})))},{effects:[{textArea:[.823,.863],text:"Each player Adds 1 <strife>.",[yn.Now]:({$:e})=>e.eachSpirit((a=>e.doFearAction((()=>e.forPiecesThatIs(e.Invader).pickOne((async e=>{await e.addStrife()}),{noOptions:"No Invaders."})),{spirit:a})))},{textArea:[.865,.949],text:"In each land with <strife>, 1 Invader with <strife> does Damage to other Invaders.",[yn.Now]:({$:e})=>e.inLandsWithStrife().selectOrder().forEach((a=>e.doFearAction((async()=>{await a.piecesWithStrife().pickOne((e=>e.dealDamageToOtherInvaders()))}),{land:a})),{noOptions:"No Invader with <strife>"})}]}]},ww=(e,a)=>({$:t})=>t.onEachBoard((n=>t.doFearAction((()=>n.inLands().pickMultiple({amount:e,forPickedItem:async e=>{await e.isolate(),a&&e.has(t.TownOrCity)&&await e.skipInvaderAction({all:!0,filter:({invaderAction:e})=>e===Hr.Build})}})),{board:n}))),yw={name:"Supply Chains Abandoned",set:a.NatureIncarnate,levels:[{textArea:[.301,.342],text:"On Each Board: Isolate one land.",[yn.Now]:ww(1,!1)},{textArea:[.54,.674],text:"On Each Board: Isolate one land.<br>If <town>/<city> are present, skip all Build Actions (in that land).",[yn.Now]:ww(1,!0)},{textArea:[.796,.968],text:"On Each Board: Isolate two lands.<br>In Each of those lands, if <town>/<city> are present, skip all Build Actions (in that land).",[yn.Now]:ww(2,!0)}]},mw=e=>({$:a})=>a.onEachBoard((t=>a.doFearAction((()=>t.inLandsWhere((e=>e.hasOneOf(a.Beasts,a.Dahan)||e.hasStrife)).pickOne((t=>e({$:a,land:t})),{noOptions:`On board: ${t.name}: No land with <beasts>/<strife>/<dahan>.`})),{board:t}))),vw=e=>mw((({$:a,land:t})=>a.chooseBetween({effects:[e?{actionId:"Downgrade",text:"Downgrade 1 <town>/<city> there.",[yn.Now]:async()=>{await t.downgrade({pieces:a.TownOrCity})},condition:()=>t.has(a.TownOrCity)}:{actionId:"Remove",text:"Remove 1 <town>/<city> there.",[yn.Now]:async()=>{await t.remove({pieces:a.TownOrCity})},condition:()=>t.has(a.TownOrCity)},{actionId:"SkipBuild",text:"Skip the next Build Action there.",[yn.Now]:()=>t.skipInvaderAction({next:!0,filter:({invaderAction:e})=>e===Hr.Build})}]}))),Aw={name:"Unsettled",set:a.NatureIncarnate,levels:[{textArea:[.278,.371],text:"On Each Board: Choose a land with <beasts>/<strife>/<dahan>. Downgrade 1 <town>/<city> there.",[yn.Now]:mw((({$:e,land:a})=>a.downgrade({pieces:e.TownOrCity})))},{textArea:[.534,.669],text:"On Each Board: Choose a land with <beasts>/<strife>/<dahan>. Downgrade 1 <town>/<city> there or skip the next Build Action there (this turn).",[yn.Now]:vw(!0)},{textArea:[.826,.955],text:"On Each Board: Choose a land with <beasts>/<strife>/<dahan>. Remove 1 Invader there or skip the next Build Action there (this turn).",[yn.Now]:vw(!1)}]};var Iw;!function(e){e.AngryMobs="AngryMobs",e.AvoidTheDahan="AvoidTheDahan",e.BeliefTakesRoot="BeliefTakesRoot",e.BesetByManyTroubles="BesetByManyTroubles",e.CivilUnrest="CivilUnrest",e.CommunitiesInDisarray="CommunitiesInDisarray",e.DahanAttack="DahanAttack",e.DahanEnheartened="DahanEnheartened",e.DahanGainTheEdge="DahanGainTheEdge",e.DahanOnTheirGuard="DahanOnTheirGuard",e.DahanRaid="DahanRaid",e.DahanReclaimFishingGrounds="DahanReclaimFishingGrounds",e.DahanThreaten="DahanThreaten",e.DauntedByTheDahan="DauntedByTheDahan",e.Demoralized="Demoralized",e.DepartTheDangerousLand="DepartTheDangerousLand",e.Depopulation="Depopulation",e.Discord="Discord",e.DistractedByLocalTroubles="DistractedByLocalTroubles",e.EmigrationAccelerates="EmigrationAccelerates",e.ExplorersAreReluctant="ExplorersAreReluctant",e.FearOfTheUnseen="FearOfTheUnseen",e.FleeFromDangerousLands="FleeFromDangerousLands",e.FleeThePestilentLand="FleeThePestilentLand",e.ImmigrationSlows="ImmigrationSlows",e.Isolation="Isolation",e.MimicTheDahan="MimicTheDahan",e.NervesFray="NervesFray",e.OverseasTradeSeemSafer="OverseasTradeSeemSafer",e.Panic="Panic",e.PanickedByWildBeasts="PanickedByWildBeasts",e.PlanForDeparture="PlanForDeparture",e.Restlessness="Restlessness",e.Quarantine="Quarantine",e.Retreat="Retreat",e.Scapegoats="Scapegoats",e.SeekCompany="SeekCompany",e.SeekSafety="SeekSafety",e.SenseOfDread="SenseOfDread",e.SpreadingTimidity="SpreadingTimidity",e.StrugglesOverFarmland="StrugglesOverFarmland",e.SupplyChainsAbandoned="SupplyChainsAbandoned",e.TallTalesOfSavagery="TallTalesOfSavagery",e.TheologicalStrife="TheologicalStrife",e.TooManyMonsters="TooManyMonsters",e.TradeSuffers="TradeSuffers",e.TreadCarefully="TreadCarefully",e.Unrest="Unrest",e.Unsettled="Unsettled",e.WaryOfTheInterior="WaryOfTheInterior"}(Iw||(Iw={}));const xw={[Iw.AngryMobs]:Up,[Iw.AvoidTheDahan]:gp,[Iw.BeliefTakesRoot]:fp,[Iw.BesetByManyTroubles]:zp,[Iw.CivilUnrest]:nw,[Iw.CommunitiesInDisarray]:qp,[Iw.DahanAttack]:Op,[Iw.DahanEnheartened]:pp,[Iw.DahanGainTheEdge]:iw,[Iw.DahanOnTheirGuard]:wp,[Iw.DahanRaid]:yp,[Iw.DahanReclaimFishingGrounds]:Qp,[Iw.DahanThreaten]:Dp,[Iw.DauntedByTheDahan]:cw,[Iw.Demoralized]:Bp,[Iw.DepartTheDangerousLand]:kp,[Iw.Depopulation]:_p,[Iw.Discord]:Jp,[Iw.DistractedByLocalTroubles]:lw,[Iw.EmigrationAccelerates]:mp,[Iw.ExplorersAreReluctant]:Lp,[Iw.FearOfTheUnseen]:vp,[Iw.FleeFromDangerousLands]:Kp,[Iw.FleeThePestilentLand]:Fp,[Iw.ImmigrationSlows]:Rp,[Iw.Isolation]:Ap,[Iw.MimicTheDahan]:Vp,[Iw.NervesFray]:Xp,[Iw.OverseasTradeSeemSafer]:Ip,[Iw.Panic]:Np,[Iw.PanickedByWildBeasts]:$p,[Iw.PlanForDeparture]:Wp,[Iw.Quarantine]:Mp,[Iw.Retreat]:xp,[Iw.Restlessness]:uw,[Iw.Scapegoats]:bp,[Iw.SeekCompany]:fw,[Iw.SeekSafety]:Tp,[Iw.SenseOfDread]:Zp,[Iw.SpreadingTimidity]:Yp,[Iw.StrugglesOverFarmland]:pw,[Iw.SupplyChainsAbandoned]:yw,[Iw.TallTalesOfSavagery]:Ep,[Iw.TheologicalStrife]:ew,[Iw.TooManyMonsters]:Gp,[Iw.TradeSuffers]:Pp,[Iw.TreadCarefully]:Hp,[Iw.Unrest]:jp,[Iw.Unsettled]:Aw,[Iw.WaryOfTheInterior]:Sp};var bw;!function(e){e.CoastalLands="CoastalLands",e.SaltDeposits="SaltDeposits",e.Stage1Card="Stage1Card",e.Stage2CardIncludingCoastal="Stage2CardIncludingCoastal",e.Stage2CardExceptCoastalAndSaltDeposits="Stage2CardExceptCoastalAndSaltDeposits",e.Stage3Card="Stage3Card",e.WaveOfImmigration="WaveOfImmigration"}(bw||(bw={}));const Tw={[bw.Stage1Card]:{cards:[Wo.Jungles,Wo.Mountains,Wo.Sands,Wo.Wetlands],stage:1},[bw.Stage2CardIncludingCoastal]:{cards:[Wo.JunglesEscalation,Wo.MountainsEscalation,Wo.SandsEscalation,Wo.WetlandsEscalation,Wo.CoastalLands],stage:2},[bw.Stage2CardExceptCoastalAndSaltDeposits]:{cards:[Wo.JunglesEscalation,Wo.MountainsEscalation,Wo.SandsEscalation,Wo.WetlandsEscalation],stage:2},[bw.CoastalLands]:{cards:[Wo.CoastalLands],stage:2},[bw.SaltDeposits]:{cards:[Wo.SaltDeposits],stage:2},[bw.Stage3Card]:{cards:[Wo.JunglesAndSands,Wo.JunglesAndWetlands,Wo.MountainsAndJungles,Wo.MountainsAndWetlands,Wo.SandsAndMountains,Wo.SandsAndWetlands],stage:3},[bw.WaveOfImmigration]:{cards:[Wo.WaveOfImmigration],stage:2}};var Ew,Pw=function(e,a,t,n){var r,i=arguments.length,s=i<3?a:null===n?n=Object.getOwnPropertyDescriptor(a,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,a,t,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(i<3?r(s):i>3?r(a,t,s):r(a,t))||s);return i>3&&s&&Object.defineProperty(a,t,s),s};class Sw{fear=0;fearCardsDiscarded=[];fearCardsEarnedCount=0;fearCardsInDeck;fearCardsInLevelCount=[0,0,0];fearPool=0;hasResolvedFearCard=!1;invaderCardsInFearDeck=[];resolvingFearCard;terrorLevel=1;static allFearCards=Object.keys(xw).filter((e=>!xw[e].banned));$;constructor(e){Xo.makeObservable(this),this.$=e;const{boards:a}=this.$.config,t=e.config.sets??xg,n=a.filter((e=>void 0!==e.spirit)).length;this.fearCardsInDeck=new Ig(e,t.length===xg.length?Sw.allFearCards:Sw.allFearCards.filter((e=>t.includes(xw[e].set)))),this.fearPool=(a.length>n?5:4)*n}get fearCardsEarned(){const e=[];for(let a=0;a<this.fearCardsEarnedCount;a+=1)e.push(this.fearCardsInDeck.cardAt(a));return e}get fearCardsInLevel(){return e=>{let a=this.fearCardsEarnedCount;for(let t=0;t<e;t+=1)a+=this.fearCardsInLevelCount[t];const t=[];for(let n=0;n<this.fearCardsInLevelCount[e];n+=1)t.push(this.fearCardsInDeck.cardAt(a+n));return t}}get preventTerrorLevelAndResolveFearCards(){return this.$.someEffect(yn.PreventTerrorLevelAndResolveFearCards)}get unusedFearCardsLeft(){return this.fearCardsInDeck.count-dg(this.fearCardsInLevelCount)+this.fearCardsEarnedCount}addFearCards(e){return{toLevel:async a=>{await _r(e,(()=>{this.unusedFearCardsLeft>0&&(this.fearCardsInLevelCount[a-1]+=1,this.fearCardsInDeck.putBottomCardToTop())})),await this.moveInvaderCardsInFearDeck(e),await this.$.sendEvent({type:fn.FearCardAdded,amount:e,level:a})}}}async addFearToPool(e){this.fearPool+=e,await this.$.sendEvent({type:fn.FearAddedToPool,amount:e})}async discardEarnedFearCards(e){let a=e;for(;this.fearCardsEarnedCount>0&&a>0;){const e=await this.fearCardsInDeck.draw();await this.$.sendEvent({type:fn.FearCardDiscarded,fearCard:e}),this.fearCardsDiscarded.push(e),this.fearCardsEarnedCount-=1,a-=1}}async discardTopFearCard(){let e=null;return this.terrorLevel<4&&(this.fearCardsInLevelCount[this.terrorLevel-1]-=1,e=await this.fearCardsInDeck.draw(this.fearCardsEarnedCount),await this.moveInvaderCardsInFearDeck(-1),this.fearCardsDiscarded.push(e),await this.$.doEffects(yn.AfterFearDeckIsDecreasing),await this.updateTerrorLevel()),e}async earnFearCard(){this.terrorLevel<4&&this.fearCardsInLevelCount[this.terrorLevel-1]>0&&(this.fearCardsEarnedCount+=1,this.fearCardsInLevelCount[this.terrorLevel-1]-=1,await this.moveInvaderCardsInFearDeck(-1),await this.$.sendEvent({type:fn.FearCardEarned}),await this.$.doEffects(yn.AfterFearDeckIsDecreasing),await this.updateTerrorLevel())}async earnTerrorLevel(){this.terrorLevel+=1,await this.$.sendEvent({type:fn.NewTerrorLevel,level:this.terrorLevel}),await this.$.doEffects(yn.AfterReachingTerrorLevel,{terrorLevel:this.terrorLevel})}async generateFear(e){let a=e.amount;const{location:t,fromDestroyingBuildings:n}=e,r=()=>({amount:a,location:t,fromDestroyingBuildings:n});if(a>0)if(await this.$.oneEffectActivates(yn.PreventFearGeneration,r()))a=0;else for(await this.$.waitForAnimationsToFinish(),this.fear+=a,await this.$.doEffects(yn.AfterPowerGenerateFearInLand,e),await this.$.sendEvent({type:fn.FearEarned,amount:a,location:t});this.fear>=this.fearPool;)this.fear-=this.fearPool,await this.earnFearCard();return r()}insertInvaderCardUnderFearCards(e,a){this.invaderCardsInFearDeck.push({card:e,position:a})}async loseFear(e){const a=Math.min(this.fear,e);this.fear-=a,a>0&&await this.$.sendEvent({type:fn.FearLost,amount:a})}async pickAFaceDownFearCard(){const e=this.fearCardsEarnedCount+dg(this.fearCardsInLevelCount),a=e>0?[...Array(e).keys()].filter((e=>null===this.fearCardsInDeck.cardAt(e))):[];if(a.length>0){const e=await this.$.query({query:pn.SelectFearCard,items:a,actionIds:a.map((e=>`FearCard-${e}`))});return a[e]}return await this.$.clickToContinue({noOptions:"No Fear Cards available"}),null}putAllFearCardsInDeckIntoLevel(e){this.fearCardsInLevelCount[e-1]+=this.unusedFearCardsLeft}putAllFearCardsIntoLevel(e){for(let a=0;a<3;a+=1)this.fearCardsInLevelCount[a]=a===e-1?this.fearCardsInDeck.count:0}async removeTopFearCard(){this.terrorLevel<4&&(this.fearCardsInLevelCount[this.terrorLevel-1]-=1,this.fearCardsInDeck.removeCard(0),await this.moveInvaderCardsInFearDeck(-1),await this.$.doEffects(yn.AfterFearDeckIsDecreasing),await this.updateTerrorLevel())}async reshuffleFearDeck(){await this.$.sendEvent({type:fn.GenericMain,text:"The Fear Deck was reshuffled from its discard."}),this.fearCardsInDeck=new Ig(this.$,this.fearCardsDiscarded),this.fearCardsDiscarded=[]}async resolveFearCards(){for(;this.fearCardsEarnedCount>0&&!this.$.gameEnded&&this.$.randomEventsEnabled&&(!this.preventTerrorLevelAndResolveFearCards||this.$.phase!==Wi.Fear);)await this.resolveNextFearCard()}async resolveNextFearCard(e={}){const{extraTerrorLevel:a=0}=e;this.fearCardsEarnedCount-=1,this.hasResolvedFearCard=!0,this.resolvingFearCard=await this.fearCardsInDeck.draw(),void 0===this.resolvingFearCard&&(await this.reshuffleFearDeck(),this.resolvingFearCard=await this.fearCardsInDeck.draw()),await this.$.sendEvent({type:fn.FearCardResolved,fearCard:this.resolvingFearCard,terrorLevel:this.terrorLevel}),await this.$.query({query:pn.ClickToContinueCard,items:[this.resolvingFearCard],actionIds:[this.resolvingFearCard]});const t=xw[this.resolvingFearCard],n=t.levels[Math.min(this.terrorLevel+a,3)-1];await this.$.addEffectUntilEndOfTurn({name:t.name,...n,card:this.resolvingFearCard}),this.fearCardsDiscarded.push(this.resolvingFearCard),this.resolvingFearCard=void 0}revealFearCard(e,a){let t=this.fearCardsEarnedCount;for(let a=0;a<e;a+=1)t+=this.fearCardsInLevelCount[a];return t+=a,this.revealFearCardInDeck(t)}revealFearCardInDeck(e){return this.fearCardsInDeck.reveal(e)}revealTopFearCard(){return this.revealFearCard(this.terrorLevel-1,0)}async setupFearDeck(){const e=[3,3,3].map(((e,a)=>e+Uo([this.$.adversaryLeading,this.$.adversarySupporting],(e=>e?e.levelData.fearCards[a]-3:0))));await this.addFearCards(e[0]).toLevel(1),await this.addFearCards(e[1]).toLevel(2),await this.addFearCards(e[2]).toLevel(3)}timePasses(){return this.hasResolvedFearCard=!1,Promise.resolve()}toString(){return bg({fear:this.fear,fearPool:this.fearPool,terrorLevel:this.terrorLevel,fearCardsDiscarded:Vo(this.fearCardsDiscarded),fearCardsEarned:this.fearCardsEarnedCount,fearCardsInDeck:this.fearCardsInDeck.count,fearCardsInLevel:Vo(this.fearCardsInLevelCount),invaderCardsInFearDeck:Vo(this.invaderCardsInFearDeck,(e=>`${e.card} @ ${e.number}`))},2)}async moveInvaderCardsInFearDeck(e){if(this.invaderCardsInFearDeck.length>0&&(this.invaderCardsInFearDeck.forEach((a=>{a.position+=e})),0===this.invaderCardsInFearDeck[0].position)){const{card:e}=this.invaderCardsInFearDeck.shift(),a=Tw[e].cards.filter((e=>!this.$.invaderDeckInSlot(Zl.Deck).hasRevealed(e))),t=await this.$.drawFrom(a,a.map((e=>Mo[e].text)));this.$.invaderDeckInSlot(Zl.Deck).remove(t),this.$.invaderDeckInSlot(Zl.Build).insertAtBottom(t)}}async updateTerrorLevel(){if(!this.preventTerrorLevelAndResolveFearCards)for(;this.terrorLevel<4&&0===this.fearCardsInLevelCount[this.terrorLevel-1];)await this.earnTerrorLevel()}}Pw([Re],Sw.prototype,"fear",void 0),Pw([Re],Sw.prototype,"fearCardsDiscarded",void 0),Pw([Re],Sw.prototype,"fearCardsEarnedCount",void 0),Pw([Re],Sw.prototype,"fearCardsInDeck",void 0),Pw([Re],Sw.prototype,"fearCardsInLevelCount",void 0),Pw([Re],Sw.prototype,"fearPool",void 0),Pw([Re],Sw.prototype,"hasResolvedFearCard",void 0),Pw([Re],Sw.prototype,"invaderCardsInFearDeck",void 0),Pw([Re],Sw.prototype,"resolvingFearCard",void 0),Pw([Re],Sw.prototype,"terrorLevel",void 0),function(e){e.DahanInsurrectionLevelThree="DahanInsurrectionLevelThree",e.DahanInsurrectionTooFewDahan="DahanInsurrectionTooFewDahan",e.GameError="GameError",e.GreatRiver="GreatRiver",e.GuardTheIslesHeart="GuardTheIslesHeart",e.HuntersSwarmTheIsland="HuntersSwarmTheIsland",e.IrreparableDamage="IrreparableDamage",e.LandStrippedBare="LandStrippedBare",e.ProudAndMightCapital="ProudAndMightCapital",e.RanOutOfBlight="RanOutOfBlight",e.RanOutOfInvaderCards="RanOutOfInvaderCards",e.RanOutOfPresence="RanOutOfPresence",e.SprawlingPlantation="SprawlingPlantation",e.TheEndlessDark="TheEndlessDark",e.TradeHub="TradeHub"}(Ew||(Ew={}));var Ow=function(e,a,t,n){var r,i=arguments.length,s=i<3?a:null===n?n=Object.getOwnPropertyDescriptor(a,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,a,t,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(i<3?r(s):i>3?r(a,t,s):r(a,t))||s);return i>3&&s&&Object.defineProperty(a,t,s),s};class Cw{invaderCardsInSlot;$;escalatedInvaderCards=[];invaderCardIsSpecial=[];constructor(e){Xo.makeObservable(this),this.$=e,this.invaderCardsInSlot={[Zl.Discard]:new Ig(e),[Zl.HighImmigration]:new Ig(e),[Zl.Ravage]:new Ig(e),[Zl.Build]:new Ig(e),[Zl.Explore]:new Ig(e),[Zl.Deck]:new Ig(e)}}get actualExploreCardIndex(){return e=>{let a=-1;for(let t=0;t<this.exploreDeck.count;t+=1){if(this.exploreDeck.cardAt(t)!==Wo.WaveOfImmigration&&(a+=1,a===e))return t}return 0}}get exploreDeck(){return this.invaderCardsInSlot[Zl.Deck]}get invaderCardAtIndexIsSpecial(){return e=>this.invaderCardIsSpecial[e]}get invaderCardsInExploreDeck(){return this.exploreDeck.cards}get invaderCardsVisible(){return[...this.invaderCardsInSlot[Zl.HighImmigration].cards,...this.invaderCardsInSlot[Zl.Ravage].cards,...this.invaderCardsInSlot[Zl.Build].cards]}get lowestStageNumber(){return Math.min(...this.stageNumbers.filter((e=>e>0)))}get numberOfExploreCardsThisTurn(){return 1+this.$.sumEffects(yn.AdjustNumberOfExploreCards)}get showingTerrainTypes(){const e=[];return this.invaderCardsVisible.forEach((a=>{Mo[a].terrains.forEach((a=>{e.includes(a)||e.push(a)}))})),e}get stage(){return this.stageNumbers.length>0?3===this.stageNumbers[0]&&this.invaderCardIsSpecial[0]?2:this.stageNumbers[0]>0?this.stageNumbers[0]:this.stageNumbers[1]:3}get stageNumbers(){return this.stageNumbersInSlot(Zl.Deck)}get stageNumbersInSlot(){return e=>this.invaderCardsInSlot[e].possibleCards.map((e=>Mo[e[0]].stage))}get unusedInvaderCardOfStage(){return e=>Object.keys(Mo).filter((a=>Mo[a].stage===e&&!Object.values(this.invaderCardsInSlot).some((e=>e.includes(a)))))}async accelerateTheInvaderDeck(){const e=this.lowestStageNumber,a=this.stageNumbers.findIndex((a=>a===e));if(-1===a)return null;const t=await this.exploreDeck.reveal(a);return await this.removeCardFromExploreDeck(a),null!==t&&this.invaderCardsInSlot[Zl.Discard].insert(t),t}async addExploreCardToTop(e,a=0){this.exploreDeck.insertOneOf(e,a),this.invaderCardIsSpecial.splice(a,0,!1),await this.$.doEffects(yn.AfterChangingInvaderDeck)}advanceCardsIn(e){return{to:async a=>{for(;!this.invaderCardsInSlot[e].isEmpty;)this.invaderCardsInSlot[a].insertAtBottom(await this.invaderCardsInSlot[e].draw())}}}async advanceInvaderCards(){await this.$.doEffects(yn.BeforeAdvancingCards),await this.advanceCardsIn(Zl.Ravage).to(Zl.Discard),await this.advanceCardsIn(Zl.Build).to(Zl.Ravage),await this.advanceCardsIn(Zl.Explore).to(Zl.Build),await this.$.doEffects(yn.AfterAdvancingCards),await this.$.doEffects(yn.AfterChangingInvaderDeck);for(const e of this.$.invaderCardsInVisibleSlot(Zl.Build))await this.escalate(e,{afterAdvancingCards:!0})}async drawNextExploreCard(){if(this.exploreDeck.isEmpty)return this.$.loseGame(Ew.RanOutOfInvaderCards),null;{const e=await this.exploreDeck.draw();return qr(this.escalatedInvaderCards,e),this.invaderCardIsSpecial.shift(),this.invaderCardsInSlot[Zl.Explore].insertAtBottom(e),await this.$.sendEvent({type:fn.InvadersExplore,invaderCard:e}),await this.$.doEffects(yn.AfterChangingInvaderDeck),e}}async escalate(e,a={}){const{afterAdvancingCards:t=!1,afterExplore:n=!1,afterExploringLand:r,beforeBuilding:i=!1,beforeExplore:s=!1}=a;if(!this.escalatedInvaderCards.includes(e)){const a=Mo[e];if(a.escalation&&null!==this.$.adversaryLeading||3===a.stage&&null!==this.$.adversarySupporting){if(await this.$.oneEffectActivates(yn.PreventEscalation,{card:e,normal:!0}))this.escalatedInvaderCards.push(e);else{const o=a.escalation?this.$.adversaryLeading.adversary:this.$.adversarySupporting.adversary;await this.$.oneEffectActivates(yn.Escalation,{card:e,adversary:o,afterAdvancingCards:t,afterExplore:n,afterExploringLand:r,beforeBuilding:i,beforeExplore:s})&&this.escalatedInvaderCards.push(e)}}}}insertInvaderCard(e,a={}){const{isSpecial:t=!1}=a;return{justBelowCards:async a=>{this.exploreDeck.insertOneOf([...Tw[e].cards],a),this.invaderCardIsSpecial.splice(a,0,t),await this.$.sendEvent({type:fn.InvaderCardAdded,amount:1,invaderCardType:e})},insteadOfNthCardOfStage:async(a,t)=>{let n=0;for(let r=0;r<this.stageNumbers.length;r+=1)if(this.stageNumbers[r]===t&&(n+=1,n===a)){await this.removeCardFromExploreDeck(r),this.exploreDeck.insertOneOf([...Tw[e].cards],r),await this.$.sendEvent({type:fn.InvaderCardAdded,amount:1,invaderCardType:e});break}},justBelowBottomMostOfStage:async a=>{const n=td(this.stageNumbers,(e=>e===a));this.exploreDeck.insertOneOf([...Tw[e].cards],n+1),this.invaderCardIsSpecial.splice(n+1,0,t),await this.$.sendEvent({type:fn.InvaderCardAdded,amount:1,invaderCardType:e})},justBelowNthCardOfStage:async(a,n)=>{let r=0;for(let i=0;i<this.stageNumbers.length;i+=1)if(this.stageNumbers[i]===n&&(r+=1,r===a)){this.exploreDeck.insertOneOf([...Tw[e].cards],i+1),this.invaderCardIsSpecial.splice(i+1,0,t),await this.$.sendEvent({type:fn.InvaderCardAdded,amount:1,invaderCardType:e});break}}}}async moveNthCardOfStageUpByOne(e,a){let t=0;for(let n=0;n<this.stageNumbers.length;n+=1)if(this.stageNumbers[n]===a&&(t+=1,t===e)){const e=await this.removeCardFromExploreDeck(n);this.invaderCardIsSpecial.splice(n,1),this.exploreDeck.insertOneOf(e,n-1),this.invaderCardIsSpecial.splice(n-1,0,!1);break}}nthCardOfStage(e,a){let t=0;for(let n=0;n<this.stageNumbers.length;n+=1)if(this.stageNumbers[n]===a&&(t+=1,t===e))return this.exploreDeck.possibleCardsAt(n);return[]}async putTopInvaderCardToBottom(){if(!this.exploreDeck.isEmpty){const e=await this.removeCardFromExploreDeck(0);this.invaderCardIsSpecial.shift(),this.exploreDeck.insertOneOf(e,this.exploreDeck.count),this.invaderCardIsSpecial.push(!1),await this.$.doEffects(yn.AfterChangingInvaderDeck)}}async removeBottomMostInvaderCardOfStage(e){const a=td(this.stageNumbers,(a=>a===e));await this.removeCardFromExploreDeck(a)}async removeCardFromExploreDeck(e,a={}){const{allCards:t=!1,swapping:n=!1}=a;if(e<0||e>=this.exploreDeck.count)return;const r=t?e:this.actualExploreCardIndex(e);this.invaderCardIsSpecial.splice(r,1);const i=this.stageNumbers[r],s=this.exploreDeck.removeCard(r);return void 0!==s&&(i>0&&await this.$.sendEvent({type:fn.InvaderCardRemoved,amount:1,stage:i}),n||await this.$.doEffects(yn.AfterChangingInvaderDeck)),s}async removeTopMostInvaderCardOfStage(e){const a=this.stageNumbers.findIndex((a=>a===e));await this.removeCardFromExploreDeck(a,{allCards:0===e})}async removeTopNonSpecialExploreCard(){const e=this.invaderCardIsSpecial.findIndex((e=>!1===e));await this.removeCardFromExploreDeck(e)}async revealTopInvaderCard(){const e=await this.exploreDeck.reveal(0);return null!==e&&await this.$.clickToContinue({card:e,text:`The top Invader Card is ${Mo[e].text}.`}),e}async setupInvaderDeck(){await this.addInvaderCards(3).ofType(bw.Stage1Card),await this.addInvaderCards(4).ofType(bw.Stage2CardIncludingCoastal),await this.addInvaderCards(5).ofType(bw.Stage3Card)}async shuffleTopTwoInvaderCards(){if(this.exploreDeck.count>=2){const e=this.actualExploreCardIndex(0),a=this.actualExploreCardIndex(1);if(e>=this.stageNumbers.length||a>=this.stageNumbers.length)return;const t=this.stageNumbers[e],n=this.stageNumbers[e]===this.stageNumbers[a];await this.exploreDeck.shuffleTopNCards([e,a],n),n?(this.invaderCardIsSpecial[e]=!1,this.invaderCardIsSpecial[a]=!1):t!==this.stageNumbers[e]&&([this.invaderCardIsSpecial[e],this.invaderCardIsSpecial[a]]=[this.invaderCardIsSpecial[a],this.invaderCardIsSpecial[e]]),await this.$.doEffects(yn.AfterChangingInvaderDeck)}}toString(){return bg({invaderCardsInBuildStep:Vo(this.invaderCardsInSlot[Zl.Build].cards),invaderCardsInDiscard:Vo(this.invaderCardsInSlot[Zl.Discard].cards),invaderCardsInExploreDeck:Vo(this.invaderCardsInSlot[Zl.Deck].cards),invaderCardsInExploreStep:Vo(this.invaderCardsInSlot[Zl.Explore].cards),invaderCardsInHighImmigrationStep:Vo(this.invaderCardsInSlot[Zl.HighImmigration].cards),invaderCardsInRavageStep:Vo(this.invaderCardsInSlot[Zl.Ravage].cards)},2)}addInvaderCards(e){return{ofType:async a=>{await _r(e,(()=>{this.exploreDeck.insertAtBottomOneOf([...Tw[a].cards]),this.invaderCardIsSpecial.push(!1)})),await this.$.sendEvent({type:fn.InvaderCardAdded,amount:e,invaderCardType:a})}}}}Ow([Re],Cw.prototype,"invaderCardsInSlot",void 0);var Dw,Bw=function(e,a,t,n){var r,i=arguments.length,s=i<3?a:null===n?n=Object.getOwnPropertyDescriptor(a,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,a,t,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(i<3?r(s):i>3?r(a,t,s):r(a,t))||s);return i>3&&s&&Object.defineProperty(a,t,s),s};class kw{powercardsInMajorDeck;powercardsInMajorDiscard=[];powercardsInMinorDeck;powercardsInMinorDiscard=[];static allMajorPowers=Object.keys(sg).filter((e=>!sg[e].banned&&sg[e].type===Sn.Major));static allMinorPowers=Object.keys(sg).filter((e=>!sg[e].banned&&sg[e].type===Sn.Minor));$;constructor(e){Xo.makeObservable(this),this.$=e;const a=e.config.sets??xg;this.powercardsInMinorDeck=new Ig(e,a.length===xg.length?kw.allMinorPowers:kw.allMinorPowers.filter((e=>a.includes(sg[e].set)))),this.powercardsInMajorDeck=new Ig(e,a.length===xg.length?kw.allMajorPowers:kw.allMajorPowers.filter((e=>a.includes(sg[e].set))))}discardPower(e){switch(sg[e].type){case Sn.Major:this.powercardsInMajorDiscard.includes(e)||this.powercardsInMajorDiscard.push(e);break;case Sn.Minor:this.powercardsInMinorDiscard.includes(e)||this.powercardsInMinorDiscard.push(e)}return Promise.resolve()}async drawAndDiscardPower(e){const a=await this.drawPower(e);return null!=a&&await this.discardPower(a),a}async drawPower(e,a={}){const{silent:t}=a;if(e===Sn.Minor){let e=await this.powercardsInMinorDeck.draw();return void 0===e&&(await this.$.sendEvent({type:fn.GenericMain,text:"The Minor Deck was reshuffled from its discard."}),this.powercardsInMinorDeck=new Ig(this.$,this.powercardsInMinorDiscard),this.powercardsInMinorDiscard=[],e=await this.powercardsInMinorDeck.draw()),void 0===e||t||await this.$.sendEvent({type:fn.PowerCardDrawn,powerType:e}),e}if(e===Sn.Major){let e=await this.powercardsInMajorDeck.draw();return void 0===e&&(await this.$.sendEvent({type:fn.GenericMain,text:"The Major Deck was reshuffled from its discard."}),this.powercardsInMajorDeck=new Ig(this.$,this.powercardsInMajorDiscard),this.powercardsInMajorDiscard=[],e=await this.powercardsInMajorDeck.draw()),void 0===e||t||await this.$.sendEvent({type:fn.PowerCardDrawn,powerType:e}),e}}removePowerCardFromDecks(e){this.powercardsInMinorDeck.remove(e),this.powercardsInMajorDeck.remove(e)}toString(){return bg({powercardsInMajorDeck:this.powercardsInMajorDeck.count,powercardsInMajorDiscard:Vo(this.powercardsInMajorDiscard),powercardsInMinorDeck:this.powercardsInMinorDeck.count,powercardsInMinorDiscard:Vo(this.powercardsInMinorDiscard)},2)}}Bw([Re],kw.prototype,"powercardsInMajorDeck",void 0),Bw([Re],kw.prototype,"powercardsInMajorDiscard",void 0),Bw([Re],kw.prototype,"powercardsInMinorDeck",void 0),Bw([Re],kw.prototype,"powercardsInMinorDiscard",void 0),function(e){e.TerrorLevelOne="TerrorLevelOne",e.TerrorLevelTwo="TerrorLevelTwo",e.TerrorLevelThree="TerrorLevelThree",e.FearVictory="FearVictory",e.DahanInsurrectionLevelTwo="DahanInsurrectionLevelTwo",e.DahanInsurrectionLevelThree="DahanInsurrectionLevelThree",e.WardTheShores="WardTheShores"}(Dw||(Dw={}));var Lw=function(e,a,t,n){var r,i=arguments.length,s=i<3?a:null===n?n=Object.getOwnPropertyDescriptor(a,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,a,t,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(i<3?r(s):i>3?r(a,t,s):r(a,t))||s);return i>3&&s&&Object.defineProperty(a,t,s),s};const Fw=Object.freeze(new Set(["expireAtEndOfTurn","expireAtEndOfTimePasses","expireAtEndOfAction","expireAtEndOfActionTree"]));class Rw{effects=[];sortedEffects={expireAtEndOfTurn:[],expireAtEndOfTimePasses:[],expireAtEndOfAction:[],expireAtEndOfActionTree:[]};static effectsWithPriority=[yn.AdjustNumberOfExploreCards,yn.AfterMoving,yn.AlterInvaderActionInLand,yn.AfterTheNormalExploreStep];$;stack=[];nextId=0;constructor(e){Xo.makeObservable(this),this.$=e}get currentStackEffect(){return this.stack.length>0?this.stack[this.stack.length-1]:void 0}get effectIds(){const e=[];for(const a of this.effects)a.effectId&&!e.includes(a.effectId)&&e.push(a.effectId);return e}get globalReminderEffects(){return this.effectsOfType(yn.GlobalReminder)}get hasLostFromEffect(){return this.resultFromFirstEffectOfType(yn.LossCondition)??null}get hasWonFromEffect(){return this.resultFromFirstEffectOfType(yn.WinCondition)??null}get parentEffect(){return this.stack.length>1?this.stack[this.stack.length-2]:void 0}get reminderEffects(){return[...this.effectsOfType(yn.Reminder),...this.effectsOfType(yn.DefendFromGame).filter((e=>void 0===e[yn.Reminder])),...this.effectsOfType(yn.DefendFromSpirits).filter((e=>void 0===e[yn.Reminder]&&void 0===e[yn.DefendFromGame]))]}static enhanceParentEffectWithChild(e,a){return{name:e?.name,text:e?.text,prompt:e?.prompt,cancel:e?.cancel,card:e?.card,players:e?.players,spirit:e?.spirit,textArea:e?.textArea,scenario:e?.scenario,adversary:e?.adversary,adversaryLevel:e?.adversaryLevel,highlightBoards:e?.highlightBoards,highlightPieces:e?.highlightPieces,highlightLocations:e?.highlightLocations,highlightCorners:e?.highlightCorners,highlightPowers:e?.highlightPowers,...a}}async addEffect(e){if(e.effects){const{effects:a,...t}=e;for(const e of a)await this.addEffect({...t,...e})}else e[yn.Now]?await this.doEffectWithContext(e,yn.Now):this.addAndSortEffect(e)}async addEffectUntilEndOfAction(e){await this.addEffect({...e,expireAtEndOfAction:this.$.action})}async addEffectUntilEndOfActionTree(e){await this.addEffect({...e,expireAtEndOfActionTree:this.$.action})}async addEffectUntilEndOfTurn(e){await this.addEffect({...e,expireAtEndOfTurn:!0})}async addSubEffect(e){const a=this.enhanceEffectWithCurrentEffect(e);if(e.effects)for(const t of e.effects)await this.addSubEffect(Rw.enhanceParentEffectWithChild(a,t));else e[yn.Now]?await this.doEffectWithContext(a,yn.Now):this.addAndSortEffect(a);return a}addSubEffectUntilEndOfAction(e){return this.addSubEffect({...e,expireAtEndOfAction:this.$.action})}addSubEffectUntilEndOfTimePasses(e){return this.addSubEffect({...e,expireAtEndOfTimePasses:!0})}addSubEffectUntilEndOfTurn(e){return this.addSubEffect({...e,expireAtEndOfTurn:!0})}async doEffect(e,a,t){this.stack.push(e),await(e[a]?.(t)),this.stack.pop(),(e[yn.InTargetLand]||e[yn.TargetSpirit])&&this.removeEffect(e)}async doEffectWithContext(e,a,t){this.stack.push(e),await(e[a]?.({$:this.$,effect:e,you:e.spirit,action:this.$.action,...t})),this.stack.pop(),(e[yn.InTargetLand]||e[yn.TargetSpirit])&&this.removeEffect(e)}async doEffects(e,a,t){for(const n of this.effectsOfType(e).slice())(void 0===t||t(n))&&await this.doEffect(n,e,a)}async doEffectsWithContext(e,a,t){for(const n of this.effectsOfType(e).slice())(void 0===t||t(n))&&await this.doEffectWithContext(n,e,a)}async doEffectsWithPriority(e,a){const t=this.effectsOfType(e).slice();if(Rw.effectsWithPriority.includes(e))for(const n of t)n.highPriority&&n[e]&&await this.doEffect(n,e,a);for(const n of t)!n.highPriority&&n[e]&&await this.doEffect(n,e,a)}effectsMappedWithFilter(e,a){return this.effectsOfType(e).reduce(((t,n)=>{const r=n[e]?.(a);return r&&t.push(r),t}),[])}effectsOfType(e){return this.sortedEffects[e]??[]}enhanceEffectWithCurrentEffect(e){return void 0!==this.currentStackEffect?Rw.enhanceParentEffectWithChild(this.currentStackEffect,e):e}existEffect(e){return this.effectsOfType(e).length>0}firstEffectOfType(e,a){for(const t of this.effectsOfType(e)){const n=t[e]?.(a);if(n)return t}}hasEffectNamed(e){return this.effects.some((a=>a.name===e&&a.id!==this.currentStackEffect?.id))}async oneEffectActivates(e,a){const t=this.effectsOfType(e),n=Rw.effectsWithPriority.includes(e)?[!0,void 0]:[void 0],r=this.$.action;for(const i of n)for(const n of t)if(n.highPriority===i){const t=n[e];if(void 0!==t){this.stack.push(n);const e=await t({$:this.$,effect:n,you:n.spirit,action:r,...a});if(this.stack.pop(),!0===e)return!0}}return!1}removeCurrentEffect(){this.removeEffect(this.currentStackEffect)}removeEffect(e){qr(this.effects,(a=>a.id===e.id));for(const a of Object.keys(e))if("function"==typeof e[a]||Fw.has(a)){const t=this.sortedEffects[a];void 0!==t&&qr(t,(a=>a.id===e.id))}void 0!==e[yn.Elements]&&this.$.spirits.forEach((e=>{e.invalidateEffectElementCache()}))}removeEffectsWithId(e){for(const a of this.effects.slice())a.effectId===e&&this.removeEffect(a)}removeEffectsWithName(e){for(const a of this.effects.slice())a.name===e&&this.removeEffect(a)}resultFromFirstEffectOfType(e,a){for(const t of this.effectsOfType(e)){const n=t[e];if(n){const e=n(a);if(void 0!==e)return e}}}async runEndOfActionEffects(e){if(this.sortedEffects.expireAtEndOfAction.length>0){const a=[],t=this.sortedEffects.expireAtEndOfAction.slice();for(const n of t)n.expireAtEndOfAction===e&&t.some((e=>e.id===n.id))&&(this.$.removeEffect(n),a.push(n));for(const e of a)await this.doEffect(e,yn.ActionEnds)}await this.doEffects(yn.AnyActionEnds)}async runEndOfActionTreeEffects(e){if(this.sortedEffects.expireAtEndOfActionTree.length>0){const a=[],t=this.sortedEffects.expireAtEndOfActionTree.slice();for(const n of t)n.expireAtEndOfActionTree===e&&t.some((e=>e.id===n.id))&&(this.$.removeEffect(n),a.push(n));for(const e of a)await this.doEffect(e,yn.ActionEnds)}}someEffect(e,a){return this.sortedEffects[e]?.some((t=>t[e](a)))??!1}sumEffects(e,a){const t=this.sortedEffects[e];if(!t)return 0;let n=0;for(const r of t)n+=r[e]?.(a)??0;return n}async timePasses(){for(const e of this.sortedEffects.expireAtEndOfTurn.slice())e.expireAtEndOfTurn&&this.removeEffect(e);await this.doEffects(yn.TimePasses)}timePassesLateExpiration(){for(const e of this.sortedEffects.expireAtEndOfTimePasses.slice())e.expireAtEndOfTimePasses&&this.removeEffect(e);return Promise.resolve()}addAndSortEffect(e){e.id=this.nextId,this.nextId+=1,this.effects.push(e);for(const a of Object.keys(e))("function"==typeof e[a]||Fw.has(a))&&(this.sortedEffects[a]||(this.sortedEffects[a]=[]),this.sortedEffects[a].push(e))}}Lw([Re],Rw.prototype,"sortedEffects",void 0);var Nw=function(e,a,t,n){var r,i=arguments.length,s=i<3?a:null===n?n=Object.getOwnPropertyDescriptor(a,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,a,t,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(i<3?r(s):i>3?r(a,t,s):r(a,t))||s);return i>3&&s&&Object.defineProperty(a,t,s),s};class $w{currentAction={type:Ho.GameAction,triggers:[],data:{},parentData:{},blackList:[],dontCountAs:new Set};$;actionStack=[this.currentAction];isDoublingActions=!1;triggerId=0;constructor(e){Xo.makeObservable(this),this.$=e}get currentActionType(){return this.currentAction.type}get currentTriggers(){return this.currentAction.triggers}get hasRunningAction(){return this.actionStack.length>1}async addTrigger(e,a,t,n={}){const{movingAction:r,priority:i}=n;this.currentTriggers.some((a=>a.childEffect.triggerId===e.triggerId))||this.currentAction.blackList.some((a=>a.triggerId===e.triggerId))?this.currentAction.blackList.some((a=>a.triggerId===e.triggerId))&&await this.$.sendEvent({type:fn.GenericSub,text:`${a.name} is not triggered because it cannot trigger itself.`}):i?this.currentTriggers.unshift({childEffect:e,parentEffect:a,parentAction:t,movingAction:r}):this.currentTriggers.push({childEffect:e,parentEffect:a,parentAction:t,movingAction:r})}checkIfEnded(){if(this.$.phase===Wi.Setup||this.$.phase===Wi.SetupPresence)return!1;const e=this.combinedLostReason;e&&this.$.loseGame(e);const a=this.combinedWinReason;return a&&this.$.winGame(a),this.$.gameEnded}async doAction(e,a,t={}){const{spirit:n,power:r,data:i,parentData:s,blackList:o,land:d,board:c}=t,l=this.numberOfActions(d,c);l>1&&(this.isDoublingActions=!0);for(let t=0;t<l;t+=1)if(!this.$.gameEnded){const t=o??this.currentAction.blackList;this.currentAction={type:e,spirit:n,power:r,triggers:[],data:i??{},parentData:s??{},blackList:t,dontCountAs:new Set},this.actionStack.push(this.currentAction),await this.$.doEffects(yn.AnyActionStarts),await a(),await this.$.runEndOfActionEffects(this.currentAction);for(const e of this.currentTriggers){const{childEffect:a,parentEffect:n,movingAction:r}=e;this.currentAction.data.movingAction=r;const i=Rw.enhanceParentEffectWithChild(n,a);await this.doAction(e.parentAction.type,(()=>this.$.addEffect(i)),{spirit:e.parentAction.spirit,power:e.parentAction.power,parentData:this.currentAction.data,blackList:[...t,a]})}const d=this.actionStack.pop();this.currentAction=this.actionStack.slice(-1)[0],1===this.actionStack.length&&(await this.checkForInvalidPieces(),this.checkIfEnded()),await this.$.runEndOfActionTreeEffects(d)}l>1&&(this.isDoublingActions=!1)}nextTriggerId(){const e=this.triggerId;return this.triggerId+=1,e}get combinedLostReason(){return this.$.hasLostFromEffect?this.$.hasLostFromEffect:this.someSpiritLacksPresence?Ew.RanOutOfPresence:this.ranOutOfBlight?Ew.RanOutOfBlight:null}get combinedWinReason(){return this.$.hasWonFromEffect?this.$.hasWonFromEffect:1!==this.$.terrorLevel||this.$.fearBasedVictoryIsRemoved||0!==(this.$.pieceCount[Bn.Explorer]||0)||0!==(this.$.pieceCount[Bn.Town]||0)||0!==(this.$.pieceCount[Bn.City]||0)?2!==this.$.terrorLevel||this.$.fearBasedVictoryIsRemoved||0!==(this.$.pieceCount[Bn.Town]||0)||0!==(this.$.pieceCount[Bn.City]||0)?3!==this.$.terrorLevel||this.$.fearBasedVictoryIsRemoved||0!==(this.$.pieceCount[Bn.City]||0)?4!==this.$.terrorLevel||this.$.fearBasedVictoryIsRemoved?null:Dw.FearVictory:Dw.TerrorLevelThree:Dw.TerrorLevelTwo:Dw.TerrorLevelOne}get numberOfActions(){return(e,a)=>{let t=1;const n={land:e,board:a};return this.isDoublingActions||(t+=this.$.sumEffects(yn.AdjustNumberOfActions,n)),t}}get ranOutOfBlight(){return(this.$.blightStatus===og.BlightedIsland||!this.$.config.blightCards)&&0===this.$.blightOnBlightCard}get someSpiritLacksPresence(){return this.$.spirits.some((e=>0===e.landsIncludingNonExisting.length))}async checkForInvalidPieces(){await this.$.inOceans().forEach((async e=>{e.hasSomeTerrain||!e.hasInvaders&&!e.hasDahan||await e.move({quantifier:lr.All,pieces:this.$.InvaderOrDahan,movement:Fr.Relocate,oceanIsAllowed:!0,pickDestinationEffect:{name:"Clean-up",text:"If <dahan> or Invaders winds up in a place its not allowed to be, they are cleaned up to the closest legal land."}})}))}}Nw([Re],$w.prototype,"currentAction",void 0),Nw([Re],$w.prototype,"actionStack",void 0);var Ww=function(e,a,t,n){var r,i=arguments.length,s=i<3?a:null===n?n=Object.getOwnPropertyDescriptor(a,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,a,t,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(i<3?r(s):i>3?r(a,t,s):r(a,t))||s);return i>3&&s&&Object.defineProperty(a,t,s),s};class Mw{lostReason;phase=Wi.Setup;reportedPhase=Wi.Setup;turn=0;winReason;$;constructor(e){Xo.makeObservable(this),this.$=e}get gameEnded(){return this.gameLost||this.gameWon}get gameLost(){return void 0!==this.lostReason}get gameWon(){return void 0!==this.winReason}async doSteps(e){for(const a of e)this.gameEnded||await a()}loseGame(e){this.lostReason=e}async run(e){try{for(await this.doSteps([()=>this.setPhase(Wi.Setup),()=>this.$.setupFearDeck(),()=>this.$.setupInvaderDeck(),()=>this.$.forEachLand((e=>e.restoreToSetupSymbols())),()=>this.$.setupStartingTokens(),()=>this.$.setupScenario(),()=>this.$.setupAdversaries(),()=>this.$.setupCommandBeast(),()=>this.$.setupSpirits(),()=>e&&this.$.possiblyResolveHistoryFinished(),()=>this.$.gameStartQuery(),()=>this.$.doEffects(yn.BeforeSetupPresence),()=>this.setPhase(Wi.SetupPresence),()=>this.$.setupPresence(),()=>this.$.doEffects(yn.AfterSetupPresence),()=>this.$.doEffects(yn.BeforeInitialExplore),()=>!this.$.config.skipInitialExplore&&this.setPhase(Wi.InitialExplore),()=>!this.$.config.skipInitialExplore&&this.$.explore(),()=>!this.$.config.skipInitialExplore&&this.$.doEffects(yn.AfterInitialExplore),()=>!this.$.config.skipInitialExplore&&this.setPhase(Wi.AdvanceCards),()=>!this.$.config.skipInitialExplore&&this.$.advanceInvaderCards(),()=>this.$.doEffects(yn.OnSetupAfterAddingInvaders),()=>!!this.$.config.extraGrowth&&this.growthPhase(),()=>!!this.$.config.extraGrowth&&this.timePasses(),()=>!this.$.config.extraGrowth&&this.nextTurn()]);!this.gameEnded;)await this.spiritPhase(),this.$.spiritSimulation?await this.$.scoreFromPowers():await this.doSteps([()=>this.fastPhase(),()=>this.$.doEffects(yn.AfterFastPhase),()=>this.invaderPhase(),()=>this.$.doEffects(yn.AfterInvaderPhase),()=>this.slowPhase(),()=>this.$.doEffects(yn.AfterSlowPhase)]),this.gameEnded||await this.timePasses()}catch(e){console.error(e),this.loseGame(Ew.GameError)}await this.$.sendEvent({type:fn.GameEnd,gameLost:this.gameLost,gameWon:this.gameWon,winReason:this.winReason,lostReason:this.lostReason});const a=this.winReason,t=this.lostReason;this.winReason=void 0,this.lostReason=void 0,await this.$.doEffects(yn.AfterGameEnds,{winReason:a,lostReason:t}),this.winReason=a,this.lostReason=t,await this.$.possiblyResolveHistoryFinished()}setPhase(e){return this.phase=e,Promise.resolve()}toString(){return bg({turn:this.turn},2)}updateReportedPhase(){this.reportedPhase=this.phase}winGame(e){this.winReason=e}async fastPhase(){await this.doSteps([()=>this.setPhase(Wi.FastPowers),()=>this.$.resolvePowers(rr.Fast)])}async growthPhase(){await this.doSteps([()=>this.setPhase(Wi.Grow),()=>this.$.doEffects(yn.StartOfSpiritPhase),()=>this.$.growAndPlayTrackActions(),()=>this.$.doEffects(yn.AfterGrowth)])}async invaderPhase(){await this.doSteps([()=>this.setPhase(Wi.BlightedIsland),()=>this.$.doEffects(yn.BlightedIslandPhase),()=>!!this.$.config.events&&this.$.drawEventCard(),()=>this.$.doEffects(yn.AfterEventPhase),()=>this.setPhase(Wi.Fear),()=>this.$.resolveFearCards(),()=>this.$.doEffects(yn.HighImmigration),()=>this.$.doEffects(yn.BeforeRavageStep),()=>this.setPhase(Wi.Ravage),()=>this.$.doEffects(yn.StartOfRavageStep),()=>this.$.ravage(),()=>this.$.doEffects(yn.AfterTheNormalRavageStep),()=>this.setPhase(Wi.Build),()=>this.$.build(),()=>this.$.doEffects(yn.AfterTheNormalBuildStep),()=>this.setPhase(Wi.Explore),()=>this.$.explore(),()=>this.$.doEffectsWithPriority(yn.AfterTheNormalExploreStep),()=>this.setPhase(Wi.AdvanceCards),()=>this.$.advanceInvaderCards()])}nextTurn(){return this.turn+=1,Promise.resolve()}async slowPhase(){await this.doSteps([()=>this.setPhase(Wi.SlowPowers),()=>this.$.doEffects(yn.StartOfSlowPhase),()=>this.$.resolvePowers(rr.Slow)])}async spiritPhase(){await this.doSteps([()=>this.growthPhase(),()=>this.setPhase(Wi.GainEnergy),()=>this.$.gainEnergyFromTracks(),()=>this.$.doEffects(yn.AfterGainingEnergyFromTracks),()=>this.$.playTrackActions(),()=>this.$.doEffects(yn.BeforePlayPowers),()=>this.setPhase(Wi.PlayPowers),()=>this.$.playPowers(),()=>this.$.doEffects(yn.AfterPlayPowers)])}async timePasses(){await this.doSteps([()=>this.setPhase(Wi.TimePasses),()=>this.$.doEffects(yn.AtTimePassesBegin),()=>this.$.timePassesForSpirits(),()=>this.$.forEachLand((e=>e.timePasses())),()=>this.$.timePassesForFear(),()=>this.$.timePassesForEffects(),()=>this.$.doEffects(yn.AtTimePassesEnds),()=>this.$.timePassesLateExpiration(),()=>this.$.globalHealthCheck(),()=>this.nextTurn()])}}Ww([Re],Mw.prototype,"lostReason",void 0),Ww([Re],Mw.prototype,"phase",void 0),Ww([Re],Mw.prototype,"reportedPhase",void 0),Ww([Re],Mw.prototype,"turn",void 0),Ww([Re],Mw.prototype,"winReason",void 0);const Gw={name:"The Kingdom of England",set:a.Base,levels:[{difficulty:1,fearCards:[3,3,3],effect:{effects:[{name:"Proud & Might Capital",text:"If 7 or more <town>/<city> are ever in a single land, the Invaders win.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.ProudAndMightCapital,[yn.LossCondition]:()=>e.existLandWhere((a=>a.hasAtLeast(7,e.TownOrCity)))?Ew.ProudAndMightCapital:null,[yn.GlobalReminder]:()=>({icon:`<town>/<city><br>${e.capitalSize} / 7`,ongoing:!0,adversary:wg.England})})}},{name:"Stage II Escalation <escalation><br>Building Boom",text:"On each board with <town>/<city>, Build in the land with the most <town>/<city>.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.BuildingBoom,[yn.Escalation]:async({adversary:a,beforeExplore:t,beforeBuilding:n})=>!(a!==wg.England||!t&&!n)&&(await e.doAdversaryActionOnEachBoard({where:a=>a.hasOneLandWith(e.TownOrCity),forEach:a=>a.inLandsWithMost((a=>a.numberOf(e.TownOrCity))).pickOne((e=>e.doExtraBuild())),effect:{noOptions:"No boards with <town>/<city>."}}),!0),[yn.GlobalReminder]:()=>({icon:"<escalation><br><town>/<city>",ongoing:!0,visible:e.stage===(e.adversaryLeading?.adversary===wg.England?2:3),adversary:wg.England})})}}]}},{difficulty:3,fearCards:[3,4,3],effect:{name:"Indentured Servants Earn Land",text:"Invader Build actions affect lands without Invaders, if they are adjacent to at least 2 <town>/<city> before the Build Action.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.IndenturedServantsEarnLand,[yn.BuildCardsAffectLandsWithoutInvaders]:({land:a})=>a.adjacentPiecesInLandsWhere((e=>!e.location.isIsolated)).hasAtLeast(2,(a=>a.isA(e.TownOrCity))),[yn.GlobalReminder]:()=>({icon:"2+<br><town>/<city>",ongoing:!0,adversary:wg.England})})}}},{difficulty:4,fearCards:[4,4,3],effect:{name:"Criminals and Malcontents",text:"During Setup, on each board add 1 <city> to land #1 and 1 <town> to land #2.",[yn.Now]:({$:e})=>e.onEachBoard((async a=>{a.ignoreInvaderAndBlightInSetup||(e.config.adversaryLeading?.adversary===wg.Scotland||e.config.adversarySupporting?.adversary===wg.Scotland?await e.addSubEffectUntilEndOfTurn({[yn.BeforeSetupPresence]:async()=>{await a.inLandNumber(1).inAdjacentLandsWhere((e=>e.isInland)).pickOne((async a=>{await a.add(1,e.City)}),{name:"Combing the Kingdom of Scotland",text:"Criminals and Malcontents:<br>During Setup, on each board add 1 <city> to land #1.<br><br>If the other Adversary's Setup instructions would add <city> to a Coastal land other than land #2, instead add the <city> to an adjacent inland land."})}}):await a.inLandNumber(1).add(1,e.City),await a.inLandNumber(2).add(1,e.Town))}))}},{difficulty:6,fearCards:[4,5,4],effect:{name:"High Immigration (I)",text:"Put the 'High Immigration' tile on the Invader Board, to the left of 'Ravage'. The Invaders take this Build action each Invader Phase before Ravaging. Cards slide left from Ravage to it, and from it to the discard pile.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.HighImmigrationI,[yn.HighImmigration]:async()=>{await e.setPhase(Wi.HighImmigration),await e.build(Zl.HighImmigration)},[yn.BeforeAdvancingCards]:async()=>{await e.advanceCardsIn(Zl.HighImmigration).to(Zl.Discard),await e.advanceCardsIn(Zl.Ravage).to(Zl.HighImmigration),!e.someEffect(yn.PermanentHighImmigration)&&e.invaderCardsInVisibleSlot(Zl.HighImmigration).some((e=>2===Mo[e].stage))&&(e.removeThisEffect(),await e.advanceCardsIn(Zl.HighImmigration).to(Zl.Discard))}})}}},{difficulty:7,fearCards:[4,5,5],effect:{name:"High Immigration Full",text:"The extra Build tile remains out the entire game.",effectId:wn.HighImmigrationFull,[yn.PermanentHighImmigration]:()=>!0}},{difficulty:9,fearCards:[4,5,5],effect:{name:"Local Autonomy",text:"<town>/<city> have +1 Health.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.LocalAutonomy,[yn.AdjustHealth]:({piece:a})=>a.isA(e.TownOrCity)?1:0})}}},{difficulty:11,fearCards:[4,5,4],effect:{name:"Independent Resolve",effects:[{text:"During Setup, add an additional <fear> to the Fear Pool per player in the game.",[yn.Now]:({$:e})=>e.addFearToPool(e.spiritCount)},{text:"During any Invader Phase where you resolve no Fear Cards, perform the Build from High immigration twice.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.IndependentResolve,[yn.HighImmigration]:async()=>{e.hasResolvedFearCard||await e.build(Zl.HighImmigration)},[yn.GlobalReminder]:()=>({icon:"No <fear><br>x2",ongoing:!0,adversary:wg.England})})}}]}}]},Hw={name:"The Kingdom of France (Plantation Colony)",set:a.BranchAndClaw,levels:[{difficulty:2,fearCards:[3,3,3],effect:{effects:[{name:"Sprawling Plantation",effects:[{text:"Before Setup, return all but 7 <town> per player to the box. Invaders win if you ever cannot place a <town>.",[yn.Now]:async({$:e})=>{const a=Re.box(!1);await e.addSubEffect({effectId:wn.SprawlingPlantation,[yn.LossCondition]:()=>a.get()?Ew.SprawlingPlantation:null,[yn.GlobalReminder]:()=>({icon:`<town><br>${e.townsCount} / ${e.maxTownsAllowed}`,ongoing:!0,adversary:wg.France}),[yn.PreventReplacePiece]:async({piece:t,withPieces:n})=>{const r=t===Bn.Town?-1:0,i=Jo(n,(e=>e===Bn.Town));return e.townsCount+r+i>e.maxTownsAllowed&&(await e.sendEvent({type:fn.GenericSub,text:"There are no more <town> to add!"}),a.set(!0),!0)},[yn.PreventAddPiece]:async({piece:t})=>t===Bn.Town&&e.townsCount===e.maxTownsAllowed&&(await e.sendEvent({type:fn.GenericSub,text:"There are no more <town> to add!"}),a.set(!0),!0)})}}]},{name:"Stage II Escalation <escalation><br>Demand for New Cash Crops",effects:[{text:"After Exploring, on each board, pick a land of the shown terrain. If it has <town>/<city>, add 1 <blight>. Otherwise, add 1 <town>.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.DemandForNewCashCrops,[yn.Escalation]:async({adversary:a,card:t,afterExplore:n,beforeBuilding:r})=>{if(a===wg.France&&(n||r)){const a=[...Mo[t].terrains],n=a.length>1;n&&await e.clickToContinue({text:"If the Escalation is specific to a terrain - as with France and Sweden - choose one of the terrain randomly."});const r=a.length>1?await e.drawFrom(a,a.map((e=>Jg[e].text))):a[0];return n&&await e.clickToContinue({text:`If the Escalation is specific to a terrain - as with France and Sweden - choose one of the terrain randomly.<br><br>France Escalates in terrain ${Jg[r].text}`}),await e.doAdversaryActionOnEachBoard({forEach:a=>a.inLandsWhere((e=>e.hasTerrain(r))).pickOne((async a=>{a.has(e.TownOrCity)?await a.addBlight(1):await a.add(1,e.Town)}))}),!0}return!1},[yn.GlobalReminder]:()=>({icon:"<escalation><br>+<blight>/<town>",ongoing:!0,visible:e.stage===(e.adversaryLeading?.adversary===wg.France?2:3),adversary:wg.France})})}}]}]}},{difficulty:3,fearCards:[3,3,3],effect:{name:"Frontier Explorers",text:"Except during Setup: After Invaders successfully Explore into a land which had no <town>/<city>, add 1 <explorer> there.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.FrontierExplorers,[yn.BeforeSuccessfulExplore]:({land:a})=>(a.has(e.TownOrCity)||e.phase===Wi.InitialExplore||(e.action.data.hadNoBuilding=!0),Promise.resolve()),[yn.AfterSuccessfulExplore]:async({land:a})=>{e.action.data.hadNoBuilding&&(await e.sendEvent({type:fn.GenericMain,text:"Invaders successfully Explored into a land which had no <town>/<city>."}),await a.add(1,e.Explorer))},[yn.GlobalReminder]:()=>({icon:"<explorer><explorer>",ongoing:!0,adversary:wg.France})})}}},{difficulty:5,fearCards:[3,4,3],effect:{name:"Slave Labor",effects:[{text:"During Setup, put the 'Slave Rebellion' Event under the top 3 cards of the Event Deck.",[yn.Now]:async({$:e})=>{if(e.config.events)e.config.thematicRebellion?(e.insertEventCard(af.SlaveRebellion).underCards(0),await e.shuffleTopThreeEventCards(),e.putBottomEventCardToTop(),e.putBottomEventCardToTop()):e.insertEventCard(af.SlaveRebellion).underCards(3);else{let a=e.config.thematicRebellion?3:4,t=e.config.thematicRebellion?[0,1,2]:[0];await e.addEffect({effectId:wn.SlaveLabor,[yn.AfterEventPhase]:async()=>{if(e.turn>=a&&0===await e.drawFrom(t,t.map((e=>0===e?"Rebellion now.":"Rebellion later.")))){const n=3===e.stage;e.insertEventCard(af.SlaveRebellion).underCards(0),await e.drawEventCard(),a=e.turn+(e.config.thematicRebellion?3:4),t=e.config.thematicRebellion?[0,1,2]:[0],n&&(a=99)}}})}}},{text:"After Invaders Build in a land with 2 <explorer> or more, replace all but 1 <explorer> there with an equal number of <town>.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.SlaveLabor,[yn.BeforeSuccessfulBuild]:({land:a})=>(a.hasAtLeast(2,e.Explorer)&&(e.action.data.hadAtLeastTwoExplorers=!0),Promise.resolve()),[yn.AfterSuccessfulBuild]:async({land:a})=>{if(e.action.data.hadAtLeastTwoExplorers){const t=a.numberOf(e.Explorer)-1;await e.sendEvent({type:fn.GenericMain,text:`Slave Labor converted ${t} <explorer>.`}),await a.replaceIndividually({amount:t,pieces:e.Explorer,withPiece:Bn.Town})}},[yn.GlobalReminder]:()=>({icon:"<explorer><explorer><br>=<explorer><town>",ongoing:!0,adversary:wg.France})})}}]}},{difficulty:7,fearCards:[4,4,3],effect:{name:"Early Plantations",effects:[{text:"During Setup, on each board add 1 <town> to the highest-numbered land without <town>.",[yn.Now]:async({$:e})=>{await e.onEachBoard((async a=>{if(!a.ignoreInvaderAndBlightInSetup){const t=a.highestNumberedLand((a=>!a.has(e.Town)));t&&await t.add(1,e.Town)}}))}},{text:"Add 1 <town> to land #1.",[yn.Now]:async({$:e})=>{await e.onEachBoard((async a=>{a.ignoreInvaderAndBlightInSetup||await a.inLandNumber(1).add(1,e.Town)}))}}]}},{difficulty:8,fearCards:[4,4,4],effect:{name:"Triangle Trade",effects:[{text:"Whenever Invaders Build a Coastal <city>, add 1 <town> to the adjacent land with the fewest <town>.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.TriangleTrade,[yn.AfterSuccessfulBuild]:async({land:a,additions:t})=>{t.some((t=>t.location.isCoastal&&t.piece.isA(e.City)&&!a.isIsolated))&&await e.doAdversaryAction((()=>a.inAdjacentLandsWhere((e=>!e.isIsolated)).withLeast((a=>a.numberOf(e.Town))).pickOne((async a=>{await e.sendEvent({type:fn.GenericMain,text:"Invaders Built a Coastal <city>:"}),await a.add(1,e.Town)}))))},[yn.GlobalReminder]:()=>({icon:"<city><br>+1 <town>",ongoing:!0,adversary:wg.France})})}}]}},{difficulty:9,fearCards:[4,5,4],effect:{name:"Slow-Healing Ecosystem",effects:[{text:"When you remove <blight> from the board, put it here instead of onto the Blight Card. As soon as you have 3 <blight> per player here, move it all back to the Blight Card.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.SlowHealingEcosystem,[yn.PreventAddRemovedBlightToBlightCard]:async()=>(await e.addSlowHealingBlight(),!0),[yn.AfterAddingSlowHealingBlight]:async()=>{for(;e.slowHealingBlight>=3;)await e.clickToContinue(),await e.removeSlowHealingBlight(3),await e.addBlightToBlightCard(3)},[yn.GlobalReminder]:()=>({icon:"3 <blight>",ongoing:!0,adversary:wg.France})})}}]}},{difficulty:10,fearCards:[4,5,5],effect:{name:"Persistent Explorers",effects:[{text:"After the normal Explore, on each board add 1 <explorer> to a land without any.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.PersistentExplorers,[yn.AfterResolvingExploreCard]:()=>e.doAdversaryActionOnEachBoard({forEach:async a=>{a.ignoreInvaderAndBlightInSetup||await a.inLandsWithout(e.Explorer).pickOne((async a=>{await a.add(1,e.Explorer)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands without <explorer>.`})}}),[yn.GlobalReminder]:()=>({icon:"+1 <explorer>",ongoing:!0,adversary:wg.France})})}},{text:"Fear Card effects never remove <explorer>. If one would, you may instead Push that <explorer>.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.PersistentExplorers,[yn.PreventRemovePiece]:async({piece:a,removement:t})=>!(e.action.type!==Ho.FearAction||t!==Nn.Remove||!a.isA(e.Explorer))&&(await a.push({quantifier:lr.May}),!0),[yn.GlobalReminder]:()=>({icon:"<fear><br>Push <explorer>",ongoing:!0,adversary:wg.France})})}}]}}]},jw={name:"The Habsburg Monarchy (Livestock Colony)",set:a.JaggedEarth,levels:[{difficulty:2,fearCards:[3,3,3],effect:{effects:[{name:"Irreparable Damage",text:"Track how many <blight> come off the Blight Card during Ravages that do 8+ Damage to the land. If that number ever exceeds players, the Invaders win.",[yn.Now]:async({$:e})=>{const a=Re.box(0);await e.addSubEffect({effectId:wn.IrreparableDamage,effects:[{[yn.AfterRavagingDamageLand]:async({blightedLands:t,damageExceedingHealth:n})=>{n>=6&&t.length>0&&(a.set(a.get()+t.length),await e.sendEvent({type:fn.GenericSub,text:`The Invaders did 8+ Damage to the land and caused ${t.length} Irreparable Damage.`}))},[yn.LossCondition]:()=>a.get()>e.spiritCount?Ew.IrreparableDamage:null,[yn.GlobalReminder]:()=>({icon:`<blight><br>${a.get()} / ${e.maxIrreparableDamage}`,ongoing:!0,adversary:wg.Habsburg})}]})}},{name:"Stage II Escalation <escalation><br>Seek Prime Territory",text:"After Exploring: On each board with 4 or fewer <blight>, add 1 <town> to a land without <town>/<blight>. On each board with 2 or fewer <blight>, do so again.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.SeekPrimeTerritory,[yn.Escalation]:async({adversary:a,afterExplore:t,beforeBuilding:n})=>{if(a===wg.Habsburg&&(t||n)){for(const a of[4,2])await e.doAdversaryActionOnEachBoard({where:e=>e.numberOfBlight<=a,forEach:async t=>{await t.inLandsWithNoneOf(e.Town,e.Blight).pickOne((async a=>{await a.add(1,e.Town)}),{text:4===a?"On each board with 4 or fewer <blight>, add 1 <town> to a land without <town>/<blight>.":"On each board with 2 or fewer <blight>, do so again.",highlightBoards:[t],noOptions:`On board ${t.name}: No lands without <town>/<blight>.`})}});return!0}return!1},[yn.GlobalReminder]:()=>({icon:"<escalation>",ongoing:!0,visible:e.stage===(e.adversaryLeading?.adversary===wg.Habsburg?2:3),adversary:wg.Habsburg})})}}]}},{difficulty:3,fearCards:[3,4,3],effect:{name:"Migratory Herders",text:"After the normal Build Step: In each land matching a Build Card, Gather 1 <town> from a land not matching a Build Card. (In board/land order.)",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.MigratoryHerders,[yn.AfterTheNormalBuildStep]:()=>e.doAdversaryActionOnEachBoard({forEach:a=>a.inLandsWhere((a=>a.matchesInvaderCards(e.invaderCardsInVisibleSlot(Zl.Build),Hr.Build))).forEach((async a=>{a.isIsolated||await a.gather({amount:1,pieces:e.Town,filter:a=>!a.matchesInvaderCards(e.invaderCardsInVisibleSlot(Zl.Build),Hr.Build)&&!a.isIsolated,pickPiecesEffect:{noOptions:`Land ${a.coordinateLink} has no adjacent <town> not matching a Build Card.`}})}))}),[yn.GlobalReminder]:()=>({icon:"Gather<br>1 <town>",ongoing:!0,adversary:wg.Habsburg})})}}},{difficulty:5,fearCards:[4,5,2],effect:{name:"More Rural than Urban",effects:[{text:"During Setup, on each board, add 1 <town> to land #2 and 1 <town> to the highest-numbered land without Setup symbols.",[yn.Now]:({$:e})=>e.onEachBoard((async a=>{a.ignoreInvaderAndBlightInSetup||(await a.inLandNumber(2).add(1,e.Town),await(a.highestNumberedLand((e=>!e.hasSetupSymbols))??a.highestNumberedLand()).add(1,e.Town))}))},{text:"During Play, when Invaders would Build 1 <city> in an Inland land, they instead Build 2 <town>.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.MoreRuralThanUrban,[yn.AlterInvaderActionInLand]:async({invaderAction:a,land:t})=>{if(a===Hr.Build&&t.isInland&&t.buildPlans===e.City){await e.sendEvent({type:fn.GenericSub,text:`Invaders would Build 1 <city> in the inland ${t.coordinateLink}, so they instead Build 2 <town>.`});const a=await t.add(2,e.Town);return await e.doEffects(yn.AfterSuccessfulBuild,{land:t,additions:a}),!0}return!1},[yn.GlobalReminder]:()=>({icon:"1 <city><br>=2 <town>",ongoing:!0,adversary:wg.Habsburg})})}}]}},{difficulty:6,fearCards:[4,5,3],effect:{name:"Fast Spread",text:"When making the Invader Deck, Remove 1 additional Stage I Card. (New deck order: 11-2222-33333)",[yn.Now]:({$:e})=>e.removeTopMostInvaderCardOfStage(1)}},{difficulty:8,fearCards:[4,5,3],effect:{name:"Herds Thrive in Verdant Lands",text:"<town> in lands without <blight> are Durable: they have +2 Health, and 'Destroy <town>' effects instead deal 2 Damage (to <town> only) per <town> they could Destroy. ('Destroy all <town>' works normally.)",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.HerdsThriveInVerdantLands,[yn.AdjustHealth]:({piece:e})=>e.isTown&&!e.location?.hasBlight?2:0,[yn.AfterAddingPiece]:async({land:e,additions:a})=>{a.length>0&&a[0].piece.isBlight&&await e.healthCheck()},[yn.AdjustRemovePiece]:async({piece:a,location:t,removement:n,removeAll:r})=>!(!a.isA(e.Town)||t.hasBlight||!1!==r||n!==Nn.DirectDestroy&&n!==Nn.Drown)&&(e.action.data.targetableTowns=e.action.data.targetableTowns??[],e.action.data.targetableTowns.push(a),await a.location.damage(2,e.Town,{filter:a=>e.action.data.targetableTowns.includes(a)}),!0)})}}},{difficulty:9,fearCards:[4,6,3],effect:{name:"Wave of Immigration",text:"Before the initial Explore, put the Habsburg Reminder Card under the top 5 Invader Cards. When revealed, on each board, add 1 <city> to a Coastal land without <city> and 1 <town> to the 3 Inland lands with the fewest <blight>.",card:Wo.WaveOfImmigration,[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.WaveOfImmigration,[yn.BeforeInitialExplore]:async()=>{await e.clickToContinue(),await e.insertInvaderCard(bw.WaveOfImmigration,{isSpecial:!0}).justBelowCards(5)},[yn.AfterChangingInvaderDeck]:async()=>{e.invaderCardsInExploreDeck.length>0&&e.invaderCardsInExploreDeck[0]===Wo.WaveOfImmigration&&0===e.invaderCardsInSlot(Zl.Explore).length&&(await e.sendEvent({type:fn.WaveOfImmigration}),await e.doAdversaryActionOnEachBoard({forEach:async a=>{await a.inLandsWithout(e.City).where((e=>e.isCoastal)).pickOne((async a=>{await a.add(1,e.City)}),{textArea:[.579,.75],text:"Add 1 <city> to a Coastal land without <city>.",highlightBoards:[a],noOptions:`On board ${a.name}: No Coastal lands without <city>.`});const t=a.inInlandLands();await _r(3,(a=>t.copy().withLeast((a=>a.numberOf(e.Blight))).pickOne((async a=>{t.remove(a),await a.add(1,e.Town)}),{textArea:[.686,.918],text:"Add 1 <town> to the 3 Inland lands with the fewest <blight>.",prompt:`Pick Inland land to add <town>. ${3-a} left.`})))}}),await e.removeTopMostInvaderCardOfStage(0))}})}}},{difficulty:10,fearCards:[5,6,3],effect:{name:"Far-Flung Herds",text:"Ravages do +2 Damage (total) if any adjacent lands have <town>. (This does not cause lands without Invaders to Ravage.)",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.FarFlungHerds,[yn.AdjustCollectiveInvaderRavageDamage]:({land:a})=>!a.isIsolated&&a.hasAdjacentLandWhere((a=>a.participatingInvaders().where((a=>a.isA(e.Town))).count>0&&!a.isIsolated))?2:0,[yn.GlobalReminder]:()=>({icon:"<range-1><br>+2 <damage>",ongoing:!0,adversary:wg.Habsburg})})}}}]},Uw={name:"The Kingdom of Brandenburg-Prussia",set:a.Base,levels:[{difficulty:1,fearCards:[3,3,3],effect:{name:"Stage II Escalation <escalation><br>Land Rush",text:"On each board with <town>/<city>, add 1 <town> to a land without <town>.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.LandRush,[yn.Escalation]:async({beforeExplore:a,beforeBuilding:t,adversary:n})=>!(n!==wg.BrandenburgPrussia||!a&&!t)&&(await e.doAdversaryActionOnEachBoard({where:a=>a.hasOneLandWith(e.TownOrCity),forEach:a=>a.inLandsWithout(e.Town).pickOne((async a=>{await a.add(1,e.Town)}),{highlightBoards:[a],noOptions:`On board ${a.name}: No lands without <town>.`}),effect:{noOptions:"No boards with <town>/<city>."}}),!0),[yn.GlobalReminder]:()=>({icon:"<escalation><br>+1 <town>",ongoing:!0,visible:e.stage===(e.adversaryLeading?.adversary===wg.BrandenburgPrussia?2:3),adversary:wg.BrandenburgPrussia})})}}},{fearCards:[3,3,3],difficulty:2,effect:{name:"Fast Start",text:"During Setup, on each board add 1 <town> to land #3.",[yn.Now]:({$:e})=>e.onEachBoard((async a=>{a.ignoreInvaderAndBlightInSetup||await a.inLandNumber(3).add(1,e.Town)}))}},{difficulty:4,fearCards:[3,3,3],effect:{name:"Surge of Colonists",text:"When making the Invader Deck, put I of the stage III cards between Stage I and Stage II.",[yn.Now]:async({$:e})=>{await e.removeBottomMostInvaderCardOfStage(3),await e.insertInvaderCard(bw.Stage3Card,{isSpecial:!0}).justBelowBottomMostOfStage(1)}}},{difficulty:6,fearCards:[3,4,3],effect:{name:"Efficient",text:"When making the Invader Deck, remove and additional Stage I card.",[yn.Now]:({$:e})=>e.removeTopMostInvaderCardOfStage(1)}},{difficulty:7,fearCards:[4,4,3],effect:{name:"Aggressive Timetable",text:"When making the Invader Deck, remove and additional Stage II card.",[yn.Now]:({$:e})=>e.removeTopMostInvaderCardOfStage(2)}},{difficulty:9,fearCards:[4,4,3],effect:{name:"Ruthlessly Efficient",text:"When making the Invader Deck, remove an additional Stage I card.",[yn.Now]:({$:e})=>e.removeTopMostInvaderCardOfStage(1)}},{difficulty:10,fearCards:[4,4,4],effect:{name:"Terrifyingly Efficient",text:"When making the Invader Deck, remove all Stage I cards.",[yn.Now]:({$:e})=>e.removeTopMostInvaderCardOfStage(1)}}]},qw={name:"The Tsardom of Russia",set:a.JaggedEarth,levels:[{difficulty:1,fearCards:[3,3,3],effect:{effects:[{name:"Hunters Swarm the Island",text:"Put <beasts> Destroyed by Adversary rules on this panel. If there are ever more <beasts> on this panel than on the island, the Invaders win.",[yn.Now]:async({$:e})=>{const a=Re.box(0);await e.addSubEffect({effectId:wn.HuntersSwarmTheIsland,[yn.AfterRemovePiece]:({removement:t,piece:n})=>(n.isIgnoringCountAsA(e.Beasts)&&pr[t].isDestroyLike&&e.action.type===Ho.AdversaryAction&&a.set(a.get()+1),Promise.resolve()),[yn.LossCondition]:()=>a.get()>e.beastsOnIsland?Ew.HuntersSwarmTheIsland:null,[yn.GlobalReminder]:()=>{return{icon:`<beasts><br>${a.get()} ${t=a.get(),n=e.beastsOnIsland,t<n?"<":t===n?"=":">"} ${e.beastsOnIsland}`,ongoing:!0,adversary:wg.Russia};var t,n}})}},{name:"Stage II Escalation <escalation><br>Stalk the Predators",text:"On each board: Add 2 <explorer> (total) among lands with <beasts>. If you can't instead add 2 <explorer> among lands with <beasts> on a different board.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.StalkThePredators,[yn.Escalation]:async({adversary:a,beforeExplore:t,beforeBuilding:n})=>!(a!==wg.Russia||!t&&!n)&&(await e.doAdversaryActionOnEachBoard({forEach:async a=>{let t=e.countPieceOnlyIfHavingPiece(Bn.Beasts,(()=>a.inLandsWith(e.Beasts)));0===t.count&&(t=e.countPieceOnlyIfHavingPiece(Bn.Beasts,(()=>e.inLandsWith(e.Beasts))));let n=e.boards;await t.pickMultiple({amount:2,where:e=>e.boards().hasOneWhere((e=>n.includes(e))),forPickedItem:async a=>{n=a.boards().items,await a.add(1,e.Explorer)},repeatSame:!0,effect:{highlightBoards:[a]}})}}),!0),[yn.GlobalReminder]:()=>({icon:"<escalation><br>+2 <explorer>",ongoing:!0,visible:e.stage===(e.adversaryLeading?.adversary===wg.Russia?2:3),adversary:wg.Russia})})}}]}},{difficulty:3,fearCards:[3,3,4],effect:{name:"Hunters Seek Shell and Hide",effects:[{text:"During Setup, on each board, add 1 <beasts> and 1 <explorer> to the highest-numbered land without <town>/<city>.",[yn.Now]:({$:e})=>e.onEachBoard((async a=>{const t=a.highestNumberedLand((a=>a.doesntHave(e.TownOrCity)))??a.highestNumberedLand();await t.add(1,e.Beasts),a.ignoreInvaderAndBlightInSetup||await t.add(1,e.Explorer)}))},{text:"During Play, <explorer> do +1 Damage.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.HuntersSeekShellAndHide,[yn.AdjustDamage]:({piece:a})=>a.isA(e.Explorer)?1:0,[yn.GlobalReminder]:()=>({icon:"<explorer><br>+1 <damage>",ongoing:!0,adversary:wg.Russia})})}},{text:"When Ravage adds <blight> to a land (including cascades), Destroy 1 <beasts> in that land.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.HuntersSeekShellAndHide,[yn.WhenAddingBlight]:async({blightedLands:a,fromRavage:t})=>{if(t)for(const t of Cr(a))await e.doAdversaryAction((async()=>{await t.possiblyDontCountPiecesAs(Bn.Beasts),await t.destroyOne(e.Beasts)}))},[yn.GlobalReminder]:()=>({icon:"<blight><br>-1 <beasts>",ongoing:!0,adversary:wg.Russia})})}}]}},{difficulty:4,fearCards:[4,3,4],effect:{name:"A Sense for Impending Disaster",text:"The first time each Action would Destroy <explorer>: If possible, 1 of those <explorer> is instead Pushed; 1 <fear> when you do so.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.ASenseForImpendingDisaster,[yn.PreventRemovePiece]:async({piece:a,location:t,removement:n})=>{if(a.isA(e.Explorer)&&pr[n].isDestroyLike&&e.action.type!==Ho.GameAction&&!e.action.data.hasDestroyedExplorer){e.action.data.hasDestroyedExplorer=!0,a.damage=0,a.shadowDamage=0;return 0===(await a.push({amount:1,pieces:e.Explorer})).length?await a.destroy():await t.fear(1),!0}return!1},[yn.OrderOfRemoveAllMightMatter]:()=>!0,[yn.GlobalReminder]:()=>({icon:"Push <explorer><br>+1 <fear>",ongoing:!0,adversary:wg.Russia})})}}},{difficulty:6,fearCards:[4,4,3],effect:{name:"Competition Among Hunters",text:"Ravage Cards also match lands with 3 or more <explorer>. (If the land already matched the Ravage Card, it still Ravages just once.)",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.CompetitionAmongHunters,[yn.OverrideMatchesInvaderCard]:({land:a,invaderAction:t})=>a.participatingInvaders().where((a=>a.isA(e.Explorer))).count>=3&&t===Hr.Ravage||void 0,[yn.GlobalReminder]:()=>({icon:"<explorer><explorer><explorer>",ongoing:!0,adversary:wg.Russia})})}}},{difficulty:7,fearCards:[4,4,4],effect:{name:"Accelerated Exploitation",text:"When making the Invader Deck, put 1 Stage III Card after each Stage II Card. (New Deck Order: 111-2-3-2-3-2-3-2-33).",[yn.Now]:async({$:e})=>{for(let a=1;a<=4;a+=1)await e.removeBottomMostInvaderCardOfStage(3),await e.insertInvaderCard(bw.Stage3Card,{isSpecial:!0}).justBelowNthCardOfStage(a,2)}}},{difficulty:9,fearCards:[4,5,4],effect:{name:"Entrench in the Face of Fear",text:"Put an unused Stage II Invader Card under the top 3 Fear Cards, and an unused Stage III Card under the top 7 Fear Cards. When one is revealed, immediately, place it in the Build space (face-up).",[yn.Now]:({$:e})=>(e.insertInvaderCardUnderFearCards(bw.Stage2CardIncludingCoastal,3),e.insertInvaderCardUnderFearCards(bw.Stage3Card,7),Promise.resolve())}},{difficulty:11,fearCards:[5,5,4],effect:{name:"Pressure for Fast Profit",text:"After the Ravage Step of turn 2+, on each board where it added no <blight>: In the land with the most <explorer> (min. 1), add 1 <explorer> and 1 <town>.",[yn.Now]:async({$:e})=>{let a=[];await e.addSubEffect({effectId:wn.PressureForFastProfit,[yn.StartOfRavageStep]:()=>(a=e.boards.map((a=>a.numberOf(e.Blight))),Promise.resolve()),[yn.AfterTheNormalRavageStep]:()=>e.doAdversaryActionOnEachBoard({forEach:async t=>{e.turn>=2&&(t.numberOf(e.Blight)<=a[t.boardIndex]?await t.inLandsWithMostMinimumOne(e.Explorer).pickOne((async a=>{await a.add(1,e.Explorer),await a.add(1,e.Town)}),{highlightBoards:[t],noOptions:`On board ${t.name}: No lands with <explorer>.`}):await e.clickToContinue({highlightBoards:[t],noOptions:`On board ${t.name}: The Ravage added <blight>.`}))}}),[yn.GlobalReminder]:()=>({icon:"No <blight><br><explorer>+<town>",ongoing:!0,adversary:wg.Russia})})}}}]},_w={name:"Habsburg Mining Expedition",set:a.NatureIncarnate,levels:[{difficulty:1,fearCards:[3,3,3],effect:{effects:[{name:"Land Stripped Bare",text:"At the end of the <fast> Phase, the Invaders win if any land has at least 8 total Invaders/<blight> (combined).",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.LandStrippedBare,[yn.AfterFastPhase]:()=>(e.existLocationIncludingNonExistingWhere((a=>a.numberOf(e.Blight)+a.numberOf(e.Invader)>=8))&&e.loseGame(Ew.LandStrippedBare),Promise.resolve()),[yn.ShowLossCondition]:()=>e.strippedLandSize>=8?Ew.LandStrippedBare:null,[yn.GlobalReminder]:()=>({icon:`<fast><br>${e.strippedLandSize} / 8`,ongoing:!0,adversary:wg.Saltburg})})}},{name:"Stage II Escalation <escalation><br>Mining Tunnels",text:"After Advancing Invader Cards: On each board, Explore in 2 lands whose terrains don't match a Ravage or Build Card (no source required).",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.MiningTunnels,[yn.Escalation]:async({adversary:a,afterAdvancingCards:t,beforeBuilding:n})=>!(a!==wg.Saltburg||!t&&!n)&&(await e.doAdversaryActionOnEachBoard({forEach:async a=>{await a.inLandsWhere((a=>!a.terrainsMatchesInvaderCards([...e.invaderCardsInVisibleSlot(Zl.Ravage),...e.invaderCardsInVisibleSlot(Zl.Build),...e.invaderCardsInVisibleSlot(Zl.HighImmigration)]))).pickMultiple({amount:2,forPickedItem:async e=>{await e.doExtraExplore()}})}}),!0),[yn.GlobalReminder]:()=>({icon:"<escalation><br>Explore",ongoing:!0,visible:e.stage===(e.adversaryLeading?.adversary===wg.Saltburg?2:3),adversary:wg.Saltburg})})}}]}},{difficulty:3,fearCards:[3,3,3],effect:{effects:[{name:"Avarice Rewarded",text:"When <blight> added by a Ravage Action would cascade, instead Upgrade 1 <explorer>/<town> (before <dahan> counterattack).",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.AvariceRewarded,[yn.PreventCascade]:async({location:a,fromRavage:t})=>!!t&&(await a.upgrade({amount:1,pieces:e.ExplorerOrTown}),!0),[yn.GlobalReminder]:()=>({icon:"2+ <blight><br>Upgrade",ongoing:!0,adversary:wg.Saltburg})})}},{name:"Ceaseless Mining",text:"Lands with 3 or more Invaders are Mining Lands. In Mining lands:<br><br><disease> and modifiers to <disease> affect Ravage Actions as though they were Build Actions.<br><br>During the Build Step, Build Cards cause Ravage Actions (instead of Build Actions).",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.CeaselessMining,[yn.PreventInvaderActionInLand]:async({land:a,invaderAction:t})=>!(!a.isMiningLand||t!==Hr.Ravage||!a.has(e.Disease)||await e.oneEffectActivates(yn.PreventDiseasePreventingBuilds,{location:a}))&&(await a.removeOne(e.Disease),!0),[yn.MiningLandsCauseRavageActions]:()=>!0,[yn.BuildOrderMatters]:()=>!0,[yn.GlobalReminder]:()=>({icon:"Build =<br>Ravage",ongoing:!0,adversary:wg.Saltburg})})}}]}},{difficulty:4,fearCards:[3,3,4],effect:{name:"Miners Come From Far and Wide",effects:[{text:"Setup: Add 1 <explorer> in each land with no <dahan>.",[yn.Now]:async({$:e})=>{await e.inLandsWithout(e.Dahan).forEach((async a=>{a.board.ignoreInvaderAndBlightInSetup||await a.add(1,e.Explorer)}))}},{text:"Add 1 <disease> and 1 <city> in the highest-numbered land with a <town> Setup symbol.",[yn.Now]:async({$:e})=>{await e.onEachBoard((async a=>{const t=a.highestNumberedLand((e=>e.setupSymbols.includes(Bn.Town)))??a.highestNumberedLand();await t.add(1,e.Disease),a.ignoreInvaderAndBlightInSetup||await t.add(1,e.City)}))}}]}},{difficulty:5,fearCards:[3,4,4],effect:{name:"Mining Boom (I)",text:"After the Build Step, on each board: Choose a land with <explorer>: Upgrade 1 <explorer> there.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.MiningBoomI,[yn.AfterTheNormalBuildStep]:()=>e.doAdversaryActionOnEachBoard({forEach:a=>a.inLandsWith(e.Explorer).pickOne((async a=>{await a.upgrade({amount:1,pieces:e.Explorer})}),{highlightBoards:[a]})}),[yn.GlobalReminder]:()=>({icon:"Upgrade<br>1 <explorer>",ongoing:!0,adversary:wg.Saltburg})})}}},{difficulty:7,fearCards:[4,4,4],effect:{name:"Untapped Salt Deposits",effects:[{text:"Setup: Remove the Stage II Coastal Lands card before randomly choosing Stage II cards. Place the 'Salt Deposits' card in place of the 2nd Stage II card. (New Deck Order: 111-2S22-33333, where S is the Salt Deposits card. <escalation> ignores S.)",[yn.Now]:async({$:e})=>{for(let a=1;a<=4;a+=1){1!==e.nthCardOfStage(a,2).length&&await e.insertInvaderCard(2===a?bw.SaltDeposits:bw.Stage2CardExceptCoastalAndSaltDeposits,{isSpecial:3===a}).insteadOfNthCardOfStage(a,2)}await e.addSubEffect({effectId:wn.UntappedSaltDeposits,[yn.AfterAdvancingCards]:()=>(e.invaderDeckInSlot(Zl.Discard).includes(Wo.SaltDeposits)&&(e.invaderDeckInSlot(Zl.Discard).remove(Wo.SaltDeposits),e.invaderDeckInSlot(Zl.Ravage).insert(Wo.SaltDeposits)),Promise.resolve())})}}]}},{difficulty:9,fearCards:[4,5,4],effect:{name:"Mining Boom (II)",text:"Instead of Mining Boom (I), after the Build Step, on each board: Choose a land with <explorer>: Build there, then Upgrade 1 <explorer>. (Build normally in a Mining land.)",[yn.Now]:async({$:e})=>{e.removeEffectsWithId(wn.MiningBoomI),await e.addSubEffect({effectId:wn.MiningBoomII,[yn.AfterTheNormalBuildStep]:()=>e.doAdversaryActionOnEachBoard({forEach:a=>a.inLandsWith(e.Explorer).pickOne((async a=>{await a.doExtraBuild(),await a.upgrade({amount:1,pieces:e.Explorer})}),{highlightBoards:[a]})}),[yn.GlobalReminder]:()=>({icon:"Build &<br>Upgrade",ongoing:!0,adversary:wg.Saltburg})})}}},{difficulty:10,fearCards:[4,5,4],effect:{name:"The Empire Ascendant",text:"Setup and During the Explore Step: On boards with 3 or fewer <blight>, Add +1 <explorer> in each land successfully explored. (Max. 2 lands per board per Explore Card.)",[yn.Now]:async({$:e})=>{let a=e.boards.map((()=>0));await e.addSubEffect({effectId:wn.TheEmpireAscendant,effects:[{[yn.BeforeResolvingInvaderCard]:()=>(a=e.boards.map((()=>0)),Promise.resolve()),[yn.AfterSuccessfulExplore]:async({land:t})=>{if(e.phase===Wi.InitialExplore||e.phase===Wi.Explore){const n=t.boards().where((t=>t.numberOf(e.Blight)<=3&&a[t.boardIndex]<2));if(n.count>0){for(const e of n.items)a[e.boardIndex]+=1;await t.add(1,e.Explorer)}}},[yn.ExploreOrderMatters]:({card:a})=>e.turn>0&&Mo[a].coastal||Mo[a].terrains.length>1||Mo[a].saltDeposits,[yn.GlobalReminder]:()=>({icon:"0-3 <blight><br>+1 <explorer>",ongoing:!0,adversary:wg.Saltburg})}]})}}}]},Jw={name:"The Kingdom of Scotland",set:a.FeatherAndFlame,levels:[{difficulty:1,fearCards:[3,3,3],effect:{effects:[{name:"Trade Hub",text:"If the number of Coastal lands with <city> is ever greater than (2 x # of boards), the Invaders win.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.TradeHub,[yn.LossCondition]:()=>e.coastalLandsWithCities>=e.maxCoastalLandsWithCities?Ew.TradeHub:null,[yn.GlobalReminder]:()=>({icon:`<city><br>${e.coastalLandsWithCities} / ${e.maxCoastalLandsWithCities}`,ongoing:!0,adversary:wg.Scotland})})}},{name:"Stage II Escalation <escalation><br>Ports Sprawl Outward",text:"On the single board with the most Coastal <town>/<city>, add 1 <town> to the N lands with the fewest <town> (N = # of players.)",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.PortsSprawlOutward,[yn.Escalation]:async({adversary:a,beforeExplore:t,beforeBuilding:n})=>!(a!==wg.Scotland||!t&&!n)&&(await e.doAdversaryAction((()=>e.inBoards().withMost((a=>a.forPiecesThatIs(e.TownOrCity).where((e=>e.location.isCoastal)).count)).pickOne((async a=>{const t=a.inLands();await _r(e.spiritCount,(a=>t.copy().withLeast((a=>a.numberOf(e.Town))).pickOne((async a=>{t.remove(a),await a.add(1,e.Town)}),{prompt:`Pick land to add <town>. ${e.spiritCount-a} left.`})))})))),!0),[yn.GlobalReminder]:()=>({icon:`<escalation><br>+${e.spiritCount} <town>`,ongoing:!0,visible:e.stage===(e.adversaryLeading?.adversary===wg.Scotland?2:3),adversary:wg.Scotland})})}}]}},{difficulty:3,fearCards:[3,4,3],effect:{name:"Trading Port",text:'After Setup, in Coastal lands, Explore Cards add 1 <town> instead of 1 <explorer>. "Coastal Lands" Invader Cards do this for maximum 2 lands per board.',[yn.Now]:async({$:e})=>{let a=e.boards.map((()=>0));await e.addSubEffect({effectId:wn.TradingPort,[yn.BeforeResolvingInvaderCard]:()=>(a=e.boards.map((()=>0)),Promise.resolve()),[yn.AlterInvaderActionInLand]:async({invaderAction:t,land:n})=>{if(t===Hr.Explore&&n.isCoastal&&e.turn>0){const t=n.boards().where((e=>a[e.boardIndex]<2));if(t.count>0){for(const e of t.items)a[e.boardIndex]+=1;return await n.add(1,e.Town),!0}}return!1},[yn.ExploreOrderMatters]:({card:a})=>e.turn>0&&Mo[a].coastal||Mo[a].terrains.length>1||Mo[a].saltDeposits,[yn.GlobalReminder]:()=>({icon:"<explorer>/<town>",ongoing:!0,adversary:wg.Scotland})})}}},{difficulty:4,fearCards:[4,4,3],effect:{name:"Seize Opportunity",effects:[{text:"During Setup, add 1 <city> to land #2.",[yn.Now]:({$:e})=>e.onEachBoard((async a=>{a.ignoreInvaderAndBlightInSetup||await a.inLandNumber(2).add(1,e.City)}))},{text:'Place "Coastal Lands" as the 3rd Stage II Card, and move the two Stage II Cards above it up by one. (New Deck Order: 11-22-1-C2-33333, where C is the Stage II Coastal Lands Card.)',[yn.Now]:async({$:e})=>{for(let a=1;a<=4;a+=1){1!==e.nthCardOfStage(a,2).length&&await e.insertInvaderCard(3===a?bw.CoastalLands:bw.Stage2CardExceptCoastalAndSaltDeposits,{isSpecial:3===a}).insteadOfNthCardOfStage(a,2)}await e.moveNthCardOfStageUpByOne(1,2),await e.moveNthCardOfStageUpByOne(2,2)}}]}},{difficulty:6,fearCards:[4,5,4],effect:{name:"Chart the Coastline",text:"In Coastal lands, Build Cards affect lands without Invaders, so long as there is an adjacent <city>.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.ChartTheCoastline,[yn.BuildCardsAffectLandsWithoutInvaders]:({land:a})=>a.isCoastal&&!a.isIsolated&&a.piecesInAdjacentLands().hasAtLeast(1,(a=>a.isA(e.City)&&!a.location.isIsolated)),[yn.GlobalReminder]:()=>({icon:"<city>",ongoing:!0,adversary:wg.Scotland})})}}},{difficulty:7,fearCards:[5,5,4],effect:{name:"Ambition of a Minor Nation",text:"During Setup, replace the bottom Stage I Card with the bottom Stage III Card. (New Deck Order: 11-22-3-C2-3333)",[yn.Now]:async({$:e})=>{await e.removeBottomMostInvaderCardOfStage(3),await e.insertInvaderCard(bw.Stage3Card,{isSpecial:!0}).justBelowBottomMostOfStage(1),await e.removeBottomMostInvaderCardOfStage(1)}}},{difficulty:8,fearCards:[5,6,4],effect:{name:"Runoff and Bilgewater",[yn.Now]:async({$:e,effect:a,...t})=>{const n={triggerId:e.nextTriggerId(),[yn.Now]:async({action:a})=>{await e.sendEvent({type:fn.GenericSub,text:"Runoff and Bilgewater caused a <blight> to be added to the Ocean."}),await e.doAdversaryAction((async()=>{await a.parentData.runoffOceanBoards.pickOne((async e=>{await e.ocean.addBlight(1,{mayCascade:!1})}))}))}};await e.addSubEffect({effectId:wn.RunoffAndBilgewater,effects:[{text:"After a Ravage Action adds <blight> to a Coastal land, add 1 <blight> to that board's Ocean (without cascading).",[yn.AfterRavagingDamageLand]:async({blightedLands:r})=>{const i=r.filter((e=>e.isCoastal));i.length>0&&(e.action.data.runoffOceanBoards=ad.createCollection(e,Cr(i.flatMap((e=>e.boards().items)))),await e.addTrigger(n,a,t.action))},[yn.GlobalReminder]:()=>({icon:"+1 <blight>",ongoing:!0,adversary:wg.Scotland})},{text:"Treat the Ocean as a Coastal Wetland for this rule and for <blight> removal/movement.",[yn.OceanIsLandForBlight]:()=>!0}]})}}},{difficulty:10,fearCards:[6,6,4],effect:{name:"Exports Fuel Inward Growth",text:"After the Ravage Step, add 1 <town> to each Inland land that matches a Ravage Card and is within <range-1> of <town>/<city>.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.ExportsFuelInwardGrowth,[yn.AfterTheNormalRavageStep]:async()=>{if(e.invaderCardsInVisibleSlot(Zl.Ravage).length>0){const a=[];await e.doAdversaryActionOnEachBoard({withoutAction:!0,forEach:e=>(a.push(e),Promise.resolve())});const t=e.inInlandLands().where((t=>!t.boards().hasOneWhere((e=>!a.includes(e)))&&t.matchesInvaderCards(e.invaderCardsInVisibleSlot(Zl.Ravage),Hr.Ravage)&&(t.has(e.TownOrCity)||!t.isIsolated)&&t.inLandsWithin(1).hasOneWhere((a=>a.has(e.TownOrCity)&&!a.isIsolated))));await e.clickToContinue({highlightLocations:t.items}),await t.forEach((a=>e.doAdversaryAction((async()=>{await a.add(1,e.Town)}),{land:a})),{noOptions:"No Inland land that matches a Ravage Card is within <range-1> of <town>/<city>."})}},[yn.GlobalReminder]:()=>({icon:"<range-1><br>+1 <town>",ongoing:!0,adversary:wg.Scotland})})}}}]},Vw={name:"The Kingdom of Sweden",set:a.Base,levels:[{difficulty:1,fearCards:[3,3,3],effect:{name:"Stage II Escalation <escalation><br>Swayed by the Invaders",text:"After Invaders Explore into each land this Phase, if that land has at least as many Invaders as <dahan>, replace 1 <dahan> with <town>.",[yn.Now]:async({$:e})=>{let a=null;await e.addSubEffect({effectId:wn.SwayedByTheInvaders,[yn.Escalation]:async({card:t,adversary:n,afterExplore:r,beforeExplore:i,afterExploringLand:s})=>{if(n===wg.Sweden){if(i){const n=[...Mo[t].terrains],r=n.length>1;r&&await e.clickToContinue({text:"If the Escalation is specific to a terrain - as with France and Sweden - choose one of the terrain randomly."}),a=n.length>1?await e.drawFrom(n,n.map((e=>Jg[e].text))):n[0],r&&await e.clickToContinue({text:`If the Escalation is specific to a terrain - as with France and Sweden - choose one of the terrain randomly.<br><br>Sweden Escalates in terrain ${Jg[a].text}`})}if(s&&s.terrain===a&&s.the(e.Invader).isAtLeastAsManyAs(e.Dahan)&&await e.doAdversaryAction((async()=>{await s.replaceOne({pieces:e.Dahan,withPiece:Bn.Town})})),r)return!0}return!1},[yn.GlobalReminder]:()=>({icon:"<escalation><br><dahan>=<town>",ongoing:!0,visible:e.stage===(e.adversaryLeading?.adversary===wg.Sweden?2:3),adversary:wg.Sweden})})}}},{difficulty:2,fearCards:[3,3,3],effect:{name:"Heavy Mining",text:"If the Invaders do at least 6 Damage to the land during Ravage, add an extra <blight>. The additional <blight> does not destroy <presence> or cause cascade.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.HeavyMining,[yn.ExtraBlightFromDamage]:({damageExceedingHealth:e})=>e>=4?1:0,[yn.GlobalReminder]:()=>({icon:"6+ <damage><br>+1 <blight>",ongoing:!0,adversary:wg.Sweden})})}}},{difficulty:3,fearCards:[3,4,3],effect:{name:"Population Pressure at Home",text:"During Setup, on each board add 1 <city> to land #4. On boards where land #4 starts with <blight>, put that <blight> in land #5 instead.",[yn.Now]:async({$:e})=>{await e.onEachBoard((async a=>{const t=a.inLandNumber(4);a.ignoreInvaderAndBlightInSetup||await t.add(1,e.City),t.has(e.Blight)&&await t.move({pieces:e.Blight,movement:Fr.Relocate,locations:{target:Jn.ToThisLocation,location:a.inLandNumber(5)}})}))}}},{difficulty:5,fearCards:[3,4,3],effect:{name:"Fine Steel for Tools and Guns",text:"<town> deal 3 Damage. <city> deal 5 Damage.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.FineSteelForToolsAndGuns,[yn.AdjustDamage]:({piece:a})=>(a.isA(e.Town)?1:0)+(a.isA(e.City)?2:0),[yn.GlobalReminder]:()=>({icon:"<town>=3<br><city>=5",ongoing:!0,adversary:wg.Sweden})})}}},{difficulty:6,fearCards:[3,4,4],effect:{name:"Royal Backing",text:"During Setup, after adding all other Invaders, discard the top card of the Invader Deck. On each board, add 1 <town> to the land of that terrain with the fewest Invaders.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.RoyalBacking,[yn.OnSetupAfterAddingInvaders]:async()=>{await e.setPhase(Wi.RoyalBacking);const a=await e.accelerateTheInvaderDeck();await e.onEachBoard((async t=>{t.ignoreInvaderAndBlightInSetup||await t.inLandsWhere((e=>e.matchesInvaderCard(a,Hr.Explore))).withLeast((a=>a.numberOf(e.Invader))).pickOne((async a=>{await a.add(1,e.Town)}),{highlightBoards:[t],card:a})})),e.removeThisEffect()}})}}},{difficulty:7,fearCards:[4,4,4],effect:{name:"Mining Rush",text:"When Ravaging adds at least 1 <blight> to a land, also add 1 <town> to an adjacent land without <town>/<city>. Cascading <blight> does not cause this effect.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.MiningRush,[yn.WhenAddingBlight]:async({land:a,blightedLands:t,isCascade:n,fromRavage:r})=>{r&&!n&&t.length>0&&!a.isIsolated&&a.hasAdjacentLandWhere((a=>a.doesntHave(e.TownOrCity)&&!a.isIsolated))&&await e.doAdversaryAction((()=>a.inAdjacentLandsWhere((a=>a.doesntHave(e.TownOrCity))).pickOne((async a=>{await a.add(1,e.Town)}),{noOptions:"No adjacent lands without <town>/<city>."})))},[yn.GlobalReminder]:()=>({icon:"<blight><br>+1 <town>",ongoing:!0,adversary:wg.Sweden})})}}},{difficulty:8,fearCards:[4,4,5],effect:{name:"Prospecting Outpost",text:"During Setup, on each board add 1 <town> and 1 <blight> to land #8. The <blight> comes from the box, not the Blight Card.",[yn.Now]:({$:e})=>e.onEachBoard((async a=>{a.ignoreInvaderAndBlightInSetup||(await a.inLandNumber(8).add(1,e.Town),await e.oneEffectActivates(yn.PreventAddBlightInSetup)||await a.inLandNumber(8).add(1,e.Blight))}))}}]},Yw={[wg.BrandenburgPrussia]:Uw,[wg.Sweden]:Vw,[wg.England]:Gw,[wg.France]:Hw,[wg.Scotland]:Jw,[wg.Habsburg]:jw,[wg.Russia]:qw,[wg.Saltburg]:_w},zw={name:"Blitz",set:a.Base,difficulty:0,rules:[{name:"Blitz",effects:[{text:"All Powers are <fast>.",[yn.Now]:async({$:e})=>{e.eventCardsInDeck.remove(af.Outpaced),e.eventCardsInDeck.remove(af.InvestigationOfDangers),e.eventCardsInDeck.remove(af.SprawlContainedByTheWilds),await e.addSubEffect({effectId:wn.Blitz,[yn.GlobalReminder]:()=>({text:"All Powers are <fast>.<br><br>Powers which were already <fast> (or made <fast>) cost 1 less Energy. (For Innate Powers and Power Cards costing 0, instead gain 1 Energy.)",icon:"Powers<br><fast>",ongoing:!0,scenario:Rd.Blitz}),[yn.MayChangeSpeedOfPower]:({power:e})=>e.isSlow,[yn.ChangeSpeedOfPower]:async({power:e})=>{await e.makeFast()},[yn.PreventSlowPowers]:()=>!0,[yn.AfterChangingSpeed]:async({power:a,speed:t,effect:n})=>{t===rr.Fast&&"Blitz"!==n?.name&&(await e.sendEvent({type:fn.GenericSub,text:`${a.owner.nameLink} gained 1 Energy for making a Power fast.`}),await a.owner.gainEnergy(1))},[yn.BeforeResolvingInnate]:async({power:a})=>{a.data.speed===rr.Fast&&(await e.sendEvent({type:fn.GenericSub,text:`${a.owner.nameLink} gained 1 Energy for playing a fast innate.`}),await a.owner.gainEnergy(1))}})}},{text:"When Exploring, once per board, add an additional <explorer>.",[yn.Now]:async({$:e})=>{let a=e.boards.map((()=>0));await e.addSubEffect({effectId:wn.Blitz,[yn.GlobalReminder]:()=>({icon:"+1 <explorer>",ongoing:!0,scenario:Rd.Blitz}),[yn.AfterSuccessfulExplore]:async({land:t})=>{const n=t.boards().where((e=>a[e.boardIndex]<1));if(n.count>0){for(const e of n.items)a[e.boardIndex]+=1;await t.add(1,e.Explorer)}},[yn.AfterResolvingExploreCard]:()=>(a=e.boards.map((()=>0)),Promise.resolve()),[yn.ExploreOrderMatters]:()=>!0})}},{text:'If the Island becomes "Blighted", put 1 less <blight> per player on the Blight Card.',[yn.Now]:async({$:e})=>{e.config.blightCards&&await e.addSubEffect({effectId:wn.Blitz,[yn.BeforeRevealingBlightCard]:async()=>{e.blightStatus===og.BlightedIsland&&await e.removeBlightFromBlightCard(e.boardCount)},[yn.AfterDrawingBlightCard]:()=>(e.blightStatus===og.BlightedIsland&&e.removeThisEffect(),Promise.resolve())})}},{text:"Put an additional <blight> per player on the Blight Card.",[yn.Now]:async({$:e})=>{await e.addSubEffectUntilEndOfTurn({[yn.BeforeSetupPresence]:async()=>{await e.clickToContinue(),await e.addBlightToBlightCard(e.boardCount)}})}},{text:"The Invaders get an additional set of actions at the end of Setup. (So they will Explore, then Build and Explore.)",[yn.Now]:async({$:e})=>{await e.addSubEffectUntilEndOfTurn({[yn.OnSetupAfterAddingInvaders]:async()=>{await e.clickToContinue(),await e.build(),await e.doEffects(yn.AfterTheNormalBuildStep),await e.explore(),await e.advanceInvaderCards()}})}}]}]},Qw={name:"Dahan Insurrection",set:a.Base,difficulty:4,rules:[{effects:[{name:"Constant Raiding",text:"Whenever <dahan> move from one land to another, each <dahan> that moved does 1 Damage in their land. (Damage happens after fully resolving the Power or other effect which moved them. If a Power moves a <dahan> multiple times, it only does damage in the land where it ends up.)",[yn.Now]:async({$:e,...a})=>{const t={triggerId:e.nextTriggerId(),[yn.Now]:async({action:a})=>{const t=a.parentData.movedDahan;await id.createCollection(e,Cr(t.filter((e=>e.isAlive&&void 0!==e.location)).map((e=>e.location)))).selectOrder().forEach((async a=>{await e.doScenarioAction((async()=>{await a.damage(t.filter((e=>e.location===a)).length)}))}),{autoPlayOneOption:!0})}};await e.addSubEffect({effectId:wn.DahanInsurrection,[yn.GlobalReminder]:()=>({icon:"<dahan><br>1 <damage>",scenario:Rd.DahanInsurrection,ongoing:!0}),[yn.AfterMoving]:async n=>{n.piece.isA(e.Dahan)&&n.destination!==n.source&&n.movement!==Fr.Relocate&&(e.action.data.movedDahan=e.action.data.movedDahan??[],e.action.data.movedDahan.includes(n.piece)||e.action.data.movedDahan.push(n.piece),await e.addTrigger(t,a.effect,a.action,{priority:!0,movingAction:e.action}))}})}},{name:"Military Response",text:"Whenever a <city> is destroyed, add 1 <town> to the nearest land with <dahan>.<br>Whenever a <town> is destroyed, add 1 <explorer> to the nearest land with <dahan>.<br><br>(Add the new Invaders after fully resolving the Power or effect which destroyed the old one.)",[yn.Now]:async({$:e,...a})=>{const t={triggerId:e.nextTriggerId(),[yn.Now]:async({action:a})=>{const t=a.parentData.destroyedInvaders;await e.doScenarioAction((async()=>{for(const a of t)await e.inLandsWith(e.Dahan).withLeast((e=>e.distanceToLocation(a.location))).pickOne((async t=>{await t.add(1,a.piece.isA(e.City)?e.Town:e.Explorer)}))}))}};await e.addSubEffect({effectId:wn.DahanInsurrection,[yn.GlobalReminder]:()=>({icon:"+1 <explorer>/<town>",scenario:Rd.DahanInsurrection,ongoing:!0}),[yn.AfterRemovePiece]:async n=>{n.piece.isA(e.TownOrCity)&&pr[n.removement].isDestroyLike&&(e.action.data.destroyedInvaders=e.action.data.destroyedInvaders??[],e.action.data.destroyedInvaders.push(n),await e.addTrigger(t,a.effect,a.action))}})}}]},{name:"Coordinated Insurrection",effects:[{text:'If you reach Terror Level "Victory", <dahan> immediately Damage Invaders in every land of the board, as if they were fighting back after a Ravage. If this doesn\'t fulfill the Victory condition on this card, you lose.',[yn.Now]:async({$:e,...a})=>{const t={triggerId:e.nextTriggerId(),[yn.Now]:async()=>{await e.inLandsWith(e.Dahan).selectOrder().forEach((a=>e.doScenarioAction((async()=>{const e=a.participatingDahan().sum((e=>e.strengthDuringRavage));if(e>0){const t=e+a.sumAdjustedCollectiveDahanRavageDamage;await a.damage(t,Qn.Invader)}}))))}};await e.addSubEffect({effectId:wn.DahanInsurrection,[yn.AfterReachingTerrorLevel]:async({terrorLevel:n})=>{4===n&&await e.addTrigger(t,a.effect,a.action)}})}}]},{name:"Victory",effects:[{text:"The normal Fear-based Victory is not available.<br><br>Terror 2 Victory: There are no lands where <town>/<city> outnumber <dahan><br>Terror 3+ Victory: There is fewer than 1 land per player where <town>/<city> outnumber <dahan>.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.DahanInsurrection,[yn.GlobalReminder]:()=>({icon:`<town>/<city><br>${e.landCountWhereTownsAndCitiesOutnumberDahan} / ${e.terrorLevel<3?0:e.spiritCount-1}`,scenario:Rd.DahanInsurrection,ongoing:!0}),[yn.RemoveFearBasedVictory]:()=>!0,[yn.WinCondition]:()=>{if(2===e.terrorLevel){if(0===e.landCountWhereTownsAndCitiesOutnumberDahan)return Dw.DahanInsurrectionLevelTwo}else if(e.terrorLevel>=3&&e.landCountWhereTownsAndCitiesOutnumberDahan<e.spiritCount)return Dw.DahanInsurrectionLevelThree;return null},[yn.LossCondition]:()=>4===e.terrorLevel&&e.landCountWhereTownsAndCitiesOutnumberDahan>=e.spiritCount?Ew.DahanInsurrectionLevelThree:null})}}]},{name:"Additional Loss Condition",effects:[{name:"Dahan Insurrection",text:"Invaders win if there are ever fewer than 2 <dahan> per player left alive.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.DahanInsurrection,[yn.LossCondition]:()=>e.dahanCount<2*e.spiritCount?Ew.DahanInsurrectionTooFewDahan:null,[yn.GlobalReminder]:()=>({icon:`<dahan><br>${e.dahanCount} / ${2*e.spiritCount-1}`,scenario:Rd.DahanInsurrection,ongoing:!0})})}}]}]},Kw={name:"Guard the Isle's Heart",set:a.Base,difficulty:0,rules:[{name:"Inner Lands",effects:[{text:"There is 1 Inner land on each board.",[yn.Now]:async({$:e})=>{await e.addSubEffectUntilEndOfTurn({[yn.OnSetupAfterAddingInvaders]:async()=>{await e.addSubEffect({text:"After all other Setup: Remove all <town>.",[yn.Now]:async()=>{await e.clickToContinue(),await e.forPiecesThatIs(e.Town).forEach((async e=>{await e.remove(Nn.Silent)}))}}),await e.onEachBoard((async a=>{const t=e.spiritCount<=2?a.inLandsWhere((e=>e.hasNumber(7))):a.inInlandLands();await t.autoPickOne((async t=>{await e.addEffect({[yn.LossCondition]:()=>e.turn>1&&t.has(e.TownOrCity)?Ew.GuardTheIslesHeart:null,[yn.Reminder]:e=>e===t?"Anytime after Turn 1: Invaders win if there is a <town>/<city> in an Inner land.":void 0,[yn.StartOfSpiritPhase]:()=>(e.checkIfEnded(),Promise.resolve())}),await e.addSubEffect({effectId:wn.GuardTheIslesHeart,text:"After all other Setup: In each Inner land (see left side), add 1 <explorer> and 1 <presence> from the player starting on that board. If this is illegal, as for Ocean's Hungry Grasp, add the <presence> in the nearest legal land on that board.)",[yn.Now]:async()=>{await t.add(1,e.Explorer),await e.spiritsWhich((e=>e.startingBoard===a)).forEach((async n=>{e.someEffect(yn.PreventAddPresence,{spirit:n,location:t,ignoreLandType:!1})?await a.inCoastalLands().withLeast((e=>e.distanceToLocation(t))).autoPickOne((async e=>{await n.addPresence({locations:Jn.AnyLands,filter:a=>a===e,forcedFromTrack:!0,autoPlayOneOption:!0})})):await n.addPresence({locations:Jn.AnyLands,filter:e=>e===t,forcedFromTrack:!0,autoPlayOneOption:!0})}))}})}),{highlightBoards:[a],prompt:`In Board: ${a.name}: Pick inner land.`})}))}})}}]},{name:"Setup Changes",effects:[{text:"Each Spirit starts with 2 additional Power Cards by drawing a single card from each of the Power Decks.",[yn.Now]:async({$:e})=>{await e.addSubEffectUntilEndOfTurn({effectId:wn.GuardTheIslesHeart,[yn.OnSetupAfterAddingInvaders]:async()=>{await e.eachSpirit((async a=>{await e.doScenarioAction((async()=>{await a.gainPowerCard({powerType:Sn.Minor,drawAmount:1,taken:!0}),await a.gainPowerCard({powerType:Sn.Major,withoutForgetting:!0,drawAmount:1,taken:!0})}))}))}})}}]}]},Xw={name:"Rituals of Terror",set:a.Base,difficulty:3,rules:[{name:"Rituals of Terror",effects:[{text:"Terror Levels are not earned via <fear>, but by the Ritual of Terror.<br>Do not resolve earned Fear Cards during the Invader Phase.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.RitualsOfTerror,[yn.PreventTerrorLevelAndResolveFearCards]:()=>!0,[yn.GlobalReminder]:()=>({icon:"Terror<br>Levels",scenario:Rd.RitualsOfTerror,ongoing:!0})})}},{text:"During either the <fast> or <slow> Phase, the Spirits may perform the Ritual of Terror if:<br><bullet> There is a land with at least 1 <presence> from each Spirit.<br><bullet> That land has at least 3 <dahan> per player.<br><bullet> The Spirits collectively spend 3 Energy total and destroy 3 <presence> total in that land.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.RitualsOfTerror,[yn.GlobalReminder]:()=>({icon:"Ritual<br>Terror",scenario:Rd.RitualsOfTerror,ongoing:!0}),[yn.ExtraAction]:()=>{const a=e.inLandsWhere((a=>a.spiritsWithPresence().count===e.spiritCount&&a.numberOf(e.Presence)>=3&&a.numberOf(e.Dahan)>=3*e.spiritCount&&e.playersCanJointlyPayEnergyAidedBy({energy:3})));return(e.phase===Wi.FastPowers||e.phase===Wi.SlowPowers)&&a.count>0?{actionId:"RitualOfTerror",name:"Ritual of Terror",text:"When the Ritual of Terror is performed:<br><bullet> Earn the next Terror Level. (This may be VICTORY on your third Ritual.)<br><bullet> Resolve all earned Fear Cards (at the new Terror Level).<br><bullet> Push all <dahan> from the land where the Ritual was performed, distributing them as evenly as possible among all adjacent lands.",scenario:Rd.RitualsOfTerror,[yn.Now]:async()=>{await a.pickOne((async a=>{await e.doSpiritAction((async()=>{await e.addSubEffect({effects:[{text:"The Spirits collectively spend 3 Energy total.",[yn.Now]:async()=>{await e.clickToContinue(),await e.payEnergyJointlyAidedBy({energy:3*e.spiritCount})}},{text:"Destroy 3 <presence> total in that land.",[yn.Now]:async()=>{await a.destroy({amount:3,pieces:Qn.Presence})}},{text:"Earn the next Terror Level. (This may be VICTORY on your third Ritual.)",[yn.Now]:async()=>{await e.clickToContinue(),await e.earnTerrorLevel(),e.terrorLevel<=3&&e.putAllFearCardsIntoLevel(e.terrorLevel)}},{text:"Push all <dahan> from the land where the Ritual was performed, distributing them as evenly as possible among all adjacent lands.",[yn.Now]:async()=>{await a.push({pieces:e.Dahan,quantifier:lr.All,evenly:!0})}}]})}))}),{prompt:"Pick a land to perform Ritual of Terror"})}}:null}})}},{text:"Resolve all earned Fear Cards (at the new Terror Level).",[yn.Now]:async({$:e})=>{await e.addSubEffect({[yn.AfterReachingTerrorLevel]:async()=>{await e.resolveFearCards()}})}},{text:"Put all Fear Cards into the Fear Deck. If you run out, earn no more Fear Cards.",[yn.Now]:({$:e})=>(e.putAllFearCardsIntoLevel(1),Promise.resolve())}]}]},Zw={name:"Bronze Loop",actionId:"BronzeLoop",description:"A loop of twisted bronze set with deep red stones",icon:"Bronze<br>Loop",invaderBenefit:[{text:"For purposes of Explore and Build, Invaders in any Sands are considered to be in all Sands.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffect({effectId:wn.BronzeLoopInvader,[yn.GlobalReminder]:()=>({icon:"<sands>",ongoing:!0,scenario:Rd.PowersLongForgotten}),[yn.BuildOrderMatters]:()=>!0,[yn.LandIsExploringSource]:({land:a})=>a.isSands&&e.inLandsWhere((e=>e.isSands)).hasOneWhere((a=>a.has(e.TownOrCity))),[yn.BuildCardsAffectLandsWithoutInvaders]:({land:a})=>a.isSands&&e.inLandsWhere((e=>e.isSands)).hasOneWhere((e=>e.hasInvaders)),[yn.AdjustBuildPlans]:({land:a})=>{if(a.isSands){return e.forPiecesThatIs(e.Town).where((e=>e.location.isSands)).count>e.forPiecesThatIs(e.City).where((e=>e.location.isSands)).count?e.City:e.Town}return!1}})}}],spiritBenefit:[{text:"Spirits may shift their <presence> from a Sands to another at any time.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.BronzeLoopSpirit,[yn.GlobalReminder]:()=>({icon:"<presence><br><sands>",ongoing:!0,scenario:Rd.PowersLongForgotten}),[yn.ExtraAction]:()=>({actionId:"BronzeLoop",name:"Bronze Loop",text:"Spirits may shift their <presence> from a Sands to another at any time.",scenario:Rd.PowersLongForgotten,[yn.Now]:async()=>{await e.forPiecesThatIs(e.Presence).where((e=>e.location.isSands)).pickOne((async a=>{await e.doScenarioAction((async()=>{await a.move({locations:{target:Jn.AnyLands},destinationFilter:e=>e.isSands,movement:Fr.Relocate})}))}),{prompt:"Pick <presence> to Relocate."})}})})}}]},ey={name:"Glowing Ember",actionId:"GlowingEmber",description:"A fist-sized ember, glowing steadily",icon:"Glowing<br>Ember",invaderBenefit:[{text:"Whenever a <town>/<city> is added to a Jungle or Wetland without <town>/<city>, also add 1 <blight>.",[yn.Now]:async({$:e})=>{await e.clickToContinue(),await e.addSubEffect({effectId:wn.GlowingEmberInvader,[yn.GlobalReminder]:()=>({icon:"<jungles-wetlands><br>+1 <blight>",ongoing:!0,scenario:Rd.PowersLongForgotten}),[yn.AfterAddingPiece]:async({land:a,additions:t})=>{a.isJungleOrWetlands&&a.hasExactly(1,e.TownOrCity)&&t.some((a=>a.piece.isA(e.TownOrCity)))&&(await e.clickToContinue({highlightLocations:[a]}),await e.doScenarioAction((async()=>{await a.addBlight(1)})))}})}}],spiritBenefit:[{text:"Spirits do not need to Forget when gaining a Major Power.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.GlowingEmberSpirit,[yn.GlobalReminder]:()=>({icon:"Skip<br>Forget",ongoing:!0,scenario:Rd.PowersLongForgotten}),[yn.PreventForgetPowercard]:async a=>{if(a.duringPowerGain){return!await e.may({card:a.power.power,prompt:`Forget ${a.power.powerLink}?`})}return!1}})}}]},ay={name:"Jagged Tooth",actionId:"JaggedTooth",description:"An enormous jagged tooth, dripping water",icon:"Jagged<br>Tooth",invaderBenefit:[{text:"Whenever Invaders Explore into Wetlands they immediately Build there.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.JaggedToothInvader,[yn.GlobalReminder]:()=>({icon:"<wetlands><br>Build",ongoing:!0,scenario:Rd.PowersLongForgotten}),[yn.AfterSuccessfulExplore]:async({land:e})=>{e.isWetlands&&await e.doExtraBuild()}})}}],spiritBenefit:[{text:"Each Spirit gains +2 Energy during any Spirit Phase that they do not Reclaim any cards.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.JaggedToothSpirit,[yn.GlobalReminder]:()=>({icon:"Extra<br>Energy",ongoing:!0,scenario:Rd.PowersLongForgotten}),[yn.BeforePlayPowers]:async()=>{await e.eachSpirit((async a=>{a.hasReclaimedACardDuringSpiritPhase||(await e.sendEvent({type:fn.GenericMain,text:`${a.nameLink} did not Reclaim any cards during the Spirit Phase.`}),await e.doScenarioAction((async()=>{await a.gainEnergy(2)})))}))}})}}]},ty={name:"Leather Sack",actionId:"LeatherSack",description:"A leather sack with its mouth sewn shut",icon:"Leather<br>Sack",invaderBenefit:[{text:"Leave the token in the land where it was found. This land cannot be targeted by Powers for the rest of the game.",[yn.Now]:async({$:e})=>{const a=e.forPiecesThatIs(e.HiddenLocation).where((e=>8===e.scenarioNumber)).anyOne.location;await e.clickToContinue(),await e.addSubEffect({[yn.Reminder]:e=>e===a?"This land cannot be targeted by Powers for the rest of the game.":void 0,[yn.PreventTargetLand]:({land:e})=>e===a})}}],spiritBenefit:[{text:"Now: Choose 1 land. Remove everything in it from the game.",[yn.Now]:async({$:e})=>{await e.inLands().pickOne((async a=>{await e.doScenarioAction((async()=>{await a.remove({quantifier:lr.All,pieces:Qn.AllPieces,removement:Nn.RemoveFromGame})}))}))}}]},ny={name:"A lizard's scale",actionId:"LizardsScale",description:"A lizard's scale, perpetually burning",icon:"Lizard's<br>Scale",invaderBenefit:[{text:"Powers granting <fire> don't Damage/Destroy Invaders unless the Spirit spends an additional Energy. (Per Power)",[yn.Now]:async({$:e})=>{const a=Re.box(!1),t=async()=>!(void 0===e.action.power||void 0===e.action.spirit||void 0===sg[e.action.power.power].elements||!sg[e.action.power.power].elements.includes(nr.Fire)||a.get())&&(0===e.action.spirit.energy||!await e.may({text:"Pay 1 Energy to Damage/Destroy Invaders using a Power granting <fire>?"})||(await e.action.spirit.payEnergy(1),a.set(!0),await e.addEffectUntilEndOfAction({[yn.ActionEnds]:()=>(a.set(!1),Promise.resolve())}),!1));await e.addSubEffect({effectId:wn.LizardsScaleInvader,[yn.GlobalReminder]:()=>({icon:"<fire><br>No <damage>",ongoing:!0,scenario:Rd.PowersLongForgotten}),[yn.PreventRemovePiece]:({piece:e,removement:a})=>pr[a].isDestroyLike&&e.isInvader?t():Promise.resolve(!1),[yn.PreventDamagingPiece]:({piece:e})=>e.isInvader?t():Promise.resolve(!1)})}}],spiritBenefit:[{text:"Damage-dealing Powers granting <fire> do +1 Damage. (Total bonus per Power.)",[yn.Now]:async({$:e})=>{await e.gainDamageBoost({effectId:wn.LizardScaleSpirit,amount:1,permanent:!0,scenario:Rd.PowersLongForgotten,filter:()=>void 0!==e.action?.power&&void 0!==sg[e.action.power.power].elements&&sg[e.action.power.power].elements.includes(nr.Fire)})}}]},ry={name:"Pillar of Sunlight",actionId:"PillarOfSunlight",description:"A spear-like pillar of sunlight too hot to approach",icon:"Pillar<br>Sunlight",invaderBenefit:[{text:"Now: On each board, in the land with the most <town>/<city> (minimum 1): Destroy all <dahan> and Spirit tokens. Add 1 <blight>.",[yn.Now]:async({$:e})=>{await e.doScenarioActionOnEachBoard((async a=>{await a.inLandsWithMostMinimumOne(e.TownOrCity).pickOne((async a=>{await e.doScenarioAction((async()=>{await a.destroyAll(e.Dahan),await a.destroyAll(e.BadlandsBeastsDiseaseOrWilds),await a.destroyAll(e.Quake),await a.destroyAll(e.Vitality),await a.destroyAll(e.Deeps),await a.removeAllStrife(),await a.addBlight(1)}))}),{noOptions:`On board ${a.name}: No lands with <town>/<city>.`})}),{selectOrder:!0})}}],spiritBenefit:[{text:"Now: Earn 2 Fear Cards. <dahan> in 1 land deal Damage.",[yn.Now]:async({$:e})=>{await e.doScenarioAction((async()=>{await e.earnFearCard(),await e.earnFearCard(),await e.inLandsWithAllOf(e.Dahan,e.Invader).pickOne((async a=>{const t=a.piecesThatAre(e.Dahan).sum((e=>e.strengthOutOfRavage));await a.damage(t)}))}))}}]},iy={1:ny,2:Zw,3:ay,4:{name:"Rib-bone",actionId:"RibBone",description:"A rib-bone crusted with unmelting ice",icon:"Rib<br>bone",invaderBenefit:[{text:"Next turn: Spirits get only 1 Card Play.",[yn.Now]:async({$:e})=>{const a=e.turn+1;await e.addSubEffect({effectId:wn.RibBoneInvader,[yn.GlobalReminder]:()=>({icon:"1 Card<br>Play",scenario:Rd.PowersLongForgotten}),[yn.AdjustCardPlays]:()=>e.turn===a?1:0,[yn.TimePasses]:()=>(e.turn>=a&&e.removeThisEffect(),Promise.resolve())})}}],spiritBenefit:[{text:"During the next normal Ravage: Invaders do -3 Damage per land.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.RibBoneSpirit,[yn.AdjustCollectiveInvaderRavageDamage]:({normal:e})=>e?-3:0,[yn.AfterResolvingRavageCard]:()=>(e.removeThisEffect(),Promise.resolve()),[yn.GlobalReminder]:()=>({icon:"Ravage<br>-3 <damage>",scenario:Rd.PowersLongForgotten})})}}]},5:ey,6:{name:"Wind-woven Rope",actionId:"WindWovenRope",description:"A rope woven out of the wind",icon:"Wind<br>Rope",invaderBenefit:[{text:"Powers do not Gather/Push Invaders unless the Spirit spends an extra Energy. (Per Power)",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.WindWovenRopeInvader,[yn.GlobalReminder]:()=>({icon:"Gather<br>Push",ongoing:!0,scenario:Rd.PowersLongForgotten}),[yn.PreventMovePiece]:({piece:a,movement:t})=>!e.action.data.paidForPushing&&a.isInvader&&(t===Fr.Push||t===Fr.Gather),[yn.AfterTargetingLands]:async()=>{!e.action.data.paidForPushing&&void 0!==e.action.spirit&&void 0!==e.action.power&&sg[e.action.power.power].hasPushOrGather&&e.action.spirit.energy>0&&await e.may({text:"Pay 1 Energy to possibly Gather/Push Invaders using this Power?"})&&(await e.action.spirit.payEnergy(1),e.action.data.paidForPushing=!0)}})}}],spiritBenefit:[{text:"All Powers have <range+1>.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.WindWovenRopeSpirit,[yn.GlobalReminder]:()=>({icon:"<range+1>",ongoing:!0,scenario:Rd.PowersLongForgotten}),[yn.ExtraRange]:()=>void 0!==e.action.power?1:0})}}]},7:ry,8:ty},sy={name:"Powers Long Forgotten",set:a.BranchAndClaw,difficulty:1,rules:[{text:"Whenever a land has 3 <dahan> or more in it, the players search it.<br>Whenever a land has 2 Invaders or more, the Invaders search it.",[yn.Now]:async({$:e})=>{const a=[1,2,3,4,5,6,7,8];let t=Math.min(e.boardCount+1,8),n=4*e.boardCount-t;const r=e.adversaryLeading?.adversary===wg.France||e.adversarySupporting?.adversary===wg.France?3:2,i=async i=>{i.has(e.HiddenLocation)&&await i.piecesThatAre(e.HiddenLocation).forEach((async s=>{if(void 0===s.scenarioNumber){const o=i.hasAtLeast(3,e.Dahan),d=i.hasAtLeast(r,e.Invader);if(o||d){const r=[...[...Array(n).keys()].map((()=>"Blank")),...[...Array(t).keys()].map((()=>"Number"))];if("Number"===await e.drawFrom(r,r)){t-=1;const n=await e.drawFrom(a,a.map((e=>`${e}`))),r=iy[n];if(s.scenarioNumber=n,s.placeInGroup(),await e.clickToContinue({highlightPieces:[s],text:`The ${o?"Dahan":"Invaders"} searched the Hidden Location and found a Source of Power!<br><br>${r.description}.`}),o){const a=`${r.description}.<br><br>When used:<br>${r.spiritBenefit[0].text}<br><br>If never used:<br>+2 Points`;await e.addSubEffect({name:r.name,text:a,[yn.GlobalReminder]:()=>({icon:r.icon,ongoing:!0,scenario:Rd.PowersLongForgotten}),[yn.ExtraAction]:({effect:a})=>({actionId:r.actionId,name:r.name,[yn.Now]:async()=>{e.removeEffect(a),await e.addSubEffect({effects:r.spiritBenefit})}}),[yn.ExtraScore]:()=>2})}else await e.addSubEffect({name:r.name,effects:r.invaderBenefit});await s.remove()}else n-=1,s.scenarioNumber=0,s.placeInGroup(),await e.clickToContinue({highlightPieces:[s],text:`The ${o?"Dahan":"Invaders"} searched the Hidden Location but found no Source of Power.`}),await s.remove()}}}))};await e.addSubEffect({effectId:wn.PowersLongForgotten,[yn.OnSetupAfterAddingInvaders]:async()=>{await e.onEachBoard((async a=>{await a.inLandsWhere((a=>a.doesntHave(e.Dahan))).pickMultiple({amount:4,autoplayIfPickingAll:!0,forPickedItem:async a=>{await a.add(1,e.HiddenLocation),await i(a)}})}))},[yn.AfterMoving]:async({piece:a,source:t,destination:n})=>(a.isOneOf(e.Dahan,e.Invader)&&(await i(t),await i(n)),Promise.resolve()),[yn.AfterAddingPiece]:async({additions:a})=>{if(a.some((a=>a.piece.isOneOf(e.Dahan,e.Invader))))for(const e of Cr(a.map((e=>e.location))))await i(e);return Promise.resolve()}})}}]},oy=async({$:e,piece:a})=>{if(a.isInvader&&e.action.type!==Ho.GameAction&&!a.location.forPiecesWithin(1,null,{mayIncrease:!1}).hasOneWhere((a=>a.isA(e.FlameMarker)))&&!e.action.data.hasPaidForDestruction){if(void 0!==e.action.spirit&&e.action.spirit.energy>=2){if(!e.action.data.hasDeniedPayingForDestruction&&await e.may({highlightLocations:[a.location],prompt:"Pay 2 Energy to do Damage/Destruction in this land?"}))return await e.action.spirit.payEnergy(2),e.action.data.hasPaidForDestruction=!0,!1;e.action.data.hasDeniedPayingForDestruction=!0}else await e.clickToContinue();return!0}return!1},dy={name:"Rituals Of The Destroying Flame",set:a.BranchAndClaw,difficulty:3,rules:[{name:"Invader Immunity",effects:[{text:"Whenever anything would Damage or Destroy Invaders, ignore that Damage/Destruction unless either:<br><br>There is a Flame Marker within <range-1>.<or>The Spirit using the Power or ability pays 2 Energy.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.RitualsOfTheDestroyingFlame,[yn.GlobalReminder]:()=>({icon:"Invader<br>Immunity",ongoing:!0,scenario:Rd.RitualsOfTheDestroyingFlame}),[yn.PreventDamagingPiece]:({piece:a})=>oy({$:e,piece:a}),[yn.PreventRemovePiece]:({piece:a,removement:t})=>Promise.resolve(pr[t].isDestroyLike&&oy({$:e,piece:a}))})}},{name:"Ritual of the Destroying Flame",text:"Each turn, after all Growth is done, one or more Spirits may perform the Ritual of the Destroying Flame.<br><br>(See Scenario Card for details.)",[yn.Now]:async({$:e})=>{await e.eachSpirit((async a=>{await a.addExtraAction({actionId:`RitualOfTheDestroyingFlame${a.spirit}`,icon:"Ritual",enabled:()=>e.phase===Wi.GainEnergy&&a.powersWhere((e=>e.data.elements?.includes(nr.Fire)??!1)).count>0,onActivate:async()=>{await e.addSubEffect({effects:[{text:"Each Spirit performing the Ritual Forgets a Power Card that grants <fire>.",[yn.Now]:async()=>{await a.forgetPowers({filter:e=>e.data.elements?.includes(nr.Fire)??!1})}},{text:"Each Spirit performing the Ritual chooses a land where they have <presence>. Add a Flame Marker and 1 <blight> to that land. (This destroys <presence> normally.)",[yn.Now]:async()=>{await a.inLands().pickOne((async t=>{await a.doSpiritAction((async()=>{await t.add(1,e.FlameMarker),await t.addBlight(1),await e.addSubEffect({effects:[{text:"Gain Energy equal to the current Invader Stage.",[yn.Now]:async()=>{await e.clickToContinue({noOptions:`Stage ${e.stage} = ${e.stage} Energy.`}),await a.gainEnergy(e.stage)}},{text:"If there are Invaders in that land, do <fear> equal to the current Invader Stage, and 1 Damage per <dahan> present.",[yn.Now]:async()=>{t.hasInvaders?(await e.clickToContinue({noOptions:`Stage ${e.stage} = ${e.stage} <fear>.`}),await t.fear(e.stage),await t.damage(t.numberOf(e.Dahan))):await e.clickToContinue({noOptions:"No Invaders present in land."})}}]})}))}),{prompt:"Pick a land where to add a Flame Marker."})}}]})}})}))}}]}]},cy={name:"Bringer of Dreams and Nightmares",set:a.Base,aspects:[zo.Enticing,zo.Violence],specialRules:[{name:"To Dream a Thousand Deaths",effects:[{[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Bringer,[yn.PreventRemoveBoard]:({removement:t})=>Promise.resolve(e.action.spirit===a&&t===Nn.DirectDestroy)})}},{text:"Your Powers never cause Damage, nor can they Destroy anything other than your own <presence>.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Bringer,[yn.GlobalReminder]:()=>({icon:"Powers<br>No <damage>",ongoing:!0,spirit:a,players:[a]}),[yn.PreventDamagingPiece]:async({piece:t,damage:n})=>e.action.spirit===a&&(await e.waitForAnimationsToFinish(),t.shadowDamage+=n,await e.sendEvent({type:fn.PieceDamaged,amount:n,shadow:!0,location:t.location??void 0,piece:t,pieceType:t.piece}),t.isAlive||await t.destroy(),await e.addEffectUntilEndOfAction({[yn.ActionEnds]:()=>(t.shadowDamage=0,Promise.resolve())}),!0)})}},{[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Bringer,text:`When a Power of yours would Destroy (or deal enough Damage to Destroy) <explorer>/<town>/<city>, generate ${a.aspect===zo.Violence?"1/3/5":"0/2/5"} <fear> instead. The Power Pushes all <explorer>/<town> it would Destroy.`,[yn.GlobalReminder]:()=>({icon:"<fear><br>Push",ongoing:!0,spirit:a,players:[a]}),[yn.PreventRemovePiece]:async({piece:t,removement:n})=>!(e.action.spirit!==a||!pr[n].isDestroyLike||n===Nn.DestroyByHealthChange||t.isAPresenceOf(a))&&(t.shadowDamage=0,t.isA(e.Explorer)?(a.aspect===zo.Violence&&await(t.location?.fear(1)),await t.push()):t.isA(e.Town)?(await(t.location?.fear(a.aspect===zo.Violence?3:2)),await t.push()):t.isA(e.City)&&await(t.location?.fear(5)),!0)})}}]}],pickOptions:[[0,1,2,3]],growthOptions:[{effects:[{text:"Reclaim cards",[yn.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}}]},{effects:[{text:"Reclaim One",[yn.Now]:async({you:e})=>{await e.reclaim(1)}},{text:"Add a <presence> in <range-0>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(0)}}]},{effects:[{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-1>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(1)}}]},{effects:[{text:"Add a <presence> to Land with Dahan or Invaders",[yn.Now]:async({you:e,$:a})=>{await e.addPresenceInRange(4,{filter:e=>e.has(a.Dahan)||e.hasInvaders})}},{text:"Gain +2 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(2)}}]}],tracks:[{energy:2,name:"Top-track: 2 Energy"},{requires:0,elements:[nr.Air],name:"Top-track: Air"},{requires:1,energy:3,name:"Top-track: 3 Energy"},{requires:2,elements:[nr.Moon],name:"Top-track: Moon"},{requires:3,energy:4,name:"Top-track: 4 Energy"},{requires:4,elements:[nr.Any],name:"Top-track: Any"},{requires:5,energy:5,name:"Top-track: 5 Energy"},{cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:7,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:8,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:9,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:10,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:11,elements:[nr.Any],name:"Bottom-track: Any"}],setup:[{text:"Put 2 <presence> on your starting board in the highest-numbered Sands.",[yn.Now]:async({you:e})=>{await e.startingBoard.highestNumberedTerrain(xo.Sands).putPresence(2,e)}}],uniquePowers:[Mi.CallOnMidnightsDream,Mi.DreadApparitions,Mi.DreamsOfTheDahan,Mi.PredatoryNightmares],innatePowers:[Mi.SpiritsMayYetDream,Mi.NightTerrors]},ly={name:"Vital Strength of the Earth",set:a.Base,aspects:[zo.Resilience,zo.Might,zo.Nourishing],specialRules:[{name:"Earth's Vitality",text:"Defend 3 in every land where you have <sacred>.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Earth,[yn.GlobalReminder]:()=>({icon:"Defend<br><sacred>",ongoing:!0,spirit:a,players:[a]}),[yn.DefendFromSpirits]:({land:e})=>e.hasSacredSiteOf(a)?3:0})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[yn.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Add a <presence> in <range-2>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(2)}}]},{effects:[{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-0>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(0)}}]},{effects:[{text:"Add a <presence> in <range-1>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(1)}},{text:"Gain +2 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(2)}}]}],tracks:[{energy:2,name:"Top-track: 2 Energy"},{requires:0,energy:3,name:"Top-track: 3 Energy"},{requires:1,energy:4,name:"Top-track: 4 Energy"},{requires:2,energy:6,name:"Top-track: 6 Energy"},{requires:3,energy:7,name:"Top-track: 7 Energy"},{requires:4,energy:8,name:"Top-track: 8 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:6,cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:7,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:8,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:9,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:10,cardPlays:4,name:"Bottom-track: 4 Card Plays"}],setup:[{text:"Put 3 <presence> on your starting board: 2 in the highest-numbered Mountain, 1 in the highest-numbered Jungle.",[yn.Now]:async({you:e})=>{await e.startingBoard.highestNumberedTerrain(xo.Mountains).putPresence(2,e),await e.startingBoard.highestNumberedTerrain(xo.Jungles).putPresence(1,e)}}],uniquePowers:[Mi.AYearOfPerfectStillness,Mi.DrawOfTheFruitfulEarth,Mi.GuardTheHealingLand,Mi.RitualsOfDestruction],progression:[Mi.RouseTheTreesAndStones,Mi.CallToMigrate,Mi.PoisonedLand,Mi.DevouringAnts,Mi.VigorOfTheBreakingDawn,Mi.VoraciousGrowth,Mi.SavageMawbeasts],innatePowers:[Mi.GiftOfStrength]},hy={name:"A Spread of Rampant Green",set:a.Base,aspects:[zo.Tangles,zo.Regrowth],specialRules:[{name:"Choke the Land with Green",text:"Whenever Invaders would Ravage or Build in a land with your <sacred>, you may prevent it by destroying one of your <presence> in that land.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.GreenChokeTheLandWithGreen,[yn.GlobalReminder]:()=>({icon:"Skip<br><sacred>",ongoing:!0,spirit:a,players:[a]}),[yn.PreventInvaderActionInLand]:async({land:t,invaderAction:n})=>{let r=!1;return n!==Hr.Ravage&&n!==Hr.Build||!t.hasSacredSiteOf(a)||await e.chooseBetween({highlightLocations:[t],effects:[{actionId:"DestroyPresence",text:"Destroy <presence> to prevent build.",[yn.Now]:async()=>{r=!0,await e.sendEvent({type:fn.GenericMain,text:`Choke the Land with Green used to prevent ${n} in ${t.coordinateLink}.`}),await t.destroy({pieces:e.Presence,owner:a})}},{actionId:"KeepPresence",text:"Keep <presence>."}]}),r}})}},{name:"Steady Regeneration",text:"When adding <presence> to the board via Growth, you may optionally use your destroyed <presence>. If the island is Healthy, do so freely. If the island is Blighted, doing so cost 1 Energy per destroyed <presence> you add.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.GreenSteadyRegeneration,[yn.GlobalReminder]:()=>({icon:"<broken>",ongoing:!0,spirit:a,players:[a]}),[yn.MayGrowWithDestroyedPresence]:async()=>{let t=!1;return await e.chooseBetween({effects:[{actionId:"Broken",label:"Use <broken>.",[yn.Now]:async()=>{t=!0,await e.sendEvent({type:fn.GenericMain,text:"Steady Regeneration used to add <broken>."}),e.blightStatus===og.BlightedIsland&&await a.payEnergy(1)},condition:()=>a.destroyedPresence>0&&(a.energy>0||e.blightStatus===og.HealthyIsland)},{actionId:"Tracks",label:"Use <presence> from tracks."}],autoPlayOneOption:!0}),t}})}}],pickOptions:[[0],[1,2,3]],growthOptions:[{effects:[{text:"Add a <presence> to Jungle or Wetland",[yn.Now]:async({$:e,you:a})=>{const t=await e.oneEffectActivates(yn.MayGrowWithDestroyedPresence);await a.addPresenceInRange(2,{filter:e=>e.isJungleOrWetlands,destroyed:t})}}]},{effects:[{text:"Reclaim cards",[yn.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}}]},{effects:[{text:"Add a <presence> in <range-1>",[yn.Now]:async({$:e,you:a})=>{const t=await e.oneEffectActivates(yn.MayGrowWithDestroyedPresence);await a.addPresence({locations:Jn.WithinRange,range:1,destroyed:t})}},{text:"+1 Card Play This Turn",[yn.Now]:async({you:e})=>{await e.gainCardPlays(1)}}]},{effects:[{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Gain +3 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(3)}}]}],tracks:[{energy:0,name:"Top-track: 0 Energy"},{requires:0,energy:1,name:"Top-track: 1 Energy"},{requires:1,elements:[nr.Plant],name:"Top-track: Plant"},{requires:2,energy:2,name:"Top-track: 2 Energy"},{requires:3,energy:2,name:"Top-track: 2 Energy"},{requires:4,elements:[nr.Plant],name:"Top-track: Plant"},{requires:5,energy:3,name:"Top-track: 3 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:7,cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:8,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:9,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:10,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:11,cardPlays:4,name:"Bottom-track: 4 Card Plays"}],setup:[{text:"Put 2 <presence> on your starting board: 1 in the highest-numbered Wetland, and 1 in the Jungle without any <dahan>.",[yn.Now]:async({$:e,you:a})=>{await a.startingBoard.highestNumberedTerrain(xo.Wetlands).putPresence(1,a),await a.startingBoard.inLandsFilteredByAllInPriority((e=>e.isJungle),(a=>a.doesntHave(e.Dahan))).autoPickOne((async e=>{await e.putPresence(1,a)}))}}],uniquePowers:[Mi.FieldsChokedWithGrowth,Mi.GiftOfProliferation,Mi.OvergrowInANight,Mi.StemTheFlowOfFreshWater],innatePowers:[Mi.CreepersTearIntoMortar,Mi.AllEnvelopingGreen]},uy={name:"Lightning's Swift Strike",set:a.Base,aspects:[zo.Pandemonium,zo.Wind,zo.Immense,zo.Sparking],specialRules:[{name:"Swiftness of Lightning",text:"For every <air> you have, you may use 1 <slow> Power as if it were <fast>. (Power Cards or your Innate Powers.)",[yn.Now]:async({$:e,you:a})=>{const t=Re.box(0);await e.addSubEffect({effectId:wn.Lightning,[yn.GlobalReminder]:()=>({icon:`<fast><br>${t.get()} / ${a.maxElementsWithConvert(nr.Air)}`,ongoing:!0,spirit:a,players:[a]}),[yn.MayChangeSpeedOfPower]:({power:e})=>e.isSlow&&e.owner===a&&a.hasElementsWithConvert({[nr.Air]:t.get()+1}),[yn.ChangeSpeedOfPower]:async({power:a})=>{await a.makeFast(),t.set(t.get()+1),await a.owner.convertElements({[nr.Air]:t.get()}),await e.sendEvent({type:fn.GenericMain,text:`Lightning's Swift Strike used Swiftness of Lightning to make ${a.powerLink} fast.`})},[yn.TimePasses]:()=>(t.set(0),Promise.resolve())})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[yn.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Gain +1 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(1)}}]},{effects:[{text:"Add a <presence> in <range-2>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(2)}},{text:"Add a <presence> in <range-0>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(0)}}]},{effects:[{text:"Add a <presence> in <range-1>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(1)}},{text:"Gain +3 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(3)}}]}],tracks:[{energy:1,name:"Top-track: 1 Energy"},{requires:0,energy:1,name:"Top-track: 1 Energy"},{requires:1,energy:2,name:"Top-track: 2 Energy"},{requires:2,energy:2,name:"Top-track: 2 Energy"},{requires:3,energy:3,name:"Top-track: 3 Energy"},{requires:4,energy:4,name:"Top-track: 4 Energy"},{requires:5,energy:4,name:"Top-track: 4 Energy"},{requires:6,energy:5,name:"Top-track: 5 Energy"},{cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:8,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:9,cardPlays:4,name:"Bottom-track: 4 Card Plays"},{requires:10,cardPlays:5,name:"Bottom-track: 5 Card Plays"},{requires:11,cardPlays:6,name:"Bottom-track: 6 Card Plays"}],setup:[{text:"Put 2 <presence> on your starting board in the highest-numbered Sands.",[yn.Now]:async({you:e})=>{await e.startingBoard.highestNumberedTerrain(xo.Sands).putPresence(2,e)}}],uniquePowers:[Mi.HarbingersOfTheLightning,Mi.LightningsBoon,Mi.RagingStorm,Mi.ShatterHomesteads],progression:[Mi.DelusionsOfDanger,Mi.CallToBloodshed,Mi.Powerstorm,Mi.PurifyingFlame,Mi.PillarOfLivingFlame,Mi.EntrancingApparitions,Mi.CallToIsolation],innatePowers:[Mi.ThunderingDestruction]},gy={name:"Ocean's Hungry Grasp",set:a.Base,aspects:[zo.Deeps],specialRules:[{name:"Ocean in Play",effects:[{text:"You may add/move <presence> into Oceans, but may not add/move <presence> into Inland lands.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Ocean,[yn.GlobalReminder]:()=>({text:"You may add/move <presence> into Oceans, but may not add/move <presence> into Inland lands.<br><br>On boards with your <presence>, treat Oceans as Coastal Wetlands for Powers and <blight>.<br><br>You Drown any Invaders or <dahan> moved to those oceans.",icon:"Oceans<br><wetlands>",ongoing:!0,spirit:a}),[yn.PreventAddPresence]:({spirit:e,location:t,ignoreLandType:n})=>e===a&&t.isInland&&!n,[yn.PreventMovePiece]:({piece:e,destination:t})=>e.isAPresenceOf(a)&&t.isInland})}},{[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Ocean,text:"On boards with your <presence>, treat Oceans as Coastal Wetlands for Powers and <blight>.",[yn.OceanIsLand]:({location:t})=>e.currentActionType===Ho.PowerAction&&t.boardsHasPresenceOf(a),[yn.OceanIsLandForBlight]:({location:e})=>e?.boardsHasPresenceOf(a)??!1,[yn.LocationIsTerrain]:({location:e,terrain:a})=>a===xo.Wetlands&&e.isOceanAndLand,[yn.AfterRemovePiece]:async({piece:t,location:n})=>{e.currentActionType===Ho.PowerAction&&t.isAPresenceOf(a)&&!n.boardsHasPresenceOf(a)&&await e.addEffectUntilEndOfActionTree({[yn.OceanIsLand]:e=>n.boards().items.map((e=>e.ocean)).includes(e.location),[yn.OceanIsLandForBlight]:e=>void 0!==e.location&&n.boards().items.map((e=>e.ocean)).includes(e.location)})}})}},{text:"You Drown any Invaders or <dahan> moved to those oceans.",[yn.Now]:async({$:e,...a})=>{const t={triggerId:e.nextTriggerId(),[yn.Now]:async({action:e})=>{for(const a of e.parentData.invadersToDrown)a.isAlive&&a.location?.type===jo.Ocean&&await a.drown()}};await e.addSubEffect({effectId:wn.Ocean,[yn.AfterMoving]:async({destination:n,piece:r,movement:i})=>{n.type===jo.Ocean&&r.location===n&&r.isA(e.InvaderOrDahan)&&i!==Fr.Relocate&&(void 0===e.action.data.invadersToDrown&&(e.action.data.invadersToDrown=[]),e.action.data.invadersToDrown.push(r),await e.addTrigger(t,a.effect,a.action,{movingAction:e.action}))}})}}]},{name:"Drowning",effects:[{text:"Destroys Drowned pieces, placing Drowned Invaders here.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Ocean,[yn.GlobalReminder]:()=>({text:`Destroys Drowned pieces, placing Drowned Invaders on your Spirit board.<br><br>At any time you may exchange ${e.spiritCount} Health of these Invaders for 1 Energy. (Ignore modifiers to Invader Health.)`,icon:"Drowning",ongoing:!0,spirit:a,players:[a]}),[yn.AfterRemovePiece]:({piece:e,removement:t})=>(t===Nn.Drown&&(e.piece!==Bn.Explorer&&e.piece!==Bn.Town&&e.piece!==Bn.City||(a.panelPieces[e.piece]+=1)),Promise.resolve())})}},{text:"At any time you may exchange (X) Health of these Invaders for 1 Energy, where X = number of players. (Ignore modifiers to Invader Health.)",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Ocean,[yn.BeforePayEnergy]:async({spirit:t,amount:n})=>{let r=n;for(;t===a&&r>t.innateEnergy;){const n=Math.floor(a.healthWorthOfDrownedInvaders/e.spiritCount),i=Math.min(r-t.innateEnergy,n),s=i*e.spiritCount;for(;a.panelPieces[Bn.Explorer]<s;)if(a.panelPieces[Bn.City]>0)a.panelPieces[Bn.City]-=1,a.panelPieces[Bn.Explorer]+=3;else{if(!(a.panelPieces[Bn.Town]>0))throw new Error("Unable to pay for Ocean energy. This should never happen.");a.panelPieces[Bn.Town]-=1,a.panelPieces[Bn.Explorer]+=2}a.panelPieces[Bn.Explorer]-=s,await e.sendEvent({type:fn.GenericSub,text:`Ocean consumed ${s} health worth of Invaders.`});r-=(await a.gainEnergy(i)).amount}}})}}]}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[yn.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Gather 1 Presence into EACH Ocean",[yn.Now]:({you:e,$:a})=>a.onEachBoard((async t=>{await t.ocean.gather({amount:1,pieces:a.Presence,owner:e,oceanIsAllowed:!0})}))},{text:"Gain +2 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(2)}}]},{effects:[{text:"Add a <presence> in any Ocean",[yn.Now]:async({you:e})=>{await e.addPresenceInAnyOcean()}},{text:"Add a <presence> in any Ocean",[yn.Now]:async({you:e})=>{await e.addPresenceInAnyOcean()}},{text:"Gain +1 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(1)}}]},{effects:[{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Push 1 Presence from EACH Ocean",[yn.Now]:({you:e,$:a})=>a.onEachBoard((async t=>{await t.ocean.push({amount:1,pieces:a.Presence,owner:e,oceanIsAllowed:!0})}))},{text:"Add a <presence> to Coastal Land",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(1,{filter:e=>e.isCoastal})}}]}],tracks:[{energy:0,name:"Top-track: 0 Energy"},{requires:0,elements:[nr.Moon],name:"Top-track: Moon"},{requires:1,elements:[nr.Water],name:"Top-track: Water"},{requires:2,energy:1,name:"Top-track: 1 Energy"},{requires:3,elements:[nr.Earth],name:"Top-track: Earth"},{requires:4,elements:[nr.Water],name:"Top-track: Water"},{requires:5,energy:2,name:"Top-track: 2 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:7,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:8,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:9,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:10,cardPlays:4,name:"Bottom-track: 4 Card Plays"},{requires:11,cardPlays:5,name:"Bottom-track: 5 Card Plays"}],setup:[{text:"Put 2 <presence> on your starting board: 1 in the Ocean, and 1 in a Coastal land of your choice.",[yn.Now]:async({you:e})=>{await e.startingBoard.ocean.putPresence(1,e),await e.startingBoard.inCoastalLands().pickOne((async a=>{await a.putPresence(1,e)}))}}],uniquePowers:[Mi.CallOfTheDeeps,Mi.GraspingTide,Mi.SwallowTheLanddwellers,Mi.TidalBoon],innatePowers:[Mi.PoundShipsToSplinters,Mi.OceanBreaksTheShore]},fy={name:"River Surges in Sunlight",set:a.Base,aspects:[zo.Sunshine,zo.Travel,zo.Haven],specialRules:[{name:"River's Domain",text:"Your <presence> in Wetlands count as <sacred>.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.River,[yn.GlobalReminder]:()=>({icon:"<wetlands><br><sacred>",ongoing:!0,spirit:a,players:[a]}),[yn.HasSacredSiteOf]:({land:e,spirit:t,helpers:n})=>t===a&&e.hasTerrain(xo.Wetlands,!0)&&e.hasPresenceOf(a,n)})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[yn.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Gain +1 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(1)}}]},{effects:[{text:"Add a <presence> in <range-1>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(1)}},{text:"Add a <presence> in <range-1>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(1)}}]},{effects:[{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-2>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(2)}}]}],tracks:[{energy:1,name:"Top-track: 1 Energy"},{requires:0,energy:2,name:"Top-track: 2 Energy"},{requires:1,energy:2,name:"Top-track: 2 Energy"},{requires:2,energy:3,name:"Top-track: 3 Energy"},{requires:3,energy:4,name:"Top-track: 4 Energy"},{requires:4,energy:4,name:"Top-track: 4 Energy"},{requires:5,energy:5,name:"Top-track: 5 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:7,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:8,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:9,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:10,effect:{actionId:"ReclaimOne",text:"Reclaim One",[yn.Now]:async({you:e})=>{await e.reclaim(1)}},effectRequires:({you:e})=>e.hasReclaimableCards,name:"Bottom-track: Reclaim One"},{requires:11,cardPlays:4,name:"Bottom-track: 4 Card Plays"},{requires:12,cardPlays:5,name:"Bottom-track: 5 Card Plays"}],setup:[{text:"Put 1 <presence> on your starting board in the highest-numbered Wetlands.",[yn.Now]:async({you:e})=>{await e.startingBoard.highestNumberedTerrain(xo.Wetlands).putPresence(1,e)}}],uniquePowers:[Mi.BoonOfVigor,Mi.FlashFloods,Mi.RiversBounty,Mi.WashAway],progression:[Mi.UncannyMelting,Mi.NaturesResilience,Mi.PullBeneathTheHungryEarth,Mi.AcceleratedRot,Mi.SongOfSanctity,Mi.Tsunami,Mi.EncompassingWard],innatePowers:[Mi.MassiveFlooding]},py={name:"Shadows Flicker like Flame",set:a.Base,aspects:[zo.Madness,zo.Reach,zo.Amorphous,zo.Foreboding,zo.DarkFire],specialRules:[{name:"Shadows of the Dahan",text:"Whenever you use a Power, you may pay 1 Energy to target a land with <dahan> regardless of the Power's range.",uses:1,[yn.Now]:async({$:e,you:a})=>{const t=[];await e.addSubEffect({effectId:wn.Shadows,[yn.GlobalReminder]:()=>({icon:"Ignore<br>Range",ongoing:!0,spirit:a,players:[a]}),[yn.MayIgnoreRangeWhenTargetingLand]:({land:n,power:r,afterTargeting:i})=>!e.action.data.disableIgnoreRange&&(r.owner.energy>0||!0===i||t.includes(r))&&r.owner===a&&n.has(e.Dahan),[yn.AfterTargetingLand]:async({targetIndex:n,land:r,power:i})=>{i.owner===a&&(e.action.data.disableIgnoreRange=!0,t.includes(i)||i.validLandTargets({targetIndex:n}).has(r)||(await e.sendEvent({type:fn.GenericMain,text:`Shadows Flicker like Flame used Shadows of the Dahan to target ${r.coordinateLink}.`}),await a.payEnergy(1),t.push(i)),e.action.data.disableIgnoreRange=!1)},[yn.AfterPowerLeavesPlay]:({power:e})=>(qr(t,e),Promise.resolve())})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[yn.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}}]},{effects:[{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-1>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(1)}}]},{effects:[{text:"Add a <presence> in <range-3>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(3)}},{text:"Gain +3 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(3)}}]}],tracks:[{energy:0,name:"Top-track: 0 Energy"},{requires:0,energy:1,name:"Top-track: 1 Energy"},{requires:1,energy:3,name:"Top-track: 3 Energy"},{requires:2,energy:4,name:"Top-track: 4 Energy"},{requires:3,energy:5,name:"Top-track: 5 Energy"},{requires:4,energy:6,name:"Top-track: 6 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:6,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:7,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:8,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:9,cardPlays:4,name:"Bottom-track: 4 Card Plays"},{requires:10,cardPlays:5,name:"Bottom-track: 5 Card Plays"}],setup:[{text:"Put 3 <presence> on your starting board: 2 in the highest-numbered Jungle and 1 in land #5.",[yn.Now]:async({you:e})=>{await e.startingBoard.highestNumberedTerrain(xo.Jungles).putPresence(2,e),await e.startingBoard.inLandNumber(5).putPresence(1,e)}}],uniquePowers:[Mi.ConcealingShadows,Mi.CropsWitherAndFade,Mi.FavorsCalledDue,Mi.MantleOfDread],progression:[Mi.DarkAndTangledWoods,Mi.ShadowsOfTheBurningForest,Mi.TheJungleHungers,Mi.LandOfHauntsAndEmbers,Mi.TerrifyingNightmares,Mi.CallOfTheDahanWays,Mi.VisionsOfFieryDoom],innatePowers:[Mi.DarknessSwallowsTheUnwary]},wy={name:"Thunderspeaker",set:a.Base,aspects:[zo.Tactician,zo.Warrior],specialRules:[{name:"Ally of the Dahan",text:"Your <presence> may move with <dahan>. (Whenever a <dahan> moves from 1 of your lands to another land, you may move 1 <presence> along with it.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Thunderspeaker,[yn.GlobalReminder]:()=>({icon:"Ally<br><dahan>",ongoing:!0,spirit:a,players:[a]}),[yn.BeforeMoving]:async({destination:t,source:n,piece:r,movement:i})=>{r.isA(e.Dahan)&&n.hasPresenceOf(a)&&i!==Fr.Relocate&&await e.chooseBetween({highlightLocations:[n],effects:[{actionId:"Move",text:"Move 1 <presence> with <dahan>.",[yn.Now]:async()=>{await n.presenceOf(a).autoPickOne((async e=>{await e.move({locations:{target:Jn.ToThisLocation,location:t},movement:Fr.Bring,withoutWait:!0})}))}},{actionId:"Stay",text:"Stay with <presence>."}]})}})}},{name:"Sworn to Victory",text:"For Each <dahan> destroyed by Invaders Ravaging a land, destroy 1 of your <presence> within <range-1>. (After losing <presence> to <blight>, if relevant.)",[yn.Now]:async({$:e,you:a,...t})=>{const n={triggerId:e.nextTriggerId(),[yn.Now]:async({action:t})=>{await e.sendEvent({type:fn.GenericMain,text:`Sworn to Victory triggered in ${t.parentData.ravagedLand.coordinateLink}.`}),await _r(t.parentData.dahanDestroyedInRavage,(async e=>{await t.parentData.ravagedLand.forPiecesWithin(1,a).where((e=>e.isAPresenceOf(a))).pickOne((async e=>{await e.destroy()}),{noOptions:"No land within <range-1> with your <presence>.",prompt:`Pick a land to destroy a <presence>. ${t.parentData.dahanDestroyedInRavage-e} left.`})}))}};await e.addSubEffect({effectId:wn.Thunderspeaker,[yn.GlobalReminder]:()=>({icon:"Sworn<br><broken>",ongoing:!0,spirit:a,players:[a]}),[yn.AfterDahanDestroyedInRavage]:async({land:a,amount:r})=>{e.action.data.dahanDestroyedInRavage=e.action.data.dahanDestroyedInRavage??0+r,e.action.data.ravagedLand=a,await e.addTrigger(n,t.effect,t.action)}})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[yn.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}}]},{effects:[{text:"Add a <presence> in <range-2> to Land with Dahan ",[yn.Now]:async({you:e,$:a})=>{await e.addPresenceInRange(2,{filter:e=>e.has(a.Dahan)})}},{text:"Add a <presence> in <range-1> to Land with Dahan",[yn.Now]:async({you:e,$:a})=>{await e.addPresenceInRange(1,{filter:e=>e.has(a.Dahan)})}}]},{effects:[{text:"Add a <presence> in <range-1>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(1)}},{text:"Gain +4 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(4)}}]}],tracks:[{energy:1,name:"Top-track: 1 Energy"},{requires:0,elements:[nr.Air],name:"Top-track: Air"},{requires:1,energy:2,name:"Top-track: 2 Energy"},{requires:2,elements:[nr.Fire],name:"Top-track: Fire"},{requires:3,elements:[nr.Sun],name:"Top-track: Sun"},{requires:4,energy:3,name:"Top-track: 3 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:6,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:7,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:8,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:9,effect:{actionId:"ReclaimOne",text:"Reclaim One",[yn.Now]:async({you:e})=>{await e.reclaim(1)}},effectRequires:({you:e})=>e.hasReclaimableCards,name:"Bottom-track: Reclaim One"},{requires:10,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:11,cardPlays:4,name:"Bottom-track: 4 Card Plays"}],setup:[{text:"Put 2 <presence> on your starting board: 1 in each of the 2 lands with the most <dahan>.",[yn.Now]:async({$:e,you:a})=>{const t=a.startingBoard.inLandsWithMost((a=>a.numberOf(e.Dahan)));let n=null;2===t.count?n=t.anyOne:await t.autoPickOne((e=>(n=e,Promise.resolve()))),await n.putPresence(1,a),await a.startingBoard.inLandsWithMost((a=>a===n?0:a.numberOf(e.Dahan))).autoPickOne((async e=>{await e.putPresence(1,a)}))}}],uniquePowers:[Mi.ManifestationOfPowerAndGlory,Mi.SuddenAmbush,Mi.VoiceOfThunder,Mi.WordsOfWarning],innatePowers:[Mi.GatherTheWarriors,Mi.LeadTheFuriousAssault]},yy={name:"Sharp Fangs Behind the Leaves",set:a.BranchAndClaw,aspects:[zo.Encircle,zo.Unconstrained],specialRules:[{name:"Ally of the Beasts",text:"Your <presence> may move with <beasts>. (Whenever a <beasts> moves from 1 <presence> along with it.)",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.FangsAllyOfTheBeasts,[yn.GlobalReminder]:()=>({icon:"Ally<br><beasts>",ongoing:!0,spirit:a,players:[a]}),[yn.BeforeMoving]:async({destination:t,source:n,piece:r,movement:i})=>{r.isA(e.Beasts)&&n.hasPresenceOf(a)&&i!==Fr.Relocate&&await e.chooseBetween({effects:[{actionId:"Move",text:"Move 1 <presence> with <beasts>.",[yn.Now]:async()=>{await n.presenceOf(a).autoPickOne((async e=>{await e.move({locations:{target:Jn.ToThisLocation,location:t},withoutWait:!0})}))}},{actionId:"Stay",text:"Stay with <presence>."}]})}})}},{name:"Call Forth Predators",text:"During each Spirit Phase, you may replace 1 of your <presence> with 1 <beasts>. The replaced <presence> leaves the game. (It was not destroyed, so things which return destroyed <presence> cannot bring it back.).",[yn.Now]:async({$:e,you:a})=>{await a.addExtraAction({effectId:wn.FangsCallForthPredators,actionId:"CallForthPredators",icon:"+1 <beasts>",enabled:()=>e.phase===Wi.Grow||e.phase===Wi.GainEnergy,onActivate:async()=>{await a.presence().pickOne((async a=>{const t=a.location;await a.remove(Nn.RemoveFromGame),await t.add(1,e.Beasts)}),{text:"Replace 1 of your <presence> with 1 <beasts>."})}})}}],pickOptions:[[0,1,2,3],[0,1,2,3]],growthOptions:[{cost:1,effects:[{text:"Reclaim cards",[yn.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}}]},{effects:[{text:"Add a <presence> in <range-3>",[yn.Now]:async({you:e,$:a})=>{await e.addPresenceInRange(3,{filter:e=>e.isJungle||e.has(a.Beasts)})}}]},{effects:[{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Gain +1 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(1)}}]},{effects:[{text:"Gain +3 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(3)}}]}],tracks:[{energy:1,name:"Top-track: 1 Energy"},{requires:0,elements:[nr.Animal],name:"Top-track: Animal"},{requires:1,elements:[nr.Plant],name:"Top-track: Plant"},{requires:2,energy:2,name:"Top-track: 2 Energy"},{requires:3,elements:[nr.Animal],name:"Top-track: Animal"},{requires:4,energy:3,name:"Top-track: 3 Energy"},{requires:5,energy:4,name:"Top-track: 4 Energy"},{cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:7,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:8,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:9,effect:{actionId:"ReclaimOne1",text:"Reclaim One",[yn.Now]:async({you:e})=>{await e.reclaim(1)}},effectRequires:({you:e})=>e.hasReclaimableCards,name:"Bottom-track: Reclaim One"},{requires:10,cardPlays:4,name:"Bottom-track: 4 Card Plays"},{requires:11,cardPlays:5,effect:{actionId:"ReclaimOne2",text:"Reclaim One",[yn.Now]:async({you:e})=>{await e.reclaim(1)}},effectRequires:({you:e})=>e.hasReclaimableCards,name:"Bottom-track: 5 Card Plays, Reclaim One"}],setup:[{text:"Put 1 <presence> and 1 <beasts> on your starting board in the highest-numbered Jungle.",[yn.Now]:async({you:e,$:a})=>{const t=e.startingBoard.highestNumberedTerrain(xo.Jungles);await t.putPresence(1,e),await t.add(1,a.Beasts)}},{text:"Put 1 <presence> in a land of your choice with <beasts> anywhere on the island.",[yn.Now]:async({you:e,$:a})=>{await a.inLandsWith(a.Beasts).autoPickOne((async a=>{await a.putPresence(1,e)}))}}],uniquePowers:[Mi.PreyOnTheBuilders,Mi.TeethGleamFromDarkness,Mi.TerrifyingChase,Mi.TooNearTheJungle],innatePowers:[Mi.RangingHunt,Mi.FrenziedAssault]},my={name:"Keeper of the Forbidden Wilds",set:a.BranchAndClaw,aspects:[zo.SpreadingHostility],specialRules:[{name:"Forbidden Ground",effects:[{text:"Any time you create a <sacred>, Push all <dahan> from that land.",[yn.Now]:async({$:e,you:a,...t})=>{const n={triggerId:e.nextTriggerId(),[yn.Now]:async({action:a})=>{for(const t of a.parentData.landBecameSacredSite)await t.pushAll(e.Dahan)}};await e.addSubEffect({effectId:wn.Keeper,[yn.GlobalReminder]:()=>({text:"Any time you create a <sacred>, Push all <dahan> from that land.<br><br>Dahan Events never move <dahan> to your <sacred>, but Powers can do so.",icon:"<sacred>",ongoing:!0,spirit:a,players:[a]}),[yn.AfterLandChangesAmountOfPresence]:async({land:r,spirit:i,amountBefore:s,amountAfter:o})=>{o>=2&&s<2&&i===a&&(void 0===e.action.data.landBecameSacredSite&&(e.action.data.landBecameSacredSite=[]),e.action.data.landBecameSacredSite.includes(r)||e.action.data.landBecameSacredSite.push(r),await e.addTrigger(n,t.effect,t.action))}})}},{text:"Dahan Events never move <dahan> to your <sacred>, but Powers can do so.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Keeper,[yn.PreventMovePiece]:({piece:t,destination:n,movement:r})=>e.action.type===Ho.DahanEventAction&&t.isA(e.Dahan)&&r!==Fr.Relocate&&n.hasSacredSiteOf(a)})}}]}],pickOptions:[[0,1,2,3],[0,1,2,3]],growthOptions:[{effects:[{text:"Reclaim cards",[yn.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain +1 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(1)}}]},{effects:[{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}}]},{effects:[{text:"Add a <presence> in <range-3> to Land with Wilds or Your Presence",[yn.Now]:async({you:e,$:a})=>{await e.addPresenceInRange(3,{filter:t=>t.has(a.Wilds)||t.hasPresenceOf(e)})}},{text:"Gain +1 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(1)}}]},{cost:3,effects:[{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-3> to Land without Blight",[yn.Now]:async({you:e,$:a})=>{await e.addPresenceInRange(3,{filter:e=>!e.has(a.Blight)})}}]}],tracks:[{energy:2,name:"Top-track: 2 Energy"},{requires:0,elements:[nr.Sun],name:"Top-track: Sun"},{requires:1,energy:4,name:"Top-track: 4 Energy"},{requires:2,energy:5,name:"Top-track: 5 Energy"},{requires:3,elements:[nr.Plant],name:"Top-track: Plant"},{requires:4,energy:7,name:"Top-track: 7 Energy"},{requires:5,energy:8,name:"Top-track: 8 Energy"},{requires:6,energy:9,name:"Top-track: 9 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:8,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:9,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:10,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:11,cardPlays:4,name:"Bottom-track: 4 Card Plays"},{requires:12,cardPlays:5,effect:{actionId:"ReclaimOne",text:"Reclaim One",[yn.Now]:async({you:e})=>{await e.reclaim(1)}},effectRequires:({you:e})=>e.hasReclaimableCards,name:"Bottom-track: 5 Card Plays, Reclaim One"}],setup:[{text:"Put 1 <presence> and 1 <wilds> on your starting board in the highest-numbered Jungle.",[yn.Now]:async({you:e,$:a})=>{const t=e.startingBoard.highestNumberedTerrain(xo.Jungles);await t.putPresence(1,e),await t.add(1,a.Wilds)}}],uniquePowers:[Mi.BoonOfGrowingPower,Mi.RegrowFromRoots,Mi.SacrosanctWilderness,Mi.ToweringWrath],innatePowers:[Mi.PunishThoseWhoTrespass,Mi.SpreadingWilds]},vy={name:"Downpour Drenches the World",set:a.FeatherAndFlame,aspects:[],specialRules:[{name:"Drench the Landscape",text:"Spirit Actions and Special Rules treat your <sacred> as Wetlands in addition to the printed terrain",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Downpour,[yn.GlobalReminder]:()=>({icon:"<sacred><br>= <wetlands>",ongoing:!0,spirit:a,players:[a]}),[yn.LocationIsTerrain]:({location:t,terrain:n,isSpecialRule:r})=>n===xo.Wetlands&&t.hasSacredSiteOf(a)&&([Ho.SpiritAction,Ho.PowerAction].includes(e.action.type)||r)})}},{name:"Pour Down Power Across the Island",text:"For each 2 <water> you have: during the <fast>/<slow> phase you may either:<br><br>Gain 1 Energy<or>Repeat one of your land-targeting Power Cards by paying its cost again. (It need not target the same land.)<br><br>(Max. 5 times per turn, no matter how much <water> you have.)",[yn.Now]:async({$:e,you:a})=>{await a.addExtraAction({actionId:"PourDownPower",icon:"<water>",maxUses:()=>Math.min(a.numberOfElementCombos({[nr.Water]:2}),5),enabled:()=>e.phase===Wi.FastPowers||e.phase===Wi.SlowPowers,onActivate:async()=>{await e.chooseBetween({effects:[{actionId:"Energy",text:"Gain 1 Energy",[yn.Now]:async()=>{await a.gainEnergy(1)}},{actionId:"Repeat",text:"Repeat one of your land-targeting Power Cards by paying its cost again.",[yn.Now]:async()=>{await e.addSubEffectUntilEndOfTurn({[yn.GlobalReminder]:()=>({icon:"Repeat<br>Power",players:[a]}),[yn.MayRepeatPowercard]:({power:e,speed:t})=>e.owner===a&&e.costToPlay<=a.energy&&e.data.type!==Sn.Innate&&e.data.target===ir.Land&&e.possibleToRepeatAtSpeed(t),[yn.RepeatPowerCard]:async({power:a,speed:t})=>{e.removeThisEffect(),await a.payForPlay(),await a.replay(t)}})}}]})}})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[yn.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Move a <presence> in <range-2>",[yn.Now]:async({you:e})=>{await e.movePresence(2)}}]},{effects:[{text:"Add a <presence> in <range-2>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(2)}},{text:"Add a <presence> in <range-2>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(2)}},{text:"Gain 2 Water",[yn.Now]:async({you:e})=>{await e.gainElementsUntilEndOfTurn({[nr.Water]:2})}},{text:"Discard 2 Power Cards",[yn.Now]:async({you:e})=>{await e.discardPowerCards(2)}}]},{effects:[{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-3>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(3)}},{text:"Gain +1 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(1)}}]}],tracks:[{energy:1,name:"Top-track: 1 Energy"},{requires:0,elements:[nr.Water],name:"Top-track: Water"},{requires:1,elements:[nr.Plant],name:"Top-track: Plant"},{requires:2,elements:[nr.Water],name:"Top-track: Water"},{requires:3,energy:2,elements:[nr.Air],name:"Top-track: 2 Energy, Air"},{requires:4,elements:[nr.Water],name:"Top-track: Water"},{requires:5,elements:[nr.Earth],name:"Top-track: Earth"},{requires:6,elements:[nr.Water,nr.Water],name:"Top-track: 2 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:8,effect:{actionId:"MovePresence1",text:"Move a <presence> 1",[yn.Now]:async({you:e})=>{await e.movePresence(1)}},name:"Bottom-track: Move a Presence 1"},{requires:9,elements:[nr.Water],name:"Bottom-track: Water"},{requires:10,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:11,effect:{actionId:"MovePresence2",text:"Move a <presence> 1",[yn.Now]:async({you:e})=>{await e.movePresence(1)}},name:"Bottom-track: Move a Presence 1"},{requires:12,cardPlays:3,name:"Bottom-track: 3 Card Plays"}],setup:[{text:"Put 1 <presence> on your starting board in the lowest-numbered Wetland.",[yn.Now]:async({you:e})=>{await e.startingBoard.lowestNumberedTerrain(xo.Wetlands).putPresence(1,e)}}],uniquePowers:[Mi.DarkSkiesLooseAStingingRain,Mi.FoundationsSinkIntoMud,Mi.GiftOfAbundance,Mi.UnbearableDeluge],innatePowers:[Mi.RainAndMudSuppressConflict,Mi.WaterNourishesLifesGrowth]},Ay={name:"Finder of Paths Unseen",set:a.FeatherAndFlame,aspects:[],specialRules:[{name:"Responsibilities to the Dead",text:"After one of your Actions Destroys 1 or more <dahan>/Invaders, or directly triggers their Destruction by moving them, Destroy 1 of your <presence> and lose 1 Energy. If you have no Energy to lose, Destroy another <presence>.",[yn.Now]:async({$:e,you:a,...t})=>{const n={triggerId:e.nextTriggerId(),[yn.Now]:async()=>{await e.sendEvent({type:fn.GenericMain,text:`${a.nameLink} paid responsibilities to the Dead.`}),await a.destroyPresence(1),a.energy>=1?await a.loseEnergy(1):await a.destroyPresence(1)}};await e.addSubEffect({effectId:wn.Finder,[yn.GlobalReminder]:()=>({icon:"<broken>",ongoing:!0,spirit:a,players:[a]}),[yn.AfterRemovePiece]:async({piece:r,removement:i})=>{r.isA(e.InvaderOrDahan)&&pr[i].isDestroyLike&&(e.action.spirit===a||e.action.data.movingAction?.spirit===a)&&await e.addTrigger(n,t.effect,t.action)}})}},{name:"Open the Ways",text:"You may make up to two of your lands adjacent at a time. You may change which lands are adjacent once between Actions.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Finder,[yn.GlobalReminder]:()=>({text:"Your lands are adjacent to each other, except for Invader and Adversary Actions.<br><br>(House Rule Variant)",icon:"Open<br>Ways",ongoing:!0,spirit:a,players:[a]}),[yn.StartOfRavageStep]:()=>(e.setupAdjacencies(),Promise.resolve()),[yn.StartOfSlowPhase]:()=>(e.setupAdjacencies(),Promise.resolve()),[yn.AfterLandChangesAmountOfPresence]:async({amountBefore:t,amountAfter:n,spirit:r})=>{r===a&&e.phase!==Wi.SetupPresence&&(t>0&&0===n||0===t&&n>0)&&await e.addSubEffectUntilEndOfAction({[yn.ActionEnds]:()=>(e.setupAdjacencies(),Promise.resolve())})},[yn.ExtraAdjacency]:()=>{const t=[];if(![Wi.HighImmigration,Wi.Ravage,Wi.Build,Wi.Explore].includes(e.phase))for(const e of a.lands)for(const n of a.lands)e!==n&&t.push({land1:e,land2:n});return t}})}}],pickOptions:[[0,1,2,3]],growthOptions:[{effects:[{text:"Reclaim cards",[yn.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"You may ignore Range this turn",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffectUntilEndOfTurn({[yn.GlobalReminder]:()=>({icon:"Ignore<br>Range",players:[a]}),[yn.ExtraRange]:e=>e.spirit===a?99:0})}}]},{effects:[{text:"Add a <presence> in <range-1>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(1)}},{text:"+1 Card Play this turn",[yn.Now]:async({you:e})=>{await e.gainCardPlays(1)}}]},{effects:[{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-2>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(2)}}]},{effects:[{text:"Add a <presence> in any Land",[yn.Now]:async({you:e})=>{await e.addPresence({locations:Jn.AnyLands})}},{text:"Gain +2 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(2)}}]}],tracks:[{energy:0,name:"Top-track: 0 Energy"},{requires:0,elements:[nr.Sun],name:"Top-track: Sun"},{requiresAny:[1,3,5],energy:2,elements:[nr.Water],name:"Top-track: 2 Energy, Water"},{requiresAny:[2,4,6,7],extraEnergy:2,name:"Top-track: +2 Energy"},{requiresAny:[3,7],extraEnergy:1,elements:[nr.Any],name:"Top-track: +1 Energy, Any"},{requiresAny:[1,9],energy:1,elements:[nr.Moon],name:"Middle-track: 1 Energy, Moon"},{requiresAny:[3,5,11],effect:{actionId:"MovePresence",text:"Move Presence 1",[yn.Now]:async({you:e})=>{await e.movePresence(1)}},elements:[nr.Air],name:"Middle-track: Move Presence 1, Air"},{requiresAny:[3,4,11,12],extraEnergy:1,extraRange:1,name:"Middle-track: +1 Energy, +1 Range"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:8,elements:[nr.Earth],name:"Bottom-track: Earth"},{requiresAny:[9,11],extraCardPlays:1,name:"Bottom-track: +1 Card Plays"},{requiresAny:[6,7,10,12],extraCardPlays:1,name:"Bottom-track: +1 Card Plays"},{requiresAny:[7,11],effect:{actionId:"Push",text:"Push 1 <town>/<city> from 1 of your lands.",[yn.Now]:({you:e,$:a})=>e.forPiecesThatIs(a.TownOrCity).pickOne((async e=>{await e.push()}),{noOptions:"None of your lands have <town>/<city>."})},name:"Bottom-track: Push 1 Town/City"}],setup:[{text:"Put 1 <presence> on your starting board in land #3.",[yn.Now]:async({you:e})=>{await e.startingBoard.inLandNumber(3).putPresence(1,e)}},{text:"Put 1 <presence> on any board in land #1.",[yn.Now]:async({you:e,$:a})=>{await a.inLandsWhere((e=>e.hasNumber(1))).autoPickOne((async a=>{await a.putPresence(1,e)})),a.setupAdjacencies()}}],uniquePowers:[Mi.ACircuitousAndWendingJourney,Mi.AidFromTheSpiritspeakers,Mi.OfferPassageBetweenWorlds,Mi.PathsTiedByNature,Mi.TravelersBoon,Mi.WaysOfShoreAndHeartland],innatePowers:[Mi.LayPathsTheyCannotHelpButWalk,Mi.CloseTheWays]},Iy={name:"Serpent Slumbering Beneath the Island",set:a.FeatherAndFlame,aspects:[zo.Locus],specialRules:[{name:"Deep Slumber",text:'You start off limited to 5 <presence> on the island. Raise this with your "Absorb Essence" Power Card. Each use covers the lowest revealed number; your <presence> limit is the lowest uncovered number.',[yn.Now]:async({$:e,you:a})=>{const t=e=>[5,7,8,10,11,12,13][Math.min(e.absorbedPresence.length,6)];await e.addSubEffect({effectId:wn.Serpent,[yn.GlobalReminder]:()=>({icon:`<presence><br>${Math.max(a.numberOfPresenceInLands+(null!=a.incarna?-1:0),0)}/${t(a)}`,ongoing:!0,spirit:a,players:[a]}),[yn.PreventAddAnyPresence]:({spirit:e})=>e===a&&a.numberOfPresenceInLands+(null!=a.incarna?-1:0)>=t(a)})}}],pickOptions:[[0,1,2,3],[0,1,2,3]],growthOptions:[{effects:[{text:"Reclaim cards",[yn.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Move a <presence>",[yn.Now]:async({you:e})=>{await e.movePresence(1)}}]},{effects:[{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Gain +1 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(1)}}]},{effects:[{text:"Gain +4 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(4)}}]},{effects:[{text:"Add a <presence> in <range-3> to Land without Blight",[yn.Now]:async({you:e,$:a})=>{await e.addPresenceInRange(3,{filter:e=>!e.has(a.Blight)})}}]}],tracks:[{energy:1,name:"Top-track: 1 Energy"},{requires:0,elements:[nr.Fire],name:"Top-track: Fire"},{requires:1,elements:[nr.Any],name:"Top-track: Any"},{requires:2,effect:{actionId:"ReclaimOne1",text:"Reclaim One",[yn.Now]:async({you:e})=>{await e.reclaim(1)}},name:"Top-track: Reclaim One"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:4,elements:[nr.Moon],name:"Bottom-track: Moon"},{requires:5,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:6,elements:[nr.Water],name:"Bottom-track: Water"},{requiresAll:[3,7],elements:[nr.Earth],name:"Middle-track: Earth"},{requires:8,energy:6,name:"Top-track: 6 Energy"},{requires:9,elements:[nr.Any],name:"Top-track: Any"},{requires:10,energy:12,name:"Top-track: 12 Energy"},{requires:8,cardPlays:4,name:"Bottom-track: 4 Card Plays"},{requires:12,cardPlays:5,effect:{actionId:"ReclaimOne2",text:"Reclaim One",[yn.Now]:async({you:e})=>{await e.reclaim(1)}},effectRequires:({you:e})=>e.hasReclaimableCards,name:"Bottom-track: 5 Card Plays, Reclaim One"}],setup:[{text:"Put 1 <presence> on your starting board in land #5.",[yn.Now]:async({you:e})=>{await e.startingBoard.inLandNumber(5).putPresence(1,e)}}],uniquePowers:[Mi.AbsorbEssence,Mi.ElementalAegis,Mi.GiftOfFlowingPower,Mi.GiftOfThePrimordialDeeps],innatePowers:[Mi.SerpentWakesInPower,Mi.SerpentRousesInAnger]},xy={name:"Heart of the Wildfire",set:a.FeatherAndFlame,aspects:[zo.Transforming],specialRules:[{name:"Blazing Presence",text:"After you add or move <presence> after Setup, in the land it goes to:<br><br>For each <fire> showing on your <presence> Tracks, do 1 Damage.<br><br>If 2 <fire> or more are showing on your <presence> Tracks, add 1 <blight>.<br><br>Push all <beasts> and any number of <dahan>.<br><br>If you add multiple <presence> into a land at the same time, only do the above effects once.",[yn.Now]:async({$:e,you:a,...t})=>{await e.afterPiecesAreAddedOrMovedAddTrigger({reminder:!1,permanent:!0,globalReminder:()=>({icon:`<presence><br>${a.elementsFromTracks[nr.Fire]} <fire>`,ongoing:!0,spirit:a,players:[a]}),trigger:{triggerId:e.nextTriggerId(),[yn.Now]:async({action:t})=>{const n=t.parentData.piecesAddedOrMoved.map((e=>e.location)).filter((e=>null!==e));await id.createCollection(e,Cr(n)).autoPickOne((async t=>{await e.addSubEffect({effectId:wn.Wildfire,effects:[{text:"For each <fire> showing on your <presence> Tracks, do 1 Damage.",[yn.Now]:async()=>{await t.damage(a.elementsFromTracks[nr.Fire])}},{text:"If 2 <fire> or more are showing on your <presence> Tracks, add 1 <blight>.",[yn.Now]:async()=>{a.elementsFromTracks[nr.Fire]>=2&&await t.addBlight(1)}},{text:"Push all <beasts>.",[yn.Now]:async()=>{await t.possiblyDontCountPiecesAs(Bn.Beasts),await t.pushAll(e.Beasts)}},{text:"Push any number of <dahan>.",[yn.Now]:async()=>{await t.push({quantifier:lr.Any,pieces:e.Dahan})}}]})}))}},pieces:e.Presence,owner:a,effect:t.effect,action:t.action})}},{name:"Destructive Nature",text:"<blight> added due to Spirit effects (Powers, Special Rules, Scenario-based Rituals, etc) does not destroy your <presence>. (This includes cascades.)",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Wildfire,[yn.PreventBlightDestroyingPresence]:t=>t.spirit===a&&(e.action.type===Ho.PowerAction||e.action.type===Ho.SpiritAction)})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[yn.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Gain +1 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(1)}}]},{effects:[{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-3>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(3)}}]},{effects:[{text:"Add a <presence> in <range-1>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(1)}},{text:"Gain +2 Energy and +1 more per Fire Showing",[yn.Now]:async({you:e})=>{await e.gainEnergy(2+e.elementsFromTracks[nr.Fire])}}]}],tracks:[{energy:0,name:"Top-track: 0 Energy"},{requires:0,elements:[nr.Fire],name:"Top-track: Fire"},{requires:1,energy:1,name:"Top-track: 1 Energy"},{requires:2,energy:2,name:"Top-track: 2 Energy"},{requires:3,elements:[nr.Fire,nr.Plant],name:"Top-track: Fire and Plant"},{requires:4,energy:3,name:"Top-track: 3 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:6,elements:[nr.Fire],name:"Bottom-track: Fire"},{requires:7,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:8,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:9,elements:[nr.Fire],name:"Bottom-track: Fire"},{requires:10,cardPlays:4,name:"Bottom-track: 4 Card Plays"}],setup:[{text:"Put 3 <presence> and 2 <blight> on your starting board in the highest-numbered Sands.",[yn.Now]:async({you:e,$:a})=>{const t=e.startingBoard.highestNumberedTerrain(xo.Sands);await t.putPresence(3,e),await t.add(2,a.Blight)}}],uniquePowers:[Mi.AsphyxiatingSmoke,Mi.FlamesFury,Mi.Flashfires,Mi.ThreateningFlames],innatePowers:[Mi.Firestorm,Mi.TheBurnedLandRegrows]},by={name:"Eyes Watch from the Trees",set:a.HorizonsOfSpiritIsland,aspects:[],specialRules:[{name:"Dahan Trust the Watchers",text:'After one of your Powers adds Defend to a single land, Gather up to 1 <dahan> into that land.<br><br>("Power" includes both your innate Power and your Power Cards. Can be used with any number of Defend Powers each turn.)',[yn.Now]:async({$:e,you:a,...t})=>{const n={triggerId:e.nextTriggerId(),[yn.Now]:async({action:a})=>{await a.parentData.landWhichGotDefense.gatherUpTo(1,e.Dahan)}};await e.addSubEffect({effectId:wn.Eyes,[yn.GlobalReminder]:()=>({icon:"Defend<br>Gather",ongoing:!0,spirit:a,players:[a]}),[yn.AfterPowerAddsDefense]:async({land:r,spirit:i,singleLand:s})=>{i===a&&s&&(e.action.data.landWhichGotDefense=r,await e.addTrigger(n,t.effect,t.action))}})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[yn.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Gain +1 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(1)}}]},{effects:[{text:"Add a <presence> in <range-2>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(2)}},{text:"Add a <presence> in <range-0>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(0)}}]},{effects:[{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-3>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(3)}},{text:"Gain +1 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(1)}}]}],tracks:[{energy:1,name:"Top-track: 1 Energy"},{requires:0,energy:1,name:"Top-track: 1 Energy"},{requires:1,energy:2,name:"Top-track: 2 Energy"},{requires:2,elements:[nr.Plant],name:"Top-track: Plant"},{requires:3,energy:3,name:"Top-track: 3 Energy"},{requires:4,elements:[nr.Moon],name:"Top-track: Moon"},{requires:5,energy:4,name:"Top-track: 4 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:7,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:8,elements:[nr.Air],name:"Bottom-track: Air"},{requires:9,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:10,elements:[nr.Plant],name:"Bottom-track: Plant"},{requires:11,cardPlays:4,name:"Bottom-track: 4 Card Plays"}],setup:[{text:"Put 2 <presence> on your starting board, in the highest-numbered Jungle.",[yn.Now]:async({you:e})=>{await e.startingBoard.highestNumberedTerrain(xo.Jungles).putPresence(2,e)}}],uniquePowers:[Mi.BoonOfWatchfulGuarding,Mi.EerieNoisesAndMovingTrees,Mi.MysteriousAbductions,Mi.WhisperedGuidanceThroughTheNight],innatePowers:[Mi.MischiefAndSabotage]},Ty={name:"Rising Heat of Stone and Sand",set:a.HorizonsOfSpiritIsland,aspects:[],specialRules:[{name:"Blistering Heat",text:"At your <sacred>, Invaders have -1 Health (min. 1).",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Heat,[yn.GlobalReminder]:()=>({icon:"<sacred><br>-1 HP",ongoing:!0,spirit:a,players:[a]}),[yn.AdjustHealth]:({piece:e})=>e.isInvader&&e.location?.hasSacredSiteOf(a)?-1:0,[yn.AfterLandChangesAmountOfPresence]:async({amountBefore:e,amountAfter:t,land:n,spirit:r})=>{e<2&&t>=2&&r===a&&await n.healthCheck()}})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[yn.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Gain +1 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(1)}}]},{effects:[{text:"Add a <presence> in <range-3> to Sands or Mountain",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(3,{filter:e=>e.isMountainsOrSands})}},{text:"Add a <presence> in <range-3> to Sands or Mountain",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(3,{filter:e=>e.isMountainsOrSands})}}]},{effects:[{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-1>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(1)}},{text:"Gain +2 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(2)}}]}],tracks:[{energy:1,name:"Top-track: 1 Energy"},{requires:0,elements:[nr.Earth],name:"Top-track: Earth"},{requires:1,energy:2,name:"Top-track: 2 Energy"},{requires:2,energy:3,name:"Top-track: 3 Energy"},{requires:3,elements:[nr.Fire],name:"Top-track: Fire"},{requires:4,energy:4,name:"Top-track: 4 Energy"},{requires:5,energy:5,name:"Top-track: 5 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:7,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:8,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:9,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:10,cardPlays:4,name:"Bottom-track: 4 Card Plays"},{requires:11,cardPlays:5,elements:[nr.Fire],name:"Bottom-track: 5 Card Plays, Fire"}],setup:[{text:"Put 2 <presence> on your starting board, in the highest-numbered Sands.",[yn.Now]:async({you:e})=>{await e.startingBoard.highestNumberedTerrain(xo.Sands).putPresence(2,e)}}],uniquePowers:[Mi.CallOnHerdersForAid,Mi.GiftOfSearingHeat,Mi.StingingSandstorm,Mi.SwelteringExhaustion],innatePowers:[Mi.ScorchWithWavesOfHeat]},Ey={name:"Fathomless Mud of the Swamp",set:a.HorizonsOfSpiritIsland,aspects:[],specialRules:[{name:"Offer no Firm Foundations",text:"At your <sacred>, Build actions add <explorer> instead of <town>/<city>.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Mud,[yn.GlobalReminder]:()=>({icon:"Build<br><explorer>",ongoing:!0,spirit:a,players:[a]}),highPriority:!0,[yn.AlterInvaderActionInLand]:async({invaderAction:t,land:n})=>{if(t===Hr.Build&&n.hasSacredSiteOf(a)){const a=await n.add(1,e.Explorer);return await e.doEffects(yn.AfterSuccessfulBuild,{land:n,additions:a}),!0}return!1}})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[yn.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Add a <presence> in <range-0>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(0)}}]},{effects:[{text:"Add a <presence> in <range-1>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(1)}},{text:"Add a <presence> in <range-1>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(1)}}]},{effects:[{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-2>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(2)}},{text:"Gain +2 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(2)}}]}],tracks:[{energy:1,name:"Top-track: 1 Energy"},{requires:0,elements:[nr.Plant],name:"Top-track: Plant"},{requires:1,energy:2,name:"Top-track: 2 Energy"},{requires:2,energy:3,name:"Top-track: 3 Energy"},{requires:3,elements:[nr.Water],name:"Top-track: Water"},{requires:4,energy:4,name:"Top-track: 4 Energy"},{requires:5,energy:5,name:"Top-track: 5 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:7,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:8,elements:[nr.Earth],name:"Bottom-track: Earth"},{requires:9,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:10,elements:[nr.Moon],name:"Bottom-track: Moon"},{requires:11,cardPlays:4,name:"Bottom-track: 4 Card Plays"}],setup:[{text:"Put 2 <presence> on your starting board, in the lowest-numbered Wetland.",[yn.Now]:async({you:e})=>{await e.startingBoard.lowestNumberedTerrain(xo.Wetlands).putPresence(2,e)}}],uniquePowers:[Mi.ExaltationOfTangledGrowth,Mi.FoulVaporsAndFetidMuck,Mi.IntractableThicketsAndThorns,Mi.OpenShiftingWaterways],innatePowers:[Mi.SpreadingAndDreadfulMire]},Py={name:"Devouring Teeth Lurk Underfoot",set:a.HorizonsOfSpiritIsland,aspects:[],specialRules:[{name:"Territorial Aggression",text:'Your Damage-Dealing Powers do +1 Damage.<br><br>(This adds +1 Damage total for the Power, even if the Power Damages multiple invaders or "each Invader". It can boost Minor / Major Power Cards, too, not just your Uniques + Innate.)',[yn.Now]:async({you:e})=>{await e.gainDamageBoost({effectId:wn.Teeth,amount:1,source:e,permanent:!0})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[yn.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Add a <presence> in <range-0>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(0)}}]},{effects:[{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-1>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(1)}}]},{effects:[{text:"Add a <presence> in <range-2>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(2)}},{text:"Gain +3 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(3)}}]}],tracks:[{energy:2,name:"Top-track: 2 Energy"},{requires:0,elements:[nr.Fire],name:"Top-track: Fire"},{requires:1,energy:3,name:"Top-track: 3 Energy"},{requires:2,energy:4,name:"Top-track: 4 Energy"},{requires:3,elements:[nr.Animal],name:"Top-track: Animal"},{requires:4,energy:6,name:"Top-track: 6 Energy"},{requires:5,energy:7,name:"Top-track: 7 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:7,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:8,elements:[nr.Animal],name:"Bottom-track: Animal"},{requires:9,elements:[nr.Fire],name:"Bottom-track: Fire"},{requires:10,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:11,elements:[nr.Earth],name:"Bottom-track: Earth"},{requires:12,cardPlays:4,name:"Bottom-track: 4 Card Plays"}],setup:[{text:"Put 1 <presence> on your starting board, in land #5.",[yn.Now]:async({you:e})=>{await e.startingBoard.inLandNumber(5).putPresence(1,e)}}],uniquePowers:[Mi.FerociousRampage,Mi.GiftOfFuriousMight,Mi.HerdTowardsTheLurkingMaw,Mi.MarkTerritoryWithScarsAndTeeth],innatePowers:[Mi.DeathApproachesFromBeneathTheSurface]},Sy={name:"Sun-Bright Whirlwind",set:a.HorizonsOfSpiritIsland,aspects:[],specialRules:[{name:"A Stiff Wind at their Backs",text:"After you Add <presence> during Growth, Push up to 1 <explorer>/<dahan> from that land.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Whirlwind,[yn.GlobalReminder]:()=>({icon:"<presence><br><explorer>/<dahan>",ongoing:!0,spirit:a,players:[a]}),[yn.AfterAddingPiece]:async({land:t,additions:n})=>{for(const r of n){const{piece:n}=r;e.phase===Wi.Grow&&n.isAPresenceOf(a)&&e.action.spirit===a&&await t.pushUpTo(1,e.ExplorerOrDahan)}}})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[yn.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Gain +1 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(1)}}]},{effects:[{text:"Add a <presence> in <range-1>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(1)}},{text:"Gain +4 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(4)}}]},{effects:[{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-4>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(4)}}]}],tracks:[{energy:1,name:"Top-track: 1 Energy"},{requires:0,energy:2,name:"Top-track: 2 Energy"},{requires:1,elements:[nr.Sun],name:"Top-track: Sun"},{requires:2,energy:3,name:"Top-track: 3 Energy"},{requires:3,energy:4,elements:[nr.Air],name:"Top-track: 4 Energy, Air"},{requires:4,energy:6,name:"Top-track: 6 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:6,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:7,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:8,elements:[nr.Air],name:"Bottom-track: Air"},{requires:9,cardPlays:4,name:"Bottom-track: 4 Card Plays"},{requires:10,cardPlays:5,elements:[nr.Sun],name:"Bottom-track: 5 Card Plays, Sun"}],setup:[{text:"Put 3 <presence> on your starting board: 1 in the highest-numbered Sands, 2 in the lowest-numbered Mountain.",[yn.Now]:async({you:e})=>{await e.startingBoard.highestNumberedTerrain(xo.Sands).putPresence(1,e),await e.startingBoard.lowestNumberedTerrain(xo.Mountains).putPresence(2,e)}}],uniquePowers:[Mi.GiftOfTheSunlitAir,Mi.GiftOfWindspedSteps,Mi.ScatterToTheWinds,Mi.TempestOfLeavesAndBranches],innatePowers:[Mi.ViolentWindstorms]},Oy={name:"Fractured Days Split the Sky",set:a.JaggedEarth,aspects:[],specialRules:[{name:"Fragments of Shattered Time",text:"Each <presence> on this ability represent 1 Time. Many of your Powers require Time as an additional cost. Spend it when you Resolve the Power. (Not when you play it.)<br><br>When you Gain 1 Time, put 1 of your <presence> here from your <presence> track (or, optionally, the island). When you Spend 1 Time, return it to a <presence> track - or if you have no free spaces, Destroy it.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Fractured,[yn.GlobalReminder]:()=>({icon:"Time<br><presence>",ongoing:!0,spirit:a,players:[a]})})}},{name:"Days that Never Were",text:"Your 3rd Growth option lets you gain any one Power Card from a special set you create during Setup. When you gain a Power Card any other way, you may add one unchosen card to this set.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Fractured,[yn.GlobalReminder]:()=>({icon:"Days",ongoing:!0,spirit:a,players:[a]}),[yn.AfterGainingPowers]:async({powerGain:t,spirit:n})=>{if(n===a&&!t.gifted&&!t.taken){let n=Math.min(t.chosen.length,t.notChosen.length);for(;n>0;){const r=t.notChosen[await e.query({text:"Choose a Power to add to Days that Never Were.",query:pn.SelectPowerToGain,items:t.notChosen,actionIds:t.notChosen,players:[a]})];qr(t.notChosen,r),a.daysPowers.push(r),a.destinyPowers.includes(r)&&qr(a.destinyPowers,r),n-=1}}}})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Gain Air",[yn.Now]:async({you:e})=>{await e.gainElementsUntilEndOfTurn({[nr.Air]:1})}},{text:"Reclaim cards",[yn.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain up to 2 Time",[yn.Now]:async({you:e})=>{await e.gainTimeUpTo(2)}}]},{effects:[{text:"Gain Moon",[yn.Now]:async({you:e})=>{await e.gainElementsUntilEndOfTurn({[nr.Moon]:1})}},{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-2>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(2)}},{text:"x2: Gain 1 Time or +2 Card Plays",[yn.Now]:async({$:e,you:a})=>{await _r(2,(async t=>{await e.chooseBetween({text:`Gain 1 Time or +2 Card Plays. (${2-t} left.)`,effects:[{actionId:"Time",text:"Gain 1 Time",[yn.Now]:async()=>{await a.gainTime(1)}},{actionId:"CardPlays",text:"+2 Card Plays",[yn.Now]:async()=>{await a.gainCardPlays(2)}}]})}))}}]},{effects:[{text:"Gain Sun",[yn.Now]:async({you:e})=>{await e.gainElementsUntilEndOfTurn({[nr.Sun]:1})}},{text:"Move a <presence> in <range-4>.",[yn.Now]:async({you:e})=>{await e.movePresence(4)}},{text:"Gain Power Card from Days That Never Were",[yn.Now]:async({$:e,you:a})=>{const t=a.daysPowers[await e.query({text:"Choose a Power from Days that Never Were.",query:pn.SelectPowerToGain,items:a.daysPowers,actionIds:a.daysPowers,players:[a]})];qr(a.daysPowers,t),await a.gainPower(t),sg[t].type===Sn.Major&&await a.forgetPowers({duringPowerGain:!0})}},{text:"x3: Gain 1 Time or Gain 2 Energy",[yn.Now]:async({$:e,you:a})=>{await _r(3,(async t=>{await e.chooseBetween({text:`Gain 1 Time or Gain 2 Energy. (${3-t} left.)`,effects:[{actionId:"Time",text:"Gain 1 Time",[yn.Now]:async()=>{await a.gainTime(1)}},{actionId:"Energy",text:"+2 Energy",[yn.Now]:async()=>{await a.gainEnergy(2)}}]})}))}}]}],tracks:[{energy:1,name:"Top-track: 1 Energy"},{requires:0,energy:1,name:"Top-track: 1 Energy"},{requires:1,energy:2,name:"Top-track: 2 Energy"},{requires:2,energy:2,name:"Top-track: 2 Energy"},{requires:3,energy:2,name:"Top-track: 2 Energy"},{requires:4,energy:3,name:"Top-track: 3 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:6,cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:7,cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:8,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:9,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:10,cardPlays:3,name:"Bottom-track: 3 Card Plays"}],setup:[{text:"Put 3 <presence> on your starting board: 1 in the lowest-numbered land with 1 <dahan>, and 2 in the highest-numbered land without <dahan>.",[yn.Now]:async({$:e,you:a})=>{await a.startingBoard.inLandsFilteredByAllInPriority((a=>a.has(e.Dahan))).withLeast((a=>a.numberOf(e.Dahan))).withLeast((e=>e.landNumber)).anyOne.putPresence(1,a),await(a.startingBoard.highestNumberedLand((a=>!a.has(e.Dahan)))??a.startingBoard.highestNumberedLand()).putPresence(2,a)}},{text:"Deal 4 Minor and 4 Major Powers face-up as your initial Days That Never Were cards; in a 1 or 2-player game, instead deal 6 of each.",[yn.Now]:async({$:e,you:a})=>{const t=e.spiritCount<=2?6:4;for(const n of[Sn.Minor,Sn.Major])for(let r=0;r<t;r+=1){const t=await e.drawPower(n);t&&a.daysPowers.push(t)}}},{text:"In a 1-board game, gain 1 Time.",[yn.Now]:async({$:e,you:a})=>{1===e.boardCount&&await a.gainTime(1)}}],uniquePowers:[Mi.AbsoluteStasis,Mi.BlurTheArcOfYears,Mi.PourTimeSideways,Mi.ThePastReturnsAgain],innatePowers:[Mi.SlipTheFlowOfTime,Mi.VisionsOfAShiftingFuture]},Cy={name:"Lure of the Deep Wilderness",set:a.JaggedEarth,aspects:[zo.Lair],specialRules:[{name:"Home of the Island's Heart",text:"Your <presence> may only be added or moved to lands that are Inland.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.LureHomeOfTheIslandsHeart,[yn.GlobalReminder]:()=>({icon:"<presence><br>Inland",ongoing:!0,spirit:a,players:[a]}),[yn.PreventAddPresence]:({spirit:e,location:t,ignoreLandType:n})=>e===a&&!t.isInland&&!n,[yn.PreventMovePiece]:({piece:e,destination:t})=>e.isAPresenceOf(a)&&!t.isInland})}},{name:"Enthrall the Foreign Explorers",text:"For each of your <presence> in a land, ignore up to 2 <explorer> during the Ravage Step and any Ravage Actions.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.LureEnthrallTheForeignExplorers,[yn.DoesNotParticipateInRavage]:async({location:t})=>{await t.doNotParticipateInRavage({quantifier:lr.UpTo,amount:2*t.numberOfPresenceOf(a),pieces:e.Explorer})}})}}],pickOptions:[[0,1],[2,3]],growthOptions:[{effects:[{text:"Reclaim cards",[yn.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain +1 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(1)}}]},{effects:[{text:"Add a <presence> to inland Land",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(4,{filter:e=>e.isInland})}}]},{effects:[{text:"Gain Moon, Air, or Plant",[yn.Now]:async({you:e})=>{await e.gainElements({elements:[nr.Moon,nr.Air,nr.Plant]})}},{text:"Gain +2 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(2)}}]},{effects:[{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}}]}],tracks:[{energy:1,name:"Top-track: 1 Energy"},{requires:0,energy:2,name:"Top-track: 2 Energy"},{requires:1,elements:[nr.Moon],name:"Top-track: Moon"},{requires:2,energy:3,elements:[nr.Plant],name:"Top-track: 3 Energy, Plant"},{requires:3,energy:4,elements:[nr.Air],name:"Top-track: 4 Energy, Air"},{requires:4,energy:5,effect:{actionId:"ReclaimOne1",text:"Reclaim One",[yn.Now]:async({you:e})=>{await e.reclaim(1)}},effectRequires:({you:e})=>e.hasReclaimableCards,name:"Top-track: 5 Energy, Reclaim One"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:6,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:7,elements:[nr.Animal],name:"Bottom-track: Animal"},{requires:8,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:9,cardPlays:4,name:"Bottom-track: 4 Card Plays"},{requires:10,cardPlays:5,effect:{actionId:"ReclaimOne2",text:"Reclaim One",[yn.Now]:async({you:e})=>{await e.reclaim(1)}},name:"Bottom-track: 5 Card Plays, Reclaim One"}],setup:[{text:"Put 3 <presence> on your starting board: 2 in land #8, and 1 in land #7. Add 1 <beasts> to land #8.",[yn.Now]:async({you:e,$:a})=>{const t=e.startingBoard.inLandNumber(8);await t.putPresence(2,e),await t.add(1,a.Beasts),await e.startingBoard.inLandNumber(7).putPresence(1,e)}}],uniquePowers:[Mi.GiftOfTheUntamedWild,Mi.PerilsOfTheDeepestIsland,Mi.SoftlyBeckonEverInward,Mi.SwallowedByTheWilderness],innatePowers:[Mi.ForsakeSocietyToChaseAfterDreams,Mi.NeverHeardFromAgain]},Dy={name:"Many Minds Move as One",set:a.JaggedEarth,aspects:[],specialRules:[{name:"Fly fast as thought",text:"When you Gather or Push <beasts>, they may come from or go to lands up to 2 distant (rather than adjacent only).",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.ManyMinds,[yn.GlobalReminder]:()=>({icon:"<beasts><br><range-2>",ongoing:!0,spirit:a,players:[a]}),[yn.ExtraBeastAdjacency]:()=>(e.action.type===Ho.PowerAction||e.action.type===Ho.SpiritAction)&&e.action.spirit===a})}},{name:"A Joining of Swarms and Flocks",text:"Your <sacred> may also count as <beasts>. (Note: You never have more than 1 <sacred> in a land, no matter how many <presence> you have there.)<br><br>(If something changes a <beasts> that is your <sacred>, it affects 2 of your <presence> there - e.g., Push 1 <beasts> will Push 2 of your <presence> together.)",[yn.Now]:async({you:e})=>{await e.yourSacredSitesMayAlsoCountAs(Bn.Beasts)}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[yn.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}}]},{effects:[{text:"Add a <presence> in <range-1>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(1)}},{text:"Add a <presence> in <range-0>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(0)}}]},{effects:[{text:"Add a <presence> and a Beasts",[yn.Now]:async({you:e,$:a})=>{const t=await e.addPresenceInRange(3);t.length>0&&await t[0].location.add(1,a.Beasts)}},{text:"Gain +1 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(1)}},{text:"Gather up to 1 Beasts into a Land",[yn.Now]:({you:e,$:a})=>e.inLandsWithinRange(2).optionallyPickOne((async e=>{await e.gatherUpTo(1,a.Beasts)}))}]}],tracks:[{energy:0,name:"Top-track: 0 Energy"},{requires:0,energy:1,name:"Top-track: 1 Energy"},{requires:1,elements:[nr.Air],name:"Top-track: Air"},{requires:2,energy:2,name:"Top-track: 2 Energy"},{requires:3,elements:[nr.Animal],name:"Top-track: Animal"},{requires:4,energy:3,name:"Top-track: 3 Energy"},{requires:5,energy:4,name:"Top-track: 4 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:7,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:8,effect:{actionId:"GainPowerCard",text:"Pay 2 to Gain Powercard",[yn.Now]:async({you:e})=>{await e.payEnergy(2),await e.gainPowerCard()}},effectRequires:({you:e})=>e.energy>=2,name:"Bottom-track: Pay 2 to Gain Powercard"},{requires:9,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:10,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:11,cardPlays:4,name:"Bottom-track: 4 Card Plays"},{requires:12,cardPlays:5,name:"Bottom-track: 5 Card Plays"}],setup:[{text:"Put 1 <presence> and 1 <beasts> on your starting board, in a land with <beasts>.",[yn.Now]:async({you:e,$:a})=>{await e.startingBoard.inLandsFilteredByAllInPriority((e=>e.has(a.Beasts))).autoPickOne((async t=>{await t.putPresence(1,e),await t.add(1,a.Beasts)}))}}],uniquePowers:[Mi.ADreadfulTideOfScurryingFlesh,Mi.BoonOfSwarmingBedevilment,Mi.EvermultiplyingSwarm,Mi.GuideTheWayOnFeatheredWings,Mi.PursueWithScratchesPecksAndStings],innatePowers:[Mi.TheTeemingHostArrives,Mi.BesetAndConfoundTheInvaders]},By={name:"Shifting Memory of Ages",set:a.JaggedEarth,aspects:[zo.Intensify,zo.Mentor],specialRules:[{name:"Long Ages of Knowledge and Forgetfulness",text:"When you would Forget a Power Card from your hand, you may instead discard it. (Max. once per Action.)",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.MemoryKnowledge,[yn.GlobalReminder]:()=>({icon:"No<br>Forget",ongoing:!0,spirit:a,players:[a]}),[yn.PreventForgetPowercard]:async({power:t})=>!(e.action.type===Ho.GameAction||e.action.data.hasUsedLongAges||!t.isInHand||t.owner!==a||!await e.may({card:t.power,prompt:"Discard power instead of Forgetting it?"}))&&(e.action.data.hasUsedLongAges=!0,await t.discard(),!0)})}},{name:"Insights into the World's Nature",effects:[{text:"Each Element Marker spent grants 1 of that Element for a single Action. (E.g., one Power use.)",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.MemoryInsight,[yn.GlobalReminder]:()=>({icon:"Elements",ongoing:!0,spirit:a,players:[a]})})}}]}],pickOptions:[[0,1,2,3]],growthOptions:[{effects:[{text:"Reclaim cards",[yn.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Add a <presence> in <range-0>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(0)}}]},{effects:[{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-2>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(2)}}]},{effects:[{text:"Add a <presence> in <range-1>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(1)}},{text:"Gain +2 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(2)}}]},{effects:[{text:"Gain +9 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(9)}}]}],tracks:[{energy:0,name:"Top-track: 0 Energy"},{requires:0,energy:1,name:"Top-track: 1 Energy"},{requires:1,energy:2,name:"Top-track: 2 Energy"},{requires:2,energy:3,effect:{actionId:"Prepare1",text:"Prepare 1 Element",[yn.Now]:async({you:e})=>{await e.prepareElement()}},name:"Top-track: 3 Energy, Prepare 1"},{requires:3,energy:4,name:"Top-track: 4 Energy"},{requires:4,effect:{actionId:"ReclaimOne",text:"Reclaim One",[yn.Now]:async({you:e})=>{await e.reclaim(1)}},effectRequires:({you:e})=>e.hasReclaimableCards,name:"Top-track: Reclaim One"},{requires:5,energy:5,name:"Top-track: 5 Energy"},{requires:6,energy:6,effect:{actionId:"Prepare2",text:"Prepare 1 Element",[yn.Now]:async({you:e})=>{await e.prepareElement()}},name:"Top-track: 6 Energy, Prepare 1"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:8,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:9,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:10,effect:{actionId:"Discard",text:"Discard 2 Elements for +1 Card Play",[yn.Now]:async({you:e})=>{await e.discardElements(2),await e.gainCardPlays(1)}},effectRequires:({you:e})=>e.numberOfPreparedElements>=2,name:"Bottom-track: Discard 2 Elements for +1 Card Play"},{requires:11,cardPlays:3,name:"Bottom-track: 3 Card Plays"}],setup:[{text:"Put 2 <presence> on your starting board in the highest-numbered land that is Sands or Mountain.",[yn.Now]:async({you:e})=>{await e.startingBoard.highestNumberedLand((e=>e.isMountainsOrSands)).putPresence(2,e)}},{text:"Get out the element markers. Prepare 1 <moon>, 1 <air> and 1 <earth> marker (put them by your Special Rules).",[yn.Now]:({you:e})=>(e.preparedElements[nr.Moon]=1,e.preparedElements[nr.Air]=1,e.preparedElements[nr.Earth]=1,Promise.resolve())}],uniquePowers:[Mi.BoonOfAncientMemories,Mi.ElementalTeachings,Mi.ShareSecretsOfSurvival,Mi.StudyTheInvadersFears],innatePowers:[Mi.LearnTheInvadersTactics,Mi.ObserveTheEverChangingWorld]},ky={name:"Shroud of Silent Mist",set:a.JaggedEarth,aspects:[zo.Stranded],specialRules:[{name:"Gather Power from the Cool and Dark",text:"Once per turn, when you gain a Power Card without <fire>, gain 1 Energy.",[yn.Now]:async({$:e,you:a})=>{const t=Re.box(0);await e.addSubEffect({effectId:wn.ShroudGatherPowerFromTheCoolAndDark,[yn.GlobalReminder]:()=>({icon:`Energy<br>${t.get()}/1`,ongoing:!0,spirit:a,players:[a]}),[yn.AfterGainingPowers]:async({spirit:n,powerGain:r})=>{n!==a||r.gifted||r.taken||0!==t.get()||!r.chosen.some((e=>e.owner===a&&!e.data.elements.includes(nr.Fire)))||(await e.sendEvent({type:fn.GenericSub,text:`${n.nameLink} gained a Power Card without <fire>.`}),t.set(t.get()+1),await a.gainEnergy(1))},[yn.TimePasses]:()=>(t.set(0),Promise.resolve())})}},{name:"Mists Shift and Flow",text:"When targeting a land with a Power, you may Gather 1 of your <presence> into the target or an adjacent land. This can enable you to meet Range and targeting requirements.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.ShroudMistsShiftAndFlow,[yn.GlobalReminder]:()=>({icon:"Gather<br><presence>",ongoing:!0,spirit:a,players:[a]}),[yn.MayShift]:({spirit:e})=>e===a,[yn.AfterTargetingSource]:async({power:a,land:t})=>{if(!a.assisted&&(e.action.data.source=t,e.action.data.shiftedPresence=[],!a.validOriginSites.has(t))){const n=t.numberOfPresenceOf(a.owner,a.helpers),r=Math.max(2-n,0);r>0&&e.action.data.shiftedPresence.push(...(await t.gather({amount:r,pieces:e.Presence,pieceFilter:e=>null!==e.owner&&a.availablePresenceForTargeting.includes(e)})).map((e=>e.piece))),2===e.action.data.shiftedPresence.length&&(e.action.data.mustTargetAdjacent=!0)}},[yn.AfterTargetingLand]:async({targetIndex:a,power:t,land:n})=>{if(t.assisted)return;const r=t.range(a);void 0===e.action.data.shiftedPresence&&(e.action.data.shiftedPresence=[]);const{source:i}=e.action.data;if(t.validLandTargetsWithoutShift({targetIndex:a,source:i}).has(n)){if(e.action.data.shiftedPresence.length<a+1){const a=void 0===i?t.validOriginsGivenTargetLand(n):id.createCollection(e,[i]);let s=null,o=null;1===a.count&&(s=a.items[0],void 0!==i?2===s.numberOfPresenceOf(t.owner,t.helpers)&&(o=id.createCollection(e,[])):void 0!==t.data.sourceFilter&&t.data.sourceFilter.includes(sr.SacredSite)?2===s.numberOfPresenceOf(t.owner,t.helpers)&&(o=s.inAdjacentLandsWhere((e=>e.hasPresenceOf(t.owner,t.helpers)&&(null===r||e.landsWithin(r,t.owner,{targetingLands:!0}).includes(n))))):void 0===i&&1===s.numberOfPresenceOf(t.owner,t.helpers)&&(o=s.inAdjacentLandsWhere((e=>t.sourceFilter(e)&&(null===r||e.landsWithin(r,t.owner,{targetingLands:!0}).includes(n))))));const d=a=>n=>n.isPresence&&null!==n.owner&&!e.action.data.shiftedPresence.includes(n)&&t.availablePresenceForTargeting.includes(n)&&(n.location!==s||null===o||o.has(a));await n.inThisAndAdjacentLands().where((e=>e.hasAdjacentLandWhere((e=>e.hasOnePieceWhere(d(e)))))).optionallyPickOne((async a=>{e.action.data.shiftedPresence.push(...(await a.gather({pieces:e.Presence,pieceFilter:d(a)})).map((e=>e.piece)))}),{prompt:"Pick a land to Gather <presence> into."})}}else await t.landsWhichCanBeShiftedIntoToEnableTarget({targetLocation:n,range:t.range(a)}).autoPickOne((async a=>{await a.gather({pieces:e.Presence,pieceFilter:e=>null!==e.owner&&t.availablePresenceForTargeting.includes(e)})}))}})}},{name:"Slow and Silent Death",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.SlowAndSilentDeath,text:"Invaders and <dahan> in your lands don't heal Damage.",[yn.PreventClearDamage]:({piece:t})=>t.isA(e.InvaderOrDahan)&&!0===t.location?.hasPresenceOf(a)}),await e.addSubEffect({effectId:wn.SlowAndSilentDeath,text:"During Time Passes: 1 <fear> (max. 5) per land of yours with Damaged Invaders. Gain 1 Energy per 3 lands of yours with Damaged Invaders.",[yn.TimePasses]:async()=>{const t=a.inLandsWith(e.Invader).where((e=>e.hasOnePieceWhere((e=>e.damage>0)))).count;await e.fear(Math.min(t,5)),await a.gainEnergy(Math.floor(t/3))}})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[yn.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}}]},{effects:[{text:"Add a <presence> in <range-0>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(0)}},{text:"Add a <presence> in <range-0>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(0)}}]},{effects:[{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-3> to Mountain or Wetland",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(3,{filter:e=>e.isMountainsOrWetlands})}}]}],tracks:[{energy:0,name:"Top-track: 0 Energy"},{requires:0,energy:1,name:"Top-track: 1 Energy"},{requires:1,elements:[nr.Water],name:"Top-track: Water"},{requires:2,energy:2,name:"Top-track: 2 Energy"},{requires:3,elements:[nr.Air],name:"Top-track: Air"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:5,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:6,effect:{actionId:"MovePresence",text:"Move a <presence> 1",[yn.Now]:async({you:e})=>{await e.movePresence(1)}},name:"Bottom-track: Move a Presence 1"},{requires:7,elements:[nr.Moon],name:"Bottom-track: Moon"},{requires:8,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:9,cardPlays:4,name:"Bottom-track: 4 Card Plays"},{requires:10,effect:{actionId:"ReclaimOne",text:"Reclaim One",[yn.Now]:async({you:e})=>{await e.reclaim(1)}},effectRequires:({you:e})=>e.hasReclaimableCards,name:"Bottom-track: Reclaim One"},{requires:11,cardPlays:5,name:"Bottom-track: 5 Card Plays"}],setup:[{text:"Put 2 <presence> on your starting board: 1 in the highest-numbered Wetland and 1 in the highest-numbered Mountain.",[yn.Now]:async({you:e})=>{await e.startingBoard.highestNumberedTerrain(xo.Wetlands).putPresence(1,e),await e.startingBoard.highestNumberedTerrain(xo.Mountains).putPresence(1,e)}}],uniquePowers:[Mi.DissolvingVapors,Mi.FlowingAndSilentFormsDartBy,Mi.TheFogClosesIn,Mi.UnnervingPall],innatePowers:[Mi.SuffocatingShroud,Mi.LostInTheSwirlingHaze]};var Ly;!function(e){e.Available="Available",e.Chosen="Chosen",e.NotChosen="NotChosen",e.Unavailable="Unavailable",e.Inactive="Inactive"}(Ly||(Ly={}));const Fy=(e,a)=>({[yn.Now]:({you:t})=>(e.forEach((e=>{t.growthStatus[e]=Ly.Available})),a.forEach((e=>{t.growthStatus[e]=Ly.Unavailable})),Promise.resolve())}),Ry={name:"Starlight Seeks Its Form",set:a.JaggedEarth,aspects:[],specialRules:[{name:"Growth Begets Growth",effects:[{text:"You have 6 <presence> tracks. (As usual, you may add <presence> from any track.) 4 of the <presence> tracks are next to rows of Growth choices: these choices start unavailable.<br><br>Upon emptying a Growth track, pick one of its two Growth choices to be immediately available. The other stays unavailable for the rest of the game.",[yn.Now]:async({$:e,you:a})=>{a.growthStatus.forEach(((e,t)=>{a.growthStatus[t]=t>3?Ly.Inactive:Ly.Available})),await e.addSubEffect({effectId:wn.Starlight,[yn.GlobalReminder]:()=>({icon:"Tracks",ongoing:!0,spirit:a,players:[a]})})}}]}],pickOptions:[[0,1,2,3,4,5,6,7,8,9,10,11],[0,1,2,3,4,5,6,7,8,9,10,11],[0,1,2,3,4,5,6,7,8,9,10,11]],growthOptions:[{effects:[{text:"Reclaim One",[yn.Now]:async({you:e})=>{await e.reclaim(1)}}]},{effects:[{text:"Add a <presence> in <range-0>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(0)}}]},{effects:[{text:"Gain +1 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(1)}}]},{effects:[{text:"Move a <presence> in <range-3>",[yn.Now]:async({you:e})=>{await e.movePresence(3)}}]},{requiresTrackSpot:0,effects:[{text:"Reclaim half (round up)",[yn.Now]:async({you:e})=>{await e.reclaim(Math.ceil(e.powersWhere((e=>e.isInDiscard)).count/2))}}]},{requiresTrackSpot:0,effects:[{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Move a <presence> in <range-1>",[yn.Now]:async({you:e})=>{await e.movePresence(1)}}]},{requiresTrackSpot:1,effects:[{text:"Gain +3 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(3)}}]},{requiresTrackSpot:1,effects:[{text:"+1 Card Play this turn",[yn.Now]:async({you:e})=>{await e.gainCardPlays(1)}},{text:"Move a <presence> in <range-2>",[yn.Now]:async({you:e})=>{await e.movePresence(2)}}]},{requiresTrackSpot:3,effects:[{text:"Reclaim cards",[yn.Now]:async({you:e})=>{await e.reclaimCards()}}]},{requiresTrackSpot:3,effects:[{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Gain +1 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(1)}}]},{requiresTrackSpot:5,effects:[{text:"2 Damage at <range-0>",[yn.Now]:async({you:e})=>{await e.inLandsWithinRange(0).pickOne((async e=>{await e.damage(2)}))}}]},{requiresTrackSpot:5,effects:[{text:"+1 Card Play this turn",[yn.Now]:async({you:e})=>{await e.gainCardPlays(1)}},{text:"One of your Powers is Fast",[yn.Now]:async({you:e})=>{await e.gainMakeFastBuff()}}]},{effects:[Fy([4],[5,6]),Fy([5,6],[4]),Fy([7],[8,9]),Fy([8,9],[7]),Fy([10],[11,12]),Fy([11,12],[10]),Fy([13],[14,15]),Fy([14,15],[13])]}],tracks:[{name:"Track 1",covered:!0,uncoverEffect:{text:"Upon emptying a Growth track, pick on of its two Growth choices to be immediately available",[yn.Now]:async({you:e})=>{e.growthStatus[4]===Ly.Inactive&&await e.selectBetweenGrowthOptions(16,17)}}},{name:"Track 2",covered:!0,uncoverEffect:{text:"Upon emptying a Growth track, pick on of its two Growth choices to be immediately available",[yn.Now]:async({you:e})=>{e.growthStatus[7]===Ly.Inactive&&await e.selectBetweenGrowthOptions(18,19)}}},{name:"Track 3: Gain 1 Energy",covered:!0,uncoverEffect:{[yn.Now]:async({you:e})=>{await e.gainEnergy(1)}}},{requires:2,name:"Track 3: Gain 1 Energy, Element",uncoverEffect:{text:"Upon emptying a Growth track, pick on of its two Growth choices to be immediately available",[yn.Now]:async({you:e})=>{await e.gainEnergy(1),e.growthStatus[10]===Ly.Inactive&&await e.selectBetweenGrowthOptions(20,21),await e.addExtraTrackElement(3)}}},{name:"Track 4: Gain 1 Energy",covered:!0,uncoverEffect:{[yn.Now]:async({you:e})=>{await e.gainEnergy(1)}}},{requires:4,name:"Track 4: Gain 1 Energy",uncoverEffect:{text:"Upon emptying a Growth track, pick on of its two Growth choices to be immediately available",[yn.Now]:async({you:e})=>{await e.gainEnergy(1),e.growthStatus[13]===Ly.Inactive&&await e.selectBetweenGrowthOptions(22,23)}}},{energy:1,name:"Track 5: 1 Energy"},{requires:6,energy:2,name:"Track 5: 2 Energy"},{requires:7,name:"Track 5: Element",uncoverEffect:{text:"After revealing an star, place 1 Element Marker of your choice on it. The Element is permanent and is constantly available",[yn.Now]:async({you:e})=>{await e.addExtraTrackElement(8)}}},{requires:8,energy:4,name:"Track 5: 4 Energy"},{cardPlays:2,name:"Track 6: 2 Card Plays"},{requires:10,name:"Track 6: Element",uncoverEffect:{text:"After revealing an star, place 1 Element Marker of your choice on it. The Element is permanent and is constantly available",[yn.Now]:async({you:e})=>{await e.addExtraTrackElement(11)}}},{requires:11,name:"Track 6: Element",uncoverEffect:{text:"After revealing an star, place 1 Element Marker of your choice on it. The Element is permanent and is constantly available",[yn.Now]:async({you:e})=>{await e.addExtraTrackElement(12)}}},{requires:12,cardPlays:3,name:"Track 6: 3 Card Plays"}],setup:[{text:"Put 1 <presence> on your starting board, in a land with <blight>.",[yn.Now]:async({you:e,$:a})=>{await e.startingBoard.inLandsFilteredByAllInPriority((e=>e.has(a.Blight))).autoPickOne((async a=>{await a.putPresence(1,e)}))}}],uniquePowers:[Mi.BoonOfReimagining,Mi.GatherTheScatteredLightOfStars,Mi.PeaceOfTheNighttimeSky,Mi.ShapeTheSelfAnew],innatePowers:[Mi.AirMovesEarthEndures,Mi.FireBurnsWaterSoothes,Mi.WoodSeeksGrowthHumansSeekFreedom,Mi.SiderealGuidance,Mi.StarsBlazeInTheDaytimeSky]},Ny={name:"Stone's Unyielding Defiance",set:a.JaggedEarth,aspects:[],specialRules:[{name:"Bestow the Endurance of Bedrock",text:"When <blight> is added to one of your lands, unless the <blight> then outnumbers your <presence>, it does not cascade or Destroy <presence> (yours or others').",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Stone,[yn.GlobalReminder]:()=>({icon:"<blight><br><presence>",ongoing:!0,spirit:a,players:[a]}),[yn.PreventBlightDestroyingPresence]:({location:t})=>t.numberOf(e.Blight)<=t.numberOfPresenceOf(a),[yn.PreventCascade]:({location:t})=>Promise.resolve(t.numberOf(e.Blight)<=t.numberOfPresenceOf(a))})}},{name:"Deep Layers Exposed to the Surface",text:'The first time you uncover each of your "+1 Card Play" <presence> spaces gain a Minor Power.',[yn.Now]:async({$:e,you:a,...t})=>{const n=[],r={triggerId:e.nextTriggerId(),[yn.Now]:async()=>{await e.doSpiritAction((async()=>{await a.gainPowerCard({powerType:Sn.Minor})}),{spirit:a})}};await e.addSubEffect({effectId:wn.Stone,[yn.AfterUncoveringTrack]:async({spirit:i,trackIndex:s})=>{i===a&&!n.includes(s)&&[2,4,6].includes(s)&&(n.push(s),await e.addTrigger(r,t.effect,t.action))}})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[yn.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain 2 Earth",[yn.Now]:async({you:e})=>{await e.gainElementsUntilEndOfTurn({[nr.Earth]:2})}},{text:"Add a <presence> in <range-3>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(3,{filter:a=>a.isMountains||a.hasPresenceOf(e)})}}]},{effects:[{text:"Add a <presence> in <range-2>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(2)}},{text:"Gain +3 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(3)}}]},{effects:[{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-1>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(1)}}]}],tracks:[{energy:2,name:"Top-track: 2 Energy"},{requires:0,energy:3,name:"Top-track: 3 Energy"},{requires:1,extraCardPlays:1,name:"Top-track: +1 Card Play"},{requires:2,energy:4,name:"Top-track: 4 Energy"},{requires:3,extraCardPlays:1,name:"Top-track: +1 Card Play"},{requires:4,energy:6,name:"Top-track: 6 Energy"},{requires:5,extraCardPlays:1,name:"Top-track: +1 Card Play"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:7,elements:[nr.Earth],name:"Bottom-track: Earth"},{requires:8,elements:[nr.Earth],name:"Bottom-track: Earth"},{requires:9,elements:[nr.Earth],effect:{actionId:"ReclaimOne",text:"Reclaim One",[yn.Now]:async({you:e})=>{await e.reclaim(1)}},effectRequires:({you:e})=>e.hasReclaimableCards,name:"Bottom-track: Earth, Reclaim One"},{requires:10,elements:[nr.Earth,nr.Any],name:"Bottom-track: Earth, Any"},{requires:11,cardPlays:2,elements:[nr.Earth],name:"Bottom-track: 2 Card Plays, Earth"}],setup:[{text:"Put 2 <presence> on your starting board: 1 in the lowest-numbered Mountain without <dahan>; 1 in an adjacent land that has <blight> (if possible) or is Sands (if not).",[yn.Now]:async({you:e,$:a})=>{const t=e.startingBoard.inLandsFilteredByAllInPriority((e=>e.isMountains),(e=>!e.has(a.Dahan))).withLeast((e=>e.landNumber)).anyOne;await t.putPresence(1,e),await t.inAdjacentLandsWhere((a=>a.board===e.startingBoard)).filteredByAnyInPriority((e=>e.has(a.Blight)),(e=>e.isSands)).autoPickOne((async a=>{await a.putPresence(1,e)}))}}],uniquePowers:[Mi.JaggedShardsPushFromTheEarth,Mi.PlowsShatterOnRockyGround,Mi.ScarredAndStonyLand,Mi.StubbornSolidity],innatePowers:[Mi.HoldTheIslandFastWithABulwarkOfWill,Mi.LetThemBreakThemselvesAgainstTheStone]},$y={name:"Grinning Trickster Stirs Up Trouble",set:a.JaggedEarth,aspects:[],specialRules:[{name:"A Real Flair for Discord",text:"After one of your Powers add <strife> in a land, you may pay 1 Energy to add <strife> within <range-1> of that land.",[yn.Now]:async({$:e,you:a,...t})=>{const n={triggerId:e.nextTriggerId(),[yn.Now]:async({action:t})=>{a.energy>=1&&await e.inLandsWhere((e=>{for(const n of t.parentData.landsWithAddedStrife)if(n.landsWithin(1,a).includes(e))return!0;return!1})).optionallyPickOne((async e=>{await a.payEnergy(1),await e.addStrife(1)}),{prompt:"Pick a land to pay 1 energy to add <strife>."})}};await e.addSubEffect({effectId:wn.Trickster,[yn.GlobalReminder]:()=>({icon:"<range-1><br><strife>",ongoing:!0,spirit:a,players:[a]}),[yn.AfterAddingStrife]:async({piece:r})=>{e.action.type===Ho.PowerAction&&e.action.spirit===a&&(void 0===e.action.data.landsWithAddedStrife&&(e.action.data.landsWithAddedStrife=[]),e.action.data.landsWithAddedStrife.push(r.location),await e.addTrigger(n,t.effect,t.action))}})}},{name:"Cleaning up Messes is a Drag",text:"After one of your Power Removes <blight>, Destroy 1 of your <presence>. Ignore this rule for Let's See What Happens.",[yn.Now]:async({$:e,you:a,...t})=>{const n={triggerId:e.nextTriggerId(),[yn.Now]:async()=>{await a.destroyPresence(1)}};await e.addSubEffect({effectId:wn.Trickster,[yn.GlobalReminder]:()=>({icon:"<broken>",ongoing:!0,spirit:a,players:[a]}),[yn.AfterRemovePiece]:async({piece:r,removement:i})=>{r.isA(e.Blight)&&e.action.type===Ho.PowerAction&&e.action.power.power!==Mi.LetsSeeWhatHappens&&e.action.spirit===a&&i===Nn.Remove&&await e.addTrigger(n,t.effect,t.action)}})}}],pickOptions:[[0,1,2,3],[0,1,2,3]],growthOptions:[{cost:1,effects:[{text:"Reclaim cards",[yn.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Move a <presence> in <range-1>",[yn.Now]:async({you:e})=>{await e.movePresence(1)}}]},{effects:[{text:"Add a <presence> in <range-2>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(2)}}]},{effects:[{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}}]},{effects:[{text:"Gain Energy equal to Card Plays",[yn.Now]:async({you:e})=>{await e.gainEnergy(e.baseCardPlays)}}]}],tracks:[{energy:1,name:"Top-track: 1 Energy"},{requires:0,elements:[nr.Moon],name:"Top-track: Moon"},{requires:1,energy:2,name:"Top-track: 2 Energy"},{requires:2,elements:[nr.Any],name:"Top-track: Any"},{requires:3,elements:[nr.Fire],name:"Top-track: Fire"},{requires:4,energy:3,name:"Top-track: 3 Energy"},{cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:6,effect:{actionId:"PushDahan",text:"Push 1 Dahan from one of your Lands",[yn.Now]:({you:e,$:a})=>e.forPiecesThatIs(a.Dahan).pickOne((async e=>{await e.push()}))},name:"Bottom-track: Push 1 Dahan"},{requires:7,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:8,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:9,cardPlays:4,name:"Bottom-track: 4 Card Plays"},{requires:10,elements:[nr.Air],name:"Bottom-track: Air"},{requires:11,cardPlays:5,name:"Bottom-track: 5 Card Plays"}],setup:[{text:"Put 2 <presence> on your starting board: 1 in the highest-numbered land with <dahan>, and 1 in land #4.",[yn.Now]:async({you:e,$:a})=>{await e.startingBoard.inLandsFilteredByAllInPriority((e=>e.has(a.Dahan))).withMost((e=>e.landNumber)).anyOne.putPresence(1,e),await e.startingBoard.inLandNumber(4).putPresence(1,e)}}],uniquePowers:[Mi.ImpersonateAuthority,Mi.InciteTheMob,Mi.OverenthusiasticArson,Mi.UnexpectedTigers],innatePowers:[Mi.LetsSeeWhatHappens,Mi.WhyDontYouAndThemFight]},Wy={name:"Vengeance as a Burning Plague",set:a.JaggedEarth,aspects:[],specialRules:[{name:"The Terror of a Slowly Unfolding Plague",text:"When <disease> would prevent a Build on a board with your <presence>, you may let the Build happen (Removing no <disease>). If you do, 1 <fear>.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Vengeance,[yn.GlobalReminder]:()=>({icon:"<disease><br>= <fear>",ongoing:!0,spirit:a,players:[a]}),[yn.PreventDiseasePreventingBuilds]:async({location:t})=>!(!t.boards().hasOneWhere((e=>e.hasOneLandWhere((e=>e.hasPresenceOf(a)))))||!await e.may({prompt:"Let the Build happen? (Removing no <disease>). If you do, 1 <fear>.",highlightLocations:[t]}))&&(await t.fear(1),!0)})}},{name:"Lingering Pestilence",text:"When your <presence> is Destroyed by anything except a Spirit Action, add 1 <disease> where each Destroyed <presence> was.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Vengeance,[yn.GlobalReminder]:()=>({icon:"<broken><br>= <disease>",ongoing:!0,spirit:a,players:[a]}),[yn.AfterRemovePiece]:async({piece:t,location:n,removement:r})=>{t.isAPresenceOf(a)&&pr[r].isDestroyLike&&e.action.type!==Ho.SpiritAction&&e.action.type!==Ho.PowerAction&&await n.add(1,e.Disease)}})}},{name:"Wreak Vengeance for the Land's Corruption",text:"Your Actions treat <blight> on the island as also being <badlands>.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Vengeance,[yn.GlobalReminder]:()=>({icon:"<blight><br>= <badlands>",ongoing:!0,spirit:a,players:[a]})})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[yn.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Gain +1 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(1)}}]},{effects:[{text:"Add a <presence> in <range-2> to a Land with Town/City/Blight",[yn.Now]:async({you:e,$:a})=>{await e.addPresenceInRange(2,{filter:e=>e.has(a.TownOrCity)||e.has(a.Blight)})}},{text:"Add a <presence> in <range-2> to a Land with Town/City/Blight",[yn.Now]:async({you:e,$:a})=>{await e.addPresenceInRange(2,{filter:e=>e.has(a.TownOrCity)||e.has(a.Blight)})}}]},{effects:[{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> or Disease in <range-1>",[yn.Now]:async({you:e,$:a})=>{await a.chooseBetween({effects:[{actionId:"Presence",text:"Add a <presence>.",[yn.Now]:async()=>{await e.addPresenceInRange(1)}},{actionId:"Disease",text:"Add a <disease>.",[yn.Now]:()=>e.inLandsWithinRange(1).pickOne((async e=>{await e.add(1,a.Disease)}))}]})}},{text:"Gain +1 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(1)}}]}],tracks:[{energy:1,name:"Top-track: 1 Energy"},{requires:0,energy:2,name:"Top-track: 2 Energy"},{requires:1,elements:[nr.Animal],name:"Top-track: Animal"},{requires:2,energy:3,name:"Top-track: 3 Energy"},{requires:3,energy:4,name:"Top-track: 4 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:5,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:6,elements:[nr.Fire],name:"Bottom-track: Fire"},{requires:7,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:8,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:9,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:10,cardPlays:4,name:"Bottom-track: 4 Card Plays"}],setup:[{text:"1 of your <presence> starts the game already destroyed.",[yn.Now]:({you:e})=>(e.destroyedPresence=1,Promise.resolve())},{text:"Put 2 <presence> on your starting board: 1 in a land with <blight>, 1 in a Wetland without <dahan>.",[yn.Now]:async({you:e,$:a})=>{await e.startingBoard.inLandsFilteredByAllInPriority((e=>e.has(a.Blight))).autoPickOne((async a=>{await a.putPresence(1,e)}),{prompt:"Pick a land with <blight>."}),await e.startingBoard.inLandsFilteredByAllInPriority((e=>e.isWetlands),(e=>!e.has(a.Dahan))).autoPickOne((async a=>{await a.putPresence(1,e)}),{prompt:"Pick a <wetlands>."})}}],uniquePowers:[Mi.FetidBreathSpreadsInfection,Mi.FieryVengeance,Mi.Plaguebearers,Mi.StrikeLowWithSuddenFevers],innatePowers:[Mi.EpidemicsRunRampant,Mi.SavageRevenge]},My={name:"Volcano Looming High",set:a.JaggedEarth,aspects:[],specialRules:[{name:"Mountain Home",text:"Your <presence> may only be added or moved into Mountains.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Volcano,[yn.GlobalReminder]:()=>({icon:"<presence><br><mountains>",ongoing:!0,spirit:a,players:[a]}),[yn.PreventAddPresence]:({spirit:e,location:t,ignoreLandType:n})=>e===a&&!t.isMountains&&!n,[yn.PreventMovePiece]:({piece:e,destination:t})=>e.isAPresenceOf(a)&&!t.isMountains})}},{name:"Collapse in a blast of Lava and Steam",text:"When your <presence> is Destroyed, in that land, deal 1 Damage per Destroyed <presence> to both Invaders and to <dahan>.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Volcano,[yn.GlobalReminder]:()=>({icon:"<broken><br>= 1 <damage>",ongoing:!0,spirit:a,players:[a]}),[yn.AfterRemovePiece]:async({piece:t,location:n,removement:r})=>{t.isAPresenceOf(a)&&pr[r].isDestroyLike&&(await n.damage(1,e.Invader),await n.damage(1,e.Dahan))}})}},{name:"Volcanic Peaks Tower over the Landscape",text:"Your Power Cards gain <range+1> if you have 3 or more <presence> in the origin land.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Volcano,[yn.ExtraRange]:({spirit:t,location:n})=>t===a&&n.numberOfPresenceOf(a)>=3&&e.action.power?.isA(En.AnyCard)?1:0})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[yn.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Gain +3 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(3)}}]},{effects:[{text:"Add a <presence> in <range-0>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(0)}},{text:"Add a <presence> in <range-0>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(0)}}]},{effects:[{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-4>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(4)}},{text:"+1 Card Play this turn",[yn.Now]:async({you:e})=>{await e.gainCardPlays(1)}},{text:"Gain +2 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(2)}}]}],tracks:[{energy:1,name:"Top-track: 1 Energy"},{requires:0,energy:2,name:"Top-track: 2 Energy"},{requires:1,elements:[nr.Earth],name:"Top-track: Earth"},{requires:2,energy:3,name:"Top-track: 3 Energy"},{requires:3,energy:4,name:"Top-track: 4 Energy"},{requires:4,energy:5,name:"Top-track: 5 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:6,elements:[nr.Fire],name:"Bottom-track: Fire"},{requires:7,elements:[nr.Earth],name:"Bottom-track: Earth"},{requires:8,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:9,elements:[nr.Air],name:"Bottom-track: Air"},{requires:10,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:11,elements:[nr.Fire],name:"Bottom-track: Fire"},{requires:12,cardPlays:4,name:"Bottom-track: 4 Card Plays"}],setup:[{text:"Put 1 <presence> and 1 <badlands> on your starting board in a Mountain of your choice. Push all <dahan> from that land.",[yn.Now]:async({you:e,$:a})=>{await e.startingBoard.inMountains().pickOne((async t=>{await t.putPresence(1,e),await t.add(1,a.Badlands),await t.pushAll(a.Dahan)}))}}],uniquePowers:[Mi.ExaltationOfMoltenStone,Mi.LavaFlows,Mi.PyroclasticBombardment,Mi.RainOfAsh],innatePowers:[Mi.ExplosiveEruption,Mi.PoweredByTheFurnaceOfTheEarth]},Gy={name:"Ember-Eyed Behemoth",set:a.NatureIncarnate,aspects:[],specialRules:[{name:"The Behemoth Rises",text:"You have an Incarna. Once per turn, during the Spirit, <fast>, or <slow> phase, you may either: <br><bullet> Push <incarna-behemoth>; or<br><bullet> Add or Move <incarna-behemoth> to any of your <sacred> on the island.",[yn.Now]:async({$:e,you:a})=>{await a.addExtraAction({actionId:"TheBehemothRises",icon:"<incarna-behemoth>",maxUses:()=>e.hasEffectNamed("Extra Behemoth Rises")?2:1,enabled:()=>[Wi.Grow,Wi.GainEnergy,Wi.FastPowers,Wi.SlowPowers].includes(e.phase),onActivate:async()=>{await e.chooseBetween({text:"You may:<br>Push <incarna-behemoth>.<or>Add or Move <incarna-behemoth> to any of your <sacred> on the island.",effects:[{actionId:"Push",text:"Push <incarna-behemoth>",[yn.Now]:async()=>{await a.incarna.push()},condition:()=>a.hasIncarna},{actionId:"Add",text:"Add <incarna-behemoth> to any of your <sacred> on the island.",label:"Add <incarna-behemoth>.",[yn.Now]:async()=>{await a.addIncarna(Bn.IncarnaBehemoth,(e=>e.hasSacredSiteOf(a)))},condition:()=>!a.hasIncarna},{actionId:"Move",text:"Move <incarna-behemoth> to any of your <sacred> on the island.",label:"Move <incarna-behemoth>.",[yn.Now]:async()=>{await a.incarna.move({locations:{target:Jn.AnyLands},destinationFilter:e=>e.hasSacredSiteOf(a)})},condition:()=>a.hasIncarna}]},{orChoice:!1})}})}},{name:"Unrelenting Strides",text:"On any turn that you don't use Innate Powers, you may use the Behemoth Rises an additional time.",[yn.Now]:async({$:e,you:a})=>{await a.addExtraAction({actionId:"UnrelentingStrides",icon:"Strides",enabled:()=>[Wi.Grow,Wi.GainEnergy,Wi.FastPowers,Wi.SlowPowers].includes(e.phase)&&!a.innatePowers.some((e=>e.isResolved)),onActivate:async()=>{for(const e of a.innatePowers)await e.setResolved();await e.addSubEffectUntilEndOfTurn({name:"Extra Behemoth Rises"})}})}},{name:"Incarna",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Behemoth,text:"<incarna-behemoth> may count as <presence>.<br><br>When empowered it may also count as <sacred>.",[yn.GlobalReminder]:()=>({icon:"<incarna-behemoth> =<br><presence>"+(a.hasEmpoweredIncarna?"/<sacred>":""),ongoing:!0,spirit:a,players:[a]}),[yn.HasSacredSiteOf]:({land:e,spirit:t})=>t===a&&a.hasEmpoweredIncarna&&e.pieces.some((e=>e.piece===Bn.IncarnaBehemoth))})}}],pickOptions:[[0,1,2,3]],growthOptions:[{effects:[{text:"Reclaim cards",[yn.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}}]},{effects:[{text:"Add a <presence> in <range-3>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(3,{filter:a=>a.isJungle||a.hasPresenceOf(e)})}},{text:"Add a <presence> in <range-0>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(0)}}]},{effects:[{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-1>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(1)}},{text:"Gain +3 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(3)}},{text:"Discard a Power Card with <fire>",[yn.Now]:async({you:e})=>{await e.discardPowerCards(1,(e=>sg[e.power].elements.includes(nr.Fire)))}}]},{oncePerGame:!0,effects:[{text:"Reclaim All Cards with Fire",[yn.Now]:async({you:e})=>{await e.reclaimCards({filter:e=>e.isInDiscard&&sg[e.power].elements.includes(nr.Fire)})}},{text:"Empower Incarna",[yn.Now]:async({you:e})=>{await e.empowerIncarna()}},{text:"Move Incarna",[yn.Now]:async({you:e})=>{await(e.incarna?.move({owner:e,locations:{target:Jn.WithinRange,range:1,spirit:e}}))}}]}],tracks:[{energy:0,name:"Top-track: 0 Energy"},{requires:0,energy:1,name:"Top-track: 1 Energy"},{requires:1,energy:2,elements:[nr.Fire],name:"Top-track: 2 Energy, Fire"},{requires:2,energy:3,name:"Top-track: 3 Energy"},{requires:3,elements:[nr.Earth],name:"Top-track: Earth"},{requires:4,energy:4,elements:[nr.Plant],name:"Top-track: 4 Energy, Plant"},{requires:5,energy:5,elements:[nr.Fire],name:"Top-track: 5 Energy, Fire"},{cardPlays:1,name:"Bottom-track: 1 Card Plays"},{requires:7,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:8,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:9,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:10,elements:[nr.Fire],name:"Bottom-track: Fire"},{requires:11,cardPlays:4,name:"Bottom-track: 4 Card Plays"}],setup:[{text:"Put 2 <presence> and <incarna-behemoth> in the highest-numbered Wetland on your starting board that is adjacent to any Jungle.",[yn.Now]:async({you:e})=>{await e.startingBoard.inLandsFilteredByAllInPriority((e=>e.isWetlands),(e=>e.hasAdjacentLandWhere((e=>e.isJungle)))).withMost((e=>e.landNumber)).autoPickOne((async a=>{await a.putPresence(2,e),await a.putIncarna(Bn.IncarnaBehemoth,e)}))}}],uniquePowers:[Mi.BlazingIntimidation,Mi.ExaltationOfGraspingRoots,Mi.SurgingLahar,Mi.TerrifyingRampage],innatePowers:[Mi.SmashStompAndFlatten]},Hy={name:"Breath of Darkness Down your Spine",set:a.NatureIncarnate,aspects:[],specialRules:[{name:"Terror Stalks the Land",effects:[{text:"You may Abduct 1 <explorer>/<town> at empowered <incarna-darkness> each <fast> Phase.",[yn.Now]:async({$:e,you:a})=>{await a.addExtraAction({actionId:"TerrorStalks",icon:"Abduct",visible:()=>a.hasEmpoweredIncarna&&null!=a.incarna,enabled:()=>null!=a.incarna&&a.hasEmpoweredIncarna&&e.phase===Wi.FastPowers,onActivate:async()=>{await(a.incarna.location?.abduct(1,e.ExplorerOrTown))}})}},{text:"To Abduct a piece, Move it to The Endless Dark (<endless-dark>). When pieces Escape, Move them to non-Ocean lands with your <presence>/<incarna-darkness>; if they have no legal land to move to, you lose.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Darkness,[yn.GlobalReminder]:()=>({icon:"Abduct<br>Escape",ongoing:!0,spirit:a,players:[a]})})}},{text:"When your Powers would directly damage or directly destroy the only Invader in a land, instead Abduct it.<br><br>(Check if it is alone at the start of the damage/destroy instruction. <endless-dark> is not a land.)",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Darkness,[yn.GlobalReminder]:()=>({icon:"<damage> =<br>Abduct",ongoing:!0,spirit:a,players:[a]}),[yn.PreventDamagingPiece]:async({piece:t})=>!(e.hasAttemptedDamagingInvaderThisInstruction||e.action.spirit!==a||!t.isInvader||!t.location.isLand||1!==t.location.numberOf(e.Invader))&&(await t.abduct(),!0),[yn.PreventRemovePiece]:async({piece:t,removement:n})=>!(e.hasAttemptedDestroyingInvaderThisInstruction||e.action.spirit!==a||!pr[n].isDestroyLike||n===Nn.DestroyByHealthChange||!t.isInvader||!t.location.isLand||1!==t.location.numberOf(e.Invader))&&(await t.abduct(),!0)})}}]},{name:"Shadow-Touched Realm",text:"Your land-targeting Powers can target <endless-dark> as if it were a land, ignoring Range. (<endless-dark> is Inland and has no terrain.)",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Darkness,[yn.GlobalReminder]:()=>({icon:"Target<br>ED",ongoing:!0,spirit:a,players:[a]}),[yn.MayTargetTheEndlessDark]:()=>e.currentActionType===Ho.PowerAction&&e.action.spirit===a,[yn.MayIgnoreRangeWhenTargetingLand]:({power:t,land:n})=>t.owner===a&&n===e.theEndlessDark})}},{name:"Trapped in The Endless Dark",text:"Fear Cards and Token Events affect pieces here as if this were an Inland land but can't remove Invaders here - when they would, instead 1 <fear> per Invader they would have removed.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Darkness,[yn.GlobalReminder]:()=>({icon:"Fear<br>Events",ongoing:!0,spirit:a,players:[a]}),[yn.PreventRemovePiece]:async({piece:a,removement:t})=>!(e.action.type!==Ho.FearAction&&e.action.type!==Ho.TokenEventAction||!a.isInvader||!a.location.isTheEndlessDark||t!==Nn.Remove)&&(await a.location.fear(1),!0)})}},{name:"A Space of Strange and Infinite Darkness",text:"The Endless Dark (<endless-dark>) is on the island, but isn't a land and isn't on any board.<br><br><bullet> This can't be a <sacred>.<br><bullet> Spirits can't target this even if they have <presence> here.<br><bullet> Adding <blight> here doesn't destroy <presence>.<br><bullet> Special rules that affect lands do nothing here.<br><bullet> Invaders can't take Actions here.<br><bullet> Pieces here are on the island when checking for Victory/Defeat.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Darkness,[yn.GlobalReminder]:()=>({icon:"<endless-dark>",ongoing:!0,spirit:a,players:[a]})})}},{name:"Incarna",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Darkness,text:"<incarna-darkness> may count as <presence>/<beasts>.",[yn.GlobalReminder]:()=>({icon:"<incarna-darkness> =<br><presence>/<beasts>",ongoing:!0,spirit:a,players:[a]})})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[yn.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Move Incarna to Any Land",[yn.Now]:async({you:e})=>{await(e.incarna?.location.move({pieces:Qn.IncarnaDarkness,owner:e,locations:{target:Jn.AnyLands}}))}},{text:"All Pieces Escape",[yn.Now]:async({you:e})=>{await e.escapePieces()}}]},{effects:[{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-3>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(3)}},{text:"Two Pieces Escape",[yn.Now]:async({you:e})=>{await e.escapePieces(2)}}]},{effects:[{text:"Add a <presence> in <range-1>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(1)}},{text:"Add/Move <incarna-darkness> to Land with Your Presence",[yn.Now]:async({you:e})=>{await e.addOrMoveIncarnaToLandWithPresence(Bn.IncarnaDarkness)}},{text:"One Piece Escapes",[yn.Now]:async({you:e})=>{await e.escapePieces(1)}},{text:"Gain Energy equal to Card Plays",[yn.Now]:async({you:e})=>{await e.gainEnergy(e.baseCardPlays)}}]}],tracks:[{energy:1,name:"Top-track: 1 Energy"},{requires:0,energy:2,name:"Top-track: 2 Energy"},{requires:1,elements:[nr.Moon],name:"Top-track: Moon"},{requires:2,energy:3,name:"Top-track: 3 Energy"},{requires:3,name:"Empower Incarna",uncoverEffect:{text:"Empower Incarna",[yn.Now]:async({you:e})=>{await e.empowerIncarna()}}},{requires:4,energy:4,elements:[nr.Animal],name:"Top-track: 4 Energy, Animal"},{requires:5,energy:5,elements:[nr.Air],name:"Top-track: 5 Energy, Air"},{cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:7,effect:{actionId:"MovePresence",text:"Move a <presence> 1",[yn.Now]:async({you:e})=>{await e.movePresence(1)}},name:"Bottom-track: Move a Presence 1"},{requires:8,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:9,elements:[nr.Moon],name:"Bottom-track: Moon"},{requires:10,effect:{actionId:"ReclaimOne",text:"Reclaim One",[yn.Now]:async({you:e})=>{await e.reclaim(1)}},effectRequires:({you:e})=>e.hasReclaimableCards,name:"Bottom-track: Reclaim One"},{requires:11,cardPlays:4,elements:[nr.Air],name:"Bottom-track: 4 Card Plays, Air"}],setup:[{text:"Put 2 <presence> and your Incarna (<incarna-darkness>) on your starting board: 1 <presence> and <incarna-darkness> in the lowest-numbered Jungle and 1 in the highest-numbered Jungle.",[yn.Now]:async({you:e})=>{const a=e.startingBoard.lowestNumberedTerrain(xo.Jungles);await a.putPresence(1,e),await a.putIncarna(Bn.IncarnaDarkness,e),await e.startingBoard.highestNumberedTerrain(xo.Jungles).putPresence(1,e)}},{text:"Set The Endless Dark (<endless-dark>) tile next to the island with 1 <explorer> on it.",[yn.Now]:async({$:e})=>{await e.theEndlessDark.add(1,e.Explorer)}}],uniquePowers:[Mi.EmergeFromTheDreadNightWind,Mi.ReachFromTheInfiniteDarkness,Mi.SwallowedByTheEndlessDark,Mi.TerrorOfTheHunted],innatePowers:[Mi.LeaveATrailOfDeathlySilence,Mi.LostInTheEndlessDark]},jy={name:"Dances Up Earthquakes",set:a.NatureIncarnate,aspects:[],specialRules:[{name:"Begin a Dance of Decades",text:"Whenever you would play a Power Card, you may instead pay any amount of Energy onto the card to make it an impending card (<impending>), setting it aside out of play for use on a future turn. (It doesn't provide Elements. It's still your Power Card, so it can be Forgotten.)",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Earthquakes,[yn.GlobalReminder]:()=>({icon:"Dance<br>Decades",ongoing:!0,spirit:a,players:[a]}),[yn.CanPlayCardsWithoutCost]:({spirit:e})=>e===a,[yn.AdjustPlayPower]:async({power:t})=>{let n=!1;return t.owner===a&&t.isA(En.AnyCard)&&await e.chooseBetween({effects:[{actionId:`Play${t.power}`,text:"Play Power.",[yn.Now]:()=>Promise.resolve(),condition:()=>a.energy>=t.costToPlay&&a.usedCardPlays-a.cardsMadeImpendingThisTurn.length<=a.cardPlays-a.impendingCardPlays},...[...Array(Math.max(t.data.energy??0,1)).keys()].map((r=>({actionId:`Impend${r}${t.power}`,text:`Impend with ${r} energy.`,[yn.Now]:async()=>{n=!0,await e.sendEvent({type:fn.PowerCardImpended,spirit:t.owner,power:t,energy:r}),await t.setImpending(r),await a.payEnergy(r)},condition:()=>a.energy>=r})))]}),n}})}},{name:"Rhythmic Power Builds to a Cataclysmic Crescendo",text:"When you gain Energy from your Presence Track, also gain Energy onto each Power Card made <impending> on a previous turn. If any <impending> now have Energy on them at least equal to their cost, discard that Energy and play them. (This cost no card plays.)",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Earthquakes,[yn.GlobalReminder]:()=>({icon:"Rhythmic<br>Power",ongoing:!0,spirit:a,players:[a]}),[yn.AfterGainingEnergyFromTracks]:async()=>{for(const e of a.powers)e.isImpending&&(e.impendingEnergy+=a.impendingEnergy,e.impendingEnergy>=(e.data.energy??0)&&(e.impendingEnergy=0,await e.play({withoutPaying:!0,withoutUsingCardPlays:!0,withoutImpending:!0})))}})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[yn.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Add a <presence>.<or>Gain Major Power without Forgetting.",[yn.Now]:({you:e,$:a})=>a.chooseBetween({effects:[{actionId:"Presence",text:"Add a <presence> in <range-2>.",[yn.Now]:async()=>{await e.addPresenceInRange(2)}},{actionId:"MajorPower",text:"Gain Major Power without Forgetting.",[yn.Now]:async()=>{await e.gainPowerCard({powerType:Sn.Major,withoutForgetting:!0})}}]})}]},{effects:[{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-1>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(1)}}]},{effects:[{text:"Add a <presence> in <range-3>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(3)}},{text:"This Turn, Gain +1/-1 Energy on up to 2 Impending Power Cards",[yn.Now]:async({$:e,you:a})=>{await a.powersWhere((e=>e.isImpending)).pickMultiple({amount:2,optional:!0,forPickedItem:async a=>{await e.chooseBetween({highlightPowers:[a],effects:[{actionId:"AddEnergy",text:"Add 1 Impending Energy",[yn.Now]:()=>(a.impendingEnergy+=1,Promise.resolve())},{actionId:"RemoveEnergy",text:"Remove 1 Impending Energy",[yn.Now]:()=>(a.impendingEnergy-=1,Promise.resolve())}]})}})}},{text:"Reclaim One",[yn.Now]:async({you:e})=>{await e.reclaim(1)}}]}],tracks:[{energy:1,impendingEnergy:1,name:"Top-track: 1 Energy, 1 Energy on each impending card"},{requires:0,effect:{actionId:"MovePresence",text:"Move a <presence> 1",[yn.Now]:async({you:e})=>{await e.movePresence(1)}},name:"Top-track: Move a Presence 1"},{requires:1,energy:2,name:"Top-track: 2 Energy"},{requires:2,impendingCardPlays:1,name:"Top-track: +1 Play for Impending Only"},{requires:3,energy:3,name:"Top-track: 3 Energy"},{requires:4,impendingEnergy:1,name:"Top-track: 2 Energy/Turn on Impending card"},{requires:5,energy:4,elements:[nr.Any],name:"Top-track: 4 Energy, Any"},{cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:7,effect:{actionId:"GatherDahan",text:"Gather 1 Dahan into 1 of your Lands",[yn.Now]:({you:e,$:a})=>e.inLandsWhere((e=>e.hasAdjacentLandWithPiece(a.Dahan))).pickOne((async e=>{await e.gatherOne(a.Dahan)}),{noOptions:"None of your lands have an adjacent <dahan>."})},name:"Bottom-track: Gather 1 Dahan into 1 of your Lands"},{requires:8,elements:[nr.Moon,nr.Fire],name:"Bottom-track: Moon, Fire"},{requires:9,impendingCardPlays:1,name:"Bottom-track: +1 Play for Impending Only"},{requires:10,elements:[nr.Earth],name:"Bottom-track: Earth"},{requires:11,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:12,cardPlays:4,name:"Bottom-track: 4 Card Plays"}],setup:[{text:"Put 1 <presence> on your starting board in the highest-numbered land with <dahan>.",[yn.Now]:async({you:e,$:a})=>{await e.startingBoard.inLandsFilteredByAllInPriority((e=>e.has(a.Dahan))).withMost((e=>e.landNumber)).autoPickOne((async a=>{await a.putPresence(1,e)}))}}],uniquePowers:[Mi.ExaltationOfEchoedSteps,Mi.GiftOfSeismicEnergy,Mi.InspireAWindingDance,Mi.RadiatingTremors,Mi.ResoundingFootfallsSowDismay,Mi.RumblingsPortendAGreaterQuake],innatePowers:[Mi.LandCreaksWithTension,Mi.EarthShuddersBuildingsFall]},Uy={name:"Relentless Gaze of the Sun",set:a.NatureIncarnate,aspects:[],specialRules:[{name:"Relentless Punishment",text:"After using a Power Card, if you had at least 3 <presence> in the origin land, you may Repeat it any number of times on the same target land(s) (ignoring origin, Range, and target requirements) by paying both:<br><br><bullet> the Energy cost of the Power, and<br><br><bullet> 1 Energy per previous use of the Power this turn each time you repeat the Power.",[yn.Now]:async({$:e,you:a,...t})=>{const n={triggerId:e.nextTriggerId(),[yn.Now]:async({action:t})=>{const{gazePower:n,gazeLands:r}=t.parentData;let i=n.costToPlay+1;for(;a.energy>=i&&await e.may({prompt:`Repeat ${n.data.name} by paying ${i} energy?`});)await a.payEnergy(i),await n.repeatInLocations(r,!1),i+=1}};await e.addSubEffect({effectId:wn.Gaze,[yn.GlobalReminder]:()=>({icon:"Repeat<br>3 <presence>",ongoing:!0,spirit:a,players:[a]}),[yn.AfterTargetingLands]:async({power:r,lands:i,isRepeat:s})=>{r.owner===a&&!s&&r.isA(En.AnyCard)&&r.validOriginSites.hasOneWhere((e=>e.numberOfPresenceOf(a)>=3))&&(e.action.data.gazeLands=i,e.action.data.gazePower=r,await e.addTrigger(n,t.effect,t.action))}})}}],pickOptions:[[0],[1,2,3]],growthOptions:[{effects:[{text:"Add a <presence> in <range-2>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(2)}}]},{effects:[{text:"Reclaim cards",[yn.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Add up to 3 <broken> together",[yn.Now]:async({you:e,$:a})=>{e.destroyedPresence>0&&await e.inLandsWithinRange(1).optionallyPickOne((async t=>{await a.chooseBetween({prompt:"How many <broken> do you want to add?",effects:[1,2,3].map((a=>({actionId:`BrokenAmount${a}`,text:`${a} <broken>`,[yn.Now]:async()=>{for(let n=0;n<a;n+=1)await t.addPresence(e,{destroyed:!0})},condition:()=>e.destroyedPresence>=a})))})}))}}]},{effects:[{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}}]},{effects:[{text:"Gain Energy an Additional Time",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffectUntilEndOfTurn({[yn.AfterGainingEnergyFromTracks]:async()=>{await a.gainEnergyFromTracks()}})}},{text:"Move up to 3 Presence Together in <range-3>",[yn.Now]:async({you:e,$:a})=>{await e.inLands().pickOne((async t=>{await t.move({quantifier:lr.UpTo,amount:3,together:!0,pieces:a.Presence,owner:e,locations:{target:Jn.WithinRange,range:3,spirit:e}})}),{prompt:"Pick a land with your <presence>."})}}]}],tracks:[{energy:1,name:"Top-track: 1 Energy"},{requires:0,energy:2,elements:[nr.Sun],name:"Top-track: 2 Energy, Sun"},{requires:1,energy:3,elements:[nr.Fire],name:"Top-track: 3 Energy, Fire"},{requires:2,elements:[nr.Sun],name:"Top-track: Sun"},{requires:3,energy:4,elements:[nr.Any],name:"Top-track: 4 Energy, Any"},{requires:4,energy:5,name:"Top-track: 5 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:6,cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:7,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:8,elements:[nr.Sun],name:"Bottom-track: Sun"},{requires:9,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:10,effect:{actionId:"ReclaimOne",text:"Reclaim One",[yn.Now]:async({you:e})=>{await e.reclaim(1)}},effectRequires:({you:e})=>e.hasReclaimableCards,name:"Bottom-track: Reclaim One"},{requires:11,cardPlays:4,name:"Bottom-track: 4 Card Plays"}],setup:[{text:"Put 2 <presence> and 1 <badlands> on your starting board, in the lowest-numbered Sands.",[yn.Now]:async({you:e,$:a})=>{const t=e.startingBoard.lowestNumberedTerrain(xo.Sands);await t.putPresence(2,e),await t.add(1,a.Badlands)}}],uniquePowers:[Mi.BlindingGlare,Mi.FocusTheSunsRays,Mi.UnbearableGaze,Mi.WitherBodiesScarStones],innatePowers:[Mi.ScorchingConvergence,Mi.ConsiderAHarmoniousNature]},qy={name:"Hearth-Vigil",set:a.NatureIncarnate,aspects:[],specialRules:[{name:"Rooted in the Community",text:"<blight> added in your lands does not destroy your <presence> if <dahan> are present. (Ravage Actions destroy <dahan> before added <blight> destroys <presence> and cascades.)",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.HearthVigil,[yn.GlobalReminder]:()=>({icon:"<blight><br><broken>",ongoing:!0,spirit:a,players:[a]}),[yn.PreventBlightDestroyingPresence]:({location:t,spirit:n})=>t.has(e.Dahan)&&n===a})}},{name:"Fortify Heart and Hearth",text:"<dahan> have +4 Health (each) while in your lands. Event and Blight Card Actions don't damage, destroy, or replace <dahan> in your lands.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.HearthVigil,[yn.GlobalReminder]:()=>({icon:"<dahan><br>+4 HP",ongoing:!0,spirit:a,players:[a]}),[yn.AdjustHealth]:({piece:t})=>t.isA(e.Dahan)&&void 0!==t.location&&t.location?.hasPresenceOf(a)?4:0,[yn.AfterRemovePiece]:async({location:t,piece:n})=>{n.owner===a&&t.has(e.Dahan)&&await t.healthCheck()},[yn.PreventRemovePiece]:async({piece:t,location:n,removement:r})=>!(!(t.isA(e.Dahan)&&n.hasPresenceOf(a)&&[Ho.MainEventAction,Ho.BlightCardAction,Ho.DahanEventAction,Ho.TokenEventAction].includes(e.action.type))||!pr[r].isDestroyLike&&r!==Nn.Replace)&&(await e.sendEvent({type:fn.GenericSub,text:`Fortify Heart and Hearth prevented Dahan from being ${pr[r].textPast}.`}),!0),[yn.PreventDamagingPiece]:async({piece:t})=>!!(t.isA(e.Dahan)&&void 0!==t.location&&t.location.hasPresenceOf(a)&&[Ho.MainEventAction,Ho.BlightCardAction,Ho.DahanEventAction,Ho.TokenEventAction].includes(e.action.type))&&(await e.sendEvent({type:fn.GenericSub,text:"Fortify Heart and Hearth prevented Dahan from being damaged."}),!0)})}},{name:"Loyal Guardian",text:"When all <dahan> leave one of your lands, your <presence> may Move with those <dahan>. (Each <dahan> can Bring any number of <presence>.)",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.HearthVigil,[yn.AfterMoving]:async({movement:t,source:n,piece:r})=>{if((e.movedDahanThisInstruction.length??0)>0&&t!==Fr.Relocate&&n.hasPresenceOf(a)&&r.isA(e.Dahan)){const t=e.movedDahanThisInstruction.filter((a=>a.source===n&&0===a.source.piecesThatAre(e.Dahan).where((a=>!e.movedDahanThisInstruction.some((e=>e.piece===a)))).count));if(t.length>0){const n=t[0].source,r=Cr(t.map((e=>e.destination)));await n.move({quantifier:lr.Any,pieces:e.Presence,pieceFilter:a=>!(e.movedPresenceThisInstruction??[]).some((e=>e.piece===a)),owner:a,movement:Fr.Bring,locations:{target:Jn.AnyLocations},pickPiecesEffect:{highlightLocations:r},pickDestinationEffect:{autoPlayOneOption:!0},destinationFilter:e=>r.includes(e)})}}}})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[yn.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Add a <presence> in <range-0>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(0)}}]},{effects:[{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-3> to a land with <dahan>.",[yn.Now]:async({you:e,$:a})=>{await e.addPresenceInRange(3,{filter:e=>e.has(a.Dahan)})}}]},{effects:[{text:"Add a <presence> in <range-2>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(2)}},{text:"Gain +3 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(3)}}]}],tracks:[{effect:{actionId:"GatherDahan",text:"Gather 1 Dahan into 1 of your Lands",[yn.Now]:({you:e,$:a})=>e.inLandsWhere((e=>e.hasAdjacentLandWithPiece(a.Dahan))).pickOne((async e=>{await e.gatherOne(a.Dahan)}),{noOptions:"None of your lands have an adjacent <dahan>."})},name:"Bonus: Gather 1 Dahan into 1 of your Lands"},{energy:0,name:"Top-track: 0 Energy"},{requires:1,energy:1,elements:[nr.Sun],name:"Top-track: 1 Energy, Sun"},{requires:2,energy:2,name:"Top-track: 2 Energy"},{requires:3,energy:3,elements:[nr.Animal],name:"Top-track: 3 Energy, Animal"},{requires:4,energy:4,name:"Top-track: 4 Energy"},{requires:5,energy:5,elements:[nr.Sun],name:"Top-track: 5 Energy, Sun"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:7,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:8,elements:[nr.Air],name:"Bottom-track: Air"},{requires:9,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:10,elements:[nr.Animal],name:"Bottom-track: Animal"},{requires:11,cardPlays:4,name:"Bottom-track: 4 Card Plays"}],setup:[{text:"Put 3 <presence> on your starting board: 1 in the highest-numbered land with <dahan> and 2 in the lowest-numbered land with at least 2 <dahan>. Add 1 <dahan> in each of those lands.",[yn.Now]:async({you:e,$:a})=>{const t=[];await e.startingBoard.inLandsFilteredByAllInPriority((e=>e.has(a.Dahan))).withMost((e=>e.landNumber)).autoPickOne((async a=>{t.push(a),await a.putPresence(1,e)})),await e.startingBoard.inLandsFilteredByAnyInPriority((e=>e.hasAtLeast(2,a.Dahan)),(e=>e.has(a.Dahan))).withLeast((e=>e.landNumber)).autoPickOne((async a=>{t.push(a),await a.putPresence(2,e)}));for(const e of t)await e.add(1,a.Dahan)}},{text:"You start with your 4 unique Power Cards and 1 Energy.",[yn.Now]:async({you:e})=>{await e.gainEnergy(1)}}],uniquePowers:[Mi.CallToVigilance,Mi.CoordinatedRaid,Mi.FavorsOfStoryAndSeason,Mi.SurroundedByTheDahan],innatePowers:[Mi.WarnOfImpendingConflict,Mi.KeepWatchForNewIncursions]},_y={name:"Towering Roots of the Jungle",set:a.NatureIncarnate,aspects:[],specialRules:[{name:"Enduring Vitality",text:"Some of your Actions Add Vitality Tokens (<vitality>). (Each <vitality> in a land with no <blight> prevents 1 <blight> from being added, then is Removed.)",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Roots,[yn.GlobalReminder]:()=>({icon:"<vitality>",ongoing:!0,spirit:a,players:[a]})})}},{name:"Heart-tree Guards the Land",text:"You have an Incarna.",effects:[{text:"Your Powers get <range+1> if <incarna-roots> is in the origin land.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Roots,[yn.GlobalReminder]:()=>({icon:"<range+1><br><incarna-roots>",ongoing:!0,spirit:a,players:[a]}),[yn.ExtraRange]:({spirit:t,location:n})=>t===a&&n.has(e.IncarnaRoots)&&void 0!==e.action.power?1:0})}},{text:"Invaders/<dahan>/<beasts> can't be damaged or destroyed at <incarna-roots>.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Roots,[yn.GlobalReminder]:()=>({icon:"<incarna-roots><br>No <damage>",ongoing:!0,spirit:a,players:[a]}),[yn.PreventRemovePiece]:({piece:a,location:t,removement:n})=>Promise.resolve(a.isOneOf(e.Invader,e.Dahan,e.Beasts)&&t.has(e.IncarnaRoots)&&pr[n].isDestroyLike),[yn.PreventDamagingPiece]:({piece:a})=>Promise.resolve(a.isOneOf(e.Invader,e.Dahan,e.Beasts)&&!0===a.location?.has(e.IncarnaRoots))})}},{text:"Empower <incarna-roots> the first time it's in a land with 3 or more <vitality>.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Roots,[yn.GlobalReminder]:()=>({icon:"Empower<br>3 <vitality>",ongoing:!0,visible:!a.hasEmpoweredIncarna,spirit:a,players:[a]}),[yn.AfterAddingPiece]:async({land:t})=>{t.hasAtLeast(3,e.Vitality)&&t.has(e.IncarnaRoots)&&await a.empowerIncarna()},[yn.AfterMoving]:async({destination:t})=>{t.hasAtLeast(3,e.Vitality)&&t.has(e.IncarnaRoots)&&await a.empowerIncarna()}})}},{text:"Skip all Build Actions at Empowered <incarna-roots>.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Roots,[yn.GlobalReminder]:()=>({icon:"Skip<br>Build",ongoing:!0,visible:a.hasEmpoweredIncarna,spirit:a,players:[a]}),[yn.PreventInvaderActionInLand]:({land:t,invaderAction:n})=>Promise.resolve(n===Hr.Build&&t.has(e.IncarnaRoots)&&a.hasEmpoweredIncarna)})}}]},{name:"Incarna",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Roots,text:"<incarna-roots> may count as <presence>.",[yn.GlobalReminder]:()=>({icon:"<incarna-roots> =<br><presence>",ongoing:!0,spirit:a,players:[a]})})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[yn.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Add a <presence> in <range-0>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(0)}}]},{effects:[{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-1>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(1)}},{text:"Add a Vitality at your Incarna",[yn.Now]:async({you:e,$:a})=>{await(e.incarna?.location?.add(1,a.Vitality))}}]},{effects:[{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-3>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(3)}},{text:"You may Replace 1 Presence with Your Incarna",[yn.Now]:async({you:e})=>{await e.presence().optionallyPickOne((async a=>{const t=a.location;await a.remove(Nn.Replace),e.hasIncarna?await e.incarna.moveTo({location:t,movement:Fr.Relocate,pieceFilter:Qn.IncarnaRoots}):await e.addIncarna(Bn.IncarnaRoots,(e=>e===t))}))}},{text:"Gain +1 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(1)}}]}],tracks:[{energy:1,name:"Top-track: 1 Energy"},{requires:0,energy:2,name:"Top-track: 2 Energy"},{requires:1,elements:[nr.Earth],name:"Top-track: Earth"},{requires:2,energy:4,name:"Top-track: 4 Energy"},{requires:3,elements:[nr.Plant],name:"Top-track: Plant"},{requires:4,energy:6,name:"Top-track: 6 Energy"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:6,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:7,elements:[nr.Sun],name:"Bottom-track: Sun"},{requires:8,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:9,elements:[nr.Plant],name:"Bottom-track: Plant"},{requires:10,cardPlays:4,name:"Bottom-track: 4 Card Plays"}],setup:[{text:"Put 3 <presence> on your starting board: 1 in the highest-numbered Jungle without <blight>, 1 in the highest-numbered Mountain, and 1 in the highest-numbered Wetland. Put <incarna-roots> in the Jungle with your <presence>.",[yn.Now]:async({you:e,$:a})=>{await e.startingBoard.inLandsFilteredByAllInPriority((e=>e.isJungle),(e=>!e.has(a.Blight))).withMost((e=>e.landNumber)).autoPickOne((async a=>{await a.putPresence(1,e),await a.putIncarna(Bn.IncarnaRoots,e)})),await e.startingBoard.highestNumberedTerrain(xo.Mountains).putPresence(1,e),await e.startingBoard.highestNumberedTerrain(xo.Wetlands).putPresence(1,e)}}],uniquePowers:[Mi.BloomingOfTheRocksAndTrees,Mi.BoonOfResilientPower,Mi.EntwineTheFatesOfAll,Mi.RadiantAndHallowedGrove],innatePowers:[Mi.ShelterUnderToweringBranches,Mi.RevokeSanctuaryAndCastOut]},Jy={name:"Wandering Voice Keens Delirium",set:a.NatureIncarnate,aspects:[],specialRules:[{name:"A Clarion Voice Given Form",text:"You have an Incarna (<incarna-voice>). If empowered, it Isolates its land.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Voice,[yn.GlobalReminder]:()=>({icon:"Isolate<br><incarna-voice>",ongoing:!0,visible:a.hasEmpoweredIncarna,spirit:a,players:[a]}),[yn.Isolated]:({land:t})=>t.has(e.IncarnaVoice)&&a.hasEmpoweredIncarna})}},{name:"Spread Tumult and Delusion",effects:[{text:"When your Actions add/move <incarna-voice> to a land with Invaders, Add 1 <strife> in the destination land.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Voice,[yn.GlobalReminder]:()=>({icon:"Move<br>= <strife>",ongoing:!0,spirit:a,players:[a]}),[yn.AfterAddingPiece]:async({land:t,additions:n})=>{e.action.spirit===a&&n.some((({piece:t})=>t.isA(e.IncarnaVoice)&&t.owner===a))&&await t.addStrife(1)},[yn.AfterMoving]:async({piece:t,destination:n})=>{e.action.spirit===a&&t.isA(e.IncarnaVoice)&&t.owner===a&&await n.addStrife(1)}})}},{text:"In lands with or adjacent to <incarna-voice>, if <strife> is present, <dahan> do not participate in Ravage. (They do not take Damage or counterattack. Isolate has no effect on <incarna-voice> and <dahan> being adjacent.)",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Voice,[yn.GlobalReminder]:()=>({icon:"<dahan><br>DNPIR",ongoing:!0,spirit:a,players:[a]}),[yn.DoesNotParticipateInRavage]:async({location:t})=>{t.numberOfPiecesInThisOrAdjacentLands(e.IncarnaVoice,a)>=1&&t.has(e.Strife)&&await t.doNotParticipateInRavage({pieces:e.Dahan})}})}}]},{name:"Senseless Roaming",text:"When your Actions Add <strife> to an <explorer>/<town>, you may Push it.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Voice,[yn.GlobalReminder]:()=>({icon:"<strife> =<br>Push",ongoing:!0,spirit:a,players:[a]}),[yn.AfterAddingStrife]:async({piece:t})=>{e.action.type!==Ho.SpiritAction&&e.action.type!==Ho.PowerAction||e.action.spirit!==a||!t.isA(e.ExplorerOrTown)||await t.push({quantifier:lr.May})}})}},{name:"Incarna",[yn.Now]:async({you:e,$:a})=>{await a.addSubEffect({effectId:wn.Voice,text:"<incarna-voice> may count as <presence>/<sacred>.",[yn.GlobalReminder]:()=>({icon:"<incarna-voice> =<br><presence>/<sacred>",ongoing:!0,spirit:e,players:[e]}),[yn.HasSacredSiteOf]:({land:a,spirit:t})=>t===e&&a.pieces.some((e=>e.piece===Bn.IncarnaVoice))})}}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[yn.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Add/Move <incarna-voice> to Land with Your Presence",[yn.Now]:async({you:e})=>{await e.addOrMoveIncarnaToLandWithPresence(Bn.IncarnaVoice)}},{text:"Gain +1 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(1)}}]},{effects:[{text:"Add a <presence> in <range-3>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(3)}},{text:"Add a <presence> in <range-1>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(1)}}]},{effects:[{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-2>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(2)}},{text:"Gain +1 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(1)}},{text:"Gain Air",[yn.Now]:async({you:e})=>{await e.gainElementsUntilEndOfTurn({[nr.Air]:1})}}]}],tracks:[{energy:0,name:"Top-track: 0 Energy"},{requires:0,energy:1,name:"Top-track: 1 Energy"},{requires:1,elements:[nr.SunOrMoon],name:"Top-track: Sun OR Moon"},{requires:2,energy:2,name:"Top-track: 2 Energy"},{requires:3,elements:[nr.Air],name:"Top-track: Air"},{requires:4,energy:4,name:"Top-track: 4 Energy"},{requires:5,effect:{actionId:"PushIncarna",text:"Push Your Incarna",[yn.Now]:async({you:e})=>{await e.incarna.location.push({pieces:Qn.IncarnaVoice,owner:e})}},effectRequires:({you:e})=>e.hasIncarna,name:"Top-track: Push your Incarna"},{cardPlays:1,name:"Bottom-track: 1 Card Play"},{requires:7,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:8,cardPlays:2,name:"Bottom-track: 2 Card Plays"},{requires:9,cardPlays:3,name:"Bottom-track: 3 Card Plays"},{requires:10,effect:{actionId:"ReclaimOne",text:"Reclaim One",[yn.Now]:async({you:e})=>{await e.reclaim(1)}},effectRequires:({you:e})=>e.hasReclaimableCards,name:"Bottom-track: Reclaim One"},{requires:11,cardPlays:4,name:"Bottom-track: 4 Card Plays"}],setup:[{text:"Put 2 <presence> on your starting board: 1 in land #6 and 1 in land #7. Put <incarna-voice> on your starting board in land #6.",[yn.Now]:async({you:e})=>{const a=e.startingBoard.inLandNumber(6);await a.putPresence(1,e),await a.putIncarna(Bn.IncarnaVoice,e),await e.startingBoard.inLandNumber(7).putPresence(1,e)}}],uniquePowers:[Mi.ExhaleConfusionAndDelirium,Mi.FrightfulKeening,Mi.TurmoilsTouch,Mi.TwistPerceptions],innatePowers:[Mi.InscrutableJourneying,Mi.MindShatteringSong]},Vy={[nr.Sun]:{name:"Sun",text:"<sun>",elements:[nr.Sun]},[nr.Moon]:{name:"Moon",text:"<moon>",elements:[nr.Moon]},[nr.Fire]:{name:"Fire",text:"<fire>",elements:[nr.Fire]},[nr.DarkFire]:{name:"Dark Fire",text:"<darkfire>",elements:[nr.DarkFire]},[nr.Air]:{name:"Air",text:"<air>",elements:[nr.Air]},[nr.Water]:{name:"Water",text:"<water>",elements:[nr.Water]},[nr.Earth]:{name:"Earth",text:"<earth>",elements:[nr.Earth]},[nr.Plant]:{name:"Plant",text:"<plant>",elements:[nr.Plant]},[nr.Animal]:{name:"Animal",text:"<animal>",elements:[nr.Animal]},[nr.Any]:{name:"Any",text:"<any>",elements:Sd},[nr.SunOrMoon]:{name:"Sun OR Moon",text:"<sun-moon>",elements:[nr.Sun,nr.Moon]},[nr.WaterOrAnimal]:{name:"Water OR Animal",text:"<water-animal>",elements:[nr.Water,nr.Animal]},[nr.FireOrPlant]:{name:"Fire OR Plant",text:"<fire-plant>",elements:[nr.Fire,nr.Plant]}};var Yy;!function(e){e.RoilingWaters="RoilingWater",e.SereneWaters="SereneWaters",e.WatersRenew="WatersRenew",e.WatersTasteOfRuin="WatersTasteOfRuin"}(Yy||(Yy={}));const zy={name:"Roiling Waters",set:a.NatureIncarnate,effects:[{name:"Lands of Blood and Savagery",text:"When your Powers add or move <beasts> into a land, you may do 1 Damage there per added or moved <beasts>.<br><br>When your Powers add or move any number of <dahan> into a land, you may do 1 Damage there (max. once per Power).",card:Yy.RoilingWaters,textArea:[.201,.477],[yn.Now]:async({$:e,you:a})=>{await e.clickToContinue(),await e.addSubEffect({effectId:wn.RoilingWaters,effects:[{[yn.GlobalReminder]:()=>({icon:"<beasts><br>1 <damage>",ongoing:!0,spirit:a,players:[a]}),textArea:[.204,.324],text:"When your Powers add or move <beasts> into a land, you may do 1 Damage there per added or moved <beasts>.",[yn.AfterAddingPiece]:async({additions:t})=>{if(e.action.power&&e.action.spirit===a){const a=Cr(t.filter((a=>a.piece.isA(e.Beasts))).map((e=>e.location)));for(const n of a){const a=t.filter((a=>a.piece.isA(e.Beasts)&&a.location===n)).length;await n.damage(a)}}},[yn.AfterMoving]:async({piece:t,destination:n,movement:r})=>{e.action.power&&e.action.spirit===a&&t.isA(e.Beasts)&&r!==Fr.Relocate&&await n.damage(1)}},{[yn.GlobalReminder]:()=>({icon:"<dahan><br>1 <damage>",ongoing:!0,spirit:a,players:[a]}),textArea:[.342,.471],text:"When your Powers add or move any number of <dahan> into a land, you may do 1 Damage there (max. once per Power).",[yn.AfterAddingPiece]:async({additions:t})=>{if(e.action.power&&e.action.spirit===a&&!e.action.data.hasUsedRoilingWaters){const a=Cr(t.filter((a=>a.piece.isA(e.Dahan))).map((e=>e.location)));await id.createCollection(e,a).autoPickOne((async a=>{e.action.data.hasUsedRoilingWaters=!0,await a.damage(1)}))}},[yn.AfterMoving]:async({piece:t,destination:n,movement:r})=>{!e.action.data.hasUsedRoilingWaters&&e.action.power&&e.action.spirit===a&&t.isA(e.Dahan)&&r!==Fr.Relocate&&(e.action.data.hasUsedRoilingWaters=!0,await n.damage(1))}}]})}}],requirement:({spirit:e})=>e.numberOfHealingMarkers>=3&&e.numberOfHealingAnimalMarkers>=2&&0===e.healingCards.length},Qy={name:"Serene Waters",set:a.NatureIncarnate,effects:[{name:"Lands of Peace and Harmony",text:"When your Powers move any number of Invaders into your lands, you may Downgrade 1 of those Invaders (max. once per Power).<br><br>When your Powers add or move any number of <dahan> into one of your lands, you may Downgrade 1 Invader there (max. once per Power).<br><br>(If you do both, you can pick the same Invader twice.)",textArea:[.198,.609],card:Yy.SereneWaters,[yn.Now]:async({$:e,you:a})=>{await e.clickToContinue(),await e.addSubEffect({effectId:wn.SereneWaters,textArea:[.192,.606],effects:[{[yn.GlobalReminder]:()=>({icon:"Move<br><explorer><town><city>",ongoing:!0,spirit:a,players:[a]}),textArea:[.195,.31],text:"When your Powers move any number of Invaders into your lands, you may Downgrade 1 of those Invaders (max. once per Power).",[yn.AfterAddingPiece]:async({additions:t})=>{if(e.action.power&&e.action.spirit===a&&!e.action.data.hasUsedSereneWatersFirst){const n=Cr(t.filter((e=>e.piece.isInvader&&e.location.hasPresenceOf(a))).map((e=>e.piece)));await ed.createCollection(e,n).optionallyPickOne((async a=>{e.action.data.hasUsedSereneWatersFirst=!0,await a.downgrade()}))}},[yn.AfterMoving]:async({piece:t,destination:n,movement:r})=>{e.action.power&&e.action.spirit===a&&t.isInvader&&n.hasPresenceOf(a)&&!e.action.data.hasUsedSereneWatersFirst&&r!==Fr.Relocate&&await e.may({prompt:`Downgrade ${Kn[t.piece].text}?`})&&(e.action.data.hasUsedSereneWatersFirst=!0,await t.downgrade())}},{textArea:[.333,.503],text:"When your Powers add or move any number of <dahan> into one of your lands, you may Downgrade 1 Invader there (max. once per Power).",[yn.GlobalReminder]:()=>({icon:"Move<br><dahan>",ongoing:!0,spirit:a,players:[a]}),[yn.AfterAddingPiece]:async({additions:t})=>{if(!e.action.data.hasUsedSereneWatersSecond&&e.action.power&&e.action.spirit===a){const n=Cr(t.filter((t=>t.piece.isA(e.Dahan)&&t.location.hasPresenceOf(a))).map((e=>e.location)));await a.forPiecesThatIs(e.Invader).where((e=>n.includes(e.location))).optionallyPickOne((async a=>{e.action.data.hasUsedSereneWatersSecond=!0,await a.downgrade()}))}},[yn.AfterMoving]:async({piece:t,movement:n,destination:r})=>{!e.action.data.hasUsedSereneWatersSecond&&e.action.power&&e.action.spirit===a&&t.isA(e.Dahan)&&r.hasPresenceOf(a)&&n!==Fr.Relocate&&await r.piecesThatAre(e.Invader).optionallyPickOne((async a=>{e.action.data.hasUsedSereneWatersSecond=!0,await a.downgrade()}))}}]})}}],requirement:({spirit:e})=>e.numberOfHealingMarkers>=3&&e.numberOfHealingWaterMarkers>=2&&0===e.healingCards.length},Ky={name:"Waters Renew",set:a.NatureIncarnate,effects:[{text:"Lose Innate Power: Sanguinary Taint.",[yn.Now]:async({you:e})=>{await e.forgetPower(Mi.SanguinaryTaint)}},{text:"Lose Special Rule: Seeking a Path towards Healing.",[yn.Now]:({$:e})=>(e.removeEffectsWithId(wn.WoundedSeekingAPathTowardsHealing),Promise.resolve())},{text:"Gain Call to Fastness of Renewal",[yn.Now]:async({you:e})=>{const a=await e.gainPower(Mi.CallToAFastnessOfRenewal);await a.play()}}],requirement:({spirit:e})=>e.numberOfHealingMarkers>=5&&e.numberOfHealingWaterMarkers>=3},Xy={name:"Waters Taste Of Ruin",set:a.NatureIncarnate,effects:[{text:"Lose Innate Power: Swirl And Spill.",[yn.Now]:async({you:e})=>{await e.forgetPower(Mi.SwirlAndSpill)}},{text:"Lose Special Rule: Seeking a Path towards Healing.",[yn.Now]:({$:e})=>(e.removeEffectsWithId(wn.WoundedSeekingAPathTowardsHealing),Promise.resolve())},{text:"Gain Afflict With Bloodthirst",[yn.Now]:async({you:e})=>{const a=await e.gainPower(Mi.AfflictWithBloodthirst);await a.play()}}],requirement:({spirit:e})=>e.numberOfHealingMarkers>=5&&e.numberOfHealingAnimalMarkers>=3},Zy={[Yy.RoilingWaters]:zy,[Yy.SereneWaters]:Qy,[Yy.WatersRenew]:Ky,[Yy.WatersTasteOfRuin]:Xy},em={name:"Wounded Waters Bleeding",set:a.NatureIncarnate,aspects:[],specialRules:[{name:"Seeking a Path towards Healing",effects:[{text:"After playing cards each Spirit Phase:<br><br>Claim a Healing Marker (Element Marker) matching whichever of <water> or <animal> you have more of. (You break ties.)<br><br>You may then Claim a Healing Card if you meet its requirements.<br><br>Then Destroy 1 <presence> or Forget a Power Card (unless a Healing Card just removed this rule).",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.WoundedSeekingAPathTowardsHealing,[yn.GlobalReminder]:()=>({icon:"Healing<br>Cards",ongoing:!0,spirit:a,players:[a],previewPowers:()=>({powers:[Yy.WatersTasteOfRuin,Yy.RoilingWaters,Yy.WatersRenew,Yy.SereneWaters],selected:[]})})}),await e.addSubEffect({effectId:wn.WoundedSeekingAPathTowardsHealing,[yn.GlobalReminder]:()=>({icon:"<water><animal>",ongoing:!0,spirit:a,players:[a]}),[yn.AfterPlayPowers]:async()=>{await e.addSubEffect({effects:[{text:"After playing cards each Spirit Phase:<br><br>Claim a Healing Marker (Element Marker) matching whichever of <water> or <animal> you have more of. (You break ties.)",[yn.Now]:async()=>{await e.chooseBetween({effects:[nr.Water,nr.Animal].map((e=>({actionId:e,text:Vy[e].text,[yn.Now]:async()=>{await a.convertElements({[e]:a.elements[e===nr.Water?nr.Animal:nr.Water]}),await a.gainHealingMarker(e)},condition:()=>a.maxElementsWithConvert(e)>=a.elements[e===nr.Water?nr.Animal:nr.Water]})))})}},{text:"You may then Claim a Healing Card if you meet its requirements. (You can claim your first Healing Card on Turn 3.)",[yn.Now]:async()=>{const t=Object.keys(Zy).filter((e=>Zy[e].requirement({spirit:a})&&!a.healingCards.includes(e))),n=await e.queryOptional({query:pn.SelectHealingCard,items:t,actionIds:t});if(null!==n){const r=t[n];a.healingCards.push(r);for(const t of Zy[r].effects)await e.doSpiritAction((()=>e.addEffect({...t,spirit:a,players:[a]})))}}}]})}})}},{text:"Then Destroy 1 <presence> or Forget a Power Card (unless a Healing Card just removed this rule).",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.WoundedSeekingAPathTowardsHealing,[yn.AfterPlayPowers]:async()=>{e.hasEffectNamed("Seeking a Path towards Healing")&&await e.chooseBetween({effects:[{actionId:"DestroyPresence",text:"Destroy 1 <presence>",[yn.Now]:async()=>{await a.destroyPresence(1)}},{actionId:"ForgetPowerCard",text:"Forget a Power Card",[yn.Now]:async()=>{await a.forgetPowers()}}]})}})}}]}],pickOptions:[[0,1,2]],growthOptions:[{effects:[{text:"Reclaim cards",[yn.Now]:async({you:e})=>{await e.reclaimCards()}},{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Gain +1 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(1)}}]},{effects:[{text:"Gain Power Card",[yn.Now]:async({you:e})=>{await e.gainPowerCard()}},{text:"Add a <presence> in <range-2>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(2)}}]},{requiresHealingCard:!0,effects:[{text:"Add a <presence> in <range-3>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(3)}},{text:"Gain +3 Energy",[yn.Now]:async({you:e})=>{await e.gainEnergy(3)}},{text:"Add a Destroyed Presence in <range-1>",[yn.Now]:async({you:e})=>{await e.addPresenceInRange(1,{destroyed:!0})}}]}],tracks:[{energy:0,cardPlays:1,name:"Middle-track: 0 Energy, 1 Card Play"},{requires:0,elements:[nr.WaterOrAnimal],name:"Middle-track: Water OR Animal"},{requires:1,effect:{actionId:"GatherBlight",text:"Gather 1 <blight> into 1 of Your Lands",[yn.Now]:({you:e,$:a})=>e.inLandsWhere((e=>e.hasAdjacentLocationWhere((e=>e.isLandForBlight&&e.has(a.Blight))))).pickOne((async e=>{await e.gatherOne(a.Blight)}),{noOptions:"None of your lands have an adjacent <blight>."})},name:"Middle-track: Gather 1 Blight into 1 of Your Lands"},{requires:2,energy:1,cardPlays:2,name:"Middle-track: 1 Energy, 2 Card Plays"},{requires:3,energy:3,name:"Top-track: 3 Energy"},{requires:4,energy:4,elements:[nr.FireOrPlant],name:"Top-track: 4 Energy, Fire OR Plant"},{requires:5,energy:5,elements:[nr.Any],name:"Top-track: 5 Energy, Any"},{requires:3,cardPlays:3,name:"Bottom-track: 3 Card Play"},{requires:7,effect:{actionId:"ReclaimOne",text:"Reclaim One",[yn.Now]:async({you:e})=>{await e.reclaim(1)}},name:"Bottom-track: Reclaim One"},{requires:8,cardPlays:4,name:"Bottom-track: 4 Card Plays"}],setup:[{text:"On your starting board, put 2 <presence> in a land with <blight>, then put 2 <presence> and 1 <blight> (from the box) in the highest-numbered land with a <town> Setup symbol.",[yn.Now]:async({you:e,$:a})=>{await e.startingBoard.inLandsFilteredByAllInPriority((e=>e.has(a.Blight))).autoPickOne((async a=>{await a.putPresence(2,e)})),await e.startingBoard.inLandsFilteredByAllInPriority((e=>e.setupSymbols.includes(Bn.Town))).withMost((e=>e.landNumber)).autoPickOne((async t=>{await t.putPresence(2,e),await t.add(1,a.Blight)}))}},{text:"You start with your 4 Unique Power Cards and 4 Energy. Set your 4 Healing Cards nearby.",[yn.Now]:async({you:e})=>{await e.gainEnergy(4)}}],uniquePowers:[Mi.BloodWaterAndBloodlust,Mi.BoonOfCorruptedBlood,Mi.DrawToTheWatersEdge,Mi.WrackWithPainAndGrief],innatePowers:[Mi.SwirlAndSpill,Mi.SanguinaryTaint]},am={[n.Lightning]:uy,[n.River]:fy,[n.Earth]:ly,[n.Shadows]:py,[n.Thunderspeaker]:wy,[n.Green]:hy,[n.Ocean]:gy,[n.Bringer]:cy,[n.Fangs]:yy,[n.Keeper]:my,[n.Wildfire]:xy,[n.Serpent]:Iy,[n.Stone]:Ny,[n.Memory]:By,[n.Trickster]:$y,[n.Lure]:Cy,[n.ManyMinds]:Dy,[n.Volcano]:My,[n.Shroud]:ky,[n.Vengeance]:Wy,[n.Starlight]:Ry,[n.Fractured]:Oy,[n.Downpour]:vy,[n.Finder]:Ay,[n.Teeth]:Py,[n.Eyes]:by,[n.Mud]:Ey,[n.Heat]:Ty,[n.Whirlwind]:Sy,[n.Behemoth]:Gy,[n.HearthVigil]:qy,[n.Darkness]:Hy,[n.Gaze]:Uy,[n.Roots]:_y,[n.Earthquakes]:jy,[n.Voice]:Jy,[n.Wounded]:em},tm={name:"Second Wave",set:a.BranchAndClaw,difficulty:0,configurationError:e=>{const a=e.boards.map((e=>e.spirit?.spirit)).find((a=>void 0!==a&&e.startWaveHistory?.usedSpirits.includes(a)));if(void 0!==a)return`${am[a].name} has been used in a previous wave and cannot be chosen again.`},rules:[{[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.SecondWave,[yn.AfterGameEnds]:async({winReason:a})=>{if(void 0!==a){const a=[],t=[],n=[...e.config.startWaveHistory?.usedSpirits??[],...e.spirits.map((e=>e.spirit))],r=Cr([...e.config.startWaveHistory?.revealedBlightCards??[],...e.blightCardsDiscarded,...e.blightCardActive?[e.blightCardActive]:[]]),i=e.config.startWaveHistory?.wave??1,s=Math.min(i+1,7);await e.addSubEffect({name:1===i?"After the First Game":"After each Wave",scenario:Rd.SecondWave,effects:[{text:"Each Spirit sets aside one Power Card to assist with the next Game.",[yn.Now]:async()=>{await e.eachSpirit((async e=>{await e.powersWhere((e=>e.isA(En.AnyCard)&&!e.isBlessed&&!e.assisted)).pickOne((t=>(a.push({power:t.power,boardIndex:e.startingBoardIndex}),Promise.resolve())),{players:[e]})}))}},{text:"Remove all <presence> and Invaders.",[yn.Now]:async()=>{await e.clickToContinue(),await e.forPiecesWhere((e=>e.isPresence||e.isInvader)).forEach((async e=>{await e.remove(Nn.Silent)}))}},{text:`Leave on the island one of each token-type per player:<br><br>${e.boardCount} <beasts>, ${e.boardCount} <wilds>, ${e.boardCount} <disease>, ${e.boardCount} <badlands>`,[yn.Now]:async()=>{await e.clickToContinue(),await e.inBoardsWhere((a=>a.boardIndex>=e.boardCount)).forEach((async a=>{for(const t of a.pieces)t.isA(e.Blight)?await t.location.removeBlight():await t.remove(Nn.Silent)}));for(const a of[e.Beasts,e.Wilds,e.Disease,e.Badlands]){const t=Math.max(e.pieceCountIncludingStasis(a)-e.boardCount,0);t>0&&await e.forPiecesThatIs(a).pickMultiple({amount:t,forPickedItem:async e=>{await e.remove(Nn.Silent)},effect:{prompt:`Pick ${Kn[a].text} to remove.`}})}}},{text:`Leave ${s} <blight> per player. Return the rest to the Blight Card.`,[yn.Now]:async()=>{await e.clickToContinue();const a=Math.max(e.pieceCountIncludingStasis(e.Blight)-s*e.boardCount,0);a>0&&await e.forPiecesThatIs(e.Blight).pickMultiple({amount:a,forPickedItem:async e=>{await(e.location?.removeBlight())}})}},{text:"In lands with 3 <dahan> or more, Push 1 <dahan> to adjacent lands until there are 2 or fewer.",[yn.Now]:async()=>{await e.inLandsWhere((a=>a.hasAtLeast(3,e.Dahan))).selectOrder().forEach((async a=>{await a.push({pieces:e.Dahan,amount:Math.max(a.numberOf(e.Dahan)-2,0)})}),{noOptions:"No lands with 3 <dahan> or more"})}},{text:"Then, on each board with 2-4 <dahan>, add 1 <dahan> to the lowest-numbered land with <dahan>.",[yn.Now]:async()=>{await e.inBoardsWhere((a=>a.numberOf(e.Dahan)>=2&&a.numberOf(e.Dahan)<=4)).forEach((async a=>{const t=a.lowestNumberedLand((a=>a.has(e.Dahan)));void 0!==t&&await t.add(1,e.Dahan)}),{noOptions:"No boards with 2-4 <dahan>."})}},{text:"Then, on each board with 9 <dahan> or more, remove <dahan> until there are 8 or fewer.",[yn.Now]:async()=>{await e.inBoardsWhere((a=>a.numberOf(e.Dahan)>=9)).forEach((async a=>{await a.forPiecesThatIs(e.Dahan).pickMultiple({amount:Math.max(a.numberOf(e.Dahan)-8,0),forPickedItem:async e=>{await e.remove(Nn.Silent)}})}),{noOptions:"No boards with 9 <dahan> or more."})}}]}),await e.forPiecesWhere((a=>a.isOneOfIgnoringCountAs(e.Beasts,e.Wilds,e.Disease,e.Badlands,e.Blight,e.Dahan))).forEach((e=>(t.push({piece:e.piece,landIndex:e.location.landIndex,boardIndex:e.location.boardIndex}),Promise.resolve()))),await e.addBlightToBlightCard(e.slowHealingBlight);const o=void 0!==e.blightCardActive?Math.max(e.blightOnBlightCard-(2*e.boardCount+1),0):0;e.config.finishWaveHistory={pieces:t,wave:e.config.startWaveHistory?.wave??1,usedSpirits:n,revealedBlightCards:r,blightPool:e.blightPool+o,blightOnBlightCard:e.blightOnBlightCard-o,assistance:a,blightStatus:e.blightStatus},await e.clickToContinue({text:"Post Game Setup finished."}),await e.sendEvent({type:fn.GameEnd})}}})}},{[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.SecondWave,[yn.PreventAddBlightInSetup]:async()=>{if((e.config.startWaveHistory?.wave??1)>1){if(!(e.blightPool>0))return!0;await e.removeBlightFromBlightPool(1)}return!1}})}},{[yn.Now]:async({$:e})=>{if(void 0!==e.config.startWaveHistory){const{pieces:t,wave:n,revealedBlightCards:r,blightPool:i,blightOnBlightCard:s,assistance:o}=e.config.startWaveHistory,d=r.length>0?r[r.length-1]:void 0;for(const t of(a=r,[...a].reverse()))tr[t].stillHealthy||t===d?(e.blightCardsInDeck.remove(t),e.blightCardsInDeck.insert(t),e.addRevealedBlightCard()):await e.discardBlightCard(t);await e.addBlightToBlightPool(i),e.blightOnBlightCard<s?await e.addBlightToBlightCard(s-e.blightOnBlightCard):e.blightOnBlightCard>s&&await e.removeBlightFromBlightCard(e.blightOnBlightCard-s);const c=5-n;await e.forPieces().forEach((async e=>{e.isInvader?e.location.landNumber>=6&&c>0&&null!==e.location.board&&await e.moveTo({location:e.location.board.inLandNumber(e.location.landNumber-c),pieceFilter:Qn.Invader,movement:Fr.Relocate,withoutWait:!0}):await e.remove(Nn.Silent)}));for(const a of t)a.boardIndex<e.boardCount&&await e.boards[a.boardIndex].locations[a.landIndex].add(1,Qn[a.piece]);const l=[[],[],[5],[4,5],[3,4,5],[2,3,4,5],[1,2,3,4,5],[1,2,3,4,5,6]][Math.min(n,7)];await e.onEachBoard((async a=>{for(const t of l)await a.inLandNumber(t).add(1,e.Town)}));for(const a of o)e.removePowerCardFromDecks(a.power);await e.addSubEffect({text:'Once Stage III begins, the Power Cards set aside from the first game may be "played" (during a Spirit Phase as usual). They cost nobody any Energy or Card Plays, grant no Elements, and may target any land. Thresholds trigger if they require 10 or fewer Elements. Each one is discarded after one use (or at the end of the game, if playing further waves)',[yn.Now]:async()=>{await e.addSubEffect({effectId:wn.SecondWave,[yn.AfterChangingInvaderDeck]:async()=>(3===e.stage&&(e.removeThisEffect(),await e.eachSpirit((async e=>{const a=o.find((a=>a.boardIndex===e.startingBoardIndex));void 0!==a&&await e.gainPower(a.power,{assisted:!0})}))),Promise.resolve())})}})}var a}}]},nm={name:"Ward The Shores",set:a.BranchAndClaw,difficulty:2,rules:[{name:"Ward The Shores",effects:[{text:"Once per turn, each Spirit may play a Power Card as Ward The Shores.<br><br>(See Scenario Card for details.)",[yn.Now]:async({$:e})=>{await e.eachSpirit((async a=>{let t=null;await a.addExtraAction({effectId:wn.WardTheShores,actionId:`WardTheShores${a.spirit}`,icon:"Ward",scenario:Rd.WardTheShores,enabled:()=>e.phase===Wi.GainEnergy&&null===t&&a.powersWhere((e=>e.isA(En.AnyCard)&&e.isInHand&&!e.isBlessed)).count>0,onActivate:async()=>{await e.addSubEffect({effects:[{scenario:Rd.WardTheShores,text:"Once per turn, each Spirit may play a Power Card as Ward the Shores.",prompt:"Pick Power to play as Ward The Shores.",[yn.Now]:async()=>{await a.powersWhere((e=>e.isA(En.AnyCard)&&e.isInHand)).pickOne((async e=>{t=e.power;const n=a.powers.indexOf(e);await a.forgetPower(e.power,{silent:!0});const r=await a.gainPower(Mi.WardTheShores,{silent:!0,index:n});await r.play()}))}}]})}}),await e.addSubEffect({effectId:wn.WardTheShores,[yn.TimePasses]:async()=>{await e.eachSpirit((async()=>{const e=a.powers.findIndex((e=>e.power===Mi.WardTheShores));if(e>=-1&&await a.forgetPower(Mi.WardTheShores,{silent:!0}),null!==t){const n=await a.gainPower(t,{silent:!0,index:e>=-1?e:void 0});await n.setStatus(Fd.Discarded),t=null}}))}})}))}},{text:"Once placed, each Warding Pattern grants Defend 3 in its land. They are destroyed any time <blight> is added to their land.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.WardTheShores,[yn.DefendFromSpirits]:({land:a})=>3*a.numberOf(e.WardingPattern)})}},{text:"They are destroyed any time <blight> is added to their land.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.WardTheShores,[yn.WhenAddingBlight]:async({blightedLands:a})=>{for(const t of a)t.has(e.WardingPattern)&&(await e.clickToContinue({highlightPieces:[t.piecesThatAre(e.WardingPattern).anyOne],highlightLocations:[t]}),await t.destroyAll(e.WardingPattern))}})}},{text:"Get out 4 Scenario Markers per player; these represent Warding Patterns. (If you run out of tokens, you can re-use destroyed / already-placed ones.)",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.WardTheShores,[yn.AfterAddingPiece]:async()=>{for(;e.forPiecesThatIs(e.WardingPattern).count>4*e.boardCount;)await e.forPiecesThatIs(e.WardingPattern).pickOne((async e=>{await e.remove()}),{prompt:"Pick a Warding Pattern to remove"})}})}},{text:"The normal Fear-based Victory is not available. Instead: Terror 2+ There is a Warding Pattern in every Coastal land.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.WardTheShores,[yn.GlobalReminder]:()=>({icon:`Patterns<br>${e.coastalLandsWithWardingPatterns} / ${e.coastalLands}`,scenario:Rd.WardTheShores,ongoing:!0}),[yn.RemoveFearBasedVictory]:()=>!0,[yn.WinCondition]:()=>e.terrorLevel>=2&&e.coastalLandsWithWardingPatterns===e.coastalLands?Dw.WardTheShores:null})}},{text:"After making the Fear Deck, put all remaining Fear Cards on the bottom.",[yn.Now]:({$:e})=>(e.putAllFearCardsInDeckIntoLevel(3),Promise.resolve())},{text:"If they run out, reshuffle the deck.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.WardTheShores,[yn.AfterFearDeckIsDecreasing]:async()=>{3===e.terrorLevel&&0===e.fearCardsInLevelCount[2]&&(await e.clickToContinue(),await e.reshuffleFearDeck(),e.putAllFearCardsInDeckIntoLevel(3))}})}},{name:"Stage III Surge",text:"During Stage III, Explore adds 1 <town> in addition to the usual 1 <explorer>.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.WardTheShores,[yn.GlobalReminder]:()=>({icon:"+1 <town>",scenario:Rd.WardTheShores,ongoing:!0,visible:3===e.stage}),[yn.AfterSuccessfulExplore]:async({land:a})=>{3===e.stage&&await a.add(1,e.Town)}})}}]}]},rm={name:"A Diversity of Spirits",set:a.FeatherAndFlame,difficulty:0,rules:[{name:"Strength in Diversity",effects:[{text:"After Growth, if you added 1 or more <presence> to lands with other Spirit's <presence>: Gain 1 Energy or Reclaim 1 non-Major Power Card.",[yn.Now]:async({$:e})=>{const a=[];await e.addSubEffect({effectId:wn.ADiversityOfSpirits,[yn.AfterAddingPiece]:({land:t,additions:n})=>{if(e.phase===Wi.Grow&&t.hasPresenceFromTwoDifferentSpirits)for(const e of n)e.piece.isPresence&&!a.includes(e.piece.owner)&&a.push(e.piece.owner);return Promise.resolve()},[yn.AfterGrowth]:async()=>{for(const t of a)await t.doSpiritAction((async()=>{await e.chooseBetween({players:[t],effects:[{actionId:"Energy",text:"Gain 1 Energy.",[yn.Now]:async()=>{await t.gainEnergy(1)}},{actionId:"Reclaim",text:"Reclaim 1 non-Major Power Card.",[yn.Now]:async()=>{await t.reclaimCards({amount:1,filter:e=>e.isInDiscard&&e.isA(En.NonMajorCard)})}}]})}))}})}}]}]},im={name:"Varied Terrain",set:a.FeatherAndFlame,difficulty:2,rules:[{name:"Mountains May Hide Gold",text:"Add +1 <explorer> when Exploring Mountains. (Including during Setup, if appropriate.)",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.VariedTerrain,[yn.AfterSuccessfulExplore]:async({land:a})=>{a.isMountains&&(await e.sendEvent({type:fn.GenericMain,text:"Invaders Explored into a <mountains>."}),await a.add(1,e.Explorer))},[yn.GlobalReminder]:()=>({icon:"<mountains><br>+1 <explorer>",ongoing:!0})})}},{name:"Jungles Clear-Cut for Land",text:"After Invader Build 1 or More <city> in a Jungle, add 1 <blight> there.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.VariedTerrain,[yn.AfterSuccessfulBuild]:async({land:a,additions:t})=>{a.isJungle&&t.some((a=>a.piece.isA(e.City)))&&(await e.sendEvent({type:fn.GenericMain,text:"Invaders Built a <city> in a <jungles>."}),await a.addBlight(1))},[yn.BuildOrderMatters]:()=>!0,[yn.GlobalReminder]:()=>({icon:"<jungles><br><city>=<blight>",ongoing:!0})})}},{name:"Fragile Sands",text:"After Setup: <blight> added to Sands cascades as if <blight> were already present, even when it is not.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.VariedTerrain,[yn.BlightAlwaysCascadesInLand]:({land:e})=>e.isSands,[yn.GlobalReminder]:()=>({icon:"<sands><br>Cascade",ongoing:!0})})}},{name:"Fertile Wetlands",text:"After Invaders successfully Build in a Wetland, they Build there a second time.",[yn.Now]:async({$:e,...a})=>{const t={triggerId:e.nextTriggerId(),[yn.Now]:async({action:a})=>{await e.sendEvent({type:fn.GenericMain,text:"Invaders Built in <wetlands>."}),await a.parentData.builtLand.doExtraBuild()}};await e.addSubEffect({effectId:wn.VariedTerrain,[yn.AfterSuccessfulBuild]:async n=>{n.land.isWetlands&&(e.action.data.builtLand=n.land,await e.addTrigger(t,a.effect,a.action))},[yn.GlobalReminder]:()=>({icon:"<wetlands><br>Build",ongoing:!0})})}}]},sm={name:"Despicable Theft",set:a.JaggedEarth,difficulty:2,rules:[{name:"Setup Changes",text:"Make a pool of 18 Scenario Markers: 12 blank ones and (1, 1, 1, 2, 2, 3). They represent small groups of Thieves trying to escape with knowledge of treasure. Mix them to form a face-down supply.",[yn.Now]:async({$:e,...a})=>{let t=[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,2,2,3];const n=[],r=a=>{if(null!==a){if(a.numberOf(e.Thief)>=2&&a.numberOf(e.Dahan)<2&&!e.config.controlledFate){const t=a.piecesThatAre(e.Thief).items.map((e=>e.scenarioNumber));e.shuffle(t),a.piecesThatAre(e.Thief).items.forEach((e=>{e.scenarioNumber=t.pop()}))}a.piecesThatAre(e.Thief).items.forEach((e=>{e.placeInGroup()}))}},i={triggerId:e.nextTriggerId(),text:"Thieves can only be Destroyed/Removed/Replaced in lands with no <town>/<city> and 2 or more <dahan>. Otherwise, they elude you, and are instead Pushed.",[yn.Now]:async({action:a})=>{for(const{piece:t,location:r,removement:i}of a.parentData.possiblyRemoveThieves??[])if(void 0!==r&&(e.someEffect(yn.PreventRemovalEffects)||((a.parentData.landsWithoutTownOrCity??[]).includes(r)||r.doesntHave(e.TownOrCity))&&((a.parentData.landsWithAtLeast2Dahan??[]).includes(r)||r.hasAtLeast(2,e.Dahan))))n.push(t.thiefNumber),i!==Nn.Replace&&t.remove(Nn.Silent),await e.sendEvent({type:fn.GenericSub,text:`A thief was ${pr[i].textPast} in ${r.coordinateLink}.`}),pr[i].isDestroyLike&&await e.generateFear({amount:1,location:void 0,fromDestroyingBuildings:!1});else if(i===Nn.Replace&&void 0!==t.location){const e=await t.replace([Bn.Thief]);e.added.length>0&&await e.added[0].piece.push()}else{const[{piece:e}]=await r.createPiece(1,Bn.Thief);e.scenarioNumber=t.thiefNumber,await e.push()}}};await e.addSubEffect({effects:[{effectId:wn.DespicableTheft,name:"Arrive with <explorer>",text:"After Setup, when Invaders successfully Explore into a land numbered 6 or higher, also add 1 Thief there from the pool.",[yn.GlobalReminder]:()=>({icon:`Thieves<br>${e.forPiecesThatIs(e.Thief).count}`,scenario:Rd.DespicableTheft,ongoing:!0}),[yn.AfterSuccessfulExplore]:async({land:a})=>{if(!a.landNumbers.some((e=>e<6))&&t.length>0){const n=await a.add(1,e.Thief);if(n.length>0){const a=await e.drawFrom(t,t.map((e=>`${e}`)));n[0].piece.scenarioNumber=a}}}},{effectId:wn.DespicableTheft,name:"Seek to Escape by Ship",text:"Before the Ravage Step, all Thieves on the island move 1 land towards their board's Ocean.",[yn.BeforeRavageStep]:async()=>{await e.inLandsWith(e.Thief).forEach((async a=>{await e.doScenarioAction((async()=>{await a.piecesThatAre(e.Thief).forEach((async a=>{const t=a.location,r=t.inAdjacentLocations().where((e=>e.board===t.board&&e.distanceToThisBoardsOcean<t.distanceToThisBoardsOcean)),i=r.copy().where((e=>!t.isIsolated&&!e.isIsolated));if(r.count>0&&await r.pickOne((async e=>{await a.move({locations:{target:Jn.ToThisLocation,location:e},pickDestinationEffect:{autoPlayOneOption:!0}})}),{highlightPieces:[a],highlightLocations:[a.location],noOptions:""},0===i.count),a.location?.isOcean){const t=a.scenarioNumber;await e.clickToContinue({noOptions:`A Thief ${t>0?`with number ${t}`:"without number "} escaped!`}),n.push(t),await a.remove(Nn.Silent),await e.loseFear(4);for(let a=0;a<t;a+=1)await e.accelerateTheInvaderDeck()}}))}))}))}},{effectId:wn.DespicableTheft,text:"Thieves are face-down by default, but face-up while in lands with 2 or more <dahan>. If multiple face-down Thieves are in a single land, mix them up.",[yn.AfterMoving]:({piece:a,source:t,destination:n})=>(a.isOneOf(e.Thief,e.Dahan)&&(r(t),r(n)),Promise.resolve()),[yn.AfterAddingPiece]:({additions:a})=>{if(a.some((a=>a.piece.isOneOf(e.Thief,e.Dahan))))for(const e of Cr(a.map((e=>e.location))))r(e);return Promise.resolve()},[yn.AnyActionStarts]:()=>(e.action.data.landsWithoutTownOrCity=e.inLocationsWhere((a=>a.doesntHave(e.TownOrCity))).items,e.action.data.landsWithAtLeast2Dahan=e.inLocationsWhere((a=>a.hasAtLeast(2,e.Dahan))).items,Promise.resolve()),[yn.PreventRemovePiece]:async({piece:t,removement:n})=>!(!t.isA(e.Thief)||[Nn.Silent,Nn.Relocate].includes(n))&&(void 0===e.action.data.possiblyRemoveThieves&&(e.action.data.possiblyRemoveThieves=[]),e.action.data.possiblyRemoveThieves.push({piece:t,location:t.location,removement:n}),e.action.data.landsWithoutTownOrCity=[...e.action.data.landsWithoutTownOrCity??[],...e.action.parentData.landsWithoutTownOrCity??[]],e.action.data.landsWithAtLeast2Dahan=[...e.action.data.landsWithAtLeast2Dahan??[],...e.action.parentData.landsWithAtLeast2Dahan??[]],n!==Nn.Replace&&await t.remove(Nn.Silent),await e.addTrigger(i,a.effect,a.action,{priority:!0}),n!==Nn.Replace),[yn.AfterRemovePiece]:({piece:a,location:t})=>(a.isOneOf(e.Thief,e.Dahan)&&r(t),Promise.resolve())},{effectId:wn.DespicableTheft,text:"Mix Thieves no longer on the island into the supply at end of turn.",[yn.TimePasses]:()=>(t=[...t,...n].sort(),Promise.resolve())}]})}}]},om={name:"Elemental Invocation",set:a.JaggedEarth,difficulty:1,rules:[{text:"On each board, add 1 <town> to land #6. Add 1 Fear Card to Terror Level 1. Accelerate the Invader Deck.",[yn.Now]:async({$:e})=>{await e.addSubEffectUntilEndOfTurn({[yn.BeforeSetupPresence]:async()=>{await e.clickToContinue(),await e.onEachBoard((async a=>{a.ignoreInvaderAndBlightInSetup||await a.inLandNumber(6).add(1,e.Town)})),await e.addFearCards(1).toLevel(1),await e.accelerateTheInvaderDeck()}})}},{text:"Once per Spirit Phase, each Spirit may pay Energy to place 1 Element Marker on a corner of one of their lands.<br><br>(See Scenario Card for details.)",[yn.Now]:async({$:e})=>{await e.eachSpirit((async a=>{await a.addExtraAction({effectId:wn.ElementalInvocation,actionId:`ElementalInvocation${a.spirit}`,icon:"Element",enabled:()=>e.phase===Wi.GainEnergy||e.phase===Wi.Grow,onActivate:async()=>{await e.addSubEffect({effects:[{[yn.Now]:async()=>{const t=[...Sd].filter((e=>a.elementsFromCards[e]>0)).map((e=>({actionId:e,text:`${Vy[e].text}`,[yn.Now]:async()=>{await a.inCornersWhere((e=>void 0===e.element&&1+e.inAdjacentCorners().where((e=>void 0!==e.element)).count<=a.energy)).pickOne((async t=>{await a.payEnergy(1+t.inAdjacentCorners().where((e=>void 0!==e.element)).count),await t.setElement(e)}),{scenario:Rd.ElementalInvocation,prompt:"Pick a Corner",noOptions:"Cannot afford to add Element to any Corner.",text:'The cost is 1 Energy, +1 Energy per adjacent corner that already has an Element Marker. ("Adjacent" means "along land boundaries"'})}})));await e.chooseBetween({scenario:Rd.ElementalInvocation,text:"Spirit may only place Element Markers which they have on a Power Card in hand, play, or discard.",prompt:"Choose Element:",effects:t})}}]})}})}))}},{name:"Benefits of Elements",text:"When using a land-targeting Power, the Power gains all Elements on the target land's corners, so elemental thresholds can be reached more easily when targeting certain lands.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.ElementalInvocation,[yn.AfterTargetingLands]:async({lands:a,owner:t})=>{if(e.config.scenario===Rd.ElementalInvocation){const e=Cr(a.map((e=>e.corners)).flat()),n={};let r=!1;for(const a of e)a.element&&(n[a.element]=(n[a.element]??0)+1,r=!0);r&&await t.gainElementsUntilEndOfAction(n)}}})}}]},dm=(e,a)=>(e%a+a)%a,cm={name:"The Great River",set:a.JaggedEarth,difficulty:3,configurationError:e=>1===Cr(e.boards.map((e=>dm(e.rotation,6)))).length?void 0:"Invalid scenario Layout",rules:[{name:"Population Spills Across the River",text:"After the Build Step, Invaders Build in all Coastal land without <town>/<city> but with <explorer>.<br><br>After the Explore Step, Invaders Explore into all Coastal lands without <town>/<city>.",[yn.GlobalReminder]:()=>({icon:"River",scenario:Rd.TheGreatRiver,ongoing:!0})},{name:"Population Spills Across the River",text:"After the Build Step, Invaders Build in all Coastal land without <town>/<city> but with <explorer>.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.TheGreatRiver,[yn.AfterTheNormalBuildStep]:async()=>{await e.inCoastalLands().where((a=>a.doesntHave(e.TownOrCity)&&a.has(e.Explorer))).selectOrder().forEach((a=>e.doScenarioAction((async()=>{await a.doExtraBuild()}))),{noOptions:"No Coastal lands without <town>/<city> but with <explorer>."})}})}},{name:"Population Spills Across the River",text:"After the Explore Step, Invaders Explore into all Coastal lands without <town>/<city>.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.TheGreatRiver,[yn.AfterTheNormalExploreStep]:async()=>{await e.inCoastalLands().where((a=>a.doesntHave(e.TownOrCity))).selectOrder().forEach((a=>e.doScenarioAction((async()=>{await a.doExtraExplore()}))),{noOptions:"No Coastal lands without <town>/<city>."})}})}},{name:"Additional Loss Condition",text:"If more than 3 <town> per player escape off the edge of the map, the Invaders win.<br><br>(See Scenario Card for details.)",[yn.Now]:async({$:e})=>{const a=3*e.boardCount+1,t=Re.box(0);await e.addSubEffect({effectId:wn.TheGreatRiver,effects:[{[yn.LossCondition]:()=>t.get()>=a?Ew.GreatRiver:null,[yn.GlobalReminder]:()=>({icon:`Escaped<br>${t.get()} / ${3*e.boardCount+1}`,ongoing:!0,scenario:Rd.TheGreatRiver})},{name:"Relentless Migration Eastwards",text:"At the end of the <slow> phase, move each <town> one land Inland (farther away from the Ocean). Start with the most-Inland lands and work your way to the least-Inland.",[yn.AfterSlowPhase]:async()=>{const a=[];for(;!e.gameEnded;){const n=e.inLands().where((t=>t.piecesThatAre(e.Town).hasOneWhere((e=>!a.includes(e))))).withMost((e=>e.distanceToNearestOcean)).selectOrder();if(0===n.count)break;await n.forEach((async n=>{await e.doScenarioAction((async()=>{const r=n.adjacentLandsSortedByNorthernmost(),i=r.copy().where((e=>e.distanceToNearestOcean>n.distanceToNearestOcean)),s=r.copy().where((e=>e.distanceToNearestOcean===n.distanceToNearestOcean));let o=0;await n.piecesThatAre(e.Town).where((e=>!a.includes(e))).selectOrder().forEach((async r=>{let d=null,c=!1;i.count>0?(d=i.items[o],o=(o+1)%i.count):n.isEastern||(d=s.items[o],o=(o+1)%s.count),(n.isIsolated||null!==d&&d.isIsolated)&&await e.may({highlightLocations:[n,...null!==d?[d]:[]],text:"Pay 1 Energy to use Isolation to prevent <town> from moving?"})&&(c=!0),c||(null===d?(t.set(t.get()+1),await r.remove(Nn.Silent),await e.sendEvent({type:fn.GenericSub,text:"A <town> escaped over the eastern edge of its board!"})):await r.move({locations:{target:Jn.ToThisLocation,location:d},pickDestinationEffect:{autoPlayOneOption:!0}})),a.push(r)}),{autoPlayOneOption:!0})}))}))}}}]})}}]},lm={name:"Destiny Unfold",set:a.NatureIncarnate,difficulty:-1,configurationError:e=>e.boards.filter((e=>void 0!==e.spirit)).length>=2?void 0:"Destiny Unfold requires at least 2 Players.",rules:[{name:"Setup Changes",text:"Before the initial Explore, each Spirit drafts Power Cards into their Destiny, in two rounds.<br><br>(See Scenario Card for details.)",[yn.Now]:async({$:e})=>{await e.addSubEffectUntilEndOfTurn({[yn.BeforeInitialExplore]:async()=>{if(!(e.spiritCount<3))for(let a=1;a<=2;a+=1){const t=3+a,n=3-a,r=2===a?1:-1,i=[];for(let a=0;a<e.spiritCount;a+=1){const a=[];i.push(a);for(const r of[Sn.Major,Sn.Minor])for(let i=0;i<(r===Sn.Minor?t:n);i+=1){const t=await e.drawPower(r,{silent:!0});void 0!==t&&a.push(t)}}for(let a=0;a<5;a+=1){const a=[...i.map((e=>[...e]))];for(const e of i)e.length=0;for(let t=0;t<e.spiritCount;t+=1){const n=e.spirits[t],s=a[t];for(const a of s)await n.addExtraAction({actionId:`Draft${a}`,name:sg[a].name,required:!0,icon:"",text:"Pick this power card.",power:a,previewPowers:()=>({powers:s,selected:[s.indexOf(a)]}),onActivate:()=>{for(const a of s)e.removeEffectsWithName(sg[a].name);const o=s.filter((e=>e!==a));for(const a of o)i[(t+r+e.spiritCount)%e.spiritCount].push(a);return n.destinyPowers.push(a),Promise.resolve()}})}await e.playDraftActions((()=>"Each Spirit picks 1 Power Card and puts it in their Destiny face-down. When all Spirits have picked a Power Card, each Spirit passes their remaining Power Cards to the Spirit in the pass direction for that round."),(()=>"Pick Power Card"))}for(const a of i.flat())await e.discardPowerToDeckDiscard(a)}}})}},{name:"Destinies of Power",text:"Each Spirit has a Destiny (a supply of drafter Power Cards.). When a Spirit would gain a Power Card of their choice from their Destiny (following restrictions on the type of card gained.) If this is not possible, gain from a deck as normal.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.DestinyUnfold,[yn.GlobalReminder]:()=>({icon:"Destiny",ongoing:!0}),[yn.AdjustGainingPowers]:({spirit:e,powerType:a})=>{const t=e.destinyPowers.filter((e=>void 0===a||sg[e].type===a));return t.length>0?t:null}})}},{name:"Two-Player Variant",text:"Choose which Spirit will act first.",[yn.Now]:async({$:e})=>{await e.addSubEffectUntilEndOfTurn({[yn.BeforeInitialExplore]:async()=>{if(2!==e.spiritCount)return;const a=[...e.spirits];await e.fromAllSpirits().pickOne((e=>(e!==a[0]&&a.reverse(),Promise.resolve())));for(let t=1;t<=2;t+=1){const n=3+t,r=3-t,i=[[],[],[],[],[],[]];for(let a=0;a<e.spiritCount;a+=1){const t=[];for(const a of[Sn.Major,Sn.Minor])for(let i=0;i<(a===Sn.Minor?n:r);i+=1){const n=await e.drawPower(a,{silent:!0});void 0!==n&&t.push(n)}const s=e.spirits[a];for(const n of t)await s.addExtraAction({actionId:`Draft${n}`,name:sg[n].name,required:!0,icon:"",text:"Pick this power card.",power:n,previewPowers:()=>({powers:t,selected:[t.indexOf(n)]}),onActivate:()=>{e.removeEffectsWithName(sg[n].name);const r=Math.floor((6-t.length)/2);return qr(t,n),i[3*a+r].push(n),Promise.resolve()}})}await e.playDraftActions((()=>`Each Spirit splits their Power Cards into three face-down piles of 2 cards each. Once all six piles are ready, flip them all face-up.<br><br>${e.spirits[0].nameLink}: ${i[0].length}/2 - ${i[1].length}/2 - ${i[2].length}/2<br>${e.spirits[1].nameLink}: ${i[3].length}/2 - ${i[4].length}/2 - ${i[5].length}/2`),(()=>"Split Power Cards into piles.")),i.reverse();const s=[!1,!1],o=()=>{for(let a=0;a<6;a+=1)e.removeEffectsWithName(`Pile${a+1}`);e.removeEffectsWithName("Skip on last Piles")};for(const t of e.spirits){if(t.destinyPowers.length<10)for(let n=0;n<6;n+=1){const r=i[n];await t.addExtraAction({name:"Pile"+(6-n),actionId:"Pile"+(6-n),required:!0,icon:"Pile<br>"+(6-n),text:"Pick this pile.",enabled:()=>i.length>2?a[[0,0,1,1][6-i.length]]===t:s[0]?a[1]===t&&t.destinyPowers.length<10:a[0]===t&&t.destinyPowers.length<10,previewPowers:()=>({powers:i.flat(),selected:[2*i.indexOf(r),2*i.indexOf(r)+1]}),onActivate:()=>{e.removeEffectsWithName("Pile"+(6-n));for(const e of r)t.destinyPowers.push(e);return i.length<=2&&(s[a[0]===t?0:1]=!0,s[0]&&s[1]&&o()),qr(i,r),Promise.resolve()}})}await t.addExtraAction({name:"Skip on last Piles",text:"In order, each Spirit may take a third pile.",actionId:`PileSkip${t.spirit}`,required:!0,enabled:()=>i.length<=2&&8!==t.destinyPowers.length&&(!s[0]&&a[0]===t||s[0]&&a[1]===t),icon:"Skip",onActivate:()=>(s[a[0]===t?0:1]=!0,s[0]&&s[1]&&o(),Promise.resolve())})}await e.playDraftActions((()=>"The first Spirit puts two piles into their Destiny, then the second Spirit puts two piles into their Destiny.<br>In order, each Spirit may take a third pile. Discard the unpicked Power cards to the Minor/Major discard piles."),(()=>" ."));for(const a of i.flat())await e.discardPowerToDeckDiscard(a);a.reverse()}}})}}]},hm={name:"Surges Of Colonization",set:a.NatureIncarnate,difficulty:2,rules:[{name:"Setup Changes",text:"Resolve one extra Explore Card during the Initial Explore. (The game will start with two cards in the Build space.)",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.SurgesOfColonization,[yn.AdjustNumberOfExploreCards]:()=>1,[yn.AfterInitialExplore]:async()=>{e.removeThisEffect(),await e.explore()}})}},{name:"Distant Expeditions",text:"<explorer> are a source of Invaders for Explore Cards.",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.SurgesOfColonization,[yn.GlobalReminder]:()=>({icon:"<explorer><br>Source"}),[yn.LandIsExploringSource]:({land:a})=>a.has(e.Explorer)})}},{name:"Surges and Ebbs",text:"On even-numbered turns, resolve one extra Explore Card during the Explore step (usually 2 Explore Cards. On odd-numbered turns, skip the first normal Explore.",[yn.Now]:async({$:e})=>{const a=new Set;await e.addSubEffect({effectId:wn.SurgesOfColonization,[yn.AdjustNumberOfExploreCards]:()=>e.turn>0&&e.turn%2==0?1:0,[yn.AfterTheNormalExploreStep]:async()=>{e.turn>0&&e.turn%2==0&&!a.has(e.turn)&&(a.add(e.turn),0===e.invaderCardsInExploreDeck.length&&await e.addSubEffect({name:"Final Surge",text:"If there are not enough Invader Cards for the final Surges and Ebbs, use unused Stage III Invader Cards. If none are left, use the highest-Stage Invader Cards in the discard (chosen randomly). (You only lose when you need to reveal the normal Explore Card and can't.)",[yn.Now]:async()=>{const a=e.unusedInvaderCardOfStage(3);let t=!1;if(0===a.length){const n=Cr(e.invaderDeckInSlot(Zl.Discard).possibleCards.flat()),r=qo(n,(e=>Mo[e].stage));a.push(...n.filter((e=>Mo[e].stage===r))),t=!0}if(a.length>0){const n=e.randomFromArray(a);await e.addExploreCardToTop([n]),t&&e.invaderDeckInSlot(Zl.Discard).removeCard(e.invaderDeckInSlot(Zl.Discard).cards.indexOf(n))}}}),await e.explore())}})}},{name:"Surges and Ebbs",text:"On even-numbered turns, resolve one extra Explore Card during the Explore step (usually 2 Explore Cards. On odd-numbered turns, skip the first normal Explore.",[yn.Now]:async({$:e})=>{const a=new Set;await e.addSubEffect({effectId:wn.SurgesOfColonization,[yn.GlobalReminder]:()=>({icon:"Surges<br>Ebbs"}),[yn.AdjustNumberOfExploreCards]:()=>e.turn%2==0?0:-1,[yn.SkipNextExploreCard]:()=>e.turn%2!=1||a.has(e.turn)?Promise.resolve(!1):(a.add(e.turn),Promise.resolve(!0))})}}]},um={name:"Larger Surges",set:a.NatureIncarnate,difficulty:7,rules:[...hm.rules,{name:"Larger Surges (Higher Difficulty)",effects:[{text:"Add a Fear Card to each Terror Level during Setup.",[yn.Now]:async({$:e})=>{for(let a=1;a<=3;a+=1)await e.addFearCards(1).toLevel(a)}},{text:"Surges and Ebbs resolves another extra Explore Card during the Explore Step on even-numbered turns. (Usually 3 Explore Cards).",[yn.Now]:async e=>{await hm.rules[2][yn.Now](e)}}]}]},gm={[Rd.Blitz]:zw,[Rd.GuardTheIslesHeart]:Kw,[Rd.RitualsOfTerror]:Xw,[Rd.DahanInsurrection]:Qw,[Rd.SecondWave]:tm,[Rd.PowersLongForgotten]:sy,[Rd.WardTheShores]:nm,[Rd.RitualsOfTheDestroyingFlame]:dy,[Rd.ElementalInvocation]:om,[Rd.DespicableTheft]:sm,[Rd.TheGreatRiver]:cm,[Rd.ADiversityOfSpirits]:rm,[Rd.VariedTerrain]:im,[Rd.DestinyUnfold]:lm,[Rd.SurgesOfColonization]:hm,[Rd.LargerSurges]:um};class fm{$;constructor(e){this.$=e}get difficulty(){return fm.difficulty(this.$.config)}static difficulty(e){let a=0;if(void 0!==e.adversaryLeading&&(a=Yw[e.adversaryLeading.adversary].levels[e.adversaryLeading.level].difficulty,void 0!==e.adversarySupporting)){const t=Yw[e.adversarySupporting.adversary].levels[e.adversarySupporting.level].difficulty;a=Math.max(a,t)+.5*Math.min(a,t)}void 0!==e.scenario&&(a+=gm[e.scenario]?.difficulty??0),e.thematic&&(a+=1,e.sets&&1===e.sets.length&&(a+=2)),e.archipelagos&&(a+=1);const t=e.boards.some((e=>e.spirit));if(e.boards.filter((e=>void 0===e.spirit&&(e.lockedEmpty||t))).length>0){const t=Math.floor(a/3)+2;a+=t,e.thematic&&(a-=t/2)}return a}static practiceGame(e){return e.boards.some((e=>!0===e.spirit?.progression))||e.skipInitialExplore||e.extraGrowth||e.controlledFate||!e.blightCards}toString(){return bg({difficulty:this.difficulty},2)}}class pm{promise;rejecter;resolver;constructor(){this.promise=new Promise(((e,a)=>{this.resolver=e,this.rejecter=a}))}reject(e){this.rejecter?.(e)}resolve(e){this.resolver?.(e)}}var wm=function(e,a,t,n){var r,i=arguments.length,s=i<3?a:null===n?n=Object.getOwnPropertyDescriptor(a,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,a,t,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(i<3?r(s):i>3?r(a,t,s):r(a,t))||s);return i>3&&s&&Object.defineProperty(a,t,s),s};class ym{cursorAtPlayPower=null;$;abortAtTurn;client;cursor=0;history=[];historyFinished;nextEventId=0;constructor(e,a){this.$=e,this.client=a}get currentHistory(){return this.history}get defaultPromptForQueryType(){return e=>{switch(e){case pn.SelectLand:return"Pick a land.";case pn.SelectGrowthOption:return;case pn.SelectPowerType:return"Pick a Power type.";case pn.SelectPowerToGain:return"Pick a Power Card to keep.";case pn.SelectCard:return"Pick a Card.";case pn.SelectHealingCard:return"Pick a Healing Card.";case pn.SelectPower:return"Pick a Power.";case pn.SelectTerrain:return"Pick a Terrain.";case pn.PlayPower:return;case pn.ChooseBetween:case pn.PayJointly:return"Choose between:";case pn.SelectSpirit:return"Pick a Spirit.";case pn.SelectBoard:return"Pick a Board.";case pn.SelectFearCard:return"Pick a Fear Card.";case pn.SelectPiece:return"Pick a Piece.";case pn.SelectCorner:return"Pick a Corner.";default:return"I'm not sure what you should do now..."}}}async chooseBetween(e,a){await this.$.addSubEffect({...e,effects:void 0,[yn.Now]:async()=>{const t=void 0!==e.effects?e.effects.filter((({condition:e})=>void 0===e||e())):[];if(t.length>0)if(this.$.treatingAllOrsAsAnds&&a.orChoice)for(const e of t)await this.$.addSubEffectUntilEndOfTurn(e);else{const n=await this.query({query:a.payJointly?pn.PayJointly:pn.ChooseBetween,chooseBetween:e.effects,items:t,actionIds:t.map((e=>e.actionId)),...e});await this.$.addSubEffectUntilEndOfTurn(t[n])}else e.noOptions&&await this.$.clickToContinue({noOptions:e.noOptions})}})}async chooseFrom(e,a){let t=null;return await this.$.chooseBetween({name:"Controlled Fate",text:"Choose Option",effects:e.map(((n,r)=>({text:a[r],actionId:`Fate-Option-${r}`,[yn.Now]:()=>(t=n,e.splice(r,1),Promise.resolve())})))}),t}closeDown(){this.client=void 0}async may(e,a=!1){let t=!0;return await this.chooseBetween({...e,effects:["No","Yes"].map((e=>({actionId:(a?"Fate-":"")+e,text:e,[yn.Now]:()=>(t="Yes"===e,Promise.resolve())})))},{orChoice:!1,payJointly:!1}),t}possiblyResolveHistoryFinished(){return void 0!==this.abortAtTurn&&this.$.turn===this.abortAtTurn&&(this.history.length=this.cursor),this.cursor!==this.history.length&&!this.$.gameEnded||void 0===this.historyFinished||(this.historyFinished.resolve(this.history),this.historyFinished=void 0,this.abortAtTurn=void 0),Promise.resolve()}async query(e){return await this.queryInternal(e)}async queryOptional(e){return await this.queryInternal({...e,optional:!0})}async selectX(e,a,t={}){const{text:n,prompt:r,players:i}=t;let s=e;return await this.chooseBetween({prompt:r??"Select X.",effects:[...Array(a-e+1).keys()].map((a=>({actionId:`Select${e+a}`,text:`${e+a}`,[yn.Now]:()=>(s=e+a,Promise.resolve())}))),text:n,players:i},{orChoice:!1}),s}async send(e){await this.possiblySendPhase(),await this.sendEvent(e)}setHistory(e,a){return this.history=[...e],this.abortAtTurn=a,this.cursor=0,this.historyFinished=new pm,this.historyFinished.promise}async waitForAnimationsToFinish(){await(this.client?.waitForAnimations())}async possiblySendPhase(){this.$.reportedPhase!==this.$.phase&&(this.$.updateReportedPhase(),await this.sendEvent({type:fn.Phase,phase:this.$.phase,turn:this.$.turn}),this.$.phase===Wi.PlayPowers&&(this.cursorAtPlayPower=this.cursor))}async queryInternal(e){const a=!0===e.optional;if(this.$.gameEnded)return a?null:0;await this.possiblySendPhase();const{items:t,query:n,actionIds:r}=e;if(0===t.length){if(a)return null;throw new Error(`Non-optional query ${pn[n]} without options.`)}if(1===t.length&&!a&&(e.autoPlayOneOption||void 0===e.autoPlayOneOption&&n===pn.SelectBoard))return 0;let i;for(;i=await this.queryOrUseHistory(e,r,a),"Admin"===i;)await this.$.enterAdminMode();return"Skip"===i?null:r.includes(i)?r.indexOf(i):(await this.sendEvent({type:fn.Error,text:`Invalid input: ${i}.`}),this.$.logErrors&&console.error(`Invalid response [2] ${i} to query: ${pn[n]}. Valid options: [${a?"Skip, ":""}${r.join(", ")}]`),a?null:0)}async queryOrUseHistory(e,a,t){if(void 0===this.client)return new Promise((()=>{}));if(await this.possiblyResolveHistoryFinished(),this.cursor<this.history.length){const n=this.history[this.cursor];if("Admin"===n||t&&"Skip"===n||a.includes(n))return this.cursor+=1,n;this.history.length=this.cursor,await this.sendEvent({type:fn.Error,text:`History doesn't match current client. Skipping rest of input: [${n}].`}),this.$.logErrors&&console.error(`Invalid response [1] ${n} to query: ${pn[e.query]}. Valid options: [${t?"Skip, ":""}${a.join(", ")}]`),this.historyFinished?.resolve(this.history),this.historyFinished=void 0}const n={...this.$.currentStackEffect,...e};n.prompt=n.prompt??this.defaultPromptForQueryType(n.query),n.optional&&(n.cancel=n.cancel??"Skip"),n.cursor=this.cursor;const r=await this.client.query(n);return this.history.push(r),this.cursor+=1,r}async sendEvent(e){await(this.client?.send({id:this.nextEventId,time:this.cursor,data:e})),this.nextEventId+=1}}wm([Re],ym.prototype,"cursorAtPlayPower",void 0);class mm{bringingWarrior=!1;hasAttemptedDamagingInvader=!1;hasAttemptedDestroyingInvader=!1;movedDahan=[];movedPresence=[];inInstruction=!1;async doInstruction(e){if(this.inInstruction)return e();{this.inInstruction=!0,this.hasAttemptedDamagingInvader=!1,this.hasAttemptedDestroyingInvader=!1,this.bringingWarrior=!1,this.movedDahan.length=0,this.movedPresence.length=0;const a=await e();return this.inInstruction=!1,a}}reportMovement(e){e.piece.isDahan&&this.movedDahan.push(e),e.piece.isPresence&&this.movedPresence.push(e),e.piece.piece===Bn.IncarnaWarrior&&e.movement===Fr.Bring&&(this.bringingWarrior=!0)}}class vm{nextPieceId=0;nextRandom=0;seed=0;constructor(e){this.seed=e??this.setRandomSeed()}drawFrom(e){const a=e.length>1?this.randomFromArray(e):e[0];return e.splice(e.indexOf(a),1),a}generatePieceId(){const e=this.nextPieceId;return this.nextPieceId+=1,e}random(){let e=2654435769,a=608135816,t=this.nextRandom;this.nextRandom=t+1;let n=this.seed,r=0;for(let i=0;i<15;i+=1){e>>>=0,a>>>=0,t>>>=0,n>>>=0;let i=e+a|0;e=a^a>>>9,a=t+(t<<3)|0,t=t<<21|t>>>11,n=n+1|0,i=i+n|0,t=t+i|0,r=(i>>>0)/4294967296}return r}randomFromArray(e){return e[Math.floor(this.random()*e.length)]}setRandomSeed(){return this.seed=Math.floor(9999999*Math.random()),this.seed}setSeed(e){this.seed=e}shuffle(e){return((e,a=Math.random)=>{const t=e.slice();for(let e=t.length-1;e>0;e-=1){const n=Math.floor(a()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t})(e,(()=>this.random()))}toString(){return bg({seed:this.seed,nextRandom:this.nextRandom},2)}}var Am=function(e,a,t,n){var r,i=arguments.length,s=i<3?a:null===n?n=Object.getOwnPropertyDescriptor(a,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,a,t,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(i<3?r(s):i>3?r(a,t,s):r(a,t))||s);return i>3&&s&&Object.defineProperty(a,t,s),s};class Im{name;element;$;boardIndex;landIndex;constructor({$:e,boardIndex:a,landIndex:t,name:n}){Xo.makeObservable(this),this.$=e,this.boardIndex=a,this.landIndex=t,this.name=n}get board(){return this.$.boards[this.boardIndex]}get index(){return dg(this.landIndex)}get isBoardCorner(){return 1===this.principleLocations.length}get isOnEdge(){return 2===this.touchingLocations.length}get principleLocations(){return this.landIndex.map((e=>this.$.boards[this.boardIndex].locations[e]))}get serialized(){return this.name}static createCollection(e,a){return new Yo(e,pn.SelectCorner,a)}inAdjacentCorners(){return Im.createCollection(this.$,this.adjacentCorners)}inAdjacentLands(){return id.createCollection(this.$,this.touchingLands)}inAdjacentLocations(){return id.createCollection(this.$,this.touchingLocations)}setElement(e){return this.element=e,Promise.resolve()}get adjacentCorners(){return this.$.corners.filter((e=>{if(e!==this){const a=((e,a)=>{const t=new Set(e),n=[];for(const e of a)t.has(e)&&n.push(e);return n})(e.touchingLocations,this.touchingLocations);return(1!==a.length||a[0].type!==jo.Ocean)&&a.length>=((this.isOnEdge||this.isBoardCorner)&&(e.isOnEdge||e.isBoardCorner)?1:2)}return!1}))}get touchingLands(){return this.touchingLocations.filter((e=>e.type===jo.Land))}get touchingLocations(){const e=[...this.principleLocations];for(const a of this.principleLocations)for(const t of a.adjacentLands)e.includes(t)||this.isBoardCorner&&!t.sharesCornerWith(this.principleLocations[0])||t.boardIndex===this.boardIndex||this.principleLocations.some((e=>!t.isAdjacentTo(e)))||"NE_6_7_N"===this.name&&!this.board.locations[3].adjacentLands.some((e=>e.boardIndex===t.boardIndex))||"NE_6_7_E"===this.name&&!this.board.locations[7].adjacentLands.some((e=>e.boardIndex===t.boardIndex))||e.push(t);return e}}Am([Re],Im.prototype,"element",void 0);function xm(){return function(e,a,t){if(void 0===t.get)throw new Error("@memoize decorator can only be applied to getter methods.");const n=`_memoized_${a}`,r=`_memoized_reactive_${a}`,i=t.get;t.get=function(){if(Xo.reactivity){const e=this[r];if(void 0===e){const e=i.call(this);return this[r]=Re.box(e),e}const a=e.get();if(void 0===a){const a=i.call(this);return e.set(a),a}return a}{const e=this[n];if(void 0===e){const e=i.call(this);return this[n]=e,e}return e}}}}function bm(e,...a){for(const t of a)if(Xo.reactivity){const a=e[`_memoized_reactive_${t}`];void 0!==a&&a.set(void 0)}else e[`_memoized_${t}`]=void 0}var Tm=function(e,a,t,n){var r,i=arguments.length,s=i<3?a:null===n?n=Object.getOwnPropertyDescriptor(a,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,a,t,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(i<3?r(s):i>3?r(a,t,s):r(a,t))||s);return i>3&&s&&Object.defineProperty(a,t,s),s};class Em{boardCount;boards;boardsUnused=[];theEndlessDark;corners;oceanIsAllowedForBlight=!1;$;elementsToMigrate=[];constructor(e){Xo.makeObservable(this),this.$=e,this.boards=[],this.boardCount=this.$.config.boards.length,this.$.config.boards.forEach((({x:e,y:a,rotation:t,boardId:n})=>{this.boards.push(new ad(this.$,this.boards.length,e,a,t,n))})),this.corners=[],this.theEndlessDark=new id({$:e,boardIndex:-1,board:null,landIndex:-1,type:jo.EndlessDark})}get capitalSize(){return qo(this.lands,(e=>e.numberOfBuildings))}get coastalLands(){return Jo(this.locationsIncludingNonExisting,(e=>e.isCoastal&&!e.isOcean))}get coastalLandsWithCities(){return Jo(this.locationsIncludingNonExisting,(e=>e.isCoastal&&e.hasCity))}get coastalLandsWithWardingPatterns(){return Jo(this.locationsIncludingNonExisting,(e=>e.isCoastal&&!e.isOcean&&e.has(this.$.WardingPattern)))}get destroyedBoards(){return this.boards.filter((e=>e.destroyed))}get landElements(){const e={};return this.corners.forEach((a=>{a.element&&(e[a.element]=(e[a.element]??0)+1)})),e}get lands(){const e=[];return this.nonDestroyedBoards.forEach((a=>{e.push(...a.landsExcludingExtraLocations)})),this.theEndlessDark.exists&&this.theEndlessDark.isLand&&e.push(this.theEndlessDark),e}get locations(){const e=[];return this.nonDestroyedBoards.forEach((a=>{e.push(...a.existingLocations)})),this.theEndlessDark.exists&&e.push(this.theEndlessDark),e}get locationsIncludingNonExisting(){const e=[];return this.nonDestroyedBoards.forEach((a=>{e.push(...a.locations,this.theEndlessDark)})),e}get mayTargetTheEndlessDark(){return this.$.someEffect(yn.MayTargetTheEndlessDark)}get nonDestroyedBoards(){return this.boards.filter((e=>!e.destroyed))}get pieceCountIncludingStasis(){return e=>Uo(this.locationsIncludingNonExisting,(a=>a.numberOf(e)))}get pieces(){const e=[];return this.locations.forEach((a=>{e.push(...a.pieces)})),e.sort(((e,a)=>e.id-a.id)),e}get strippedLandSize(){return qo(this.lands,(e=>e.numberOfBlight+e.numberOfInvaders))}get targetableLands(){const e=[];return this.nonDestroyedBoards.forEach((a=>{e.push(...a.landsExcludingExtraLocations,...this.theEndlessDark.exists&&this.mayTargetTheEndlessDark?[this.theEndlessDark]:[])})),e}async addBoard(e){const a=await this.randomUnusedBoard();if(null===a)return null;const t=new ad(this.$,this.boards.length,e.x,e.y,e.rotation,a);return this.boards.push(t),t}async afterPiecesAreAddedOrMovedAddTrigger(e){const{reminder:a=!0,permanent:t=!1,globalReminder:n,locationFilter:r=(()=>!0),pieces:i=Qn.AllPieces,trigger:s,effect:o,action:d,owner:c,removeAfterTrigger:l=!1}=e;await this.$.addSubEffect({expireAtEndOfTurn:!t,[yn.Reminder]:a?e=>r(e)&&o.text?o.text:void 0:void 0,[yn.GlobalReminder]:n,[yn.AfterAddingPiece]:async e=>{const a=e.additions.map((e=>e.piece)).filter((e=>e.isA(i)&&(void 0===c||e.owner===c)));r(e.land)&&a.length>0&&(void 0===this.$.action.data.piecesAddedOrMoved&&(this.$.action.data.piecesAddedOrMoved=[]),this.$.action.data.piecesAddedOrMoved=Cr([...this.$.action.data.piecesAddedOrMoved,...a]),await this.$.addTrigger(s,o,d),l&&this.$.removeThisEffect())},[yn.AfterMoving]:async e=>{r(e.destination)&&e.piece.isA(i)&&e.movement!==Fr.Relocate&&(void 0===this.$.action.data.piecesAddedOrMoved&&(this.$.action.data.piecesAddedOrMoved=[]),this.$.action.data.piecesAddedOrMoved.push(e.piece),await this.$.addTrigger(s,o,d,{movingAction:this.$.action}))}})}async build(e=Zl.Build){await this.forEachCardInSlot(e,(async a=>{await this.buildFromCard(a,e)}))}async buildFromCard(e,a,t={}){const{noIntro:n=!1}=t;await this.$.oneEffectActivates(yn.SkipNextBuildCard)?await this.$.clickToContinue({name:"Build",text:`The Build in ${Mo[e].text} is skipped.`,card:e}):await this.$.addEffect({name:"Build",text:`The Invaders Build in ${Mo[e].text}.`,card:e,[yn.Now]:async()=>{await this.$.sendEvent({type:fn.InvadersBuild,cardSlot:a===Zl.Ravage?Zl.Build:a,invaderCard:e}),n||await this.$.clickToContinue(),await this.$.escalate(e,{beforeBuilding:!0}),await this.$.doEffects(yn.BeforeResolvingInvaderCard,{card:e,invaderAction:Hr.Build,normal:a===Zl.Build});const t=this.inLandsWhere((a=>a.matchesInvaderCard(e,Hr.Build)&&(a.has(Qn.Invader)||a.buildCardsAffectLandsWithoutInvaders)));this.$.buildOrderMatters&&t.selectOrder(),await t.forEach((async t=>{a===Zl.Build?t.isMiningLand&&this.$.miningLandsCauseRavageActions?await t.ravage({normal:!0,card:e,calculateDoNotParticipateInRavage:!0}):await t.doNormalBuild(e):await t.doExtraBuild(e)}),{noOptions:"No lands to build in."}),await this.$.doEffects(yn.AfterResolvingBuildCard,{card:e,normal:a===Zl.Build})}})}async doAdversaryActionOnEachBoard(e){const{forEach:a,where:t=(()=>!0),effect:n,withoutAction:r=!1}=e;await this.$.doEffects(yn.BeforeAdversaryActionsOnEachBoard),await this.$.inBoardsWhere(t).forEach((async e=>{e.preventAdversaryActions||(r?await a(e):await this.$.doAdversaryAction((async()=>{await a(e)}),{board:e}))}),n),await this.$.doEffects(yn.AfterAdversaryActionsOnEachBoard)}async doExtraBuildInTerrain(e){await this.$.addEffect({name:"Build",text:`The Invaders Build in ${Jg[e].text}.`,card:e,[yn.Now]:async()=>{await this.$.sendEvent({type:fn.InvadersBuildInTerrain,terrain:e}),await this.$.clickToContinue();const a=this.inLandsWhere((a=>a.hasTerrain(e)&&(a.has(Qn.Invader)||a.buildCardsAffectLandsWithoutInvaders)));await a.forEach((e=>e.doExtraBuild()),{noOptions:"No lands to build in."})}})}async doExtraRavageInTerrain(e){await this.$.addEffect({name:"Ravage",text:`Ravage in ${Jg[e].text}.`,[yn.Now]:async()=>{await this.$.sendEvent({type:fn.InvadersRavageInTerrain,terrain:e});const a=this.inLandsWhere((a=>a.hasTerrain(e)&&a.has(Qn.Invader)));await a.forEach((async e=>{await e.calculateDoNotParticipateInRavage()}));const t=a.where((e=>e.participatingInvaders().count>0));for(const e of a.items)t.has(e)||await e.resetDoNotParticipateInRavage();await t.selectOrder().forEach((e=>e.doExtraRavage({calculateDoNotParticipateInRavage:!1})),{noOptions:"No lands to ravage in."})}})}existLandWhere(e){return this.lands.some(e)}existLocationIncludingNonExistingWhere(e){return this.locationsIncludingNonExisting.some(e)}async explore(){if(await this.$.oneEffectActivates(yn.SkipNextExploreCard))return;const e=await this.$.drawNextExploreCard();if(!this.$.gameEnded&&null!==e){const a=Mo[e];await this.$.addEffect({name:0===this.$.turn?"Initial Explore":"Explore",text:`The Invaders Explore in ${a.text}.`,card:e,[yn.Now]:async()=>{await this.$.clickToContinue(),await this.$.escalate(e,{beforeExplore:!0}),await this.$.doEffects(yn.BeforeResolvingInvaderCard,{card:e,invaderAction:Hr.Explore,normal:!0});const a=this.inLandsWhere((a=>a.matchesInvaderCard(e,Hr.Explore)&&a.hasExploringSource));this.exploreOrderMatters(e)&&a.selectOrder(),await a.forEach((async a=>{await a.doNormalExplore(e)}),{noOptions:"No lands to explore into."}),await this.$.escalate(e,{afterExplore:!0}),await this.$.doEffects(yn.AfterResolvingExploreCard,{card:e,normal:!0})}})}}exploreOrderMatters(e){return this.$.someEffect(yn.ExploreOrderMatters,{card:e})}async forEachLand(e){for(const a of this.lands)await e(a)}forPieces(){return ed.createCollection(this.$,this.pieces)}forPiecesWhere(e){return this.forPieces().where(e)}async globalHealthCheck(){await this.forEachLand((async e=>{await e.healthCheck()}))}inBoards(){return ad.createCollection(this.$,this.nonDestroyedBoards)}inBoardsWhere(e){return this.inBoards().where(e)}inBoardsWith(e){return this.inBoardsWhere((a=>a.hasOneLandWith(e)))}inBoardsWithout(e){return this.inBoardsWhere((a=>!a.hasOneLandWith(e)))}inCorners(){return Im.createCollection(this.$,this.corners)}inCornersWhere(e){return this.inCorners().where(e)}inLands(){return id.createCollection(this.$,this.lands)}inLandsWhere(e){return this.inLands().where(e)}inLandsWith(e){return this.inLands().where((a=>a.has(e)))}inLandsWithAllOf(...e){return this.inLands().where((a=>a.hasAllOf(...e)))}inLandsWithOneOf(...e){return this.inLands().where((a=>a.hasOneOf(...e)))}inLandsWithOrAdjacentTo(e){return this.inLandsWhere((a=>a.hasOrIsAdjacentToLandsWith(e)))}inLandsWithStrife(){return this.inLands().where((e=>e.hasStrife))}inLandsWithout(e){return this.inLands().where((a=>a.doesntHave(e)))}inLocations(){return id.createCollection(this.$,this.locations)}inLocationsWhere(e){return this.inLocations().where(e)}inTargetableLands(){return id.createCollection(this.$,this.targetableLands)}inTargetableLandsWhere(e){return this.inTargetableLands().where(e)}invaders(){return this.forPieces().where((e=>e.isInvader))}async invadersHaveMinusOneHealthPerStrife(){await this.$.addSubEffectUntilEndOfTurn({[yn.GlobalReminder]:()=>({icon:"-1 HP<br>per <strife>"}),[yn.AdjustHealth]:({piece:e})=>e.isInvader?-e.strife:0,[yn.AfterAddingStrife]:async({piece:e})=>{await e.location.healthCheck()}}),await this.$.globalHealthCheck()}invalidateBoardCache(){bm(this,"locations","locationsIncludingNonExisting","nonDestroyedBoards")}migrateCornerCornersFromBoard(e){this.elementsToMigrate=[];for(const a of this.corners)if(a.board===e&&a.isBoardCorner&&void 0!==a.element){const t=a.inAdjacentLocations().where((a=>a.board!==e)).items;t.length>0&&this.elementsToMigrate.push({land:t[0],element:a.element})}}async onEachBoard(e,a={}){const{selectOrder:t=!1}=a;if(t&&this.nonDestroyedBoards.length>1)await this.inBoards().selectOrder().forEach(e,{autoPlayOneOption:!0});else for(const a of this.nonDestroyedBoards)await e(a)}async pickTerrainsWhere(e,a){const t=[xo.Jungles,xo.Mountains,xo.Sands,xo.Wetlands].filter(e);if(0===t.length)return a?.noOptions&&await this.$.clickToContinue(a),null;return t[await this.$.query({query:pn.SelectTerrain,items:t,actionIds:t,...a})]}piecesThatAre(e){return this.forPiecesWhere((a=>a.isA(e)))}randomUnusedBoard(){const e=Object.keys($o).filter((e=>$o[e].thematic===!!this.$.config.thematic&&!this.boards.some((a=>a.board===e))));return 0===e.length?Promise.resolve(null):this.$.drawFrom(e,e.map((e=>$o[e].name)))}async ravage(){await this.forEachCardInSlot(Zl.Ravage,(async e=>{await this.$.oneEffectActivates(yn.SkipNextRavageCard,{card:e})||await this.$.addEffect({name:"Ravage",text:`The Invaders Ravage in ${Mo[e].text}.`,card:e,[yn.Now]:async()=>{await this.$.sendEvent({type:fn.InvadersRavage,invaderCard:e}),await this.$.clickToContinue(),await this.$.doEffects(yn.BeforeResolvingInvaderCard,{card:e,invaderAction:Hr.Ravage,normal:!0});const a=this.inLandsWhere((a=>a.matchesInvaderCard(e,Hr.Ravage)&&a.has(this.$.Invader)));await a.forEach((async e=>{await e.calculateDoNotParticipateInRavage()}));const t=this.inLandsWhere((a=>a.matchesInvaderCard(e,Hr.Ravage)&&a.participatingInvaders().count>0));for(const e of a.items)t.has(e)||await e.resetDoNotParticipateInRavage();await t.selectOrder().forEach((a=>a.ravage({normal:!0,card:e,calculateDoNotParticipateInRavage:!1})),{noOptions:"No lands to ravage in."}),await this.$.doEffects(yn.AfterResolvingRavageCard,{card:e,normal:!0})}})}))}async removeInvadersWorthOfHealthUpTo(e){const a=[],t=this.invaders().where((a=>a.health<=e&&a.targetable));return await t.optionallyPickOne((async t=>{a.push(...await t.remove()),a.push(...await this.removeInvadersWorthOfHealthUpTo(e-t.health))}),{prompt:`${e} health left to remove.`}),a}setCorners(e){const a=[...this.corners];this.corners=e;for(const t of a)if(void 0!==t.element){const a=this.corners.find((e=>e.name===t.name));if(void 0!==a)a.element=t.element;else if(t.isBoardCorner){const a=e.find((e=>e.isBoardCorner&&t.inAdjacentLocations().has(e.principleLocations[0])));void 0!==a&&(a.element=t.element)}}this.elementsToMigrate.forEach((({land:e,element:a})=>{const t=e.corners.find((e=>e.isBoardCorner));void 0!==t&&(t.element=a)}))}async setupStartingTokens(){!this.$.config.sets.includes(a.BranchAndClaw)&&!this.$.config.sets.includes(a.JaggedEarth)||this.$.config.thematic||await this.onEachBoard((async e=>{await(e.lowestNumberedLand((e=>!e.hasSetupSymbols))??e.lowestNumberedLand()).add(1,this.$.Beasts),await e.inLandNumber(2).add(1,this.$.Disease)}))}async splittedDamage(e){const{amount:a,lands:t,effect:n}=e;await this.forPiecesWhere((e=>e.isInvader&&null!==e.location&&t.includes(e.location))).pickMultiple({amount:a,where:e=>e.isAlive,forPickedItem:async e=>{await e.damageOnlyThis(1,this.$.Invader)},repeatSame:!0,effect:n})}toString(){return bg({boards:this.boards,boardsUnused:Vo(this.boardsUnused,(e=>$o[e].name)),boardCount:this.boardCount},2)}async forEachCardInSlot(e,a){for(const t of this.$.invaderCardsInSlot(e))await a(t)}}Tm([Re],Em.prototype,"boards",void 0),Tm([Re],Em.prototype,"corners",void 0),Tm([xm()],Em.prototype,"destroyedBoards",null),Tm([xm()],Em.prototype,"locations",null),Tm([xm()],Em.prototype,"locationsIncludingNonExisting",null),Tm([xm()],Em.prototype,"nonDestroyedBoards",null);const Pm=[[1,-1],[1,0],[0,1],[-1,1],[-1,0],[0,-1]],Sm=[[[2,0,3],[2,-1,1],[2,0,0]],[[-1,2,5],[0,2,3],[-1,2,2]],[[-2,0,0],[-2,1,4],[-2,0,3]]],Om=[[[-2,2,3],[-2,1,5],[-2,2,0]],[[1,1,1],[0,2,3],[1,1,4]],[[2,-2,0],[2,-1,2],[2,-2,3]]],Cm=[[1,-1],[1,1],[-1,1],[-1,-1]],Dm=[[-1,0],[-1,2],[1,0],[1,-2]];class Bm{$;constructor(e){this.$=e,this.setupAdjacencies(),this.setupCorners()}static archipelagoConnections(e){return e.boards.map((a=>{if(!e.archipelagos)return null;const t=a.x,n=a.y,r=a.rotation,i=Pm[dm(r,6)],s=Pm[dm(r+1,6)],o=e.boards.findIndex((r=>{if(r!==a){const a=r.x,o=r.y,d=r.rotation,c=Pm[dm(d,6)],l=Pm[dm(d+1,6)],h=[[0,-1,0,-2],[0,-2,0,-1],e.thematic?[-1,0,0,-2]:[1,-1,0,-2],e.thematic?[0,-2,-1,0]:[0,-2,1,-1]].map((([e,r,d,h])=>{const u=t+e*i[0]+r*s[0],g=n+e*i[1]+r*s[1],f=a+d*c[0]+h*l[0],p=o+d*c[1]+h*l[1];return u===f&&g===p}));return h[0]&&h[1]||h[2]&&h[3]||h[4]&&h[5]}return!1}));return o>=0?o:null}))}static isPositionValidForBoard(e,a,t){const{boards:n,thematic:r}=e,i=Math.round(a.x),s=Math.round(a.y),o=a.rotation,d=Pm[dm(o,6)],c=Pm[dm(o+1,6)],l=[[0,0],r?[1,0]:[1,1],r?[1,-2]:[1,-1],[0,-1],r?[-1,0]:[-1,-1],r?[-1,2]:[-1,1]],h=[r?[1,-1]:[1,0],[0,1],r?[-1,1]:[-1,0],[0,-1]];return!n.some(((e,a)=>{if(a===t)return!1;const n=e.x,u=e.y,g=e.rotation,f=Pm[dm(g,6)],p=Pm[dm(g+1,6)];for(let e=0;e<2;e+=1)for(const[a,t]of 0===e?l:h){const r=i+a*d[0]+t*c[0],o=s+a*d[1]+t*c[1];for(const[a,t]of 0===e?h:l){const e=n+a*f[0]+t*p[0],i=u+a*f[1]+t*p[1];if(r===e&&o===i)return!0}}const w=Math.abs(dm(o,6)-dm(g,6));if(0!==w&&1!==w&&5!==w){const e=[r?[-1,0,1,-2]:[1,-1,-1,-1],r?[1,-2,-1,0]:[-1,-1,1,-1]].map((([e,a,t,r])=>{const o=i+e*d[0]+a*c[0],l=s+e*d[1]+a*c[1],h=n+t*f[0]+r*p[0],g=u+t*f[1]+r*p[1];return o===h&&l===g}));if(e[0]||e[1])return!0}return!1}))}static randomizeLayout(e){const a=e.boards.length,t=e.boards,n=e.thematic?Om:Sm,r=a>=4?4:3,i=a>=5?3:2,s=(a,t,n,s,o,d)=>{const c={x:a+s*Pm[dm(n,6)][0]+o*Pm[dm(n+1,6)][0],y:t+s*Pm[dm(n,6)][1]+o*Pm[dm(n+1,6)][1],rotation:dm(n+d,6)};return Bm.isPositionValidForBoard(e,c,-1)&&c.x>=-r&&c.x<=r&&c.y>=-i&&c.y<=i?c:null};for(let r=0;r<1e4;r+=1){e.boards=[{...t[0],x:0,y:0,rotation:a>1?Math.floor(6*Math.random()):0}];for(let r=1;r<a;r+=1){const a=[];for(let t=0;t<r;t+=1){const{x:r,y:i,rotation:o}=e.boards[t];for(let e=0;e<3;e+=1)for(let t=0;t<3;t+=1){const[d,c,l]=n[e][t],h=s(r,i,o,d,c,l);null!==h&&a.push(h)}e.archipelagos&&[[0,-3],e.thematic?[-1,-2]:[1,-3]].forEach((([e,t])=>{const n=s(r,i,o,e,t,3);null!==n&&(a.push(n),a.push(n),a.push(n))}))}if(!(a.length>0))break;e.boards.push({...t[e.boards.length],...a[Math.floor(Math.random()*a.length)]})}if(e.boards.length===a&&(!e.archipelagos||1===a||Bm.archipelagoConnections(e).filter((e=>null!==e)).length>(a>=4?2:1)))break}}randomFreePositionFromBoard(e){const a=this.$.config.thematic?Om:Sm,{x:t,y:n,r}=e.position,i=[];for(let e=0;e<3;e+=1)for(let s=0;s<3;s+=1){const[o,d,c]=a[e][s],l={x:t+o*Pm[dm(r,6)][0]+d*Pm[dm(r+1,6)][0],y:n+o*Pm[dm(r,6)][1]+d*Pm[dm(r+1,6)][1],rotation:dm(r+c,6)};Bm.isPositionValidForBoard(this.$.config,l,-1)&&i.push(l)}return i.length>0?this.$.drawFrom(i,i.map(((e,a)=>`${a}`))):Promise.resolve(null)}setupAdjacencies(){this.$.locations.forEach((e=>{e.adjacentLocations.length=0,e.locationsWithinBase.length=0,e.exists&&e.boardData&&e.boardData.adjacency[e.landIndex].forEach((a=>{const t=this.$.boards[e.boardIndex].locations[a];t.exists&&e.adjacentLocations.push(t)}))})),this.$.boards.forEach((e=>{e.boardDistance=this.$.boards.map((a=>a===e?0:null))}));for(const e of this.$.effectsMappedWithFilter(yn.ExtraAdjacency))for(const{land1:a,land2:t}of e)a.exists&&t.exists&&(a.adjacentLocations.push(t),t.adjacentLocations.push(a),a.boardIndex!==t.boardIndex&&(a.board.boardDistance[t.boardIndex]=0,t.board.boardDistance[a.boardIndex]=0));const e=this.$.config.thematic?Om:Sm;this.$.nonDestroyedBoards.forEach((a=>{const{x:t,y:n,r}=a.position;for(let i=0;i<3;i+=1)for(let s=0;s<3;s+=1){const[o,d,c]=e[i][s],l=t+o*Pm[dm(r,6)][0]+d*Pm[dm(r+1,6)][0],h=n+o*Pm[dm(r,6)][1]+d*Pm[dm(r+1,6)][1],u=dm(r+c,6),g=this.$.nonDestroyedBoards.find((e=>{const{x:a,y:t,r:n}=e.position;return a===l&&t===h&&dm(n,6)===dm(u,6)}));if(g){const e=a.data.outerBorders[i],t=g.data.outerBorders[s];a.boardDistance[g.boardIndex]=0;const n=a.data.terrain.map((()=>new Set));for(let a=0;a<7;a+=1)a>0&&n[e[a]].add(t[7-a]),n[e[a]].add(t[6-a]);n.forEach(((e,t)=>{a.locations[t].adjacentLocations.push(...Array.from(e).map((e=>g.locations[e])).filter((e=>e.exists)))}))}}}));const a=this.$.config.thematic?Dm:Cm,t=[];this.$.nonDestroyedBoards.forEach((e=>{a.forEach((([a,n],r)=>{const{x:i,y:s,r:o}=e.position,d=Pm[dm(o,6)],c=Pm[dm(o+1,6)],l=i+d[0]*a+c[0]*n,h=s+d[1]*a+c[1]*n,u=e.data.outerBorders[r<3?r:2][r<3?0:e.data.outerBorders[2].length-1],g=e.locations[u];t.push({x:l,y:h,land:g})}))}));for(const e of t)for(const a of t)e!==a&&e.x===a.x&&e.y===a.y&&(e.land.isAdjacentTo(a.land)||e.land.exists&&a.land.exists&&(e.land.adjacentLocations.push(a.land),e.land.board.boardDistance[a.land.board.boardIndex]=0));const n=Bm.archipelagoConnections(this.$.config);this.$.locations.forEach((e=>{const{locationsWithinBase:a}=e;let t=new Set([e]);for(;0===a.length||t.size>a[a.length-1].length;){a.push(Array.from(t));const e=new Set;a[a.length-1].forEach((a=>{[a,...a.adjacentLocations].forEach((a=>e.add(a)))})),this.$.config.archipelagos&&a.length>=2&&a[a.length-2].forEach((a=>{if(a.isCoastal){let t=n[a.boardIndex];if(null===t&&(t=n.findIndex((e=>e===a.boardIndex))),null!==t&&t>=0)for(const n of this.$.boards[t].lands)n.isCoastal&&(0!==a.board.boardDistance[n.board.boardIndex]&&(a.board.boardDistance[n.board.boardIndex]=1),e.add(n))}})),t=e}}));const r=(e=>{const a=e.length,t=[...e];for(let e=0;e<a;e+=1)for(let n=0;n<a;n+=1)for(let r=0;r<a;r+=1)if(null!==t[n][e]&&null!==t[e][r]){const a=t[n][e]+t[e][r];(null===t[n][r]||a<t[n][r])&&(t[n][r]=a)}return t})(this.$.boards.map((e=>e.boardDistance)));this.$.boards.forEach(((e,a)=>{e.boardDistance=r[a]}))}setupCorners(){const e={},a=(a,...t)=>{const n=`${t[0].board.name}_${t.map((e=>e.landNumber)).sort().join("_")}${a}`;void 0===e[n]&&(e[n]=new Im({$:this.$,boardIndex:t[0].boardIndex,landIndex:t.map((e=>e.landIndex)),name:n}))};for(const e of this.$.locations)if(e.exists)for(const t of e.adjacentLocations)if(t.board===e.board){for(const n of e.adjacentLocations)n.board===e.board&&t!==n&&t.isAdjacentTo(n)&&a("",e,t,n);e.isNorthern&&t.isNorthern&&a("_N",e,t),e.isEastern&&t.isEastern&&a("_E",e,t),e.isSouthern&&t.isSouthern&&a("_S",e,t),e.isWestern&&t.isWestern&&a("_W",e,t)}for(const e of this.$.nonDestroyedBoards)for(const t of e.inCornerLands().items){const n=t.inAdjacentLocations().where((a=>a.exists&&a.board!==e));if(n.count>0){const e=[t,...n.items.filter((e=>e.isCornerLand&&e.sharesCornerWith(t)))].sort(((e,a)=>e.coordinate.localeCompare(a.coordinate)))[0];let r="";e.isNorthern&&(r+="_N"),e.isEastern&&(r+="_E"),e.isSouthern&&(r+="_S"),e.isWestern&&(r+="_W"),a(r,e)}}this.$.setCorners(Object.values(e))}}var km,Lm=function(e,a,t,n){var r,i=arguments.length,s=i<3?a:null===n?n=Object.getOwnPropertyDescriptor(a,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,a,t,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(i<3?r(s):i>3?r(a,t,s):r(a,t))||s);return i>3&&s&&Object.defineProperty(a,t,s),s};class Fm{isInAdmin=!1;$;constructor(e){Xo.makeObservable(this),this.$=e}async enterAdminMode(){const e=this.$,a={c:!0};await this.$.addEffect({name:"Admin Mode",text:"Note: Using Admin Mode will disable achievements.",[yn.Now]:async()=>{this.isInAdmin=!0,await e.doGameAction((async()=>{for(;a.c;)await e.chooseBetween({effects:[...[e.Badlands,e.Beasts,e.Disease,e.Wilds,e.Dahan,e.Explorer,e.Town,e.City,e.Blight].map((a=>({actionId:a,label:Kn[a].text,[yn.Now]:async()=>{await e.inLands().pickMultiple({optional:!0,repeatSame:!0,forPickedItem:async t=>{a===e.Blight?await t.addBlight(1):await t.add(1,a)},effect:{text:`Add any ${Kn[a].text}.`}})}}))),{actionId:"Strife",label:"<strife>",text:"Add any <strife>.",[yn.Now]:async()=>{await e.forPiecesThatIs(e.Invader).pickMultiple({optional:!0,repeatSame:!0,forPickedItem:async e=>{await e.addStrife()}})}},{actionId:"Presence",label:"<presence>",text:"Add any <presence>.",[yn.Now]:async()=>{await e.fromAllSpirits().pickMultiple({optional:!0,repeatSame:!0,forPickedItem:async e=>{await e.addPresence({locations:Jn.AnyLands})}})}},{actionId:"Move",label:"Move pieces",text:"Move any pieces.",[yn.Now]:async()=>{await e.forPieces().pickMultiple({optional:!0,repeatSame:!0,forPickedItem:async e=>{await e.move({locations:{target:Jn.AnyLocations}})}})}},{actionId:"Damage",label:"Damage pieces",text:"Damage any pieces",[yn.Now]:async()=>{await e.forPiecesThatIs(e.InvaderOrDahan).pickMultiple({optional:!0,repeatSame:!0,forPickedItem:async e=>{await e.damageOnlyThis(1)}})}},{actionId:"Remove",label:"Remove pieces",text:"Remove any pieces",[yn.Now]:async()=>{await e.forPieces().pickMultiple({optional:!0,forPickedItem:async e=>{await e.remove()}})}},{actionId:"EarnFearCard",text:"Earn Fear Card",[yn.Now]:async()=>{await e.earnFearCard()}},{actionId:"AddFearCard",text:"Add Fear Card",[yn.Now]:async()=>{await e.addFearCards(1).toLevel(e.terrorLevel)}},{actionId:"DiscardFearCard",text:"Discard Fear Card",[yn.Now]:async()=>{await e.discardTopFearCard()}},{actionId:"GainEnergy",text:"Gain Energy",[yn.Now]:async()=>{await e.fromAllSpirits().pickMultiple({optional:!0,repeatSame:!0,forPickedItem:async e=>{await e.gainEnergy(1)}})}},{actionId:"PayEnergy",text:"Pay Energy",[yn.Now]:async()=>{await e.fromAllSpirits().pickMultiple({optional:!0,repeatSame:!0,forPickedItem:async e=>{e.energy>0&&await e.payEnergy(1)}})}},{actionId:"GainFear",text:"Gain <fear>",[yn.Now]:async()=>{await e.fear(1)}},{actionId:"LoseFear",text:"Lose <fear>",[yn.Now]:async()=>{await e.loseFear(1)}},{actionId:"DiscardTopInvaderCard",text:"Discard Top Invader Card",[yn.Now]:async()=>{await e.removeInvaderCard(0,{allCards:!0})}},{actionId:"AdvanceInvaderCards",text:"Advance Invader Cards",[yn.Now]:async()=>{await e.explore(),await e.advanceInvaderCards()}},{actionId:"Elements",text:"Elements",[yn.Now]:async()=>{await e.fromAllSpirits().pickOne((async e=>{await e.gainElements({anyAmount:!0})}))}},{actionId:"AllElements",text:"<any>",[yn.Now]:async()=>{await e.fromAllSpirits().pickOne((async e=>{await e.gainElementsForTheRestOfTheGame({[nr.Sun]:5,[nr.Moon]:5,[nr.Fire]:5,[nr.Air]:5,[nr.Water]:5,[nr.Earth]:5,[nr.Plant]:5,[nr.Animal]:5})}))}},{actionId:"AddBlightToBlightCard",text:"Add <blight> to Blight Card",[yn.Now]:async()=>{await e.addBlightToBlightCard(1)}},{actionId:"RemoveBlightFromBlightCard",text:"Remove <blight> from Blight Card",[yn.Now]:async()=>{await e.removeBlightFromBlightCard(1)}},{actionId:"SelectBlightCard",text:"Select Blight Card",[yn.Now]:async()=>{const a=await e.queryOptional({text:"Select Blight Card to put on top.",query:pn.SelectCard,items:e.blightCardsInDeck.unusedCards,actionIds:e.blightCardsInDeck.unusedCards});if(null!=a){const t=e.blightCardsInDeck.unusedCards[a];e.blightCardsInDeck.addStackedCard(t)}}},{actionId:"SelectFearcard",text:"Select Fear Card",[yn.Now]:async()=>{const a=await e.queryOptional({text:"Select Fear Card to put on top.",query:pn.SelectCard,optional:!0,items:e.fearCardsInDeck.unusedCards,actionIds:e.fearCardsInDeck.unusedCards});if(null!=a){const t=e.fearCardsInDeck.unusedCards[a];e.fearCardsInDeck.addStackedCard(t)}}},{actionId:"SelectEventCard",text:"Select Event Card",[yn.Now]:async()=>{const a=await e.queryOptional({text:"Select Event Card to put on top.",query:pn.SelectCard,optional:!0,items:e.eventCardsInDeck.unusedCards,actionIds:e.eventCardsInDeck.unusedCards});if(null!=a){const t=e.eventCardsInDeck.unusedCards[a];e.eventCardsInDeck.addStackedCard(t)}}},{actionId:"SelectInvaderCard",text:"Select Invader Card",[yn.Now]:async()=>{const a=e.exploreDeck.possibleCardsAt(0),t=await e.queryOptional({text:"Select Next Invader Card.",query:pn.SelectCard,optional:!0,items:a,actionIds:a});if(null!=t){const n=a[t];e.exploreDeck.addStackedCard(n)}}},{actionId:"SelectPowerCard",text:"Select Power Card",[yn.Now]:async()=>{const a=[Sn.Minor,Sn.Major],t=await e.queryOptional({query:pn.SelectPowerType,items:a,actionIds:a,autoPlayOneOption:!0});if(null!==t){const n=a[t],r=n===Sn.Minor?e.powercardsInMinorDeck:e.powercardsInMajorDeck,i=await e.queryOptional({text:`Select ${n} Card to put on top.`,query:pn.SelectCard,optional:!0,items:r.unusedCards,actionIds:r.unusedCards});if(null!=i){const e=r.unusedCards[i];r.addStackedCard(e)}}}},{actionId:"GainPower",text:"Gain Power",[yn.Now]:async()=>{const a=[Sn.Minor,Sn.Major];await e.fromAllSpirits().optionallyPickOne((async t=>{const n=await e.queryOptional({query:pn.SelectPowerType,items:a,actionIds:a,autoPlayOneOption:!0});if(null!==n){const r=a[n],i=r===Sn.Minor?e.powercardsInMinorDeck:e.powercardsInMajorDeck,s=await e.queryOptional({text:`Pick ${r} Power.`,query:pn.SelectCard,items:i.unusedCards,actionIds:i.unusedCards});if(null!=s){const e=i.unusedCards[s];i.remove(e),await t.gainPower(e)}}}))}},{actionId:"PlayPower",text:"Play Power",[yn.Now]:async()=>{await e.fromAllSpirits().optionallyPickOne((async e=>{await e.playAPowerCardByPayingItsCost()}))}},{actionId:"DiscardPower",text:"Discard Power",[yn.Now]:async()=>{await e.fromAllSpirits().optionallyPickOne((async e=>{await e.discardPowerCards(1)}))}},{actionId:"ForgetPower",text:"Forget Power",[yn.Now]:async()=>{await e.fromAllSpirits().optionallyPickOne((async e=>{await e.forgetPowers()}))}},{actionId:"ReclaimCards",text:"Reclaim Cards",[yn.Now]:async()=>{await e.fromAllSpirits().optionallyPickOne((async e=>{await e.reclaimCards({filter:e=>e.isInPlay||e.isInDiscard,optional:!0})}))}},{actionId:"CloseAdmin",text:"Close",[yn.Now]:()=>(a.c=!1,Promise.resolve())}]},{orChoice:!1})})),this.isInAdmin=!1}})}}Lm([Re],Fm.prototype,"isInAdmin",void 0);class Rm{adversary;leading;level;$;constructor(e,a,t,n){this.$=e,this.adversary=a,this.level=t,this.leading=n}get data(){return Yw[this.adversary]}get levelData(){return this.data.levels[this.level]}get name(){return`${this.data.name} ${this.level}`}async setup(){const{data:e}=this;await this.$.sendEvent({type:fn.SetupAdversary,adversary:this});for(let a=0;a<=this.level;a+=1)await this.$.addEffect({...e.levels[a].effect,adversary:this.adversary,adversaryLevel:a})}toString(){return this.name}}class Nm{adversaryLeading=null;adversarySupporting=null;$;constructor(e){this.$=e;const{adversaryLeading:a,adversarySupporting:t}=this.$.config;[this.adversaryLeading,this.adversarySupporting]=[a,t].map((e=>e?new Rm(this.$,e.adversary,e.level,e===a):null))}get maxTownsAllowed(){let e=0;return null!==this.adversarySupporting&&(this.adversaryLeading?.adversary===wg.France&&this.adversaryLeading?.level>=2?e=this.adversarySupporting.level*this.$.boardCount:this.adversarySupporting?.adversary===wg.France&&this.adversarySupporting?.level>=2&&(e=this.adversaryLeading.level*this.$.boardCount)),7*this.$.boardCount+e}async setup(){await(this.adversarySupporting?.setup()),await(this.adversaryLeading?.setup())}toString(){return bg({adversaryLeading:this.adversaryLeading,adversarySupporting:this.adversarySupporting},2)}}class $m{$;constructor(e){this.$=e}async setup(){if(this.$.playingWithCommandBeasts){await this.$.addFearCards(1).toLevel(2);const e=Re.box(2===this.$.stage?1:0),a=Re.box(3===this.$.stage?1:0),t=Re.box(0);await this.$.addSubEffect({[yn.GlobalReminder]:()=>({name:"Command Beast",text:"When reaching Invader Stage II and Invader Stage III, the Spirits earn the ability to command all Beasts on the island once.<br><br>During the <fast> phase: For each <beasts>, choose one of the following:<br><br>1 Damage<or>Push the <beasts>.<or>If Invaders are present, 1 <fear>.<br><br>You can use both Commands in the same <fast> Power Phase if you have both available.",icon:`<beasts><br>${t.get()} / ${e.get()+a.get()}`,ongoing:!0}),[yn.ExtraAction]:()=>this.$.phase!==Wi.FastPowers||t.get()>=e.get()+a.get()?null:{actionId:"CommandBeast",name:"Command Beast",text:"For each <beasts>, choose one of the following:<br><br>1 Damage.<or>Push the <beasts>.<or>If Invaders are present, 1 <fear>.",[yn.Now]:async()=>{t.set(t.get()+1);const e=[];await this.$.inLandsWith(this.$.Beasts).selectOrder().forEach((a=>this.$.doTokenEventAction((async()=>{const t=a.piecesWhere((a=>a.isBeasts&&!e.includes(a)));await t.pickMultiple({amount:t.count,forPickedItem:async t=>{e.push(t),await this.$.chooseBetween({effects:[{actionId:"Damage",text:"1 Damage.",[yn.Now]:async()=>{await a.damage(1)}},{actionId:"Push",text:"Push the <beasts>.",[yn.Now]:async()=>{await t.push()}},{actionId:"Fear",text:"If Invaders are present, 1 <fear>.",[yn.Now]:async()=>{await a.fear(1)},condition:()=>a.hasInvaders}]})}})}))),{noOptions:"No lands with <beasts>."})}},[yn.AfterChangingInvaderDeck]:()=>(this.$.phase!==Wi.Setup&&(2===this.$.stage?e.set(1):3===this.$.stage&&a.set(1)),Promise.resolve())})}}}class Wm{randomEventsEnabled=!0;resolvableCardsLeft=void 0;spiritSimulation=!1;alwaysPushToSameDestination=!1;disableRandomEvents(){this.randomEventsEnabled=!1}resolveMaximimumPowers(e){this.resolvableCardsLeft=e}simulateSpiritBoardOnly(){this.spiritSimulation=!0}simplifyMultiPush(){this.alwaysPushToSameDestination=!0}}class Mm{scenario=null;wave=0;$;constructor(e){this.$=e,this.scenario=this.$.config.scenario??null}get data(){return gm[this.scenario]}async setup(){if(null!==this.scenario){await this.$.sendEvent({type:fn.SetupScenario,scenario:this.data});const e=gm[this.scenario];await this.$.addEffect({name:e.name,effects:e.rules,scenario:this.scenario})}}toString(){return bg({scenario:this.scenario?Rd[this.scenario]:null,wave:this.wave},2)}}!function(e){e.PayEnergy="PayEnergy",e.ConvertElements="ConvertElements",e.DiscardPowerFromHand="DiscardPowerFromHand",e.ForgetPower="ForgetPower"}(km||(km={}));const Gm={name:"Amorphous",set:a.FeatherAndFlame,effects:[{name:"Setup Changes",text:"Lose Special Rule: Shadows of the Dahan",[yn.Now]:({$:e})=>(e.removeEffectsWithId(wn.Shadows),Promise.resolve())},{name:"Shadows Partake of Amorphous Space",effects:[{text:"During each <fast> phase, you may move 1 of your <presence> to an adjacent land, or to a land with <dahan> anywhere on the island.",[yn.Now]:async({$:e,you:a})=>{await a.addExtraAction({effectId:wn.ShadowsPartake,actionId:"ShadowsPartakeFast",icon:"<fast>",enabled:()=>e.phase===Wi.FastPowers,onActivate:async()=>{await a.presence().pickOne((async a=>{await a.move({destinationFilter:t=>t.isAdjacentTo(a.location)||t.has(e.Dahan),locations:{target:Jn.AnyLands}})}))}})}},{text:"During each <slow> phase, you may move 1 of your <presence> to an adjacent land, or to a land with <dahan> anywhere on the island.",[yn.Now]:async({$:e,you:a})=>{await a.addExtraAction({effectId:wn.ShadowsPartake,actionId:"ShadowsPartakeSlow",icon:"<slow>",enabled:()=>e.phase===Wi.SlowPowers,onActivate:async()=>{await a.presence().pickOne((async a=>{await a.move({destinationFilter:t=>t.isAdjacentTo(a.location)||t.has(e.Dahan),locations:{target:Jn.AnyLands}})}))}})}}]}]},Hm={name:"Foreboding",set:a.FeatherAndFlame,effects:[{name:"Setup Changes",effects:[{text:"Lose Special Rule: Shadows of the Dahan",[yn.Now]:({$:e})=>(e.removeEffectsWithId(wn.Shadows),Promise.resolve())},{text:"Gain Stretch Out Coils of Foreboding Dread",[yn.Now]:async({you:e})=>{await e.gainPower(Mi.StretchOutCoilsOfForebodingDread)}}]}]},jm={name:"Immense",set:a.FeatherAndFlame,effects:[{name:"An Immense Spirit, Towering and Slow",effects:[{text:"Your top Presence track grants you twice as much Energy during the Spirit Phase. Any ongoing modifiers are counted after doubling.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Immense,[yn.GlobalReminder]:()=>({icon:"x2<br>Energy",spirit:a,players:[a]}),[yn.AfterGainingEnergyFromTracks]:async()=>{await a.gainEnergyFromTracks()}})}},{text:"Playing Power Cards during the Spirit Phase costs 2 Card Plays instead of 1. (So if you have 3 Card Plays, you will only be able to play 1 Power Card.)",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Immense,[yn.GlobalReminder]:()=>({icon:"Card<br>Plays",spirit:a,players:[a]}),[yn.ExtraCardPlaysCost]:({spirit:e})=>e===a?1:0})}},{text:"If you have any unused Card Plays at the end of the Spirit Phase, gain 1 Element of your choice.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Immense,[yn.GlobalReminder]:()=>({icon:"Unused<br>=1 <any>",spirit:a,players:[a]}),[yn.AfterPlayPowers]:async()=>{a.usedCardPlays<a.cardPlays&&await a.gainElements()}})}},{text:"For each Major Power you play, gain 2 different Elements of your choice.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({[yn.GlobalReminder]:()=>({icon:"Major<br>=2 <any>",spirit:a,players:[a]}),[yn.AfterPlayPowers]:async()=>{const e=a.powersWhere((e=>e.isInPlay&&e.isA(En.Major))).count;e>0&&await _r(e,(async()=>{await a.gainElements({amount:2,different:!0})}))}})}}]}]},Um={name:"Might",set:a.FeatherAndFlame,effects:[{name:"Setup Changes",effects:[{text:"Lose Special Rule: Earth's Vitality.",[yn.Now]:({$:e})=>(e.removeEffectsWithId(wn.Earth),Promise.resolve())},{text:"Gain Earth Moves with Vigor and Might.",[yn.Now]:async({you:e})=>{await e.gainPower(Mi.EarthMovesWithVigorAndMight)}}]}]},qm={name:"Travel",set:a.FeatherAndFlame,effects:[{name:"Setup Changes",text:"Lose Special Rule: River's Domain",[yn.Now]:({$:e})=>(e.removeEffectsWithId(wn.River),Promise.resolve())},{name:"Travel on the River's Back",text:"After Growth, choose up to 2 <dahan> among your lands. Move each of them to any land contiguously connected by your <presence>.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Travel,[yn.GlobalReminder]:()=>({icon:"Move<br>2 <dahan>",spirit:a,players:[a]}),[yn.AfterGrowth]:async()=>{await a.forPiecesThatIs(e.Dahan).pickMultiple({amount:2,optional:!0,forPickedItem:async e=>{const t=e.location.landsContiguouslyConnectedBy(a);await e.move({locations:{target:Jn.AnyLands},destinationFilter:e=>t.includes(e)})},effect:{prompt:"Pick a <dahan> among your lands.",noOptions:"No <dahan> among your lands."}})}})}},{name:"People tend to the River, River tends to the People",text:"Your lands with 4 or more <dahan> are considered <sacred>, and have Defend 1.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Travel,[yn.GlobalReminder]:()=>({icon:"4 <dahan><br>= <sacred>",spirit:a,players:[a]}),[yn.HasSacredSiteOf]:({land:t,spirit:n,helpers:r})=>n===a&&t.hasPresenceOf(a,r)&&t.numberOf(e.Dahan)>=4,[yn.DefendFromSpirits]:({land:t})=>t.hasPresenceOf(a)&&t.numberOf(e.Dahan)>=4?1:0})}}]},_m={name:"Madness",set:a.JaggedEarth,effects:[{name:"Setup Changes",text:"Lose Special Rule: Shadows of the Dahan",[yn.Now]:({$:e})=>(e.removeEffectsWithId(wn.Shadows),Promise.resolve())},{name:"Shadows cast a Subtle Madness",text:"When you add <presence> during Growth, you may also add 1 <strife> in that land.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Madness,[yn.GlobalReminder]:()=>({icon:"<presence><br>+1 <strife>",ongoing:!0,spirit:a,players:[a]}),[yn.AfterAddingPiece]:async({additions:t})=>{e.phase===Wi.Grow&&t.length>0&&t[0].piece.isAPresenceOf(a)&&t[0].location.hasInvaders&&await t[0].location.addStrife(1,e.Invader,!0)}})}},{name:"Glimpse of the Shadowed Void",text:"When your <presence> is destroyed, if Invaders are present, 1 <fear> per <presence> destroyed there.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Madness,[yn.GlobalReminder]:()=>({icon:"<broken><br>1 <fear>",ongoing:!0,spirit:a,players:[a]}),[yn.AfterRemovePiece]:async({piece:t,location:n,removement:r})=>{t.isAPresenceOf(a)&&n.hasInvaders&&pr[r].isDestroyLike&&(await e.sendEvent({type:fn.GenericSub,text:"1 <presence> was destroyed while Invaders were present."}),await n.fear(1))}})}}]},Jm={name:"Pandemonium",set:a.JaggedEarth,effects:[{name:"Setup Changes",effects:[{text:"Lose Innate Power: Thundering Destruction.",[yn.Now]:async({you:e})=>{await e.forgetPower(Mi.ThunderingDestruction)}},{text:"Gain Lightning-Torn Skies Incite Pandemonium.",[yn.Now]:async({you:e})=>{await e.gainPower(Mi.LightningTornSkiesIncitePandemonium)}}]}]},Vm={name:"Reach",set:a.JaggedEarth,effects:[{name:"Setup Changes",text:"Lose Special Rule: Shadows of the Dahan",[yn.Now]:({$:e})=>(e.removeEffectsWithId(wn.Shadows),Promise.resolve())},{name:"Reach Through Ephemeral Distance",text:'Once per turn, you may ignore Range.<br><br>(This can be during Growth or for a Power - anything for which there\'s a Range arrow or the word "Range" is used. It affects a single action of yours.',[yn.Now]:async({$:e,you:a})=>{await a.addExtraAction({effectId:wn.Reach,actionId:"Reach",icon:"Range",enabled:()=>[Wi.Grow,Wi.GainEnergy,Wi.FastPowers,Wi.SlowPowers].includes(e.phase),onActivate:async()=>{let t=!0;await e.addEffectUntilEndOfTurn({[yn.GlobalReminder]:()=>({text:"Ignore Range for the next Action.",icon:"Ignore<br>Range",spirit:a,players:[a]}),[yn.ExtraRange]:e=>e.spirit===a?99:0,[yn.AnyActionEnds]:()=>(t?t=!1:e.removeThisEffect(),Promise.resolve())})}})}}]},Ym={name:"Resilience",set:a.JaggedEarth,effects:[{name:"Setup Changes",text:"Lose Special Rule: Earth's Vitality",[yn.Now]:({$:e})=>(e.removeEffectsWithId(wn.Earth),Promise.resolve())},{name:"Anchor the Land's Resilience",text:"In lands with your <sacred>, it takes 8 additional Damage to add <blight> to the land.<br><br>(So, usually, 10 Damage will add <blight>. This does not protect <dahan> at all; Damage to them is unaffected.)",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Resilience,[yn.GlobalReminder]:()=>({icon:"<sacred><br>+8 HP",ongoing:!0,spirit:a,players:[a]}),[yn.AdjustLandHealth]:({land:e})=>e.hasSacredSiteOf(a)?8:0})}}]},zm={name:"Sunshine",set:a.JaggedEarth,effects:[{name:"Setup Changes",effects:[{text:"Forget Boon of Vigor.",[yn.Now]:async({you:e})=>{await e.forgetPower(Mi.BoonOfVigor,{canRegain:!1})}},{text:"Gain 1 Energy.",[yn.Now]:async({you:e})=>{await e.gainEnergy(1)}},{text:"Gain Boon of Sunshine's Promise.",[yn.Now]:async({you:e})=>{await e.gainPower(Mi.BoonOfSunshinesPromise)}}]}]},Qm={name:"Wind",set:a.JaggedEarth,effects:[{name:"Setup Changes",effects:[{text:"Lose Special Rule: Swiftness of Lightning.",[yn.Now]:({$:e})=>(e.removeEffectsWithId(wn.Lightning),Promise.resolve())},{text:"Gain Exaltation of the Storm-Wind.",[yn.Now]:async({you:e})=>{await e.gainPower(Mi.ExaltationOfTheStormWind)}}]}]},Km={name:"Dark Fire",set:a.NatureIncarnate,effects:[{name:"Setup Changes",effects:[{text:"Lose Special Rule: Shadows of the Dahan.",[yn.Now]:({$:e})=>(e.removeEffectsWithId(wn.Shadows),Promise.resolve())},{text:"Gain Minor Power: Unquenchable Flames.",[yn.Now]:async({you:e})=>{await e.gainPower(Mi.UnquenchableFlames)}}]},{name:"Dark and Fire as One",effects:[{text:"You may treat each <moon> available to you as being <fire>, or vice versa. (Choose during each Action for each <moon>/<fire> you have.) You may discard or Forget Powers that grant <moon> to pay for <fire> Choice Events, and vice versa.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.DarkFire,[yn.GlobalReminder]:()=>({icon:"<darkfire>",ongoing:!0,spirit:a,players:[a]}),[yn.TreatElementAsElement]:({spirit:e,element:t})=>e!==a||t!==nr.Fire&&t!==nr.Moon?t:nr.DarkFire,[yn.TreatElementsAsElements]:({spirit:e,elements:t})=>{if(e===a){const e={...t};return delete e[nr.Fire],delete e[nr.Moon],void 0===t[nr.DarkFire]&&void 0===t[nr.Fire]&&void 0===t[nr.Moon]||(e[nr.DarkFire]=(t[nr.DarkFire]??0)+(t[nr.Fire]??0)+(t[nr.Moon]??0)),e}return t}})}}]},{name:"Frightful Shadows Elude Destruction",effects:[{text:"The first time each Action would destroy your <presence>, you may Push 1 of those <presence> instead of destroying it.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({[yn.PreventRemovePiece]:async({piece:t,removement:n})=>!(!t.isAPresenceOf(a)||!pr[n].isDestroyLike||e.action.type===Ho.GameAction||e.action.data.hasDestroyedPresence||(e.action.data.hasDestroyedPresence=!0,!await e.may({prompt:"Push 1 of those <presence> instead of destroying it?"})))&&(await t.push({pieces:e.Presence}),!0),[yn.GlobalReminder]:()=>({icon:"Push <presence>",ongoing:!0})})}}]},{name:"Bonus Track Action",effects:[{text:"Fire (or Moon).",[yn.Now]:async({you:e})=>{await e.gainElementsForTheRestOfTheGame({[nr.DarkFire]:1})}}]}]},Xm={name:"Deeps",set:a.NatureIncarnate,effects:[{name:"Setup Changes",effects:[{text:"Replace Innate Power: 'Ocean Breaks The Shore' with 'Water Eats Away The Deep Roots Of Earth'.",[yn.Now]:async({you:e})=>{await e.replacePower(Mi.OceanBreaksTheShore,{withPower:Mi.WaterEatsAwayTheDeepRootsOfEarth})}},{text:"Replace Innate Power: 'Pound Ships To Splinters' with 'Reclaimed By The Deeps'.",[yn.Now]:async({you:e})=>{await e.replacePower(Mi.PoundShipsToSplinters,{withPower:Mi.ReclaimedByTheDeeps})}}]}]},Zm={name:"Encircle",set:a.NatureIncarnate,effects:[{name:"Setup Changes",effects:[{text:"Lose Special Rule: Ally of the Beasts.",[yn.Now]:({$:e})=>(e.removeEffectsWithId(wn.FangsAllyOfTheBeasts),Promise.resolve())},{text:"Replace Innate Power: 'Ranging Hunt' with 'Encircle The Unsuspecting Prey'.",[yn.Now]:async({you:e})=>{await e.replacePower(Mi.RangingHunt,{withPower:Mi.EncircleTheUnsuspectingPrey})}}]},{name:"Pack Hunting",effects:[{text:"Your Powers get <range+1> for targeting lands with <beasts>.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Encircle,[yn.GlobalReminder]:()=>({icon:"<beasts><br><range+1>",ongoing:!0,players:[a]}),[yn.ExtraRangeToLand]:t=>({extraRangeToLand:t.spirit===a&&void 0!==e.action.power&&t.targetingLands?1:0,landFilter:a=>a.has(e.Beasts)})})}}]}]},ev={name:"Enticing",set:a.NatureIncarnate,effects:[{name:"Setup Changes",effects:[{text:"Replace Innate Power: 'Night Terrors' with 'Enticing And Lulling Dreams'.",[yn.Now]:async({you:e})=>{await e.replacePower(Mi.NightTerrors,{withPower:Mi.EnticingAndLullingDreams})}}]}]},av={name:"Haven",set:a.NatureIncarnate,effects:[{name:"Setup Changes",effects:[{text:"Replace Innate Power: 'Massive Flooding' with 'Call To A Sunlit Haven'.",[yn.Now]:async({you:e})=>{await e.replacePower(Mi.MassiveFlooding,{withPower:Mi.CallToASunlitHaven})}}]}]},tv={name:"Intensify",set:a.NatureIncarnate,effects:[{name:"Setup Changes",effects:[{text:"Lose Special Rule: Insights into the World's Nature.",[yn.Now]:({$:e})=>(e.removeEffectsWithId(wn.MemoryInsight),Promise.resolve())}]},{name:"Intensify Through Understanding",effects:[{text:"You may spend Element Markers to modify your Actions (max. 1 of each Marker per Action). Except for <air>, each modifier applies to 1 land. (The Action must already do that effect there.)",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Intensify,spirit:a,[yn.AfterAddingStrife]:async({piece:t,pieceFilter:n})=>{void 0===e.action.data.usedElement&&(e.action.data.usedElement=[]),e.action.spirit===a&&!e.action.data.usedElement.includes(nr.Sun)&&a.preparedElements[nr.Sun]>0&&await e.may({prompt:"Spend 1 prepared <sun> to add +1 <strife>?"})&&(a.preparedElements[nr.Sun]-=1,e.action.data.usedElement.push(nr.Sun),await t.location.addStrife(1,n))},[yn.DamageBoost]:async({filter:t,onUse:n})=>{void 0===e.action.data.usedElement&&(e.action.data.usedElement=[]),e.action.spirit===a&&!e.action.data.usedElement.includes(nr.Fire)&&a.preparedElements[nr.Fire]>0&&await e.may({prompt:`Spend 1 prepared <fire> to add +1 <damage> to ${Kn[t].text}?`})&&(a.preparedElements[nr.Fire]-=1,e.action.data.usedElement.push(nr.Fire),await n())},[yn.ExtraDefense]:async({location:t})=>(void 0===e.action.data.usedElement&&(e.action.data.usedElement=[]),!!(e.action.spirit===a&&!e.action.data.usedElement.includes(nr.Earth)&&a.preparedElements[nr.Earth]>0&&await e.may({prompt:"Spend 1 prepared <earth> to Defend +2?",highlightLocations:[t]}))&&(a.preparedElements[nr.Earth]-=1,e.action.data.usedElement.push(nr.Earth),!0)),[yn.ExtraMove]:async({movement:t,pieces:n,location:r,possiblePieces:i})=>(void 0===e.action.data.usedElement&&(e.action.data.usedElement=[]),!!(e.action.spirit===a&&t!==Fr.Relocate&&!e.action.data.usedElement.includes(nr.Water)&&a.preparedElements[nr.Water]>0&&await e.may({prompt:`Spend 1 prepared <water> to ${Go[t].verb} +1 ${Kn[n].text}?`,highlightLocations:[r],highlightPieces:i}))&&(a.preparedElements[nr.Water]-=1,e.action.data.usedElement.push(nr.Water),!0)),[yn.ExtraRemove]:async({removement:t,pieces:n,location:r,possiblePieces:i})=>(void 0===e.action.data.usedElement&&(e.action.data.usedElement=[]),!(e.action.spirit!==a||t!==Nn.Remove&&t!==Nn.RemoveFromGame&&t!==Nn.Replace||e.action.data.usedElement.includes(nr.Moon)||!(a.preparedElements[nr.Moon]>0)||!await e.may({prompt:`Spend 1 prepared <moon> to ${pr[t].verb} +1 ${Kn[n].text}?`,highlightLocations:[r],highlightPieces:i}))&&(a.preparedElements[nr.Moon]-=1,e.action.data.usedElement.push(nr.Moon),!0)),[yn.AddTwoExtraBroken]:async({land:t})=>(void 0===e.action.data.usedElement&&(e.action.data.usedElement=[]),e.action.spirit===a&&!e.action.data.usedElement.includes(nr.Plant)&&a.preparedElements[nr.Plant]>0&&await e.may({highlightLocations:[t],prompt:"Spend 1 prepared <plant> to add +2 <broken>?"})?(a.preparedElements[nr.Plant]-=1,e.action.data.usedElement.push(nr.Plant),Promise.resolve(!0)):Promise.resolve(!1)),[yn.AfterAddingPiece]:async({additions:t,land:n})=>{void 0===e.action.data.usedElement&&(e.action.data.usedElement=[]);for(let r=0;r<4;r+=1){const i=[Bn.Badlands,Bn.Wilds,Bn.Disease,Bn.Beasts][r],s=[nr.Sun,nr.Plant,nr.Animal,nr.Animal][r];e.action.spirit===a&&!e.action.data.usedElement.includes(s)&&a.preparedElements[s]>0&&t.some((e=>e.piece.piece===i))&&await e.may({prompt:`Spend 1 prepared ${Vy[s].text} to add +1 ${Kn[i].text}?`})&&(a.preparedElements[s]-=1,e.action.data.usedElement.push(s),await n.add(i===Bn.Wilds?2:1,Qn[i]))}},[yn.MayChangeSpeedOfPower]:({power:e})=>e.isSlow&&e.owner===a&&e.isA(En.Minor)&&a.preparedElements[nr.Air]>0,[yn.ChangeSpeedOfPower]:async({power:t})=>{await t.makeFast(),a.preparedElements[nr.Air]-=1,await e.sendEvent({type:fn.GenericMain,text:`Intensify used Intensify Through Understanding to make ${t.powerLink} fast.`})}})}}]},{name:"Bonus Track Action",effects:[{text:"Moon, Any.",[yn.Now]:async({you:e})=>{await e.gainElementsForTheRestOfTheGame({[nr.Moon]:1,[nr.Any]:1})}}]}]},nv={name:"Lair",set:a.NatureIncarnate,effects:[{name:"Setup Changes",effects:[{text:"Put your Incarna (<incarna-lair>) in an Inland land on your starting board.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Lair,[yn.AdjustSetupPresence]:async({spirit:t})=>{if(t===a){const t=a.startingBoard.inLandNumber(8);return await t.add(1,e.Beasts),await a.startingBoard.inInlandLands().pickOne((async e=>{await e.addIncarna(Bn.IncarnaLair,a)})),e.removeThisEffect(),!0}return!1}})}},{text:"Lose Special Rule: Enthrall the Foreign Explorers.",[yn.Now]:({$:e})=>(e.removeEffectsWithId(wn.LureEnthrallTheForeignExplorers),Promise.resolve())},{text:"Replace Innate Power: 'Forsake Society To Chase After Dreams' with 'Society Dissolves At The Beckoning Heart'.",[yn.Now]:async({you:e})=>{await e.replacePower(Mi.ForsakeSocietyToChaseAfterDreams,{withPower:Mi.SocietyDissolvesAtTheBeckoningHeart})}}]},{name:"A Single Alluring Lair",effects:[{text:"Invaders/<dahan>/<beasts>/<presence> (of any Spirit) at <incarna-lair> can't move. (You can reposition <incarna-lair> by adding it with your second Growth option instead of adding <presence>.)",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Lair,[yn.GlobalReminder]:()=>({icon:"<incarna-lair>",text:"Invaders/<dahan>/<beasts>/<presence> (of any Spirit) at <incarna-lair> can't move. (You can reposition <incarna-lair> by adding it with your second Growth option instead of adding <presence>.)<br><br>6 <explorer> and 3 <dahan> at <incarna-lair> don't participate in Ravage. (They don't deal Damage or take Damage.)",ongoing:!0,spirit:a,players:[a]}),[yn.PreventMovePiece]:({piece:a,movement:t,source:n})=>n.has(e.IncarnaLair)&&a.isOneOfIgnoringCountAs(e.Invader,e.Dahan,e.Beasts,e.Presence)&&t!==Fr.Relocate})}},{text:"6 <explorer> and 3 <dahan> at <incarna-lair> don't participate in Ravage. (They don't deal Damage or take Damage.)",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.Lair,[yn.DoesNotParticipateInRavage]:async({location:a})=>{a.has(e.IncarnaLair)&&(await a.doNotParticipateInRavage({quantifier:lr.Exactly,amount:6,pieces:e.Explorer}),await a.doNotParticipateInRavage({quantifier:lr.Exactly,amount:3,pieces:e.Dahan}))}})}}]},{name:"Incarna",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Lair,text:"<incarna-lair> may count as <presence>/<sacred>.",[yn.GlobalReminder]:()=>({icon:"<incarna-lair> =<br><presence>/<sacred>",ongoing:!0,spirit:a,players:[a]}),[yn.HasSacredSiteOf]:({land:e,spirit:t})=>t===a&&e.pieces.some((e=>e.piece===Bn.IncarnaLair))})}}]},rv={name:"Locus",set:a.NatureIncarnate,effects:[{name:"Setup Changes",effects:[{text:"Replace Unique Power: 'Elemental Aegis' with 'Pull Beneath The Hungry Earth'.",[yn.Now]:async({you:e})=>{await e.replacePower(Mi.ElementalAegis,{withPower:Mi.PullBeneathTheHungryEarth})}},{text:"Put your Incarna (<incarna-locus>) and the <presence> from the <fire> space of your <presence> track on your starting board in land #5.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Locus,[yn.AfterSetupPresence]:async()=>{await a.removePresenceFromTrack(1),await a.startingBoard.inLandNumber(5).addIncarna(Bn.IncarnaLocus,a),await a.startingBoard.inLandNumber(5).createPiece(1,Bn.Presence,a.spiritNumber),e.removeThisEffect()}})}},{text:"Replace Innate Power: 'Serpent Wakes In Power' with 'Strength Of The Waking Island'.",[yn.Now]:async({you:e})=>{await e.replacePower(Mi.SerpentWakesInPower,{withPower:Mi.StrengthOfTheWakingIsland})}}]},{name:"Locus of the Serpent's Regard",effects:[{text:"Spirits with absorbed <presence> can use your <presence> at <incarna-locus> for targeting.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Locus,[yn.GlobalReminder]:()=>({icon:"<incarna-locus><br><presence>",ongoing:!0,spirit:a,players:[a]}),[yn.MayUseOtherSpiritPresenceForTargeting]:({spirit:e})=>e!==a&&null!=a.incarna?a.incarna.location.pieces.filter((e=>e.isPresence&&e.owner===a)):[]})}},{text:"After uncovering the <earth> space of your <presence> track, Empower <incarna-locus>.",[yn.Now]:async({$:e,you:a,effect:t,...n})=>{const r={triggerId:e.nextTriggerId(),[yn.Now]:async()=>{await e.doSpiritAction((async()=>{await a.empowerIncarna()}),{spirit:a})}};await e.addSubEffect({effectId:wn.Locus,[yn.AfterUncoveringTrack]:async({spirit:i,trackIndex:s})=>{i===a&&8===s&&await e.addTrigger(r,t,n.action)}})}}]},{name:"Bonus Track Action",effects:[{text:"Add/Move <incarna-locus> to Land with Your Presence.",[yn.Now]:async({$:e,you:a})=>{await a.addExtraAction({effectId:wn.Locus,actionId:"LocusBonusAction",icon:"<incarna-locus>",maxUses:()=>1,enabled:()=>[Wi.Grow,Wi.GainEnergy].includes(e.phase),onActivate:async()=>{await e.addSubEffect({highlightPieces:null!=a.incarna?[a.incarna]:[],[yn.Now]:async()=>{await a.inLands().pickOne((async e=>{null==a.incarna?await e.addIncarna(Bn.IncarnaLocus,a):await a.incarna.move({locations:{target:Jn.ToThisLocation,location:e}})}))}})}})}}]},{name:"Incarna",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Locus,text:"<incarna-locus> may count as <presence>.<br><br>When empowered it may also count as <badlands>.",[yn.GlobalReminder]:()=>({icon:"<incarna-locus> =<br><presence>"+(a.hasEmpoweredIncarna?"/<badlands>":""),ongoing:!0,spirit:a,players:[a]})})}}]},iv={name:"Mentor",set:a.NatureIncarnate,effects:[{name:"Setup Changes",effects:[{text:"Lose Special Rule: Long Ages of Knowledge and Forgetfulness.",[yn.Now]:({$:e})=>(e.removeEffectsWithId(wn.MemoryKnowledge),Promise.resolve())},{text:"Replace Innate Power: 'Observe The Ever Changing World' with 'Share Mentorship And Expertise'.",[yn.Now]:async({you:e})=>{await e.replacePower(Mi.ObserveTheEverChangingWorld,{withPower:Mi.ShareMentorshipAndExpertise})}}]},{name:"Past Teaching Spring Forth Unbidden",effects:[{text:"When you gain Power Cards, draw 2 fewer cards (min. 2) and gain 1 more of them (normally draw 2 cards and gain both). (Forget only one Power Card when gaining Major Powers.)",[yn.Now]:async({you:e,$:a})=>{await a.addSubEffect({effectId:wn.Mentor,[yn.ExtraCardDrawAmount]:({spirit:a})=>a===e?-2:0,[yn.ExtraCardKeepAmount]:({spirit:a})=>a===e?1:0})}}]}]},sv={name:"Nourishing",set:a.NatureIncarnate,effects:[{name:"Setup Changes",effects:[{text:"Lose Special Rule: Earth's Vitality.",[yn.Now]:({$:e})=>(e.removeEffectsWithId(wn.Earth),Promise.resolve())},{text:"Replace Unique Power: 'A Year Of Perfect Stillness' with 'Voracious Growth'.",[yn.Now]:async({you:e})=>{await e.replacePower(Mi.AYearOfPerfectStillness,{withPower:Mi.VoraciousGrowth})}},{text:"Gain Innate Power: Imbue With Nourishing Vitality.",[yn.Now]:async({you:e})=>{await e.gainPower(Mi.ImbueWithNourishingVitality)}}]},{name:"Imbue with Nourishing Vitality",effects:[{text:"After you gain a Major Power, gain a Minor Power.",[yn.Now]:async({you:e,$:a})=>{await a.addSubEffect({effectId:wn.Nourishing,[yn.GlobalReminder]:()=>({icon:"Major<br>Power",ongoing:!0,spirit:e,players:[e]}),[yn.AfterGainingPowers]:async({powerGain:a,spirit:t})=>{t===e&&!a.gifted&&!a.taken&&a.chosen.length>0&&a.chosen[0].data.type===Sn.Major&&await e.gainPowerCard({powerType:Sn.Minor})}})}}]}]},ov={name:"Regrowth",set:a.NatureIncarnate,effects:[{name:"Setup Changes",effects:[{text:"Lose Special Rule: Steady Regeneration.",[yn.Now]:({$:e})=>(e.removeEffectsWithId(wn.GreenSteadyRegeneration),Promise.resolve())},{text:"Replace Innate Power: 'All-Enveloping Green' with 'Unbelievable Regrowth'.",[yn.Now]:async({$:e,you:a})=>{await a.replacePower(Mi.AllEnvelopingGreen,{withPower:Mi.UnbelievableRegrowth}),await e.addSubEffect({effectId:wn.Regrowth,[yn.MayIgnoreTargetFilterWhenTargetingLand]:({power:e})=>e.power===Mi.UnbelievableRegrowth&&e.owner.hasElementsWithConvert({[nr.Water]:2,[nr.Plant]:3})})}},{text:"Take 13 <broken>.",[yn.Now]:({you:e})=>(e.destroyedPresence+=13,Promise.resolve())}]}]},dv={name:"Sparking",set:a.NatureIncarnate,effects:[{name:"Setup Changes",effects:[{text:"Replace Innate Power: 'Thundering Destruction' with 'Gift Of The Sparking Sky'.",[yn.Now]:async({you:e})=>{await e.replacePower(Mi.ThunderingDestruction,{withPower:Mi.GiftOfTheSparkingSky})}},{text:"Replace Unique Power: 'Raging Storm' with 'Smite The Land With Fulmination'.",[yn.Now]:async({you:e})=>{await e.replacePower(Mi.RagingStorm,{withPower:Mi.SmiteTheLandWithFulmination})}}]}]},cv={name:"Hostility",set:a.NatureIncarnate,effects:[{name:"Setup Changes",effects:[{text:"Lose rightmost Growth option.",[yn.Now]:({you:e})=>(e.disabledGrowthOptions.push(3),Promise.resolve())},{text:"Gain 1 Energy.",[yn.Now]:async({you:e})=>{await(e?.gainEnergy(1))}}]},{name:"Lands Hostile to Humanity",effects:[{text:"Your <sacred> may also count as <badlands>. (Choose for each Action.)",[yn.Now]:async({you:e})=>{await e.yourSacredSitesMayAlsoCountAs(Bn.Badlands)}}]},{name:"Seeds of Teaching Sprout and Grow",effects:[{text:"Energy numbers on your top <presence> track are halved (round up).",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.SpreadingHostility,[yn.GlobalReminder]:()=>({icon:"1/2<br>Energy",spirit:a,players:[a]}),[yn.AfterGainingEnergyFromTracks]:async()=>{await a.loseEnergy(Math.floor(a.trackEnergy/2))}})}}]},{name:"Implacable and Spreading Enmity",effects:[{text:"Your rightmost (4th) Growth option is replaced with:",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.SpreadingHostility,[yn.SpiritHasExtraGrowthOptions]:({spirit:e})=>e===a?{effects:[{text:"Gain Fire",[yn.Now]:async()=>{await a.gainElementsUntilEndOfTurn({[nr.Fire]:1})}},{text:"Move a <presence> in <range-1>",[yn.Now]:async()=>{await a.movePresence(1)}},{text:"Move a Presence in <range-1>",[yn.Now]:async()=>{await a.movePresence(1)}},{text:"1 Damage at Range 0",[yn.Now]:async()=>{await a.inLandsWithinRange(0).pickOne((async e=>{await e.damage(1)}))}}]}:null}),bm(a,"growthOptions"),a.growthStatus=a.growthOptions.map((()=>Ly.Available))}}]}]},lv={name:"Stranded",set:a.NatureIncarnate,effects:[{name:"Setup Changes",effects:[{text:"Lose Special Rule: Mists Shift and Flow.",[yn.Now]:({$:e})=>(e.removeEffectsWithId(wn.ShroudMistsShiftAndFlow),Promise.resolve())}]},{name:"Mists Steadily Drift",effects:[{text:"Up to twice during the <fast> phase and up to twice during the <slow> phase, Push 1 of your <presence>. (If helpful, use Scenario Markers to track uses.)",[yn.Now]:async({$:e,you:a})=>{for(const t of[Wi.FastPowers,Wi.SlowPowers])await a.addExtraAction({effectId:wn.Stranded,actionId:`MistsSteadilyDrift${t}`,icon:"<presence>",maxUses:()=>2,enabled:()=>e.phase===t,visible:()=>e.phase===t,onActivate:async()=>{await a.presence().pickOne((async e=>{await e.push()}))}})}}]},{name:"Stranded In the Shifting Mist",effects:[{text:"Once each <fast> phase, Isolate one of your lands.",[yn.Now]:async({$:e,you:a})=>{await a.addExtraAction({effectId:wn.Stranded,actionId:"StrandedInTheShiftingMist",icon:"Isolate",enabled:()=>e.phase===Wi.FastPowers,onActivate:async()=>{await a.inLands().pickOne((async e=>{await e.isolate()}))}})}}]}]},hv={name:"Tactician",set:a.NatureIncarnate,effects:[{name:"Setup Changes",effects:[{text:"Lose rightmost Growth option.",[yn.Now]:({you:e})=>(e.disabledGrowthOptions.push(2),Promise.resolve())}]},{name:"Adaptable Tactician",effects:[{text:"Your 3rd Growth option is replaced by:",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Tactician,[yn.SpiritHasExtraGrowthOptions]:({spirit:e})=>e===a?{effects:[{text:"Gain Power Card",[yn.Now]:async()=>{await a.gainPowerCard()}},{text:"Add a Presence",[yn.Now]:async()=>{await a.addPresenceInRange(0)}},{text:"Gain +1 Energy",[yn.Now]:async()=>{await a.gainEnergy(1)}},{text:"Gain Sun OR Fire",[yn.Now]:async()=>{await a.gainElements({elements:[nr.Sun,nr.Fire]})}}]}:null}),bm(a,"growthOptions"),a.growthStatus=a.growthOptions.map((()=>Ly.Available))}}]}]},uv={name:"Tangles",set:a.NatureIncarnate,effects:[{name:"Setup Changes",effects:[{text:"Replace Innate Power: 'Creepers Tear Into Mortar' with 'Impenetrable Tangles Of Greenery'.",[yn.Now]:async({you:e})=>{await e.replacePower(Mi.CreepersTearIntoMortar,{withPower:Mi.ImpenetrableTanglesOfGreenery})}},{text:"Replace Unique Power: 'Gift Of Proliferation' with 'Belligerent And Aggressive Crops'.",[yn.Now]:async({you:e})=>{await e.replacePower(Mi.GiftOfProliferation,{withPower:Mi.BelligerentAndAggressiveCrops})}}]}]},gv={name:"Transforming",set:a.NatureIncarnate,effects:[{name:"Setup Changes",effects:[{text:"Replace Innate Power: 'The Burned Land Regrows' with 'Exaltation Of The Transforming Flame'.",[yn.Now]:async({you:e})=>{await e.replacePower(Mi.TheBurnedLandRegrows,{withPower:Mi.ExaltationOfTheTransformingFlame})}}]},{name:"Transform Rather Than Consume",effects:[{text:"When your Actions would Destroy <city> (including by Damage), instead:<br>2 <fear>. Replace that <city> with <town> and 1 <explorer>. Push both Invaders.<br><br>When your Actions would Destroy <town> (including by Damage), instead: 1 <fear>. Replace that <town> with <explorer>. Push both Invaders.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Transforming,[yn.GlobalReminder]:()=>({icon:"Transform",ongoing:!0,spirit:a,players:[a]}),[yn.PreventRemovePiece]:async({piece:t,removement:n})=>{if(e.action.spirit===a&&pr[n].isDestroyLike&&t.isA(e.TownOrCity)){const a=t.isA(e.City);return await e.addSubEffect({text:a?"When your Actions would Destroy <city> (including by Damage), instead:<br>2 <fear>. Replace that <city> with <town> and 1 <explorer>. Push both Invaders.":"When your Actions would Destroy <town> (including by Damage), instead: 1 <fear>. Replace that <town> with <explorer>. Push both Invaders.",[yn.Now]:async()=>{await t.location.fear(a?2:1),t.damage=0;const e=[];e.push(...(await t.replace([a?Bn.Town:Bn.Explorer,Bn.Explorer])).added);for(const a of e)await a.piece.push()}}),!0}return!1}})}}]}]},fv={name:"Unconstrained",set:a.NatureIncarnate,effects:[{name:"Setup Changes",effects:[{text:"Lose Special Rule: Call Forth Predators.",[yn.Now]:({$:e})=>(e.removeEffectsWithId(wn.FangsCallForthPredators),Promise.resolve())},{text:"Do not Add a <beasts> as part of Spirit Setup.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Unconstrained,[yn.PreventAddPiece]:({piece:t,location:n})=>Promise.resolve(e.phase===Wi.SetupPresence&&t===Bn.Beasts&&n.hasPresenceOf(a)),[yn.AfterSetupPresence]:()=>(e.removeThisEffect(),Promise.resolve())})}}]},{name:"Unconstrained by Ravaged Lands",text:"Ranging Hunt (your left Innate Power) may target lands with <blight>.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Unconstrained,[yn.GlobalReminder]:()=>({icon:"Target<br><blight>",ongoing:!0,spirit:a,players:[a]}),[yn.MayIgnoreTargetFilterWhenTargetingLand]:({power:e})=>e.power===Mi.RangingHunt})}},{name:"Predators Arise",text:"Each Spirit Phase, either Prepare 1 <beasts> (storing it next to your Spirit Panel) or Add any number of your prepared <beasts> to one of your lands.",[yn.Now]:async({$:e,you:a})=>{await a.addExtraAction({effectId:wn.Unconstrained,actionId:"PredatorsArise",icon:"+1 <beasts>",text:"Either Prepare 1 <beasts> (storing it next to your Spirit Panel) or Add any number of your prepared <beasts> to one of your lands.",enabled:()=>e.phase===Wi.Grow||e.phase===Wi.GainEnergy,onActivate:async()=>{await e.addSubEffect({[yn.Now]:async()=>{await e.chooseBetween({effects:[{actionId:"PrepareBeast",text:"Prepare 1 <beasts>",[yn.Now]:async()=>{await a.addPrepareBeast(1)}},{actionId:"AddBeasts",text:"Add any number of your prepared <beasts> to one of your lands.",condition:()=>a.panelPieces[e.Beasts]>0,[yn.Now]:async()=>{await a.inLands().pickMultiple({optional:!0,amount:a.panelPieces[e.Beasts],forPickedItem:async t=>{await t.add(1,e.Beasts),await a.addPrepareBeast(-1)},together:!0})}}]})}})}})}}]},pv={name:"Violence",set:a.NatureIncarnate,effects:[{name:"Setup Changes",effects:[{text:"Lose Innate Power: Spirits May Yet Dream.",[yn.Now]:async({you:e})=>{await e.forgetPower(Mi.SpiritsMayYetDream)}},{text:"Gain 1 Energy.",[yn.Now]:async({you:e})=>{await e.gainEnergy(1)}},{text:"Replace Unique Power: 'Dreams of the Dahan' with 'Bats Scout For Raids By Darkness'.",[yn.Now]:async({you:e})=>{await e.replacePower(Mi.DreamsOfTheDahan,{withPower:Mi.BatsScoutForRaidsByDarkness})}}]},{name:"Nightmares of Violence and Death",effects:[{text:"Card Plays on your bottom <presence> track grant twice as many Plays during the Spirit Phase. These extra Card Plays can only be used for Power Cards with Damage or Destroy instructions.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Violence,[yn.ExtraCardPlaysForDamageAndDestroy]:({spirit:e})=>e===a})}}]}]},wv={name:"Warrior",set:a.NatureIncarnate,effects:[{name:"Setup Changes",effects:[{text:"Replace Innate Power: 'Lead The Furious Assault' with 'Lead The Warriors To Battle'.",[yn.Now]:async({you:e})=>{await e.replacePower(Mi.LeadTheFuriousAssault,{withPower:Mi.LeadTheWarriorsToBattle})}},{text:"Replace 1 of your <presence> with your Incarna (<incarna-warrior>) and 1 <dahan>.",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({[yn.AfterSetupPresence]:async()=>{await a.presence().pickOne((async t=>{const n=t.location;await t.remove(Nn.RemoveFromGame),await n.addIncarna(Bn.IncarnaWarrior,a),await n.add(1,e.Dahan)}),{noOptions:"No presence?"})}})}},{text:"Replace Unique Power: 'Manifestation Of Power And Glory' with 'Call To Bloodshed'.",[yn.Now]:async({you:e})=>{await e.replacePower(Mi.ManifestationOfPowerAndGlory,{withPower:Mi.CallToBloodshed})}}]},{name:"Warrior-Spirit's Raiding Party",effects:[{text:"When your Actions move <dahan> and they bring <incarna-warrior>, you may deal 1 Damage at <incarna-warrior> (max. 1 Damage per Action).",[yn.Now]:async({$:e})=>{await e.addSubEffect({effectId:wn.Warrior,[yn.AfterMoving]:async({piece:a,destination:t})=>{a.isA(e.Dahan)&&e.bringingWarriorThisInstruction&&!e.action.data.hasRaided&&await e.may({text:"Deal 1 Damage at <incarna-warrior>?"})&&(e.action.data.hasRaided=!0,await t.damage(1))}})}}]},{name:"Incarna",[yn.Now]:async({$:e,you:a})=>{await e.addSubEffect({effectId:wn.Warrior,text:"<incarna-warrior> may count as <presence>.",[yn.GlobalReminder]:()=>({icon:"<incarna-warrior> =<br><presence>",ongoing:!0,spirit:a,players:[a]})})}}]},yv={[zo.Amorphous]:Gm,[zo.DarkFire]:Km,[zo.Deeps]:Xm,[zo.Encircle]:Zm,[zo.Enticing]:ev,[zo.Foreboding]:Hm,[zo.Haven]:av,[zo.Immense]:jm,[zo.Intensify]:tv,[zo.Lair]:nv,[zo.Locus]:rv,[zo.Madness]:_m,[zo.Mentor]:iv,[zo.Might]:Um,[zo.Nourishing]:sv,[zo.Pandemonium]:Jm,[zo.Reach]:Vm,[zo.Regrowth]:ov,[zo.Resilience]:Ym,[zo.Sparking]:dv,[zo.SpreadingHostility]:cv,[zo.Stranded]:lv,[zo.Sunshine]:zm,[zo.Tactician]:hv,[zo.Tangles]:uv,[zo.Transforming]:gv,[zo.Travel]:qm,[zo.Unconstrained]:fv,[zo.Violence]:pv,[zo.Warrior]:wv,[zo.Wind]:Qm},mv=(e,a)=>(e=>Array.from(Array(e.length).keys()))(e).filter(((t,n)=>a(e[t],n))),vv=e=>1===Object.keys(e).filter((a=>0!==e[a])).length,Av=(e,a)=>{let t="";return Object.keys(Vy).filter((a=>void 0!==e[a]&&0!==e[a])).forEach((n=>{t+=`${e[n]} ${a?Vy[n].name:Vy[n].text} `})),t},Iv=(e,...a)=>{const t={...e};for(const e of a)for(const a of Object.keys(t))t[a]=Math.max(t[a]-(e[a]??0),0);return t};var xv=function(e,a,t,n){var r,i=arguments.length,s=i<3?a:null===n?n=Object.getOwnPropertyDescriptor(a,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,a,t,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(i<3?r(s):i>3?r(a,t,s):r(a,t))||s);return i>3&&s&&Object.defineProperty(a,t,s),s};class bv{data;absorbedPresence=[];aspect;cardsMadeImpendingThisTurn=[];cardsPlayedThisTurn=[];daysPowers=[];destinyPowers=[];destroyedIncarna=null;destroyedPresence=0;didNotWantToReachThreshold=[];disabledGrowthOptions=[];growthStatus=[];hasEmpoweredIncarna=!1;hasPlayedPowers=!1;hasReclaimedACardDuringSpiritPhase=!1;healingCards=[];healingMarkers=[];innateEnergy=0;landsIncludingNonExisting=[];panelPieces={[Bn.Explorer]:0,[Bn.Town]:0,[Bn.City]:0,[Bn.Beasts]:0};powers=[];powersInProgressionDeck=[];preparedElements=nd();rememberedUniques=[];score=0;spirit;spiritNumber;startingBoardIndex;time=0;trackElements=[];usedCardPlaysForNonDamageAndDestroy=0;$;trackStatusInternal=[];constructor({$:e,spiritNumber:a,spirit:t,aspect:n,boardIndex:r,progression:i=!1}){Xo.makeObservable(this),this.$=e,this.spiritNumber=a,this.spirit=t,this.aspect=n,this.startingBoardIndex=r,this.data=am[this.spirit],i&&this.data.progression&&this.data.progression.forEach((e=>{this.$.removePowerCardFromDecks(e),this.powersInProgressionDeck.push(e)}))}get availablePowersForPlay(){if(this.$.allSpiritsHavePlayedPowers)return[];let e;const a=this.cardPlaysCostToPlayPowerCard,t=this.cardPlays;if(this.hasExtraCardPlaysForDamageAndDestroy){const n=this.usedCardPlaysForNonDamageAndDestroy+a>t;e=this.usedCardPlays+a>2*t?this.powers.filter((e=>e.assisted&&e.isPlayable)):this.powers.filter((e=>e.isPlayable&&(!n||e.isCardWithDamageAndDestroy)))}else e=this.usedCardPlays+a>t?this.powers.filter((e=>e.assisted&&e.isPlayable)):this.powers.filter((e=>e.isPlayable));const n=e.map((e=>({power:e,spirit:this})));return this.hasPlayedPowers||n.push({power:void 0,spirit:this}),n}get availablePresenceForTargeting(){return this.presence().items.concat(this.extraPresenceAvailableForTargeting)}get availableRememberedUniques(){return this.rememberedUniques.filter((e=>0===this.$.spiritsWhich((a=>a.hasPower(e))).count))}get averageEnergyCost(){if(0===this.powers.length)return 0;let e=0;for(const a of this.powers)e+=a.costToPlay;return e/this.powers.length}get baseCardPlays(){let e=0,a=0;return this.data.tracks.forEach((({cardPlays:t,extraCardPlays:n},r)=>{this.trackStatus[r]!==yg.Covered&&(e=Math.max(e,t??0),a+=n??0)})),e+a}get canPlayCardsWithoutCost(){return this.$.someEffect(yn.CanPlayCardsWithoutCost,{spirit:this})}get cardPlays(){const e=this.$.adjustedCardPlays;return e>0?e:this.baseCardPlays+this.extraCardPlays+this.impendingCardPlays}get cardPlaysCostToPlayPowerCard(){return 1+this.$.sumEffects(yn.ExtraCardPlaysCost,{spirit:this})}get corners(){const e=new Set;for(const a of this.lands)for(const t of a.corners)e.add(t);return Array.from(e)}get elements(){return nd(this.elementsFromPowers,this.elementsFromTracks,this.elementsFromEffects)}get elementsFromCards(){return this.elementsWithStatus((()=>!0))}get elementsFromDiscard(){return this.elementsWithStatus((e=>e.isInDiscard))}get elementsFromEffects(){return nd(...this.$.effectsMappedWithFilter(yn.Elements,{spirit:this}))}get elementsFromHand(){return this.elementsWithStatus((e=>e.isInHand))}get elementsFromNonBlessedPowers(){return this.elementsWithStatus((e=>e.isInPlay),!1)}get elementsFromPowers(){return this.elementsWithStatus((e=>e.isInPlay))}get elementsFromTracks(){const e=nd();return this.trackStatus.forEach(((a,t)=>{if(a!==yg.Covered){const a=this.data.tracks[t].elements;if(a)for(const t of a)e[t]+=1;null!==this.trackElements[t]&&(e[this.trackElements[t]]+=1)}})),e}get energy(){return this.innateEnergy+(this.spirit===n.Ocean?Math.floor(this.healthWorthOfDrownedInvaders/this.$.spiritCount)-this.energyDebt:0)}get extraCardPlays(){return this.$.sumEffects(yn.ExtraCardPlays,{spirit:this})}get extraPresenceAvailableForTargeting(){const e=[];for(const a of this.$.effectsMappedWithFilter(yn.MayUseOtherSpiritPresenceForTargeting,{spirit:this}))e.push(...a);return e}get growthOptionEnergy(){const e=this.growthOptions.find((e=>e.status===Ly.Available&&e.effect.text?.startsWith("Gain")&&e.effect.text?.endsWith("Energy")));return e?Number.parseInt(e.effect.text[6],10):0}get growthOptionGroups(){const e=[...this.data.growthOptions];for(const a of this.$.effectsMappedWithFilter(yn.SpiritHasExtraGrowthOptions,{spirit:this}))e.push(a);return e}get growthOptions(){const e=[];let a=0;return this.growthOptionGroups.forEach((({cost:t,effects:n,requiresTrackSpot:r,requiresHealingCard:i})=>{n.forEach(((n,s)=>{e.push({effect:{...n,card:this.data.innatePowers[0]},spirit:this,option:a,subOption:s,index:e.length,cost:t,status:this.growthStatus[e.length],requiresTrackSpot:r,requiresHealingCard:i})})),a+=1})),e}get hasExtraCardPlaysForDamageAndDestroy(){return this.$.someEffect(yn.ExtraCardPlaysForDamageAndDestroy,{spirit:this})}get hasIncarna(){return null!=this.incarna}get hasReclaimableCards(){return this.powers.some((e=>e.isA(En.AnyCard)&&e.isInDiscard))}get healthWorthOfDrownedInvaders(){return this.panelPieces[Bn.Explorer]+2*this.panelPieces[Bn.Town]+3*this.panelPieces[Bn.City]}get impendingCardPlays(){let e=0;return this.data.tracks.forEach((({impendingCardPlays:a},t)=>{this.trackStatus[t]!==yg.Covered&&(e+=a??0)})),e}get impendingEnergy(){let e=0;return this.data.tracks.forEach((({impendingEnergy:a},t)=>{this.trackStatus[t]!==yg.Covered&&(e+=a??0)})),e}get incarna(){return this.pieces.find((e=>e.isIncarna&&e.owner===this))??null}get innatePowers(){return this.powers.filter((e=>e.data.type===Sn.Innate))}get lands(){return this.landsIncludingNonExisting.filter((e=>e.exists))}get mayShift(){return this.$.someEffect(yn.MayShift,{spirit:this})}get mayUsePreparedElementsToEnhanceActions(){return this.$.hasEffectNamed("Insights into the World's Nature")}get name(){return this.data.name}get nameLink(){return`<spirit-${this.spirit.toLowerCase()}>`}get nonBlessedPowerCards(){return this.powers.filter((e=>e.isA(En.AnyCard)&&!e.isBlessed&&!e.assisted))}get nonInnatePowers(){return this.powers.filter((e=>e.data.type!==Sn.Innate))}get numberOfHealingAnimalMarkers(){return this.healingMarkers.filter((e=>e===nr.Animal)).length}get numberOfHealingMarkers(){return this.healingMarkers.length}get numberOfHealingWaterMarkers(){return this.healingMarkers.filter((e=>e===nr.Water)).length}get numberOfImpendingCards(){return this.powers.filter((e=>e.isImpending)).length}get numberOfPowerCards(){return this.nonBlessedPowerCards.length}get numberOfPowerCardsInHand(){return this.nonBlessedPowerCards.filter((e=>e.isInHand)).length}get numberOfPowerCardsInPlay(){return this.powerCardsInPlay.length}get numberOfPreparedElements(){return dg(Object.values(this.preparedElements))}get numberOfPresenceInLands(){return this.presence().count}get numberOfPresenceInTracks(){return Jo(this.trackStatus,(e=>e===yg.Covered))}get numberOfSacredSites(){return this.inSacredSites().count}get pickOptions(){const e=[...this.data.pickOptions.map((e=>[...e]))];return this.$.firstEffectOfType(yn.SpiritHasExtraGrowthOptions,{spirit:this})&&e.forEach((e=>{e.push(e[e.length-1]+1)})),e}get pieces(){const e=[];for(const a of this.lands)e.push(...a.pieces);return e}get powerCardsInPlay(){return this.powers.filter((e=>e.isA(En.AnyCard)&&e.isInPlay))}get powerCardsInPlayNotBlessed(){return this.powers.filter((e=>e.isA(En.AnyCard)&&e.isInPlay&&!e.isBlessed&&!e.assisted))}get preparedElementsForGainingElements(){return this.mayUsePreparedElementsToEnhanceActions?this.preparedElements:nd()}get presenceMayCountAsBadlandsOrBeasts(){return this.$.someEffect(yn.PresenceCountsAsBadlandsOrBeasts,{spirit:this})}get preventAddAnyPresence(){return this.$.someEffect(yn.PreventAddAnyPresence,{spirit:this})}get primaryElements(){const e=nd();for(const a of this.data.uniquePowers)for(const t of sg[a].elements)e[t]+=1;return Object.keys(e).sort(((a,t)=>e[t]-e[a])).slice(0,3)}get serialized(){return this.spirit}get startingBoard(){return this.$.boards[this.startingBoardIndex]}get trackActions(){return this.data.tracks.map((({effect:e,effectRequires:a},t)=>({effect:e,effectRequires:a,trackIndex:t,spirit:this,status:this.trackStatus[t]}))).filter((({effect:e,effectRequires:a})=>void 0!==e&&(void 0===a||a({you:this,$:this.$}))))}get trackEnergy(){let e=0,a=0;return this.data.tracks.forEach((({energy:t,extraEnergy:n},r)=>{this.trackStatus[r]!==yg.Covered&&(e=Math.max(e,t??0),a+=n??0)})),e+a}get trackStatus(){return this.trackStatusInternal}get unlockedTrackPresence(){return mv(this.data.tracks,((e,a)=>this.trackStatus[a]===yg.Covered&&(void 0===e.requires||this.trackStatus[e.requires]!==yg.Covered)&&(void 0===e.requiresAll||!e.requiresAll.some((e=>this.trackStatus[e]===yg.Covered)))&&(void 0===e.requiresAny||e.requiresAny.some((e=>this.trackStatus[e]!==yg.Covered)))))}get usedCardPlays(){return this.cardsPlayedThisTurn.length*this.cardPlaysCostToPlayPowerCard}get validTrackSpotsToReturnPresence(){return mv(this.data.tracks,((e,a)=>this.trackStatus[a]!==yg.Covered&&(this.data.tracks[a].covered||void 0!==this.data.tracks[a].requires||void 0!==this.data.tracks[a].requiresAll||void 0!==this.data.tracks[a].requiresAny)&&this.trackPlacementIsValidGivenIndexIsCovered(a)))}static createCollection(e,a){return new Yo(e,pn.SelectSpirit,a)}async absorb(e){this.absorbedPresence.push(e.spiritNumber),await this.$.sendEvent({type:fn.AbsorbedPresence,spirit:this,targetSpirit:e})}addExtraAction(e){const{actionId:a,icon:t,enabled:n=(()=>!0),visible:r=(()=>!0),maxUses:i=(()=>1),text:s=this.$.currentStackEffect?.text,name:o=this.$.currentStackEffect?.name,onActivate:d,unlimited:c=!1,power:l,previewPowers:h,required:u=!1,scenario:g,effectId:f}=e,p=Re.box(0);return this.$.addSubEffect({name:o,text:s,effectId:f,[yn.GlobalReminder]:()=>({icon:c||u?t:`${t}<br>${p.get()} / ${i()}`,ongoing:!0,unlimited:c,spirit:c||u?void 0:this,players:[this],visible:r(),scenario:g,power:l,previewPowers:h}),[yn.ExtraAction]:()=>c||!(p.get()>=i())&&n()?{actionId:a,players:[this],spirit:this,required:u,name:o,text:s,[yn.Now]:async e=>{p.set(p.get()+1),await d(e)}}:null,[yn.TimePasses]:()=>(p.set(0),Promise.resolve())})}async addExtraTrackElement(e){null===this.trackElements[e]&&await this.$.chooseBetween({prompt:"Select Element.",effects:[...Sd].map((a=>({actionId:a,text:`${Vy[a].text}`,[yn.Now]:()=>(this.trackElements[e]=a,Promise.resolve())})))})}async addIncarna(e,a=(()=>!0)){const t=[];return await this.inLandsWhere(a).pickOne((async a=>{t.push(await a.putIncarna(e,this))}),{players:[this],prompt:"Pick a land to add Incarna."}),t}addLand(e){this.landsIncludingNonExisting.includes(e)||e.isEndlessDark||this.landsIncludingNonExisting.push(e)}async addOrMoveIncarnaToLandWithPresence(e){this.hasIncarna?await(this.incarna?.location.move({pieces:Qn.Incarna,owner:this,destinationFilter:e=>e.hasPresenceOf(this),locations:{target:Jn.AnyLands}})):await this.addIncarna(e)}addPrepareBeast(e){return this.panelPieces[this.$.Beasts]+=e,Promise.resolve()}async addPresence(e={}){const{range:a=0,locations:t=Jn.ToOneOfYourLands,filter:n=(()=>!0),destroyed:r=!1,together:i=!1,ignoreLandType:s=!1,forcedFromTrack:o=!1,amount:d=1,autoPlayOneOption:c=!1}=e,l=t===Jn.Remove||t===Jn.RemoveFromGame||t===Jn.Time,h=[];for(;h.length<d;){let u;const g=!l&&this.preventAddAnyPresence,f=h.length,p=this.unlockedTrackPresence;let w,y;if(r){if(0===this.destroyedPresence){await this.$.clickToContinue({text:"No <broken> to add."});break}}else{let e=null;if(p.length>0&&(o?e=await this.$.query({query:pn.SelectTrack,prompt:"Select <presence> from tracks",players:[this],items:p,actionIds:p.map((e=>`Track-${this.spirit}-${e}`))}):g||(e=await this.$.queryOptional({query:pn.SelectTrack,prompt:"Select <presence> from tracks",cancel:l?"Remove <presence> from island":"Reposition <presence>",players:[this],items:p,actionIds:p.map((e=>`Track-${this.spirit}-${e}`))}))),null!==e)u=p[e];else{let e="Select which <presence> to relocate.";g?e=`No more <presence> may be added to the island.<br>${e}`:l&&(e="Select which <presence> to remove."),await this.presence().pickOne((e=>(w=e,Promise.resolve())),{players:[this],prompt:e})}}switch(t){case Jn.RemoveFromGame:void 0!==w&&await w.remove(Nn.RemoveFromGame);break;case Jn.Remove:void 0!==w&&await w.remove(Nn.Remove),this.destroyedPresence+=1;break;case Jn.Time:if(this.time+=1,void 0!==w&&await w.remove(Nn.Silent),d>1)return void 0!==u&&await this.removePresenceFromTrack(u),this.addPresence({...e,amount:d-1});break;case Jn.ToAnyOcean:y=this.$.inOceans().where(n);break;case Jn.WithinRange:y=this.inLandsWithinRange(a,n);break;case Jn.ToOneOfYourLands:y=this.inLandsWhere(void 0!==n?n:()=>!0);break;case Jn.AnyLands:y=this.$.inLandsWhere(void 0!==n?n:()=>!0)}if(void 0!==y&&await y.where((e=>!this.preventAddPresence(e,s)&&(!i||0===h.length||h.some((a=>a.location===e))))).autoPickOne((async e=>{void 0!==w&&await w.remove(Nn.Relocate);let a=1;r&&this.destroyedPresence>0&&await this.$.oneEffectActivates(yn.AddTwoExtraBroken,{spirit:this,land:e})&&(a=Math.min(this.destroyedPresence,3)),h.push(...await e.createPiece(a,w?.piece??Bn.Presence,this.spiritNumber)),r&&(this.destroyedPresence-=a)}),{players:[this],autoPlayOneOption:c}),void 0!==u&&await this.removePresenceFromTrack(u),h.length===f)break}return h}addPresenceInAnyOcean(){return this.addPresence({locations:Jn.ToAnyOcean})}addPresenceInRange(e,a){return this.addPresence({locations:Jn.WithinRange,range:e,...a})}async andAnotherSpirit(e,a){for(const t of[0,1]){const n=[this,e][t];await this.$.addSubEffect({text:a.text?.(0===t),players:[n],[yn.Now]:()=>a.now(n,0===t)})}}async askToConvertElements(e,a={}){const t=this.elementsTreatedAsElements(e);if(this.$.action.power?.assisted)return dg(Object.values(t))<=10;const{optionalUpgrade:n=!0,optionalThreshold:r=!0}=a;if(this.hasElements(t))return!(r&&!this.$.currentActionHasAllThresholds)||this.$.may({prompt:"Resolve threshold?"});if(this.hasElementsWithConvert(t)){const a=Iv(t,this.elements);if(!n||await this.$.may({prompt:`Convert Elements to reach threshold:<br>${Av(t)}?`})){for(;dg(Object.values(a))>0;){const e=Object.keys(a).filter((e=>(a[e]??0)>0))[0],t=[];this.preparedElementsForGainingElements[e]>0&&t.push({actionId:`Prepared${e}`,text:`Use prepared ${Vy[e].text}`,[yn.Now]:async()=>{this.preparedElements[e]-=1,await this.$.sendEvent({text:`${this.nameLink} spent 1 ${Vy[e].text}.`,type:fn.GenericSub}),await this.gainElementsUntilEndOfAction({[e]:1})},condition:()=>this.preparedElementsForGainingElements[e]>0});const n=[nr.SunOrMoon,nr.WaterOrAnimal,nr.FireOrPlant].find((a=>Vy[a].elements.includes(e)));void 0!==n&&1===this.elements[n]&&t.push({actionId:`Dual${n}`,text:void 0!==`Use ${n}`?Vy[n].text:0,[yn.Now]:async()=>{await this.$.sendEvent({text:`${this.nameLink} converted ${Vy[n].text} to ${Vy[e].text}.`,type:fn.GenericSub}),await this.gainElementsUntilEndOfTurn({[e]:1,[n]:-1},{subEffect:!1})}}),this.elements[nr.Any]>0&&t.push({actionId:"Any",text:"Use <any>.",[yn.Now]:async()=>{await this.$.sendEvent({text:`${this.nameLink} converted <any> to ${Vy[e].text}.`,type:fn.GenericSub}),await this.gainElementsUntilEndOfTurn({[e]:1,[nr.Any]:-1},{subEffect:!1})},condition:()=>this.elements[nr.Any]>0}),await this.$.chooseBetween({text:`How to convert to ${Vy[e].text}?`,autoPlayOneOption:!1,effects:t},{orChoice:!1}),a[e]-=1}return this.$.action.data.upgraded=!0,!0}return this.didNotWantToReachThreshold.push(e),!1}return!1}async askToConvertElementsToCombo(e){const a=this.elementsTreatedAsElements(e),t=this.numberOfElementCombos(a);let n=nd();for(let e=0;e<t+1;e+=1)n=nd(n,a);for(;this.hasElementsWithConvert(n)&&await this.askToConvertElements(n,{optionalThreshold:!1});)n=nd(n,a)}boardDistanceToSpirit(e){let a=null;for(const t of this.boards(this.extraPresenceAvailableForTargeting))for(const n of e.boards(e.extraPresenceAvailableForTargeting))if(null!==t.boardDistance[n.boardIndex]&&(a=null===a?t.boardDistance[n.boardIndex]:Math.min(a,t.boardDistance[n.boardIndex]),0===a))return 0;return a}boards(e=[]){return this.$.boards.filter((a=>a.existingLocations.some((a=>a.hasPresenceOf(this,e)))))}canAffordGrowthOption(e){return(void 0===e.requiresTrackSpot||this.trackStatus[e.requiresTrackSpot]!==yg.Covered)&&(void 0===e.requiresHealingCard||this.healingCards.length>0)&&(void 0===e.cost||this.energy>=e.cost||this.hasPaidForGrowthOption(e))&&!this.disabledGrowthOptions.includes(e.option)}convertElements(e){return this.askToConvertElements(e,{optionalUpgrade:!1,optionalThreshold:!1})}async destroyPresence(e,a=Nn.DirectDestroy,t=!1){const n=[];return await this.presence().pickMultiple({amount:e,forPickedItem:async e=>{n.push(...await e.remove(a))},repeatSame:!0,optional:t,effect:{prompt:"Pick presence."}}),n}async discardAllPowerCards(){await this.powersWhere((e=>e.isA(En.AnyCard)&&e.isInHand)).forEach((async e=>{await e.discard()}))}async discardElements(e,{optional:a}={optional:!1}){const t={};for(let n=0;n<e;n+=1){const r=[...Sd].map((e=>({actionId:e,text:`${Vy[e].text}`,condition:()=>this.preparedElements[e]>0,[yn.Now]:()=>(t[e]=(t[e]??0)+1,this.preparedElements[e]-=1,Promise.resolve())})));a&&r.push({actionId:"SkipDiscard",text:"Skip",[yn.Now]:()=>(n=e,Promise.resolve())}),await this.$.chooseBetween({prompt:`Select Element to discard. (${e-n} left.)`,effects:r,autoPlayOneOption:!0})}return Promise.resolve(t)}async discardPowerCards(e,a){const t=this.powersWhere((e=>e.isA(En.AnyCard)&&e.status===Fd.InHand&&(void 0===a||a(e))));await t.pickMultiple({amount:e,forPickedItem:async e=>{await e.discard()},effect:{prompt:"Pick a Power Card to discard."}})}doPowerAction(e,a){return this.$.doPowerAction(this,e,a)}doSpiritAction(e){return this.$.doSpiritAction(e,{spirit:this})}async doTrackAction(e){const a=this.data.tracks[e];await this.doSpiritAction((()=>this.$.addEffect({name:a.name,spirit:this,...a.effect}))),this.setTrackStatusForIndex(yg.UncoveredPlayed,e)}elementTreatedAsElement(e){if(this.mayTreatElementsAsOther){const a=this.$.resultFromFirstEffectOfType(yn.TreatElementAsElement,{spirit:this,element:e});if(void 0!==a)return a}return e}elementsTreatedAsElements(e){if(this.mayTreatElementsAsOther){const a=this.$.resultFromFirstEffectOfType(yn.TreatElementsAsElements,{spirit:this,elements:e});if(void 0!==a)return a}return e}elementsWithStatus(e,a=!0){const t=nd();return this.powers.forEach((n=>{!n.data.elements||n.assisted||!e(n)||!a&&n.isBlessed||n.data.elements.forEach((e=>{t[e]=(t[e]??0)+1}))})),nd(this.elementsTreatedAsElements(t))}empowerIncarna(){return this.hasEmpoweredIncarna=!0,Promise.resolve()}async escapePieces(e){const a=Math.min(e??this.$.theEndlessDark.pieces.length,this.$.theEndlessDark.pieces.length),t=await this.$.theEndlessDark.move({amount:a,destinationFilter:e=>e.isLand&&!e.isOcean&&e.hasPresenceOf(this),locations:{target:Jn.AnyLands},pickPiecesEffect:{prompt:"Pick Piece to Escape."},pickDestinationEffect:{prompt:"Pick Land to Escape to."}});return t.length!==a&&this.$.loseGame(Ew.TheEndlessDark),t}extraRange(e){let a=0;return this.data.tracks.forEach((({extraRange:e},t)=>{this.trackStatus[t]!==yg.Covered&&(a+=e??0)})),a+=this.$.sumEffects(yn.ExtraRange,{spirit:this,location:e}),a}forPieces(){return ed.createCollection(this.$,this.pieces)}forPiecesThatIs(e){return this.forPieces().where((a=>a.isA(e)))}forPiecesWhere(e){return this.forPieces().where(e)}async forgetPower(e,a={}){const t=this.powers.find((a=>a.power===e));void 0!==t&&await this.forgetPowerState(t,a)}async forgetPowerState(e,a={}){const{canRegain:t=!0,silent:n=!1,duringPowerGain:r=!1}=a;if(e.owner!==this||!n&&await this.$.oneEffectActivates(yn.PreventForgetPowercard,{power:e,duringPowerGain:r}))return null;const i=qr(this.powers,(a=>a.power===e.power));return this.invalidatePowerElementCache(),i&&(i.isA(En.Unique)?t&&(this.rememberedUniques.includes(i.power)||this.rememberedUniques.push(i.power)):await this.$.discardPowerToDeckDiscard(i.power),n||await this.$.sendEvent({type:fn.PowerCardForgotten,spirit:this,power:i})),i}async forgetPowers(e={}){const{amount:a=1,powerFilter:t=En.AnyCard,filter:n=(()=>!0),optional:r=!1,duringPowerGain:i=!1}=e,s=[],o=this.powersWhere((e=>e.isA(t)&&!e.isBlessed&&!e.assisted&&n(e)));return await o.pickMultiple({amount:a,forPickedItem:async e=>{const a=await this.forgetPowerState(e,{duringPowerGain:i});a&&s.push(a)},optional:r,effect:{players:[this],prompt:`Pick ${kd[t].text} to forget.`}}),s}async gainCardPlays(e){await this.$.addSubEffectUntilEndOfTurn({[yn.ExtraCardPlays]:({spirit:a})=>a===this?e:0})}gainDamageBoost(e){return this.$.gainDamageBoost({...e,spirit:this})}async gainElements(e={}){const{elements:a=[...Sd],amount:t=1,forTheRestOfTheGame:n=!1,different:r=!1,same:i=!1,possiblyWithConvert:s=!1,anyAmount:o=!1}=e,d={},c={close:!1};for(;dg(Object.values(d))<t&&!o||o&&!c.close;){const e=a.filter((e=>!1===r||!d[e])).map((e=>({actionId:e,text:`${Vy[e].text}`,[yn.Now]:async()=>{const a=i?t:1;s&&!o&&await this.askToConvertElements({[e]:a},{optionalUpgrade:!1}),d[e]||(d[e]=0),d[e]+=a}})));if(o&&e.push({actionId:"Close",text:"Close",[yn.Now]:()=>(c.close=!0,Promise.resolve())}),await this.$.chooseBetween({prompt:`Choose Element:<br>${Av(d)}`,autoPlayOneOption:!0,effects:e}),0===e.length)break}return Object.keys(d).length>0&&(n?n&&await this.gainElementsForTheRestOfTheGame(d):await this.gainElementsUntilEndOfTurn(d)),d}async gainElementsForTheRestOfTheGame(e){const a=this.elementsTreatedAsElements(e);await this.$.addSubEffect({[yn.GlobalReminder]:()=>({text:`Extra elements:<br>${Av(a)}<br><br>(permanent)`,icon:vv(a)?Av(a):"Extra<br>Elements",ongoing:!0,spirit:this,players:[this]}),[yn.Elements]:({spirit:e})=>e===this?a:{}}),bm(this,"elementsFromEffects","elements")}async gainElementsUntilEndOfAction(e,a){const t=this.elementsTreatedAsElements(e);await this.$.addEffectUntilEndOfAction({effectId:a?wn.Downgrade:void 0,name:a?"Downgrade":void 0,[yn.GlobalReminder]:()=>({text:`${a?"Lose":"Extra"} elements:<br>${Av(t)}<br><br>(until end of action)`,icon:vv(t)?Av(t):(a?"Lose":"Extra")+"<br>Elements",spirit:this,players:[this]}),[yn.Elements]:({spirit:e})=>e===this?t:{}}),bm(this,"elementsFromEffects","elements")}async gainElementsUntilEndOfTurn(e,a={}){const{subEffect:t=!0}=a,n=this.elementsTreatedAsElements(e);await this.$.sendEvent({type:fn.GenericSub,text:`${this.nameLink} gained ${Av(n)}.`});const r={[yn.GlobalReminder]:()=>({text:`Extra elements:<br>${Av(n)}<br><br>(until end of turn)`,icon:vv(n)?Av(n):"Extra<br>Elements",spirit:this,players:[this]}),[yn.Elements]:({spirit:e})=>e===this?n:{}};t?await this.$.addSubEffectUntilEndOfTurn(r):await this.$.addEffectUntilEndOfTurn(r),bm(this,"elementsFromEffects","elements")}async gainEnergy(e){for(;e>0&&await this.$.oneEffectActivates(yn.PreventGainEnergy,{spirit:this});)e-=1;const a={amount:e,spirit:this};return e>0&&(await this.$.waitForAnimationsToFinish(),this.innateEnergy+=e,await this.$.sendEvent({type:fn.EnergyGained,spirit:this,amount:e})),a}gainEnergyFromTracks(){return this.gainEnergy(this.trackEnergy)}gainHealingMarker(e){return this.healingMarkers.push(e),Promise.resolve()}async gainMakeFastBuff(e={}){const{amount:a=1,filter:t=(()=>!0),alsoMakeSlow:n=!1}=e,r=Re.box(0);await this.$.addSubEffectUntilEndOfTurn({[yn.GlobalReminder]:()=>({icon:`<fast><br>${r.get()} / ${a}`,spirit:this,players:[this]}),[yn.MayChangeSpeedOfPower]:({power:e})=>(e.isSlow||n)&&t(e)&&this===e.owner&&r.get()<a,[yn.ChangeSpeedOfPower]:async({power:e})=>{e.data.speed===rr.Slow?await e.makeFast():await e.makeSlow(),r.set(r.get()+1),r.get()===a&&this.$.removeThisEffect()}})}async gainPower(e,a={}){await this.$.removePowerCardFromDecks(e);const{silent:t=!1,index:n,assisted:r}=a,i=new $d(this.$,e,Fd.InHand);return r&&(i.assisted=!0),void 0!==n?this.powers.splice(n,0,i):this.powers.push(i),t||await this.$.sendEvent({type:fn.PowerCardGained,spirit:this,power:i}),i}async gainPowerCard(e={}){const{powerType:a,withoutForgetting:t=!1,forgetOptional:n=!1,gifted:r=!1,taken:i=!1}=e;let{fromSelection:s,discardAfter:o=!0}=e,d=null;const c={chosen:[],notChosen:[],forgotten:[],gifted:r,taken:i};let l=1;l=!(void 0===e.drawAmount||e.drawAmount>1)||i||r?e.drawAmount??4:Math.max((e.drawAmount??4)+this.extraCardDrawAmount,2);const h=(e.keepAmount??1)+this.extraCardKeepAmount;if(!r&&!i&&!s){const e=this.$.resultFromFirstEffectOfType(yn.AdjustGainingPowers,{spirit:this,powerType:a});e&&(s=e,o=!1)}const u=void 0===s&&4===l&&1===h&&this.powersInProgressionDeck.length>0;if(s)c.notChosen=[...s];else if(!u){const e=void 0!==a?[a]:[Sn.Minor,Sn.Major],t=e[await this.$.query({query:pn.SelectPowerType,items:e,actionIds:e,autoPlayOneOption:!0})];await _r(l,(async()=>{const e=await this.$.drawPower(t);e&&c.notChosen.push(e)}))}for(let e=0;e<h;e+=1){if(u)void 0===a?d=this.powersInProgressionDeck.shift()??null:(d=this.powersInProgressionDeck.find((e=>sg[e].type===a))??null,null!==d&&qr(this.powersInProgressionDeck,d));else if(c.notChosen.length>0){if(this.$.phase===Wi.Grow&&4===l)return await this.gainPowerCardBuffs(c.notChosen.reverse(),{discardAfter:o,withoutForgetting:t,forgetOptional:n}),c;if(d=c.notChosen[await this.$.query({query:pn.SelectPowerToGain,items:c.notChosen,actionIds:c.notChosen,players:[this]})],qr(c.notChosen,d),o)for(const e of c.notChosen)await this.$.discardPowerToDeckDiscard(e)}if(null!=d){const a=await this.gainPower(d);sg[d].type!==Sn.Major||t||e!==h-1||await this.$.addSubEffect({text:"After you gain a Major Power, you must Forget one of your Power Cards.",[yn.Now]:async()=>{const e=await this.forgetPowers({optional:n,duringPowerGain:!0});c.forgotten.push(...e)}}),c.chosen.push(a)}}return await this.$.doEffects(yn.AfterGainingPowers,{spirit:this,powerGain:c}),c}async gainTime(e){await this.addPresence({amount:e,locations:Jn.Time})}async gainTimeUpTo(e){await this.$.chooseBetween({text:"Gain how much Time?",effects:[...Array(e+1).keys()].map((e=>({actionId:`Gain${e}Time`,text:`Gain ${e} Time.`,label:`${e}`,[yn.Now]:async()=>{await this.addPresence({amount:e,locations:Jn.Time})}})))})}async givePower(e){const a=e.owner;qr(a.powers,e),!a.rememberedUniques.includes(e.power)&&e.isA(En.Unique)&&a.rememberedUniques.push(e.power),this.powers.push(e),await this.$.sendEvent({type:fn.PowerCardGiven,source:a,destination:this,power:e})}async grow(e){const a=this.growthOptions[e];if(a.cost&&!this.hasPaidForGrowthOption(a)&&await this.payEnergy(a.cost),this.growthStatus[e]=Ly.Chosen,bm(this,"growthOptions"),await this.$.sendEvent({type:fn.Grow,spirit:this,option:a.option,subOption:a.subOption,text:a.effect.text}),await this.$.doSpiritAction((()=>this.$.addEffect({name:`Growth ${a.option+1}`,spirit:this,players:[this],...a.effect})),{spirit:this}),void 0!==this.unfinishedGrowthOption)this.growthOptions.forEach((({option:e,status:t},n)=>{e!==a.option&&t===Ly.Available&&(this.growthStatus[n]=Ly.NotChosen)}));else{this.growthOptions.forEach((({option:e,status:a},t)=>{if(a===Ly.NotChosen||a===Ly.Available){const a=this.pickOptions.filter((a=>a.includes(e)));if(a.length>0){a[0].filter((e=>this.chosenGrowthOption[e])).length<a.length?this.growthStatus[t]=Ly.Available:this.growthStatus[t]=Ly.NotChosen}}}));this.growthOptionGroups[a.option].oncePerGame&&this.growthOptions.filter((e=>e.option===a.option)).forEach((e=>{this.growthStatus[e.index]=Ly.Unavailable}))}bm(this,"growthOptions")}hasAtLeastNonBlessed(e,a){return Jo(this.powers,(e=>e.isA(a)&&!e.isBlessed&&!e.assisted))>=e}hasElements(e,a=!1){if(this.$.currentActionHasAllThresholds)return!0;const t=this.elementsTreatedAsElements(e);if(this.$.action.power?.assisted)return dg(Object.values(t))<=10;if(a)return this.hasElementsWithConvert(t);const n=this.elements;return!Object.keys(t).some((e=>n[e]<t[e]))}hasElementsWithConvert(e,a){const t=this.elements,n=this.elementsTreatedAsElements(e),r=void 0!==a?this.elementsTreatedAsElements(a):void 0,i=Iv(n,t,this.preparedElementsForGainingElements,r??{});for(const e of[nr.SunOrMoon,nr.WaterOrAnimal,nr.FireOrPlant])1===t[e]&&Vy[e].elements.some((e=>(i[e]??0)>0&&(i[e]-=1,!0)));return dg(Object.values(i))<=t[nr.Any]}hasPaidForGrowthOption(e){return this.growthOptions.some((a=>a.option===e.option&&a.status===Ly.Chosen))}hasPieceInLands(e){return this.pieces.some((a=>a.isA(e)))}hasPower(e){return this.powers.some((a=>a.power===e))}hasUncovered(e){return this.trackStatus[e]!==yg.Covered}inCorners(){return Im.createCollection(this.$,this.corners)}inCornersWhere(e){return this.inCorners().where(e)}inLands(){return id.createCollection(this.$,this.lands)}inLandsWhere(e){return this.inLands().where(e)}inLandsWith(e){return this.inLands().where((a=>a.has(e)))}inLandsWithAllOf(...e){return this.inLands().where((a=>a.hasAllOf(...e)))}inLandsWithinRange(e,a){const t=new Set;return this.lands.forEach((n=>{n.landsWithin(e,this).forEach((e=>{(void 0===a||a(e))&&t.add(e)}))})),id.createCollection(this.$,Array.from(t))}inSacredSites(){return this.inLandsWhere((e=>e.hasSacredSiteOf(this)))}invalidateEffectElementCache(){bm(this,"elementsFromEffects","elements")}invalidatePowerElementCache(){bm(this,"elementsFromPowers","elements")}async loseEnergy(e){const a=Math.min(this.innateEnergy,e);a>0&&(this.innateEnergy-=a,await this.$.sendEvent({type:fn.EnergyLost,spirit:this,amount:a}))}maxElementsWithConvert(e){const a=this.elements;return a[e]+this.preparedElementsForGainingElements[e]+[nr.SunOrMoon,nr.WaterOrAnimal,nr.FireOrPlant].filter((t=>1===a[t]&&Vy[t].elements.some((a=>a===e)))).length+a[nr.Any]}async mayReclaimPowerCardInsteadOfDiscarding(e){await this.$.addSubEffectUntilEndOfTurn({[yn.GlobalReminder]:()=>({power:e.power,players:[this]}),[yn.AtTimePassesBegin]:()=>this.powersWhere((e=>e.isA(En.AnyCard)&&e.isInPlay&&!e.isBlessed)).optionallyPickOne((e=>e.reclaim()),{noOptions:`${this.nameLink} has no Powers in play.`,card:e.power,players:[this]})})}async movePresence(e){const a=[];return await this.presence().pickOne((async t=>{a.push(...await t.move({amount:1,pieces:this.$.Presence,owner:this,locations:{target:Jn.WithinRange,range:e,spirit:this}}))}),{prompt:"Pick <presence> to move."}),a}numberOfAbsorbedPresenceOf(e){return this.absorbedPresence.filter((a=>a===e.spiritNumber)).length}numberOfElementCombos(e){const a=this.elementsTreatedAsElements(e),t=Object.keys(a),n={...this.elements};let r=0;for(;!t.some((e=>n[e]<a[e]));)r+=1,t.forEach((e=>{n[e]-=a[e]}));return r}numberOfPiecesInLands(e){return this.pieces.filter((a=>a.isA(e))).length}async payEnergy(e){if(e>0){if(await this.$.doEffects(yn.BeforePayEnergy,{spirit:this,amount:e}),this.innateEnergy<e)throw new Error("Not enough energy to pay for amount.");this.innateEnergy-=e,await this.$.sendEvent({type:fn.EnergyLost,spirit:this,amount:e})}}async playAPowerCardByPayingItsCost(e=(()=>!0)){await this.powersWhere((a=>e(a)&&a.isPlayable)).optionallyPickOne((async e=>{await e.play({withoutUsingCardPlays:!0})}),{players:[this],noOptions:`${this.nameLink} has no Power Cards in hand that can be played.`})}async playInnates(){for(const e of this.innatePowers)await e.play()}async possiblyDowngradeElements(e){const a=e.status===Fd.PlayedFast?rr.Fast:rr.Slow,t=e.data,n=new Set;for(const e of t.effects)if(void 0!==e.threshold&&!e.noConvertToThreshold&&this.hasElementsWithConvert(e.threshold))for(const a of Object.keys(e.threshold))n.add(a);const r=Array.from(n),i={skip:!1},s={};for(;!i.skip&&(t.mayAlwaysDowngrade||t.effects.filter((e=>void 0!==e.threshold&&!e.noConvertToThreshold&&this.hasElementsWithConvert(e.threshold))).length>1)&&r.some((e=>this.elements[e]>0));){const n=r.filter((e=>this.elements[e]>0)).map((e=>({actionId:e,text:`${Vy[e].text}`,[yn.Now]:async()=>{this.$.removeEffectsWithName(wn.Downgrade),s[e]=(s[e]??0)-1,await this.gainElementsUntilEndOfAction(s,!0)},condition:()=>t.effects.filter((a=>{if(void 0===a.threshold||a.dontResolveAlone)return!1;const t={...a.threshold,[e]:(a.threshold[e]??0)+1};return this.hasElementsWithConvert(t)})).length>0&&!t.mayBeSpeed?.noDowngrade?.({speed:a,element:e,spirit:this})})));n.push({actionId:"SkipDowngrade",text:"Continue",[yn.Now]:()=>(i.skip=!0,Promise.resolve()),condition:()=>!0});const o={};r.forEach((e=>{o[e]=this.elements[e]})),await this.$.chooseBetween({text:`Resolve Power as if you had fewer elements?<br><br>${Av(o)}`,prompt:"Choose element to downgrade<or>Continue:",name:t.name,card:e.power,effects:n,autoPlayOneOption:!0,highlightPowers:[e],players:[this]})}}powersWhere(e){return $d.createCollection(this.$,this.powers.filter(e))}async prepareElement(e=[...Sd]){await this.$.chooseBetween({prompt:"Select Element to Prepare.",effects:e.map((e=>({actionId:e,text:`${Vy[e].text}`,[yn.Now]:()=>(this.preparedElements[e]+=1,Promise.resolve())})))})}presence(){return this.forPiecesWhere((e=>e.isPresence&&e.owner===this))}preventAddPresence(e,a){return this.$.someEffect(yn.PreventAddPresence,{spirit:this,location:e,ignoreLandType:a})}reclaim(e){return this.reclaimCards({amount:e})}async reclaimCards(e={}){const{amount:a,filter:t=(e=>e.isInDiscard),optional:n=!1}=e,r=this.powersWhere((e=>e.isA(En.AnyCard)&&t(e)&&!e.isBlessed)),i=[];return await r.pickMultiple({amount:a??r.count,forPickedItem:async e=>{i.push(e),await e.reclaim()},optional:n,autoplayIfPickingAll:!n,effect:{autoPlayOneOption:!0,prompt:"Pick a Power Card to Reclaim."}}),i}removeLand(e){qr(this.landsIncludingNonExisting,e)}async removePresenceFromTrack(e){this.setTrackStatusForIndex(yg.Uncovered,e),await this.$.sendEvent({type:fn.TrackUncovered,spirit:this,trackSpot:this.data.tracks[e]}),void 0!==this.data.tracks[e].uncoverEffect&&await this.$.addEffect({spirit:this,...this.data.tracks[e].uncoverEffect}),await this.$.doEffects(yn.AfterUncoveringTrack,{spirit:this,trackIndex:e})}async replacePower(e,a){const t=this.powers.findIndex((a=>a.power===e));t>=0&&await this.forgetPowerState(this.powers[t],{canRegain:!1,silent:!0}),await this.gainPower(a.withPower,{silent:!0,index:t})}resolvableCardsWithSpeed(e,a=!1){return e===rr.Slow&&this.$.preventSlowPowers?[]:this.powers.filter((t=>{if(void 0!==t.data.mayUse&&!t.data.mayUse({$:this.$,power:t,spirit:this}))return!1;let n=t.status===(e===rr.Fast?Fd.PlayedFast:Fd.PlayedSlow),r=t.status===(e===rr.Fast?Fd.PlayedSlow:Fd.PlayedFast);return a&&(n=e===rr.Fast?t.isFast:t.isSlow,r=e===rr.Fast?t.isSlow:t.isFast),!!(n||r&&t.mayChangeSpeed&&!t.assisted||!a&&!t.assisted&&this.$.someEffect(yn.MayRepeatPowercard,{power:t,speed:e}))&&!!t.ownerHasEnoughElementsToCastPower}))}async resolvePowerInLocations(e,a,t=!1,n=!1,r=void 0){const i=e.data;if(!n)for(let t=0;t<a.length;t+=1){const n=a[t];for(;void 0!==sg[e.power].payForRange&&!e.validLandTargets({targetIndex:t,ignorePowerModifiesRange:!0}).has(n);)await sg[e.power].payForRange({$:this.$,spirit:this})}await this.$.doEffects(yn.AfterTargetingLands,{power:e,isRepeat:t,lands:a,owner:this});const s=await e.maximizedThresholdsForPower(ir.Land,a[0]),o=td(s,(e=>void 0!==e.threshold&&this.hasElements(e.threshold))),d=o>=0?s[o].threshold:void 0;await this.$.sendEvent({type:fn.PowerResolvedInLands,spirit:this,power:e,targetLands:a,threshold:d});for(const n of s)await e.fulfillsThreshold(n,a[0],ir.Land)&&(await this.$.addEffect({name:i.name,effects:[n],card:e.power,highlightPowers:[e],highlightLocations:a,players:[this],spirit:this}),await this.$.doEffectsWithContext(yn.InTargetLand,{power:e,land:a[0],lands:a,owner:this,isRepeat:t,origin:r},(a=>a.card===e.power)));await this.$.doEffects(yn.AfterResolvingLandTargetingPower,{power:e,isRepeat:t})}async resolvePowerOnSpirit(e,a,t=!1){const n=e.data,r=await e.maximizedThresholdsForPower(ir.Spirit,a),i=td(r,(e=>void 0!==e.threshold&&this.hasElements(e.threshold))),s=i>=0?r[i].threshold:void 0;await this.$.sendEvent({type:fn.PowerResolvedOnSpirit,spirit:this,power:e,targetSpirit:a,threshold:s});for(const i of r)await e.fulfillsThreshold(i,a,ir.Spirit)&&(await this.$.addEffect({name:n.name,effects:[i],spirit:this,players:[this],card:e.power,highlightPowers:[e]}),await this.$.doEffectsWithContext(yn.TargetSpirit,{power:e,spirit:a,owner:this,isRepeat:t},(a=>a.card===e.power)))}async returnPresenceToTracks(e,a={}){await _r(e,(async()=>{const e=this.validTrackSpotsToReturnPresence;if(e.length>0&&(!a.time||this.time>0)&&(!a.destroyed||this.destroyedPresence>0)){const t=await this.$.query({query:pn.SelectTrack,prompt:"Select track spot to return to",players:[this],items:e,actionIds:e.map((e=>`TrackSpot-${e}`)),optional:a.optional});null!==t&&(this.setTrackStatusForIndex(yg.Covered,e[t]),a.time?this.time-=1:a.destroyed&&(this.destroyedPresence-=1))}else a.time&&(this.time-=1,this.destroyedPresence+=1),await this.$.clickToContinue({noOptions:"No valid track spot to return to."})}))}async scoreFromPowers(){for(const e of this.powerCardsInPlay){const a=(e.data.energy||0)+2;this.score+=a,await this.$.sendEvent({type:fn.ScoreFromPower,score:a,power:e})}for(const e of this.innatePowers){const a=e.estimatedValueOfPower;this.score+=dg(a),await this.$.sendEvent({type:fn.ScoreFromInnate,scores:a,power:e})}}async selectBetweenGrowthOptions(e,a){if(this.growthStatus[e]===Ly.Unavailable||this.growthStatus[a]===Ly.Unavailable)return;this.growthStatus[e]=Ly.Available,this.growthStatus[a]=Ly.Available;const t=this.growthOptions,n=[t[e],t[a]],r=t[0===await this.$.query({name:"Growths Begets Growth",text:"Pick unlock option",query:pn.SelectGrowthOption,items:n,actionIds:n.map((e=>`Growth-${e.spirit.spirit}-${e.option}-${e.subOption}`)),players:[this]})?e:a];this.growthStatus[e]=Ly.Inactive,this.growthStatus[a]=Ly.Inactive,await this.$.addEffect({...r.effect,spirit:this,players:[this]}),bm(this,"growthOptions")}async setup(){const{data:e}=this;this.setTrackStatus(e.tracks.map((e=>void 0!==e.requires||void 0!==e.requiresAll||void 0!==e.requiresAny||e.covered?yg.Covered:yg.Uncovered))),this.trackElements=e.tracks.map((()=>null)),this.growthStatus=this.growthOptions.map((()=>Ly.Available)),await this.$.sendEvent({type:fn.SetupSpirit,spirit:this});for(const a of e.uniquePowers)await this.gainPower(a);for(const a of e.innatePowers)await this.gainPower(a);for(const a of e.specialRules)await this.doSpiritAction((()=>this.$.addEffect({...a,card:e.innatePowers[0],spirit:this,players:[this]})));if(this.aspect)for(const a of yv[this.aspect].effects)await this.doSpiritAction((()=>this.$.addEffect({...a,card:e.innatePowers[0],spirit:this,players:[this]})));bm(this,"growthOptions")}async setupPresence(){const{data:e,name:a}=this;await this.$.oneEffectActivates(yn.AdjustSetupPresence,{spirit:this})||await this.$.addEffect({name:`${a}: Setup`,effects:e.setup,spirit:this,players:[this]})}async spendTime(e){if(this.time<e)throw new Error("Not enough time to pay for amount.");await this.returnPresenceToTracks(e,{time:!0}),await this.$.sendEvent({type:fn.TimeLost,spirit:this,amount:e})}async targetAndResolvePower(e,a=!1){await this.doPowerAction((async()=>{const t=e.data;if(e.status===Fd.ResolvedFast||e.status===Fd.ResolvedSlow){const t=e.status===Fd.ResolvedFast?rr.Fast:rr.Slow,n=this.$.firstEffectOfType(yn.MayRepeatPowercard,{power:e,speed:t});n&&(await this.$.doEffect(n,yn.RepeatPowerCard,{power:e,speed:t}),a=!0)}if(t.type===Sn.Innate&&(await this.$.doEffects(yn.BeforeResolvingInnate,{power:e}),await this.possiblyDowngradeElements(e)),t.target===ir.Land)await this.$.addEffect({name:t.name,text:a?"Repeat this Power":"Pick Target Land",card:e.power,highlightPowers:[e],players:[this],[yn.Now]:async()=>{t.blightWhiteListedPower&&this.$.startAllowOceanForBlight();const n=e.data.specifyOrigin?await e.pickValidOriginTarget():void 0,r=void 0!==e.data.ranges?e.data.ranges.length:1,i=[];for(let s=0;s<r;s+=1){const o=this.$.action.data.mustTargetAdjacent,d=e.validLandTargets({targetIndex:s,origin:n,mustTargetAdjacent:o}).where((e=>!i.includes(e)));let c=a?"Repeat this Power":"Pick Target Land";r>1&&(c+=` at <range-${e.data.ranges[s]}>`),o&&(c+=" adjacent to Source"),await d.pickOne((async a=>{i.push(a),await this.$.doEffects(yn.AfterTargetingLand,{targetIndex:s,power:e,land:a,owner:this})}),{text:c,noOptions:`No valid Target Lands for ${t.name}.`})}this.$.stopAllowOceanForBlight(),i.length>0&&await this.resolvePowerInLocations(e,i,a,!1,null!==n?n:void 0)}});else{const n=e.validSpiritTargets();await this.$.addEffect({name:t.name,text:"Pick Target Spirit",card:e.power,highlightPowers:[e],players:[this],[yn.Now]:async()=>{await n.autoPickOne((async t=>{if(this!==t&&this.$.config.archipelagos){const e=this.boardDistanceToSpirit(t);null!==e&&e>0&&(await this.$.sendEvent({type:fn.TargetedAcrossIslets,spirit:this,targetSpirit:t,distance:e}),await this.payEnergy(e))}await this.resolvePowerOnSpirit(e,t,a)}),{noOptions:`No valid Target Spirits for ${t.name}.`})}})}await e.setStatus(e.status===Fd.PlayedFast?Fd.ResolvedFast:Fd.ResolvedSlow)}),e)}async timePasses(){this.growthStatus=this.growthStatus.map((e=>e===Ly.Chosen||e===Ly.NotChosen?Ly.Available:e)),this.setTrackStatus(this.trackStatus.map((e=>e===yg.UncoveredPlayed?yg.Uncovered:e))),this.hasPlayedPowers=!1,this.cardsPlayedThisTurn=[],this.usedCardPlaysForNonDamageAndDestroy=0,this.cardsMadeImpendingThisTurn=[];for(const e of this.powers)await e.timePasses();this.hasReclaimedACardDuringSpiritPhase=!1,bm(this,"growthOptions")}toString(){return bg({[am[this.spirit].name]:bg({aspect:null!==this.aspect?yv[this.aspect].name:"None",cards:Vo(this.powers,(e=>`${e.power}[${e.status}]`)),energy:this.energy},4)},3)}trackPlacementIsValidGivenIndexIsCovered(e){const a=this.trackStatus.filter(((a,t)=>a!==yg.Covered&&t!==e)).length,t=this.data.tracks.map((e=>void 0===e.requires&&void 0===e.requiresAny&&void 0===e.requiresAll));for(;t.filter((e=>!0===e)).length<a;){let a=!1;if(this.data.tracks.forEach(((n,r)=>{t[r]||r===e||this.trackStatus[r]===yg.Covered||void 0!==n.requires&&!t[n.requires]||void 0!==n.requiresAll&&n.requiresAll.some((e=>!t[e]))||void 0!==n.requiresAny&&!n.requiresAny.some((e=>t[e]))||(t[r]=!0,a=!0)})),!a)return!1}return!0}async yourSacredSitesMayAlsoCountAs(e){await this.$.addSubEffect({[yn.GlobalReminder]:()=>({icon:`<sacred><br>= ${Kn[e].text}`,ongoing:!0,spirit:this,players:[this]}),[yn.MoveWithoutWaiting]:({piece:e,source:a,pieceFilter:t})=>e.isAPresenceOf(this)&&a.numberOfPresenceOf(this)>=2&&!Kn[t].pieces.includes(Bn.Presence),[yn.AfterMoving]:async({piece:e,source:a,destination:t,pieceFilter:n,movement:r})=>{e.isAPresenceOf(this)&&!Kn[n].pieces.includes(Bn.Presence)&&await a.move({pieces:this.$.Presence,locations:{target:Jn.ToThisLocation,location:t},owner:this,movement:r})},[yn.AfterRemovePiece]:async({piece:e,location:a,removement:t,pieceFilter:n})=>{e.isAPresenceOf(this)&&!Kn[n].pieces.includes(Bn.Presence)&&await a.remove({owner:this,pieces:this.$.Presence,removement:t})}})}get chosenGrowthOption(){return Cr(this.growthOptions.map((({option:e})=>e))).map((e=>this.growthOptions.some((({status:a,option:t})=>e===t&&a===Ly.Chosen))))}get energyDebt(){return this.$.sumEffects(yn.EnergyDebt,{spirit:this})}get extraCardDrawAmount(){return this.$.sumEffects(yn.ExtraCardDrawAmount,{spirit:this})}get extraCardKeepAmount(){return this.$.sumEffects(yn.ExtraCardKeepAmount,{spirit:this})}get mayTreatElementsAsOther(){return this.aspect===zo.DarkFire}get unfinishedGrowthOption(){return this.growthOptions.find((e=>e.status===Ly.Chosen&&this.growthOptions.some((a=>e!==a&&e.option===a.option&&a.status===Ly.Available))))?.option}async gainPowerCardBuffs(e,a={}){const{discardAfter:t=!0,withoutForgetting:n=!1,forgetOptional:r=!1}=a;for(const a of e)await this.addExtraAction({actionId:`Gain${a}`,name:sg[a].name,required:!0,icon:"",text:"Gain this power card.",power:a,previewPowers:()=>({powers:e,selected:[e.indexOf(a)]}),enabled:()=>this.$.phase===Wi.Grow,onActivate:async()=>{for(const a of e)this.$.removeEffectsWithName(sg[a].name);const i=e.filter((e=>e!==a)),s={chosen:[],notChosen:i,forgotten:[],gifted:!1,taken:!1};if(t)for(const e of i)await this.$.discardPowerToDeckDiscard(e);this.destinyPowers.includes(a)&&qr(this.destinyPowers,a);const o=await this.gainPower(a);sg[a].type!==Sn.Major||n||await this.$.addSubEffect({text:"After you gain a Major Power, you must Forget one of your Power Cards.",[yn.Now]:async()=>{const e=await this.forgetPowers({optional:r,duringPowerGain:!0});s.forgotten.push(...e)}}),s.chosen.push(o),await this.$.doEffects(yn.AfterGainingPowers,{spirit:this,powerGain:s})}})}setTrackStatus(e){this.trackStatusInternal=e,bm(this,"elementsFromTracks","elements")}setTrackStatusForIndex(e,a){this.trackStatusInternal=this.trackStatusInternal.map(((t,n)=>n===a?e:t)),bm(this,"elementsFromTracks","elements")}}xv([Re],bv.prototype,"absorbedPresence",void 0),xv([Re],bv.prototype,"aspect",void 0),xv([Re],bv.prototype,"cardsMadeImpendingThisTurn",void 0),xv([Re],bv.prototype,"cardsPlayedThisTurn",void 0),xv([Re],bv.prototype,"daysPowers",void 0),xv([Re],bv.prototype,"destinyPowers",void 0),xv([Re],bv.prototype,"destroyedIncarna",void 0),xv([Re],bv.prototype,"destroyedPresence",void 0),xv([Re],bv.prototype,"didNotWantToReachThreshold",void 0),xv([Re],bv.prototype,"disabledGrowthOptions",void 0),xv([Re],bv.prototype,"growthStatus",void 0),xv([Re],bv.prototype,"hasEmpoweredIncarna",void 0),xv([Re],bv.prototype,"hasPlayedPowers",void 0),xv([Re],bv.prototype,"hasReclaimedACardDuringSpiritPhase",void 0),xv([Re],bv.prototype,"healingCards",void 0),xv([Re],bv.prototype,"healingMarkers",void 0),xv([Re],bv.prototype,"innateEnergy",void 0),xv([Re],bv.prototype,"landsIncludingNonExisting",void 0),xv([Re],bv.prototype,"panelPieces",void 0),xv([Re],bv.prototype,"powers",void 0),xv([Re],bv.prototype,"powersInProgressionDeck",void 0),xv([Re],bv.prototype,"preparedElements",void 0),xv([Re],bv.prototype,"rememberedUniques",void 0),xv([Re],bv.prototype,"spirit",void 0),xv([Re],bv.prototype,"spiritNumber",void 0),xv([Re],bv.prototype,"startingBoardIndex",void 0),xv([Re],bv.prototype,"time",void 0),xv([Re],bv.prototype,"trackElements",void 0),xv([Re],bv.prototype,"usedCardPlaysForNonDamageAndDestroy",void 0),xv([Re],bv.prototype,"trackStatusInternal",void 0),xv([Me],bv.prototype,"cardPlaysCostToPlayPowerCard",null),xv([xm()],bv.prototype,"elements",null),xv([xm()],bv.prototype,"elementsFromEffects",null),xv([xm()],bv.prototype,"elementsFromPowers",null),xv([xm()],bv.prototype,"elementsFromTracks",null),xv([Me],bv.prototype,"extraPresenceAvailableForTargeting",null),xv([Me],bv.prototype,"growthOptionGroups",null),xv([xm()],bv.prototype,"growthOptions",null),xv([Me],bv.prototype,"pickOptions",null);class Tv{spiritCount;spirits;$;constructor(e){this.$=e,this.spirits=[],this.spiritCount=0,this.$.config.boards.forEach(((e,a)=>{e.spirit&&(this.spirits.push(new bv({$:this.$,spiritNumber:this.spiritCount,spirit:e.spirit.spirit,aspect:e.spirit.aspect,boardIndex:a,progression:e.spirit.progression})),this.spiritCount+=1)}))}get adjustedCardPlays(){return this.$.sumEffects(yn.AdjustCardPlays)}get allSpiritsHavePlayedPowers(){return!this.spirits.some((e=>!e.hasPlayedPowers))}get availableExtraActions(){const e=[];for(const a of this.$.effectsOfType(yn.ExtraAction)){const t=a[yn.ExtraAction]?.({effect:a});t&&e.push({effect:t,spirit:a.spirit,extraIndex:this.$.globalReminders.findIndex((e=>e.id===a.id))})}return e}get availableGrowthOptions(){return this.growthOptions.filter((e=>e.status===Ly.Available&&e.spirit.canAffordGrowthOption(e)))}get availablePowersForPlay(){const e=[];return this.spirits.forEach((a=>{e.push(...a.availablePowersForPlay)})),e}get availableTrackActions(){return this.trackActions.filter((({status:e})=>e===yg.Uncovered))}get growthOptions(){const e=[];return this.spirits.forEach((a=>{e.push(...a.growthOptions)})),e}get growthStatus(){const e=[];return this.spirits.forEach((a=>{e.push(...a.growthStatus)})),e}get playersCanJointlyPayEnergyAidedBy(){return e=>this.spareEnergyWhenJointlyPayEnergyAidedBy(e)>=0}get powerCardsPlayedThisTurn(){const e=[];return this.spirits.forEach((a=>{e.push(...a.cardsPlayedThisTurn)})),e}get requiredExtraActions(){return this.availableExtraActions.filter((e=>e.effect.required))}get resolvablePowers(){return(e,a=!1)=>{const t=[];return this.spirits.forEach((n=>{t.push(...n.resolvableCardsWithSpeed(e,a))})),t}}get spiritsWithAvailablePowersForPlay(){return this.spirits.filter((e=>!e.hasPlayedPowers))}get spiritsWithExtraActions(){const e=this.availableExtraActions;return this.spirits.filter((a=>e.some((({effect:e})=>void 0===e.players||e.players?.includes(a)))))}get trackActions(){const e=[];return this.spirits.forEach((a=>{e.push(...a.trackActions)})),e}async eachSpirit(e){for(const a of this.spirits)await this.$.addSubEffect({players:[a],[yn.Now]:async()=>{await e(a)}})}fromAllSpirits(){return bv.createCollection(this.$,this.spirits)}async gainDamageBoost(e){const{amount:a,once:t=!1,source:n,permanent:r=!1,spirit:i,scenario:s,filter:o,effectId:d}=e,c=Re.box(0);await this.$.addSubEffect({effectId:d,expireAtEndOfTurn:!r,[yn.GlobalReminder]:()=>({icon:`+${a} <damage><br>${c}/${a}`,ongoing:r,spirit:n,scenario:s,players:void 0!==i?[i]:void 0}),[yn.DamageBoost]:async e=>{const n=this.$.currentStackEffect;for(;c.get()<a&&(e.spirit===i||void 0===i)&&a>0&&(void 0===o||o())&&await e.onUse();)c.set(c.get()+1);c.get()>0&&await this.$.addEffectUntilEndOfAction({[yn.ActionEnds]:()=>(t?this.$.removeEffect(n):c.set(0),Promise.resolve())})}})}async gainEnergyDividedEvenly(e){const a=Math.floor(e/this.spiritCount),t=e-a*this.spiritCount,n=this.fromAllSpirits();await n.pickMultiple({amount:t,forPickedItem:async e=>{n.remove(e),await e.gainEnergy(a+1)},effect:{prompt:`Pick spirit to gain ${a} energy.`}}),await n.forEach((async e=>{await e.gainEnergy(a)}))}async gainEnergyFromTracks(){await this.eachSpirit((async e=>{await e.gainEnergyFromTracks()}))}async growAndPlayTrackActions(){for(;;){const e=this.availableGrowthOptions;if(!(e.length>0||this.requiredExtraActions.length>0)||this.$.gameEnded)break;let a=this.availableTrackActions;const t=this.availableExtraActions,n=await this.$.query({name:"Grow",text:e.length>0?"Pick Growth Option":"Pick Power Card",query:pn.SelectGrowthOption,items:[...e,...a,...t],actionIds:[...e.map((e=>`Growth-${e.spirit.spirit}-${e.option}-${e.subOption}`)),...a.map((e=>`TrackAction-${e.spirit.spirit}-${e.effect.actionId}`)),...t.map((e=>`ExtraAction-${void 0!==e.spirit?e.spirit.spirit:"Global"}-${e.effect.actionId}`))],players:this.spiritsWithGrowthOptions(t)});if(n<e.length){const a=e[n];await a.spirit.grow(a.index)}else if(a=this.availableTrackActions,n<e.length+a.length){const t=a[n-e.length];await t.spirit.doTrackAction(t.trackIndex)}else{const r=t[n-e.length-a.length];await this.$.doExtraAction(r)}}}async payEnergyJointlyAidedBy(e){const{energy:a,element:t,aidedByRemovingDisease:n}=e;let r=0;if(n)for(;!this.$.playersCanJointlyPayEnergyAidedBy({energy:a-3*r,aidedByRemovingDisease:!1});)r+=1;const i={amount:this.spareEnergyWhenJointlyPayEnergyAidedBy(e)};if(1===this.$.spiritCount&&void 0===t&&!n)return void await this.$.spirits[0].payEnergy(a);const s={amount:0};for(const e of this.spirits)if(t){const a=e.elementTreatedAsElement(t);s.amount+=e.elements[a]}if(t&&(s.amount+=2*(this.$.landElements[t]??0)),s.amount>=a){let e="Jointly pay Energy";void 0!==t&&(e+=` aided by ${Vy[t].text}.`),e+=`<br>Paid: ${a} / ${a}.`,await this.$.clickToContinue({text:e})}n&&(r>0&&await this.$.forPiecesThatIs(this.$.Disease).pickMultiple({effect:{text:"Remove <disease> from the island for 3 Energy. (required)"},forPickedItem:async e=>{await e.remove(),s.amount+=3}}),await this.$.forPiecesThatIs(this.$.Disease).pickMultiple({effect:{text:"Remove <disease> from the island for 3 Energy each? (optional)"},optional:!0,forPickedItem:async e=>{await e.remove(),s.amount+=3}}));const o=[];for(;s.amount<a;){const e=[];for(const a of this.spirits)if(a.energy>0&&e.push({actionId:`${a.spirit}-PayEnergy`,text:"Pay 1 Energy. (+1)",category:km.PayEnergy,spirit:a,[yn.Now]:async()=>{s.amount+=1,await a.payEnergy(1)}}),void 0!==t){const n=a.elementTreatedAsElement(t);a.elements[n]<a.maxElementsWithConvert(n)&&e.push({actionId:`${a.spirit}-Convert`,text:`Convert to ${Vy[n].text}`,category:km.ConvertElements,spirit:a,[yn.Now]:async()=>{s.amount+=1,await a.convertElements({[n]:a.elements[n]+1})}});const r=n===nr.DarkFire?[nr.Moon,nr.Fire]:[n],d=a.powersWhere((e=>e.isInHand&&!e.assisted&&(r.some((a=>e.data.elements?.includes(a)))||e.power===Mi.ElementalBoon)&&!o.includes(e)&&i.amount>=(e.isInPlay&&e.power!==Mi.ElementalBoon?1:2)));d.count>0&&e.push({actionId:`${a.spirit}-Discard`,text:"Discard Power from Hand. (+2)",players:[a],category:km.DiscardPowerFromHand,spirit:a,[yn.Now]:async()=>{await d.pickOne((async e=>{s.amount+=2,o.push(e),await e.discard(),i.amount-=e.isInPlay&&e.power!==Mi.ElementalBoon?1:2}))}});const c=a.powersWhere((e=>(r.some((a=>e.data.elements?.includes(a)))||e.power===Mi.ElementalBoon)&&!e.isBlessed&&!e.assisted&&!o.includes(e)));c.count>0&&e.push({actionId:`${a.spirit}-Forget`,text:"Forget a Power. (+3-4)",players:[a],category:km.ForgetPower,spirit:a,[yn.Now]:async()=>{await c.pickOne((async e=>{s.amount+=e.isInPlay&&e.power!==Mi.ElementalBoon?3:4,o.push(e),await e.forget()}))}})}let n="Jointly pay Energy";if(void 0!==t&&(n+=` aided by ${Vy[t].text}.`),n+=`<br>Paid: ${s.amount} / ${a}.`,0===e.length)throw new Error("No valid pay option.");await this.$.chooseBetween({text:n,effects:e},{orChoice:!1,payJointly:!0})}}async playDraftActions(e,a){for(;!this.$.gameEnded;){const t=this.availableExtraActions;if(0===t.length)break;const n=await this.$.query({name:"Drafting",prompt:a(),text:e(),query:pn.SelectGrowthOption,items:[...t],actionIds:[...t.map((e=>`ExtraAction-${void 0!==e.spirit?e.spirit.spirit:"Global"}-${e.effect.actionId}`))],players:this.spiritsWithExtraActions}),r=t[n];await this.$.doExtraAction(r)}}async playPowers(){for(;;){const e=this.availablePowersForPlay;if(0===e.length)break;const a=await this.$.query({name:"Play Powers",text:"Play Powers",query:pn.PlayPower,players:this.spiritsWithAvailablePowersForPlay,items:e,actionIds:e.map((e=>`${e.spirit.spirit}-${void 0===e.power?"Finish":e.power.power}`))});if(null===a)break;{const t=e[a];t.power?(t.spirit.hasPlayedPowers=!1,await t.power.play()):t.spirit.hasPlayedPowers=!0}}for(const e of this.spirits)await e.playInnates()}async playTrackActions(){for(;!this.$.gameEnded;){const e=this.availableExtraActions,a=this.availableTrackActions,t=a.length+e.length;if(0===t)break;const n=await this.$.queryOptional({name:"Spirit actions",text:"Pick Spirit action.",cancel:`Skip remaining Spirit action${t>1?"s":""}.`,query:pn.SelectGrowthOption,items:[...a,...e],actionIds:[...a.map((e=>`TrackAction-${e.spirit.spirit}-${e.effect.actionId}`)),...e.map((e=>`ExtraAction-${void 0!==e.spirit?e.spirit.spirit:"Global"}-${e.effect.actionId}`))],players:this.spiritsWithGrowthOptions(e)});if(null===n)break;if(n<a.length){const e=a[n];await e.spirit.doTrackAction(e.trackIndex)}else{const t=e[n-a.length];await this.$.doExtraAction(t)}}}powersWhere(e){const a=[];for(const t of this.spirits)a.push(...t.powers.filter(e));return $d.createCollection(this.$,a)}async resolvePowers(e){for(;!this.$.gameEnded&&(void 0===this.$.resolvableCardsLeft||this.$.resolvableCardsLeft>0);){const a=this.resolvablePowers(e),t=this.availableExtraActions,n=a.length+t.length;if(0===n)break;const r=await this.$.queryOptional({name:(e===rr.Fast?"Fast":"Slow")+" Powers",text:"Select power to resolve",cancel:"Skip remaining "+(n>1?"powers":"power"),query:pn.SelectPower,items:[...a,...t],actionIds:[...a.map((e=>`${e.owner.spirit}-${e.power}`)),...t.map((e=>`Extra-${e.effect.actionId}`))],players:this.spiritsWithResolvablePowersOActions(e,t)});if(null===r)return;if(r<a.length){const t=a[r];await t.changeSpeedIfNeeded(e),await t.owner.targetAndResolvePower(t)}else{const e=t[r-a.length];await this.$.doExtraAction(e)}}}async scoreFromPowers(){for(const e of this.spirits)await e.scoreFromPowers()}async setup(){for(const e of this.spirits)await e.setup()}async setupPresence(){for(const e of this.spirits)await e.setupPresence()}spiritsWhich(e){return this.fromAllSpirits().where(e)}spiritsWithGrowthOptions(e){return this.spirits.filter((a=>a.growthOptions.some((({status:e})=>e===Ly.Available))||a.trackActions.some((({status:e})=>e===yg.Uncovered))||e.some((({effect:e})=>void 0===e.players||e.players?.includes(a)))))}spiritsWithResolvablePowersOActions(e,a){return this.spirits.filter((t=>t.resolvableCardsWithSpeed(e).length>0||a.some((({effect:e})=>void 0===e.players||e.players.includes(t)))))}async timePasses(){for(const e of this.spirits)await e.timePasses()}toString(){return bg({spiritCount:this.spiritCount,spirits:this.spirits},2)}get spareEnergyWhenJointlyPayEnergyAidedBy(){return e=>{const{energy:a,element:t,aidedByRemovingDisease:n=!1}=e;let r=0;n&&(r+=3*this.$.forPiecesThatIs(this.$.Disease).count),t&&(r+=2*(this.$.landElements[t]??0));for(const e of this.spirits)if(r+=e.energy,t){const a=e.elementTreatedAsElement(t);r+=e.maxElementsWithConvert(a),r+=4*e.elementsFromHand[a],r+=4*e.elementsFromDiscard[a],r+=3*e.elementsFromNonBlessedPowers[a],e.hasPower(Mi.ElementalBoon)&&(r+=4)}return r-a}}}var Ev=function(e,a,t,n){var r,i=arguments.length,s=i<3?a:null===n?n=Object.getOwnPropertyDescriptor(a,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,a,t,n);else for(var o=e.length-1;o>=0;o--)(r=e[o])&&(s=(i<3?r(s):i>3?r(a,t,s):r(a,t))||s);return i>3&&s&&Object.defineProperty(a,t,s),s};class Pv{AllPieces=Qn.AllPieces;AllPiecesButDahanPresenceAndSpiritTokens=Qn.AllPiecesButDahanPresenceAndSpiritTokens;Badlands=Qn.Badlands;BadlandsBeastsDiseaseOrWilds=Qn.BadlandsBeastsDiseaseOrWilds;BadlandsOrBeasts=Qn.BadlandsOrBeasts;BadlandsOrDisease=Qn.BadlandsOrDisease;BadlandsOrStrife=Qn.BadlandsOrStrife;Beasts=Qn.Beasts;BeastsDiseaseOrWilds=Qn.BeastsDiseaseOrWilds;Blight=Qn.Blight;BlightExplorerOrTown=Qn.BlightExplorerOrTown;City=Qn.City;Dahan=Qn.Dahan;Deeps=Qn.Deeps;Disease=Qn.Disease;Explorer=Qn.Explorer;ExplorerDahanOrBlight=Qn.ExplorerDahanOrBlight;ExplorerOrDahan=Qn.ExplorerOrDahan;ExplorerOrTown=Qn.ExplorerOrTown;ExplorerTownDahanOrBeasts=Qn.ExplorerTownDahanOrBeasts;ExplorerTownOrDahan=Qn.ExplorerTownOrDahan;FlameMarker=Qn.FlameMarker;HiddenLocation=Qn.HiddenLocation;Incarna=Qn.Incarna;IncarnaBehemoth=Qn.IncarnaBehemoth;IncarnaDarkness=Qn.IncarnaDarkness;IncarnaLair=Qn.IncarnaLair;IncarnaLocus=Qn.IncarnaLocus;IncarnaRoots=Qn.IncarnaRoots;IncarnaVoice=Qn.IncarnaVoice;IncarnaWarrior=Qn.IncarnaWarrior;Invader=Qn.Invader;InvaderDahanOrBeast=Qn.InvaderDahanOrBeast;InvaderDahanPresenceOrBeast=Qn.InvaderDahanPresenceOrBeast;InvaderOrDahan=Qn.InvaderOrDahan;Omen=Qn.Omen;Presence=Qn.Presence;Quake=Qn.Quake;Strife=Qn.Strife;Thief=Qn.Thief;Town=Qn.Town;TownCityOrDahan=Qn.TownCityOrDahan;TownOrCity=Qn.TownOrCity;TownOrDahan=Qn.TownOrDahan;TownPresenceOrBeasts=Qn.TownPresenceOrBeasts;Vitality=Qn.Vitality;WardingPattern=Qn.WardingPattern;Wilds=Qn.Wilds;blightHandler;logErrors;pieceCount={};config;actionHandler;adminHandler;adversaryHandler;commandBeastHandler;conductor;difficultyCalculator;effectHandler;eventHandler;fearHandler;inquirer;instructionHandler;invaderCardHandler;islandHandler;overrider;powerHandler;randomizer;scenarioHandler;spiritHandler;surveyor;constructor(e,a,t={}){Xo.makeObservable(this),this.config=a,this.logErrors=t.logErrors??!0,this.randomizer=new vm(a.seed),this.actionHandler=new $w(this),this.adminHandler=new Fm(this),this.adversaryHandler=new Nm(this),this.blightHandler=new Eg(this),this.commandBeastHandler=new $m(this),this.conductor=new Mw(this),this.difficultyCalculator=new fm(this),this.effectHandler=new Rw(this),this.eventHandler=new up(this),this.fearHandler=new Sw(this),this.inquirer=new ym(this,e),this.instructionHandler=new mm,this.invaderCardHandler=new Cw(this),this.islandHandler=new Em(this),this.powerHandler=new kw(this),this.scenarioHandler=new Mm(this),this.spiritHandler=new Tv(this),this.surveyor=new Bm(this),this.overrider=new Wm}get action(){return this.actionHandler.currentAction}get activeEventCard(){return this.eventHandler.activeEventCard}get adjustedCardPlays(){return this.spiritHandler.adjustedCardPlays}get adversaryLeading(){return this.adversaryHandler.adversaryLeading}get adversarySupporting(){return this.adversaryHandler.adversarySupporting}get allSpiritsHavePlayedPowers(){return this.spiritHandler.allSpiritsHavePlayedPowers}get alwaysPushToSameDestination(){return this.overrider.alwaysPushToSameDestination}get beastsCountAsBadlands(){return this.someEffect(yn.BeastsCountAsBadlands)}get beastsOnIsland(){return this.islandHandler.pieceCountIncludingStasis(this.Beasts)}get blightCardActive(){return this.blightHandler.blightCardActive}get blightCardsDiscarded(){return this.blightHandler.blightCardsInDiscard}get blightCardsInDeck(){return this.blightHandler.blightCardsInDeck}get blightOnBlightCard(){return this.blightHandler.blightOnBlightCard}get blightPool(){return this.blightHandler.blightPool}get blightStatus(){return this.blightHandler.blightStatus}get boardCount(){return this.islandHandler.boardCount}get boards(){return this.islandHandler.boards}get bringingWarriorThisInstruction(){return this.instructionHandler.bringingWarrior}get buildOrderMatters(){return this.someEffect(yn.BuildOrderMatters)}get capitalSize(){return this.islandHandler.capitalSize}get coastalLands(){return this.islandHandler.coastalLands}get coastalLandsWithCities(){return this.islandHandler.coastalLandsWithCities}get coastalLandsWithWardingPatterns(){return this.islandHandler.coastalLandsWithWardingPatterns}get corners(){return this.islandHandler.corners}get currentActionHasAllThresholds(){return this.action.type===Ho.PowerAction&&this.someEffect(yn.PowerHasAllThresholds,{power:this.action.power})}get currentActionType(){return this.actionHandler.currentActionType}get currentFear(){return this.fearHandler.fear}get currentHistory(){return this.inquirer.currentHistory}get currentStackEffect(){return this.effectHandler.currentStackEffect}get cursorAtPlayPower(){return this.inquirer.cursorAtPlayPower}get dahanCount(){return this.islandHandler.pieceCountIncludingStasis(this.Dahan)}get damageIgnoreHealthBonuses(){return this.someEffect(yn.DamageIgnoreHealthBonuses)}get destroyedBoards(){return this.islandHandler.destroyedBoards}get difficulty(){return this.difficultyCalculator.difficulty}get effectIds(){return this.effectHandler.effectIds}get eventCardIsActive(){return this.eventHandler.eventCardIsActive}get eventCardsInDeck(){return this.eventHandler.eventCardsInDeck}get exploreDeck(){return this.invaderCardHandler.exploreDeck}get exploreDistance(){return 1+(this.someEffect(yn.ExtraExploreDistance)?1:0)}get extraBeastAdjacency(){return this.someEffect(yn.ExtraBeastAdjacency)}get fearBasedVictoryIsRemoved(){return this.someEffect(yn.RemoveFearBasedVictory)}get fearCardsDiscarded(){return this.fearHandler.fearCardsDiscarded}get fearCardsEarned(){return this.fearHandler.fearCardsEarned}get fearCardsEarnedCount(){return this.fearHandler.fearCardsEarnedCount}get fearCardsInDeck(){return this.fearHandler.fearCardsInDeck}get fearCardsInLevelCount(){return this.fearHandler.fearCardsInLevelCount}get fearPool(){return this.fearHandler.fearPool}get gameEnded(){return this.conductor.gameEnded}get gameLost(){return this.conductor.gameLost}get gameWon(){return this.conductor.gameWon}get globalReminders(){return this.effectHandler.globalReminderEffects}get hasAttemptedDamagingInvaderThisInstruction(){return this.instructionHandler.hasAttemptedDamagingInvader}get hasAttemptedDestroyingInvaderThisInstruction(){return this.instructionHandler.hasAttemptedDestroyingInvader}get hasLostFromEffect(){return this.effectHandler.hasLostFromEffect}get hasResolvedFearCard(){return this.fearHandler.hasResolvedFearCard}get hasRunningAction(){return this.actionHandler.hasRunningAction}get hasWonFromEffect(){return this.effectHandler.hasWonFromEffect}get highImmigrationActive(){return this.existEffect(yn.HighImmigration)}get ignoreOneStrife(){return this.someEffect(yn.IgnoreOneStrife)}get ignoreWildsDuringExplore(){return this.someEffect(yn.IgnoreWildsDuringExplore)}get inputs(){return pg.getInputs(this,0)}get invaderCardsInExploreDeck(){return this.invaderCardHandler.invaderCardsInExploreDeck}get invaderCardsInFearDeck(){return this.fearHandler.invaderCardsInFearDeck}get invaderCardsVisible(){return this.invaderCardHandler.invaderCardsVisible}get isInAdmin(){return this.adminHandler.isInAdmin}get landCountWhereTownsAndCitiesOutnumberDahan(){return this.locationsIncludingNonExisting.filter((e=>e.the(this.TownOrCity).outnumber(this.Dahan))).length}get landElements(){return this.islandHandler.landElements}get lands(){return this.islandHandler.lands}get lastSeenEventCard(){return this.eventHandler.lastSeenEventCard}get locations(){return this.islandHandler.locations}get locationsIncludingNonExisting(){return this.islandHandler.locationsIncludingNonExisting}get lostReason(){return this.conductor.lostReason}get maxCoastalLandsWithCities(){return 2*this.islandHandler.boards.length+1}get maxIrreparableDamage(){return this.spiritCount+1}get maxTownsAllowed(){return this.adversaryHandler.maxTownsAllowed}get miningLandsCauseRavageActions(){return this.someEffect(yn.MiningLandsCauseRavageActions)}get movedDahanThisInstruction(){return this.instructionHandler.movedDahan}get movedPresenceThisInstruction(){return this.instructionHandler.movedPresence}get nonDestroyedBoards(){return this.islandHandler.nonDestroyedBoards}get numberOfExploreCardsThisTurn(){return this.invaderCardHandler.numberOfExploreCardsThisTurn}get oceanIsAllowedForBlight(){return this.islandHandler.oceanIsAllowedForBlight}get orderOfRemoveAllMightMatter(){return this.someEffect(yn.OrderOfRemoveAllMightMatter)}get parentEffect(){return this.effectHandler.parentEffect}get phase(){return this.conductor.phase}get pieces(){return this.islandHandler.pieces}get playingWithCommandBeasts(){return!this.config.events&&this.config.sets.length>1}get powerCardsInPlayThatGeneratesFear(){return this.powerCardsPlayedThisTurn.filter((e=>e.data.generatesFear&&!e.isBlessed&&!e.assisted))}get powerCardsPlayedThisTurn(){return this.spiritHandler.powerCardsPlayedThisTurn}get powercardsInMajorDeck(){return this.powerHandler.powercardsInMajorDeck}get powercardsInMinorDeck(){return this.powerHandler.powercardsInMinorDeck}get preventSlowPowers(){return this.someEffect(yn.PreventSlowPowers)}get preventTerrorLevelAndResolveFearCards(){return this.fearHandler.preventTerrorLevelAndResolveFearCards}get randomEventsEnabled(){return this.overrider.randomEventsEnabled}get reminderEffects(){return this.effectHandler.reminderEffects}get reportedPhase(){return this.conductor.reportedPhase}get resolvableCardsLeft(){return this.overrider.resolvableCardsLeft}get resolvingFearCard(){return this.fearHandler.resolvingFearCard}get scenario(){return this.scenarioHandler.scenario}get score(){let e=0;return this.gameWon?(e+=5*this.difficulty+10+2*this.invaderCardsInExploreDeck.length,this.gameLost&&(e-=5)):e+=2*this.difficulty+(this.invaderCardsVisible.length+this.invaderCardsInSlot(Zl.Discard).length),e+=Math.floor(this.pieceCountIncludingStasis(Qn.Dahan)/this.spiritCount),e-=Math.floor(this.pieceCountIncludingStasis(Qn.Blight)/this.spiritCount),e+=this.sumEffects(yn.ExtraScore),e}get showFearCards(){return!this.preventTerrorLevelAndResolveFearCards}get showingTerrainTypes(){return this.invaderCardHandler.showingTerrainTypes}get slowHealingBlight(){return this.blightHandler.slowHealingBlight}get someBoardsHasExtraLocations(){return this.existEffect(yn.BoardHasExtraLocation)}get someEffect(){return(e,a)=>this.effectHandler.someEffect(e,a)}get someEffectMakesOceanALand(){return this.existEffect(yn.OceanIsLand)}get someLocationHasExtraTerrains(){return this.existEffect(yn.LocationIsTerrain)}get someNonOceanIsOcean(){return this.existEffect(yn.LocationIsOcean)}get spiritCount(){return this.spiritHandler.spiritCount}get spiritPhase(){return[Wi.Grow,Wi.GainEnergy,Wi.PlayPowers].includes(this.phase)}get spiritSimulation(){return this.overrider.spiritSimulation}get spirits(){return this.spiritHandler.spirits}get stage(){return this.invaderCardHandler.stage}get startingBlight(){return this.blightHandler.startingBlight}get strippedLandSize(){return this.islandHandler.strippedLandSize}get terrorLevel(){return this.fearHandler.terrorLevel}get theEndlessDark(){return this.islandHandler.theEndlessDark}get theEndlessDarkExists(){return this.config.boards.some((e=>e.spirit?.spirit===n.Darkness))}get theEndlessDarkPosition(){return this.config.endlessDark??{x:0,y:0}}get townsCount(){return this.islandHandler.pieceCountIncludingStasis(this.Town)}get treatingAllOrsAsAnds(){return this.someEffect(yn.TreatAllORsAsANDs)}get turn(){return this.conductor.turn}get unusedBoardCount(){return this.islandHandler.boardsUnused.length}get unusedFearCardsLeft(){return this.fearHandler.unusedFearCardsLeft}get upToMustBeUsedAtMaximum(){return this.someEffect(yn.UpToMustBeUsedAtMaximum)}get willTakeFromBlightPool(){return this.blightHandler.willTakeFromBlightPool}get winReason(){return this.conductor.winReason}accelerateTheInvaderDeck(){return this.invaderCardHandler.accelerateTheInvaderDeck()}actualExploreCardIndex(e){return this.invaderCardHandler.actualExploreCardIndex(e)}addBlightToBlightCard(e){return this.blightHandler.addBlightToBlightCard(e)}addBlightToBlightPool(e){return this.blightHandler.addBlightToBlightPool(e)}addBoard(e){return this.islandHandler.addBoard(e)}addEffect(e){return this.effectHandler.addEffect(e)}addEffectUntilEndOfAction(e){return this.effectHandler.addEffectUntilEndOfAction(e)}addEffectUntilEndOfActionTree(e){return this.effectHandler.addEffectUntilEndOfActionTree(e)}addEffectUntilEndOfTurn(e){return this.effectHandler.addEffectUntilEndOfTurn(e)}addExploreCardToTop(e,a=0){return this.invaderCardHandler.addExploreCardToTop(e,a)}addFearCards(e){return this.fearHandler.addFearCards(e)}addFearToPool(e){return this.fearHandler.addFearToPool(e)}addRevealedBlightCard(){this.blightHandler.addOneToRevealedBlightCards()}addSlowHealingBlight(e=1){return this.blightHandler.addSlowHealingBlight(e)}addSubEffect(e){return this.effectHandler.addSubEffect(e)}addSubEffectUntilEndOfAction(e){return this.effectHandler.addSubEffectUntilEndOfAction(e)}addSubEffectUntilEndOfTimePasses(e){return this.effectHandler.addSubEffectUntilEndOfTimePasses(e)}addSubEffectUntilEndOfTurn(e){return this.effectHandler.addSubEffectUntilEndOfTurn(e)}addTrigger(e,a,t,n={}){return this.actionHandler.addTrigger(e,a,t,n)}advanceCardsIn(e){return this.invaderCardHandler.advanceCardsIn(e)}advanceInvaderCards(){return this.invaderCardHandler.advanceInvaderCards()}afterPiecesAreAddedOrMovedAddTrigger(e){return this.islandHandler.afterPiecesAreAddedOrMovedAddTrigger(e)}blightDeckIncludesCard(e){return this.blightHandler.blightCardsInDeck.includes(e)}build(e){return this.islandHandler.build(e)}buildFromCard(e,a,t={}){return this.islandHandler.buildFromCard(e,a,t)}checkIfEnded(){this.actionHandler.checkIfEnded()}chooseBetween(e,a={orChoice:!0,payJointly:!1}){return this.inquirer.chooseBetween(e,a)}async clickToContinue(e){await this.query({query:pn.ClickToContinue,items:[0],actionIds:["ClickToContinue"],...e})}closeDown(){this.inquirer.closeDown()}countPieceOnlyIfHavingPiece(e,a){return this.countPiecesOnlyIfHavingPieces([e],a)}async countPieceOptionally(e,a){this.action.dontCountAs.add(e);const t=a();this.action.dontCountAs.delete(e);const n=a();if(n.count>t.count){if(await this.may({prompt:`Count pieces as ${Kn[e].text} to do this effect?`}))return n;this.dontCountAs(e)}return t}countPiecesOnlyIfHavingPieces(e,a){const t=this.action.dontCountAs;for(const a of e)t.add(a);const n=a();if(n.count>0){for(const a of e)t.delete(a);return a()}return n}defaultPromptForQueryType(e){return this.inquirer.defaultPromptForQueryType(e)}disableRandomEvents(){this.overrider.disableRandomEvents()}discardBlightCard(e){return this.blightHandler.discardBlightCard(e)}discardEarnedFearCards(e){return this.fearHandler.discardEarnedFearCards(e)}discardPowerToDeckDiscard(e){return this.powerHandler.discardPower(e)}discardTopFearCard(){return this.fearHandler.discardTopFearCard()}doActionOnEachBoard(e,a,t={}){return this.onEachBoard((t=>this.actionHandler.doAction(e,(()=>a(t)),{board:t})),t)}doAdversaryAction(e,a){return this.actionHandler.doAction(Ho.AdversaryAction,e,a)}doAdversaryActionOnEachBoard(e){return this.islandHandler.doAdversaryActionOnEachBoard(e)}doBlightCardAction(e){return this.actionHandler.doAction(Ho.BlightCardAction,e)}doBlightCardActionOnEachBoard(e){return this.doActionOnEachBoard(Ho.BlightCardAction,e)}doDahanEventAction(e,a){return this.actionHandler.doAction(Ho.DahanEventAction,e,a)}doDahanEventActionOnEachBoard(e,a={}){return this.doActionOnEachBoard(Ho.DahanEventAction,e,a)}doEffect(e,a,t){return this.effectHandler.doEffect(e,a,t)}doEffectWithContext(e,a,t){return this.effectHandler.doEffectWithContext(e,a,t)}doEffects(e,a,t){return this.effectHandler.doEffects(e,a,t)}doEffectsWithContext(e,a,t){return this.effectHandler.doEffectsWithContext(e,a,t)}doEffectsWithPriority(e,a){return this.effectHandler.doEffectsWithPriority(e,a)}async doExtraAction(e){void 0!==e.effect.spirit?await this.doSpiritAction((()=>this.addEffect(e.effect))):await this.addEffect(e.effect)}doExtraBuildInTerrain(e){return this.islandHandler.doExtraBuildInTerrain(e)}doExtraRavageInTerrain(e){return this.islandHandler.doExtraRavageInTerrain(e)}doFearAction(e,a){return this.actionHandler.doAction(Ho.FearAction,e,a)}doGameAction(e,a){return this.actionHandler.doAction(Ho.GameAction,e,a)}doInstruction(e){return this.instructionHandler.doInstruction(e)}doInvaderAction(e,a,t){return this.actionHandler.doAction(e,a,t)}doMainEventAction(e,a){return this.actionHandler.doAction(Ho.MainEventAction,e,a)}doMainEventActionOnEachBoard(e,a={}){return this.doActionOnEachBoard(Ho.MainEventAction,e,a)}doPowerAction(e,a,t){return this.actionHandler.doAction(Ho.PowerAction,a,{spirit:e,power:t})}doScenarioAction(e,a){return this.actionHandler.doAction(Ho.ScenarioAction,e,a)}doScenarioActionOnEachBoard(e,a={}){return this.doActionOnEachBoard(Ho.ScenarioAction,e,a)}doSpiritAction(e,a){return this.actionHandler.doAction(Ho.SpiritAction,e,a)}doTokenEventAction(e,a){return this.actionHandler.doAction(Ho.TokenEventAction,e,a)}doTokenEventActionOnEachBoard(e,a={}){return this.doActionOnEachBoard(Ho.TokenEventAction,e,a)}dontCountAs(e){this.action.dontCountAs.add(e)}drawAndDiscardPower(e){return this.powerHandler.drawAndDiscardPower(e)}drawEventCard(){return this.eventHandler.drawEventCard()}drawFrom(e,a){return this.config.controlledFate&&a.length>0?this.inquirer.chooseFrom(e,a):Promise.resolve(this.randomizer.drawFrom(e))}drawNextExploreCard(){return this.invaderCardHandler.drawNextExploreCard()}drawPower(e,a={}){return this.powerHandler.drawPower(e,a)}eachSpirit(e){return this.spiritHandler.eachSpirit(e)}earnFearCard(){return this.fearHandler.earnFearCard()}earnTerrorLevel(){return this.fearHandler.earnTerrorLevel()}effectsMappedWithFilter(e,a){return this.effectHandler.effectsMappedWithFilter(e,a)}effectsOfType(e){return this.effectHandler.effectsOfType(e)}enhanceEffectWithCurrentEffect(e){return this.effectHandler.enhanceEffectWithCurrentEffect(e)}enterAdminMode(){return this.adminHandler.enterAdminMode()}escalate(e,a){return this.invaderCardHandler.escalate(e,a)}eventCardAtIndexIsSpecial(e){return this.eventHandler.eventCardAtIndexIsSpecial(e)}eventDeckIncludesCard(e){return this.eventHandler.eventCardsInDeck.includes(e)}eventDiscardIncludesCard(e){return this.eventHandler.eventCardsInDiscard.includes(e)}existEffect(e){return this.effectHandler.existEffect(e)}existLandWhere(e){return this.islandHandler.existLandWhere(e)}existLocationIncludingNonExistingWhere(e){return this.islandHandler.existLocationIncludingNonExistingWhere(e)}explore(){return this.islandHandler.explore()}extractFeatures(){return vg.extractFeatures(this)}fear(e){return this.generateFear({amount:e,fromDestroyingBuildings:!1})}fearCardsInLevel(e){return this.fearHandler.fearCardsInLevel(e)}fearDeckIncludesCard(e){return this.fearHandler.fearCardsInDeck.includes(e)}firstEffectOfType(e,a){return this.effectHandler.firstEffectOfType(e,a)}forEachLand(e){return this.islandHandler.forEachLand(e)}forPieces(){return this.islandHandler.forPieces()}forPiecesThatIs(e,a){return this.islandHandler.forPieces().where((t=>t.isA(e)&&(void 0===a||a(t.location))))}forPiecesWhere(e){return this.islandHandler.forPieces().where(e)}fromAllSpirits(){return this.spiritHandler.fromAllSpirits()}gainDamageBoost(e){return this.spiritHandler.gainDamageBoost(e)}gainEnergyDividedEvenly(e){return this.spiritHandler.gainEnergyDividedEvenly(e)}gainEnergyFromTracks(){return this.spiritHandler.gainEnergyFromTracks()}gameStartQuery(){return this.clickToContinue({name:"Setup",splash:!0,text:"",noOptions:"Click to Start Game"})}generateFear(e){return this.fearHandler.generateFear(e)}generatePieceId(){return this.randomizer.generatePieceId()}globalHealthCheck(){return this.islandHandler.globalHealthCheck()}growAndPlayTrackActions(){return this.spiritHandler.growAndPlayTrackActions()}hasEffectNamed(e){return this.effectHandler.hasEffectNamed(e)}inBoards(){return this.islandHandler.inBoards()}inBoardsWhere(e){return this.islandHandler.inBoardsWhere(e)}inBoardsWith(e){return this.islandHandler.inBoardsWith(e)}inBoardsWithout(e){return this.islandHandler.inBoardsWithout(e)}inCoastalLands(){return this.inLandsWhere((e=>e.isCoastal))}inCorners(){return this.islandHandler.inCorners()}inCornersWhere(e){return this.islandHandler.inCornersWhere(e)}inDifferentLands(e){return this.islandHandler.inLands().inDifferent(e)}inInlandLands(){return this.inLandsWhere((e=>e.isInland))}inLands(){return this.islandHandler.inLands()}inLandsWhere(e){return this.islandHandler.inLandsWhere(e)}inLandsWith(e){return this.islandHandler.inLandsWith(e)}inLandsWithAllOf(...e){return this.islandHandler.inLandsWithAllOf(...e)}inLandsWithOneOf(...e){return this.islandHandler.inLandsWithOneOf(...e)}inLandsWithOrAdjacentTo(e){return this.islandHandler.inLandsWithOrAdjacentTo(e)}inLandsWithStrife(){return this.islandHandler.inLandsWithStrife()}inLandsWithout(e){return this.islandHandler.inLandsWithout(e)}inLocations(){return this.islandHandler.inLocations()}inLocationsWhere(e){return this.islandHandler.inLocationsWhere(e)}inOceans(){return this.inLocationsWhere((e=>e.type===jo.Ocean))}inTargetableLandsWhere(e){return this.islandHandler.inTargetableLandsWhere(e)}insertEventCard(e){return this.eventHandler.insertEventCard(e)}insertInvaderCard(e,a={}){return this.invaderCardHandler.insertInvaderCard(e,a)}insertInvaderCardUnderFearCards(e,a){this.fearHandler.insertInvaderCardUnderFearCards(e,a)}invaderCardAtIndexIsSpecial(e){return this.invaderCardHandler.invaderCardAtIndexIsSpecial(e)}invaderCardsInSlot(e){return this.invaderDeckInSlot(e).cards}invaderCardsInVisibleSlot(e){return this.invaderDeckInSlot(e).cards}invaderDeckInSlot(e){return this.invaderCardHandler.invaderCardsInSlot[e]}invadersHaveMinusOneHealthPerStrife(){return this.islandHandler.invadersHaveMinusOneHealthPerStrife()}invalidateBoardCache(){this.islandHandler.invalidateBoardCache()}loseFear(e){return this.fearHandler.loseFear(e)}loseGame(e){return this.conductor.loseGame(e)}majorDeckIncludesPower(e){return this.powerHandler.powercardsInMajorDeck.includes(e)}majorDiscardIncludesPower(e){return this.powerHandler.powercardsInMajorDiscard.includes(e)}may(e,a=!1){return this.inquirer.may(e,a)}migrateCornerCornersFromBoard(e){this.islandHandler.migrateCornerCornersFromBoard(e)}minorDeckIncludesPower(e){return this.powerHandler.powercardsInMinorDeck.includes(e)}minorDiscardIncludesPower(e){return this.powerHandler.powercardsInMinorDiscard.includes(e)}moveNthCardOfStageUpByOne(e,a){return this.invaderCardHandler.moveNthCardOfStageUpByOne(e,a)}nextTriggerId(){return this.actionHandler.nextTriggerId()}nthCardOfStage(e,a){return this.invaderCardHandler.nthCardOfStage(e,a)}oceanIsLandForBlight(e){return this.someEffect(yn.OceanIsLandForBlight,{location:e})}ofTheseLocations(e){return id.createCollection(this,e)}onEachBoard(e,a={}){return this.islandHandler.onEachBoard(e,a)}oneEffectActivates(e,a){return this.effectHandler.oneEffectActivates(e,a)}payEnergyJointlyAidedBy(e){return this.spiritHandler.payEnergyJointlyAidedBy(e)}pickAFaceDownFearCard(){return this.fearHandler.pickAFaceDownFearCard()}pickTerrainsWhere(e,a){return this.islandHandler.pickTerrainsWhere(e,a)}pieceCountIncludingStasis(e){return this.islandHandler.pieceCountIncludingStasis(e)}playDraftActions(e,a){return this.spiritHandler.playDraftActions(e,a)}playPowers(){return this.spiritHandler.playPowers()}playTrackActions(){return this.spiritHandler.playTrackActions()}playersCanJointlyPayEnergyAidedBy(e){return this.spiritHandler.playersCanJointlyPayEnergyAidedBy(e)}possiblyResolveHistoryFinished(){return this.inquirer.possiblyResolveHistoryFinished()}powersWhere(e){return this.spiritHandler.powersWhere(e)}putAllFearCardsInDeckIntoLevel(e){return this.fearHandler.putAllFearCardsInDeckIntoLevel(e)}putAllFearCardsIntoLevel(e){return this.fearHandler.putAllFearCardsIntoLevel(e)}putBottomEventCardToTop(){return this.eventHandler.putBottomEventCardToTop()}putTopEventCardToBottom(){return this.eventHandler.putTopEventCardToBottom()}putTopInvaderCardToBottom(){return this.invaderCardHandler.putTopInvaderCardToBottom()}query(e){return this.inquirer.query(e)}queryOptional(e){return this.inquirer.queryOptional(e)}randomFreePositionFromBoard(e){return this.surveyor.randomFreePositionFromBoard(e)}randomFromArray(e){return this.randomizer.randomFromArray(e)}ravage(){return this.islandHandler.ravage()}removeBlightFromBlightCard(e,a){return this.blightHandler.removeBlightFromBlightCard(e,a)}removeBlightFromBlightPool(e){return this.blightHandler.removeBlightFromBlightPool(e)}removeBottomMostInvaderCardOfStage(e){return this.invaderCardHandler.removeBottomMostInvaderCardOfStage(e)}removeEffect(e){return this.effectHandler.removeEffect(e)}removeEffectsWithId(e){return this.effectHandler.removeEffectsWithId(e)}removeEffectsWithName(e){return this.effectHandler.removeEffectsWithName(e)}removeEventCardFromDiscard(e){this.eventHandler.removeEventCardFromDiscard(e)}removeInvaderCard(e,a){return this.invaderCardHandler.removeCardFromExploreDeck(e,a)}removeInvadersWorthOfHealthUpTo(e){return this.islandHandler.removeInvadersWorthOfHealthUpTo(e)}removePowerCardFromDecks(e){return this.powerHandler.removePowerCardFromDecks(e)}removeSlowHealingBlight(e){return this.blightHandler.removeSlowHealingBlight(e)}removeThisEffect(){this.effectHandler.removeCurrentEffect()}removeTopFearCard(){return this.fearHandler.removeTopFearCard()}removeTopMostInvaderCardOfStage(e){return this.invaderCardHandler.removeTopMostInvaderCardOfStage(e)}removeTopNonSpecialExploreCard(){return this.invaderCardHandler.removeTopNonSpecialExploreCard()}reportMovement(e){return this.instructionHandler.reportMovement(e)}reshuffleFearDeck(){return this.fearHandler.reshuffleFearDeck()}resolvablePowers(e,a=!1){return $d.createCollection(this,this.spiritHandler.resolvablePowers(e,a))}resolveFearCards(){return this.fearHandler.resolveFearCards()}resolveMaximimumPowers(e){this.overrider.resolveMaximimumPowers(e)}resolveNextFearCard(e){return this.fearHandler.resolveNextFearCard(e)}resolvePowers(e){return this.spiritHandler.resolvePowers(e)}resultFromFirstEffectOfType(e,a){return this.effectHandler.resultFromFirstEffectOfType(e,a)}revealFearCardAtLevel(e,a){return this.fearHandler.revealFearCard(e,a)}revealFearCardInDeck(e){return this.fearHandler.revealFearCardInDeck(e)}revealTopEventCard(){return this.eventHandler.revealTopEventCard()}revealTopFearCard(){return this.fearHandler.revealTopFearCard()}revealTopInvaderCard(){return this.invaderCardHandler.revealTopInvaderCard()}run(e,a){const t=this.inquirer.setHistory(e??[],a);return this.conductor.run(void 0===e),t}runEndOfActionEffects(e){return this.effectHandler.runEndOfActionEffects(e)}runEndOfActionTreeEffects(e){return this.effectHandler.runEndOfActionTreeEffects(e)}scoreFromPowers(){return this.spiritHandler.scoreFromPowers()}selectX(e,a,t={}){return this.inquirer.selectX(e,a,t)}sendEvent(e){return this.inquirer.send(e)}setCorners(e){this.islandHandler.setCorners(e)}setHasAttemptedDamagingInvaderThisInstruction(){this.instructionHandler.hasAttemptedDamagingInvader=!0}setHasAttemptedDestroyingInvaderThisInstruction(){this.instructionHandler.hasAttemptedDestroyingInvader=!0}setPhase(e){return this.conductor.setPhase(e)}setRandomSeed(){this.randomizer.setRandomSeed()}setSeed(e){this.randomizer.setSeed(e)}setupAdjacencies(){this.surveyor.setupAdjacencies()}setupAdversaries(){return this.adversaryHandler.setup()}setupCommandBeast(){return this.commandBeastHandler.setup()}setupCorners(){this.surveyor.setupCorners()}setupFearDeck(){return this.fearHandler.setupFearDeck()}setupInvaderDeck(){return this.invaderCardHandler.setupInvaderDeck()}setupPresence(){return this.spiritHandler.setupPresence()}setupScenario(){return this.scenarioHandler.setup()}setupSpirits(){return this.spiritHandler.setup()}setupStartingTokens(){return this.islandHandler.setupStartingTokens()}shuffle(e){return this.randomizer.shuffle(e)}shuffleTopThreeEventCards(){return this.eventHandler.shuffleTopThreeEventCards()}shuffleTopTwoEventCards(){return this.eventHandler.shuffleTopTwoEventCards()}shuffleTopTwoInvaderCards(){return this.invaderCardHandler.shuffleTopTwoInvaderCards()}simplifyMultiPush(){this.overrider.simplifyMultiPush()}simulateSpiritBoardOnly(){this.overrider.simulateSpiritBoardOnly()}spiritsWhich(e){return this.spiritHandler.spiritsWhich(e)}splittedDamage(e){return this.islandHandler.splittedDamage(e)}stageNumbersInSlot(e){return this.invaderCardHandler.stageNumbersInSlot(e)}startAllowOceanForBlight(e){this.oceanIsLandForBlight(e)&&(this.islandHandler.oceanIsAllowedForBlight=!0)}stopAllowOceanForBlight(){this.islandHandler.oceanIsAllowedForBlight=!1}sumEffects(e,a){return this.effectHandler.sumEffects(e,a)}timePassesForEffects(){return this.effectHandler.timePasses()}timePassesForFear(){return this.fearHandler.timePasses()}timePassesForSpirits(){return this.spiritHandler.timePasses()}timePassesLateExpiration(){return this.effectHandler.timePassesLateExpiration()}toString(){return bg({adversary:this.adversaryHandler,blight:this.blightHandler,conductor:this.conductor,event:this.eventHandler,fear:this.fearHandler,invaderCards:this.invaderCardHandler,island:this.islandHandler,powerHandler:this.powerHandler,randomizer:this.randomizer,scenario:this.scenarioHandler,spirits:this.spiritHandler})}unusedInvaderCardOfStage(e){return this.invaderCardHandler.unusedInvaderCardOfStage(e)}updateReportedPhase(){this.conductor.updateReportedPhase()}waitForAnimationsToFinish(){return this.inquirer.waitForAnimationsToFinish()}winGame(e){return this.conductor.winGame(e)}}Ev([Me],Pv.prototype,"ignoreOneStrife",null),Ev([Me],Pv.prototype,"someBoardsHasExtraLocations",null),Ev([Me],Pv.prototype,"someEffectMakesOceanALand",null),Ev([Me],Pv.prototype,"someLocationHasExtraTerrains",null),Ev([Me],Pv.prototype,"someNonOceanIsOcean",null);class Sv{get layout(){return{}}static create(...e){const a=new this(...e);return Xo.observableClass(a,this.name),a.init(),a}static layout(e,a,...t){return Sv.create.call(this,e,a,...t).layout}init(){}}class Ov extends Sv{currentQuery;movingPieces=[];queryPromise;queryPromisePromise;state;stateCursor=0;static DEBUG_QUERIES=!1;waitingForQuery;constructor(e){super(),this.state=new Pv(this,dt(e))}addEvent(e){e.data.type===fn.GameEnd&&(this.currentQuery=void 0)}close(){this.state.closeDown()}query(e){const{query:a,items:t,name:n,text:r,prompt:i,optional:s}=e;Ov.DEBUG_QUERIES&&(console.log(`${pn[a]} ${n}: ${r} ${i} optional = ${s}`),console.log(t)),this.currentQuery=e;const o=new pm;if(void 0!==this.queryPromisePromise){const{queryPromisePromise:e}=this;return this.queryPromisePromise=void 0,e.resolve(o),o.promise}return this.queryPromise=o,void 0!==this.waitingForQuery&&this.waitingForQuery.resolve(),this.queryPromise.promise}async resolveQuery(e){if(void 0===this.queryPromise){this.queryPromisePromise=new pm;(await this.queryPromisePromise.promise).resolve(e)}else{const a=this.queryPromise;this.queryPromise=void 0,a.resolve(e)}this.stateCursor+=1,this.currentQuery=void 0}async run(e,a){const t=await this.state.run(e,a);return this.stateCursor=t?.length??0,this.stateCursor}send(e){return this.addEvent(e),Promise.resolve()}waitForAnimations(){return Promise.resolve()}async waitForQuery(){void 0===this.queryPromise&&(this.waitingForQuery=new pm,await this.waitingForQuery.promise,this.waitingForQuery=void 0)}}var Cv=t(248),Dv=t.n(Cv);const Bv={debugEvents:!1,debugQueries:!1,debugSimulation:!0,maxActions:2,maxNumberOfSimulations:300,maxSimulationTimeInMs:5e4,maxTurns:void 0,nodesToAdd:5,numberOfWorkers:6,randomizeSeed:!0,repeats:1,traceSimulation:!1,variable:0};class kv{static selectMove(e){const{debug:a=!1,results:t}=e;if(0===t[0].moves.length)return a&&console.log("No more moves. Game ended."),null;if(1===t[0].moves.length)return a&&console.log(Dv().green(`${mg(t[0].moves[0].move,66)} `)),{bestMove:t[0].moves[0].move};{const e=t[0].moves.map(((e,a)=>Uo(t,(e=>e.moves[a].plays)))),n=t[0].moves.map(((e,a)=>Math.max(...t.map((e=>e.moves[a].value))))),r=Math.max(...n),i=n.reduce(((e,a,t)=>a===r?e.concat([t]):e),[]),s=i[Math.floor(Math.random()*i.length)];if(a)for(let a=0;a<t[0].moves.length;a+=1){const r=a===s?Dv().green:Dv().white;console.log(r(`${mg(t[0].moves[a].move,66)} [${mg(`${e[a]}`,6)} | ${mg(`${n[a].toFixed(2)}`,7)}]`))}return{bestMove:t[0].moves[s].move}}}}class Lv{config;history;onError;simParams;workerPool;constructor(e){this.config=e.config,this.history=e.history,this.simParams=e.simParams||Bv,this.workerPool=e.workerPool,this.onError=e.onError}async findBestMove(){const e=[];for(let a=0;a<this.simParams.numberOfWorkers;a+=1)e.push(this.workerPool.performWork(a,{config:this.config,history:this.history,simParams:this.simParams,workerId:a}));const a=new pm,t=setTimeout((()=>{console.log("TIMEOUT!"),a.resolve([{error:"Timeout"}])}),this.simParams.maxSimulationTimeInMs+1e3),n=Promise.all(e),r=await Promise.race([n,a.promise]);clearTimeout(t);const i=r.find((e=>e.error));if(i)return console.log("error"),this.onError?.(i),null;const s=r;if(this.simParams.debugSimulation){const e=Uo(s,(e=>e.runs));console.log(Dv().gray(`=[${mg(`${e}`,5)} ]============================================================================`))}const o=kv.selectMove({results:s,debug:this.simParams.debugSimulation,simParams:this.simParams});return this.simParams.debugSimulation&&console.log(Dv().gray("=====================================================================================")),null===o?null:o.bestMove}}class Fv{static workers=[];async performWork(e,a){for(;Fv.workers.length<=e;)Fv.workers.push(new Worker(new URL(t.p+t.u(466),t.b)));const n=Fv.workers[e],r=new pm,i=e=>{const a=e.data;r.resolve(a)};n.addEventListener("message",i),n.postMessage(JSON.stringify(a));const s=await r.promise;return n.removeEventListener("message",i),s}release(){Fv.workers.forEach((e=>{e.terminate()})),Fv.workers.length=0}}class Rv extends Sv{game;client;updateOn=!0;static webworkerPool=new Fv;config=r;cursor=0;history=[];constructor(e){super(),this.game=e,this.client=Ov.create(r)}get currentQuery(){return this.client.currentQuery}get dataStore(){return{cursor:this.cursor,history:this.history,config:this.config}}set dataStore(e){void 0!==e.config&&(this.cursor=e.cursor,this.history=e.history,this.config=e.config)}get gameData(){return{cursor:this.cursor,history:this.history,config:this.config}}get gameJson(){return JSON.stringify({config:this.config,history:this.history})}get mayGoNext(){return this.cursor<this.history.length}get mayGoPrevious(){return this.cursor>0}get nextResponse(){return this.client.stateCursor<this.history.length?this.history[this.client.stateCursor]:void 0}get queryIsCurrent(){return this.currentQuery?.cursor===this.cursor}async alterHistory(e){const{delta:a=0}=e;await this.resetStateToCursor({cursor:this.cursor+a,history:e.history})}clearHistory(){this.history=[],this.cursor=0}async enterAdminMode(e={}){const{withPrompt:a=!0}=e;let t="Admin";if(this.state.isInAdmin&&(this.currentQuery?.actionIds.includes("CloseAdmin")?t="CloseAdmin":this.currentQuery?.optional&&(t="Skip")),this.client.stateCursor<this.cursor)return void console.warn("Tried to enter move when stateCursor is not up to date");const n={history:this.history,cursor:this.cursor,move:t};a&&this.cursor<this.history.length&&t!==this.history[this.cursor]?this.newHistoryBranch({move:t}):await this.resolveMove(n)}async enterMove(e,a={}){const{withPrompt:t=!0}=a;if(this.game.aiIsPlaying)return;if(this.client.stateCursor<this.cursor)return void console.warn("Tried to enter move when stateCursor is not up to date");const n={history:this.history,cursor:this.cursor,move:-1===e?"Skip":this.currentQuery.actionIds[e]};t&&this.cursor<this.history.length&&n.move!==this.history[this.cursor]?this.newHistoryBranch({move:n.move}):await this.resolveMove(n)}findBestMove(){return new Lv({config:this.config,history:this.history.slice(0,this.cursor),state:this.state,currentQuery:this.game.currentQuery,workerPool:Rv.webworkerPool}).findBestMove()}async importGame(e,a=!0){const t=JSON.parse(e);if(this.isValidImport(t))return await this.resetStateToCursor({config:t.config,history:t.history,cursor:a?0:t.history.length}),t.config;throw new Error("Invalid file.")}insertMove(e){const a=this.history.slice();return a.splice(this.cursor,0,e),a}async jumpToEnd(){await this.resetStateToCursor({cursor:this.history.length})}async jumpToStart(){await this.resetStateToCursor({cursor:0})}async jumpToTime(e){await this.resetStateToCursor({cursor:e})}async jumpToTurn(e){await this.resetStateToCursor({includeStart:!1,localOnly:!1,abortAtTurn:e,cursor:this.history.length})}newHistoryBranch(e={}){const{move:a,previous:t=!1}=e,n=this.history.slice(0,this.cursor);let r=e.delta||0;t&&(n.pop(),r-=1),a&&(n.push(a),r+=1),this.alterHistory({history:n,delta:r})}async next(){void 0!==this.currentQuery?this.cursor<this.history.length&&await this.resetStateToCursor({cursor:this.cursor+1,reactive:!1}):await this.resetStateToCursor()}nextTurn(){return this.jumpToTurn(this.state.turn+1)}async playNext(){void 0!==this.game.nextResponse&&(this.game.nextResponseIsAdmin?await this.enterAdminMode():await this.enterMove(this.game.nextResponse))}async previous(){this.cursor>0&&await this.resetStateToCursor({cursor:this.cursor-1,reactive:!1})}previousTurn(){return this.jumpToTurn(Math.max(this.state.phase===Wi.Grow?this.state.turn-1:this.state.turn,0))}async randomMove(){if(this.currentQuery){const{optional:e,items:a,query:t}=this.currentQuery;if(e)return void await this.enterMove(-1);if(t===pn.PlayPower){const e=a.findIndex((e=>void 0===e.power));return void await this.enterMove(e)}const n=a?.map(((e,a)=>{const t=e.effect;return void 0!==t?"Cheat"!==t.name?a:-1:a})).filter((e=>e>=0)),r=e&&0===n.length?-1:0,i=n.length-1,s=Math.floor(Math.random()*(i-r+1))+r;if(-1===s)return void await this.enterMove(-1);await this.enterMove(void 0!==n&&n.length>0?n[s]:s)}}removeNextMove(){const e=this.history.slice();return e.splice(this.cursor,1),e}replaceNextMove(e,a=!1){const t=this.history.slice();return t.splice(this.cursor,1,e),a&&(this.history=t),t}async resetStateToCursor(e={}){const{config:a,includeStart:t=!1,abortAtTurn:n,cursor:r=this.cursor,history:i=this.history}=e;this.client.close(),a&&(this.config=a),Xo.reactivity=!0,this.updateOn=!1;const s=Ov.create(this.config),o=await s.run(t?void 0:i.slice(0,r),n);this.cursor=o,this.history=i,this.client=s,this.updateOn=!0}async syncToGameData(e,a,t){await this.resetStateToCursor({cursor:e.cursor,config:e.config,history:e.history,includeStart:a,abortAtTurn:t})}get state(){return this.client.state}isValidImport(e){const a=e;return void 0!==a.config&&void 0!==a.history}async resolveMove(e){await this.resetStateToCursor({cursor:this.cursor,history:e.history});const a=e.move;this.cursor<this.history.length?a!==this.history[this.cursor]&&(this.history[this.cursor]=a):this.history.push(a),this.cursor+=1,await this.client.resolveQuery(a)}}class Nv extends Sv{aiIsPlaying=!1;askToDowngradeThresholds=!1;autoPlayControlledFate=!1;showNextMove=!0;skipDowngrades=!1;history;currentSpiritIndex=0;estimator=null;constructor(){super(),this.history=Rv.create(this)}get client(){return this.history.client}get config(){return this.client.state.config}get currentQuery(){return this.history.currentQuery}get currentSpirit(){return this.state.spirits[this.currentSpiritIndex%this.state.spirits.length]}get dataStore(){return{currentSpiritIndex:this.currentSpiritIndex,showNextMove:this.showNextMove,autoPlayControlledFate:this.autoPlayControlledFate,askToDowngradeThresholds:this.askToDowngradeThresholds}}set dataStore(e){this.currentSpiritIndex=e.currentSpiritIndex,this.showNextMove=e.showNextMove,this.autoPlayControlledFate=e.autoPlayControlledFate,this.askToDowngradeThresholds=e.askToDowngradeThresholds}get estimatedValue(){return null===this.estimator&&(this.estimator=new vg),this.estimator.estimateValueWithReward(this.state,!1)}get gameData(){return this.history.gameData}get hasRunningAction(){return this.state.hasRunningAction}get mayGoNext(){return this.history.mayGoNext}get mayGoPrevious(){return this.history.mayGoPrevious}get nextResponse(){if(void 0!==this.currentQuery&&this.history.queryIsCurrent&&void 0!==this.history.nextResponse){if("Skip"===this.history.nextResponse&&this.currentQuery.optional)return-1;{const e=this.currentQuery.actionIds.indexOf(this.history.nextResponse);return void 0===e||e>=0?e:-2}}}get nextResponseIsAdmin(){return"Admin"===this.history.nextResponse}get nextTextResponse(){return this.history.nextResponse}get nextVisibleResponse(){if(this.showNextMove)return this.nextResponse}get state(){return this.client.state}get updateOn(){return this.history.updateOn}alterHistory(e){return this.history.alterHistory(e)}autoPlay(){this.aiIsPlaying=!0,setTimeout((()=>{(async()=>{const e=await this.findBestMove();null!==e?(this.history.newHistoryBranch({move:e,delta:-1}),setTimeout((()=>{(async()=>{await this.playNext(),this.state.gameEnded?this.aiIsPlaying=!1:this.autoPlay()})()}),100)):this.aiIsPlaying=!1})()}),0)}async continueGame(){await this.history.jumpToEnd()}debugEstimatedValue(){return null===this.estimator&&(this.estimator=new vg),this.estimator.estimateValueWithReward(this.state,!0)}enterAdminMode(){return this.history.enterAdminMode()}exportGame(){const e=document.createElement("a");e.download=`${(()=>{const e=new Date;return`${e.getFullYear().toString().slice(0,4)}-${e.getMonth()+1>10?e.getMonth()+1:`0${e.getMonth()+1}`}-${e.getDate()>10?e.getDate():`0${e.getDate()}`}`})()}.json`,e.href=this.exportObjectUrl,e.click()}findBestMove(){return this.history.findBestMove()}importGame(e,a=!0){return this.history.importGame(e,a)}jumpToEnd(){return this.history.jumpToEnd()}jumpToStart(){return this.history.jumpToStart()}jumpToTime(e){return this.history.jumpToTime(e)}jumpToTurn(e){return this.history.jumpToTurn(e)}next(){return this.history.next()}nextTurn(){return this.history.nextTurn()}playNext(){return this.history.playNext()}previous(){return this.history.previous()}previousTurn(){return this.history.previousTurn()}randomMove(){return this.history.randomMove()}async setupGame(e){this.currentSpiritIndex=0,this.client.state.config=r,e.startDate=new Date,await this.history.resetStateToCursor({config:e,includeStart:!0,cursor:0,history:[]})}async start(){await this.history.resetStateToCursor()}get exportObjectUrl(){const e=new Blob([this.history.gameJson],{type:"application/json"});return URL.createObjectURL(e)}}const $v=e=>`<code>${e}</code>`,Wv=e=>`"<code>${e}</code>"`;class Mv{app;description="Lists available commands. Supply an argument to get help for that command.";constructor(e){this.app=e}handle(e){if(0===e.length){this.app.addOutput("List of commands:");for(const[e,a]of Object.entries(this.app.commandHandlers))this.app.addOutput(`&nbsp;&nbsp;${Wv(e)}: ${a.description}`)}else{const a=e[0],t=this.app.commandHandlers[a]?a:this.app.commandAlias[a],n=this.app.commandHandlers[t];if(n){this.app.addOutput(`The ${$v(t)} commando.`),n.help();const e=Object.keys(this.app.commandAlias).filter((e=>this.app.commandAlias[e]===t));this.app.addOutput("Aliases:"),this.app.addOutput(`&nbsp;&nbsp;${e.map((e=>`${$v(e)}`)).join(", ")}`)}else this.app.addOutput(`Unknown command ${$v(t)}.`)}return Promise.resolve()}help(){this.app.addOutput("Usage: "),this.app.addOutput(`&nbsp;&nbsp;${Wv("help")}: Lists available commands.`),this.app.addOutput(`&nbsp;&nbsp;${Wv("help &lt;cmd&gt;")}: Show help for the command ${$v("&lt;cmd&gt;")}.`)}}const Gv={[sr.Beasts]:"Land with Beasts",[sr.Blight]:"Blighted Land",[sr.BlightAndInvaders]:"Land with Blight and Invaders",[sr.City]:"Land with City",[sr.Coastal]:"Coastal Land",[sr.CoastalCity]:"Coastal Land with City",[sr.Dahan]:"Land with Dahan",[sr.Deeps]:"Land with Deeps Token",[sr.Disease]:"Land with Disease",[sr.Incarna]:"Land with Incarna",[sr.IncarnaAndDahan]:"Land with Incarna and Dahan",[sr.IncarnaBehemoth]:"Land with Behemoth Incarna",[sr.IncarnaLair]:"Land with Lair Incarna",[sr.IncarnaRoots]:"Land with Roots Incarna",[sr.IncarnaVoice]:"Land with Voice Incarna",[sr.Inland]:"Inland Land",[sr.Invaders]:"Land with Invaders",[sr.InvadersAndIncarnaRoots]:"Land with Invaders and Roots Incarna",[sr.Jungle]:"Jungle",[sr.JunglesOrWetlands]:"Jungles or Wetlands",[sr.Mountain]:"Mountain",[sr.MountainOrJungles]:"Mountain or Jungles",[sr.NoInvaders]:"Land without Invaders",[sr.NonBlight]:"Non-Blighted Land",[sr.NonOceanLand]:"Non-Ocean Land",[sr.NotWetlands]:"Non-Wetlands",[sr.Quake]:"Land with Quake",[sr.SacredSite]:"Sacred Site",[sr.SacredSiteAndDahan]:"Sacred Site with Dahan",[sr.Sands]:"Sands",[sr.Strife]:"Land with Strife",[sr.TheEndlessDark]:"The Endless Dark",[sr.Town]:"Land with Town",[sr.TownOrCity]:"Land with Town or City",[sr.TwoBeasts]:"Land with two Beasts",[sr.TwoBeastsAndInvaders]:"Land with two beasts and Invaders",[sr.TwoDahan]:"Land with two Dahan",[sr.WardTheShores]:"Land with Ward The Shores token",[sr.Wetlands]:"Wetlands"},Hv={"<air>":"Air","<animal>":"Animal","<any>":"Any","<badlands>":"Badlands","<beasts>":"Beasts","<blight>":"Blight","<br><br>":"<br>","<broken>":"Destroyed Presence","<bullet>":"•","<city>":"City","<dahan>":"Dahan","<damage>":"Damage","<darkfire>":"Darkfire","<deeps>":"Deeps","<disease>":"Disease","<earth>":"Earth","<endless-dark>":"Endless Dark","<escalation>":"Escalation","<explorer>":"Explorer","<fast>":"Fast","<fear>":"Fear","<fire>":"Fire","<fire-plant>":"Fire or Plant","<impending>":"Impending","<marked-beast>":"Marked Beast","<moon>":"Moon","<or>":" ~ OR ~ ","<plant>":"Plant","<presence>":"Presence","<quake>":"Quake","<range-0>":"Range 0","<range-1>":"Range 1","<range-2>":"Range 2","<range-3>":"Range 3","<range-4>":"Range 4","<range+1>":"+1 Range","<range+2>":"+2 Range","<range+3>":"+3 Range","<range+4>":"+4 Range","<range-air>":"Range Air","<sacred>":"Sacred Site","<branch>":"Branch and Claw","<feather>":"Feather and Flame","<horizons>":"Horizons of Spirit Island","<incarna-behemoth>":"Behemoth","<incarna-darkness>":"Darkness","<incarna-lair>":"Lair","<incarna-locus>":"Behemoth","<incarna-roots>":"Roots","<incarna-voice>":"Voice","<incarna-warrior>":"Warrior","<jagged>":"Jagged Earth","<nature>":"Nature Incarnate","<shadow-damage>":"Shadow Damage","<slow>":"Slow","<spirit-lightning>":"Lightning","<spirit-river>":"River","<spirit-earth>":"Earth","<spirit-shadows>":"Shadows","<spirit-thunderspeaker>":"Thunderspeaker","<spirit-green>":"Green","<spirit-ocean>":"Ocean","<spirit-bringer>":"Bringer","<spirit-fangs>":"Fangs","<spirit-keeper>":"Keeper","<spirit-wildfire>":"Wildfire","<spirit-serpent>":"Serpent","<spirit-stone>":"Stone","<spirit-memory>":"Memory","<spirit-trickster>":"Trickster","<spirit-lure>":"Lure","<spirit-manyminds>":"ManyMinds","<spirit-volcano>":"Volcano","<spirit-shroud>":"Shroud","<spirit-vengeance>":"Vengeance","<spirit-starlight>":"Starlight","<spirit-fractured>":"Fractured","<spirit-downpour>":"Downpour","<spirit-finder>":"Finder","<spirit-teeth>":"Teeth","<spirit-eyes>":"Eyes","<spirit-mud>":"Mud","<spirit-heat>":"Heat","<spirit-whirlwind>":"Whirlwind","<spirit-hearthvigil>":"HearthVigil","<spirit-behemoth>":"Behemoth","<spirit-darkness>":"Darkness","<spirit-gaze>":"Gaze","<spirit-roots>":"Roots","<spirit-earthquakes>":"Earthquakes","<spirit-voice>":"Voice","<spirit-wounded>":"Wounded","<strife>":"Strife","<sun>":"Sun","<sun-moon>":"Sun or Moon","<jungles-sands>":"Jungles or Sands","<jungles-wetlands>":"Jungles or Wetlands","<jungles>":"Jungles","<mountains-jungles>":"Mountains or Jungles","<mountains-sands>":"Mountains or Sands","<mountains-wetlands>":"Mountains or Wetlands","<mountains>":"Mountains","<sands-wetlands>":"Sands or Wetlands","<sands>":"Sands","<wetlands>":"Wetlands","<town>":"Town","<vitality>":"Vitality","<water>":"Water","<water-animal>":"Water or Animal","<wilds>":"Wilds"},jv=e=>{let a=e;for(const e of Object.keys(Hv))a=a.replaceAll(e,Hv[e]);return a};class Uv{app;description="Read the text of any card.";library={};constructor(e){this.app=e;for(const e of Object.keys(sg))this.library[sg[e].name]=e;for(const e of Object.keys(tr))this.library[tr[e].name]=e;for(const e of Object.keys(xw))this.library[xw[e].name]=e;for(const e of Object.keys(lp))this.library[lp[e].name]=e}handle(e){if(0===e.length)this.app.addOutput("Supply the name or parts of the name as arguments.");else{const a=Object.keys(this.library).filter((a=>e.join(" ").toUpperCase()===a.toUpperCase())),t=0===a.length?Object.keys(this.library).filter((a=>e.every((e=>a.split(" ").some((a=>a.toUpperCase().startsWith(e.toUpperCase()))))))):a;if(t.length>0)if(1===t.length){const e=this.library[t[0]],a=sg[e],n=this.library[t[0]],r=tr[n],i=this.library[t[0]],s=xw[i],o=this.library[t[0]],d=lp[o];if(a){this.app.addOutput(a.name);const t=a.speed===rr.Fast?"Fast":"Slow";let n;if(a.type===Sn.Unique?n=Object.keys(am).find((a=>am[a].uniquePowers.includes(e))):a.type===Sn.Innate&&(n=Object.keys(am).find((a=>am[a].innatePowers.includes(e)))),this.app.addOutput(`${a.banned?"Banned ":""}${a.type} Power${n?` of ${am[n].name}`:""}.`),this.app.addOutput(`${t}${void 0!==a.energy?`, ${a.energy} Energy.`:""}`),a.elements&&this.app.addOutput(`Elements: ${a.elements.join(", ")}. `),a.target===ir.Spirit){let e="Spirit";a.targetFilter?.includes(ur.Another)?e="Another Spirit":a.targetFilter?.includes(ur.Yourself)&&(e="Yourself"),this.app.addOutput(`Target ${e}`)}else{const e=void 0!==a.range?` in range ${a.range}`:"",t=a.targetFilter?a.targetFilter.map((e=>Gv[e])).join(" or "):"Land",n=a.sourceFilter?` of ${a.sourceFilter.map((e=>Gv[e])).join(" or ")}`:"";this.app.addOutput(`Target ${t}${e}${n}.`)}for(const e of a.effects)if(e.text){const a=e.threshold?`Threshold: ${jv(Av(e.threshold))}: `:"";this.app.addOutput(a+jv(e.text))}}else if(r){this.app.addOutput(r.name),this.app.addOutput(`${r.banned?"Banned ":""}Blight Card. ${r.stillHealthy?"Still Healthy Island. ":""}${r.blightPerPlayer} Blight per Player.`);for(const e of r.effects)e.text&&this.app.addOutput(jv(e.text))}else if(s){this.app.addOutput(s.name),this.app.addOutput((s.banned?"Banned ":"")+"Fear Card.");let e=1;for(const a of s.levels)a.text?this.app.addOutput(`Terror Level ${e}: ${jv(a.text)}`):a.effects&&this.app.addOutput(`Terror Level ${e}: ${a.effects.map((e=>jv(e.text||""))).join(" ")}`),e+=1}else if(d){this.app.addOutput(d.name),this.app.addOutput((d.banned?"Banned ":"")+"Event Card.");for(const e of d.events){let a="";if(e.tokenEvent?a="Token Event: ":e.blightStatus?a=e.blightStatus===og.BlightedIsland?"Blighted Island: ":"Healthy Island: ":e.dahanEvent?a="Dahan Event: ":e.stages?a=`Stage ${e.stages.join(" & ")}: `:e.terrorLevels&&(a=`Terrorlevel ${e.terrorLevels.join(" & ")}: `),e.fullText)for(const a of e.fullText)this.app.addOutput(`${jv(a)}`);else{this.app.addOutput(a+e.name);for(const a of e.effects)a.text&&this.app.addOutput(`&nbsp;&nbsp;${jv(a.text)}`)}}}}else{this.app.addOutput(`${t.length} cards found:`);for(const e of t.slice(0,3))this.app.addOutput(`&nbsp;&nbsp;${e}`);t.length>3&&this.app.addOutput(`...and ${t.length-3} more.`)}else this.app.addOutput("No cards found.")}return Promise.resolve()}help(){this.app.addOutput("Usage: "),this.app.addOutput(`&nbsp;&nbsp;${Wv("read &lt;card&gt;")}: Show text of card ${$v("&lt;card&gt;")}.`)}}function qv(e){return JSON.parse(JSON.stringify(e))}class _v extends Sv{app;config=r;constructor(e){super(),this.app=e}get dataStore(){return{config:this.config}}set dataStore(e){this.config=e.config}get difficulty(){return fm.difficulty(this.config)}get gameConfig(){return this.app.gameConfig}get sets(){return this.config.sets}setRandomSeed(){this.config.seed=Math.floor(9999999*Math.random())}setSetupConfig(e){this.config=e}async setupGame(){this.sortBoards();const e=qv(this.config);await this.app.setupGame(e)}sortBoards(){this.config.boards.sort(((e,a)=>e.boardId.localeCompare(a.boardId)))}}const Jv=class extends Sv{commandAlias={};commandHandlers={};caret=":&nbsp;";game;output=document.createElement("div");setup;terminal=document.createElement("div");version="0.1.1 (2024-03-17)";constructor(){super(),this.setupHtml(),this.game=Nv.create(),this.setup=_v.create(this),this.addHandler(["help","h"],new Mv(this)),this.addHandler(["read","r"],new Uv(this))}get gameConfig(){return this.game.config}get gameData(){return this.game.gameData}get setupConfig(){return this.setup.config}addOutput(e){const a=document.createElement("div");a.innerHTML=e,this.output.appendChild(a),this.terminal.scrollTop=this.terminal.scrollHeight}alterHistory(e){return this.game.alterHistory(e)}continueGame(){return this.game.continueGame()}exportGame(){return this.game.exportGame()}async importGame(e,a={}){const{start:t=!0}=a,n=await this.game.importGame(e,t);this.setup.config=n}async init(){await this.game.start()}jumpToEnd(){return this.game.jumpToEnd()}jumpToStart(){return this.game.jumpToStart()}jumpToTurn(e){return this.game.jumpToTurn(e)}next(){return this.game.next()}previous(){return this.game.previous()}async processInput(e){const[a,...t]=e.split(" "),n=a.toLowerCase(),r=this.commandHandlers[n]||this.commandAlias[n]&&this.commandHandlers[this.commandAlias[n]];r?await r.handle(t):this.addOutput(`Unknown command "<code>${a}</code>".`)}setSetupConfig(e){this.setup.setSetupConfig(e)}setupGame(e){return this.game.setupGame(e)}setupGameRequested(){return this.setup.setupGame()}setupNewGame(){this.setup.config=qv(this.setup.config),this.setup.setRandomSeed()}addHandler(e,a){const[t,...n]=e;this.commandHandlers[t]=a;for(const e of n)this.commandAlias[e]=t}setupHtml(){const e=document.getElementById("root");this.terminal.id="terminal",this.output.id="output",this.output.ariaLive="polite";const a=document.createElement("div");a.id="inputRow";const t=document.createElement("div");t.id="caret",t.innerHTML=this.caret;const n=document.createElement("input");n.type="text",n.id="input",n.autofocus=!0,n.autocomplete="off",n.autocapitalize="off",n.spellcheck=!1,n.addEventListener("keyup",(e=>{if("Enter"===e.key){const e=n.value.trim();""!==e&&(this.addOutput(this.caret+e),n.value="",n.disabled=!0,a.style.display="none",(async()=>{await this.processInput(e),n.disabled=!1,a.style.display="flex",n.focus()})())}})),this.terminal.appendChild(this.output),a.appendChild(t),a.appendChild(n),this.terminal.appendChild(a),e.appendChild(this.terminal),this.addOutput(`Spirit Island Terminal Edition v${this.version}.`),this.addOutput('For a list of commands type "<code>help</code>".')}}.create();Object.assign(window,{get R(){return Jv}})})()})();